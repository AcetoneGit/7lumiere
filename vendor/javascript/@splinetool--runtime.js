// @splinetool/runtime@1.9.76 downloaded from https://ga.jspm.io/npm:@splinetool/runtime@1.9.76/build/runtime.js

var E=Object.create;var O=Object.defineProperty;var R=Object.getOwnPropertyDescriptor;var z=Object.getOwnPropertyNames;var V=Object.getPrototypeOf,j=Object.prototype.hasOwnProperty;var BF=(E,R,z)=>R in E?O(E,R,{enumerable:!0,configurable:!0,writable:!0,value:z}):E[R]=z;var pc=(E,O)=>()=>(O||E((O={exports:{}}).exports,O),O.exports),NF=(E,R)=>{for(var z in R)O(E,z,{get:R[z],enumerable:!0})},FF=(E,V,Y,ee)=>{if(V&&typeof V=="object"||typeof V=="function")for(let se of z(V))!j.call(E,se)&&se!==Y&&O(E,se,{get:()=>V[se],enumerable:!(ee=R(V,se))||ee.enumerable});return E};var Za=(R,z,j)=>(j=R!=null?E(V(R)):{},FF(!z&&R&&R.__esModule?j:O(j,"default",{value:R,enumerable:!0}),R));var mc=(E,O,R)=>(BF(E,typeof O!="symbol"?O+"":O,R),R);var Y=pc(((E,O)=>{(function(R,z){typeof E=="object"?O.exports=z():typeof define=="function"&&define.amd?define(z):R.Alea=z()})(E,(function(){return n.importState=function(E){var O=new n;return O.importState(E),O},n;function n(){return function(E){var O=0,R=0,z=0,V=1;E.length==0&&(E=[+new Date]);var j=t();O=j(" "),R=j(" "),z=j(" ");for(var Y=0;Y<E.length;Y++)O-=j(E[Y]),O<0&&(O+=1),R-=j(E[Y]),R<0&&(R+=1),z-=j(E[Y]),z<0&&(z+=1);j=null;var c=function(){var E=2091639*O+V*2.3283064365386963e-10;return O=R,R=z,z=E-(V=E|0)};return c.next=c,c.uint32=function(){return c()*4294967296},c.fract53=function(){return c()+11102230246251565e-32*(c()*2097152|0)},c.version="Alea 0.9",c.args=E,c.exportState=function(){return[O,R,z,V]},c.importState=function(E){O=+E[0]||0,R=+E[1]||0,z=+E[2]||0,V=+E[3]||0},c}(Array.prototype.slice.call(arguments))}function t(){var E=4022871197,r=function(O){O=O.toString();for(var R=0;R<O.length;R++){E+=O.charCodeAt(R);var z=.02519603282416938*E;E=z>>>0,z-=E,z*=E,E=z>>>0,z-=E,E+=z*4294967296}return 2.3283064365386963e-10*(E>>>0)};return r.version="Mash 0.9",r}}))}));var ee=pc(((E,O)=>{(function(R,z){typeof E=="object"&&typeof O<"u"?z(E):typeof define=="function"&&define.amd?define(["exports"],z):z((R=typeof globalThis<"u"?globalThis:R||self).SVDJS={})})(E,(function(E){E.SVD=function(E,O,R,z,V){if(O=O===void 0||O,R=R===void 0||R,V=1e-64/(z=z||Math.pow(2,-52)),!E)throw new TypeError("Matrix a is not defined");var j,Y,ee,se,he,ce,ue,fe,ve,we,Se,_e,Ae=E[0].length,Ce=E.length;if(Ce<Ae)throw new TypeError("Invalid matrix: m < n");for(var Te=[],Ie=[],Fe=[],Ue=O==="f"?Ce:Ae,Ge=we=ue=0;Ge<Ce;Ge++)Ie[Ge]=new Array(Ue).fill(0);for(Ge=0;Ge<Ae;Ge++)Fe[Ge]=new Array(Ae).fill(0);var qe,Xe=new Array(Ae).fill(0);for(Ge=0;Ge<Ce;Ge++)for(j=0;j<Ae;j++)Ie[Ge][j]=E[Ge][j];for(Ge=0;Ge<Ae;Ge++){for(Te[Ge]=ue,ve=0,ee=Ge+1,j=Ge;j<Ce;j++)ve+=Math.pow(Ie[j][Ge],2);if(ve<V)ue=0;else for(fe=(ce=Ie[Ge][Ge])*(ue=ce<0?Math.sqrt(ve):-Math.sqrt(ve))-ve,Ie[Ge][Ge]=ce-ue,j=ee;j<Ae;j++){for(ve=0,Y=Ge;Y<Ce;Y++)ve+=Ie[Y][Ge]*Ie[Y][j];for(ce=ve/fe,Y=Ge;Y<Ce;Y++)Ie[Y][j]=Ie[Y][j]+ce*Ie[Y][Ge]}for(Xe[Ge]=ue,ve=0,j=ee;j<Ae;j++)ve+=Math.pow(Ie[Ge][j],2);if(ve<V)ue=0;else{for(fe=(ce=Ie[Ge][Ge+1])*(ue=ce<0?Math.sqrt(ve):-Math.sqrt(ve))-ve,Ie[Ge][Ge+1]=ce-ue,j=ee;j<Ae;j++)Te[j]=Ie[Ge][j]/fe;for(j=ee;j<Ce;j++){for(ve=0,Y=ee;Y<Ae;Y++)ve+=Ie[j][Y]*Ie[Ge][Y];for(Y=ee;Y<Ae;Y++)Ie[j][Y]=Ie[j][Y]+ve*Te[Y]}}we<(Se=Math.abs(Xe[Ge])+Math.abs(Te[Ge]))&&(we=Se)}if(R)for(Ge=Ae-1;0<=Ge;Ge--){if(ue!==0){for(fe=Ie[Ge][Ge+1]*ue,j=ee;j<Ae;j++)Fe[j][Ge]=Ie[Ge][j]/fe;for(j=ee;j<Ae;j++){for(ve=0,Y=ee;Y<Ae;Y++)ve+=Ie[Ge][Y]*Fe[Y][j];for(Y=ee;Y<Ae;Y++)Fe[Y][j]=Fe[Y][j]+ve*Fe[Y][Ge]}}for(j=ee;j<Ae;j++)Fe[Ge][j]=0,Fe[j][Ge]=0;Fe[Ge][Ge]=1,ue=Te[Ge],ee=Ge}if(O){if(O==="f")for(Ge=Ae;Ge<Ce;Ge++){for(j=Ae;j<Ce;j++)Ie[Ge][j]=0;Ie[Ge][Ge]=1}for(Ge=Ae-1;0<=Ge;Ge--){for(ee=Ge+1,ue=Xe[Ge],j=ee;j<Ue;j++)Ie[Ge][j]=0;if(ue!==0){for(fe=Ie[Ge][Ge]*ue,j=ee;j<Ue;j++){for(ve=0,Y=ee;Y<Ce;Y++)ve+=Ie[Y][Ge]*Ie[Y][j];for(ce=ve/fe,Y=Ge;Y<Ce;Y++)Ie[Y][j]=Ie[Y][j]+ce*Ie[Y][Ge]}for(j=Ge;j<Ce;j++)Ie[j][Ge]=Ie[j][Ge]/ue}else for(j=Ge;j<Ce;j++)Ie[j][Ge]=0;Ie[Ge][Ge]=Ie[Ge][Ge]+1}}for(z*=we,Y=Ae-1;0<=Y;Y--)for(var Qe=0;Qe<50;Qe++){for(qe=!1,ee=Y;0<=ee;ee--){if(Math.abs(Te[ee])<=z){qe=!0;break}if(Math.abs(Xe[ee-1])<=z)break}if(!qe)for(he=0,se=ee-(ve=1),Ge=ee;Ge<Y+1&&(ce=ve*Te[Ge],Te[Ge]=he*Te[Ge],!(Math.abs(ce)<=z));Ge++)if(ue=Xe[Ge],Xe[Ge]=Math.sqrt(ce*ce+ue*ue),he=ue/(fe=Xe[Ge]),ve=-ce/fe,O)for(j=0;j<Ce;j++)Se=Ie[j][se],_e=Ie[j][Ge],Ie[j][se]=Se*he+_e*ve,Ie[j][Ge]=-Se*ve+_e*he;if(_e=Xe[Y],ee===Y){if(_e<0&&(Xe[Y]=-_e,R))for(j=0;j<Ae;j++)Fe[j][Y]=-Fe[j][Y];break}for(we=Xe[ee],ce=(((Se=Xe[Y-1])-_e)*(Se+_e)+((ue=Te[Y-1])-(fe=Te[Y]))*(ue+fe))/(2*fe*Se),ue=Math.sqrt(ce*ce+1),ce=((we-_e)*(we+_e)+fe*(Se/(ce<0?ce-ue:ce+ue)-fe))/we,Ge=ee+(ve=he=1);Ge<Y+1;Ge++){if(ue=Te[Ge],Se=Xe[Ge],fe=ve*ue,ue*=he,_e=Math.sqrt(ce*ce+fe*fe),ce=we*(he=ce/(Te[Ge-1]=_e))+ue*(ve=fe/_e),ue=-we*ve+ue*he,fe=Se*ve,Se*=he,R)for(j=0;j<Ae;j++)we=Fe[j][Ge-1],_e=Fe[j][Ge],Fe[j][Ge-1]=we*he+_e*ve,Fe[j][Ge]=-we*ve+_e*he;if(_e=Math.sqrt(ce*ce+fe*fe),ce=(he=ce/(Xe[Ge-1]=_e))*ue+(ve=fe/_e)*Se,we=-ve*ue+he*Se,O)for(j=0;j<Ce;j++)Se=Ie[j][Ge-1],_e=Ie[j][Ge],Ie[j][Ge-1]=Se*he+_e*ve,Ie[j][Ge]=-Se*ve+_e*he}Te[ee]=0,Te[Y]=ce,Xe[Y]=we}for(Ge=0;Ge<Ae;Ge++)Xe[Ge]<z&&(Xe[Ge]=0);return{u:Ie,q:Xe,v:Fe}},E.VERSION="1.1.1",Object.defineProperty(E,"__esModule",{value:!0})}))}));var se=pc(((E,O)=>{Object.defineProperty(E,"__esModule",{value:!0});E.default=yY;function yY(E){if(E===null||E===!0||E===!1)return NaN;var O=Number(E);return isNaN(O)?O:O<0?Math.ceil(O):Math.floor(O)}O.exports=E.default}));var he=pc(((E,O)=>{Object.defineProperty(E,"__esModule",{value:!0});E.default=vY;function vY(E){var O=new Date(Date.UTC(E.getFullYear(),E.getMonth(),E.getDate(),E.getHours(),E.getMinutes(),E.getSeconds(),E.getMilliseconds()));return O.setUTCFullYear(E.getFullYear()),E.getTime()-O.getTime()}O.exports=E.default}));var ce=pc(((E,O)=>{function dZ(E,O){function e(){this.constructor=E}e.prototype=O.prototype,E.prototype=new e}function lu(E,O,R,z){this.message=E,this.expected=O,this.found=R,this.location=z,this.name="SyntaxError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,lu)}dZ(lu,Error);lu.buildMessage=function(E,O){var R={literal:function(E){return'"'+i(E.text)+'"'},class:function(E){var O,R="";for(O=0;O<E.parts.length;O++)R+=E.parts[O]instanceof Array?s(E.parts[O][0])+"-"+s(E.parts[O][1]):s(E.parts[O]);return"["+(E.inverted?"^":"")+R+"]"},any:function(E){return"any character"},end:function(E){return"end of input"},other:function(E){return E.description}};function r(E){return E.charCodeAt(0).toString(16).toUpperCase()}function i(E){return E.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(E){return"\\x0"+r(E)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(E){return"\\x"+r(E)}))}function s(E){return E.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(E){return"\\x0"+r(E)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(E){return"\\x"+r(E)}))}function o(E){return R[E.type](E)}function a(E){var O,R,z=new Array(E.length);for(O=0;O<E.length;O++)z[O]=o(E[O]);if(z.sort(),z.length>0){for(O=1,R=1;O<z.length;O++)z[O-1]!==z[O]&&(z[R]=z[O],R++);z.length=R}switch(z.length){case 1:return z[0];case 2:return z[0]+" or "+z[1];default:return z.slice(0,-1).join(", ")+", or "+z[z.length-1]}}function l(E){return E?'"'+i(E)+'"':"end of input"}return"Expected "+a(E)+" but "+l(O)+" found."};function fZ(E,O){O=O!==void 0?O:{};var R,z={},V={svg_path:He},j=He,s=function(E){if(!E)return[];for(var O=[],R=0;R<E.length;R++)O=O.concat.apply(O,E[R]);var z=O[0];return z&&z.code=="m"&&(delete z.relative,z.code="M"),O},o=function(E,O){return Ei(E,O)},Y=/^[Mm]/,ee=Be(["M","m"],!1,!1),c=function(E,O,R){var z=di(E,[O]);return R&&(z=z.concat(di(E=="M"?"L":"l",R[1]))),z},se=/^[Zz]/,he=Be(["Z","z"],!1,!1),d=function(){return di("Z")},ce=/^[Ll]/,ue=Be(["L","l"],!1,!1),m=function(E,O){return di(E,O)},fe=/^[Hh]/,ve=Be(["H","h"],!1,!1),x=function(E,O){return di(E,O.map((function(E){return{x:E}})))},we=/^[Vv]/,Se=Be(["V","v"],!1,!1),w=function(E,O){return di(E,O.map((function(E){return{y:E}})))},_e=/^[Cc]/,Ae=Be(["C","c"],!1,!1),b=function(E,O,R){return{x1:E.x,y1:E.y,x2:O.x,y2:O.y,x:R.x,y:R.y}},Ce=/^[Ss]/,Te=Be(["S","s"],!1,!1),P=function(E,O){return{x2:E.x,y2:E.y,x:O.x,y:O.y}},Ie=/^[Qq]/,Fe=Be(["Q","q"],!1,!1),D=function(E,O){return{x1:E.x,y1:E.y,x:O.x,y:O.y}},Ue=/^[Tt]/,Ge=Be(["T","t"],!1,!1),qe=/^[Aa]/,Xe=Be(["A","a"],!1,!1),q=function(E,O,R,z,V,j){return{rx:E,ry:O,xAxisRotation:R,largeArc:z,sweep:V,x:j.x,y:j.y}},X=function(E,O){return{x:E,y:O}},Z=function(E){return E*1},G=function(E){return E.join("")*1},Qe=/^[01]/,Ze=Be(["0","1"],!1,!1),$=function(E){return E=="1"},W=function(){return""},Ke=",",Je=je(",",!1),re=function(E){return E.join("")},$e=".",et=je(".",!1),it=/^[eE]/,rt=Be(["e","E"],!1,!1),at=/^[+\-]/,lt=Be(["+","-"],!1,!1),ct=/^[0-9]/,dt=Be([["0","9"]],!1,!1),Ve=function(E){return E.join("")},ut=/^[ \t\n\r]/,pt=Be([" ","\t","\n","\r"],!1,!1),mt=0,gt=[{line:1,column:1}],yt=0,St=[],_t=0;if("startRule"in O){if(!(O.startRule in V))throw new Error("Can't start parsing from rule \""+O.startRule+'".');j=V[O.startRule]}function je(E,O){return{type:"literal",text:E,ignoreCase:O}}function Be(E,O,R){return{type:"class",parts:E,inverted:O,ignoreCase:R}}function ot(){return{type:"end"}}function fr(O){var R,z=gt[O];if(z)return z;for(R=O-1;!gt[R];)R--;for(z=gt[R],z={line:z.line,column:z.column};R<O;)E.charCodeAt(R)===10?(z.line++,z.column=1):z.column++,R++;return gt[O]=z,z}function Cr(E,O){var R=fr(E),z=fr(O);return{start:{offset:E,line:R.line,column:R.column},end:{offset:O,line:z.line,column:z.column}}}function K(E){mt<yt||(mt>yt&&(yt=mt,St=[]),St.push(E))}function Me(E,O,R){return new lu(lu.buildMessage(E,O),E,O,R)}function He(){var E,O,R,V,j;for(E=mt,O=[],R=Pt();R!==z;)O.push(R),R=Pt();if(O!==z)if(R=We(),R===z&&(R=null),R!==z){for(V=[],j=Pt();j!==z;)V.push(j),j=Pt();V!==z?(O=s(R),E=O):(mt=E,E=z)}else mt=E,E=z;else mt=E,E=z;return E}function We(){var E,O,R,V,j,Y;if(E=mt,O=Dt(),O!==z){for(R=[],V=mt,j=[],Y=Pt();Y!==z;)j.push(Y),Y=Pt();for(j!==z?(Y=Dt(),Y!==z?(j=[j,Y],V=j):(mt=V,V=z)):(mt=V,V=z);V!==z;){for(R.push(V),V=mt,j=[],Y=Pt();Y!==z;)j.push(Y),Y=Pt();j!==z?(Y=Dt(),Y!==z?(j=[j,Y],V=j):(mt=V,V=z)):(mt=V,V=z)}R!==z?(O=o(O,R),E=O):(mt=E,E=z)}else mt=E,E=z;return E}function Dt(){var E,O,R,V,j,Y;if(E=mt,O=kr(),O!==z){for(R=[],V=mt,j=[],Y=Pt();Y!==z;)j.push(Y),Y=Pt();for(j!==z?(Y=zr(),Y!==z?(j=[j,Y],V=j):(mt=V,V=z)):(mt=V,V=z);V!==z;){for(R.push(V),V=mt,j=[],Y=Pt();Y!==z;)j.push(Y),Y=Pt();j!==z?(Y=zr(),Y!==z?(j=[j,Y],V=j):(mt=V,V=z)):(mt=V,V=z)}R!==z?(O=o(O,R),E=O):(mt=E,E=z)}else mt=E,E=z;return E}function zr(){var E;return E=na(),E===z&&(E=Pr(),E===z&&(E=Pn(),E===z&&(E=v1(),E===z&&(E=x1(),E===z&&(E=le(),E===z&&(E=be(),E===z&&(E=bt(),E===z&&(E=kt())))))))),E}function kr(){var O,R,V,j,se,he,ce;if(O=mt,Y.test(E.charAt(mt))?(R=E.charAt(mt),mt++):(R=z,_t===0&&K(ee)),R!==z){for(V=[],j=Pt();j!==z;)V.push(j),j=Pt();V!==z?(j=Rt(),j!==z?(se=mt,he=vt(),he===z&&(he=null),he!==z?(ce=rs(),ce!==z?(he=[he,ce],se=he):(mt=se,se=z)):(mt=se,se=z),se===z&&(se=null),se!==z?(R=c(R,j,se),O=R):(mt=O,O=z)):(mt=O,O=z)):(mt=O,O=z)}else mt=O,O=z;return O}function na(){var O,R;return O=mt,se.test(E.charAt(mt))?(R=E.charAt(mt),mt++):(R=z,_t===0&&K(he)),R!==z&&(R=d()),O=R,O}function Pr(){var O,R,V,j;if(O=mt,ce.test(E.charAt(mt))?(R=E.charAt(mt),mt++):(R=z,_t===0&&K(ue)),R!==z){for(V=[],j=Pt();j!==z;)V.push(j),j=Pt();V!==z?(j=rs(),j!==z?(R=m(R,j),O=R):(mt=O,O=z)):(mt=O,O=z)}else mt=O,O=z;return O}function rs(){var E,O,R,V,j,Y;if(E=mt,O=Rt(),O!==z){for(R=[],V=mt,j=vt(),j===z&&(j=null),j!==z?(Y=Rt(),Y!==z?(j=[j,Y],V=j):(mt=V,V=z)):(mt=V,V=z);V!==z;)R.push(V),V=mt,j=vt(),j===z&&(j=null),j!==z?(Y=Rt(),Y!==z?(j=[j,Y],V=j):(mt=V,V=z)):(mt=V,V=z);R!==z?(O=o(O,R),E=O):(mt=E,E=z)}else mt=E,E=z;return E}function Pn(){var O,R,V,j;if(O=mt,fe.test(E.charAt(mt))?(R=E.charAt(mt),mt++):(R=z,_t===0&&K(ve)),R!==z){for(V=[],j=Pt();j!==z;)V.push(j),j=Pt();V!==z?(j=Jf(),j!==z?(R=x(R,j),O=R):(mt=O,O=z)):(mt=O,O=z)}else mt=O,O=z;return O}function Jf(){var E,O,R,V,j,Y;if(E=mt,O=nn(),O!==z){for(R=[],V=mt,j=vt(),j===z&&(j=null),j!==z?(Y=nn(),Y!==z?(j=[j,Y],V=j):(mt=V,V=z)):(mt=V,V=z);V!==z;)R.push(V),V=mt,j=vt(),j===z&&(j=null),j!==z?(Y=nn(),Y!==z?(j=[j,Y],V=j):(mt=V,V=z)):(mt=V,V=z);R!==z?(O=o(O,R),E=O):(mt=E,E=z)}else mt=E,E=z;return E}function v1(){var O,R,V,j;if(O=mt,we.test(E.charAt(mt))?(R=E.charAt(mt),mt++):(R=z,_t===0&&K(Se)),R!==z){for(V=[],j=Pt();j!==z;)V.push(j),j=Pt();V!==z?(j=Jf(),j!==z?(R=w(R,j),O=R):(mt=O,O=z)):(mt=O,O=z)}else mt=O,O=z;return O}function x1(){var O,R,V,j;if(O=mt,_e.test(E.charAt(mt))?(R=E.charAt(mt),mt++):(R=z,_t===0&&K(Ae)),R!==z){for(V=[],j=Pt();j!==z;)V.push(j),j=Pt();V!==z?(j=b1(),j!==z?(R=m(R,j),O=R):(mt=O,O=z)):(mt=O,O=z)}else mt=O,O=z;return O}function b1(){var E,O,R,V,j,Y;if(E=mt,O=k(),O!==z){for(R=[],V=mt,j=vt(),j===z&&(j=null),j!==z?(Y=k(),Y!==z?(j=[j,Y],V=j):(mt=V,V=z)):(mt=V,V=z);V!==z;)R.push(V),V=mt,j=vt(),j===z&&(j=null),j!==z?(Y=k(),Y!==z?(j=[j,Y],V=j):(mt=V,V=z)):(mt=V,V=z);R!==z?(O=o(O,R),E=O):(mt=E,E=z)}else mt=E,E=z;return E}function k(){var E,O,R,V,j,Y;return E=mt,O=Rt(),O!==z?(R=vt(),R===z&&(R=null),R!==z?(V=Rt(),V!==z?(j=vt(),j===z&&(j=null),j!==z?(Y=Rt(),Y!==z?(O=b(O,V,Y),E=O):(mt=E,E=z)):(mt=E,E=z)):(mt=E,E=z)):(mt=E,E=z)):(mt=E,E=z),E}function le(){var O,R,V,j;if(O=mt,Ce.test(E.charAt(mt))?(R=E.charAt(mt),mt++):(R=z,_t===0&&K(Te)),R!==z){for(V=[],j=Pt();j!==z;)V.push(j),j=Pt();V!==z?(j=ge(),j!==z?(R=m(R,j),O=R):(mt=O,O=z)):(mt=O,O=z)}else mt=O,O=z;return O}function ge(){var E,O,R,V,j,Y;if(E=mt,O=ne(),O!==z){for(R=[],V=mt,j=vt(),j===z&&(j=null),j!==z?(Y=ne(),Y!==z?(j=[j,Y],V=j):(mt=V,V=z)):(mt=V,V=z);V!==z;)R.push(V),V=mt,j=vt(),j===z&&(j=null),j!==z?(Y=ne(),Y!==z?(j=[j,Y],V=j):(mt=V,V=z)):(mt=V,V=z);R!==z?(O=o(O,R),E=O):(mt=E,E=z)}else mt=E,E=z;return E}function ne(){var E,O,R,V;return E=mt,O=Rt(),O!==z?(R=vt(),R===z&&(R=null),R!==z?(V=Rt(),V!==z?(O=P(O,V),E=O):(mt=E,E=z)):(mt=E,E=z)):(mt=E,E=z),E}function be(){var O,R,V,j;if(O=mt,Ie.test(E.charAt(mt))?(R=E.charAt(mt),mt++):(R=z,_t===0&&K(Fe)),R!==z){for(V=[],j=Pt();j!==z;)V.push(j),j=Pt();V!==z?(j=st(),j!==z?(R=m(R,j),O=R):(mt=O,O=z)):(mt=O,O=z)}else mt=O,O=z;return O}function st(){var E,O,R,V,j,Y;if(E=mt,O=ft(),O!==z){for(R=[],V=mt,j=vt(),j===z&&(j=null),j!==z?(Y=ft(),Y!==z?(j=[j,Y],V=j):(mt=V,V=z)):(mt=V,V=z);V!==z;)R.push(V),V=mt,j=vt(),j===z&&(j=null),j!==z?(Y=ft(),Y!==z?(j=[j,Y],V=j):(mt=V,V=z)):(mt=V,V=z);R!==z?(O=o(O,R),E=O):(mt=E,E=z)}else mt=E,E=z;return E}function ft(){var E,O,R,V;return E=mt,O=Rt(),O!==z?(R=vt(),R===z&&(R=null),R!==z?(V=Rt(),V!==z?(O=D(O,V),E=O):(mt=E,E=z)):(mt=E,E=z)):(mt=E,E=z),E}function bt(){var O,R,V,j;if(O=mt,Ue.test(E.charAt(mt))?(R=E.charAt(mt),mt++):(R=z,_t===0&&K(Ge)),R!==z){for(V=[],j=Pt();j!==z;)V.push(j),j=Pt();V!==z?(j=wt(),j!==z?(R=m(R,j),O=R):(mt=O,O=z)):(mt=O,O=z)}else mt=O,O=z;return O}function wt(){var E,O,R,V,j,Y;if(E=mt,O=Rt(),O!==z){for(R=[],V=mt,j=vt(),j===z&&(j=null),j!==z?(Y=Rt(),Y!==z?(j=[j,Y],V=j):(mt=V,V=z)):(mt=V,V=z);V!==z;)R.push(V),V=mt,j=vt(),j===z&&(j=null),j!==z?(Y=Rt(),Y!==z?(j=[j,Y],V=j):(mt=V,V=z)):(mt=V,V=z);R!==z?(O=o(O,R),E=O):(mt=E,E=z)}else mt=E,E=z;return E}function kt(){var O,R,V,j;if(O=mt,qe.test(E.charAt(mt))?(R=E.charAt(mt),mt++):(R=z,_t===0&&K(Xe)),R!==z){for(V=[],j=Pt();j!==z;)V.push(j),j=Pt();V!==z?(j=Ot(),j!==z?(R=m(R,j),O=R):(mt=O,O=z)):(mt=O,O=z)}else mt=O,O=z;return O}function Ot(){var E,O,R,V,j,Y;if(E=mt,O=At(),O!==z){for(R=[],V=mt,j=vt(),j===z&&(j=null),j!==z?(Y=At(),Y!==z?(j=[j,Y],V=j):(mt=V,V=z)):(mt=V,V=z);V!==z;)R.push(V),V=mt,j=vt(),j===z&&(j=null),j!==z?(Y=At(),Y!==z?(j=[j,Y],V=j):(mt=V,V=z)):(mt=V,V=z);R!==z?(O=o(O,R),E=O):(mt=E,E=z)}else mt=E,E=z;return E}function At(){var E,O,R,V,j,Y,ee,se,he,ce,ue,fe;return E=mt,O=Ai(),O!==z?(R=vt(),R===z&&(R=null),R!==z?(V=Ai(),V!==z?(j=vt(),j===z&&(j=null),j!==z?(Y=nn(),Y!==z?(ee=vt(),ee!==z?(se=uo(),se!==z?(he=vt(),he===z&&(he=null),he!==z?(ce=uo(),ce!==z?(ue=vt(),ue===z&&(ue=null),ue!==z?(fe=Rt(),fe!==z?(O=q(O,V,Y,se,ce,fe),E=O):(mt=E,E=z)):(mt=E,E=z)):(mt=E,E=z)):(mt=E,E=z)):(mt=E,E=z)):(mt=E,E=z)):(mt=E,E=z)):(mt=E,E=z)):(mt=E,E=z)):(mt=E,E=z)):(mt=E,E=z),E}function Rt(){var E,O,R,V;return E=mt,O=nn(),O!==z?(R=vt(),R===z&&(R=null),R!==z?(V=nn(),V!==z?(O=X(O,V),E=O):(mt=E,E=z)):(mt=E,E=z)):(mt=E,E=z),E}function Ai(){var E,O;return E=mt,O=yu(),O===z&&(O=jn()),O!==z&&(O=Z(O)),E=O,E}function nn(){var E,O,R,V;return E=mt,O=mt,R=vu(),R===z&&(R=null),R!==z?(V=yu(),V!==z?(R=[R,V],O=R):(mt=O,O=z)):(mt=O,O=z),O===z&&(O=mt,R=vu(),R===z&&(R=null),R!==z?(V=jn(),V!==z?(R=[R,V],O=R):(mt=O,O=z)):(mt=O,O=z)),O!==z&&(O=G(O)),E=O,E}function uo(){var O,R;return O=mt,Qe.test(E.charAt(mt))?(R=E.charAt(mt),mt++):(R=z,_t===0&&K(Ze)),R!==z&&(R=$(R)),O=R,O}function vt(){var E,O,R,V,j;if(E=mt,O=[],R=Pt(),R!==z)for(;R!==z;)O.push(R),R=Pt();else O=z;if(O!==z)if(R=Nt(),R===z&&(R=null),R!==z){for(V=[],j=Pt();j!==z;)V.push(j),j=Pt();V!==z?(O=[O,R,V],E=O):(mt=E,E=z)}else mt=E,E=z;else mt=E,E=z;if(E===z){if(E=mt,O=mt,R=Nt(),R!==z){for(V=[],j=Pt();j!==z;)V.push(j),j=Pt();V!==z?(R=[R,V],O=R):(mt=O,O=z)}else mt=O,O=z;O!==z&&(O=W()),E=O}return E}function Nt(){var O;return E.charCodeAt(mt)===44?(O=Ke,mt++):(O=z,_t===0&&K(Je)),O}function yu(){var E,O,R,V;return E=mt,O=mt,R=hi(),R!==z?(V=ho(),V===z&&(V=null),V!==z?(R=[R,V],O=R):(mt=O,O=z)):(mt=O,O=z),O===z&&(O=mt,R=jn(),R!==z?(V=ho(),V!==z?(R=[R,V],O=R):(mt=O,O=z)):(mt=O,O=z)),O!==z&&(O=re(O)),E=O,E}function hi(){var O,R,V,j,Y;return O=mt,R=mt,V=jn(),V===z&&(V=null),V!==z?(E.charCodeAt(mt)===46?(j=$e,mt++):(j=z,_t===0&&K(et)),j!==z?(Y=jn(),Y!==z?(V=[V,j,Y],R=V):(mt=R,R=z)):(mt=R,R=z)):(mt=R,R=z),R===z&&(R=mt,V=jn(),V!==z?(E.charCodeAt(mt)===46?(j=$e,mt++):(j=z,_t===0&&K(et)),j!==z?(V=[V,j],R=V):(mt=R,R=z)):(mt=R,R=z)),R!==z&&(R=re(R)),O=R,O}function ho(){var O,R,V,j,Y;return O=mt,R=mt,it.test(E.charAt(mt))?(V=E.charAt(mt),mt++):(V=z,_t===0&&K(rt)),V!==z?(j=vu(),j===z&&(j=null),j!==z?(Y=jn(),Y!==z?(V=[V,j,Y],R=V):(mt=R,R=z)):(mt=R,R=z)):(mt=R,R=z),R!==z&&(R=re(R)),O=R,O}function vu(){var O;return at.test(E.charAt(mt))?(O=E.charAt(mt),mt++):(O=z,_t===0&&K(lt)),O}function jn(){var O,R,V;if(O=mt,R=[],ct.test(E.charAt(mt))?(V=E.charAt(mt),mt++):(V=z,_t===0&&K(dt)),V!==z)for(;V!==z;)R.push(V),ct.test(E.charAt(mt))?(V=E.charAt(mt),mt++):(V=z,_t===0&&K(dt));else R=z;return R!==z&&(R=Ve(R)),O=R,O}function Pt(){var O,R;return O=mt,ut.test(E.charAt(mt))?(R=E.charAt(mt),mt++):(R=z,_t===0&&K(pt)),R!==z&&(R=W()),O=R,O}function Ei(E,O){if(!O)return[E];for(var R=[E],z=0,V=O.length;z<V;z++)R[z+1]=O[z][1];return R}var Mt={m:"moveto",l:"lineto",h:"horizontal lineto",v:"vertical lineto",c:"curveto",s:"smooth curveto",q:"quadratic curveto",t:"smooth quadratic curveto",a:"elliptical arc",z:"closepath"};for(var Et in Mt)Mt[Et.toUpperCase()]=Mt[Et];function di(E,O){O||(O=[{}]);for(var R=O.length;R--;){var z={code:E,command:Mt[E]};E==E.toLowerCase()&&(z.relative=!0);for(var V in O[R])z[V]=O[R][V];O[R]=z}return O}if(R=j(),R!==z&&mt===E.length)return R;throw R!==z&&mt<E.length&&K(ot()),Me(St,yt<E.length?E.charAt(yt):null,yt<E.length?Cr(yt,yt+1):Cr(yt,yt))}O.exports={SyntaxError:lu,parse:fZ}}));var ue=pc(((E,O)=>{var R=ce().parse;R.parseSVG=R;R.makeAbsolute=pZ;O.exports=R;function pZ(E){var O,R={x:0,y:0},z={x:"x0",y:"y0",x1:"x0",y1:"y0",x2:"x0",y2:"y0"};return E.forEach((function(E){E.command==="moveto"&&(O=E),E.x0=R.x,E.y0=R.y;for(var V in z)V in E&&(E[V]+=E.relative?E[z[V]]:0);"x"in E||(E.x=R.x),"y"in E||(E.y=R.y),E.relative=!1,E.code=E.code.toUpperCase(),E.command=="closepath"&&(E.x=O.x,E.y=O.y),R=E})),E}}));var fe=pc(((E,O)=>{O.exports=function(E,O){for(var R=E.split("."),z=O.split("."),V=0;V<3;V++){var j=Number(R[V]),Y=Number(z[V]);if(j>Y)return 1;if(Y>j)return-1;if(!isNaN(j)&&isNaN(Y))return 1;if(isNaN(j)&&!isNaN(Y))return-1}return 0}}));var ve="149";var we={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},Se=0,_e=1,Ae=2;var Ce=1,Te=2,Ie=3,Fe=0,Ue=1,Ge=2;var qe=0,Xe=1,Qe=2,Ze=3,Ke=4,Je=5,$e=100,et=101,it=102,rt=103,at=104,lt=200,ct=201,dt=202,ut=203,pt=204,mt=205,gt=206,yt=207,St=208,_t=209,Mt=210,Et=0,Tt=1,It=2,Lt=3,Bt=4,Ft=5,Ut=6,jt=7,Gt=0,Wt=1,qt=2,Xt=0,Qt=1,Zt=2,Kt=3,Jt=4,$t=5,ti=300,ii=301,ri=302,ni=303,si=304,ai=306,oi=1e3,ui=1001,fi=1002,mi=1003,gi=1004;var vi=1005;var yi=1006,xi=1007;var bi=1008;var wi=1009,Si=1010,_i=1011,Ti=1012,Pi=1013,Di=1014,Ii=1015,Oi=1016,Li=1017,Bi=1018,zi=1020,Fi=1021,Ni=1023,Ui=1024,ki=1025,Vi=1026,ji=1027,Gi=1028,Wi=1029,qi=1030,Yi=1031,Qi=1033,Ki=33776,Ji=33777,$i=33778,er=33779,tr=35840,ir=35841,rr=35842,nr=35843,sr=36196,ar=37492,or=37496,lr=37808,hr=37809,cr=37810,ur=37811,pr=37812,mr=37813,gr=37814,vr=37815,yr=37816,xr=37817,br=37818,wr=37819,_r=37820,Ar=37821,Mr=36492,Er=36283,Tr=36284,Dr=36285,Ir=36286,Or=2200,Rr=2201,Lr=2202,Br=2300,Fr=2301,Nr=2302,Ur=2400,Vr=2401,Gr=2402,Wr=2500,qr=2501;var Xr=3e3,Yr=3001,Qr=3200,Kr=3201,Jr=0,en=1;var tn="srgb",rn="srgb-linear";var sn=7680;var an=519,on=35044,ln=35048;var cn="300 es",dn=1035,pn=class{addEventListener(E,O){this._listeners===void 0&&(this._listeners={});let R=this._listeners;R[E]===void 0&&(R[E]=[]),R[E].indexOf(O)===-1&&R[E].push(O)}hasEventListener(E,O){if(this._listeners===void 0)return!1;let R=this._listeners;return R[E]!==void 0&&R[E].indexOf(O)!==-1}removeEventListener(E,O){if(this._listeners===void 0)return;let R=this._listeners[E];if(R!==void 0){let E=R.indexOf(O);E!==-1&&R.splice(E,1)}}dispatchEvent(E){if(this._listeners===void 0)return;let O=this._listeners[E.type];if(O!==void 0){E.target=this;let R=O.slice(0);for(let O=0,z=R.length;O<z;O++)R[O].call(this,E);E.target=null}}},fn=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"],gn=1234567,vn=Math.PI/180,yn=180/Math.PI;function ss(){let E=Math.random()*4294967295|0,O=Math.random()*4294967295|0,R=Math.random()*4294967295|0,z=Math.random()*4294967295|0;return(fn[E&255]+fn[E>>8&255]+fn[E>>16&255]+fn[E>>24&255]+"-"+fn[O&255]+fn[O>>8&255]+"-"+fn[O>>16&15|64]+fn[O>>24&255]+"-"+fn[R&63|128]+fn[R>>8&255]+"-"+fn[R>>16&255]+fn[R>>24&255]+fn[z&255]+fn[z>>8&255]+fn[z>>16&255]+fn[z>>24&255]).toLowerCase()}function pi(E,O,R){return Math.max(O,Math.min(R,E))}function YS(E,O){return(E%O+O)%O}function IV(E,O,R,z,V){return z+(E-O)*(V-z)/(R-O)}function DV(E,O,R){return E!==O?(R-E)/(O-E):0}function hp(E,O,R){return(1-R)*E+R*O}function OV(E,O,R,z){return hp(E,O,1-Math.exp(-R*z))}function RV(E,O=1){return O-Math.abs(YS(E,O*2)-O)}function LV(E,O,R){return E<=O?0:E>=R?1:(E=(E-O)/(R-O),E*E*(3-2*E))}function BV(E,O,R){return E<=O?0:E>=R?1:(E=(E-O)/(R-O),E*E*E*(E*(E*6-15)+10))}function NV(E,O){return E+Math.floor(Math.random()*(O-E+1))}function FV(E,O){return E+Math.random()*(O-E)}function VV(E){return E*(.5-Math.random())}function UV(E){E!==void 0&&(gn=E);let O=gn+=1831565813;return O=Math.imul(O^O>>>15,O|1),O^=O+Math.imul(O^O>>>7,O|61),((O^O>>>14)>>>0)/4294967296}function zV(E){return E*vn}function kV(E){return E*yn}function fS(E){return(E&E-1)===0&&E!==0}function vP(E){return Math.pow(2,Math.ceil(Math.log(E)/Math.LN2))}function dy(E){return Math.pow(2,Math.floor(Math.log(E)/Math.LN2))}function GV(E,O,R,z,V){let j=Math.cos,Y=Math.sin,ee=j(R/2),se=Y(R/2),he=j((O+z)/2),ce=Y((O+z)/2),ue=j((O-z)/2),fe=Y((O-z)/2),ve=j((z-O)/2),we=Y((z-O)/2);switch(V){case"XYX":E.set(ee*ce,se*ue,se*fe,ee*he);break;case"YZY":E.set(se*fe,ee*ce,se*ue,ee*he);break;case"ZXZ":E.set(se*ue,se*fe,ee*ce,ee*he);break;case"XZX":E.set(ee*ce,se*we,se*ve,ee*he);break;case"YXY":E.set(se*ve,ee*ce,se*we,ee*he);break;case"ZYZ":E.set(se*we,se*ve,ee*ce,ee*he);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+V)}}function da(E,O){switch(O.constructor){case Float32Array:return E;case Uint16Array:return E/65535;case Uint8Array:return E/255;case Int16Array:return Math.max(E/32767,-1);case Int8Array:return Math.max(E/127,-1);default:throw new Error("Invalid component type.")}}function Sr(E,O){switch(O.constructor){case Float32Array:return E;case Uint16Array:return Math.round(E*65535);case Uint8Array:return Math.round(E*255);case Int16Array:return Math.round(E*32767);case Int8Array:return Math.round(E*127);default:throw new Error("Invalid component type.")}}var xn=Object.freeze({__proto__:null,DEG2RAD:vn,RAD2DEG:yn,ceilPowerOfTwo:vP,clamp:pi,damp:OV,degToRad:zV,denormalize:da,euclideanModulo:YS,floorPowerOfTwo:dy,generateUUID:ss,inverseLerp:DV,isPowerOfTwo:fS,lerp:hp,mapLinear:IV,normalize:Sr,pingpong:RV,radToDeg:kV,randFloat:FV,randFloatSpread:VV,randInt:NV,seededRandom:UV,setQuaternionFromProperEuler:GV,smootherstep:BV,smoothstep:LV}),bn=class{constructor(E=0,O=0){bn.prototype.isVector2=!0,this.x=E,this.y=O}get width(){return this.x}set width(E){this.x=E}get height(){return this.y}set height(E){this.y=E}set(E,O){return this.x=E,this.y=O,this}setScalar(E){return this.x=E,this.y=E,this}setX(E){return this.x=E,this}setY(E){return this.y=E,this}setComponent(E,O){switch(E){case 0:this.x=O;break;case 1:this.y=O;break;default:throw new Error("index is out of range: "+E)}return this}getComponent(E){switch(E){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+E)}}clone(){return new this.constructor(this.x,this.y)}copy(E){return this.x=E.x,this.y=E.y,this}add(E){return this.x+=E.x,this.y+=E.y,this}addScalar(E){return this.x+=E,this.y+=E,this}addVectors(E,O){return this.x=E.x+O.x,this.y=E.y+O.y,this}addScaledVector(E,O){return this.x+=E.x*O,this.y+=E.y*O,this}sub(E){return this.x-=E.x,this.y-=E.y,this}subScalar(E){return this.x-=E,this.y-=E,this}subVectors(E,O){return this.x=E.x-O.x,this.y=E.y-O.y,this}multiply(E){return this.x*=E.x,this.y*=E.y,this}multiplyScalar(E){return this.x*=E,this.y*=E,this}divide(E){return this.x/=E.x,this.y/=E.y,this}divideScalar(E){return this.multiplyScalar(1/E)}applyMatrix3(E){let O=this.x,R=this.y,z=E.elements;return this.x=z[0]*O+z[3]*R+z[6],this.y=z[1]*O+z[4]*R+z[7],this}min(E){return this.x=Math.min(this.x,E.x),this.y=Math.min(this.y,E.y),this}max(E){return this.x=Math.max(this.x,E.x),this.y=Math.max(this.y,E.y),this}clamp(E,O){return this.x=Math.max(E.x,Math.min(O.x,this.x)),this.y=Math.max(E.y,Math.min(O.y,this.y)),this}clampScalar(E,O){return this.x=Math.max(E,Math.min(O,this.x)),this.y=Math.max(E,Math.min(O,this.y)),this}clampLength(E,O){let R=this.length();return this.divideScalar(R||1).multiplyScalar(Math.max(E,Math.min(O,R)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(E){return this.x*E.x+this.y*E.y}cross(E){return this.x*E.y-this.y*E.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(E){return Math.sqrt(this.distanceToSquared(E))}distanceToSquared(E){let O=this.x-E.x,R=this.y-E.y;return O*O+R*R}manhattanDistanceTo(E){return Math.abs(this.x-E.x)+Math.abs(this.y-E.y)}setLength(E){return this.normalize().multiplyScalar(E)}lerp(E,O){return this.x+=(E.x-this.x)*O,this.y+=(E.y-this.y)*O,this}lerpVectors(E,O,R){return this.x=E.x+(O.x-E.x)*R,this.y=E.y+(O.y-E.y)*R,this}equals(E){return E.x===this.x&&E.y===this.y}fromArray(E,O=0){return this.x=E[O],this.y=E[O+1],this}toArray(E=[],O=0){return E[O]=this.x,E[O+1]=this.y,E}fromBufferAttribute(E,O){return this.x=E.getX(O),this.y=E.getY(O),this}rotateAround(E,O){let R=Math.cos(O),z=Math.sin(O),V=this.x-E.x,j=this.y-E.y;return this.x=V*R-j*z+E.x,this.y=V*z+j*R+E.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}},wn=class{constructor(){wn.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1]}set(E,O,R,z,V,j,Y,ee,se){let he=this.elements;return he[0]=E,he[1]=z,he[2]=Y,he[3]=O,he[4]=V,he[5]=ee,he[6]=R,he[7]=j,he[8]=se,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(E){let O=this.elements,R=E.elements;return O[0]=R[0],O[1]=R[1],O[2]=R[2],O[3]=R[3],O[4]=R[4],O[5]=R[5],O[6]=R[6],O[7]=R[7],O[8]=R[8],this}extractBasis(E,O,R){return E.setFromMatrix3Column(this,0),O.setFromMatrix3Column(this,1),R.setFromMatrix3Column(this,2),this}setFromMatrix4(E){let O=E.elements;return this.set(O[0],O[4],O[8],O[1],O[5],O[9],O[2],O[6],O[10]),this}multiply(E){return this.multiplyMatrices(this,E)}premultiply(E){return this.multiplyMatrices(E,this)}multiplyMatrices(E,O){let R=E.elements,z=O.elements,V=this.elements,j=R[0],Y=R[3],ee=R[6],se=R[1],he=R[4],ce=R[7],ue=R[2],fe=R[5],ve=R[8],we=z[0],Se=z[3],_e=z[6],Ae=z[1],Ce=z[4],Te=z[7],Ie=z[2],Fe=z[5],Ue=z[8];return V[0]=j*we+Y*Ae+ee*Ie,V[3]=j*Se+Y*Ce+ee*Fe,V[6]=j*_e+Y*Te+ee*Ue,V[1]=se*we+he*Ae+ce*Ie,V[4]=se*Se+he*Ce+ce*Fe,V[7]=se*_e+he*Te+ce*Ue,V[2]=ue*we+fe*Ae+ve*Ie,V[5]=ue*Se+fe*Ce+ve*Fe,V[8]=ue*_e+fe*Te+ve*Ue,this}multiplyScalar(E){let O=this.elements;return O[0]*=E,O[3]*=E,O[6]*=E,O[1]*=E,O[4]*=E,O[7]*=E,O[2]*=E,O[5]*=E,O[8]*=E,this}determinant(){let E=this.elements,O=E[0],R=E[1],z=E[2],V=E[3],j=E[4],Y=E[5],ee=E[6],se=E[7],he=E[8];return O*j*he-O*Y*se-R*V*he+R*Y*ee+z*V*se-z*j*ee}invert(){let E=this.elements,O=E[0],R=E[1],z=E[2],V=E[3],j=E[4],Y=E[5],ee=E[6],se=E[7],he=E[8],ce=he*j-Y*se,ue=Y*ee-he*V,fe=se*V-j*ee,ve=O*ce+R*ue+z*fe;if(ve===0)return this.set(0,0,0,0,0,0,0,0,0);let we=1/ve;return E[0]=ce*we,E[1]=(z*se-he*R)*we,E[2]=(Y*R-z*j)*we,E[3]=ue*we,E[4]=(he*O-z*ee)*we,E[5]=(z*V-Y*O)*we,E[6]=fe*we,E[7]=(R*ee-se*O)*we,E[8]=(j*O-R*V)*we,this}transpose(){let E,O=this.elements;return E=O[1],O[1]=O[3],O[3]=E,E=O[2],O[2]=O[6],O[6]=E,E=O[5],O[5]=O[7],O[7]=E,this}getNormalMatrix(E){return this.setFromMatrix4(E).invert().transpose()}transposeIntoArray(E){let O=this.elements;return E[0]=O[0],E[1]=O[3],E[2]=O[6],E[3]=O[1],E[4]=O[4],E[5]=O[7],E[6]=O[2],E[7]=O[5],E[8]=O[8],this}setUvTransform(E,O,R,z,V,j,Y){let ee=Math.cos(V),se=Math.sin(V);return this.set(R*ee,R*se,-R*(ee*j+se*Y)+j+E,-z*se,z*ee,-z*(-se*j+ee*Y)+Y+O,0,0,1),this}scale(E,O){return this.premultiply(Sn.makeScale(E,O)),this}rotate(E){return this.premultiply(Sn.makeRotation(-E)),this}translate(E,O){return this.premultiply(Sn.makeTranslation(E,O)),this}makeTranslation(E,O){return this.set(1,0,E,0,1,O,0,0,1),this}makeRotation(E){let O=Math.cos(E),R=Math.sin(E);return this.set(O,-R,0,R,O,0,0,0,1),this}makeScale(E,O){return this.set(E,0,0,0,O,0,0,0,1),this}equals(E){let O=this.elements,R=E.elements;for(let E=0;E<9;E++)if(O[E]!==R[E])return!1;return!0}fromArray(E,O=0){for(let R=0;R<9;R++)this.elements[R]=E[R+O];return this}toArray(E=[],O=0){let R=this.elements;return E[O]=R[0],E[O+1]=R[1],E[O+2]=R[2],E[O+3]=R[3],E[O+4]=R[4],E[O+5]=R[5],E[O+6]=R[6],E[O+7]=R[7],E[O+8]=R[8],E}clone(){return(new this.constructor).fromArray(this.elements)}},Sn=new wn;function xP(E){for(let O=E.length-1;O>=0;--O)if(E[O]>=65535)return!0;return!1}var _n={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:Uint8ClampedArray,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function Rg(E,O){return new _n[E](O)}function yp(E){return document.createElementNS("http://www.w3.org/1999/xhtml",E)}function HV(E,O,R){return new Promise((function(z,V){function s(){switch(E.clientWaitSync(O,E.SYNC_FLUSH_COMMANDS_BIT,0)){case E.WAIT_FAILED:V();break;case E.TIMEOUT_EXPIRED:setTimeout(s,R);break;default:z()}}setTimeout(s,R)}))}function wc(E){return E<.04045?E*.0773993808:Math.pow(E*.9478672986+.0521327014,2.4)}function ay(E){return E<.0031308?E*12.92:1.055*Math.pow(E,.41666)-.055}var An={[tn]:{[rn]:wc},[rn]:{[tn]:ay}},En={legacyMode:!0,get workingColorSpace(){return rn},set workingColorSpace(E){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(E,O,R){if(this.legacyMode||O===R||!O||!R)return E;if(An[O]&&An[O][R]!==void 0){let z=An[O][R];return E.r=z(E.r),E.g=z(E.g),E.b=z(E.b),E}throw new Error("Unsupported color space conversion.")},fromWorkingColorSpace:function(E,O){return this.convert(E,this.workingColorSpace,O)},toWorkingColorSpace:function(E,O){return this.convert(E,O,this.workingColorSpace)}},Cn={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Tn={r:0,g:0,b:0},Dn={h:0,s:0,l:0},In={h:0,s:0,l:0};function L1(E,O,R){return R<0&&(R+=1),R>1&&(R-=1),R<1/6?E+6*(O-E)*R:R<.5?O:R<2/3?E+6*(O-E)*(2/3-R):E}function Bg(E,O){return O.r=E.r,O.g=E.g,O.b=E.b,O}var On=class{constructor(E,O,R){return this.isColor=!0,this.r=1,this.g=1,this.b=1,O===void 0&&R===void 0?this.set(E):this.setRGB(E,O,R)}set(E){return E&&E.isColor?this.copy(E):typeof E=="number"?this.setHex(E):typeof E=="string"&&this.setStyle(E),this}setScalar(E){return this.r=E,this.g=E,this.b=E,this}setHex(E,O=tn){return E=Math.floor(E),this.r=(E>>16&255)/255,this.g=(E>>8&255)/255,this.b=(E&255)/255,En.toWorkingColorSpace(this,O),this}setRGB(E,O,R,z=En.workingColorSpace){return this.r=E,this.g=O,this.b=R,En.toWorkingColorSpace(this,z),this}setHSL(E,O,R,z=En.workingColorSpace){if(E=YS(E,1),O=pi(O,0,1),R=pi(R,0,1),O===0)this.r=this.g=this.b=R;else{let z=R<=.5?R*(1+O):R+O-R*O,V=2*R-z;this.r=L1(V,z,E+1/3),this.g=L1(V,z,E),this.b=L1(V,z,E-1/3)}return En.toWorkingColorSpace(this,z),this}setStyle(E,O=tn){function r(O){O!==void 0&&parseFloat(O)<1&&console.warn("THREE.Color: Alpha component of "+E+" will be ignored.")}let R;if(R=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(E)){let E,z=R[1],V=R[2];switch(z){case"rgb":case"rgba":if(E=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(V))return this.r=Math.min(255,parseInt(E[1],10))/255,this.g=Math.min(255,parseInt(E[2],10))/255,this.b=Math.min(255,parseInt(E[3],10))/255,En.toWorkingColorSpace(this,O),r(E[4]),this;if(E=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(V))return this.r=Math.min(100,parseInt(E[1],10))/100,this.g=Math.min(100,parseInt(E[2],10))/100,this.b=Math.min(100,parseInt(E[3],10))/100,En.toWorkingColorSpace(this,O),r(E[4]),this;break;case"hsl":case"hsla":if(E=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(V)){let R=parseFloat(E[1])/360,z=parseFloat(E[2])/100,V=parseFloat(E[3])/100;return r(E[4]),this.setHSL(R,z,V,O)}break}}else if(R=/^\#([A-Fa-f\d]+)$/.exec(E)){let E=R[1],z=E.length;if(z===3)return this.r=parseInt(E.charAt(0)+E.charAt(0),16)/255,this.g=parseInt(E.charAt(1)+E.charAt(1),16)/255,this.b=parseInt(E.charAt(2)+E.charAt(2),16)/255,En.toWorkingColorSpace(this,O),this;if(z===6)return this.r=parseInt(E.charAt(0)+E.charAt(1),16)/255,this.g=parseInt(E.charAt(2)+E.charAt(3),16)/255,this.b=parseInt(E.charAt(4)+E.charAt(5),16)/255,En.toWorkingColorSpace(this,O),this}return E&&E.length>0?this.setColorName(E,O):this}setColorName(E,O=tn){let R=Cn[E.toLowerCase()];return R!==void 0?this.setHex(R,O):console.warn("THREE.Color: Unknown color "+E),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(E){return this.r=E.r,this.g=E.g,this.b=E.b,this}copySRGBToLinear(E){return this.r=wc(E.r),this.g=wc(E.g),this.b=wc(E.b),this}copyLinearToSRGB(E){return this.r=ay(E.r),this.g=ay(E.g),this.b=ay(E.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(E=tn){return En.fromWorkingColorSpace(Bg(this,Tn),E),pi(Tn.r*255,0,255)<<16^pi(Tn.g*255,0,255)<<8^pi(Tn.b*255,0,255)}getHexString(E=tn){return("000000"+this.getHex(E).toString(16)).slice(-6)}getHSL(E,O=En.workingColorSpace){En.fromWorkingColorSpace(Bg(this,Tn),O);let R,z,V=Tn.r,j=Tn.g,Y=Tn.b,ee=Math.max(V,j,Y),se=Math.min(V,j,Y),he=(se+ee)/2;if(se===ee)R=0,z=0;else{let E=ee-se;switch(z=he<=.5?E/(ee+se):E/(2-ee-se),ee){case V:R=(j-Y)/E+(j<Y?6:0);break;case j:R=(Y-V)/E+2;break;case Y:R=(V-j)/E+4;break}R/=6}return E.h=R,E.s=z,E.l=he,E}getRGB(E,O=En.workingColorSpace){return En.fromWorkingColorSpace(Bg(this,Tn),O),E.r=Tn.r,E.g=Tn.g,E.b=Tn.b,E}getStyle(E=tn){return En.fromWorkingColorSpace(Bg(this,Tn),E),E!==tn?`color(${E} ${Tn.r} ${Tn.g} ${Tn.b})`:`rgb(${Tn.r*255|0},${Tn.g*255|0},${Tn.b*255|0})`}offsetHSL(E,O,R){return this.getHSL(Dn),Dn.h+=E,Dn.s+=O,Dn.l+=R,this.setHSL(Dn.h,Dn.s,Dn.l),this}add(E){return this.r+=E.r,this.g+=E.g,this.b+=E.b,this}addColors(E,O){return this.r=E.r+O.r,this.g=E.g+O.g,this.b=E.b+O.b,this}addScalar(E){return this.r+=E,this.g+=E,this.b+=E,this}sub(E){return this.r=Math.max(0,this.r-E.r),this.g=Math.max(0,this.g-E.g),this.b=Math.max(0,this.b-E.b),this}multiply(E){return this.r*=E.r,this.g*=E.g,this.b*=E.b,this}multiplyScalar(E){return this.r*=E,this.g*=E,this.b*=E,this}lerp(E,O){return this.r+=(E.r-this.r)*O,this.g+=(E.g-this.g)*O,this.b+=(E.b-this.b)*O,this}lerpColors(E,O,R){return this.r=E.r+(O.r-E.r)*R,this.g=E.g+(O.g-E.g)*R,this.b=E.b+(O.b-E.b)*R,this}lerpHSL(E,O){this.getHSL(Dn),E.getHSL(In);let R=hp(Dn.h,In.h,O),z=hp(Dn.s,In.s,O),V=hp(Dn.l,In.l,O);return this.setHSL(R,z,V),this}equals(E){return E.r===this.r&&E.g===this.g&&E.b===this.b}fromArray(E,O=0){return this.r=E[O],this.g=E[O+1],this.b=E[O+2],this}toArray(E=[],O=0){return E[O]=this.r,E[O+1]=this.g,E[O+2]=this.b,E}fromBufferAttribute(E,O){return this.r=E.getX(O),this.g=E.getY(O),this.b=E.getZ(O),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}};On.NAMES=Cn;var Rn,Ln=class{static getDataURL(E){if(/^data:/i.test(E.src)||typeof HTMLCanvasElement>"u")return E.src;let O;if(E instanceof HTMLCanvasElement)O=E;else{Rn===void 0&&(Rn=yp("canvas")),Rn.width=E.width,Rn.height=E.height;let R=Rn.getContext("2d");E instanceof ImageData?R.putImageData(E,0,0):R.drawImage(E,0,0,E.width,E.height),O=Rn}return O.width>2048||O.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",E),O.toDataURL("image/jpeg",.6)):O.toDataURL("image/png")}static sRGBToLinear(E){if(typeof HTMLImageElement<"u"&&E instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&E instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&E instanceof ImageBitmap){let O=yp("canvas");O.width=E.width,O.height=E.height;let R=O.getContext("2d");R.drawImage(E,0,0,E.width,E.height);let z=R.getImageData(0,0,E.width,E.height),V=z.data;for(let E=0;E<V.length;E++)V[E]=wc(V[E]/255)*255;return R.putImageData(z,0,0),O}if(E.data){let O=E.data.slice(0);for(let E=0;E<O.length;E++)O instanceof Uint8Array||O instanceof Uint8ClampedArray?O[E]=Math.floor(wc(O[E]/255)*255):O[E]=wc(O[E]);return{data:O,width:E.width,height:E.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),E}},Bn=class{constructor(E=null){this.isSource=!0,this.uuid=ss(),this.data=E,this.version=0}set needsUpdate(E){E===!0&&this.version++}toJSON(E){let O=E===void 0||typeof E=="string";if(!O&&E.images[this.uuid]!==void 0)return E.images[this.uuid];let R={uuid:this.uuid,url:""},z=this.data;if(z!==null){let E;if(Array.isArray(z)){E=[];for(let O=0,R=z.length;O<R;O++)z[O].isDataTexture?E.push(B1(z[O].image)):E.push(B1(z[O]))}else E=B1(z);R.url=E}return O||(E.images[this.uuid]=R),R}};function B1(E){return typeof HTMLImageElement<"u"&&E instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&E instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&E instanceof ImageBitmap?Ln.getDataURL(E):E.data?{data:Array.from(E.data),width:E.width,height:E.height,type:E.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}var zn=0,Fn=class extends pn{constructor(E=Fn.DEFAULT_IMAGE,O=Fn.DEFAULT_MAPPING,R=ui,z=ui,V=yi,j=bi,Y=Ni,ee=wi,se=Fn.DEFAULT_ANISOTROPY,he=Xr){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:zn++}),this.uuid=ss(),this.name="",this.source=new Bn(E),this.mipmaps=[],this.mapping=O,this.wrapS=R,this.wrapT=z,this.magFilter=V,this.minFilter=j,this.anisotropy=se,this.format=Y,this.internalFormat=null,this.type=ee,this.offset=new bn(0,0),this.repeat=new bn(1,1),this.center=new bn(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new wn,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=he,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(E){this.source.data=E}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(E){return this.name=E.name,this.source=E.source,this.mipmaps=E.mipmaps.slice(0),this.mapping=E.mapping,this.wrapS=E.wrapS,this.wrapT=E.wrapT,this.magFilter=E.magFilter,this.minFilter=E.minFilter,this.anisotropy=E.anisotropy,this.format=E.format,this.internalFormat=E.internalFormat,this.type=E.type,this.offset.copy(E.offset),this.repeat.copy(E.repeat),this.center.copy(E.center),this.rotation=E.rotation,this.matrixAutoUpdate=E.matrixAutoUpdate,this.matrix.copy(E.matrix),this.generateMipmaps=E.generateMipmaps,this.premultiplyAlpha=E.premultiplyAlpha,this.flipY=E.flipY,this.unpackAlignment=E.unpackAlignment,this.encoding=E.encoding,this.userData=JSON.parse(JSON.stringify(E.userData)),this.needsUpdate=!0,this}toJSON(E){let O=E===void 0||typeof E=="string";if(!O&&E.textures[this.uuid]!==void 0)return E.textures[this.uuid];let R={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(E).uuid,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(R.userData=this.userData),O||(E.textures[this.uuid]=R),R}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(E){if(this.mapping!==ti)return E;if(E.applyMatrix3(this.matrix),E.x<0||E.x>1)switch(this.wrapS){case oi:E.x=E.x-Math.floor(E.x);break;case ui:E.x=E.x<0?0:1;break;case fi:Math.abs(Math.floor(E.x)%2)===1?E.x=Math.ceil(E.x)-E.x:E.x=E.x-Math.floor(E.x);break}if(E.y<0||E.y>1)switch(this.wrapT){case oi:E.y=E.y-Math.floor(E.y);break;case ui:E.y=E.y<0?0:1;break;case fi:Math.abs(Math.floor(E.y)%2)===1?E.y=Math.ceil(E.y)-E.y:E.y=E.y-Math.floor(E.y);break}return this.flipY&&(E.y=1-E.y),E}set needsUpdate(E){E===!0&&(this.version++,this.source.needsUpdate=!0)}};Fn.DEFAULT_IMAGE=null;Fn.DEFAULT_MAPPING=ti;Fn.DEFAULT_ANISOTROPY=1;var Nn=class{constructor(E=0,O=0,R=0,z=1){Nn.prototype.isVector4=!0,this.x=E,this.y=O,this.z=R,this.w=z}get width(){return this.z}set width(E){this.z=E}get height(){return this.w}set height(E){this.w=E}set(E,O,R,z){return this.x=E,this.y=O,this.z=R,this.w=z,this}setScalar(E){return this.x=E,this.y=E,this.z=E,this.w=E,this}setX(E){return this.x=E,this}setY(E){return this.y=E,this}setZ(E){return this.z=E,this}setW(E){return this.w=E,this}setComponent(E,O){switch(E){case 0:this.x=O;break;case 1:this.y=O;break;case 2:this.z=O;break;case 3:this.w=O;break;default:throw new Error("index is out of range: "+E)}return this}getComponent(E){switch(E){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+E)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(E){return this.x=E.x,this.y=E.y,this.z=E.z,this.w=E.w!==void 0?E.w:1,this}add(E){return this.x+=E.x,this.y+=E.y,this.z+=E.z,this.w+=E.w,this}addScalar(E){return this.x+=E,this.y+=E,this.z+=E,this.w+=E,this}addVectors(E,O){return this.x=E.x+O.x,this.y=E.y+O.y,this.z=E.z+O.z,this.w=E.w+O.w,this}addScaledVector(E,O){return this.x+=E.x*O,this.y+=E.y*O,this.z+=E.z*O,this.w+=E.w*O,this}sub(E){return this.x-=E.x,this.y-=E.y,this.z-=E.z,this.w-=E.w,this}subScalar(E){return this.x-=E,this.y-=E,this.z-=E,this.w-=E,this}subVectors(E,O){return this.x=E.x-O.x,this.y=E.y-O.y,this.z=E.z-O.z,this.w=E.w-O.w,this}multiply(E){return this.x*=E.x,this.y*=E.y,this.z*=E.z,this.w*=E.w,this}multiplyScalar(E){return this.x*=E,this.y*=E,this.z*=E,this.w*=E,this}applyMatrix4(E){let O=this.x,R=this.y,z=this.z,V=this.w,j=E.elements;return this.x=j[0]*O+j[4]*R+j[8]*z+j[12]*V,this.y=j[1]*O+j[5]*R+j[9]*z+j[13]*V,this.z=j[2]*O+j[6]*R+j[10]*z+j[14]*V,this.w=j[3]*O+j[7]*R+j[11]*z+j[15]*V,this}divideScalar(E){return this.multiplyScalar(1/E)}setAxisAngleFromQuaternion(E){this.w=2*Math.acos(E.w);let O=Math.sqrt(1-E.w*E.w);return O<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=E.x/O,this.y=E.y/O,this.z=E.z/O),this}setAxisAngleFromRotationMatrix(E){let O,R,z,V,j=E.elements,Y=j[0],ee=j[4],se=j[8],he=j[1],ce=j[5],ue=j[9],fe=j[2],ve=j[6],we=j[10];if(Math.abs(ee-he)<.01&&Math.abs(se-fe)<.01&&Math.abs(ue-ve)<.01){if(Math.abs(ee+he)<.1&&Math.abs(se+fe)<.1&&Math.abs(ue+ve)<.1&&Math.abs(Y+ce+we-3)<.1)return this.set(1,0,0,0),this;O=Math.PI;let E=(Y+1)/2,j=(ce+1)/2,Se=(we+1)/2,_e=(ee+he)/4,Ae=(se+fe)/4,Ce=(ue+ve)/4;return E>j&&E>Se?E<.01?(R=0,z=.707106781,V=.707106781):(R=Math.sqrt(E),z=_e/R,V=Ae/R):j>Se?j<.01?(R=.707106781,z=0,V=.707106781):(z=Math.sqrt(j),R=_e/z,V=Ce/z):Se<.01?(R=.707106781,z=.707106781,V=0):(V=Math.sqrt(Se),R=Ae/V,z=Ce/V),this.set(R,z,V,O),this}let Se=Math.sqrt((ve-ue)*(ve-ue)+(se-fe)*(se-fe)+(he-ee)*(he-ee));return Math.abs(Se)<.001&&(Se=1),this.x=(ve-ue)/Se,this.y=(se-fe)/Se,this.z=(he-ee)/Se,this.w=Math.acos((Y+ce+we-1)/2),this}min(E){return this.x=Math.min(this.x,E.x),this.y=Math.min(this.y,E.y),this.z=Math.min(this.z,E.z),this.w=Math.min(this.w,E.w),this}max(E){return this.x=Math.max(this.x,E.x),this.y=Math.max(this.y,E.y),this.z=Math.max(this.z,E.z),this.w=Math.max(this.w,E.w),this}clamp(E,O){return this.x=Math.max(E.x,Math.min(O.x,this.x)),this.y=Math.max(E.y,Math.min(O.y,this.y)),this.z=Math.max(E.z,Math.min(O.z,this.z)),this.w=Math.max(E.w,Math.min(O.w,this.w)),this}clampScalar(E,O){return this.x=Math.max(E,Math.min(O,this.x)),this.y=Math.max(E,Math.min(O,this.y)),this.z=Math.max(E,Math.min(O,this.z)),this.w=Math.max(E,Math.min(O,this.w)),this}clampLength(E,O){let R=this.length();return this.divideScalar(R||1).multiplyScalar(Math.max(E,Math.min(O,R)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(E){return this.x*E.x+this.y*E.y+this.z*E.z+this.w*E.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(E){return this.normalize().multiplyScalar(E)}lerp(E,O){return this.x+=(E.x-this.x)*O,this.y+=(E.y-this.y)*O,this.z+=(E.z-this.z)*O,this.w+=(E.w-this.w)*O,this}lerpVectors(E,O,R){return this.x=E.x+(O.x-E.x)*R,this.y=E.y+(O.y-E.y)*R,this.z=E.z+(O.z-E.z)*R,this.w=E.w+(O.w-E.w)*R,this}equals(E){return E.x===this.x&&E.y===this.y&&E.z===this.z&&E.w===this.w}fromArray(E,O=0){return this.x=E[O],this.y=E[O+1],this.z=E[O+2],this.w=E[O+3],this}toArray(E=[],O=0){return E[O]=this.x,E[O+1]=this.y,E[O+2]=this.z,E[O+3]=this.w,E}fromBufferAttribute(E,O){return this.x=E.getX(O),this.y=E.getY(O),this.z=E.getZ(O),this.w=E.getW(O),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}},Un=class extends pn{constructor(E=1,O=1,R={}){super(),this.isWebGLRenderTarget=!0,this.width=E,this.height=O,this.depth=1,this.scissor=new Nn(0,0,E,O),this.scissorTest=!1,this.viewport=new Nn(0,0,E,O);let z={width:E,height:O,depth:1};this.texture=new Fn(z,R.mapping,R.wrapS,R.wrapT,R.magFilter,R.minFilter,R.format,R.type,R.anisotropy,R.encoding),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=R.generateMipmaps!==void 0&&R.generateMipmaps,this.texture.internalFormat=R.internalFormat!==void 0?R.internalFormat:null,this.texture.minFilter=R.minFilter!==void 0?R.minFilter:yi,this.depthBuffer=R.depthBuffer===void 0||R.depthBuffer,this.stencilBuffer=R.stencilBuffer!==void 0&&R.stencilBuffer,this.depthTexture=R.depthTexture!==void 0?R.depthTexture:null,this.samples=R.samples!==void 0?R.samples:0}setSize(E,O,R=1){(this.width!==E||this.height!==O||this.depth!==R)&&(this.width=E,this.height=O,this.depth=R,this.texture.image.width=E,this.texture.image.height=O,this.texture.image.depth=R,this.dispose()),this.viewport.set(0,0,E,O),this.scissor.set(0,0,E,O)}clone(){return(new this.constructor).copy(this)}copy(E){this.width=E.width,this.height=E.height,this.depth=E.depth,this.viewport.copy(E.viewport),this.texture=E.texture.clone(),this.texture.isRenderTargetTexture=!0;let O=Object.assign({},E.texture.image);return this.texture.source=new Bn(O),this.depthBuffer=E.depthBuffer,this.stencilBuffer=E.stencilBuffer,E.depthTexture!==null&&(this.depthTexture=E.depthTexture.clone()),this.samples=E.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}},kn=class extends Fn{constructor(E=null,O=1,R=1,z=1){super(null),this.isDataArrayTexture=!0,this.image={data:E,width:O,height:R,depth:z},this.magFilter=mi,this.minFilter=mi,this.wrapR=ui,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}};var Vn=class extends Fn{constructor(E=null,O=1,R=1,z=1){super(null),this.isData3DTexture=!0,this.image={data:E,width:O,height:R,depth:z},this.magFilter=mi,this.minFilter=mi,this.wrapR=ui,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}};var Gn=class extends Un{constructor(E=1,O=1,R=1,z={}){super(E,O,z),this.isWebGLMultipleRenderTargets=!0;let V=this.texture;this.texture=[];for(let E=0;E<R;E++)this.texture[E]=V.clone(),this.texture[E].isRenderTargetTexture=!0}setSize(E,O,R=1){if(this.width!==E||this.height!==O||this.depth!==R){this.width=E,this.height=O,this.depth=R;for(let z=0,V=this.texture.length;z<V;z++)this.texture[z].image.width=E,this.texture[z].image.height=O,this.texture[z].image.depth=R;this.dispose()}return this.viewport.set(0,0,E,O),this.scissor.set(0,0,E,O),this}copy(E){this.dispose(),this.width=E.width,this.height=E.height,this.depth=E.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=E.depthBuffer,this.stencilBuffer=E.stencilBuffer,E.depthTexture!==null&&(this.depthTexture=E.depthTexture.clone()),this.texture.length=0;for(let O=0,R=E.texture.length;O<R;O++)this.texture[O]=E.texture[O].clone(),this.texture[O].isRenderTargetTexture=!0;return this}},Hn=class{constructor(E=0,O=0,R=0,z=1){this.isQuaternion=!0,this._x=E,this._y=O,this._z=R,this._w=z}static slerpFlat(E,O,R,z,V,j,Y){let ee=R[z+0],se=R[z+1],he=R[z+2],ce=R[z+3],ue=V[j+0],fe=V[j+1],ve=V[j+2],we=V[j+3];if(Y!==0)if(Y!==1){if(ce!==we||ee!==ue||se!==fe||he!==ve){let E=1-Y,O=ee*ue+se*fe+he*ve+ce*we,R=O>=0?1:-1,z=1-O*O;if(z>Number.EPSILON){let V=Math.sqrt(z),j=Math.atan2(V,O*R);E=Math.sin(E*j)/V,Y=Math.sin(Y*j)/V}let V=Y*R;if(ee=ee*E+ue*V,se=se*E+fe*V,he=he*E+ve*V,ce=ce*E+we*V,E===1-Y){let E=1/Math.sqrt(ee*ee+se*se+he*he+ce*ce);ee*=E,se*=E,he*=E,ce*=E}}E[O]=ee,E[O+1]=se,E[O+2]=he,E[O+3]=ce}else E[O+0]=ue,E[O+1]=fe,E[O+2]=ve,E[O+3]=we;else E[O+0]=ee,E[O+1]=se,E[O+2]=he,E[O+3]=ce}static multiplyQuaternionsFlat(E,O,R,z,V,j){let Y=R[z],ee=R[z+1],se=R[z+2],he=R[z+3],ce=V[j],ue=V[j+1],fe=V[j+2],ve=V[j+3];return E[O]=Y*ve+he*ce+ee*fe-se*ue,E[O+1]=ee*ve+he*ue+se*ce-Y*fe,E[O+2]=se*ve+he*fe+Y*ue-ee*ce,E[O+3]=he*ve-Y*ce-ee*ue-se*fe,E}get x(){return this._x}set x(E){this._x=E,this._onChangeCallback()}get y(){return this._y}set y(E){this._y=E,this._onChangeCallback()}get z(){return this._z}set z(E){this._z=E,this._onChangeCallback()}get w(){return this._w}set w(E){this._w=E,this._onChangeCallback()}set(E,O,R,z){return this._x=E,this._y=O,this._z=R,this._w=z,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(E){return this._x=E.x,this._y=E.y,this._z=E.z,this._w=E.w,this._onChangeCallback(),this}setFromEuler(E,O){let R=E._x,z=E._y,V=E._z,j=E._order,Y=Math.cos,ee=Math.sin,se=Y(R/2),he=Y(z/2),ce=Y(V/2),ue=ee(R/2),fe=ee(z/2),ve=ee(V/2);switch(j){case"XYZ":this._x=ue*he*ce+se*fe*ve,this._y=se*fe*ce-ue*he*ve,this._z=se*he*ve+ue*fe*ce,this._w=se*he*ce-ue*fe*ve;break;case"YXZ":this._x=ue*he*ce+se*fe*ve,this._y=se*fe*ce-ue*he*ve,this._z=se*he*ve-ue*fe*ce,this._w=se*he*ce+ue*fe*ve;break;case"ZXY":this._x=ue*he*ce-se*fe*ve,this._y=se*fe*ce+ue*he*ve,this._z=se*he*ve+ue*fe*ce,this._w=se*he*ce-ue*fe*ve;break;case"ZYX":this._x=ue*he*ce-se*fe*ve,this._y=se*fe*ce+ue*he*ve,this._z=se*he*ve-ue*fe*ce,this._w=se*he*ce+ue*fe*ve;break;case"YZX":this._x=ue*he*ce+se*fe*ve,this._y=se*fe*ce+ue*he*ve,this._z=se*he*ve-ue*fe*ce,this._w=se*he*ce-ue*fe*ve;break;case"XZY":this._x=ue*he*ce-se*fe*ve,this._y=se*fe*ce-ue*he*ve,this._z=se*he*ve+ue*fe*ce,this._w=se*he*ce+ue*fe*ve;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+j)}return O!==!1&&this._onChangeCallback(),this}setFromAxisAngle(E,O){let R=O/2,z=Math.sin(R);return this._x=E.x*z,this._y=E.y*z,this._z=E.z*z,this._w=Math.cos(R),this._onChangeCallback(),this}setFromRotationMatrix(E){let O=E.elements,R=O[0],z=O[4],V=O[8],j=O[1],Y=O[5],ee=O[9],se=O[2],he=O[6],ce=O[10],ue=R+Y+ce;if(ue>0){let E=.5/Math.sqrt(ue+1);this._w=.25/E,this._x=(he-ee)*E,this._y=(V-se)*E,this._z=(j-z)*E}else if(R>Y&&R>ce){let E=2*Math.sqrt(1+R-Y-ce);this._w=(he-ee)/E,this._x=.25*E,this._y=(z+j)/E,this._z=(V+se)/E}else if(Y>ce){let E=2*Math.sqrt(1+Y-R-ce);this._w=(V-se)/E,this._x=(z+j)/E,this._y=.25*E,this._z=(ee+he)/E}else{let E=2*Math.sqrt(1+ce-R-Y);this._w=(j-z)/E,this._x=(V+se)/E,this._y=(ee+he)/E,this._z=.25*E}return this._onChangeCallback(),this}setFromUnitVectors(E,O){let R=E.dot(O)+1;return R<Number.EPSILON?(R=0,Math.abs(E.x)>Math.abs(E.z)?(this._x=-E.y,this._y=E.x,this._z=0,this._w=R):(this._x=0,this._y=-E.z,this._z=E.y,this._w=R)):(this._x=E.y*O.z-E.z*O.y,this._y=E.z*O.x-E.x*O.z,this._z=E.x*O.y-E.y*O.x,this._w=R),this.normalize()}angleTo(E){return 2*Math.acos(Math.abs(pi(this.dot(E),-1,1)))}rotateTowards(E,O){let R=this.angleTo(E);if(R===0)return this;let z=Math.min(1,O/R);return this.slerp(E,z),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(E){return this._x*E._x+this._y*E._y+this._z*E._z+this._w*E._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let E=this.length();return E===0?(this._x=0,this._y=0,this._z=0,this._w=1):(E=1/E,this._x=this._x*E,this._y=this._y*E,this._z=this._z*E,this._w=this._w*E),this._onChangeCallback(),this}multiply(E){return this.multiplyQuaternions(this,E)}premultiply(E){return this.multiplyQuaternions(E,this)}multiplyQuaternions(E,O){let R=E._x,z=E._y,V=E._z,j=E._w,Y=O._x,ee=O._y,se=O._z,he=O._w;return this._x=R*he+j*Y+z*se-V*ee,this._y=z*he+j*ee+V*Y-R*se,this._z=V*he+j*se+R*ee-z*Y,this._w=j*he-R*Y-z*ee-V*se,this._onChangeCallback(),this}slerp(E,O){if(O===0)return this;if(O===1)return this.copy(E);let R=this._x,z=this._y,V=this._z,j=this._w,Y=j*E._w+R*E._x+z*E._y+V*E._z;if(Y<0?(this._w=-E._w,this._x=-E._x,this._y=-E._y,this._z=-E._z,Y=-Y):this.copy(E),Y>=1)return this._w=j,this._x=R,this._y=z,this._z=V,this;let ee=1-Y*Y;if(ee<=Number.EPSILON){let E=1-O;return this._w=E*j+O*this._w,this._x=E*R+O*this._x,this._y=E*z+O*this._y,this._z=E*V+O*this._z,this.normalize(),this._onChangeCallback(),this}let se=Math.sqrt(ee),he=Math.atan2(se,Y),ce=Math.sin((1-O)*he)/se,ue=Math.sin(O*he)/se;return this._w=j*ce+this._w*ue,this._x=R*ce+this._x*ue,this._y=z*ce+this._y*ue,this._z=V*ce+this._z*ue,this._onChangeCallback(),this}slerpQuaternions(E,O,R){return this.copy(E).slerp(O,R)}random(){let E=Math.random(),O=Math.sqrt(1-E),R=Math.sqrt(E),z=2*Math.PI*Math.random(),V=2*Math.PI*Math.random();return this.set(O*Math.cos(z),R*Math.sin(V),R*Math.cos(V),O*Math.sin(z))}equals(E){return E._x===this._x&&E._y===this._y&&E._z===this._z&&E._w===this._w}fromArray(E,O=0){return this._x=E[O],this._y=E[O+1],this._z=E[O+2],this._w=E[O+3],this._onChangeCallback(),this}toArray(E=[],O=0){return E[O]=this._x,E[O+1]=this._y,E[O+2]=this._z,E[O+3]=this._w,E}fromBufferAttribute(E,O){return this._x=E.getX(O),this._y=E.getY(O),this._z=E.getZ(O),this._w=E.getW(O),this}_onChange(E){return this._onChangeCallback=E,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}},Wn=class{constructor(E=0,O=0,R=0){Wn.prototype.isVector3=!0,this.x=E,this.y=O,this.z=R}set(E,O,R){return R===void 0&&(R=this.z),this.x=E,this.y=O,this.z=R,this}setScalar(E){return this.x=E,this.y=E,this.z=E,this}setX(E){return this.x=E,this}setY(E){return this.y=E,this}setZ(E){return this.z=E,this}setComponent(E,O){switch(E){case 0:this.x=O;break;case 1:this.y=O;break;case 2:this.z=O;break;default:throw new Error("index is out of range: "+E)}return this}getComponent(E){switch(E){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+E)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(E){return this.x=E.x,this.y=E.y,this.z=E.z,this}add(E){return this.x+=E.x,this.y+=E.y,this.z+=E.z,this}addScalar(E){return this.x+=E,this.y+=E,this.z+=E,this}addVectors(E,O){return this.x=E.x+O.x,this.y=E.y+O.y,this.z=E.z+O.z,this}addScaledVector(E,O){return this.x+=E.x*O,this.y+=E.y*O,this.z+=E.z*O,this}sub(E){return this.x-=E.x,this.y-=E.y,this.z-=E.z,this}subScalar(E){return this.x-=E,this.y-=E,this.z-=E,this}subVectors(E,O){return this.x=E.x-O.x,this.y=E.y-O.y,this.z=E.z-O.z,this}multiply(E){return this.x*=E.x,this.y*=E.y,this.z*=E.z,this}multiplyScalar(E){return this.x*=E,this.y*=E,this.z*=E,this}multiplyVectors(E,O){return this.x=E.x*O.x,this.y=E.y*O.y,this.z=E.z*O.z,this}applyEuler(E){return this.applyQuaternion(Xn.setFromEuler(E))}applyAxisAngle(E,O){return this.applyQuaternion(Xn.setFromAxisAngle(E,O))}applyMatrix3(E){let O=this.x,R=this.y,z=this.z,V=E.elements;return this.x=V[0]*O+V[3]*R+V[6]*z,this.y=V[1]*O+V[4]*R+V[7]*z,this.z=V[2]*O+V[5]*R+V[8]*z,this}applyNormalMatrix(E){return this.applyMatrix3(E).normalize()}applyMatrix4(E){let O=this.x,R=this.y,z=this.z,V=E.elements,j=1/(V[3]*O+V[7]*R+V[11]*z+V[15]);return this.x=(V[0]*O+V[4]*R+V[8]*z+V[12])*j,this.y=(V[1]*O+V[5]*R+V[9]*z+V[13])*j,this.z=(V[2]*O+V[6]*R+V[10]*z+V[14])*j,this}applyQuaternion(E){let O=this.x,R=this.y,z=this.z,V=E.x,j=E.y,Y=E.z,ee=E.w,se=ee*O+j*z-Y*R,he=ee*R+Y*O-V*z,ce=ee*z+V*R-j*O,ue=-V*O-j*R-Y*z;return this.x=se*ee+ue*-V+he*-Y-ce*-j,this.y=he*ee+ue*-j+ce*-V-se*-Y,this.z=ce*ee+ue*-Y+se*-j-he*-V,this}project(E){return this.applyMatrix4(E.matrixWorldInverse).applyMatrix4(E.projectionMatrix)}unproject(E){return this.applyMatrix4(E.projectionMatrixInverse).applyMatrix4(E.matrixWorld)}transformDirection(E){let O=this.x,R=this.y,z=this.z,V=E.elements;return this.x=V[0]*O+V[4]*R+V[8]*z,this.y=V[1]*O+V[5]*R+V[9]*z,this.z=V[2]*O+V[6]*R+V[10]*z,this.normalize()}divide(E){return this.x/=E.x,this.y/=E.y,this.z/=E.z,this}divideScalar(E){return this.multiplyScalar(1/E)}min(E){return this.x=Math.min(this.x,E.x),this.y=Math.min(this.y,E.y),this.z=Math.min(this.z,E.z),this}max(E){return this.x=Math.max(this.x,E.x),this.y=Math.max(this.y,E.y),this.z=Math.max(this.z,E.z),this}clamp(E,O){return this.x=Math.max(E.x,Math.min(O.x,this.x)),this.y=Math.max(E.y,Math.min(O.y,this.y)),this.z=Math.max(E.z,Math.min(O.z,this.z)),this}clampScalar(E,O){return this.x=Math.max(E,Math.min(O,this.x)),this.y=Math.max(E,Math.min(O,this.y)),this.z=Math.max(E,Math.min(O,this.z)),this}clampLength(E,O){let R=this.length();return this.divideScalar(R||1).multiplyScalar(Math.max(E,Math.min(O,R)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(E){return this.x*E.x+this.y*E.y+this.z*E.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(E){return this.normalize().multiplyScalar(E)}lerp(E,O){return this.x+=(E.x-this.x)*O,this.y+=(E.y-this.y)*O,this.z+=(E.z-this.z)*O,this}lerpVectors(E,O,R){return this.x=E.x+(O.x-E.x)*R,this.y=E.y+(O.y-E.y)*R,this.z=E.z+(O.z-E.z)*R,this}cross(E){return this.crossVectors(this,E)}crossVectors(E,O){let R=E.x,z=E.y,V=E.z,j=O.x,Y=O.y,ee=O.z;return this.x=z*ee-V*Y,this.y=V*j-R*ee,this.z=R*Y-z*j,this}projectOnVector(E){let O=E.lengthSq();if(O===0)return this.set(0,0,0);let R=E.dot(this)/O;return this.copy(E).multiplyScalar(R)}projectOnPlane(E){return qn.copy(this).projectOnVector(E),this.sub(qn)}reflect(E){return this.sub(qn.copy(E).multiplyScalar(2*this.dot(E)))}angleTo(E){let O=Math.sqrt(this.lengthSq()*E.lengthSq());if(O===0)return Math.PI/2;let R=this.dot(E)/O;return Math.acos(pi(R,-1,1))}distanceTo(E){return Math.sqrt(this.distanceToSquared(E))}distanceToSquared(E){let O=this.x-E.x,R=this.y-E.y,z=this.z-E.z;return O*O+R*R+z*z}manhattanDistanceTo(E){return Math.abs(this.x-E.x)+Math.abs(this.y-E.y)+Math.abs(this.z-E.z)}setFromSpherical(E){return this.setFromSphericalCoords(E.radius,E.phi,E.theta)}setFromSphericalCoords(E,O,R){let z=Math.sin(O)*E;return this.x=z*Math.sin(R),this.y=Math.cos(O)*E,this.z=z*Math.cos(R),this}setFromCylindrical(E){return this.setFromCylindricalCoords(E.radius,E.theta,E.y)}setFromCylindricalCoords(E,O,R){return this.x=E*Math.sin(O),this.y=R,this.z=E*Math.cos(O),this}setFromMatrixPosition(E){let O=E.elements;return this.x=O[12],this.y=O[13],this.z=O[14],this}setFromMatrixScale(E){let O=this.setFromMatrixColumn(E,0).length(),R=this.setFromMatrixColumn(E,1).length(),z=this.setFromMatrixColumn(E,2).length();return this.x=O,this.y=R,this.z=z,this}setFromMatrixColumn(E,O){return this.fromArray(E.elements,O*4)}setFromMatrix3Column(E,O){return this.fromArray(E.elements,O*3)}setFromEuler(E){return this.x=E._x,this.y=E._y,this.z=E._z,this}equals(E){return E.x===this.x&&E.y===this.y&&E.z===this.z}fromArray(E,O=0){return this.x=E[O],this.y=E[O+1],this.z=E[O+2],this}toArray(E=[],O=0){return E[O]=this.x,E[O+1]=this.y,E[O+2]=this.z,E}fromBufferAttribute(E,O){return this.x=E.getX(O),this.y=E.getY(O),this.z=E.getZ(O),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){let E=2*(Math.random()-.5),O=Math.random()*Math.PI*2,R=Math.sqrt(1-E**2);return this.x=R*Math.cos(O),this.y=R*Math.sin(O),this.z=E,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}},qn=new Wn,Xn=new Hn,Yn=class{constructor(E=new Wn(1/0,1/0,1/0),O=new Wn(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=E,this.max=O}set(E,O){return this.min.copy(E),this.max.copy(O),this}setFromArray(E){let O=1/0,R=1/0,z=1/0,V=-1/0,j=-1/0,Y=-1/0;for(let ee=0,se=E.length;ee<se;ee+=3){let se=E[ee],he=E[ee+1],ce=E[ee+2];se<O&&(O=se),he<R&&(R=he),ce<z&&(z=ce),se>V&&(V=se),he>j&&(j=he),ce>Y&&(Y=ce)}return this.min.set(O,R,z),this.max.set(V,j,Y),this}setFromBufferAttribute(E){let O=1/0,R=1/0,z=1/0,V=-1/0,j=-1/0,Y=-1/0;for(let ee=0,se=E.count;ee<se;ee++){let se=E.getX(ee),he=E.getY(ee),ce=E.getZ(ee);se<O&&(O=se),he<R&&(R=he),ce<z&&(z=ce),se>V&&(V=se),he>j&&(j=he),ce>Y&&(Y=ce)}return this.min.set(O,R,z),this.max.set(V,j,Y),this}setFromPoints(E){this.makeEmpty();for(let O=0,R=E.length;O<R;O++)this.expandByPoint(E[O]);return this}setFromCenterAndSize(E,O){let R=Zn.copy(O).multiplyScalar(.5);return this.min.copy(E).sub(R),this.max.copy(E).add(R),this}setFromObject(E,O=!1){return this.makeEmpty(),this.expandByObject(E,O)}clone(){return(new this.constructor).copy(this)}copy(E){return this.min.copy(E.min),this.max.copy(E.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(E){return this.isEmpty()?E.set(0,0,0):E.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(E){return this.isEmpty()?E.set(0,0,0):E.subVectors(this.max,this.min)}expandByPoint(E){return this.min.min(E),this.max.max(E),this}expandByVector(E){return this.min.sub(E),this.max.add(E),this}expandByScalar(E){return this.min.addScalar(-E),this.max.addScalar(E),this}expandByObject(E,O=!1){E.updateWorldMatrix(!1,!1);let R=E.geometry;if(R!==void 0)if(O&&R.attributes!=null&&R.attributes.position!==void 0){let O=R.attributes.position;for(let R=0,z=O.count;R<z;R++)Zn.fromBufferAttribute(O,R).applyMatrix4(E.matrixWorld),this.expandByPoint(Zn)}else R.boundingBox===null&&R.computeBoundingBox(),Kn.copy(R.boundingBox),Kn.applyMatrix4(E.matrixWorld),this.union(Kn);let z=E.children;for(let E=0,R=z.length;E<R;E++)this.expandByObject(z[E],O);return this}containsPoint(E){return!(E.x<this.min.x||E.x>this.max.x||E.y<this.min.y||E.y>this.max.y||E.z<this.min.z||E.z>this.max.z)}containsBox(E){return this.min.x<=E.min.x&&E.max.x<=this.max.x&&this.min.y<=E.min.y&&E.max.y<=this.max.y&&this.min.z<=E.min.z&&E.max.z<=this.max.z}getParameter(E,O){return O.set((E.x-this.min.x)/(this.max.x-this.min.x),(E.y-this.min.y)/(this.max.y-this.min.y),(E.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(E){return!(E.max.x<this.min.x||E.min.x>this.max.x||E.max.y<this.min.y||E.min.y>this.max.y||E.max.z<this.min.z||E.min.z>this.max.z)}intersectsSphere(E){return this.clampPoint(E.center,Zn),Zn.distanceToSquared(E.center)<=E.radius*E.radius}intersectsPlane(E){let O,R;return E.normal.x>0?(O=E.normal.x*this.min.x,R=E.normal.x*this.max.x):(O=E.normal.x*this.max.x,R=E.normal.x*this.min.x),E.normal.y>0?(O+=E.normal.y*this.min.y,R+=E.normal.y*this.max.y):(O+=E.normal.y*this.max.y,R+=E.normal.y*this.min.y),E.normal.z>0?(O+=E.normal.z*this.min.z,R+=E.normal.z*this.max.z):(O+=E.normal.z*this.max.z,R+=E.normal.z*this.min.z),O<=-E.constant&&R>=-E.constant}intersectsTriangle(E){if(this.isEmpty())return!1;this.getCenter(as),os.subVectors(this.max,as),Jn.subVectors(E.a,as),$n.subVectors(E.b,as),es.subVectors(E.c,as),ts.subVectors($n,Jn),is.subVectors(es,$n),ns.subVectors(Jn,es);let O=[0,-ts.z,ts.y,0,-is.z,is.y,0,-ns.z,ns.y,ts.z,0,-ts.x,is.z,0,-is.x,ns.z,0,-ns.x,-ts.y,ts.x,0,-is.y,is.x,0,-ns.y,ns.x,0];return!(!V1(O,Jn,$n,es,os)||(O=[1,0,0,0,1,0,0,0,1],!V1(O,Jn,$n,es,os)))&&(ls.crossVectors(ts,is),O=[ls.x,ls.y,ls.z],V1(O,Jn,$n,es,os))}clampPoint(E,O){return O.copy(E).clamp(this.min,this.max)}distanceToPoint(E){return Zn.copy(E).clamp(this.min,this.max).sub(E).length()}getBoundingSphere(E){return this.getCenter(E.center),E.radius=this.getSize(Zn).length()*.5,E}intersect(E){return this.min.max(E.min),this.max.min(E.max),this.isEmpty()&&this.makeEmpty(),this}union(E){return this.min.min(E.min),this.max.max(E.max),this}applyMatrix4(E){return this.isEmpty()||(Qn[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(E),Qn[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(E),Qn[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(E),Qn[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(E),Qn[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(E),Qn[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(E),Qn[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(E),Qn[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(E),this.setFromPoints(Qn)),this}translate(E){return this.min.add(E),this.max.add(E),this}equals(E){return E.min.equals(this.min)&&E.max.equals(this.max)}},Qn=[new Wn,new Wn,new Wn,new Wn,new Wn,new Wn,new Wn,new Wn],Zn=new Wn,Kn=new Yn,Jn=new Wn,$n=new Wn,es=new Wn,ts=new Wn,is=new Wn,ns=new Wn,as=new Wn,os=new Wn,ls=new Wn,hs=new Wn;function V1(E,O,R,z,V){for(let j=0,Y=E.length-3;j<=Y;j+=3){hs.fromArray(E,j);let Y=V.x*Math.abs(hs.x)+V.y*Math.abs(hs.y)+V.z*Math.abs(hs.z),ee=O.dot(hs),se=R.dot(hs),he=z.dot(hs);if(Math.max(-Math.max(ee,se,he),Math.min(ee,se,he))>Y)return!1}return!0}var cs=new Yn,ds=new Wn,us=new Wn,ps=class{constructor(E=new Wn,O=-1){this.center=E,this.radius=O}set(E,O){return this.center.copy(E),this.radius=O,this}setFromPoints(E,O){let R=this.center;O!==void 0?R.copy(O):cs.setFromPoints(E).getCenter(R);let z=0;for(let O=0,V=E.length;O<V;O++)z=Math.max(z,R.distanceToSquared(E[O]));return this.radius=Math.sqrt(z),this}copy(E){return this.center.copy(E.center),this.radius=E.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(E){return E.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(E){return E.distanceTo(this.center)-this.radius}intersectsSphere(E){let O=this.radius+E.radius;return E.center.distanceToSquared(this.center)<=O*O}intersectsBox(E){return E.intersectsSphere(this)}intersectsPlane(E){return Math.abs(E.distanceToPoint(this.center))<=this.radius}clampPoint(E,O){let R=this.center.distanceToSquared(E);return O.copy(E),R>this.radius*this.radius&&(O.sub(this.center).normalize(),O.multiplyScalar(this.radius).add(this.center)),O}getBoundingBox(E){return this.isEmpty()?(E.makeEmpty(),E):(E.set(this.center,this.center),E.expandByScalar(this.radius),E)}applyMatrix4(E){return this.center.applyMatrix4(E),this.radius=this.radius*E.getMaxScaleOnAxis(),this}translate(E){return this.center.add(E),this}expandByPoint(E){if(this.isEmpty())return this.center.copy(E),this.radius=0,this;ds.subVectors(E,this.center);let O=ds.lengthSq();if(O>this.radius*this.radius){let E=Math.sqrt(O),R=.5*(E-this.radius);this.center.addScaledVector(ds,R/E),this.radius+=R}return this}union(E){return E.isEmpty()?this:this.isEmpty()?(this.copy(E),this):(this.center.equals(E.center)===!0?this.radius=Math.max(this.radius,E.radius):(us.subVectors(E.center,this.center).setLength(E.radius),this.expandByPoint(ds.copy(E.center).add(us)),this.expandByPoint(ds.copy(E.center).sub(us))),this)}equals(E){return E.center.equals(this.center)&&E.radius===this.radius}clone(){return(new this.constructor).copy(this)}},fs=new Wn,ys=new Wn,xs=new Wn,bs=new Wn,Ss=new Wn,_s=new Wn,As=new Wn,Ms=class{constructor(E=new Wn,O=new Wn(0,0,-1)){this.origin=E,this.direction=O}set(E,O){return this.origin.copy(E),this.direction.copy(O),this}copy(E){return this.origin.copy(E.origin),this.direction.copy(E.direction),this}at(E,O){return O.copy(this.direction).multiplyScalar(E).add(this.origin)}lookAt(E){return this.direction.copy(E).sub(this.origin).normalize(),this}recast(E){return this.origin.copy(this.at(E,fs)),this}closestPointToPoint(E,O){O.subVectors(E,this.origin);let R=O.dot(this.direction);return R<0?O.copy(this.origin):O.copy(this.direction).multiplyScalar(R).add(this.origin)}distanceToPoint(E){return Math.sqrt(this.distanceSqToPoint(E))}distanceSqToPoint(E){let O=fs.subVectors(E,this.origin).dot(this.direction);return O<0?this.origin.distanceToSquared(E):(fs.copy(this.direction).multiplyScalar(O).add(this.origin),fs.distanceToSquared(E))}distanceSqToSegment(E,O,R,z){ys.copy(E).add(O).multiplyScalar(.5),xs.copy(O).sub(E).normalize(),bs.copy(this.origin).sub(ys);let V,j,Y,ee,se=E.distanceTo(O)*.5,he=-this.direction.dot(xs),ce=bs.dot(this.direction),ue=-bs.dot(xs),fe=bs.lengthSq(),ve=Math.abs(1-he*he);if(ve>0)if(V=he*ue-ce,j=he*ce-ue,ee=se*ve,V>=0)if(j>=-ee)if(j<=ee){let E=1/ve;V*=E,j*=E,Y=V*(V+he*j+2*ce)+j*(he*V+j+2*ue)+fe}else j=se,V=Math.max(0,-(he*j+ce)),Y=-V*V+j*(j+2*ue)+fe;else j=-se,V=Math.max(0,-(he*j+ce)),Y=-V*V+j*(j+2*ue)+fe;else j<=-ee?(V=Math.max(0,-(-he*se+ce)),j=V>0?-se:Math.min(Math.max(-se,-ue),se),Y=-V*V+j*(j+2*ue)+fe):j<=ee?(V=0,j=Math.min(Math.max(-se,-ue),se),Y=j*(j+2*ue)+fe):(V=Math.max(0,-(he*se+ce)),j=V>0?se:Math.min(Math.max(-se,-ue),se),Y=-V*V+j*(j+2*ue)+fe);else j=he>0?-se:se,V=Math.max(0,-(he*j+ce)),Y=-V*V+j*(j+2*ue)+fe;return R&&R.copy(this.direction).multiplyScalar(V).add(this.origin),z&&z.copy(xs).multiplyScalar(j).add(ys),Y}intersectSphere(E,O){fs.subVectors(E.center,this.origin);let R=fs.dot(this.direction),z=fs.dot(fs)-R*R,V=E.radius*E.radius;if(z>V)return null;let j=Math.sqrt(V-z),Y=R-j,ee=R+j;return Y<0&&ee<0?null:Y<0?this.at(ee,O):this.at(Y,O)}intersectsSphere(E){return this.distanceSqToPoint(E.center)<=E.radius*E.radius}distanceToPlane(E){let O=E.normal.dot(this.direction);if(O===0)return E.distanceToPoint(this.origin)===0?0:null;let R=-(this.origin.dot(E.normal)+E.constant)/O;return R>=0?R:null}intersectPlane(E,O){let R=this.distanceToPlane(E);return R===null?null:this.at(R,O)}intersectsPlane(E){let O=E.distanceToPoint(this.origin);return O===0||E.normal.dot(this.direction)*O<0}intersectBox(E,O){let R,z,V,j,Y,ee,se=1/this.direction.x,he=1/this.direction.y,ce=1/this.direction.z,ue=this.origin;return se>=0?(R=(E.min.x-ue.x)*se,z=(E.max.x-ue.x)*se):(R=(E.max.x-ue.x)*se,z=(E.min.x-ue.x)*se),he>=0?(V=(E.min.y-ue.y)*he,j=(E.max.y-ue.y)*he):(V=(E.max.y-ue.y)*he,j=(E.min.y-ue.y)*he),R>j||V>z||((V>R||isNaN(R))&&(R=V),(j<z||isNaN(z))&&(z=j),ce>=0?(Y=(E.min.z-ue.z)*ce,ee=(E.max.z-ue.z)*ce):(Y=(E.max.z-ue.z)*ce,ee=(E.min.z-ue.z)*ce),R>ee||Y>z)||((Y>R||R!==R)&&(R=Y),(ee<z||z!==z)&&(z=ee),z<0)?null:this.at(R>=0?R:z,O)}intersectsBox(E){return this.intersectBox(E,fs)!==null}intersectTriangle(E,O,R,z,V){Ss.subVectors(O,E),_s.subVectors(R,E),As.crossVectors(Ss,_s);let j,Y=this.direction.dot(As);if(Y>0){if(z)return null;j=1}else{if(!(Y<0))return null;j=-1,Y=-Y}bs.subVectors(this.origin,E);let ee=j*this.direction.dot(_s.crossVectors(bs,_s));if(ee<0)return null;let se=j*this.direction.dot(Ss.cross(bs));if(se<0||ee+se>Y)return null;let he=-j*bs.dot(As);return he<0?null:this.at(he/Y,V)}applyMatrix4(E){return this.origin.applyMatrix4(E),this.direction.transformDirection(E),this}equals(E){return E.origin.equals(this.origin)&&E.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}},Es=class{constructor(){Es.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}set(E,O,R,z,V,j,Y,ee,se,he,ce,ue,fe,ve,we,Se){let _e=this.elements;return _e[0]=E,_e[4]=O,_e[8]=R,_e[12]=z,_e[1]=V,_e[5]=j,_e[9]=Y,_e[13]=ee,_e[2]=se,_e[6]=he,_e[10]=ce,_e[14]=ue,_e[3]=fe,_e[7]=ve,_e[11]=we,_e[15]=Se,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new Es).fromArray(this.elements)}copy(E){let O=this.elements,R=E.elements;return O[0]=R[0],O[1]=R[1],O[2]=R[2],O[3]=R[3],O[4]=R[4],O[5]=R[5],O[6]=R[6],O[7]=R[7],O[8]=R[8],O[9]=R[9],O[10]=R[10],O[11]=R[11],O[12]=R[12],O[13]=R[13],O[14]=R[14],O[15]=R[15],this}copyPosition(E){let O=this.elements,R=E.elements;return O[12]=R[12],O[13]=R[13],O[14]=R[14],this}setFromMatrix3(E){let O=E.elements;return this.set(O[0],O[3],O[6],0,O[1],O[4],O[7],0,O[2],O[5],O[8],0,0,0,0,1),this}extractBasis(E,O,R){return E.setFromMatrixColumn(this,0),O.setFromMatrixColumn(this,1),R.setFromMatrixColumn(this,2),this}makeBasis(E,O,R){return this.set(E.x,O.x,R.x,0,E.y,O.y,R.y,0,E.z,O.z,R.z,0,0,0,0,1),this}extractRotation(E){let O=this.elements,R=E.elements,z=1/Cs.setFromMatrixColumn(E,0).length(),V=1/Cs.setFromMatrixColumn(E,1).length(),j=1/Cs.setFromMatrixColumn(E,2).length();return O[0]=R[0]*z,O[1]=R[1]*z,O[2]=R[2]*z,O[3]=0,O[4]=R[4]*V,O[5]=R[5]*V,O[6]=R[6]*V,O[7]=0,O[8]=R[8]*j,O[9]=R[9]*j,O[10]=R[10]*j,O[11]=0,O[12]=0,O[13]=0,O[14]=0,O[15]=1,this}makeRotationFromEuler(E){let O=this.elements,R=E.x,z=E.y,V=E.z,j=Math.cos(R),Y=Math.sin(R),ee=Math.cos(z),se=Math.sin(z),he=Math.cos(V),ce=Math.sin(V);if(E.order==="XYZ"){let E=j*he,R=j*ce,z=Y*he,V=Y*ce;O[0]=ee*he,O[4]=-ee*ce,O[8]=se,O[1]=R+z*se,O[5]=E-V*se,O[9]=-Y*ee,O[2]=V-E*se,O[6]=z+R*se,O[10]=j*ee}else if(E.order==="YXZ"){let E=ee*he,R=ee*ce,z=se*he,V=se*ce;O[0]=E+V*Y,O[4]=z*Y-R,O[8]=j*se,O[1]=j*ce,O[5]=j*he,O[9]=-Y,O[2]=R*Y-z,O[6]=V+E*Y,O[10]=j*ee}else if(E.order==="ZXY"){let E=ee*he,R=ee*ce,z=se*he,V=se*ce;O[0]=E-V*Y,O[4]=-j*ce,O[8]=z+R*Y,O[1]=R+z*Y,O[5]=j*he,O[9]=V-E*Y,O[2]=-j*se,O[6]=Y,O[10]=j*ee}else if(E.order==="ZYX"){let E=j*he,R=j*ce,z=Y*he,V=Y*ce;O[0]=ee*he,O[4]=z*se-R,O[8]=E*se+V,O[1]=ee*ce,O[5]=V*se+E,O[9]=R*se-z,O[2]=-se,O[6]=Y*ee,O[10]=j*ee}else if(E.order==="YZX"){let E=j*ee,R=j*se,z=Y*ee,V=Y*se;O[0]=ee*he,O[4]=V-E*ce,O[8]=z*ce+R,O[1]=ce,O[5]=j*he,O[9]=-Y*he,O[2]=-se*he,O[6]=R*ce+z,O[10]=E-V*ce}else if(E.order==="XZY"){let E=j*ee,R=j*se,z=Y*ee,V=Y*se;O[0]=ee*he,O[4]=-ce,O[8]=se*he,O[1]=E*ce+V,O[5]=j*he,O[9]=R*ce-z,O[2]=z*ce-R,O[6]=Y*he,O[10]=V*ce+E}return O[3]=0,O[7]=0,O[11]=0,O[12]=0,O[13]=0,O[14]=0,O[15]=1,this}makeRotationFromQuaternion(E){return this.compose(Ps,E,Ds)}lookAt(E,O,R){let z=this.elements;return Rs.subVectors(E,O),Rs.lengthSq()===0&&(Rs.z=1),Rs.normalize(),Is.crossVectors(R,Rs),Is.lengthSq()===0&&(Math.abs(R.z)===1?Rs.x+=1e-4:Rs.z+=1e-4,Rs.normalize(),Is.crossVectors(R,Rs)),Is.normalize(),Os.crossVectors(Rs,Is),z[0]=Is.x,z[4]=Os.x,z[8]=Rs.x,z[1]=Is.y,z[5]=Os.y,z[9]=Rs.y,z[2]=Is.z,z[6]=Os.z,z[10]=Rs.z,this}multiply(E){return this.multiplyMatrices(this,E)}premultiply(E){return this.multiplyMatrices(E,this)}multiplyMatrices(E,O){let R=E.elements,z=O.elements,V=this.elements,j=R[0],Y=R[4],ee=R[8],se=R[12],he=R[1],ce=R[5],ue=R[9],fe=R[13],ve=R[2],we=R[6],Se=R[10],_e=R[14],Ae=R[3],Ce=R[7],Te=R[11],Ie=R[15],Fe=z[0],Ue=z[4],Ge=z[8],qe=z[12],Xe=z[1],Qe=z[5],Ze=z[9],Ke=z[13],Je=z[2],$e=z[6],et=z[10],it=z[14],rt=z[3],at=z[7],lt=z[11],ct=z[15];return V[0]=j*Fe+Y*Xe+ee*Je+se*rt,V[4]=j*Ue+Y*Qe+ee*$e+se*at,V[8]=j*Ge+Y*Ze+ee*et+se*lt,V[12]=j*qe+Y*Ke+ee*it+se*ct,V[1]=he*Fe+ce*Xe+ue*Je+fe*rt,V[5]=he*Ue+ce*Qe+ue*$e+fe*at,V[9]=he*Ge+ce*Ze+ue*et+fe*lt,V[13]=he*qe+ce*Ke+ue*it+fe*ct,V[2]=ve*Fe+we*Xe+Se*Je+_e*rt,V[6]=ve*Ue+we*Qe+Se*$e+_e*at,V[10]=ve*Ge+we*Ze+Se*et+_e*lt,V[14]=ve*qe+we*Ke+Se*it+_e*ct,V[3]=Ae*Fe+Ce*Xe+Te*Je+Ie*rt,V[7]=Ae*Ue+Ce*Qe+Te*$e+Ie*at,V[11]=Ae*Ge+Ce*Ze+Te*et+Ie*lt,V[15]=Ae*qe+Ce*Ke+Te*it+Ie*ct,this}multiplyScalar(E){let O=this.elements;return O[0]*=E,O[4]*=E,O[8]*=E,O[12]*=E,O[1]*=E,O[5]*=E,O[9]*=E,O[13]*=E,O[2]*=E,O[6]*=E,O[10]*=E,O[14]*=E,O[3]*=E,O[7]*=E,O[11]*=E,O[15]*=E,this}determinant(){let E=this.elements,O=E[0],R=E[4],z=E[8],V=E[12],j=E[1],Y=E[5],ee=E[9],se=E[13],he=E[2],ce=E[6],ue=E[10],fe=E[14],ve=E[3],we=E[7],Se=E[11],_e=E[15];return ve*(+V*ee*ce-z*se*ce-V*Y*ue+R*se*ue+z*Y*fe-R*ee*fe)+we*(+O*ee*fe-O*se*ue+V*j*ue-z*j*fe+z*se*he-V*ee*he)+Se*(+O*se*ce-O*Y*fe-V*j*ce+R*j*fe+V*Y*he-R*se*he)+_e*(-z*Y*he-O*ee*ce+O*Y*ue+z*j*ce-R*j*ue+R*ee*he)}transpose(){let E,O=this.elements;return E=O[1],O[1]=O[4],O[4]=E,E=O[2],O[2]=O[8],O[8]=E,E=O[6],O[6]=O[9],O[9]=E,E=O[3],O[3]=O[12],O[12]=E,E=O[7],O[7]=O[13],O[13]=E,E=O[11],O[11]=O[14],O[14]=E,this}setPosition(E,O,R){let z=this.elements;return E.isVector3?(z[12]=E.x,z[13]=E.y,z[14]=E.z):(z[12]=E,z[13]=O,z[14]=R),this}invert(){let E=this.elements,O=E[0],R=E[1],z=E[2],V=E[3],j=E[4],Y=E[5],ee=E[6],se=E[7],he=E[8],ce=E[9],ue=E[10],fe=E[11],ve=E[12],we=E[13],Se=E[14],_e=E[15],Ae=ce*Se*se-we*ue*se+we*ee*fe-Y*Se*fe-ce*ee*_e+Y*ue*_e,Ce=ve*ue*se-he*Se*se-ve*ee*fe+j*Se*fe+he*ee*_e-j*ue*_e,Te=he*we*se-ve*ce*se+ve*Y*fe-j*we*fe-he*Y*_e+j*ce*_e,Ie=ve*ce*ee-he*we*ee-ve*Y*ue+j*we*ue+he*Y*Se-j*ce*Se,Fe=O*Ae+R*Ce+z*Te+V*Ie;if(Fe===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);let Ue=1/Fe;return E[0]=Ae*Ue,E[1]=(we*ue*V-ce*Se*V-we*z*fe+R*Se*fe+ce*z*_e-R*ue*_e)*Ue,E[2]=(Y*Se*V-we*ee*V+we*z*se-R*Se*se-Y*z*_e+R*ee*_e)*Ue,E[3]=(ce*ee*V-Y*ue*V-ce*z*se+R*ue*se+Y*z*fe-R*ee*fe)*Ue,E[4]=Ce*Ue,E[5]=(he*Se*V-ve*ue*V+ve*z*fe-O*Se*fe-he*z*_e+O*ue*_e)*Ue,E[6]=(ve*ee*V-j*Se*V-ve*z*se+O*Se*se+j*z*_e-O*ee*_e)*Ue,E[7]=(j*ue*V-he*ee*V+he*z*se-O*ue*se-j*z*fe+O*ee*fe)*Ue,E[8]=Te*Ue,E[9]=(ve*ce*V-he*we*V-ve*R*fe+O*we*fe+he*R*_e-O*ce*_e)*Ue,E[10]=(j*we*V-ve*Y*V+ve*R*se-O*we*se-j*R*_e+O*Y*_e)*Ue,E[11]=(he*Y*V-j*ce*V-he*R*se+O*ce*se+j*R*fe-O*Y*fe)*Ue,E[12]=Ie*Ue,E[13]=(he*we*z-ve*ce*z+ve*R*ue-O*we*ue-he*R*Se+O*ce*Se)*Ue,E[14]=(ve*Y*z-j*we*z-ve*R*ee+O*we*ee+j*R*Se-O*Y*Se)*Ue,E[15]=(j*ce*z-he*Y*z+he*R*ee-O*ce*ee-j*R*ue+O*Y*ue)*Ue,this}scale(E){let O=this.elements,R=E.x,z=E.y,V=E.z;return O[0]*=R,O[4]*=z,O[8]*=V,O[1]*=R,O[5]*=z,O[9]*=V,O[2]*=R,O[6]*=z,O[10]*=V,O[3]*=R,O[7]*=z,O[11]*=V,this}getMaxScaleOnAxis(){let E=this.elements,O=E[0]*E[0]+E[1]*E[1]+E[2]*E[2],R=E[4]*E[4]+E[5]*E[5]+E[6]*E[6],z=E[8]*E[8]+E[9]*E[9]+E[10]*E[10];return Math.sqrt(Math.max(O,R,z))}makeTranslation(E,O,R){return this.set(1,0,0,E,0,1,0,O,0,0,1,R,0,0,0,1),this}makeRotationX(E){let O=Math.cos(E),R=Math.sin(E);return this.set(1,0,0,0,0,O,-R,0,0,R,O,0,0,0,0,1),this}makeRotationY(E){let O=Math.cos(E),R=Math.sin(E);return this.set(O,0,R,0,0,1,0,0,-R,0,O,0,0,0,0,1),this}makeRotationZ(E){let O=Math.cos(E),R=Math.sin(E);return this.set(O,-R,0,0,R,O,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(E,O){let R=Math.cos(O),z=Math.sin(O),V=1-R,j=E.x,Y=E.y,ee=E.z,se=V*j,he=V*Y;return this.set(se*j+R,se*Y-z*ee,se*ee+z*Y,0,se*Y+z*ee,he*Y+R,he*ee-z*j,0,se*ee-z*Y,he*ee+z*j,V*ee*ee+R,0,0,0,0,1),this}makeScale(E,O,R){return this.set(E,0,0,0,0,O,0,0,0,0,R,0,0,0,0,1),this}makeShear(E,O,R,z,V,j){return this.set(1,R,V,0,E,1,j,0,O,z,1,0,0,0,0,1),this}compose(E,O,R){let z=this.elements,V=O._x,j=O._y,Y=O._z,ee=O._w,se=V+V,he=j+j,ce=Y+Y,ue=V*se,fe=V*he,ve=V*ce,we=j*he,Se=j*ce,_e=Y*ce,Ae=ee*se,Ce=ee*he,Te=ee*ce,Ie=R.x,Fe=R.y,Ue=R.z;return z[0]=(1-(we+_e))*Ie,z[1]=(fe+Te)*Ie,z[2]=(ve-Ce)*Ie,z[3]=0,z[4]=(fe-Te)*Fe,z[5]=(1-(ue+_e))*Fe,z[6]=(Se+Ae)*Fe,z[7]=0,z[8]=(ve+Ce)*Ue,z[9]=(Se-Ae)*Ue,z[10]=(1-(ue+we))*Ue,z[11]=0,z[12]=E.x,z[13]=E.y,z[14]=E.z,z[15]=1,this}decompose(E,O,R){let z=this.elements,V=Cs.set(z[0],z[1],z[2]).length(),j=Cs.set(z[4],z[5],z[6]).length(),Y=Cs.set(z[8],z[9],z[10]).length();this.determinant()<0&&(V=-V),E.x=z[12],E.y=z[13],E.z=z[14],Ts.copy(this);let ee=1/V,se=1/j,he=1/Y;return Ts.elements[0]*=ee,Ts.elements[1]*=ee,Ts.elements[2]*=ee,Ts.elements[4]*=se,Ts.elements[5]*=se,Ts.elements[6]*=se,Ts.elements[8]*=he,Ts.elements[9]*=he,Ts.elements[10]*=he,O.setFromRotationMatrix(Ts),R.x=V,R.y=j,R.z=Y,this}makePerspective(E,O,R,z,V,j){let Y=this.elements,ee=2*V/(O-E),se=2*V/(R-z),he=(O+E)/(O-E),ce=(R+z)/(R-z),ue=-(j+V)/(j-V),fe=-2*j*V/(j-V);return Y[0]=ee,Y[4]=0,Y[8]=he,Y[12]=0,Y[1]=0,Y[5]=se,Y[9]=ce,Y[13]=0,Y[2]=0,Y[6]=0,Y[10]=ue,Y[14]=fe,Y[3]=0,Y[7]=0,Y[11]=-1,Y[15]=0,this}makeOrthographic(E,O,R,z,V,j){let Y=this.elements,ee=1/(O-E),se=1/(R-z),he=1/(j-V),ce=(O+E)*ee,ue=(R+z)*se,fe=(j+V)*he;return Y[0]=2*ee,Y[4]=0,Y[8]=0,Y[12]=-ce,Y[1]=0,Y[5]=2*se,Y[9]=0,Y[13]=-ue,Y[2]=0,Y[6]=0,Y[10]=-2*he,Y[14]=-fe,Y[3]=0,Y[7]=0,Y[11]=0,Y[15]=1,this}equals(E){let O=this.elements,R=E.elements;for(let E=0;E<16;E++)if(O[E]!==R[E])return!1;return!0}fromArray(E,O=0){for(let R=0;R<16;R++)this.elements[R]=E[R+O];return this}toArray(E=[],O=0){let R=this.elements;return E[O]=R[0],E[O+1]=R[1],E[O+2]=R[2],E[O+3]=R[3],E[O+4]=R[4],E[O+5]=R[5],E[O+6]=R[6],E[O+7]=R[7],E[O+8]=R[8],E[O+9]=R[9],E[O+10]=R[10],E[O+11]=R[11],E[O+12]=R[12],E[O+13]=R[13],E[O+14]=R[14],E[O+15]=R[15],E}},Cs=new Wn,Ts=new Es,Ps=new Wn(0,0,0),Ds=new Wn(1,1,1),Is=new Wn,Os=new Wn,Rs=new Wn,Ls=new Es,Bs=new Hn,zs=class{constructor(E=0,O=0,R=0,z=zs.DEFAULT_ORDER){this.isEuler=!0,this._x=E,this._y=O,this._z=R,this._order=z}get x(){return this._x}set x(E){this._x=E,this._onChangeCallback()}get y(){return this._y}set y(E){this._y=E,this._onChangeCallback()}get z(){return this._z}set z(E){this._z=E,this._onChangeCallback()}get order(){return this._order}set order(E){this._order=E,this._onChangeCallback()}set(E,O,R,z=this._order){return this._x=E,this._y=O,this._z=R,this._order=z,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(E){return this._x=E._x,this._y=E._y,this._z=E._z,this._order=E._order,this._onChangeCallback(),this}setFromRotationMatrix(E,O=this._order,R=!0){let z=E.elements,V=z[0],j=z[4],Y=z[8],ee=z[1],se=z[5],he=z[9],ce=z[2],ue=z[6],fe=z[10];switch(O){case"XYZ":this._y=Math.asin(pi(Y,-1,1)),Math.abs(Y)<.9999999?(this._x=Math.atan2(-he,fe),this._z=Math.atan2(-j,V)):(this._x=Math.atan2(ue,se),this._z=0);break;case"YXZ":this._x=Math.asin(-pi(he,-1,1)),Math.abs(he)<.9999999?(this._y=Math.atan2(Y,fe),this._z=Math.atan2(ee,se)):(this._y=Math.atan2(-ce,V),this._z=0);break;case"ZXY":this._x=Math.asin(pi(ue,-1,1)),Math.abs(ue)<.9999999?(this._y=Math.atan2(-ce,fe),this._z=Math.atan2(-j,se)):(this._y=0,this._z=Math.atan2(ee,V));break;case"ZYX":this._y=Math.asin(-pi(ce,-1,1)),Math.abs(ce)<.9999999?(this._x=Math.atan2(ue,fe),this._z=Math.atan2(ee,V)):(this._x=0,this._z=Math.atan2(-j,se));break;case"YZX":this._z=Math.asin(pi(ee,-1,1)),Math.abs(ee)<.9999999?(this._x=Math.atan2(-he,se),this._y=Math.atan2(-ce,V)):(this._x=0,this._y=Math.atan2(Y,fe));break;case"XZY":this._z=Math.asin(-pi(j,-1,1)),Math.abs(j)<.9999999?(this._x=Math.atan2(ue,se),this._y=Math.atan2(Y,V)):(this._x=Math.atan2(-he,fe),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+O)}return this._order=O,R===!0&&this._onChangeCallback(),this}setFromQuaternion(E,O,R){return Ls.makeRotationFromQuaternion(E),this.setFromRotationMatrix(Ls,O,R)}setFromVector3(E,O=this._order){return this.set(E.x,E.y,E.z,O)}reorder(E){return Bs.setFromEuler(this),this.setFromQuaternion(Bs,E)}equals(E){return E._x===this._x&&E._y===this._y&&E._z===this._z&&E._order===this._order}fromArray(E){return this._x=E[0],this._y=E[1],this._z=E[2],E[3]!==void 0&&(this._order=E[3]),this._onChangeCallback(),this}toArray(E=[],O=0){return E[O]=this._x,E[O+1]=this._y,E[O+2]=this._z,E[O+3]=this._order,E}_onChange(E){return this._onChangeCallback=E,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}};zs.DEFAULT_ORDER="XYZ";var Fs=class{constructor(){this.mask=1}set(E){this.mask=1<<E>>>0}enable(E){this.mask|=1<<E}enableAll(){this.mask=-1}toggle(E){this.mask^=1<<E}disable(E){this.mask&=~(1<<E)}disableAll(){this.mask=0}test(E){return(this.mask&E.mask)!==0}isEnabled(E){return(this.mask&1<<E)!==0}},Ns=0,Us=new Wn,ks=new Hn,Vs=new Es,Gs=new Wn,Hs=new Wn,Ws=new Wn,qs=new Hn,Ys=new Wn(1,0,0),Qs=new Wn(0,1,0),Ks=new Wn(0,0,1),Js={type:"added"},ea={type:"removed"},ra=class extends pn{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:Ns++}),this.uuid=ss(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=ra.DEFAULT_UP.clone();let E=new Wn,O=new zs,R=new Hn,z=new Wn(1,1,1);function s(){R.setFromEuler(O,!1)}function o(){O.setFromQuaternion(R,void 0,!1)}O._onChange(s),R._onChange(o),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:E},rotation:{configurable:!0,enumerable:!0,value:O},quaternion:{configurable:!0,enumerable:!0,value:R},scale:{configurable:!0,enumerable:!0,value:z},modelViewMatrix:{value:new Es},normalMatrix:{value:new wn}}),this.matrix=new Es,this.matrixWorld=new Es,this.matrixAutoUpdate=ra.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=ra.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.layers=new Fs,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(E){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(E),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(E){return this.quaternion.premultiply(E),this}setRotationFromAxisAngle(E,O){this.quaternion.setFromAxisAngle(E,O)}setRotationFromEuler(E){this.quaternion.setFromEuler(E,!0)}setRotationFromMatrix(E){this.quaternion.setFromRotationMatrix(E)}setRotationFromQuaternion(E){this.quaternion.copy(E)}rotateOnAxis(E,O){return ks.setFromAxisAngle(E,O),this.quaternion.multiply(ks),this}rotateOnWorldAxis(E,O){return ks.setFromAxisAngle(E,O),this.quaternion.premultiply(ks),this}rotateX(E){return this.rotateOnAxis(Ys,E)}rotateY(E){return this.rotateOnAxis(Qs,E)}rotateZ(E){return this.rotateOnAxis(Ks,E)}translateOnAxis(E,O){return Us.copy(E).applyQuaternion(this.quaternion),this.position.add(Us.multiplyScalar(O)),this}translateX(E){return this.translateOnAxis(Ys,E)}translateY(E){return this.translateOnAxis(Qs,E)}translateZ(E){return this.translateOnAxis(Ks,E)}localToWorld(E){return this.updateWorldMatrix(!0,!1),E.applyMatrix4(this.matrixWorld)}worldToLocal(E){return this.updateWorldMatrix(!0,!1),E.applyMatrix4(Vs.copy(this.matrixWorld).invert())}lookAt(E,O,R){E.isVector3?Gs.copy(E):Gs.set(E,O,R);let z=this.parent;this.updateWorldMatrix(!0,!1),Hs.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Vs.lookAt(Hs,Gs,this.up):Vs.lookAt(Gs,Hs,this.up),this.quaternion.setFromRotationMatrix(Vs),z&&(Vs.extractRotation(z.matrixWorld),ks.setFromRotationMatrix(Vs),this.quaternion.premultiply(ks.invert()))}add(E){if(arguments.length>1){for(let E=0;E<arguments.length;E++)this.add(arguments[E]);return this}return E===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",E),this):(E&&E.isObject3D?(E.parent!==null&&E.parent.remove(E),E.parent=this,this.children.push(E),E.dispatchEvent(Js)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",E),this)}remove(E){if(arguments.length>1){for(let E=0;E<arguments.length;E++)this.remove(arguments[E]);return this}let O=this.children.indexOf(E);return O!==-1&&(E.parent=null,this.children.splice(O,1),E.dispatchEvent(ea)),this}removeFromParent(){let E=this.parent;return E!==null&&E.remove(this),this}clear(){for(let E=0;E<this.children.length;E++){let O=this.children[E];O.parent=null,O.dispatchEvent(ea)}return this.children.length=0,this}attach(E){return this.updateWorldMatrix(!0,!1),Vs.copy(this.matrixWorld).invert(),E.parent!==null&&(E.parent.updateWorldMatrix(!0,!1),Vs.multiply(E.parent.matrixWorld)),E.applyMatrix4(Vs),this.add(E),E.updateWorldMatrix(!1,!0),this}getObjectById(E){return this.getObjectByProperty("id",E)}getObjectByName(E){return this.getObjectByProperty("name",E)}getObjectByProperty(E,O){if(this[E]===O)return this;for(let R=0,z=this.children.length;R<z;R++){let z=this.children[R].getObjectByProperty(E,O);if(z!==void 0)return z}}getObjectsByProperty(E,O){let R=[];this[E]===O&&R.push(this);for(let z=0,V=this.children.length;z<V;z++){let V=this.children[z].getObjectsByProperty(E,O);V.length>0&&(R=R.concat(V))}return R}getWorldPosition(E){return this.updateWorldMatrix(!0,!1),E.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(E){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Hs,E,Ws),E}getWorldScale(E){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Hs,qs,E),E}getWorldDirection(E){this.updateWorldMatrix(!0,!1);let O=this.matrixWorld.elements;return E.set(O[8],O[9],O[10]).normalize()}raycast(){}traverse(E){E(this);let O=this.children;for(let R=0,z=O.length;R<z;R++)O[R].traverse(E)}traverseVisible(E){if(this.visible===!1)return;E(this);let O=this.children;for(let R=0,z=O.length;R<z;R++)O[R].traverseVisible(E)}traverseAncestors(E){let O=this.parent;O!==null&&(E(O),O.traverseAncestors(E))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(E){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||E)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,E=!0);let O=this.children;for(let R=0,z=O.length;R<z;R++){let z=O[R];(z.matrixWorldAutoUpdate===!0||E===!0)&&z.updateMatrixWorld(E)}}updateWorldMatrix(E,O){let R=this.parent;if(E===!0&&R!==null&&R.matrixWorldAutoUpdate===!0&&R.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),O===!0){let E=this.children;for(let O=0,R=E.length;O<R;O++){let R=E[O];R.matrixWorldAutoUpdate===!0&&R.updateWorldMatrix(!1,!0)}}}toJSON(E){let O=E===void 0||typeof E=="string",R={};O&&(E={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},R.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});let z={};z.uuid=this.uuid,z.type=this.type,this.name!==""&&(z.name=this.name),this.castShadow===!0&&(z.castShadow=!0),this.receiveShadow===!0&&(z.receiveShadow=!0),this.visible===!1&&(z.visible=!1),this.frustumCulled===!1&&(z.frustumCulled=!1),this.renderOrder!==0&&(z.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(z.userData=this.userData),z.layers=this.layers.mask,z.matrix=this.matrix.toArray(),this.matrixAutoUpdate===!1&&(z.matrixAutoUpdate=!1),this.isInstancedMesh&&(z.type="InstancedMesh",z.count=this.count,z.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(z.instanceColor=this.instanceColor.toJSON()));function s(O,R){return O[R.uuid]===void 0&&(O[R.uuid]=R.toJSON(E)),R.uuid}if(this.isScene)this.background&&(this.background.isColor?z.background=this.background.toJSON():this.background.isTexture&&(z.background=this.background.toJSON(E).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(z.environment=this.environment.toJSON(E).uuid);else if(this.isMesh||this.isLine||this.isPoints){z.geometry=s(E.geometries,this.geometry);let O=this.geometry.parameters;if(O!==void 0&&O.shapes!==void 0){let R=O.shapes;if(Array.isArray(R))for(let O=0,z=R.length;O<z;O++){let z=R[O];s(E.shapes,z)}else s(E.shapes,R)}}if(this.isSkinnedMesh&&(z.bindMode=this.bindMode,z.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(s(E.skeletons,this.skeleton),z.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){let O=[];for(let R=0,z=this.material.length;R<z;R++)O.push(s(E.materials,this.material[R]));z.material=O}else z.material=s(E.materials,this.material);if(this.children.length>0){z.children=[];for(let O=0;O<this.children.length;O++)z.children.push(this.children[O].toJSON(E).object)}if(this.animations.length>0){z.animations=[];for(let O=0;O<this.animations.length;O++){let R=this.animations[O];z.animations.push(s(E.animations,R))}}if(O){let O=o(E.geometries),z=o(E.materials),V=o(E.textures),j=o(E.images),Y=o(E.shapes),ee=o(E.skeletons),se=o(E.animations),he=o(E.nodes);O.length>0&&(R.geometries=O),z.length>0&&(R.materials=z),V.length>0&&(R.textures=V),j.length>0&&(R.images=j),Y.length>0&&(R.shapes=Y),ee.length>0&&(R.skeletons=ee),se.length>0&&(R.animations=se),he.length>0&&(R.nodes=he)}return R.object=z,R;function o(E){let O=[];for(let R in E){let z=E[R];delete z.metadata,O.push(z)}return O}}clone(E){return(new this.constructor).copy(this,E)}copy(E,O=!0){if(this.name=E.name,this.up.copy(E.up),this.position.copy(E.position),this.rotation.order=E.rotation.order,this.quaternion.copy(E.quaternion),this.scale.copy(E.scale),this.matrix.copy(E.matrix),this.matrixWorld.copy(E.matrixWorld),this.matrixAutoUpdate=E.matrixAutoUpdate,this.matrixWorldNeedsUpdate=E.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=E.matrixWorldAutoUpdate,this.layers.mask=E.layers.mask,this.visible=E.visible,this.castShadow=E.castShadow,this.receiveShadow=E.receiveShadow,this.frustumCulled=E.frustumCulled,this.renderOrder=E.renderOrder,this.userData=JSON.parse(JSON.stringify(E.userData)),O===!0)for(let O=0;O<E.children.length;O++){let R=E.children[O];this.add(R.clone())}return this}};ra.DEFAULT_UP=new Wn(0,1,0);ra.DEFAULT_MATRIX_AUTO_UPDATE=!0;ra.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;var sa=new Wn,aa=new Wn,oa=new Wn,la=new Wn,ha=new Wn,ca=new Wn,ua=new Wn,pa=new Wn,fa=new Wn,ma=new Wn,ga=class{constructor(E=new Wn,O=new Wn,R=new Wn){this.a=E,this.b=O,this.c=R}static getNormal(E,O,R,z){z.subVectors(R,O),sa.subVectors(E,O),z.cross(sa);let V=z.lengthSq();return V>0?z.multiplyScalar(1/Math.sqrt(V)):z.set(0,0,0)}static getBarycoord(E,O,R,z,V){sa.subVectors(z,O),aa.subVectors(R,O),oa.subVectors(E,O);let j=sa.dot(sa),Y=sa.dot(aa),ee=sa.dot(oa),se=aa.dot(aa),he=aa.dot(oa),ce=j*se-Y*Y;if(ce===0)return V.set(-2,-1,-1);let ue=1/ce,fe=(se*ee-Y*he)*ue,ve=(j*he-Y*ee)*ue;return V.set(1-fe-ve,ve,fe)}static containsPoint(E,O,R,z){return this.getBarycoord(E,O,R,z,la),la.x>=0&&la.y>=0&&la.x+la.y<=1}static getUV(E,O,R,z,V,j,Y,ee){return this.getBarycoord(E,O,R,z,la),ee.set(0,0),ee.addScaledVector(V,la.x),ee.addScaledVector(j,la.y),ee.addScaledVector(Y,la.z),ee}static isFrontFacing(E,O,R,z){return sa.subVectors(R,O),aa.subVectors(E,O),sa.cross(aa).dot(z)<0}set(E,O,R){return this.a.copy(E),this.b.copy(O),this.c.copy(R),this}setFromPointsAndIndices(E,O,R,z){return this.a.copy(E[O]),this.b.copy(E[R]),this.c.copy(E[z]),this}setFromAttributeAndIndices(E,O,R,z){return this.a.fromBufferAttribute(E,O),this.b.fromBufferAttribute(E,R),this.c.fromBufferAttribute(E,z),this}clone(){return(new this.constructor).copy(this)}copy(E){return this.a.copy(E.a),this.b.copy(E.b),this.c.copy(E.c),this}getArea(){return sa.subVectors(this.c,this.b),aa.subVectors(this.a,this.b),sa.cross(aa).length()*.5}getMidpoint(E){return E.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(E){return ga.getNormal(this.a,this.b,this.c,E)}getPlane(E){return E.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(E,O){return ga.getBarycoord(E,this.a,this.b,this.c,O)}getUV(E,O,R,z,V){return ga.getUV(E,this.a,this.b,this.c,O,R,z,V)}containsPoint(E){return ga.containsPoint(E,this.a,this.b,this.c)}isFrontFacing(E){return ga.isFrontFacing(this.a,this.b,this.c,E)}intersectsBox(E){return E.intersectsTriangle(this)}closestPointToPoint(E,O){let R,z,V=this.a,j=this.b,Y=this.c;ha.subVectors(j,V),ca.subVectors(Y,V),pa.subVectors(E,V);let ee=ha.dot(pa),se=ca.dot(pa);if(ee<=0&&se<=0)return O.copy(V);fa.subVectors(E,j);let he=ha.dot(fa),ce=ca.dot(fa);if(he>=0&&ce<=he)return O.copy(j);let ue=ee*ce-he*se;if(ue<=0&&ee>=0&&he<=0)return R=ee/(ee-he),O.copy(V).addScaledVector(ha,R);ma.subVectors(E,Y);let fe=ha.dot(ma),ve=ca.dot(ma);if(ve>=0&&fe<=ve)return O.copy(Y);let we=fe*se-ee*ve;if(we<=0&&se>=0&&ve<=0)return z=se/(se-ve),O.copy(V).addScaledVector(ca,z);let Se=he*ve-fe*ce;if(Se<=0&&ce-he>=0&&fe-ve>=0)return ua.subVectors(Y,j),z=(ce-he)/(ce-he+(fe-ve)),O.copy(j).addScaledVector(ua,z);let _e=1/(Se+we+ue);return R=we*_e,z=ue*_e,O.copy(V).addScaledVector(ha,R).addScaledVector(ca,z)}equals(E){return E.a.equals(this.a)&&E.b.equals(this.b)&&E.c.equals(this.c)}},va=0,ya=class extends pn{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:va++}),this.uuid=ss(),this.name="",this.type="Material",this.blending=Xe,this.side=Fe,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=pt,this.blendDst=mt,this.blendEquation=$e,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=Lt,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=an,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=sn,this.stencilZFail=sn,this.stencilZPass=sn,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(E){this._alphaTest>0!=E>0&&this.version++,this._alphaTest=E}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(E){if(E!==void 0)for(let O in E){let R=E[O];if(R===void 0){console.warn("THREE.Material: '"+O+"' parameter is undefined.");continue}let z=this[O];z!==void 0?z&&z.isColor?z.set(R):z&&z.isVector3&&R&&R.isVector3?z.copy(R):this[O]=R:console.warn("THREE."+this.type+": '"+O+"' is not a property of this material.")}}toJSON(E){let O=E===void 0||typeof E=="string";O&&(E={textures:{},images:{}});let R={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};R.uuid=this.uuid,R.type=this.type,this.name!==""&&(R.name=this.name),this.color&&this.color.isColor&&(R.color=this.color.getHex()),this.roughness!==void 0&&(R.roughness=this.roughness),this.metalness!==void 0&&(R.metalness=this.metalness),this.sheen!==void 0&&(R.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(R.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(R.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(R.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(R.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(R.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(R.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(R.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(R.shininess=this.shininess),this.clearcoat!==void 0&&(R.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(R.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(R.clearcoatMap=this.clearcoatMap.toJSON(E).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(R.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(E).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(R.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(E).uuid,R.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.iridescence!==void 0&&(R.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(R.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(R.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(R.iridescenceMap=this.iridescenceMap.toJSON(E).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(R.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(E).uuid),this.map&&this.map.isTexture&&(R.map=this.map.toJSON(E).uuid),this.matcap&&this.matcap.isTexture&&(R.matcap=this.matcap.toJSON(E).uuid),this.alphaMap&&this.alphaMap.isTexture&&(R.alphaMap=this.alphaMap.toJSON(E).uuid),this.lightMap&&this.lightMap.isTexture&&(R.lightMap=this.lightMap.toJSON(E).uuid,R.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(R.aoMap=this.aoMap.toJSON(E).uuid,R.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(R.bumpMap=this.bumpMap.toJSON(E).uuid,R.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(R.normalMap=this.normalMap.toJSON(E).uuid,R.normalMapType=this.normalMapType,R.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(R.displacementMap=this.displacementMap.toJSON(E).uuid,R.displacementScale=this.displacementScale,R.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(R.roughnessMap=this.roughnessMap.toJSON(E).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(R.metalnessMap=this.metalnessMap.toJSON(E).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(R.emissiveMap=this.emissiveMap.toJSON(E).uuid),this.specularMap&&this.specularMap.isTexture&&(R.specularMap=this.specularMap.toJSON(E).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(R.specularIntensityMap=this.specularIntensityMap.toJSON(E).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(R.specularColorMap=this.specularColorMap.toJSON(E).uuid),this.envMap&&this.envMap.isTexture&&(R.envMap=this.envMap.toJSON(E).uuid,this.combine!==void 0&&(R.combine=this.combine)),this.envMapIntensity!==void 0&&(R.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(R.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(R.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(R.gradientMap=this.gradientMap.toJSON(E).uuid),this.transmission!==void 0&&(R.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(R.transmissionMap=this.transmissionMap.toJSON(E).uuid),this.thickness!==void 0&&(R.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(R.thicknessMap=this.thicknessMap.toJSON(E).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(R.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(R.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(R.size=this.size),this.shadowSide!==null&&(R.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(R.sizeAttenuation=this.sizeAttenuation),this.blending!==Xe&&(R.blending=this.blending),this.side!==Fe&&(R.side=this.side),this.vertexColors&&(R.vertexColors=!0),this.opacity<1&&(R.opacity=this.opacity),this.transparent===!0&&(R.transparent=this.transparent),R.depthFunc=this.depthFunc,R.depthTest=this.depthTest,R.depthWrite=this.depthWrite,R.colorWrite=this.colorWrite,R.stencilWrite=this.stencilWrite,R.stencilWriteMask=this.stencilWriteMask,R.stencilFunc=this.stencilFunc,R.stencilRef=this.stencilRef,R.stencilFuncMask=this.stencilFuncMask,R.stencilFail=this.stencilFail,R.stencilZFail=this.stencilZFail,R.stencilZPass=this.stencilZPass,this.rotation!==void 0&&this.rotation!==0&&(R.rotation=this.rotation),this.polygonOffset===!0&&(R.polygonOffset=!0),this.polygonOffsetFactor!==0&&(R.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(R.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(R.linewidth=this.linewidth),this.dashSize!==void 0&&(R.dashSize=this.dashSize),this.gapSize!==void 0&&(R.gapSize=this.gapSize),this.scale!==void 0&&(R.scale=this.scale),this.dithering===!0&&(R.dithering=!0),this.alphaTest>0&&(R.alphaTest=this.alphaTest),this.alphaToCoverage===!0&&(R.alphaToCoverage=this.alphaToCoverage),this.premultipliedAlpha===!0&&(R.premultipliedAlpha=this.premultipliedAlpha),this.forceSinglePass===!0&&(R.forceSinglePass=this.forceSinglePass),this.wireframe===!0&&(R.wireframe=this.wireframe),this.wireframeLinewidth>1&&(R.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(R.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(R.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(R.flatShading=this.flatShading),this.visible===!1&&(R.visible=!1),this.toneMapped===!1&&(R.toneMapped=!1),this.fog===!1&&(R.fog=!1),Object.keys(this.userData).length>0&&(R.userData=this.userData);function i(E){let O=[];for(let R in E){let z=E[R];delete z.metadata,O.push(z)}return O}if(O){let O=i(E.textures),z=i(E.images);O.length>0&&(R.textures=O),z.length>0&&(R.images=z)}return R}clone(){return(new this.constructor).copy(this)}copy(E){this.name=E.name,this.blending=E.blending,this.side=E.side,this.vertexColors=E.vertexColors,this.opacity=E.opacity,this.transparent=E.transparent,this.blendSrc=E.blendSrc,this.blendDst=E.blendDst,this.blendEquation=E.blendEquation,this.blendSrcAlpha=E.blendSrcAlpha,this.blendDstAlpha=E.blendDstAlpha,this.blendEquationAlpha=E.blendEquationAlpha,this.depthFunc=E.depthFunc,this.depthTest=E.depthTest,this.depthWrite=E.depthWrite,this.stencilWriteMask=E.stencilWriteMask,this.stencilFunc=E.stencilFunc,this.stencilRef=E.stencilRef,this.stencilFuncMask=E.stencilFuncMask,this.stencilFail=E.stencilFail,this.stencilZFail=E.stencilZFail,this.stencilZPass=E.stencilZPass,this.stencilWrite=E.stencilWrite;let O=E.clippingPlanes,R=null;if(O!==null){let E=O.length;R=new Array(E);for(let z=0;z!==E;++z)R[z]=O[z].clone()}return this.clippingPlanes=R,this.clipIntersection=E.clipIntersection,this.clipShadows=E.clipShadows,this.shadowSide=E.shadowSide,this.colorWrite=E.colorWrite,this.precision=E.precision,this.polygonOffset=E.polygonOffset,this.polygonOffsetFactor=E.polygonOffsetFactor,this.polygonOffsetUnits=E.polygonOffsetUnits,this.dithering=E.dithering,this.alphaTest=E.alphaTest,this.alphaToCoverage=E.alphaToCoverage,this.premultipliedAlpha=E.premultipliedAlpha,this.forceSinglePass=E.forceSinglePass,this.visible=E.visible,this.toneMapped=E.toneMapped,this.userData=JSON.parse(JSON.stringify(E.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(E){E===!0&&this.version++}},xa=class extends ya{constructor(E){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new On(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Gt,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(E)}copy(E){return super.copy(E),this.color.copy(E.color),this.map=E.map,this.lightMap=E.lightMap,this.lightMapIntensity=E.lightMapIntensity,this.aoMap=E.aoMap,this.aoMapIntensity=E.aoMapIntensity,this.specularMap=E.specularMap,this.alphaMap=E.alphaMap,this.envMap=E.envMap,this.combine=E.combine,this.reflectivity=E.reflectivity,this.refractionRatio=E.refractionRatio,this.wireframe=E.wireframe,this.wireframeLinewidth=E.wireframeLinewidth,this.wireframeLinecap=E.wireframeLinecap,this.wireframeLinejoin=E.wireframeLinejoin,this.fog=E.fog,this}},ba=new Wn,wa=new bn,Sa=class{constructor(E,O,R=!1){if(Array.isArray(E))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=E,this.itemSize=O,this.count=E!==void 0?E.length/O:0,this.normalized=R,this.usage=on,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(E){E===!0&&this.version++}setUsage(E){return this.usage=E,this}copy(E){return this.name=E.name,this.array=new E.array.constructor(E.array),this.itemSize=E.itemSize,this.count=E.count,this.normalized=E.normalized,this.usage=E.usage,this}copyAt(E,O,R){E*=this.itemSize,R*=O.itemSize;for(let z=0,V=this.itemSize;z<V;z++)this.array[E+z]=O.array[R+z];return this}copyArray(E){return this.array.set(E),this}applyMatrix3(E){if(this.itemSize===2)for(let O=0,R=this.count;O<R;O++)wa.fromBufferAttribute(this,O),wa.applyMatrix3(E),this.setXY(O,wa.x,wa.y);else if(this.itemSize===3)for(let O=0,R=this.count;O<R;O++)ba.fromBufferAttribute(this,O),ba.applyMatrix3(E),this.setXYZ(O,ba.x,ba.y,ba.z);return this}applyMatrix4(E){for(let O=0,R=this.count;O<R;O++)ba.fromBufferAttribute(this,O),ba.applyMatrix4(E),this.setXYZ(O,ba.x,ba.y,ba.z);return this}applyNormalMatrix(E){for(let O=0,R=this.count;O<R;O++)ba.fromBufferAttribute(this,O),ba.applyNormalMatrix(E),this.setXYZ(O,ba.x,ba.y,ba.z);return this}transformDirection(E){for(let O=0,R=this.count;O<R;O++)ba.fromBufferAttribute(this,O),ba.transformDirection(E),this.setXYZ(O,ba.x,ba.y,ba.z);return this}set(E,O=0){return this.array.set(E,O),this}getX(E){let O=this.array[E*this.itemSize];return this.normalized&&(O=da(O,this.array)),O}setX(E,O){return this.normalized&&(O=Sr(O,this.array)),this.array[E*this.itemSize]=O,this}getY(E){let O=this.array[E*this.itemSize+1];return this.normalized&&(O=da(O,this.array)),O}setY(E,O){return this.normalized&&(O=Sr(O,this.array)),this.array[E*this.itemSize+1]=O,this}getZ(E){let O=this.array[E*this.itemSize+2];return this.normalized&&(O=da(O,this.array)),O}setZ(E,O){return this.normalized&&(O=Sr(O,this.array)),this.array[E*this.itemSize+2]=O,this}getW(E){let O=this.array[E*this.itemSize+3];return this.normalized&&(O=da(O,this.array)),O}setW(E,O){return this.normalized&&(O=Sr(O,this.array)),this.array[E*this.itemSize+3]=O,this}setXY(E,O,R){return E*=this.itemSize,this.normalized&&(O=Sr(O,this.array),R=Sr(R,this.array)),this.array[E+0]=O,this.array[E+1]=R,this}setXYZ(E,O,R,z){return E*=this.itemSize,this.normalized&&(O=Sr(O,this.array),R=Sr(R,this.array),z=Sr(z,this.array)),this.array[E+0]=O,this.array[E+1]=R,this.array[E+2]=z,this}setXYZW(E,O,R,z,V){return E*=this.itemSize,this.normalized&&(O=Sr(O,this.array),R=Sr(R,this.array),z=Sr(z,this.array),V=Sr(V,this.array)),this.array[E+0]=O,this.array[E+1]=R,this.array[E+2]=z,this.array[E+3]=V,this}onUpload(E){return this.onUploadCallback=E,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){let E={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(E.name=this.name),this.usage!==on&&(E.usage=this.usage),(this.updateRange.offset!==0||this.updateRange.count!==-1)&&(E.updateRange=this.updateRange),E}copyColorsArray(){console.error("THREE.BufferAttribute: copyColorsArray() was removed in r144.")}copyVector2sArray(){console.error("THREE.BufferAttribute: copyVector2sArray() was removed in r144.")}copyVector3sArray(){console.error("THREE.BufferAttribute: copyVector3sArray() was removed in r144.")}copyVector4sArray(){console.error("THREE.BufferAttribute: copyVector4sArray() was removed in r144.")}};var _a=class extends Sa{constructor(E,O,R){super(new Uint16Array(E),O,R)}};var Aa=class extends Sa{constructor(E,O,R){super(new Uint32Array(E),O,R)}};var Ma=class extends Sa{constructor(E,O,R){super(new Float32Array(E),O,R)}};var Ea=0,Ta=new Es,Da=new ra,Ia=new Wn,Ra=new Yn,za=new Yn,Fa=new Wn,Na=class extends pn{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:Ea++}),this.uuid=ss(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(E){return Array.isArray(E)?this.index=new(xP(E)?Aa:_a)(E,1):this.index=E,this}getAttribute(E){return this.attributes[E]}setAttribute(E,O){return this.attributes[E]=O,this}deleteAttribute(E){return delete this.attributes[E],this}hasAttribute(E){return this.attributes[E]!==void 0}addGroup(E,O,R=0){this.groups.push({start:E,count:O,materialIndex:R})}clearGroups(){this.groups=[]}setDrawRange(E,O){this.drawRange.start=E,this.drawRange.count=O}applyMatrix4(E){let O=this.attributes.position;O!==void 0&&(O.applyMatrix4(E),O.needsUpdate=!0);let R=this.attributes.normal;if(R!==void 0){let O=(new wn).getNormalMatrix(E);R.applyNormalMatrix(O),R.needsUpdate=!0}let z=this.attributes.tangent;return z!==void 0&&(z.transformDirection(E),z.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(E){return Ta.makeRotationFromQuaternion(E),this.applyMatrix4(Ta),this}rotateX(E){return Ta.makeRotationX(E),this.applyMatrix4(Ta),this}rotateY(E){return Ta.makeRotationY(E),this.applyMatrix4(Ta),this}rotateZ(E){return Ta.makeRotationZ(E),this.applyMatrix4(Ta),this}translate(E,O,R){return Ta.makeTranslation(E,O,R),this.applyMatrix4(Ta),this}scale(E,O,R){return Ta.makeScale(E,O,R),this.applyMatrix4(Ta),this}lookAt(E){return Da.lookAt(E),Da.updateMatrix(),this.applyMatrix4(Da.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Ia).negate(),this.translate(Ia.x,Ia.y,Ia.z),this}setFromPoints(E){let O=[];for(let R=0,z=E.length;R<z;R++){let z=E[R];O.push(z.x,z.y,z.z||0)}return this.setAttribute("position",new Ma(O,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Yn);let E=this.attributes.position,O=this.morphAttributes.position;if(E&&E.isGLBufferAttribute)console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new Wn(-1/0,-1/0,-1/0),new Wn(1/0,1/0,1/0));else{if(E!==void 0){if(this.boundingBox.setFromBufferAttribute(E),O)for(let E=0,R=O.length;E<R;E++){let R=O[E];Ra.setFromBufferAttribute(R),this.morphTargetsRelative?(Fa.addVectors(this.boundingBox.min,Ra.min),this.boundingBox.expandByPoint(Fa),Fa.addVectors(this.boundingBox.max,Ra.max),this.boundingBox.expandByPoint(Fa)):(this.boundingBox.expandByPoint(Ra.min),this.boundingBox.expandByPoint(Ra.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new ps);let E=this.attributes.position,O=this.morphAttributes.position;if(E&&E.isGLBufferAttribute)console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new Wn,1/0);else if(E){let R=this.boundingSphere.center;if(Ra.setFromBufferAttribute(E),O)for(let E=0,R=O.length;E<R;E++){let R=O[E];za.setFromBufferAttribute(R),this.morphTargetsRelative?(Fa.addVectors(Ra.min,za.min),Ra.expandByPoint(Fa),Fa.addVectors(Ra.max,za.max),Ra.expandByPoint(Fa)):(Ra.expandByPoint(za.min),Ra.expandByPoint(za.max))}Ra.getCenter(R);let z=0;for(let O=0,V=E.count;O<V;O++)Fa.fromBufferAttribute(E,O),z=Math.max(z,R.distanceToSquared(Fa));if(O)for(let V=0,j=O.length;V<j;V++){let j=O[V],Y=this.morphTargetsRelative;for(let O=0,V=j.count;O<V;O++)Fa.fromBufferAttribute(j,O),Y&&(Ia.fromBufferAttribute(E,O),Fa.add(Ia)),z=Math.max(z,R.distanceToSquared(Fa))}this.boundingSphere.radius=Math.sqrt(z),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){let E=this.index,O=this.attributes;if(E===null||O.position===void 0||O.normal===void 0||O.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}let R=E.array,z=O.position.array,V=O.normal.array,j=O.uv.array,Y=z.length/3;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new Sa(new Float32Array(4*Y),4));let ee=this.getAttribute("tangent").array,se=[],he=[];for(let E=0;E<Y;E++)se[E]=new Wn,he[E]=new Wn;let ce=new Wn,ue=new Wn,fe=new Wn,ve=new bn,we=new bn,Se=new bn,_e=new Wn,Ae=new Wn;function v(E,O,R){ce.fromArray(z,E*3),ue.fromArray(z,O*3),fe.fromArray(z,R*3),ve.fromArray(j,E*2),we.fromArray(j,O*2),Se.fromArray(j,R*2),ue.sub(ce),fe.sub(ce),we.sub(ve),Se.sub(ve);let V=1/(we.x*Se.y-Se.x*we.y);!isFinite(V)||(_e.copy(ue).multiplyScalar(Se.y).addScaledVector(fe,-we.y).multiplyScalar(V),Ae.copy(fe).multiplyScalar(we.x).addScaledVector(ue,-Se.x).multiplyScalar(V),se[E].add(_e),se[O].add(_e),se[R].add(_e),he[E].add(Ae),he[O].add(Ae),he[R].add(Ae))}let Ce=this.groups;Ce.length===0&&(Ce=[{start:0,count:R.length}]);for(let E=0,O=Ce.length;E<O;++E){let O=Ce[E],z=O.start,V=O.count;for(let E=z,O=z+V;E<O;E+=3)v(R[E+0],R[E+1],R[E+2])}let Te=new Wn,Ie=new Wn,Fe=new Wn,Ue=new Wn;function M(E){Fe.fromArray(V,E*3),Ue.copy(Fe);let O=se[E];Te.copy(O),Te.sub(Fe.multiplyScalar(Fe.dot(O))).normalize(),Ie.crossVectors(Ue,O);let R=Ie.dot(he[E])<0?-1:1;ee[E*4]=Te.x,ee[E*4+1]=Te.y,ee[E*4+2]=Te.z,ee[E*4+3]=R}for(let E=0,O=Ce.length;E<O;++E){let O=Ce[E],z=O.start,V=O.count;for(let E=z,O=z+V;E<O;E+=3)M(R[E+0]),M(R[E+1]),M(R[E+2])}}computeVertexNormals(){let E=this.index,O=this.getAttribute("position");if(O!==void 0){let R=this.getAttribute("normal");if(R===void 0)R=new Sa(new Float32Array(O.count*3),3),this.setAttribute("normal",R);else for(let E=0,O=R.count;E<O;E++)R.setXYZ(E,0,0,0);let z=new Wn,V=new Wn,j=new Wn,Y=new Wn,ee=new Wn,se=new Wn,he=new Wn,ce=new Wn;if(E)for(let ue=0,fe=E.count;ue<fe;ue+=3){let fe=E.getX(ue+0),ve=E.getX(ue+1),we=E.getX(ue+2);z.fromBufferAttribute(O,fe),V.fromBufferAttribute(O,ve),j.fromBufferAttribute(O,we),he.subVectors(j,V),ce.subVectors(z,V),he.cross(ce),Y.fromBufferAttribute(R,fe),ee.fromBufferAttribute(R,ve),se.fromBufferAttribute(R,we),Y.add(he),ee.add(he),se.add(he),R.setXYZ(fe,Y.x,Y.y,Y.z),R.setXYZ(ve,ee.x,ee.y,ee.z),R.setXYZ(we,se.x,se.y,se.z)}else for(let E=0,Y=O.count;E<Y;E+=3)z.fromBufferAttribute(O,E+0),V.fromBufferAttribute(O,E+1),j.fromBufferAttribute(O,E+2),he.subVectors(j,V),ce.subVectors(z,V),he.cross(ce),R.setXYZ(E+0,he.x,he.y,he.z),R.setXYZ(E+1,he.x,he.y,he.z),R.setXYZ(E+2,he.x,he.y,he.z);this.normalizeNormals(),R.needsUpdate=!0}}merge(){return console.error("THREE.BufferGeometry.merge() has been removed. Use THREE.BufferGeometryUtils.mergeBufferGeometries() instead."),this}normalizeNormals(){let E=this.attributes.normal;for(let O=0,R=E.count;O<R;O++)Fa.fromBufferAttribute(E,O),Fa.normalize(),E.setXYZ(O,Fa.x,Fa.y,Fa.z)}toNonIndexed(){function t(E,O){let R=E.array,z=E.itemSize,V=E.normalized,j=new R.constructor(O.length*z),Y=0,ee=0;for(let V=0,se=O.length;V<se;V++){Y=E.isInterleavedBufferAttribute?O[V]*E.data.stride+E.offset:O[V]*z;for(let E=0;E<z;E++)j[ee++]=R[Y++]}return new Sa(j,z,V)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;let E=new Na,O=this.index.array,R=this.attributes;for(let z in R){let V=R[z],j=t(V,O);E.setAttribute(z,j)}let z=this.morphAttributes;for(let R in z){let V=[],j=z[R];for(let E=0,R=j.length;E<R;E++){let R=j[E],z=t(R,O);V.push(z)}E.morphAttributes[R]=V}E.morphTargetsRelative=this.morphTargetsRelative;let V=this.groups;for(let O=0,R=V.length;O<R;O++){let R=V[O];E.addGroup(R.start,R.count,R.materialIndex)}return E}toJSON(){let E={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(E.uuid=this.uuid,E.type=this.type,this.name!==""&&(E.name=this.name),Object.keys(this.userData).length>0&&(E.userData=this.userData),this.parameters!==void 0){let O=this.parameters;for(let R in O)O[R]!==void 0&&(E[R]=O[R]);return E}E.data={attributes:{}};let O=this.index;O!==null&&(E.data.index={type:O.array.constructor.name,array:Array.prototype.slice.call(O.array)});let R=this.attributes;for(let O in R){let z=R[O];E.data.attributes[O]=z.toJSON(E.data)}let z={},V=!1;for(let O in this.morphAttributes){let R=this.morphAttributes[O],j=[];for(let O=0,z=R.length;O<z;O++){let z=R[O];j.push(z.toJSON(E.data))}j.length>0&&(z[O]=j,V=!0)}V&&(E.data.morphAttributes=z,E.data.morphTargetsRelative=this.morphTargetsRelative);let j=this.groups;j.length>0&&(E.data.groups=JSON.parse(JSON.stringify(j)));let Y=this.boundingSphere;return Y!==null&&(E.data.boundingSphere={center:Y.center.toArray(),radius:Y.radius}),E}clone(){return(new this.constructor).copy(this)}copy(E){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;let O={};this.name=E.name;let R=E.index;R!==null&&this.setIndex(R.clone(O));let z=E.attributes;for(let E in z){let R=z[E];this.setAttribute(E,R.clone(O))}let V=E.morphAttributes;for(let E in V){let R=[],z=V[E];for(let E=0,V=z.length;E<V;E++)R.push(z[E].clone(O));this.morphAttributes[E]=R}this.morphTargetsRelative=E.morphTargetsRelative;let j=E.groups;for(let E=0,O=j.length;E<O;E++){let O=j[E];this.addGroup(O.start,O.count,O.materialIndex)}let Y=E.boundingBox;Y!==null&&(this.boundingBox=Y.clone());let ee=E.boundingSphere;return ee!==null&&(this.boundingSphere=ee.clone()),this.drawRange.start=E.drawRange.start,this.drawRange.count=E.drawRange.count,this.userData=E.userData,E.parameters!==void 0&&(this.parameters=Object.assign({},E.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}},Ua=new Es,ka=new Ms,Va=new ps,ja=new Wn,Ga=new Wn,Ha=new Wn,qa=new Wn,Xa=new Wn,Ya=new bn,Qa=new bn,Ka=new bn,Ja=new Wn,$a=new Wn,eo=class extends ra{constructor(E=new Na,O=new xa){super(),this.isMesh=!0,this.type="Mesh",this.geometry=E,this.material=O,this.updateMorphTargets()}copy(E,O){return super.copy(E,O),E.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=E.morphTargetInfluences.slice()),E.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},E.morphTargetDictionary)),this.material=E.material,this.geometry=E.geometry,this}updateMorphTargets(){let E=this.geometry.morphAttributes,O=Object.keys(E);if(O.length>0){let R=E[O[0]];if(R!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let E=0,O=R.length;E<O;E++){let O=R[E].name||String(E);this.morphTargetInfluences.push(0),this.morphTargetDictionary[O]=E}}}}getVertexPosition(E,O){let R=this.geometry,z=R.attributes.position,V=R.morphAttributes.position,j=R.morphTargetsRelative;O.fromBufferAttribute(z,E);let Y=this.morphTargetInfluences;if(V&&Y){Xa.set(0,0,0);for(let R=0,z=V.length;R<z;R++){let z=Y[R],ee=V[R];z!==0&&(qa.fromBufferAttribute(ee,E),j?Xa.addScaledVector(qa,z):Xa.addScaledVector(qa.sub(O),z))}O.add(Xa)}return this.isSkinnedMesh&&this.boneTransform(E,O),O}raycast(E,O){let R=this.geometry,z=this.material,V=this.matrixWorld;if(z===void 0||(R.boundingSphere===null&&R.computeBoundingSphere(),Va.copy(R.boundingSphere),Va.applyMatrix4(V),E.ray.intersectsSphere(Va)===!1)||(Ua.copy(V).invert(),ka.copy(E.ray).applyMatrix4(Ua),R.boundingBox!==null&&ka.intersectsBox(R.boundingBox)===!1))return;let j,Y=R.index,ee=R.attributes.position,se=R.attributes.uv,he=R.attributes.uv2,ce=R.groups,ue=R.drawRange;if(Y!==null)if(Array.isArray(z))for(let R=0,V=ce.length;R<V;R++){let V=ce[R],ee=z[V.materialIndex],fe=Math.max(V.start,ue.start),ve=Math.min(Y.count,Math.min(V.start+V.count,ue.start+ue.count));for(let R=fe,z=ve;R<z;R+=3){let z=Y.getX(R),ce=Y.getX(R+1),ue=Y.getX(R+2);j=Yg(this,ee,E,ka,se,he,z,ce,ue),j&&(j.faceIndex=Math.floor(R/3),j.face.materialIndex=V.materialIndex,O.push(j))}}else{let R=Math.max(0,ue.start),V=Math.min(Y.count,ue.start+ue.count);for(let ee=R,ce=V;ee<ce;ee+=3){let R=Y.getX(ee),V=Y.getX(ee+1),ce=Y.getX(ee+2);j=Yg(this,z,E,ka,se,he,R,V,ce),j&&(j.faceIndex=Math.floor(ee/3),O.push(j))}}else if(ee!==void 0)if(Array.isArray(z))for(let R=0,V=ce.length;R<V;R++){let V=ce[R],Y=z[V.materialIndex],fe=Math.max(V.start,ue.start),ve=Math.min(ee.count,Math.min(V.start+V.count,ue.start+ue.count));for(let R=fe,z=ve;R<z;R+=3){let z=R,ee=R+1,ce=R+2;j=Yg(this,Y,E,ka,se,he,z,ee,ce),j&&(j.faceIndex=Math.floor(R/3),j.face.materialIndex=V.materialIndex,O.push(j))}}else{let R=Math.max(0,ue.start),V=Math.min(ee.count,ue.start+ue.count);for(let Y=R,ee=V;Y<ee;Y+=3){let R=Y,V=Y+1,ee=Y+2;j=Yg(this,z,E,ka,se,he,R,V,ee),j&&(j.faceIndex=Math.floor(Y/3),O.push(j))}}}};function tU(E,O,R,z,V,j,Y,ee){let se;if(se=O.side===Ue?z.intersectTriangle(Y,j,V,!0,ee):z.intersectTriangle(V,j,Y,O.side===Fe,ee),se===null)return null;$a.copy(ee),$a.applyMatrix4(E.matrixWorld);let he=R.ray.origin.distanceTo($a);return he<R.near||he>R.far?null:{distance:he,point:$a.clone(),object:E}}function Yg(E,O,R,z,V,j,Y,ee,se){E.getVertexPosition(Y,ja),E.getVertexPosition(ee,Ga),E.getVertexPosition(se,Ha);let he=tU(E,O,R,z,ja,Ga,Ha,Ja);if(he){V&&(Ya.fromBufferAttribute(V,Y),Qa.fromBufferAttribute(V,ee),Ka.fromBufferAttribute(V,se),he.uv=ga.getUV(Ja,ja,Ga,Ha,Ya,Qa,Ka,new bn)),j&&(Ya.fromBufferAttribute(j,Y),Qa.fromBufferAttribute(j,ee),Ka.fromBufferAttribute(j,se),he.uv2=ga.getUV(Ja,ja,Ga,Ha,Ya,Qa,Ka,new bn));let E={a:Y,b:ee,c:se,normal:new Wn,materialIndex:0};ga.getNormal(ja,Ga,Ha,E.normal),he.face=E}return he}var to=class extends Na{constructor(E=1,O=1,R=1,z=1,V=1,j=1){super(),this.type="BoxGeometry",this.parameters={width:E,height:O,depth:R,widthSegments:z,heightSegments:V,depthSegments:j};let Y=this;z=Math.floor(z),V=Math.floor(V),j=Math.floor(j);let ee=[],se=[],he=[],ce=[],ue=0,fe=0;p("z","y","x",-1,-1,R,O,E,j,V,0),p("z","y","x",1,-1,R,O,-E,j,V,1),p("x","z","y",1,1,E,R,O,z,j,2),p("x","z","y",1,-1,E,R,-O,z,j,3),p("x","y","z",1,-1,E,O,R,z,V,4),p("x","y","z",-1,-1,E,O,-R,z,V,5),this.setIndex(ee),this.setAttribute("position",new Ma(se,3)),this.setAttribute("normal",new Ma(he,3)),this.setAttribute("uv",new Ma(ce,2));function p(E,O,R,z,V,j,ve,we,Se,_e,Ae){let Ce=j/Se,Te=ve/_e,Ie=j/2,Fe=ve/2,Ue=we/2,Ge=Se+1,qe=_e+1,Xe=0,Qe=0,Ze=new Wn;for(let j=0;j<qe;j++){let Y=j*Te-Fe;for(let ee=0;ee<Ge;ee++){let ue=ee*Ce-Ie;Ze[E]=ue*z,Ze[O]=Y*V,Ze[R]=Ue,se.push(Ze.x,Ze.y,Ze.z),Ze[E]=0,Ze[O]=0,Ze[R]=we>0?1:-1,he.push(Ze.x,Ze.y,Ze.z),ce.push(ee/Se),ce.push(1-j/_e),Xe+=1}}for(let E=0;E<_e;E++)for(let O=0;O<Se;O++){let R=ue+O+Ge*E,z=ue+O+Ge*(E+1),V=ue+(O+1)+Ge*(E+1),j=ue+(O+1)+Ge*E;ee.push(R,z,j),ee.push(z,V,j),Qe+=6}Y.addGroup(fe,Qe,Ae),fe+=Qe,ue+=Xe}}static fromJSON(E){return new to(E.width,E.height,E.depth,E.widthSegments,E.heightSegments,E.depthSegments)}};function Gu(E){let O={};for(let R in E){O[R]={};for(let z in E[R]){let V=E[R][z];V&&(V.isColor||V.isMatrix3||V.isMatrix4||V.isVector2||V.isVector3||V.isVector4||V.isTexture||V.isQuaternion)?O[R][z]=V.clone():Array.isArray(V)?O[R][z]=V.slice():O[R][z]=V}}return O}function mn(E){let O={};for(let R=0;R<E.length;R++){let z=Gu(E[R]);for(let E in z)O[E]=z[E]}return O}function rU(E){let O=[];for(let R=0;R<E.length;R++)O.push(E[R].clone());return O}function SP(E){return E.getRenderTarget()===null&&E.outputEncoding===Yr?tn:rn}var ro={clone:Gu,merge:mn},no="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",so="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",lo=class extends ya{constructor(E){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=no,this.fragmentShader=so,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,E!==void 0&&this.setValues(E)}copy(E){return super.copy(E),this.fragmentShader=E.fragmentShader,this.vertexShader=E.vertexShader,this.uniforms=Gu(E.uniforms),this.uniformsGroups=rU(E.uniformsGroups),this.defines=Object.assign({},E.defines),this.wireframe=E.wireframe,this.wireframeLinewidth=E.wireframeLinewidth,this.fog=E.fog,this.lights=E.lights,this.clipping=E.clipping,this.extensions=Object.assign({},E.extensions),this.glslVersion=E.glslVersion,this}toJSON(E){let O=super.toJSON(E);O.glslVersion=this.glslVersion,O.uniforms={};for(let R in this.uniforms){let z=this.uniforms[R].value;z&&z.isTexture?O.uniforms[R]={type:"t",value:z.toJSON(E).uuid}:z&&z.isColor?O.uniforms[R]={type:"c",value:z.getHex()}:z&&z.isVector2?O.uniforms[R]={type:"v2",value:z.toArray()}:z&&z.isVector3?O.uniforms[R]={type:"v3",value:z.toArray()}:z&&z.isVector4?O.uniforms[R]={type:"v4",value:z.toArray()}:z&&z.isMatrix3?O.uniforms[R]={type:"m3",value:z.toArray()}:z&&z.isMatrix4?O.uniforms[R]={type:"m4",value:z.toArray()}:O.uniforms[R]={value:z}}Object.keys(this.defines).length>0&&(O.defines=this.defines),O.vertexShader=this.vertexShader,O.fragmentShader=this.fragmentShader;let R={};for(let E in this.extensions)this.extensions[E]===!0&&(R[E]=!0);return Object.keys(R).length>0&&(O.extensions=R),O}},co=class extends ra{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Es,this.projectionMatrix=new Es,this.projectionMatrixInverse=new Es}copy(E,O){return super.copy(E,O),this.matrixWorldInverse.copy(E.matrixWorldInverse),this.projectionMatrix.copy(E.projectionMatrix),this.projectionMatrixInverse.copy(E.projectionMatrixInverse),this}getWorldDirection(E){this.updateWorldMatrix(!0,!1);let O=this.matrixWorld.elements;return E.set(-O[8],-O[9],-O[10]).normalize()}updateMatrixWorld(E){super.updateMatrixWorld(E),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(E,O){super.updateWorldMatrix(E,O),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}},po=class extends co{constructor(E=50,O=1,R=.1,z=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=E,this.zoom=1,this.near=R,this.far=z,this.focus=10,this.aspect=O,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(E,O){return super.copy(E,O),this.fov=E.fov,this.zoom=E.zoom,this.near=E.near,this.far=E.far,this.focus=E.focus,this.aspect=E.aspect,this.view=E.view===null?null:Object.assign({},E.view),this.filmGauge=E.filmGauge,this.filmOffset=E.filmOffset,this}setFocalLength(E){let O=.5*this.getFilmHeight()/E;this.fov=yn*2*Math.atan(O),this.updateProjectionMatrix()}getFocalLength(){let E=Math.tan(vn*.5*this.fov);return.5*this.getFilmHeight()/E}getEffectiveFOV(){return yn*2*Math.atan(Math.tan(vn*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(E,O,R,z,V,j){this.aspect=E/O,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=E,this.view.fullHeight=O,this.view.offsetX=R,this.view.offsetY=z,this.view.width=V,this.view.height=j,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let E=this.near,O=E*Math.tan(vn*.5*this.fov)/this.zoom,R=2*O,z=this.aspect*R,V=-.5*z,j=this.view;if(this.view!==null&&this.view.enabled){let E=j.fullWidth,Y=j.fullHeight;V+=j.offsetX*z/E,O-=j.offsetY*R/Y,z*=j.width/E,R*=j.height/Y}let Y=this.filmOffset;Y!==0&&(V+=E*Y/this.getFilmWidth()),this.projectionMatrix.makePerspective(V,V+z,O,O-R,E,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(E){let O=super.toJSON(E);return O.object.fov=this.fov,O.object.zoom=this.zoom,O.object.near=this.near,O.object.far=this.far,O.object.focus=this.focus,O.object.aspect=this.aspect,this.view!==null&&(O.object.view=Object.assign({},this.view)),O.object.filmGauge=this.filmGauge,O.object.filmOffset=this.filmOffset,O}},fo=-90,mo=1,go=class extends ra{constructor(E,O,R){super(),this.type="CubeCamera",this.renderTarget=R;let z=new po(fo,mo,E,O);z.layers=this.layers,z.up.set(0,1,0),z.lookAt(1,0,0),this.add(z);let V=new po(fo,mo,E,O);V.layers=this.layers,V.up.set(0,1,0),V.lookAt(-1,0,0),this.add(V);let j=new po(fo,mo,E,O);j.layers=this.layers,j.up.set(0,0,-1),j.lookAt(0,1,0),this.add(j);let Y=new po(fo,mo,E,O);Y.layers=this.layers,Y.up.set(0,0,1),Y.lookAt(0,-1,0),this.add(Y);let ee=new po(fo,mo,E,O);ee.layers=this.layers,ee.up.set(0,1,0),ee.lookAt(0,0,1),this.add(ee);let se=new po(fo,mo,E,O);se.layers=this.layers,se.up.set(0,1,0),se.lookAt(0,0,-1),this.add(se)}update(E,O){this.parent===null&&this.updateMatrixWorld();let R=this.renderTarget,[z,V,j,Y,ee,se]=this.children,he=E.getRenderTarget(),ce=E.toneMapping,ue=E.xr.enabled;E.toneMapping=Xt,E.xr.enabled=!1;let fe=R.texture.generateMipmaps;R.texture.generateMipmaps=!1,E.setRenderTarget(R,0),E.render(O,z),E.setRenderTarget(R,1),E.render(O,V),E.setRenderTarget(R,2),E.render(O,j),E.setRenderTarget(R,3),E.render(O,Y),E.setRenderTarget(R,4),E.render(O,ee),R.texture.generateMipmaps=fe,E.setRenderTarget(R,5),E.render(O,se),E.setRenderTarget(he),E.toneMapping=ce,E.xr.enabled=ue,R.texture.needsPMREMUpdate=!0}},vo=class extends Fn{constructor(E,O,R,z,V,j,Y,ee,se,he){E=E!==void 0?E:[],O=O!==void 0?O:ii,super(E,O,R,z,V,j,Y,ee,se,he),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(E){this.image=E}},yo=class extends Un{constructor(E=1,O={}){super(E,E,O),this.isWebGLCubeRenderTarget=!0;let R={width:E,height:E,depth:1},z=[R,R,R,R,R,R];this.texture=new vo(z,O.mapping,O.wrapS,O.wrapT,O.magFilter,O.minFilter,O.format,O.type,O.anisotropy,O.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=O.generateMipmaps!==void 0&&O.generateMipmaps,this.texture.minFilter=O.minFilter!==void 0?O.minFilter:yi}fromEquirectangularTexture(E,O){this.texture.type=O.type,this.texture.encoding=O.encoding,this.texture.generateMipmaps=O.generateMipmaps,this.texture.minFilter=O.minFilter,this.texture.magFilter=O.magFilter;let R={uniforms:{tEquirect:{value:null}},vertexShader:"\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",fragmentShader:"\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t"},z=new to(5,5,5),V=new lo({name:"CubemapFromEquirect",uniforms:Gu(R.uniforms),vertexShader:R.vertexShader,fragmentShader:R.fragmentShader,side:Ue,blending:qe});V.uniforms.tEquirect.value=O;let j=new eo(z,V),Y=O.minFilter;return O.minFilter===bi&&(O.minFilter=yi),new go(1,10,this).update(E,j),O.minFilter=Y,j.geometry.dispose(),j.material.dispose(),this}clear(E,O,R,z){let V=E.getRenderTarget();for(let V=0;V<6;V++)E.setRenderTarget(this,V),E.clear(O,R,z);E.setRenderTarget(V)}},xo=new Wn,bo=new Wn,wo=new wn,_o=class{constructor(E=new Wn(1,0,0),O=0){this.isPlane=!0,this.normal=E,this.constant=O}set(E,O){return this.normal.copy(E),this.constant=O,this}setComponents(E,O,R,z){return this.normal.set(E,O,R),this.constant=z,this}setFromNormalAndCoplanarPoint(E,O){return this.normal.copy(E),this.constant=-O.dot(this.normal),this}setFromCoplanarPoints(E,O,R){let z=xo.subVectors(R,O).cross(bo.subVectors(E,O)).normalize();return this.setFromNormalAndCoplanarPoint(z,E),this}copy(E){return this.normal.copy(E.normal),this.constant=E.constant,this}normalize(){let E=1/this.normal.length();return this.normal.multiplyScalar(E),this.constant*=E,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(E){return this.normal.dot(E)+this.constant}distanceToSphere(E){return this.distanceToPoint(E.center)-E.radius}projectPoint(E,O){return O.copy(this.normal).multiplyScalar(-this.distanceToPoint(E)).add(E)}intersectLine(E,O){let R=E.delta(xo),z=this.normal.dot(R);if(z===0)return this.distanceToPoint(E.start)===0?O.copy(E.start):null;let V=-(E.start.dot(this.normal)+this.constant)/z;return V<0||V>1?null:O.copy(R).multiplyScalar(V).add(E.start)}intersectsLine(E){let O=this.distanceToPoint(E.start),R=this.distanceToPoint(E.end);return O<0&&R>0||R<0&&O>0}intersectsBox(E){return E.intersectsPlane(this)}intersectsSphere(E){return E.intersectsPlane(this)}coplanarPoint(E){return E.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(E,O){let R=O||wo.getNormalMatrix(E),z=this.coplanarPoint(xo).applyMatrix4(E),V=this.normal.applyMatrix3(R).normalize();return this.constant=-z.dot(V),this}translate(E){return this.constant-=E.dot(this.normal),this}equals(E){return E.normal.equals(this.normal)&&E.constant===this.constant}clone(){return(new this.constructor).copy(this)}},Ao=new ps,Mo=new Wn,Eo=class{constructor(E=new _o,O=new _o,R=new _o,z=new _o,V=new _o,j=new _o){this.planes=[E,O,R,z,V,j]}set(E,O,R,z,V,j){let Y=this.planes;return Y[0].copy(E),Y[1].copy(O),Y[2].copy(R),Y[3].copy(z),Y[4].copy(V),Y[5].copy(j),this}copy(E){let O=this.planes;for(let R=0;R<6;R++)O[R].copy(E.planes[R]);return this}setFromProjectionMatrix(E){let O=this.planes,R=E.elements,z=R[0],V=R[1],j=R[2],Y=R[3],ee=R[4],se=R[5],he=R[6],ce=R[7],ue=R[8],fe=R[9],ve=R[10],we=R[11],Se=R[12],_e=R[13],Ae=R[14],Ce=R[15];return O[0].setComponents(Y-z,ce-ee,we-ue,Ce-Se).normalize(),O[1].setComponents(Y+z,ce+ee,we+ue,Ce+Se).normalize(),O[2].setComponents(Y+V,ce+se,we+fe,Ce+_e).normalize(),O[3].setComponents(Y-V,ce-se,we-fe,Ce-_e).normalize(),O[4].setComponents(Y-j,ce-he,we-ve,Ce-Ae).normalize(),O[5].setComponents(Y+j,ce+he,we+ve,Ce+Ae).normalize(),this}intersectsObject(E){let O=E.geometry;return O.boundingSphere===null&&O.computeBoundingSphere(),Ao.copy(O.boundingSphere).applyMatrix4(E.matrixWorld),this.intersectsSphere(Ao)}intersectsSprite(E){return Ao.center.set(0,0,0),Ao.radius=.7071067811865476,Ao.applyMatrix4(E.matrixWorld),this.intersectsSphere(Ao)}intersectsSphere(E){let O=this.planes,R=E.center,z=-E.radius;for(let E=0;E<6;E++)if(O[E].distanceToPoint(R)<z)return!1;return!0}intersectsBox(E){let O=this.planes;for(let R=0;R<6;R++){let z=O[R];if(Mo.x=z.normal.x>0?E.max.x:E.min.x,Mo.y=z.normal.y>0?E.max.y:E.min.y,Mo.z=z.normal.z>0?E.max.z:E.min.z,z.distanceToPoint(Mo)<0)return!1}return!0}containsPoint(E){let O=this.planes;for(let R=0;R<6;R++)if(O[R].distanceToPoint(E)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}};function wP(){let E=null,O=!1,R=null,z=null;function i(O,V){R(O,V),z=E.requestAnimationFrame(i)}return{start:function(){O!==!0&&R!==null&&(z=E.requestAnimationFrame(i),O=!0)},stop:function(){E.cancelAnimationFrame(z),O=!1},setAnimationLoop:function(E){R=E},setContext:function(O){E=O}}}function aU(E,O){let R=O.isWebGL2,z=new WeakMap;function i(O,z){let V=O.array,j=O.usage,Y=E.createBuffer();E.bindBuffer(z,Y),E.bufferData(z,V,j),O.onUploadCallback();let ee;if(V instanceof Float32Array)ee=5126;else if(V instanceof Uint16Array)if(O.isFloat16BufferAttribute){if(!R)throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");ee=5131}else ee=5123;else if(V instanceof Int16Array)ee=5122;else if(V instanceof Uint32Array)ee=5125;else if(V instanceof Int32Array)ee=5124;else if(V instanceof Int8Array)ee=5120;else if(V instanceof Uint8Array)ee=5121;else{if(!(V instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+V);ee=5121}return{buffer:Y,type:ee,bytesPerElement:V.BYTES_PER_ELEMENT,version:O.version}}function s(O,z,V){let j=z.array,Y=z.updateRange;E.bindBuffer(V,O),Y.count===-1?E.bufferSubData(V,0,j):(R?E.bufferSubData(V,Y.offset*j.BYTES_PER_ELEMENT,j,Y.offset,Y.count):E.bufferSubData(V,Y.offset*j.BYTES_PER_ELEMENT,j.subarray(Y.offset,Y.offset+Y.count)),Y.count=-1),z.onUploadCallback()}function o(E){return E.isInterleavedBufferAttribute&&(E=E.data),z.get(E)}function a(O){O.isInterleavedBufferAttribute&&(O=O.data);let R=z.get(O);R&&(E.deleteBuffer(R.buffer),z.delete(O))}function l(E,O){if(E.isGLBufferAttribute){let O=z.get(E);(!O||O.version<E.version)&&z.set(E,{buffer:E.buffer,type:E.type,bytesPerElement:E.elementSize,version:E.version});return}E.isInterleavedBufferAttribute&&(E=E.data);let R=z.get(E);R===void 0?z.set(E,i(E,O)):R.version<E.version&&(s(R.buffer,E,O),R.version=E.version)}return{get:o,remove:a,update:l}}var Co=class extends Na{constructor(E=1,O=1,R=1,z=1){super(),this.type="PlaneGeometry",this.parameters={width:E,height:O,widthSegments:R,heightSegments:z};let V=E/2,j=O/2,Y=Math.floor(R),ee=Math.floor(z),se=Y+1,he=ee+1,ce=E/Y,ue=O/ee,fe=[],ve=[],we=[],Se=[];for(let E=0;E<he;E++){let O=E*ue-j;for(let R=0;R<se;R++){let z=R*ce-V;ve.push(z,-O,0),we.push(0,0,1),Se.push(R/Y),Se.push(1-E/ee)}}for(let E=0;E<ee;E++)for(let O=0;O<Y;O++){let R=O+se*E,z=O+se*(E+1),V=O+1+se*(E+1),j=O+1+se*E;fe.push(R,z,j),fe.push(z,V,j)}this.setIndex(fe),this.setAttribute("position",new Ma(ve,3)),this.setAttribute("normal",new Ma(we,3)),this.setAttribute("uv",new Ma(Se,2))}static fromJSON(E){return new Co(E.width,E.height,E.widthSegments,E.heightSegments)}},To="#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",Po="#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",Do="#ifdef USE_ALPHATEST\n\tif ( diffuseColor.a < alphaTest ) discard;\n#endif",Io="#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",Oo="#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",Ro="#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",Lo="vec3 transformed = vec3( position );",zo="vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",Fo="vec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat F_Schlick( const in float f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nvec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {\n    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );\n    float x2 = x * x;\n    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );\n    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( V * D );\n}\n#ifdef USE_IRIDESCENCE\n\tvec3 BRDF_GGX_Iridescence( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float iridescence, const in vec3 iridescenceFresnel, const in float roughness ) {\n\t\tfloat alpha = pow2( roughness );\n\t\tvec3 halfDir = normalize( lightDir + viewDir );\n\t\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\t\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\t\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\t\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\t\tvec3 F = mix( F_Schlick( f0, f90, dotVH ), iridescenceFresnel, iridescence );\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t\treturn F * ( V * D );\n\t}\n#endif\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif",No="#ifdef USE_IRIDESCENCE\n\tconst mat3 XYZ_TO_REC709 = mat3(\n\t\t 3.2404542, -0.9692660,  0.0556434,\n\t\t-1.5371385,  1.8760108, -0.2040259,\n\t\t-0.4985314,  0.0415560,  1.0572252\n\t);\n\tvec3 Fresnel0ToIor( vec3 fresnel0 ) {\n\t\tvec3 sqrtF0 = sqrt( fresnel0 );\n\t\treturn ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );\n\t}\n\tvec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );\n\t}\n\tfloat IorToFresnel0( float transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));\n\t}\n\tvec3 evalSensitivity( float OPD, vec3 shift ) {\n\t\tfloat phase = 2.0 * PI * OPD * 1.0e-9;\n\t\tvec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );\n\t\tvec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );\n\t\tvec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );\n\t\tvec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );\n\t\txyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );\n\t\txyz /= 1.0685e-7;\n\t\tvec3 rgb = XYZ_TO_REC709 * xyz;\n\t\treturn rgb;\n\t}\n\tvec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {\n\t\tvec3 I;\n\t\tfloat iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );\n\t\tfloat sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );\n\t\tfloat cosTheta2Sq = 1.0 - sinTheta2Sq;\n\t\tif ( cosTheta2Sq < 0.0 ) {\n\t\t\t return vec3( 1.0 );\n\t\t}\n\t\tfloat cosTheta2 = sqrt( cosTheta2Sq );\n\t\tfloat R0 = IorToFresnel0( iridescenceIOR, outsideIOR );\n\t\tfloat R12 = F_Schlick( R0, 1.0, cosTheta1 );\n\t\tfloat R21 = R12;\n\t\tfloat T121 = 1.0 - R12;\n\t\tfloat phi12 = 0.0;\n\t\tif ( iridescenceIOR < outsideIOR ) phi12 = PI;\n\t\tfloat phi21 = PI - phi12;\n\t\tvec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );\t\tvec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );\n\t\tvec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );\n\t\tvec3 phi23 = vec3( 0.0 );\n\t\tif ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;\n\t\tif ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;\n\t\tif ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;\n\t\tfloat OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;\n\t\tvec3 phi = vec3( phi21 ) + phi23;\n\t\tvec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );\n\t\tvec3 r123 = sqrt( R123 );\n\t\tvec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );\n\t\tvec3 C0 = R12 + Rs;\n\t\tI = C0;\n\t\tvec3 Cm = Rs - T121;\n\t\tfor ( int m = 1; m <= 2; ++ m ) {\n\t\t\tCm *= r123;\n\t\t\tvec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );\n\t\t\tI += Cm * Sm;\n\t\t}\n\t\treturn max( I, vec3( 0.0 ) );\n\t}\n#endif",Uo="#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = dFdx( surf_pos.xyz );\n\t\tvec3 vSigmaY = dFdy( surf_pos.xyz );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",ko="#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",Vo="#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",Ho="#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",Wo="#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",qo="#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",Xo="#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",Yo="#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",Qo="#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",Ko="#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nvec3 pow2( const in vec3 x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat luminance( const in vec3 rgb ) {\n\tconst vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );\n\treturn dot( weights, rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",$o="#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\thighp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\t\t#ifdef texture2DGradEXT\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n\t\t#else\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\t\t#endif\n\t}\n\t#define cubeUV_r0 1.0\n\t#define cubeUV_v0 0.339\n\t#define cubeUV_m0 - 2.0\n\t#define cubeUV_r1 0.8\n\t#define cubeUV_v1 0.276\n\t#define cubeUV_m1 - 1.0\n\t#define cubeUV_r4 0.4\n\t#define cubeUV_v4 0.046\n\t#define cubeUV_m4 2.0\n\t#define cubeUV_r5 0.305\n\t#define cubeUV_v5 0.016\n\t#define cubeUV_m5 3.0\n\t#define cubeUV_r6 0.21\n\t#define cubeUV_v6 0.0038\n\t#define cubeUV_m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= cubeUV_r1 ) {\n\t\t\tmip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;\n\t\t} else if ( roughness >= cubeUV_r4 ) {\n\t\t\tmip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;\n\t\t} else if ( roughness >= cubeUV_r5 ) {\n\t\t\tmip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;\n\t\t} else if ( roughness >= cubeUV_r6 ) {\n\t\t\tmip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",el="vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",tl="#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",il="#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",nl="#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",sl="#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",al="gl_FragColor = linearToOutputTexel( gl_FragColor );",ol="vec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}",ll="#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",hl="#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",cl="#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",dl="#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",ul="#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",pl="#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fl="#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",ml="#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",gl="#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",vl="#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\tvec2 fw = fwidth( coord ) * 0.5;\n\t\treturn mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );\n\t#endif\n}",yl="#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\treflectedLight.indirectDiffuse += lightMapIrradiance;\n#endif",bl="#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",wl="LambertMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularStrength = specularStrength;",Sl="varying vec3 vViewPosition;\nstruct LambertMaterial {\n\tvec3 diffuseColor;\n\tfloat specularStrength;\n};\nvoid RE_Direct_Lambert( const in IncidentLight directLight, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Lambert\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Lambert",_l="uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tif ( cutoffDistance > 0.0 ) {\n\t\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t}\n\t\treturn distanceFalloff;\n\t#else\n\t\tif ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\t\treturn pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t\t}\n\t\treturn 1.0;\n\t#endif\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",Al="#if defined( USE_ENVMAP )\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 reflectVec = reflect( - viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n#endif",Ml="ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",El="varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon",Cl="BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",Dl="varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong",Il="PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\tmaterial.ior = ior;\n\t#ifdef SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULARINTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;\n\t\t#endif\n\t\t#ifdef USE_SPECULARCOLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vUv ).rgb;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_IRIDESCENCE\n\tmaterial.iridescence = iridescence;\n\tmaterial.iridescenceIOR = iridescenceIOR;\n\t#ifdef USE_IRIDESCENCEMAP\n\t\tmaterial.iridescence *= texture2D( iridescenceMap, vUv ).r;\n\t#endif\n\t#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\t\tmaterial.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vUv ).g + iridescenceThicknessMinimum;\n\t#else\n\t\tmaterial.iridescenceThickness = iridescenceThicknessMaximum;\n\t#endif\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;\n\t#endif\n#endif",Ol="struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\tfloat iridescence;\n\t\tfloat iridescenceIOR;\n\t\tfloat iridescenceThickness;\n\t\tvec3 iridescenceFresnel;\n\t\tvec3 iridescenceF0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n\t#ifdef IOR\n\t\tfloat ior;\n\t#endif\n\t#ifdef USE_TRANSMISSION\n\t\tfloat transmission;\n\t\tfloat transmissionAlpha;\n\t\tfloat thickness;\n\t\tfloat attenuationDistance;\n\t\tvec3 attenuationColor;\n\t#endif\n};\nvec3 clearcoatSpecular = vec3( 0.0 );\nvec3 sheenSpecular = vec3( 0.0 );\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\n#ifdef USE_IRIDESCENCE\nvoid computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#else\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#endif\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\t#ifdef USE_IRIDESCENCE\n\t\tvec3 Fr = mix( specularColor, iridescenceF0, iridescence );\n\t#else\n\t\tvec3 Fr = specularColor;\n\t#endif\n\tvec3 FssEss = Fr * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\treflectedLight.directSpecular += irradiance * BRDF_GGX_Iridescence( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness );\n\t#else\n\t\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\t#ifdef USE_IRIDESCENCE\n\t\tcomputeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );\n\t#else\n\t\tcomputeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\t#endif\n\tvec3 totalScattering = singleScattering + multiScattering;\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",Rl="\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef USE_CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\n#ifdef USE_IRIDESCENCE\n\tfloat dotNVi = saturate( dot( normal, geometry.viewDir ) );\n\tif ( material.iridescenceThickness == 0.0 ) {\n\t\tmaterial.iridescence = 0.0;\n\t} else {\n\t\tmaterial.iridescence = saturate( material.iridescence );\n\t}\n\tif ( material.iridescence > 0.0 ) {\n\t\tmaterial.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );\n\t\tmaterial.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );\n\t}\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tvec4 spotColor;\n\tvec3 spotLightCoord;\n\tbool inSpotLightMap;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometry, directLight );\n\t\t#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX\n\t\t#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS\n\t\t#else\n\t\t#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#endif\n\t\t#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )\n\t\t\tspotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;\n\t\t\tinSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );\n\t\t\tspotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );\n\t\t\tdirectLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;\n\t\t#endif\n\t\t#undef SPOT_LIGHT_MAP_INDEX\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry.normal );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",Ll="#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometry.normal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",Bl="#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",Fl="#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",Nl="#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",Ul="#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",kl="#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",jl="#ifdef USE_MAP\n\tvec4 sampledDiffuseColor = texture2D( map, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tsampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );\n\t#endif\n\tdiffuseColor *= sampledDiffuseColor;\n#endif",Gl="#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",Hl="#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",Wl="#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",ql="float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",Yl="#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",Ql="#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )\n\tvColor *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t#if defined( USE_COLOR_ALPHA )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\t\t#elif defined( USE_COLOR )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n\t\t#endif\n\t}\n#endif",Zl="#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\t\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\t\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\t\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n\t#endif\n#endif",Kl="#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t\tuniform sampler2DArray morphTargetsTexture;\n\t\tuniform ivec2 morphTargetsTextureSize;\n\t\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\t\t\tint texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n\t\t\tint y = texelIndex / morphTargetsTextureSize.x;\n\t\t\tint x = texelIndex - y * morphTargetsTextureSize.x;\n\t\t\tivec3 morphUV = ivec3( x, y, morphTargetIndex );\n\t\t\treturn texelFetch( morphTargetsTexture, morphUV, 0 );\n\t\t}\n\t#else\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\tuniform float morphTargetInfluences[ 8 ];\n\t\t#else\n\t\t\tuniform float morphTargetInfluences[ 4 ];\n\t\t#endif\n\t#endif\n#endif",Jl="#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\t\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\t\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\t\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t\t#endif\n\t#endif\n#endif",$l="float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = dFdx( vViewPosition );\n\tvec3 fdy = dFdy( vViewPosition );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * faceDirection;\n\t\t\tbitangent = bitangent * faceDirection;\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",eh="#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",th="#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",ih="#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",rh="#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",nh="#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );\n\t\treturn normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );\n\t}\n#endif",sh="#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",ah="#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );\n\t#endif\n#endif",oh="#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",ch="#ifdef USE_IRIDESCENCEMAP\n\tuniform sampler2D iridescenceMap;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform sampler2D iridescenceThicknessMap;\n#endif",ph="#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= material.transmissionAlpha + 0.1;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",mh="vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec2 packDepthToRG( in highp float v ) {\n\treturn packDepthToRGBA( v ).yx;\n}\nfloat unpackRGToDepth( const in highp vec2 v ) {\n\treturn unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",gh="#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",vh="vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",yh="#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",xh="#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",bh="float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",wh="#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",Sh="#if NUM_SPOT_LIGHT_COORDS > 0\n  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#if NUM_SPOT_LIGHT_MAPS > 0\n  uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;\n\t\tbool frustumTest = inFrustum && shadowCoord.z <= 1.0;\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",_h="#if NUM_SPOT_LIGHT_COORDS > 0\n  uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];\n  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",Ah="#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )\n\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\tvec4 shadowWorldPosition;\n#endif\n#if defined( USE_SHADOWMAP )\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if NUM_SPOT_LIGHT_COORDS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition;\n\t\t#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t\tshadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;\n\t\t#endif\n\t\tvSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n#endif",Eh="float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",Th="#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",Ih="#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\tuniform highp sampler2D boneTexture;\n\tuniform int boneTextureSize;\n\tmat4 getBoneMatrix( const in float i ) {\n\t\tfloat j = i * 4.0;\n\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\ty = dy * ( y + 0.5 );\n\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\treturn bone;\n\t}\n#endif",Oh="#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",Rh="#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",Lh="float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",Bh="#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",Fh="#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",Nh="#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",Uh="#ifdef USE_TRANSMISSION\n\tmaterial.transmission = transmission;\n\tmaterial.transmissionAlpha = 1.0;\n\tmaterial.thickness = thickness;\n\tmaterial.attenuationDistance = attenuationDistance;\n\tmaterial.attenuationColor = attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tmaterial.transmission *= texture2D( transmissionMap, vUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tmaterial.thickness *= texture2D( thicknessMap, vUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmission = getIBLVolumeRefraction(\n\t\tn, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,\n\t\tmaterial.attenuationColor, material.attenuationDistance );\n\tmaterial.transmissionAlpha = mix( material.transmissionAlpha, transmission.a, material.transmission );\n\ttotalDiffuse = mix( totalDiffuse, transmission.rgb, material.transmission );\n#endif",kh="#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\t#ifdef texture2DLodEXT\n\t\t\treturn texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#else\n\t\t\treturn texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#endif\n\t}\n\tvec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( isinf( attenuationDistance ) ) {\n\t\t\treturn radiance;\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance * radiance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\trefractionCoords += 1.0;\n\t\trefractionCoords /= 2.0;\n\t\tvec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\tvec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );\n\t}\n#endif",jh="#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",Hh="#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",Wh="#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",qh="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",Xh="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",Yh="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",Qh="#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",Zh="varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",Kh="uniform sampler2D t2D;\nuniform float backgroundIntensity;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\ttexColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",Jh="varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",$h="#ifdef ENVMAP_TYPE_CUBE\n\tuniform samplerCube envMap;\n#elif defined( ENVMAP_TYPE_CUBE_UV )\n\tuniform sampler2D envMap;\n#endif\nuniform float flipEnvMap;\nuniform float backgroundBlurriness;\nuniform float backgroundIntensity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 texColor = textureCube( envMap, vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 texColor = textureCubeUV( envMap, vWorldDirection, backgroundBlurriness );\n\t#else\n\t\tvec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",ec="varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",tc="uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldDirection;\nvoid main() {\n\tvec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n\tgl_FragColor = texColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",ic="#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",rc="#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",nc="#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",ac="#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",oc="varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",lc="uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",hc="uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",cc="uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",dc="#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",uc="uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",fc="#define LAMBERT\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",gc="#define LAMBERT\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_lambert_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_lambert_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",vc="#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",yc="#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",xc="#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",bc="#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",Sc="#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",_c="#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",Ac="#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",Mc="#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULARINTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n\t#ifdef USE_SPECULARCOLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_IRIDESCENCE\n\tuniform float iridescence;\n\tuniform float iridescenceIOR;\n\tuniform float iridescenceThicknessMinimum;\n\tuniform float iridescenceThicknessMaximum;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <iridescence_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <iridescence_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;\n\t#endif\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",Ec="#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",Cc="#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",Tc="uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",Pc="uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",Ic="#include <common>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",Oc="uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",Lc="uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",Bc="uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",zc={alphamap_fragment:To,alphamap_pars_fragment:Po,alphatest_fragment:Do,alphatest_pars_fragment:Io,aomap_fragment:Oo,aomap_pars_fragment:Ro,begin_vertex:Lo,beginnormal_vertex:zo,bsdfs:Fo,iridescence_fragment:No,bumpmap_pars_fragment:Uo,clipping_planes_fragment:ko,clipping_planes_pars_fragment:Vo,clipping_planes_pars_vertex:Ho,clipping_planes_vertex:Wo,color_fragment:qo,color_pars_fragment:Xo,color_pars_vertex:Yo,color_vertex:Qo,common:Ko,cube_uv_reflection_fragment:$o,defaultnormal_vertex:el,displacementmap_pars_vertex:tl,displacementmap_vertex:il,emissivemap_fragment:nl,emissivemap_pars_fragment:sl,encodings_fragment:al,encodings_pars_fragment:ol,envmap_fragment:ll,envmap_common_pars_fragment:hl,envmap_pars_fragment:cl,envmap_pars_vertex:dl,envmap_physical_pars_fragment:Al,envmap_vertex:ul,fog_vertex:pl,fog_pars_vertex:fl,fog_fragment:ml,fog_pars_fragment:gl,gradientmap_pars_fragment:vl,lightmap_fragment:yl,lightmap_pars_fragment:bl,lights_lambert_fragment:wl,lights_lambert_pars_fragment:Sl,lights_pars_begin:_l,lights_toon_fragment:Ml,lights_toon_pars_fragment:El,lights_phong_fragment:Cl,lights_phong_pars_fragment:Dl,lights_physical_fragment:Il,lights_physical_pars_fragment:Ol,lights_fragment_begin:Rl,lights_fragment_maps:Ll,lights_fragment_end:Bl,logdepthbuf_fragment:Fl,logdepthbuf_pars_fragment:Nl,logdepthbuf_pars_vertex:Ul,logdepthbuf_vertex:kl,map_fragment:jl,map_pars_fragment:Gl,map_particle_fragment:Hl,map_particle_pars_fragment:Wl,metalnessmap_fragment:ql,metalnessmap_pars_fragment:Yl,morphcolor_vertex:Ql,morphnormal_vertex:Zl,morphtarget_pars_vertex:Kl,morphtarget_vertex:Jl,normal_fragment_begin:$l,normal_fragment_maps:eh,normal_pars_fragment:th,normal_pars_vertex:ih,normal_vertex:rh,normalmap_pars_fragment:nh,clearcoat_normal_fragment_begin:sh,clearcoat_normal_fragment_maps:ah,clearcoat_pars_fragment:oh,iridescence_pars_fragment:ch,output_fragment:ph,packing:mh,premultiplied_alpha_fragment:gh,project_vertex:vh,dithering_fragment:yh,dithering_pars_fragment:xh,roughnessmap_fragment:bh,roughnessmap_pars_fragment:wh,shadowmap_pars_fragment:Sh,shadowmap_pars_vertex:_h,shadowmap_vertex:Ah,shadowmask_pars_fragment:Eh,skinbase_vertex:Th,skinning_pars_vertex:Ih,skinning_vertex:Oh,skinnormal_vertex:Rh,specularmap_fragment:Lh,specularmap_pars_fragment:Bh,tonemapping_fragment:Fh,tonemapping_pars_fragment:Nh,transmission_fragment:Uh,transmission_pars_fragment:kh,uv_pars_fragment:jh,uv_pars_vertex:Hh,uv_vertex:Wh,uv2_pars_fragment:qh,uv2_pars_vertex:Xh,uv2_vertex:Yh,worldpos_vertex:Qh,background_vert:Zh,background_frag:Kh,backgroundCube_vert:Jh,backgroundCube_frag:$h,cube_vert:ec,cube_frag:tc,depth_vert:ic,depth_frag:rc,distanceRGBA_vert:nc,distanceRGBA_frag:ac,equirect_vert:oc,equirect_frag:lc,linedashed_vert:hc,linedashed_frag:cc,meshbasic_vert:dc,meshbasic_frag:uc,meshlambert_vert:fc,meshlambert_frag:gc,meshmatcap_vert:vc,meshmatcap_frag:yc,meshnormal_vert:xc,meshnormal_frag:bc,meshphong_vert:Sc,meshphong_frag:_c,meshphysical_vert:Ac,meshphysical_frag:Mc,meshtoon_vert:Ec,meshtoon_frag:Cc,points_vert:Tc,points_frag:Pc,shadow_vert:Ic,shadow_frag:Oc,sprite_vert:Lc,sprite_frag:Bc},Fc={common:{diffuse:{value:new On(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new wn},uv2Transform:{value:new wn},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new bn(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new On(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new On(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new wn}},sprite:{diffuse:{value:new On(16777215)},opacity:{value:1},center:{value:new bn(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new wn}}},Nc={basic:{uniforms:mn([Fc.common,Fc.specularmap,Fc.envmap,Fc.aomap,Fc.lightmap,Fc.fog]),vertexShader:zc.meshbasic_vert,fragmentShader:zc.meshbasic_frag},lambert:{uniforms:mn([Fc.common,Fc.specularmap,Fc.envmap,Fc.aomap,Fc.lightmap,Fc.emissivemap,Fc.bumpmap,Fc.normalmap,Fc.displacementmap,Fc.fog,Fc.lights,{emissive:{value:new On(0)}}]),vertexShader:zc.meshlambert_vert,fragmentShader:zc.meshlambert_frag},phong:{uniforms:mn([Fc.common,Fc.specularmap,Fc.envmap,Fc.aomap,Fc.lightmap,Fc.emissivemap,Fc.bumpmap,Fc.normalmap,Fc.displacementmap,Fc.fog,Fc.lights,{emissive:{value:new On(0)},specular:{value:new On(1118481)},shininess:{value:30}}]),vertexShader:zc.meshphong_vert,fragmentShader:zc.meshphong_frag},standard:{uniforms:mn([Fc.common,Fc.envmap,Fc.aomap,Fc.lightmap,Fc.emissivemap,Fc.bumpmap,Fc.normalmap,Fc.displacementmap,Fc.roughnessmap,Fc.metalnessmap,Fc.fog,Fc.lights,{emissive:{value:new On(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:zc.meshphysical_vert,fragmentShader:zc.meshphysical_frag},toon:{uniforms:mn([Fc.common,Fc.aomap,Fc.lightmap,Fc.emissivemap,Fc.bumpmap,Fc.normalmap,Fc.displacementmap,Fc.gradientmap,Fc.fog,Fc.lights,{emissive:{value:new On(0)}}]),vertexShader:zc.meshtoon_vert,fragmentShader:zc.meshtoon_frag},matcap:{uniforms:mn([Fc.common,Fc.bumpmap,Fc.normalmap,Fc.displacementmap,Fc.fog,{matcap:{value:null}}]),vertexShader:zc.meshmatcap_vert,fragmentShader:zc.meshmatcap_frag},points:{uniforms:mn([Fc.points,Fc.fog]),vertexShader:zc.points_vert,fragmentShader:zc.points_frag},dashed:{uniforms:mn([Fc.common,Fc.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:zc.linedashed_vert,fragmentShader:zc.linedashed_frag},depth:{uniforms:mn([Fc.common,Fc.displacementmap]),vertexShader:zc.depth_vert,fragmentShader:zc.depth_frag},normal:{uniforms:mn([Fc.common,Fc.bumpmap,Fc.normalmap,Fc.displacementmap,{opacity:{value:1}}]),vertexShader:zc.meshnormal_vert,fragmentShader:zc.meshnormal_frag},sprite:{uniforms:mn([Fc.sprite,Fc.fog]),vertexShader:zc.sprite_vert,fragmentShader:zc.sprite_frag},background:{uniforms:{uvTransform:{value:new wn},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:zc.background_vert,fragmentShader:zc.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1}},vertexShader:zc.backgroundCube_vert,fragmentShader:zc.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:zc.cube_vert,fragmentShader:zc.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:zc.equirect_vert,fragmentShader:zc.equirect_frag},distanceRGBA:{uniforms:mn([Fc.common,Fc.displacementmap,{referencePosition:{value:new Wn},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:zc.distanceRGBA_vert,fragmentShader:zc.distanceRGBA_frag},shadow:{uniforms:mn([Fc.lights,Fc.fog,{color:{value:new On(0)},opacity:{value:1}}]),vertexShader:zc.shadow_vert,fragmentShader:zc.shadow_frag}};Nc.physical={uniforms:mn([Nc.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new bn(1,1)},clearcoatNormalMap:{value:null},iridescence:{value:0},iridescenceMap:{value:null},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},sheen:{value:0},sheenColor:{value:new On(0)},sheenColorMap:{value:null},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new bn},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new On(0)},specularIntensity:{value:1},specularIntensityMap:{value:null},specularColor:{value:new On(1,1,1)},specularColorMap:{value:null}}]),vertexShader:zc.meshphysical_vert,fragmentShader:zc.meshphysical_frag};var kc={r:0,b:0,g:0};function zk(E,O,R,z,V,j,Y){let ee,se,he=new On(0),ce=j===!0?0:1,ue=null,fe=0,ve=null;function p(z,j){let Y=!1,we=j.isScene===!0?j.background:null;we&&we.isTexture&&(we=(j.backgroundBlurriness>0?R:O).get(we));let Se=E.xr,_e=Se.getSession&&Se.getSession();_e&&_e.environmentBlendMode==="additive"&&(we=null),we===null?m(he,ce):we&&we.isColor&&(m(we,1),Y=!0),(E.autoClear||Y)&&E.clear(E.autoClearColor,E.autoClearDepth,E.autoClearStencil),we&&(we.isCubeTexture||we.mapping===ai)?(se===void 0&&(se=new eo(new to(1,1,1),new lo({name:"BackgroundCubeMaterial",uniforms:Gu(Nc.backgroundCube.uniforms),vertexShader:Nc.backgroundCube.vertexShader,fragmentShader:Nc.backgroundCube.fragmentShader,side:Ue,depthTest:!1,depthWrite:!1,fog:!1})),se.geometry.deleteAttribute("normal"),se.geometry.deleteAttribute("uv"),se.onBeforeRender=function(E,O,R){this.matrixWorld.copyPosition(R.matrixWorld)},Object.defineProperty(se.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),V.update(se)),se.material.uniforms.envMap.value=we,se.material.uniforms.flipEnvMap.value=we.isCubeTexture&&we.isRenderTargetTexture===!1?-1:1,se.material.uniforms.backgroundBlurriness.value=j.backgroundBlurriness,se.material.uniforms.backgroundIntensity.value=j.backgroundIntensity,se.material.toneMapped=we.encoding!==Yr,(ue!==we||fe!==we.version||ve!==E.toneMapping)&&(se.material.needsUpdate=!0,ue=we,fe=we.version,ve=E.toneMapping),se.layers.enableAll(),z.unshift(se,se.geometry,se.material,0,0,null)):we&&we.isTexture&&(ee===void 0&&(ee=new eo(new Co(2,2),new lo({name:"BackgroundMaterial",uniforms:Gu(Nc.background.uniforms),vertexShader:Nc.background.vertexShader,fragmentShader:Nc.background.fragmentShader,side:Fe,depthTest:!1,depthWrite:!1,fog:!1})),ee.geometry.deleteAttribute("normal"),Object.defineProperty(ee.material,"map",{get:function(){return this.uniforms.t2D.value}}),V.update(ee)),ee.material.uniforms.t2D.value=we,ee.material.uniforms.backgroundIntensity.value=j.backgroundIntensity,ee.material.toneMapped=we.encoding!==Yr,we.matrixAutoUpdate===!0&&we.updateMatrix(),ee.material.uniforms.uvTransform.value.copy(we.matrix),(ue!==we||fe!==we.version||ve!==E.toneMapping)&&(ee.material.needsUpdate=!0,ue=we,fe=we.version,ve=E.toneMapping),ee.layers.enableAll(),z.unshift(ee,ee.geometry,ee.material,0,0,null))}function m(O,R){O.getRGB(kc,SP(E)),z.buffers.color.setClear(kc.r,kc.g,kc.b,R,Y)}return{getClearColor:function(){return he},setClearColor:function(E,O=1){he.set(E),ce=O,m(he,ce)},getClearAlpha:function(){return ce},setClearAlpha:function(E){ce=E,m(he,ce)},render:p}}function kk(E,O,R,z){let V=E.getParameter(34921),j=z.isWebGL2?null:O.get("OES_vertex_array_object"),Y=z.isWebGL2||j!==null,ee={},se=g(null),he=se,ce=!1;function h(O,z,V,j,ee){let se=!1;if(Y){let E=m(j,V,z);he!==E&&(he=E,f(he.object)),se=y(O,j,V,ee),se&&x(O,j,V,ee)}else{let E=z.wireframe===!0;(he.geometry!==j.id||he.program!==V.id||he.wireframe!==E)&&(he.geometry=j.id,he.program=V.id,he.wireframe=E,se=!0)}ee!==null&&R.update(ee,34963),(se||ce)&&(ce=!1,b(O,z,V,j),ee!==null&&E.bindBuffer(34963,R.get(ee).buffer))}function d(){return z.isWebGL2?E.createVertexArray():j.createVertexArrayOES()}function f(O){return z.isWebGL2?E.bindVertexArray(O):j.bindVertexArrayOES(O)}function p(O){return z.isWebGL2?E.deleteVertexArray(O):j.deleteVertexArrayOES(O)}function m(E,O,R){let z=R.wireframe===!0,V=ee[E.id];V===void 0&&(V={},ee[E.id]=V);let j=V[O.id];j===void 0&&(j={},V[O.id]=j);let Y=j[z];return Y===void 0&&(Y=g(d()),j[z]=Y),Y}function g(E){let O=[],R=[],z=[];for(let E=0;E<V;E++)O[E]=0,R[E]=0,z[E]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:O,enabledAttributes:R,attributeDivisors:z,object:E,attributes:{},index:null}}function y(E,O,R,z){let V=he.attributes,j=O.attributes,Y=0,ee=R.getAttributes();for(let O in ee)if(ee[O].location>=0){let R=V[O],z=j[O];if(z===void 0&&(O==="instanceMatrix"&&E.instanceMatrix&&(z=E.instanceMatrix),O==="instanceColor"&&E.instanceColor&&(z=E.instanceColor)),R===void 0||R.attribute!==z||z&&R.data!==z.data)return!0;Y++}return he.attributesNum!==Y||he.index!==z}function x(E,O,R,z){let V={},j=O.attributes,Y=0,ee=R.getAttributes();for(let O in ee)if(ee[O].location>=0){let R=j[O];R===void 0&&(O==="instanceMatrix"&&E.instanceMatrix&&(R=E.instanceMatrix),O==="instanceColor"&&E.instanceColor&&(R=E.instanceColor));let z={};z.attribute=R,R&&R.data&&(z.data=R.data),V[O]=z,Y++}he.attributes=V,he.attributesNum=Y,he.index=z}function v(){let E=he.newAttributes;for(let O=0,R=E.length;O<R;O++)E[O]=0}function S(E){w(E,0)}function w(R,V){let j=he.newAttributes,Y=he.enabledAttributes,ee=he.attributeDivisors;j[R]=1,Y[R]===0&&(E.enableVertexAttribArray(R),Y[R]=1),ee[R]!==V&&((z.isWebGL2?E:O.get("ANGLE_instanced_arrays"))[z.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](R,V),ee[R]=V)}function A(){let O=he.newAttributes,R=he.enabledAttributes;for(let z=0,V=R.length;z<V;z++)R[z]!==O[z]&&(E.disableVertexAttribArray(z),R[z]=0)}function T(O,R,V,j,Y,ee){z.isWebGL2!==!0||V!==5124&&V!==5125?E.vertexAttribPointer(O,R,V,j,Y,ee):E.vertexAttribIPointer(O,R,V,Y,ee)}function b(V,j,Y,ee){if(z.isWebGL2===!1&&(V.isInstancedMesh||ee.isInstancedBufferGeometry)&&O.get("ANGLE_instanced_arrays")===null)return;v();let se=ee.attributes,he=Y.getAttributes(),ce=j.defaultAttributeValues;for(let O in he){let z=he[O];if(z.location>=0){let j=se[O];if(j===void 0&&(O==="instanceMatrix"&&V.instanceMatrix&&(j=V.instanceMatrix),O==="instanceColor"&&V.instanceColor&&(j=V.instanceColor)),j!==void 0){let O=j.normalized,Y=j.itemSize,se=R.get(j);if(se===void 0)continue;let he=se.buffer,ce=se.type,ue=se.bytesPerElement;if(j.isInterleavedBufferAttribute){let R=j.data,se=R.stride,fe=j.offset;if(R.isInstancedInterleavedBuffer){for(let E=0;E<z.locationSize;E++)w(z.location+E,R.meshPerAttribute);V.isInstancedMesh!==!0&&ee._maxInstanceCount===void 0&&(ee._maxInstanceCount=R.meshPerAttribute*R.count)}else for(let E=0;E<z.locationSize;E++)S(z.location+E);E.bindBuffer(34962,he);for(let E=0;E<z.locationSize;E++)T(z.location+E,Y/z.locationSize,ce,O,se*ue,(fe+Y/z.locationSize*E)*ue)}else{if(j.isInstancedBufferAttribute){for(let E=0;E<z.locationSize;E++)w(z.location+E,j.meshPerAttribute);V.isInstancedMesh!==!0&&ee._maxInstanceCount===void 0&&(ee._maxInstanceCount=j.meshPerAttribute*j.count)}else for(let E=0;E<z.locationSize;E++)S(z.location+E);E.bindBuffer(34962,he);for(let E=0;E<z.locationSize;E++)T(z.location+E,Y/z.locationSize,ce,O,Y*ue,Y/z.locationSize*E*ue)}}else if(ce!==void 0){let R=ce[O];if(R!==void 0)switch(R.length){case 2:E.vertexAttrib2fv(z.location,R);break;case 3:E.vertexAttrib3fv(z.location,R);break;case 4:E.vertexAttrib4fv(z.location,R);break;default:E.vertexAttrib1fv(z.location,R)}}}}A()}function M(){I();for(let E in ee){let O=ee[E];for(let E in O){let R=O[E];for(let E in R)p(R[E].object),delete R[E];delete O[E]}delete ee[E]}}function C(E){if(ee[E.id]===void 0)return;let O=ee[E.id];for(let E in O){let R=O[E];for(let E in R)p(R[E].object),delete R[E];delete O[E]}delete ee[E.id]}function P(E){for(let O in ee){let R=ee[O];if(R[E.id]===void 0)continue;let z=R[E.id];for(let E in z)p(z[E].object),delete z[E];delete R[E.id]}}function I(){_(),ce=!0,he!==se&&(he=se,f(he.object))}function _(){se.geometry=null,se.program=null,se.wireframe=!1}return{setup:h,reset:I,resetDefaultState:_,dispose:M,releaseStatesOfGeometry:C,releaseStatesOfProgram:P,initAttributes:v,enableAttribute:S,disableUnusedAttributes:A}}function Gk(E,O,R,z){let V,j=z.isWebGL2;function o(E){V=E}function a(O,z){E.drawArrays(V,O,z),R.update(z,V,1)}function l(z,Y,ee){if(ee===0)return;let se,he;if(j)se=E,he="drawArraysInstanced";else if(se=O.get("ANGLE_instanced_arrays"),he="drawArraysInstancedANGLE",se===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}se[he](V,z,Y,ee),R.update(Y,V,ee)}this.setMode=o,this.render=a,this.renderInstances=l}function jk(E,O,R){let z;function i(){if(z!==void 0)return z;if(O.has("EXT_texture_filter_anisotropic")===!0){let R=O.get("EXT_texture_filter_anisotropic");z=E.getParameter(R.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else z=0;return z}function s(O){if(O==="highp"){if(E.getShaderPrecisionFormat(35633,36338).precision>0&&E.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";O="mediump"}return O==="mediump"&&E.getShaderPrecisionFormat(35633,36337).precision>0&&E.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}let V=typeof WebGL2RenderingContext<"u"&&E instanceof WebGL2RenderingContext,j=R.precision!==void 0?R.precision:"highp",Y=s(j);Y!==j&&(console.warn("THREE.WebGLRenderer:",j,"not supported, using",Y,"instead."),j=Y);let ee=V||O.has("WEBGL_draw_buffers"),se=R.logarithmicDepthBuffer===!0,he=E.getParameter(34930),ce=E.getParameter(35660),ue=E.getParameter(3379),fe=E.getParameter(34076),ve=E.getParameter(34921),we=E.getParameter(36347),Se=E.getParameter(36348),_e=E.getParameter(36349),Ae=ce>0,Ce=V||O.has("OES_texture_float"),Te=Ae&&Ce,Ie=V?E.getParameter(36183):0;return{isWebGL2:V,drawBuffers:ee,getMaxAnisotropy:i,getMaxPrecision:s,precision:j,logarithmicDepthBuffer:se,maxTextures:he,maxVertexTextures:ce,maxTextureSize:ue,maxCubemapSize:fe,maxAttributes:ve,maxVertexUniforms:we,maxVaryings:Se,maxFragmentUniforms:_e,vertexTextures:Ae,floatFragmentTextures:Ce,floatVertexTextures:Te,maxSamples:Ie}}function Hk(E){let O=this,R=null,z=0,V=!1,j=!1,Y=new _o,ee=new wn,se={value:null,needsUpdate:!1};this.uniform=se,this.numPlanes=0,this.numIntersection=0,this.init=function(E,O){let R=E.length!==0||O||z!==0||V;return V=O,z=E.length,R},this.beginShadows=function(){j=!0,u(null)},this.endShadows=function(){j=!1},this.setGlobalState=function(E,O){R=u(E,O,0)},this.setState=function(O,Y,ee){let he=O.clippingPlanes,ce=O.clipIntersection,ue=O.clipShadows,fe=E.get(O);if(!V||he===null||he.length===0||j&&!ue)j?u(null):c();else{let E=j?0:z,O=E*4,V=fe.clippingState||null;se.value=V,V=u(he,Y,O,ee);for(let E=0;E!==O;++E)V[E]=R[E];fe.clippingState=V,this.numIntersection=ce?this.numPlanes:0,this.numPlanes+=E}};function c(){se.value!==R&&(se.value=R,se.needsUpdate=z>0),O.numPlanes=z,O.numIntersection=0}function u(E,R,z,V){let j=E!==null?E.length:0,he=null;if(j!==0){if(he=se.value,V!==!0||he===null){let O=z+j*4,V=R.matrixWorldInverse;ee.getNormalMatrix(V),(he===null||he.length<O)&&(he=new Float32Array(O));for(let O=0,R=z;O!==j;++O,R+=4)Y.copy(E[O]).applyMatrix4(V,ee),Y.normal.toArray(he,R),he[R+3]=Y.constant}se.value=he,se.needsUpdate=!0}return O.numPlanes=j,O.numIntersection=0,he}}function Wk(E){let O=new WeakMap;function e(E,O){return O===ni?E.mapping=ii:O===si&&(E.mapping=ri),E}function r(R){if(R&&R.isTexture&&R.isRenderTargetTexture===!1){let z=R.mapping;if(z===ni||z===si){if(O.has(R)){let E=O.get(R).texture;return e(E,R.mapping)}{let z=R.image;if(z&&z.height>0){let V=new yo(z.height/2);return V.fromEquirectangularTexture(E,R),O.set(R,V),R.addEventListener("dispose",i),e(V.texture,R.mapping)}return null}}}return R}function i(E){let R=E.target;R.removeEventListener("dispose",i);let z=O.get(R);z!==void 0&&(O.delete(R),z.dispose())}function s(){O=new WeakMap}return{get:r,dispose:s}}var Vc=class extends co{constructor(E=-1,O=1,R=1,z=-1,V=.1,j=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=E,this.right=O,this.top=R,this.bottom=z,this.near=V,this.far=j,this.updateProjectionMatrix()}copy(E,O){return super.copy(E,O),this.left=E.left,this.right=E.right,this.top=E.top,this.bottom=E.bottom,this.near=E.near,this.far=E.far,this.zoom=E.zoom,this.view=E.view===null?null:Object.assign({},E.view),this}setViewOffset(E,O,R,z,V,j){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=E,this.view.fullHeight=O,this.view.offsetX=R,this.view.offsetY=z,this.view.width=V,this.view.height=j,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let E=(this.right-this.left)/(2*this.zoom),O=(this.top-this.bottom)/(2*this.zoom),R=(this.right+this.left)/2,z=(this.top+this.bottom)/2,V=R-E,j=R+E,Y=z+O,ee=z-O;if(this.view!==null&&this.view.enabled){let E=(this.right-this.left)/this.view.fullWidth/this.zoom,O=(this.top-this.bottom)/this.view.fullHeight/this.zoom;V+=E*this.view.offsetX,j=V+E*this.view.width,Y-=O*this.view.offsetY,ee=Y-O*this.view.height}this.projectionMatrix.makeOrthographic(V,j,Y,ee,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(E){let O=super.toJSON(E);return O.object.zoom=this.zoom,O.object.left=this.left,O.object.right=this.right,O.object.top=this.top,O.object.bottom=this.bottom,O.object.near=this.near,O.object.far=this.far,this.view!==null&&(O.object.view=Object.assign({},this.view)),O}},Gc=4,Hc=[.125,.215,.35,.446,.526,.582],Wc=20,qc=new Vc,Yc=new On,Qc=null,Zc=(1+Math.sqrt(5))/2,Jc=1/Zc,$c=[new Wn(1,1,1),new Wn(-1,1,1),new Wn(1,1,-1),new Wn(-1,1,-1),new Wn(0,Zc,Jc),new Wn(0,Zc,-Jc),new Wn(Jc,0,Zc),new Wn(-Jc,0,Zc),new Wn(Zc,Jc,0),new Wn(-Zc,Jc,0)],ed=class{constructor(E){this._renderer=E,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(E,O=0,R=.1,z=100){Qc=this._renderer.getRenderTarget(),this._setSize(256);let V=this._allocateTargets();return V.depthBuffer=!0,this._sceneToCubeUV(E,R,z,V),O>0&&this._blur(V,0,0,O),this._applyPMREM(V),this._cleanup(V),V}fromEquirectangular(E,O=null){return this._fromTexture(E,O)}fromCubemap(E,O=null){return this._fromTexture(E,O)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=CC(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=MC(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(E){this._lodMax=Math.floor(Math.log2(E)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let E=0;E<this._lodPlanes.length;E++)this._lodPlanes[E].dispose()}_cleanup(E){this._renderer.setRenderTarget(Qc),E.scissorTest=!1,Zg(E,0,0,E.width,E.height)}_fromTexture(E,O){E.mapping===ii||E.mapping===ri?this._setSize(E.image.length===0?16:E.image[0].width||E.image[0].image.width):this._setSize(E.image.width/4),Qc=this._renderer.getRenderTarget();let R=O||this._allocateTargets();return this._textureToCubeUV(E,R),this._applyPMREM(R),this._cleanup(R),R}_allocateTargets(){let E=3*Math.max(this._cubeSize,112),O=4*this._cubeSize,R={magFilter:yi,minFilter:yi,generateMipmaps:!1,type:Oi,format:Ni,encoding:Xr,depthBuffer:!1},z=TC(E,O,R);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==E||this._pingPongRenderTarget.height!==O){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=TC(E,O,R);let{_lodMax:z}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=qk(z)),this._blurMaterial=Xk(z,E,O)}return z}_compileMaterial(E){let O=new eo(this._lodPlanes[0],E);this._renderer.compile(O,qc)}_sceneToCubeUV(E,O,R,z){let V=new po(90,1,O,R),j=[1,-1,1,1,1,1],Y=[1,1,1,-1,-1,-1],ee=this._renderer,se=ee.autoClear,he=ee.toneMapping;ee.getClearColor(Yc),ee.toneMapping=Xt,ee.autoClear=!1;let ce=new xa({name:"PMREM.Background",side:Ue,depthWrite:!1,depthTest:!1}),ue=new eo(new to,ce),fe=!1,ve=E.background;ve?ve.isColor&&(ce.color.copy(ve),E.background=null,fe=!0):(ce.color.copy(Yc),fe=!0);for(let O=0;O<6;O++){let R=O%3;R===0?(V.up.set(0,j[O],0),V.lookAt(Y[O],0,0)):R===1?(V.up.set(0,0,j[O]),V.lookAt(0,Y[O],0)):(V.up.set(0,j[O],0),V.lookAt(0,0,Y[O]));let se=this._cubeSize;Zg(z,R*se,O>2?se:0,se,se),ee.setRenderTarget(z),fe&&ee.render(ue,V),ee.render(E,V)}ue.geometry.dispose(),ue.material.dispose(),ee.toneMapping=he,ee.autoClear=se,E.background=ve}_textureToCubeUV(E,O){let R=this._renderer,z=E.mapping===ii||E.mapping===ri;z?(this._cubemapMaterial===null&&(this._cubemapMaterial=CC()),this._cubemapMaterial.uniforms.flipEnvMap.value=E.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=MC());let V=z?this._cubemapMaterial:this._equirectMaterial,j=new eo(this._lodPlanes[0],V),Y=V.uniforms;Y.envMap.value=E;let ee=this._cubeSize;Zg(O,0,0,3*ee,2*ee),R.setRenderTarget(O),R.render(j,qc)}_applyPMREM(E){let O=this._renderer,R=O.autoClear;O.autoClear=!1;for(let O=1;O<this._lodPlanes.length;O++){let R=Math.sqrt(this._sigmas[O]*this._sigmas[O]-this._sigmas[O-1]*this._sigmas[O-1]),z=$c[(O-1)%$c.length];this._blur(E,O-1,O,R,z)}O.autoClear=R}_blur(E,O,R,z,V){let j=this._pingPongRenderTarget;this._halfBlur(E,j,O,R,z,"latitudinal",V),this._halfBlur(j,E,R,R,z,"longitudinal",V)}_halfBlur(E,O,R,z,V,j,Y){let ee=this._renderer,se=this._blurMaterial;j!=="latitudinal"&&j!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");let he=3,ce=new eo(this._lodPlanes[z],se),ue=se.uniforms,fe=this._sizeLods[R]-1,ve=isFinite(V)?Math.PI/(2*fe):2*Math.PI/(2*Wc-1),we=V/ve,Se=isFinite(V)?1+Math.floor(he*we):Wc;Se>Wc&&console.warn(`sigmaRadians, ${V}, is too large and will clip, as it requested ${Se} samples when the maximum is set to ${Wc}`);let _e=[],Ae=0;for(let E=0;E<Wc;++E){let O=E/we,R=Math.exp(-O*O/2);_e.push(R),E===0?Ae+=R:E<Se&&(Ae+=2*R)}for(let E=0;E<_e.length;E++)_e[E]=_e[E]/Ae;ue.envMap.value=E.texture,ue.samples.value=Se,ue.weights.value=_e,ue.latitudinal.value=j==="latitudinal",Y&&(ue.poleAxis.value=Y);let{_lodMax:Ce}=this;ue.dTheta.value=ve,ue.mipInt.value=Ce-R;let Te=this._sizeLods[z],Ie=3*Te*(z>Ce-Gc?z-Ce+Gc:0),Fe=4*(this._cubeSize-Te);Zg(O,Ie,Fe,3*Te,2*Te),ee.setRenderTarget(O),ee.render(ce,qc)}};function qk(E){let O=[],R=[],z=[],V=E,j=E-Gc+1+Hc.length;for(let Y=0;Y<j;Y++){let j=Math.pow(2,V);R.push(j);let ee=1/j;Y>E-Gc?ee=Hc[Y-E+Gc-1]:Y===0&&(ee=0),z.push(ee);let se=1/(j-2),he=-se,ce=1+se,ue=[he,he,ce,he,ce,ce,he,he,ce,ce,he,ce],fe=6,ve=6,we=3,Se=2,_e=1,Ae=new Float32Array(we*ve*fe),Ce=new Float32Array(Se*ve*fe),Te=new Float32Array(_e*ve*fe);for(let E=0;E<fe;E++){let O=E%3*2/3-1,R=E>2?0:-1,z=[O,R,0,O+2/3,R,0,O+2/3,R+1,0,O,R,0,O+2/3,R+1,0,O,R+1,0];Ae.set(z,we*ve*E),Ce.set(ue,Se*ve*E);let V=[E,E,E,E,E,E];Te.set(V,_e*ve*E)}let Ie=new Na;Ie.setAttribute("position",new Sa(Ae,we)),Ie.setAttribute("uv",new Sa(Ce,Se)),Ie.setAttribute("faceIndex",new Sa(Te,_e)),O.push(Ie),V>Gc&&V--}return{lodPlanes:O,sizeLods:R,sigmas:z}}function TC(E,O,R){let z=new Un(E,O,R);return z.texture.mapping=ai,z.texture.name="PMREM.cubeUv",z.scissorTest=!0,z}function Zg(E,O,R,z,V){E.viewport.set(O,R,z,V),E.scissor.set(O,R,z,V)}function Xk(E,O,R){let z=new Float32Array(Wc),V=new Wn(0,1,0);return new lo({name:"SphericalGaussianBlur",defines:{n:Wc,CUBEUV_TEXEL_WIDTH:1/O,CUBEUV_TEXEL_HEIGHT:1/R,CUBEUV_MAX_MIP:`${E}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:z},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:V}},vertexShader:KS(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t",blending:qe,depthTest:!1,depthWrite:!1})}function MC(){return new lo({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:KS(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tgl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );\n\n\t\t\t}\n\t\t",blending:qe,depthTest:!1,depthWrite:!1})}function CC(){return new lo({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:KS(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tuniform float flipEnvMap;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n\t\t\t}\n\t\t",blending:qe,depthTest:!1,depthWrite:!1})}function KS(){return"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t"}function Yk(E){let O=new WeakMap,R=null;function r(z){if(z&&z.isTexture){let V=z.mapping,j=V===ni||V===si,Y=V===ii||V===ri;if(j||Y){if(z.isRenderTargetTexture&&z.needsPMREMUpdate===!0){z.needsPMREMUpdate=!1;let V=O.get(z);return R===null&&(R=new ed(E)),V=j?R.fromEquirectangular(z,V):R.fromCubemap(z,V),O.set(z,V),V.texture}if(O.has(z))return O.get(z).texture;{let V=z.image;if(j&&V&&V.height>0||Y&&V&&i(V)){R===null&&(R=new ed(E));let V=j?R.fromEquirectangular(z):R.fromCubemap(z);return O.set(z,V),z.addEventListener("dispose",s),V.texture}return null}}}return z}function i(E){let O=0,R=6;for(let z=0;z<R;z++)E[z]!==void 0&&O++;return O===R}function s(E){let R=E.target;R.removeEventListener("dispose",s);let z=O.get(R);z!==void 0&&(O.delete(R),z.dispose())}function o(){O=new WeakMap,R!==null&&(R.dispose(),R=null)}return{get:r,dispose:o}}function Kk(E){let O={};function e(R){if(O[R]!==void 0)return O[R];let z;switch(R){case"WEBGL_depth_texture":z=E.getExtension("WEBGL_depth_texture")||E.getExtension("MOZ_WEBGL_depth_texture")||E.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":z=E.getExtension("EXT_texture_filter_anisotropic")||E.getExtension("MOZ_EXT_texture_filter_anisotropic")||E.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":z=E.getExtension("WEBGL_compressed_texture_s3tc")||E.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||E.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":z=E.getExtension("WEBGL_compressed_texture_pvrtc")||E.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:z=E.getExtension(R)}return O[R]=z,z}return{has:function(E){return e(E)!==null},init:function(E){E.isWebGL2?e("EXT_color_buffer_float"):(e("WEBGL_depth_texture"),e("OES_texture_float"),e("OES_texture_half_float"),e("OES_texture_half_float_linear"),e("OES_standard_derivatives"),e("OES_element_index_uint"),e("OES_vertex_array_object"),e("ANGLE_instanced_arrays")),e("OES_texture_float_linear"),e("EXT_color_buffer_half_float"),e("WEBGL_multisampled_render_to_texture")},get:function(E){let O=e(E);return O===null&&console.warn("THREE.WebGLRenderer: "+E+" extension not supported."),O}}}function Qk(E,O,R,z){let V={},j=new WeakMap;function o(E){let Y=E.target;Y.index!==null&&O.remove(Y.index);for(let E in Y.attributes)O.remove(Y.attributes[E]);Y.removeEventListener("dispose",o),delete V[Y.id];let ee=j.get(Y);ee&&(O.remove(ee),j.delete(Y)),z.releaseStatesOfGeometry(Y),Y.isInstancedBufferGeometry===!0&&delete Y._maxInstanceCount,R.memory.geometries--}function a(E,O){return V[O.id]===!0||(O.addEventListener("dispose",o),V[O.id]=!0,R.memory.geometries++),O}function l(E){let R=E.attributes;for(let E in R)O.update(R[E],34962);let z=E.morphAttributes;for(let E in z){let R=z[E];for(let E=0,z=R.length;E<z;E++)O.update(R[E],34962)}}function c(E){let R=[],z=E.index,V=E.attributes.position,Y=0;if(z!==null){let E=z.array;Y=z.version;for(let O=0,z=E.length;O<z;O+=3){let z=E[O+0],V=E[O+1],j=E[O+2];R.push(z,V,V,j,j,z)}}else{let E=V.array;Y=V.version;for(let O=0,z=E.length/3-1;O<z;O+=3){let E=O+0,z=O+1,V=O+2;R.push(E,z,z,V,V,E)}}let ee=new(xP(R)?Aa:_a)(R,1);ee.version=Y;let se=j.get(E);se&&O.remove(se),j.set(E,ee)}function u(E){let O=j.get(E);if(O){let R=E.index;R!==null&&O.version<R.version&&c(E)}else c(E);return j.get(E)}return{get:a,update:l,getWireframeAttribute:u}}function Zk(E,O,R,z){let V,j=z.isWebGL2;function o(E){V=E}let Y,ee;function c(E){Y=E.type,ee=E.bytesPerElement}function u(O,z){E.drawElements(V,z,Y,O*ee),R.update(z,V,1)}function h(z,se,he){if(he===0)return;let ce,ue;if(j)ce=E,ue="drawElementsInstanced";else if(ce=O.get("ANGLE_instanced_arrays"),ue="drawElementsInstancedANGLE",ce===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}ce[ue](V,se,Y,z*ee,he),R.update(se,V,he)}this.setMode=o,this.setIndex=c,this.render=u,this.renderInstances=h}function Jk(E){let O={geometries:0,textures:0},R={frame:0,calls:0,triangles:0,points:0,lines:0};function r(E,O,z){switch(R.calls++,O){case 4:R.triangles+=z*(E/3);break;case 1:R.lines+=z*(E/2);break;case 3:R.lines+=z*(E-1);break;case 2:R.lines+=z*E;break;case 0:R.points+=z*E;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",O);break}}function i(){R.frame++,R.calls=0,R.triangles=0,R.points=0,R.lines=0}return{memory:O,render:R,programs:null,autoReset:!0,reset:i,update:r}}function $k(E,O){return E[0]-O[0]}function eG(E,O){return Math.abs(O[1])-Math.abs(E[1])}function tG(E,O,R){let z={},V=new Float32Array(8),j=new WeakMap,Y=new Nn,ee=[];for(let E=0;E<8;E++)ee[E]=[E,0];function l(se,he,ce,ue){let fe=se.morphTargetInfluences;if(O.isWebGL2===!0){let z=he.morphAttributes.position||he.morphAttributes.normal||he.morphAttributes.color,V=z!==void 0?z.length:0,ee=j.get(he);if(ee===void 0||ee.count!==V){let L=function(){_e.dispose(),j.delete(he),he.removeEventListener("dispose",L)};ee!==void 0&&ee.texture.dispose();let E=he.morphAttributes.position!==void 0,R=he.morphAttributes.normal!==void 0,z=he.morphAttributes.color!==void 0,se=he.morphAttributes.position||[],ce=he.morphAttributes.normal||[],ue=he.morphAttributes.color||[],fe=0;E===!0&&(fe=1),R===!0&&(fe=2),z===!0&&(fe=3);let ve=he.attributes.position.count*fe,we=1;ve>O.maxTextureSize&&(we=Math.ceil(ve/O.maxTextureSize),ve=O.maxTextureSize);let Se=new Float32Array(ve*we*4*V),_e=new kn(Se,ve,we,V);_e.type=Ii,_e.needsUpdate=!0;let Ae=fe*4;for(let O=0;O<V;O++){let V=se[O],j=ce[O],ee=ue[O],he=ve*we*4*O;for(let O=0;O<V.count;O++){let se=O*Ae;E===!0&&(Y.fromBufferAttribute(V,O),Se[he+se+0]=Y.x,Se[he+se+1]=Y.y,Se[he+se+2]=Y.z,Se[he+se+3]=0),R===!0&&(Y.fromBufferAttribute(j,O),Se[he+se+4]=Y.x,Se[he+se+5]=Y.y,Se[he+se+6]=Y.z,Se[he+se+7]=0),z===!0&&(Y.fromBufferAttribute(ee,O),Se[he+se+8]=Y.x,Se[he+se+9]=Y.y,Se[he+se+10]=Y.z,Se[he+se+11]=ee.itemSize===4?Y.w:1)}}ee={count:V,texture:_e,size:new bn(ve,we)},j.set(he,ee),he.addEventListener("dispose",L)}let se=0;for(let E=0;E<fe.length;E++)se+=fe[E];let ce=he.morphTargetsRelative?1:1-se;ue.getUniforms().setValue(E,"morphTargetBaseInfluence",ce),ue.getUniforms().setValue(E,"morphTargetInfluences",fe),ue.getUniforms().setValue(E,"morphTargetsTexture",ee.texture,R),ue.getUniforms().setValue(E,"morphTargetsTextureSize",ee.size)}else{let O=fe===void 0?0:fe.length,R=z[he.id];if(R===void 0||R.length!==O){R=[];for(let E=0;E<O;E++)R[E]=[E,0];z[he.id]=R}for(let E=0;E<O;E++){let O=R[E];O[0]=E,O[1]=fe[E]}R.sort(eG);for(let E=0;E<8;E++)E<O&&R[E][1]?(ee[E][0]=R[E][0],ee[E][1]=R[E][1]):(ee[E][0]=Number.MAX_SAFE_INTEGER,ee[E][1]=0);ee.sort($k);let j=he.morphAttributes.position,Y=he.morphAttributes.normal,se=0;for(let E=0;E<8;E++){let O=ee[E],R=O[0],z=O[1];R!==Number.MAX_SAFE_INTEGER&&z?(j&&he.getAttribute("morphTarget"+E)!==j[R]&&he.setAttribute("morphTarget"+E,j[R]),Y&&he.getAttribute("morphNormal"+E)!==Y[R]&&he.setAttribute("morphNormal"+E,Y[R]),V[E]=z,se+=z):(j&&he.hasAttribute("morphTarget"+E)===!0&&he.deleteAttribute("morphTarget"+E),Y&&he.hasAttribute("morphNormal"+E)===!0&&he.deleteAttribute("morphNormal"+E),V[E]=0)}let ce=he.morphTargetsRelative?1:1-se;ue.getUniforms().setValue(E,"morphTargetBaseInfluence",ce),ue.getUniforms().setValue(E,"morphTargetInfluences",V)}}return{update:l}}function rG(E,O,R,z){let V=new WeakMap;function s(E){let j=z.render.frame,Y=E.geometry,ee=O.get(E,Y);return V.get(ee)!==j&&(O.update(ee),V.set(ee,j)),E.isInstancedMesh&&(E.hasEventListener("dispose",a)===!1&&E.addEventListener("dispose",a),R.update(E.instanceMatrix,34962),E.instanceColor!==null&&R.update(E.instanceColor,34962)),ee}function o(){V=new WeakMap}function a(E){let O=E.target;O.removeEventListener("dispose",a),R.remove(O.instanceMatrix),O.instanceColor!==null&&R.remove(O.instanceColor)}return{update:s,dispose:o}}var td=new Fn,id=new kn,rd=new Vn,nd=new vo,sd=[],ad=[],od=new Float32Array(16),hd=new Float32Array(9),dd=new Float32Array(4);function lh(E,O,R){let z=E[0];if(z==null||z<=0||z>0)return E;let V=O*R,j=sd[V];if(j===void 0&&(j=new Float32Array(V),sd[V]=j),O!==0){z.toArray(j,0);for(let z=1,V=0;z!==O;++z)V+=R,E[z].toArray(j,V)}return j}function Mi(E,O){if(E.length!==O.length)return!1;for(let R=0,z=E.length;R<z;R++)if(E[R]!==O[R])return!1;return!0}function Ci(E,O){for(let R=0,z=O.length;R<z;R++)E[R]=O[R]}function Uy(E,O){let R=ad[O];R===void 0&&(R=new Int32Array(O),ad[O]=R);for(let z=0;z!==O;++z)R[z]=E.allocateTextureUnit();return R}function iG(E,O){let R=this.cache;R[0]!==O&&(E.uniform1f(this.addr,O),R[0]=O)}function nG(E,O){let R=this.cache;if(O.x!==void 0)(R[0]!==O.x||R[1]!==O.y)&&(E.uniform2f(this.addr,O.x,O.y),R[0]=O.x,R[1]=O.y);else{if(Mi(R,O))return;E.uniform2fv(this.addr,O),Ci(R,O)}}function sG(E,O){let R=this.cache;if(O.x!==void 0)(R[0]!==O.x||R[1]!==O.y||R[2]!==O.z)&&(E.uniform3f(this.addr,O.x,O.y,O.z),R[0]=O.x,R[1]=O.y,R[2]=O.z);else if(O.r!==void 0)(R[0]!==O.r||R[1]!==O.g||R[2]!==O.b)&&(E.uniform3f(this.addr,O.r,O.g,O.b),R[0]=O.r,R[1]=O.g,R[2]=O.b);else{if(Mi(R,O))return;E.uniform3fv(this.addr,O),Ci(R,O)}}function oG(E,O){let R=this.cache;if(O.x!==void 0)(R[0]!==O.x||R[1]!==O.y||R[2]!==O.z||R[3]!==O.w)&&(E.uniform4f(this.addr,O.x,O.y,O.z,O.w),R[0]=O.x,R[1]=O.y,R[2]=O.z,R[3]=O.w);else{if(Mi(R,O))return;E.uniform4fv(this.addr,O),Ci(R,O)}}function aG(E,O){let R=this.cache,z=O.elements;if(z===void 0){if(Mi(R,O))return;E.uniformMatrix2fv(this.addr,!1,O),Ci(R,O)}else{if(Mi(R,z))return;dd.set(z),E.uniformMatrix2fv(this.addr,!1,dd),Ci(R,z)}}function lG(E,O){let R=this.cache,z=O.elements;if(z===void 0){if(Mi(R,O))return;E.uniformMatrix3fv(this.addr,!1,O),Ci(R,O)}else{if(Mi(R,z))return;hd.set(z),E.uniformMatrix3fv(this.addr,!1,hd),Ci(R,z)}}function cG(E,O){let R=this.cache,z=O.elements;if(z===void 0){if(Mi(R,O))return;E.uniformMatrix4fv(this.addr,!1,O),Ci(R,O)}else{if(Mi(R,z))return;od.set(z),E.uniformMatrix4fv(this.addr,!1,od),Ci(R,z)}}function uG(E,O){let R=this.cache;R[0]!==O&&(E.uniform1i(this.addr,O),R[0]=O)}function hG(E,O){let R=this.cache;if(O.x!==void 0)(R[0]!==O.x||R[1]!==O.y)&&(E.uniform2i(this.addr,O.x,O.y),R[0]=O.x,R[1]=O.y);else{if(Mi(R,O))return;E.uniform2iv(this.addr,O),Ci(R,O)}}function dG(E,O){let R=this.cache;if(O.x!==void 0)(R[0]!==O.x||R[1]!==O.y||R[2]!==O.z)&&(E.uniform3i(this.addr,O.x,O.y,O.z),R[0]=O.x,R[1]=O.y,R[2]=O.z);else{if(Mi(R,O))return;E.uniform3iv(this.addr,O),Ci(R,O)}}function fG(E,O){let R=this.cache;if(O.x!==void 0)(R[0]!==O.x||R[1]!==O.y||R[2]!==O.z||R[3]!==O.w)&&(E.uniform4i(this.addr,O.x,O.y,O.z,O.w),R[0]=O.x,R[1]=O.y,R[2]=O.z,R[3]=O.w);else{if(Mi(R,O))return;E.uniform4iv(this.addr,O),Ci(R,O)}}function pG(E,O){let R=this.cache;R[0]!==O&&(E.uniform1ui(this.addr,O),R[0]=O)}function mG(E,O){let R=this.cache;if(O.x!==void 0)(R[0]!==O.x||R[1]!==O.y)&&(E.uniform2ui(this.addr,O.x,O.y),R[0]=O.x,R[1]=O.y);else{if(Mi(R,O))return;E.uniform2uiv(this.addr,O),Ci(R,O)}}function gG(E,O){let R=this.cache;if(O.x!==void 0)(R[0]!==O.x||R[1]!==O.y||R[2]!==O.z)&&(E.uniform3ui(this.addr,O.x,O.y,O.z),R[0]=O.x,R[1]=O.y,R[2]=O.z);else{if(Mi(R,O))return;E.uniform3uiv(this.addr,O),Ci(R,O)}}function yG(E,O){let R=this.cache;if(O.x!==void 0)(R[0]!==O.x||R[1]!==O.y||R[2]!==O.z||R[3]!==O.w)&&(E.uniform4ui(this.addr,O.x,O.y,O.z,O.w),R[0]=O.x,R[1]=O.y,R[2]=O.z,R[3]=O.w);else{if(Mi(R,O))return;E.uniform4uiv(this.addr,O),Ci(R,O)}}function vG(E,O,R){let z=this.cache,V=R.allocateTextureUnit();z[0]!==V&&(E.uniform1i(this.addr,V),z[0]=V),R.setTexture2D(O||td,V)}function xG(E,O,R){let z=this.cache,V=R.allocateTextureUnit();z[0]!==V&&(E.uniform1i(this.addr,V),z[0]=V),R.setTexture3D(O||rd,V)}function bG(E,O,R){let z=this.cache,V=R.allocateTextureUnit();z[0]!==V&&(E.uniform1i(this.addr,V),z[0]=V),R.setTextureCube(O||nd,V)}function SG(E,O,R){let z=this.cache,V=R.allocateTextureUnit();z[0]!==V&&(E.uniform1i(this.addr,V),z[0]=V),R.setTexture2DArray(O||id,V)}function wG(E){switch(E){case 5126:return iG;case 35664:return nG;case 35665:return sG;case 35666:return oG;case 35674:return aG;case 35675:return lG;case 35676:return cG;case 5124:case 35670:return uG;case 35667:case 35671:return hG;case 35668:case 35672:return dG;case 35669:case 35673:return fG;case 5125:return pG;case 36294:return mG;case 36295:return gG;case 36296:return yG;case 35678:case 36198:case 36298:case 36306:case 35682:return vG;case 35679:case 36299:case 36307:return xG;case 35680:case 36300:case 36308:case 36293:return bG;case 36289:case 36303:case 36311:case 36292:return SG}}function AG(E,O){E.uniform1fv(this.addr,O)}function EG(E,O){let R=lh(O,this.size,2);E.uniform2fv(this.addr,R)}function TG(E,O){let R=lh(O,this.size,3);E.uniform3fv(this.addr,R)}function MG(E,O){let R=lh(O,this.size,4);E.uniform4fv(this.addr,R)}function CG(E,O){let R=lh(O,this.size,4);E.uniformMatrix2fv(this.addr,!1,R)}function PG(E,O){let R=lh(O,this.size,9);E.uniformMatrix3fv(this.addr,!1,R)}function _G(E,O){let R=lh(O,this.size,16);E.uniformMatrix4fv(this.addr,!1,R)}function IG(E,O){E.uniform1iv(this.addr,O)}function DG(E,O){E.uniform2iv(this.addr,O)}function OG(E,O){E.uniform3iv(this.addr,O)}function RG(E,O){E.uniform4iv(this.addr,O)}function LG(E,O){E.uniform1uiv(this.addr,O)}function BG(E,O){E.uniform2uiv(this.addr,O)}function NG(E,O){E.uniform3uiv(this.addr,O)}function FG(E,O){E.uniform4uiv(this.addr,O)}function VG(E,O,R){let z=this.cache,V=O.length,j=Uy(R,V);Mi(z,j)||(E.uniform1iv(this.addr,j),Ci(z,j));for(let E=0;E!==V;++E)R.setTexture2D(O[E]||td,j[E])}function UG(E,O,R){let z=this.cache,V=O.length,j=Uy(R,V);Mi(z,j)||(E.uniform1iv(this.addr,j),Ci(z,j));for(let E=0;E!==V;++E)R.setTexture3D(O[E]||rd,j[E])}function zG(E,O,R){let z=this.cache,V=O.length,j=Uy(R,V);Mi(z,j)||(E.uniform1iv(this.addr,j),Ci(z,j));for(let E=0;E!==V;++E)R.setTextureCube(O[E]||nd,j[E])}function kG(E,O,R){let z=this.cache,V=O.length,j=Uy(R,V);Mi(z,j)||(E.uniform1iv(this.addr,j),Ci(z,j));for(let E=0;E!==V;++E)R.setTexture2DArray(O[E]||id,j[E])}function GG(E){switch(E){case 5126:return AG;case 35664:return EG;case 35665:return TG;case 35666:return MG;case 35674:return CG;case 35675:return PG;case 35676:return _G;case 5124:case 35670:return IG;case 35667:case 35671:return DG;case 35668:case 35672:return OG;case 35669:case 35673:return RG;case 5125:return LG;case 36294:return BG;case 36295:return NG;case 36296:return FG;case 35678:case 36198:case 36298:case 36306:case 35682:return VG;case 35679:case 36299:case 36307:return UG;case 35680:case 36300:case 36308:case 36293:return zG;case 36289:case 36303:case 36311:case 36292:return kG}}var ud=class{constructor(E,O,R){this.id=E,this.addr=R,this.cache=[],this.setValue=wG(O.type)}},fd=class{constructor(E,O,R){this.id=E,this.addr=R,this.cache=[],this.size=O.size,this.setValue=GG(O.type)}},vd=class{constructor(E){this.id=E,this.seq=[],this.map={}}setValue(E,O,R){if(O===void 0)return;let z=this.seq;for(let V=0,j=z.length;V!==j;++V){let j=z[V];j.setValue(E,O[j.id],R)}}},yd=/(\w+)(\])?(\[|\.)?/g;function RC(E,O){E.seq.push(O),E.map[O.id]=O}function jG(E,O,R){let z=E.name,V=z.length;for(yd.lastIndex=0;;){let j=yd.exec(z),Y=yd.lastIndex,ee=j[1],se=j[2]==="]",he=j[3];if(se&&(ee|=0),he===void 0||he==="["&&Y+2===V){RC(R,he===void 0?new ud(ee,E,O):new fd(ee,E,O));break}{let E=R.map[ee];E===void 0&&(E=new vd(ee),RC(R,E)),R=E}}}var bd=class{constructor(E,O){this.seq=[],this.map={};let R=E.getProgramParameter(O,35718);for(let z=0;z<R;++z){let R=E.getActiveUniform(O,z),V=E.getUniformLocation(O,R.name);jG(R,V,this)}}setValue(E,O,R,z){let V=this.map[O];V!==void 0&&V.setValue(E,R,z)}setOptional(E,O,R){let z=O[R];z!==void 0&&this.setValue(E,R,z)}static upload(E,O,R,z){for(let V=0,j=O.length;V!==j;++V){let j=O[V],Y=R[j.id];Y.needsUpdate!==!1&&j.setValue(E,Y.value,z)}}static seqWithValue(E,O){let R=[];for(let z=0,V=E.length;z!==V;++z){let V=E[z];V.id in O&&R.push(V)}return R}};function LC(E,O,R){let z=E.createShader(O);return E.shaderSource(z,R),E.compileShader(z),z}var wd=0;function WG(E,O){let R=E.split("\n"),z=[],V=Math.max(O-6,0),j=Math.min(O+6,R.length);for(let E=V;E<j;E++){let V=E+1;z.push(`${V===O?">":" "} ${V}: ${R[E]}`)}return z.join("\n")}function qG(E){switch(E){case Xr:return["Linear","( value )"];case Yr:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",E),["Linear","( value )"]}}function BC(E,O,R){let z=E.getShaderParameter(O,35713),V=E.getShaderInfoLog(O).trim();if(z&&V==="")return"";let j=/ERROR: 0:(\d+)/.exec(V);if(j){let z=parseInt(j[1]);return R.toUpperCase()+"\n\n"+V+"\n\n"+WG(E.getShaderSource(O),z)}return V}function XG(E,O){let R=qG(O);return"vec4 "+E+"( vec4 value ) { return LinearTo"+R[0]+R[1]+"; }"}function YG(E,O){let R;switch(O){case Qt:R="Linear";break;case Zt:R="Reinhard";break;case Kt:R="OptimizedCineon";break;case Jt:R="ACESFilmic";break;case $t:R="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",O),R="Linear"}return"vec3 "+E+"( vec3 color ) { return "+R+"ToneMapping( color ); }"}function KG(E){return[E.extensionDerivatives||!!E.envMapCubeUVHeight||E.bumpMap||E.tangentSpaceNormalMap||E.clearcoatNormalMap||E.flatShading||E.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(E.extensionFragDepth||E.logarithmicDepthBuffer)&&E.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",E.extensionDrawBuffers&&E.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(E.extensionShaderTextureLOD||E.envMap||E.transmission)&&E.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(cp).join("\n")}function QG(E){let O=[];for(let R in E){let z=E[R];z!==!1&&O.push("#define "+R+" "+z)}return O.join("\n")}function ZG(E,O){let R={},z=E.getProgramParameter(O,35721);for(let V=0;V<z;V++){let z=E.getActiveAttrib(O,V),j=z.name,Y=1;z.type===35674&&(Y=2),z.type===35675&&(Y=3),z.type===35676&&(Y=4),R[j]={type:z.type,location:E.getAttribLocation(O,j),locationSize:Y}}return R}function cp(E){return E!==""}function NC(E,O){let R=O.numSpotLightShadows+O.numSpotLightMaps-O.numSpotLightShadowsWithMaps;return E.replace(/NUM_DIR_LIGHTS/g,O.numDirLights).replace(/NUM_SPOT_LIGHTS/g,O.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,O.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,R).replace(/NUM_RECT_AREA_LIGHTS/g,O.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,O.numPointLights).replace(/NUM_HEMI_LIGHTS/g,O.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,O.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,O.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,O.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,O.numPointLightShadows)}function FC(E,O){return E.replace(/NUM_CLIPPING_PLANES/g,O.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,O.numClippingPlanes-O.numClipIntersection)}var _d=/^[ \t]*#include +<([\w\d./]+)>/gm;function xS(E){return E.replace(_d,$G)}function $G(E,O){let R=zc[O];if(R===void 0)throw new Error("Can not resolve #include <"+O+">");return xS(R)}var Md=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function VC(E){return E.replace(Md,t4)}function t4(E,O,R,z){let V="";for(let E=parseInt(O);E<parseInt(R);E++)V+=z.replace(/\[\s*i\s*\]/g,"[ "+E+" ]").replace(/UNROLLED_LOOP_INDEX/g,E);return V}function UC(E){let O="precision "+E.precision+" float;\nprecision "+E.precision+" int;";return E.precision==="highp"?O+="\n#define HIGH_PRECISION":E.precision==="mediump"?O+="\n#define MEDIUM_PRECISION":E.precision==="lowp"&&(O+="\n#define LOW_PRECISION"),O}function r4(E){let O="SHADOWMAP_TYPE_BASIC";return E.shadowMapType===Ce?O="SHADOWMAP_TYPE_PCF":E.shadowMapType===Te?O="SHADOWMAP_TYPE_PCF_SOFT":E.shadowMapType===Ie&&(O="SHADOWMAP_TYPE_VSM"),O}function i4(E){let O="ENVMAP_TYPE_CUBE";if(E.envMap)switch(E.envMapMode){case ii:case ri:O="ENVMAP_TYPE_CUBE";break;case ai:O="ENVMAP_TYPE_CUBE_UV";break}return O}function n4(E){let O="ENVMAP_MODE_REFLECTION";if(E.envMap)switch(E.envMapMode){case ri:O="ENVMAP_MODE_REFRACTION";break}return O}function s4(E){let O="ENVMAP_BLENDING_NONE";if(E.envMap)switch(E.combine){case Gt:O="ENVMAP_BLENDING_MULTIPLY";break;case Wt:O="ENVMAP_BLENDING_MIX";break;case qt:O="ENVMAP_BLENDING_ADD";break}return O}function o4(E){let O=E.envMapCubeUVHeight;if(O===null)return null;let R=Math.log2(O)-2,z=1/O;return{texelWidth:1/(3*Math.max(Math.pow(2,R),112)),texelHeight:z,maxMip:R}}function a4(E,O,R,z){let V,j,Y=E.getContext(),ee=R.defines,se=R.vertexShader,he=R.fragmentShader,ce=r4(R),ue=i4(R),fe=n4(R),ve=s4(R),we=o4(R),Se=R.isWebGL2?"":KG(R),_e=QG(ee),Ae=Y.createProgram(),Ce=R.glslVersion?"#version "+R.glslVersion+"\n":"";R.isRawShaderMaterial?(V=[_e].filter(cp).join("\n"),V.length>0&&(V+="\n"),j=[Se,_e].filter(cp).join("\n"),j.length>0&&(j+="\n")):(V=[UC(R),"#define SHADER_NAME "+R.shaderName,_e,R.instancing?"#define USE_INSTANCING":"",R.instancingColor?"#define USE_INSTANCING_COLOR":"",R.supportsVertexTextures?"#define VERTEX_TEXTURES":"",R.useFog&&R.fog?"#define USE_FOG":"",R.useFog&&R.fogExp2?"#define FOG_EXP2":"",R.map?"#define USE_MAP":"",R.envMap?"#define USE_ENVMAP":"",R.envMap?"#define "+fe:"",R.lightMap?"#define USE_LIGHTMAP":"",R.aoMap?"#define USE_AOMAP":"",R.emissiveMap?"#define USE_EMISSIVEMAP":"",R.bumpMap?"#define USE_BUMPMAP":"",R.normalMap?"#define USE_NORMALMAP":"",R.normalMap&&R.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",R.normalMap&&R.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",R.clearcoatMap?"#define USE_CLEARCOATMAP":"",R.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",R.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",R.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",R.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",R.displacementMap&&R.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",R.specularMap?"#define USE_SPECULARMAP":"",R.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",R.specularColorMap?"#define USE_SPECULARCOLORMAP":"",R.roughnessMap?"#define USE_ROUGHNESSMAP":"",R.metalnessMap?"#define USE_METALNESSMAP":"",R.alphaMap?"#define USE_ALPHAMAP":"",R.transmission?"#define USE_TRANSMISSION":"",R.transmissionMap?"#define USE_TRANSMISSIONMAP":"",R.thicknessMap?"#define USE_THICKNESSMAP":"",R.sheenColorMap?"#define USE_SHEENCOLORMAP":"",R.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",R.vertexTangents?"#define USE_TANGENT":"",R.vertexColors?"#define USE_COLOR":"",R.vertexAlphas?"#define USE_COLOR_ALPHA":"",R.vertexUvs?"#define USE_UV":"",R.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",R.flatShading?"#define FLAT_SHADED":"",R.skinning?"#define USE_SKINNING":"",R.morphTargets?"#define USE_MORPHTARGETS":"",R.morphNormals&&R.flatShading===!1?"#define USE_MORPHNORMALS":"",R.morphColors&&R.isWebGL2?"#define USE_MORPHCOLORS":"",R.morphTargetsCount>0&&R.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",R.morphTargetsCount>0&&R.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+R.morphTextureStride:"",R.morphTargetsCount>0&&R.isWebGL2?"#define MORPHTARGETS_COUNT "+R.morphTargetsCount:"",R.doubleSided?"#define DOUBLE_SIDED":"",R.flipSided?"#define FLIP_SIDED":"",R.shadowMapEnabled?"#define USE_SHADOWMAP":"",R.shadowMapEnabled?"#define "+ce:"",R.sizeAttenuation?"#define USE_SIZEATTENUATION":"",R.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",R.logarithmicDepthBuffer&&R.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(cp).join("\n"),j=[Se,UC(R),"#define SHADER_NAME "+R.shaderName,_e,R.useFog&&R.fog?"#define USE_FOG":"",R.useFog&&R.fogExp2?"#define FOG_EXP2":"",R.map?"#define USE_MAP":"",R.matcap?"#define USE_MATCAP":"",R.envMap?"#define USE_ENVMAP":"",R.envMap?"#define "+ue:"",R.envMap?"#define "+fe:"",R.envMap?"#define "+ve:"",we?"#define CUBEUV_TEXEL_WIDTH "+we.texelWidth:"",we?"#define CUBEUV_TEXEL_HEIGHT "+we.texelHeight:"",we?"#define CUBEUV_MAX_MIP "+we.maxMip+".0":"",R.lightMap?"#define USE_LIGHTMAP":"",R.aoMap?"#define USE_AOMAP":"",R.emissiveMap?"#define USE_EMISSIVEMAP":"",R.bumpMap?"#define USE_BUMPMAP":"",R.normalMap?"#define USE_NORMALMAP":"",R.normalMap&&R.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",R.normalMap&&R.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",R.clearcoat?"#define USE_CLEARCOAT":"",R.clearcoatMap?"#define USE_CLEARCOATMAP":"",R.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",R.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",R.iridescence?"#define USE_IRIDESCENCE":"",R.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",R.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",R.specularMap?"#define USE_SPECULARMAP":"",R.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",R.specularColorMap?"#define USE_SPECULARCOLORMAP":"",R.roughnessMap?"#define USE_ROUGHNESSMAP":"",R.metalnessMap?"#define USE_METALNESSMAP":"",R.alphaMap?"#define USE_ALPHAMAP":"",R.alphaTest?"#define USE_ALPHATEST":"",R.sheen?"#define USE_SHEEN":"",R.sheenColorMap?"#define USE_SHEENCOLORMAP":"",R.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",R.transmission?"#define USE_TRANSMISSION":"",R.transmissionMap?"#define USE_TRANSMISSIONMAP":"",R.thicknessMap?"#define USE_THICKNESSMAP":"",R.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",R.vertexTangents?"#define USE_TANGENT":"",R.vertexColors||R.instancingColor?"#define USE_COLOR":"",R.vertexAlphas?"#define USE_COLOR_ALPHA":"",R.vertexUvs?"#define USE_UV":"",R.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",R.gradientMap?"#define USE_GRADIENTMAP":"",R.flatShading?"#define FLAT_SHADED":"",R.doubleSided?"#define DOUBLE_SIDED":"",R.flipSided?"#define FLIP_SIDED":"",R.shadowMapEnabled?"#define USE_SHADOWMAP":"",R.shadowMapEnabled?"#define "+ce:"",R.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",R.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",R.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",R.logarithmicDepthBuffer&&R.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",R.toneMapping!==Xt?"#define TONE_MAPPING":"",R.toneMapping!==Xt?zc.tonemapping_pars_fragment:"",R.toneMapping!==Xt?YG("toneMapping",R.toneMapping):"",R.dithering?"#define DITHERING":"",R.opaque?"#define OPAQUE":"",zc.encodings_pars_fragment,XG("linearToOutputTexel",R.outputEncoding),R.useDepthPacking?"#define DEPTH_PACKING "+R.depthPacking:"","\n"].filter(cp).join("\n")),se=xS(se),se=NC(se,R),se=FC(se,R),he=xS(he),he=NC(he,R),he=FC(he,R),se=VC(se),he=VC(he),R.isWebGL2&&R.isRawShaderMaterial!==!0&&(Ce="#version 300 es\n",V=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+V,j=["#define varying in",R.glslVersion===cn?"":"layout(location = 0) out highp vec4 pc_fragColor;",R.glslVersion===cn?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+j);let Te=Ce+V+se,Ie=Ce+j+he,Fe=LC(Y,35633,Te),Ue=LC(Y,35632,Ie);if(Y.attachShader(Ae,Fe),Y.attachShader(Ae,Ue),R.index0AttributeName!==void 0?Y.bindAttribLocation(Ae,0,R.index0AttributeName):R.morphTargets===!0&&Y.bindAttribLocation(Ae,0,"position"),Y.linkProgram(Ae),E.debug.checkShaderErrors){let E=Y.getProgramInfoLog(Ae).trim(),O=Y.getShaderInfoLog(Fe).trim(),R=Y.getShaderInfoLog(Ue).trim(),z=!0,ee=!0;if(Y.getProgramParameter(Ae,35714)===!1){z=!1;let O=BC(Y,Fe,"vertex"),R=BC(Y,Ue,"fragment");console.error("THREE.WebGLProgram: Shader Error "+Y.getError()+" - VALIDATE_STATUS "+Y.getProgramParameter(Ae,35715)+"\n\nProgram Info Log: "+E+"\n"+O+"\n"+R)}else E!==""?console.warn("THREE.WebGLProgram: Program Info Log:",E):(O===""||R==="")&&(ee=!1);ee&&(this.diagnostics={runnable:z,programLog:E,vertexShader:{log:O,prefix:V},fragmentShader:{log:R,prefix:j}})}Y.deleteShader(Fe),Y.deleteShader(Ue);let Ge;this.getUniforms=function(){return Ge===void 0&&(Ge=new bd(Y,Ae)),Ge};let qe;return this.getAttributes=function(){return qe===void 0&&(qe=ZG(Y,Ae)),qe},this.destroy=function(){z.releaseStatesOfProgram(this),Y.deleteProgram(Ae),this.program=void 0},this.name=R.shaderName,this.id=wd++,this.cacheKey=O,this.usedTimes=1,this.program=Ae,this.vertexShader=Fe,this.fragmentShader=Ue,this}var Ed=0,Cd=class{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(E){let O=E.vertexShader,R=E.fragmentShader,z=this._getShaderStage(O),V=this._getShaderStage(R),j=this._getShaderCacheForMaterial(E);return j.has(z)===!1&&(j.add(z),z.usedTimes++),j.has(V)===!1&&(j.add(V),V.usedTimes++),this}remove(E){let O=this.materialCache.get(E);for(let E of O)E.usedTimes--,E.usedTimes===0&&this.shaderCache.delete(E.code);return this.materialCache.delete(E),this}getVertexShaderID(E){return this._getShaderStage(E.vertexShader).id}getFragmentShaderID(E){return this._getShaderStage(E.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(E){let O=this.materialCache,R=O.get(E);return R===void 0&&(R=new Set,O.set(E,R)),R}_getShaderStage(E){let O=this.shaderCache,R=O.get(E);return R===void 0&&(R=new Td(E),O.set(E,R)),R}},Td=class{constructor(E){this.id=Ed++,this.code=E,this.usedTimes=0}};function c4(E,O,R,z,V,j,Y){let ee=new Fs,se=new Cd,he=[],ce=V.isWebGL2,ue=V.logarithmicDepthBuffer,fe=V.vertexTextures,ve=V.precision,we={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function m(j,ee,he,Se,_e){let Ae=Se.fog,Ce=_e.geometry,Te=j.isMeshStandardMaterial?Se.environment:null,Ie=(j.isMeshStandardMaterial?R:O).get(j.envMap||Te),Fe=!Ie||Ie.mapping!==ai?null:Ie.image.height,qe=we[j.type];j.precision!==null&&(ve=V.getMaxPrecision(j.precision),ve!==j.precision&&console.warn("THREE.WebGLProgram.getParameters:",j.precision,"not supported, using",ve,"instead."));let Qe=Ce.morphAttributes.position||Ce.morphAttributes.normal||Ce.morphAttributes.color,Ze=Qe!==void 0?Qe.length:0,Ke=0;Ce.morphAttributes.position!==void 0&&(Ke=1),Ce.morphAttributes.normal!==void 0&&(Ke=2),Ce.morphAttributes.color!==void 0&&(Ke=3);let Je,$e,et,it;if(qe){let E=Nc[qe];Je=E.vertexShader,$e=E.fragmentShader}else Je=j.vertexShader,$e=j.fragmentShader,se.update(j),et=se.getVertexShaderID(j),it=se.getFragmentShaderID(j);let rt=E.getRenderTarget(),at=j.alphaTest>0,lt=j.clearcoat>0,ct=j.iridescence>0;return{isWebGL2:ce,shaderID:qe,shaderName:j.type,vertexShader:Je,fragmentShader:$e,defines:j.defines,customVertexShaderID:et,customFragmentShaderID:it,isRawShaderMaterial:j.isRawShaderMaterial===!0,glslVersion:j.glslVersion,precision:ve,instancing:_e.isInstancedMesh===!0,instancingColor:_e.isInstancedMesh===!0&&_e.instanceColor!==null,supportsVertexTextures:fe,outputEncoding:rt===null?E.outputEncoding:rt.isXRRenderTarget===!0?rt.texture.encoding:Xr,map:!!j.map,matcap:!!j.matcap,envMap:!!Ie,envMapMode:Ie&&Ie.mapping,envMapCubeUVHeight:Fe,lightMap:!!j.lightMap,aoMap:!!j.aoMap,emissiveMap:!!j.emissiveMap,bumpMap:!!j.bumpMap,normalMap:!!j.normalMap,objectSpaceNormalMap:j.normalMapType===en,tangentSpaceNormalMap:j.normalMapType===Jr,decodeVideoTexture:!!j.map&&j.map.isVideoTexture===!0&&j.map.encoding===Yr,clearcoat:lt,clearcoatMap:lt&&!!j.clearcoatMap,clearcoatRoughnessMap:lt&&!!j.clearcoatRoughnessMap,clearcoatNormalMap:lt&&!!j.clearcoatNormalMap,iridescence:ct,iridescenceMap:ct&&!!j.iridescenceMap,iridescenceThicknessMap:ct&&!!j.iridescenceThicknessMap,displacementMap:!!j.displacementMap,roughnessMap:!!j.roughnessMap,metalnessMap:!!j.metalnessMap,specularMap:!!j.specularMap,specularIntensityMap:!!j.specularIntensityMap,specularColorMap:!!j.specularColorMap,opaque:j.transparent===!1&&j.blending===Xe,alphaMap:!!j.alphaMap,alphaTest:at,gradientMap:!!j.gradientMap,sheen:j.sheen>0,sheenColorMap:!!j.sheenColorMap,sheenRoughnessMap:!!j.sheenRoughnessMap,transmission:j.transmission>0,transmissionMap:!!j.transmissionMap,thicknessMap:!!j.thicknessMap,combine:j.combine,vertexTangents:!!j.normalMap&&!!Ce.attributes.tangent,vertexColors:j.vertexColors,vertexAlphas:j.vertexColors===!0&&!!Ce.attributes.color&&Ce.attributes.color.itemSize===4,vertexUvs:!!j.map||!!j.bumpMap||!!j.normalMap||!!j.specularMap||!!j.alphaMap||!!j.emissiveMap||!!j.roughnessMap||!!j.metalnessMap||!!j.clearcoatMap||!!j.clearcoatRoughnessMap||!!j.clearcoatNormalMap||!!j.iridescenceMap||!!j.iridescenceThicknessMap||!!j.displacementMap||!!j.transmissionMap||!!j.thicknessMap||!!j.specularIntensityMap||!!j.specularColorMap||!!j.sheenColorMap||!!j.sheenRoughnessMap,uvsVertexOnly:!(!!j.map||!!j.bumpMap||!!j.normalMap||!!j.specularMap||!!j.alphaMap||!!j.emissiveMap||!!j.roughnessMap||!!j.metalnessMap||!!j.clearcoatNormalMap||!!j.iridescenceMap||!!j.iridescenceThicknessMap||j.transmission>0||!!j.transmissionMap||!!j.thicknessMap||!!j.specularIntensityMap||!!j.specularColorMap||j.sheen>0||!!j.sheenColorMap||!!j.sheenRoughnessMap)&&!!j.displacementMap,fog:!!Ae,useFog:j.fog===!0,fogExp2:Ae&&Ae.isFogExp2,flatShading:!!j.flatShading,sizeAttenuation:j.sizeAttenuation,logarithmicDepthBuffer:ue,skinning:_e.isSkinnedMesh===!0,morphTargets:Ce.morphAttributes.position!==void 0,morphNormals:Ce.morphAttributes.normal!==void 0,morphColors:Ce.morphAttributes.color!==void 0,morphTargetsCount:Ze,morphTextureStride:Ke,numDirLights:ee.directional.length,numPointLights:ee.point.length,numSpotLights:ee.spot.length,numSpotLightMaps:ee.spotLightMap.length,numRectAreaLights:ee.rectArea.length,numHemiLights:ee.hemi.length,numDirLightShadows:ee.directionalShadowMap.length,numPointLightShadows:ee.pointShadowMap.length,numSpotLightShadows:ee.spotShadowMap.length,numSpotLightShadowsWithMaps:ee.numSpotLightShadowsWithMaps,numClippingPlanes:Y.numPlanes,numClipIntersection:Y.numIntersection,dithering:j.dithering,shadowMapEnabled:E.shadowMap.enabled&&he.length>0,shadowMapType:E.shadowMap.type,toneMapping:j.toneMapped?E.toneMapping:Xt,physicallyCorrectLights:E.physicallyCorrectLights,premultipliedAlpha:j.premultipliedAlpha,doubleSided:j.side===Ge,flipSided:j.side===Ue,useDepthPacking:!!j.depthPacking,depthPacking:j.depthPacking||0,index0AttributeName:j.index0AttributeName,extensionDerivatives:j.extensions&&j.extensions.derivatives,extensionFragDepth:j.extensions&&j.extensions.fragDepth,extensionDrawBuffers:j.extensions&&j.extensions.drawBuffers,extensionShaderTextureLOD:j.extensions&&j.extensions.shaderTextureLOD,rendererExtensionFragDepth:ce||z.has("EXT_frag_depth"),rendererExtensionDrawBuffers:ce||z.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:ce||z.has("EXT_shader_texture_lod"),customProgramCacheKey:j.customProgramCacheKey()}}function g(O){let R=[];if(O.shaderID?R.push(O.shaderID):(R.push(O.customVertexShaderID),R.push(O.customFragmentShaderID)),O.defines!==void 0)for(let E in O.defines)R.push(E),R.push(O.defines[E]);return O.isRawShaderMaterial===!1&&(y(R,O),x(R,O),R.push(E.outputEncoding)),R.push(O.customProgramCacheKey),R.join()}function y(E,O){E.push(O.precision),E.push(O.outputEncoding),E.push(O.envMapMode),E.push(O.envMapCubeUVHeight),E.push(O.combine),E.push(O.vertexUvs),E.push(O.fogExp2),E.push(O.sizeAttenuation),E.push(O.morphTargetsCount),E.push(O.morphAttributeCount),E.push(O.numDirLights),E.push(O.numPointLights),E.push(O.numSpotLights),E.push(O.numSpotLightMaps),E.push(O.numHemiLights),E.push(O.numRectAreaLights),E.push(O.numDirLightShadows),E.push(O.numPointLightShadows),E.push(O.numSpotLightShadows),E.push(O.numSpotLightShadowsWithMaps),E.push(O.shadowMapType),E.push(O.toneMapping),E.push(O.numClippingPlanes),E.push(O.numClipIntersection),E.push(O.depthPacking)}function x(E,O){ee.disableAll(),O.isWebGL2&&ee.enable(0),O.supportsVertexTextures&&ee.enable(1),O.instancing&&ee.enable(2),O.instancingColor&&ee.enable(3),O.map&&ee.enable(4),O.matcap&&ee.enable(5),O.envMap&&ee.enable(6),O.lightMap&&ee.enable(7),O.aoMap&&ee.enable(8),O.emissiveMap&&ee.enable(9),O.bumpMap&&ee.enable(10),O.normalMap&&ee.enable(11),O.objectSpaceNormalMap&&ee.enable(12),O.tangentSpaceNormalMap&&ee.enable(13),O.clearcoat&&ee.enable(14),O.clearcoatMap&&ee.enable(15),O.clearcoatRoughnessMap&&ee.enable(16),O.clearcoatNormalMap&&ee.enable(17),O.iridescence&&ee.enable(18),O.iridescenceMap&&ee.enable(19),O.iridescenceThicknessMap&&ee.enable(20),O.displacementMap&&ee.enable(21),O.specularMap&&ee.enable(22),O.roughnessMap&&ee.enable(23),O.metalnessMap&&ee.enable(24),O.gradientMap&&ee.enable(25),O.alphaMap&&ee.enable(26),O.alphaTest&&ee.enable(27),O.vertexColors&&ee.enable(28),O.vertexAlphas&&ee.enable(29),O.vertexUvs&&ee.enable(30),O.vertexTangents&&ee.enable(31),O.uvsVertexOnly&&ee.enable(32),E.push(ee.mask),ee.disableAll(),O.fog&&ee.enable(0),O.useFog&&ee.enable(1),O.flatShading&&ee.enable(2),O.logarithmicDepthBuffer&&ee.enable(3),O.skinning&&ee.enable(4),O.morphTargets&&ee.enable(5),O.morphNormals&&ee.enable(6),O.morphColors&&ee.enable(7),O.premultipliedAlpha&&ee.enable(8),O.shadowMapEnabled&&ee.enable(9),O.physicallyCorrectLights&&ee.enable(10),O.doubleSided&&ee.enable(11),O.flipSided&&ee.enable(12),O.useDepthPacking&&ee.enable(13),O.dithering&&ee.enable(14),O.specularIntensityMap&&ee.enable(15),O.specularColorMap&&ee.enable(16),O.transmission&&ee.enable(17),O.transmissionMap&&ee.enable(18),O.thicknessMap&&ee.enable(19),O.sheen&&ee.enable(20),O.sheenColorMap&&ee.enable(21),O.sheenRoughnessMap&&ee.enable(22),O.decodeVideoTexture&&ee.enable(23),O.opaque&&ee.enable(24),E.push(ee.mask)}function v(E){let O,R=we[E.type];if(R){let E=Nc[R];O=ro.clone(E.uniforms)}else O=E.uniforms;return O}function S(O,R){let z;for(let E=0,O=he.length;E<O;E++){let O=he[E];if(O.cacheKey===R){z=O,++z.usedTimes;break}}return z===void 0&&(z=new a4(E,R,O,j),he.push(z)),z}function w(E){if(--E.usedTimes===0){let O=he.indexOf(E);he[O]=he[he.length-1],he.pop(),E.destroy()}}function A(E){se.remove(E)}function T(){se.dispose()}return{getParameters:m,getProgramCacheKey:g,getUniforms:v,acquireProgram:S,releaseProgram:w,releaseShaderCache:A,programs:he,dispose:T}}function u4(){let E=new WeakMap;function t(O){let R=E.get(O);return R===void 0&&(R={},E.set(O,R)),R}function e(O){E.delete(O)}function r(O,R,z){E.get(O)[R]=z}function i(){E=new WeakMap}return{get:t,remove:e,update:r,dispose:i}}function h4(E,O){return E.groupOrder!==O.groupOrder?E.groupOrder-O.groupOrder:E.renderOrder!==O.renderOrder?E.renderOrder-O.renderOrder:E.material.id!==O.material.id?E.material.id-O.material.id:E.z!==O.z?E.z-O.z:E.id-O.id}function zC(E,O){return E.groupOrder!==O.groupOrder?E.groupOrder-O.groupOrder:E.renderOrder!==O.renderOrder?E.renderOrder-O.renderOrder:E.z!==O.z?O.z-E.z:E.id-O.id}function kC(){let E=[],O=0,R=[],z=[],V=[];function s(){O=0,R.length=0,z.length=0,V.length=0}function o(R,z,V,j,Y,ee){let se=E[O];return se===void 0?(se={id:R.id,object:R,geometry:z,material:V,groupOrder:j,renderOrder:R.renderOrder,z:Y,group:ee},E[O]=se):(se.id=R.id,se.object=R,se.geometry=z,se.material=V,se.groupOrder=j,se.renderOrder=R.renderOrder,se.z=Y,se.group=ee),O++,se}function a(E,O,j,Y,ee,se){let he=o(E,O,j,Y,ee,se);j.transmission>0?z.push(he):j.transparent===!0?V.push(he):R.push(he)}function l(E,O,j,Y,ee,se){let he=o(E,O,j,Y,ee,se);j.transmission>0?z.unshift(he):j.transparent===!0?V.unshift(he):R.unshift(he)}function c(E,O){R.length>1&&R.sort(E||h4),z.length>1&&z.sort(O||zC),V.length>1&&V.sort(O||zC)}function u(){for(let R=O,z=E.length;R<z;R++){let O=E[R];if(O.id===null)break;O.id=null,O.object=null,O.geometry=null,O.material=null,O.group=null}}return{opaque:R,transmissive:z,transparent:V,init:s,push:a,unshift:l,finish:u,sort:c}}function d4(){let E=new WeakMap;function t(O,R){let z,V=E.get(O);return V===void 0?(z=new kC,E.set(O,[z])):R>=V.length?(z=new kC,V.push(z)):z=V[R],z}function e(){E=new WeakMap}return{get:t,dispose:e}}function f4(){let E={};return{get:function(O){if(E[O.id]!==void 0)return E[O.id];let R;switch(O.type){case"DirectionalLight":R={direction:new Wn,color:new On};break;case"SpotLight":R={position:new Wn,direction:new Wn,color:new On,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":R={position:new Wn,color:new On,distance:0,decay:0};break;case"HemisphereLight":R={direction:new Wn,skyColor:new On,groundColor:new On};break;case"RectAreaLight":R={color:new On,position:new Wn,halfWidth:new Wn,halfHeight:new Wn};break}return E[O.id]=R,R}}}function p4(){let E={};return{get:function(O){if(E[O.id]!==void 0)return E[O.id];let R;switch(O.type){case"DirectionalLight":R={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new bn};break;case"SpotLight":R={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new bn};break;case"PointLight":R={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new bn,shadowCameraNear:1,shadowCameraFar:1e3};break}return E[O.id]=R,R}}}var Pd=0;function g4(E,O){return(O.castShadow?2:0)-(E.castShadow?2:0)+(O.map?1:0)-(E.map?1:0)}function y4(E,O){let R=new f4,z=p4(),V={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0};for(let E=0;E<9;E++)V.probe.push(new Wn);let j=new Wn,Y=new Es,ee=new Es;function l(j,Y){let ee=0,se=0,he=0;for(let E=0;E<9;E++)V.probe[E].set(0,0,0);let ce=0,ue=0,fe=0,ve=0,we=0,Se=0,_e=0,Ae=0,Ce=0,Te=0;j.sort(g4);let Ie=Y!==!0?Math.PI:1;for(let E=0,O=j.length;E<O;E++){let O=j[E],Y=O.color,Fe=O.intensity,Ue=O.distance,Ge=O.shadow&&O.shadow.map?O.shadow.map.texture:null;if(O.isAmbientLight)ee+=Y.r*Fe*Ie,se+=Y.g*Fe*Ie,he+=Y.b*Fe*Ie;else if(O.isLightProbe)for(let E=0;E<9;E++)V.probe[E].addScaledVector(O.sh.coefficients[E],Fe);else if(O.isDirectionalLight){let E=R.get(O);if(E.color.copy(O.color).multiplyScalar(O.intensity*Ie),O.castShadow){let E=O.shadow,R=z.get(O);R.shadowBias=E.bias,R.shadowNormalBias=E.normalBias,R.shadowRadius=E.radius,R.shadowMapSize=E.mapSize,V.directionalShadow[ce]=R,V.directionalShadowMap[ce]=Ge,V.directionalShadowMatrix[ce]=O.shadow.matrix,Se++}V.directional[ce]=E,ce++}else if(O.isSpotLight){let E=R.get(O);E.position.setFromMatrixPosition(O.matrixWorld),E.color.copy(Y).multiplyScalar(Fe*Ie),E.distance=Ue,E.coneCos=Math.cos(O.angle),E.penumbraCos=Math.cos(O.angle*(1-O.penumbra)),E.decay=O.decay,V.spot[fe]=E;let j=O.shadow;if(O.map&&(V.spotLightMap[Ce]=O.map,Ce++,j.updateMatrices(O),O.castShadow&&Te++),V.spotLightMatrix[fe]=j.matrix,O.castShadow){let E=z.get(O);E.shadowBias=j.bias,E.shadowNormalBias=j.normalBias,E.shadowRadius=j.radius,E.shadowMapSize=j.mapSize,V.spotShadow[fe]=E,V.spotShadowMap[fe]=Ge,Ae++}fe++}else if(O.isRectAreaLight){let E=R.get(O);E.color.copy(Y).multiplyScalar(Fe),E.halfWidth.set(O.width*.5,0,0),E.halfHeight.set(0,O.height*.5,0),V.rectArea[ve]=E,ve++}else if(O.isPointLight){let E=R.get(O);if(E.color.copy(O.color).multiplyScalar(O.intensity*Ie),E.distance=O.distance,E.decay=O.decay,O.castShadow){let E=O.shadow,R=z.get(O);R.shadowBias=E.bias,R.shadowNormalBias=E.normalBias,R.shadowRadius=E.radius,R.shadowMapSize=E.mapSize,R.shadowCameraNear=E.camera.near,R.shadowCameraFar=E.camera.far,V.pointShadow[ue]=R,V.pointShadowMap[ue]=Ge,V.pointShadowMatrix[ue]=O.shadow.matrix,_e++}V.point[ue]=E,ue++}else if(O.isHemisphereLight){let E=R.get(O);E.skyColor.copy(O.color).multiplyScalar(Fe*Ie),E.groundColor.copy(O.groundColor).multiplyScalar(Fe*Ie),V.hemi[we]=E,we++}}ve>0&&(O.isWebGL2||E.has("OES_texture_float_linear")===!0?(V.rectAreaLTC1=Fc.LTC_FLOAT_1,V.rectAreaLTC2=Fc.LTC_FLOAT_2):E.has("OES_texture_half_float_linear")===!0?(V.rectAreaLTC1=Fc.LTC_HALF_1,V.rectAreaLTC2=Fc.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),V.ambient[0]=ee,V.ambient[1]=se,V.ambient[2]=he;let Fe=V.hash;(Fe.directionalLength!==ce||Fe.pointLength!==ue||Fe.spotLength!==fe||Fe.rectAreaLength!==ve||Fe.hemiLength!==we||Fe.numDirectionalShadows!==Se||Fe.numPointShadows!==_e||Fe.numSpotShadows!==Ae||Fe.numSpotMaps!==Ce)&&(V.directional.length=ce,V.spot.length=fe,V.rectArea.length=ve,V.point.length=ue,V.hemi.length=we,V.directionalShadow.length=Se,V.directionalShadowMap.length=Se,V.pointShadow.length=_e,V.pointShadowMap.length=_e,V.spotShadow.length=Ae,V.spotShadowMap.length=Ae,V.directionalShadowMatrix.length=Se,V.pointShadowMatrix.length=_e,V.spotLightMatrix.length=Ae+Ce-Te,V.spotLightMap.length=Ce,V.numSpotLightShadowsWithMaps=Te,Fe.directionalLength=ce,Fe.pointLength=ue,Fe.spotLength=fe,Fe.rectAreaLength=ve,Fe.hemiLength=we,Fe.numDirectionalShadows=Se,Fe.numPointShadows=_e,Fe.numSpotShadows=Ae,Fe.numSpotMaps=Ce,V.version=Pd++)}function c(E,O){let R=0,z=0,se=0,he=0,ce=0,ue=O.matrixWorldInverse;for(let O=0,fe=E.length;O<fe;O++){let fe=E[O];if(fe.isDirectionalLight){let E=V.directional[R];E.direction.setFromMatrixPosition(fe.matrixWorld),j.setFromMatrixPosition(fe.target.matrixWorld),E.direction.sub(j),E.direction.transformDirection(ue),R++}else if(fe.isSpotLight){let E=V.spot[se];E.position.setFromMatrixPosition(fe.matrixWorld),E.position.applyMatrix4(ue),E.direction.setFromMatrixPosition(fe.matrixWorld),j.setFromMatrixPosition(fe.target.matrixWorld),E.direction.sub(j),E.direction.transformDirection(ue),se++}else if(fe.isRectAreaLight){let E=V.rectArea[he];E.position.setFromMatrixPosition(fe.matrixWorld),E.position.applyMatrix4(ue),ee.identity(),Y.copy(fe.matrixWorld),Y.premultiply(ue),ee.extractRotation(Y),E.halfWidth.set(fe.width*.5,0,0),E.halfHeight.set(0,fe.height*.5,0),E.halfWidth.applyMatrix4(ee),E.halfHeight.applyMatrix4(ee),he++}else if(fe.isPointLight){let E=V.point[z];E.position.setFromMatrixPosition(fe.matrixWorld),E.position.applyMatrix4(ue),z++}else if(fe.isHemisphereLight){let E=V.hemi[ce];E.direction.setFromMatrixPosition(fe.matrixWorld),E.direction.transformDirection(ue),ce++}}}return{setup:l,setupView:c,state:V}}function GC(E,O){let R=new y4(E,O),z=[],V=[];function s(){z.length=0,V.length=0}function o(E){z.push(E)}function a(E){V.push(E)}function l(E){R.setup(z,E)}function c(E){R.setupView(z,E)}return{init:s,state:{lightsArray:z,shadowsArray:V,lights:R},setupLights:l,setupLightsView:c,pushLight:o,pushShadow:a}}function v4(E,O){let R=new WeakMap;function r(z,V=0){let j,Y=R.get(z);return Y===void 0?(j=new GC(E,O),R.set(z,[j])):V>=Y.length?(j=new GC(E,O),Y.push(j)):j=Y[V],j}function i(){R=new WeakMap}return{get:r,dispose:i}}var Dd=class extends ya{constructor(E){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=Qr,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(E)}copy(E){return super.copy(E),this.depthPacking=E.depthPacking,this.map=E.map,this.alphaMap=E.alphaMap,this.displacementMap=E.displacementMap,this.displacementScale=E.displacementScale,this.displacementBias=E.displacementBias,this.wireframe=E.wireframe,this.wireframeLinewidth=E.wireframeLinewidth,this}},Od=class extends ya{constructor(E){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.referencePosition=new Wn,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(E)}copy(E){return super.copy(E),this.referencePosition.copy(E.referencePosition),this.nearDistance=E.nearDistance,this.farDistance=E.farDistance,this.map=E.map,this.alphaMap=E.alphaMap,this.displacementMap=E.displacementMap,this.displacementScale=E.displacementScale,this.displacementBias=E.displacementBias,this}},Ld="void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",Bd="uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}";function S4(E,O,R){let z=new Eo,V=new bn,j=new bn,Y=new Nn,ee=new Dd({depthPacking:Kr}),se=new Od,he={},ce=R.maxTextureSize,ue={[Fe]:Ue,[Ue]:Fe,[Ge]:Ge},fe=new lo({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new bn},radius:{value:4}},vertexShader:Ld,fragmentShader:Bd}),ve=fe.clone();ve.defines.HORIZONTAL_PASS=1;let we=new Na;we.setAttribute("position",new Sa(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));let Se=new eo(we,fe),_e=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=Ce,this.render=function(O,R,ee){if(_e.enabled===!1||_e.autoUpdate===!1&&_e.needsUpdate===!1||O.length===0)return;let se=E.getRenderTarget(),he=E.getActiveCubeFace(),ue=E.getActiveMipmapLevel(),fe=E.state;fe.setBlending(qe),fe.buffers.color.setClear(1,1,1,1),fe.buffers.depth.setTest(!0),fe.setScissorTest(!1);for(let se=0,he=O.length;se<he;se++){let he=O[se],ue=he.shadow;if(ue===void 0){console.warn("THREE.WebGLShadowMap:",he,"has no shadow.");continue}if(ue.autoUpdate===!1&&ue.needsUpdate===!1)continue;V.copy(ue.mapSize);let ve=ue.getFrameExtents();if(V.multiply(ve),j.copy(ue.mapSize),(V.x>ce||V.y>ce)&&(V.x>ce&&(j.x=Math.floor(ce/ve.x),V.x=j.x*ve.x,ue.mapSize.x=j.x),V.y>ce&&(j.y=Math.floor(ce/ve.y),V.y=j.y*ve.y,ue.mapSize.y=j.y)),ue.map===null){let E=this.type!==Ie?{minFilter:mi,magFilter:mi}:{};ue.map=new Un(V.x,V.y,E),ue.map.texture.name=he.name+".shadowMap",ue.camera.updateProjectionMatrix()}E.setRenderTarget(ue.map),E.clear();let we=ue.getViewportCount();for(let E=0;E<we;E++){let O=ue.getViewport(E);Y.set(j.x*O.x,j.y*O.y,j.x*O.z,j.y*O.w),fe.viewport(Y),ue.updateMatrices(he,E),z=ue.getFrustum(),v(R,ee,ue.camera,he,this.type)}ue.isPointLightShadow!==!0&&this.type===Ie&&y(ue,ee),ue.needsUpdate=!1}_e.needsUpdate=!1,E.setRenderTarget(se,he,ue)};function y(R,z){let j=O.update(Se);fe.defines.VSM_SAMPLES!==R.blurSamples&&(fe.defines.VSM_SAMPLES=R.blurSamples,ve.defines.VSM_SAMPLES=R.blurSamples,fe.needsUpdate=!0,ve.needsUpdate=!0),R.mapPass===null&&(R.mapPass=new Un(V.x,V.y)),fe.uniforms.shadow_pass.value=R.map.texture,fe.uniforms.resolution.value=R.mapSize,fe.uniforms.radius.value=R.radius,E.setRenderTarget(R.mapPass),E.clear(),E.renderBufferDirect(z,null,j,fe,Se,null),ve.uniforms.shadow_pass.value=R.mapPass.texture,ve.uniforms.resolution.value=R.mapSize,ve.uniforms.radius.value=R.radius,E.setRenderTarget(R.map),E.clear(),E.renderBufferDirect(z,null,j,ve,Se,null)}function x(O,R,z,V,j,Y){let ce=null,fe=z.isPointLight===!0?O.customDistanceMaterial:O.customDepthMaterial;if(fe!==void 0)ce=fe;else if(ce=z.isPointLight===!0?se:ee,E.localClippingEnabled&&R.clipShadows===!0&&Array.isArray(R.clippingPlanes)&&R.clippingPlanes.length!==0||R.displacementMap&&R.displacementScale!==0||R.alphaMap&&R.alphaTest>0||R.map&&R.alphaTest>0){let E=ce.uuid,O=R.uuid,z=he[E];z===void 0&&(z={},he[E]=z);let V=z[O];V===void 0&&(V=ce.clone(),z[O]=V),ce=V}return ce.visible=R.visible,ce.wireframe=R.wireframe,ce.side=Y===Ie?R.shadowSide!==null?R.shadowSide:R.side:R.shadowSide!==null?R.shadowSide:ue[R.side],ce.alphaMap=R.alphaMap,ce.alphaTest=R.alphaTest,ce.map=R.map,ce.clipShadows=R.clipShadows,ce.clippingPlanes=R.clippingPlanes,ce.clipIntersection=R.clipIntersection,ce.displacementMap=R.displacementMap,ce.displacementScale=R.displacementScale,ce.displacementBias=R.displacementBias,ce.wireframeLinewidth=R.wireframeLinewidth,ce.linewidth=R.linewidth,z.isPointLight===!0&&ce.isMeshDistanceMaterial===!0&&(ce.referencePosition.setFromMatrixPosition(z.matrixWorld),ce.nearDistance=V,ce.farDistance=j),ce}function v(R,V,j,Y,ee){if(R.visible===!1)return;if(R.layers.test(V.layers)&&(R.isMesh||R.isLine||R.isPoints)&&(R.castShadow||R.receiveShadow&&ee===Ie)&&(!R.frustumCulled||z.intersectsObject(R))){R.modelViewMatrix.multiplyMatrices(j.matrixWorldInverse,R.matrixWorld);let z=O.update(R),V=R.material;if(Array.isArray(V)){let O=z.groups;for(let se=0,he=O.length;se<he;se++){let he=O[se],ce=V[he.materialIndex];if(ce&&ce.visible){let O=x(R,ce,Y,j.near,j.far,ee);E.renderBufferDirect(j,null,z,O,R,he)}}}else if(V.visible){let O=x(R,V,Y,j.near,j.far,ee);E.renderBufferDirect(j,null,z,O,R,null)}}let se=R.children;for(let E=0,O=se.length;E<O;E++)v(se[E],V,j,Y,ee)}}function w4(E,O,R){let z=R.isWebGL2;function i(){let O=!1,R=new Nn,z=null,V=new Nn(0,0,0,0);return{setMask:function(R){z!==R&&!O&&(E.colorMask(R,R,R,R),z=R)},setLocked:function(E){O=E},setClear:function(O,z,j,Y,ee){ee===!0&&(O*=Y,z*=Y,j*=Y),R.set(O,z,j,Y),V.equals(R)===!1&&(E.clearColor(O,z,j,Y),V.copy(R))},reset:function(){O=!1,z=null,V.set(-1,0,0,0)}}}function s(){let O=!1,R=null,z=null,V=null;return{setTest:function(E){E?oe(2929):ie(2929)},setMask:function(z){R!==z&&!O&&(E.depthMask(z),R=z)},setFunc:function(O){if(z!==O){switch(O){case Et:E.depthFunc(512);break;case Tt:E.depthFunc(519);break;case It:E.depthFunc(513);break;case Lt:E.depthFunc(515);break;case Bt:E.depthFunc(514);break;case Ft:E.depthFunc(518);break;case Ut:E.depthFunc(516);break;case jt:E.depthFunc(517);break;default:E.depthFunc(515)}z=O}},setLocked:function(E){O=E},setClear:function(O){V!==O&&(E.clearDepth(O),V=O)},reset:function(){O=!1,R=null,z=null,V=null}}}function o(){let O=!1,R=null,z=null,V=null,j=null,Y=null,ee=null,se=null,he=null;return{setTest:function(E){O||(E?oe(2960):ie(2960))},setMask:function(z){R!==z&&!O&&(E.stencilMask(z),R=z)},setFunc:function(O,R,Y){(z!==O||V!==R||j!==Y)&&(E.stencilFunc(O,R,Y),z=O,V=R,j=Y)},setOp:function(O,R,z){(Y!==O||ee!==R||se!==z)&&(E.stencilOp(O,R,z),Y=O,ee=R,se=z)},setLocked:function(E){O=E},setClear:function(O){he!==O&&(E.clearStencil(O),he=O)},reset:function(){O=!1,R=null,z=null,V=null,j=null,Y=null,ee=null,se=null,he=null}}}let V=new i,j=new s,Y=new o,ee=new WeakMap,se=new WeakMap,he={},ce={},ue=new WeakMap,fe=[],ve=null,we=!1,Ce=null,Te=null,Ie=null,Fe=null,Gt=null,Wt=null,qt=null,Xt=!1,Qt=null,Zt=null,Kt=null,Jt=null,$t=null,ti=E.getParameter(35661),ii=!1,ri=0,ni=E.getParameter(7938);ni.indexOf("WebGL")!==-1?(ri=parseFloat(/^WebGL (\d)/.exec(ni)[1]),ii=ri>=1):ni.indexOf("OpenGL ES")!==-1&&(ri=parseFloat(/^OpenGL ES (\d)/.exec(ni)[1]),ii=ri>=2);let si=null,ai={},oi=E.getParameter(3088),ui=E.getParameter(2978),fi=(new Nn).fromArray(oi),mi=(new Nn).fromArray(ui);function $(O,R,z){let V=new Uint8Array(4),j=E.createTexture();E.bindTexture(O,j),E.texParameteri(O,10241,9728),E.texParameteri(O,10240,9728);for(let O=0;O<z;O++)E.texImage2D(R+O,0,6408,1,1,0,6408,5121,V);return j}let gi={};gi[3553]=$(3553,3553,1),gi[34067]=$(34067,34069,6),V.setClear(0,0,0,1),j.setClear(1),Y.setClear(0),oe(2929),j.setFunc(Lt),ke(!1),ze(_e),oe(2884),De(qe);function oe(O){he[O]!==!0&&(E.enable(O),he[O]=!0)}function ie(O){he[O]!==!1&&(E.disable(O),he[O]=!1)}function re(O,R){return ce[O]!==R&&(E.bindFramebuffer(O,R),ce[O]=R,z&&(O===36009&&(ce[36160]=R),O===36160&&(ce[36009]=R)),!0)}function Q(z,V){let j=fe,Y=!1;if(z)if(j=ue.get(V),j===void 0&&(j=[],ue.set(V,j)),z.isWebGLMultipleRenderTargets){let E=z.texture;if(j.length!==E.length||j[0]!==36064){for(let O=0,R=E.length;O<R;O++)j[O]=36064+O;j.length=E.length,Y=!0}}else j[0]!==36064&&(j[0]=36064,Y=!0);else j[0]!==1029&&(j[0]=1029,Y=!0);Y&&(R.isWebGL2?E.drawBuffers(j):O.get("WEBGL_draw_buffers").drawBuffersWEBGL(j))}function Ee(O){return ve!==O&&(E.useProgram(O),ve=O,!0)}let vi={[$e]:32774,[et]:32778,[it]:32779};if(z)vi[rt]=32775,vi[at]=32776;else{let E=O.get("EXT_blend_minmax");E!==null&&(vi[rt]=E.MIN_EXT,vi[at]=E.MAX_EXT)}let yi={[lt]:0,[ct]:1,[dt]:768,[pt]:770,[Mt]:776,[St]:774,[gt]:772,[ut]:769,[mt]:771,[_t]:775,[yt]:773};function De(O,R,z,V,j,Y,ee,se){if(O!==qe){if(we===!1&&(oe(3042),we=!0),O===Je)j=j||R,Y=Y||z,ee=ee||V,(R!==Te||j!==Gt)&&(E.blendEquationSeparate(vi[R],vi[j]),Te=R,Gt=j),(z!==Ie||V!==Fe||Y!==Wt||ee!==qt)&&(E.blendFuncSeparate(yi[z],yi[V],yi[Y],yi[ee]),Ie=z,Fe=V,Wt=Y,qt=ee),Ce=O,Xt=!1;else if(O!==Ce||se!==Xt){if((Te!==$e||Gt!==$e)&&(E.blendEquation(32774),Te=$e,Gt=$e),se)switch(O){case Xe:E.blendFuncSeparate(1,771,1,771);break;case Qe:E.blendFunc(1,1);break;case Ze:E.blendFuncSeparate(0,769,0,1);break;case Ke:E.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",O);break}else switch(O){case Xe:E.blendFuncSeparate(770,771,1,771);break;case Qe:E.blendFunc(770,1);break;case Ze:E.blendFuncSeparate(0,769,0,1);break;case Ke:E.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",O);break}Ie=null,Fe=null,Wt=null,qt=null,Ce=O,Xt=se}}else we===!0&&(ie(3042),we=!1)}function Pe(E,O){E.side===Ge?ie(2884):oe(2884);let R=E.side===Ue;O&&(R=!R),ke(R),E.blending===Xe&&E.transparent===!1?De(qe):De(E.blending,E.blendEquation,E.blendSrc,E.blendDst,E.blendEquationAlpha,E.blendSrcAlpha,E.blendDstAlpha,E.premultipliedAlpha),j.setFunc(E.depthFunc),j.setTest(E.depthTest),j.setMask(E.depthWrite),V.setMask(E.colorWrite);let z=E.stencilWrite;Y.setTest(z),z&&(Y.setMask(E.stencilWriteMask),Y.setFunc(E.stencilFunc,E.stencilRef,E.stencilFuncMask),Y.setOp(E.stencilFail,E.stencilZFail,E.stencilZPass)),Re(E.polygonOffset,E.polygonOffsetFactor,E.polygonOffsetUnits),E.alphaToCoverage===!0?oe(32926):ie(32926)}function ke(O){Qt!==O&&(O?E.frontFace(2304):E.frontFace(2305),Qt=O)}function ze(O){O!==Se?(oe(2884),O!==Zt&&(O===_e?E.cullFace(1029):O===Ae?E.cullFace(1028):E.cullFace(1032))):ie(2884),Zt=O}function Ve(O){O!==Kt&&(ii&&E.lineWidth(O),Kt=O)}function Re(O,R,z){O?(oe(32823),(Jt!==R||$t!==z)&&(E.polygonOffset(R,z),Jt=R,$t=z)):ie(32823)}function Ye(E){E?oe(3089):ie(3089)}function F(O){O===void 0&&(O=33984+ti-1),si!==O&&(E.activeTexture(O),si=O)}function N(O,R,z){z===void 0&&(z=si===null?33984+ti-1:si);let V=ai[z];V===void 0&&(V={type:void 0,texture:void 0},ai[z]=V),(V.type!==O||V.texture!==R)&&(si!==z&&(E.activeTexture(z),si=z),E.bindTexture(O,R||gi[O]),V.type=O,V.texture=R)}function B(){let O=ai[si];O!==void 0&&O.type!==void 0&&(E.bindTexture(O.type,null),O.type=void 0,O.texture=void 0)}function ae(){try{E.compressedTexImage2D.apply(E,arguments)}catch(E){console.error("THREE.WebGLState:",E)}}function ye(){try{E.compressedTexImage3D.apply(E,arguments)}catch(E){console.error("THREE.WebGLState:",E)}}function me(){try{E.texSubImage2D.apply(E,arguments)}catch(E){console.error("THREE.WebGLState:",E)}}function Le(){try{E.texSubImage3D.apply(E,arguments)}catch(E){console.error("THREE.WebGLState:",E)}}function Ne(){try{E.compressedTexSubImage2D.apply(E,arguments)}catch(E){console.error("THREE.WebGLState:",E)}}function Oe(){try{E.compressedTexSubImage3D.apply(E,arguments)}catch(E){console.error("THREE.WebGLState:",E)}}function pe(){try{E.texStorage2D.apply(E,arguments)}catch(E){console.error("THREE.WebGLState:",E)}}function nt(){try{E.texStorage3D.apply(E,arguments)}catch(E){console.error("THREE.WebGLState:",E)}}function je(){try{E.texImage2D.apply(E,arguments)}catch(E){console.error("THREE.WebGLState:",E)}}function Be(){try{E.texImage3D.apply(E,arguments)}catch(E){console.error("THREE.WebGLState:",E)}}function tt(O){fi.equals(O)===!1&&(E.scissor(O.x,O.y,O.z,O.w),fi.copy(O))}function ot(O){mi.equals(O)===!1&&(E.viewport(O.x,O.y,O.z,O.w),mi.copy(O))}function zt(O,R){let z=se.get(R);z===void 0&&(z=new WeakMap,se.set(R,z));let V=z.get(O);V===void 0&&(V=E.getUniformBlockIndex(R,O.name),z.set(O,V))}function fr(O,R){let z=se.get(R).get(O);ee.get(R)!==z&&(E.uniformBlockBinding(R,z,O.__bindingPointIndex),ee.set(R,z))}function Cr(){E.disable(3042),E.disable(2884),E.disable(2929),E.disable(32823),E.disable(3089),E.disable(2960),E.disable(32926),E.blendEquation(32774),E.blendFunc(1,0),E.blendFuncSeparate(1,0,1,0),E.colorMask(!0,!0,!0,!0),E.clearColor(0,0,0,0),E.depthMask(!0),E.depthFunc(513),E.clearDepth(1),E.stencilMask(4294967295),E.stencilFunc(519,0,4294967295),E.stencilOp(7680,7680,7680),E.clearStencil(0),E.cullFace(1029),E.frontFace(2305),E.polygonOffset(0,0),E.activeTexture(33984),E.bindFramebuffer(36160,null),z===!0&&(E.bindFramebuffer(36009,null),E.bindFramebuffer(36008,null)),E.useProgram(null),E.lineWidth(1),E.scissor(0,0,E.canvas.width,E.canvas.height),E.viewport(0,0,E.canvas.width,E.canvas.height),he={},si=null,ai={},ce={},ue=new WeakMap,fe=[],ve=null,we=!1,Ce=null,Te=null,Ie=null,Fe=null,Gt=null,Wt=null,qt=null,Xt=!1,Qt=null,Zt=null,Kt=null,Jt=null,$t=null,fi.set(0,0,E.canvas.width,E.canvas.height),mi.set(0,0,E.canvas.width,E.canvas.height),V.reset(),j.reset(),Y.reset()}return{buffers:{color:V,depth:j,stencil:Y},enable:oe,disable:ie,bindFramebuffer:re,drawBuffers:Q,useProgram:Ee,setBlending:De,setMaterial:Pe,setFlipSided:ke,setCullFace:ze,setLineWidth:Ve,setPolygonOffset:Re,setScissorTest:Ye,activeTexture:F,bindTexture:N,unbindTexture:B,compressedTexImage2D:ae,compressedTexImage3D:ye,texImage2D:je,texImage3D:Be,updateUBOMapping:zt,uniformBlockBinding:fr,texStorage2D:pe,texStorage3D:nt,texSubImage2D:me,texSubImage3D:Le,compressedTexSubImage2D:Ne,compressedTexSubImage3D:Oe,scissor:tt,viewport:ot,reset:Cr}}function A4(E,O,R,z,V,j,Y){let ee,se=V.isWebGL2,he=V.maxTextures,ce=V.maxCubemapSize,ue=V.maxTextureSize,fe=V.maxSamples,ve=O.has("WEBGL_multisampled_render_to_texture")?O.get("WEBGL_multisampled_render_to_texture"):null,we=!(typeof navigator>"u")&&/OculusBrowser/g.test(navigator.userAgent),Se=new WeakMap,_e=new WeakMap,Ae=!1;try{Ae=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function x(E,O){return Ae?new OffscreenCanvas(E,O):yp("canvas")}function v(E,O,R,z){let V=1;if((E.width>z||E.height>z)&&(V=z/Math.max(E.width,E.height)),V<1||O===!0){if(typeof HTMLImageElement<"u"&&E instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&E instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&E instanceof ImageBitmap){let z=O?dy:Math.floor,j=z(V*E.width),Y=z(V*E.height);ee===void 0&&(ee=x(j,Y));let se=R?x(j,Y):ee;return se.width=j,se.height=Y,se.getContext("2d").drawImage(E,0,0,j,Y),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+E.width+"x"+E.height+") to ("+j+"x"+Y+")."),se}return"data"in E&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+E.width+"x"+E.height+")."),E}return E}function S(E){return fS(E.width)&&fS(E.height)}function w(E){return!se&&(E.wrapS!==ui||E.wrapT!==ui||E.minFilter!==mi&&E.minFilter!==yi)}function A(E,O){return E.generateMipmaps&&O&&E.minFilter!==mi&&E.minFilter!==yi}function T(O){E.generateMipmap(O)}function b(R,z,V,j,Y=!1){if(se===!1)return z;if(R!==null){if(E[R]!==void 0)return E[R];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+R+"'")}let ee=z;return z===6403&&(V===5126&&(ee=33326),V===5131&&(ee=33325),V===5121&&(ee=33321)),z===33319&&(V===5126&&(ee=33328),V===5131&&(ee=33327),V===5121&&(ee=33323)),z===6408&&(V===5126&&(ee=34836),V===5131&&(ee=34842),V===5121&&(ee=j===Yr&&Y===!1?35907:32856),V===32819&&(ee=32854),V===32820&&(ee=32855)),(ee===33325||ee===33326||ee===33327||ee===33328||ee===34842||ee===34836)&&O.get("EXT_color_buffer_float"),ee}function M(E,O,R){return A(E,R)===!0||E.isFramebufferTexture&&E.minFilter!==mi&&E.minFilter!==yi?Math.log2(Math.max(O.width,O.height))+1:E.mipmaps!==void 0&&E.mipmaps.length>0?E.mipmaps.length:E.isCompressedTexture&&Array.isArray(E.image)?O.mipmaps.length:1}function C(E){return E===mi||E===gi||E===vi?9728:9729}function P(E){let O=E.target;O.removeEventListener("dispose",P),_(O),O.isVideoTexture&&Se.delete(O)}function I(E){let O=E.target;O.removeEventListener("dispose",I),L(O)}function _(E){let O=z.get(E);if(O.__webglInit===void 0)return;let R=E.source,V=_e.get(R);if(V){let z=V[O.__cacheKey];z.usedTimes--,z.usedTimes===0&&D(E),Object.keys(V).length===0&&_e.delete(R)}z.remove(E)}function D(O){let R=z.get(O);E.deleteTexture(R.__webglTexture);let V=O.source,j=_e.get(V);delete j[R.__cacheKey],Y.memory.textures--}function L(O){let R=O.texture,V=z.get(O),j=z.get(R);if(j.__webglTexture!==void 0&&(E.deleteTexture(j.__webglTexture),Y.memory.textures--),O.depthTexture&&O.depthTexture.dispose(),O.isWebGLCubeRenderTarget)for(let O=0;O<6;O++)E.deleteFramebuffer(V.__webglFramebuffer[O]),V.__webglDepthbuffer&&E.deleteRenderbuffer(V.__webglDepthbuffer[O]);else{if(E.deleteFramebuffer(V.__webglFramebuffer),V.__webglDepthbuffer&&E.deleteRenderbuffer(V.__webglDepthbuffer),V.__webglMultisampledFramebuffer&&E.deleteFramebuffer(V.__webglMultisampledFramebuffer),V.__webglColorRenderbuffer)for(let O=0;O<V.__webglColorRenderbuffer.length;O++)V.__webglColorRenderbuffer[O]&&E.deleteRenderbuffer(V.__webglColorRenderbuffer[O]);V.__webglDepthRenderbuffer&&E.deleteRenderbuffer(V.__webglDepthRenderbuffer)}if(O.isWebGLMultipleRenderTargets)for(let O=0,V=R.length;O<V;O++){let V=z.get(R[O]);V.__webglTexture&&(E.deleteTexture(V.__webglTexture),Y.memory.textures--),z.remove(R[O])}z.remove(R),z.remove(O)}let Ce=0;function U(){Ce=0}function H(){let E=Ce;return E>=he&&console.warn("THREE.WebGLTextures: Trying to use "+E+" texture units while this GPU supports only "+he),Ce+=1,E}function q(E){let O=[];return O.push(E.wrapS),O.push(E.wrapT),O.push(E.wrapR||0),O.push(E.magFilter),O.push(E.minFilter),O.push(E.anisotropy),O.push(E.internalFormat),O.push(E.format),O.push(E.type),O.push(E.generateMipmaps),O.push(E.premultiplyAlpha),O.push(E.flipY),O.push(E.unpackAlignment),O.push(E.encoding),O.join()}function X(E,O){let V=z.get(E);if(E.isVideoTexture&&Ye(E),E.isRenderTargetTexture===!1&&E.version>0&&V.__version!==E.version){let R=E.image;if(R===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else{if(R.complete!==!1){ie(V,E,O);return}console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}R.bindTexture(3553,V.__webglTexture,33984+O)}function Z(E,O){let V=z.get(E);E.version>0&&V.__version!==E.version?ie(V,E,O):R.bindTexture(35866,V.__webglTexture,33984+O)}function G(E,O){let V=z.get(E);E.version>0&&V.__version!==E.version?ie(V,E,O):R.bindTexture(32879,V.__webglTexture,33984+O)}function J(E,O){let V=z.get(E);E.version>0&&V.__version!==E.version?re(V,E,O):R.bindTexture(34067,V.__webglTexture,33984+O)}let Te={[oi]:10497,[ui]:33071,[fi]:33648},Ie={[mi]:9728,[gi]:9984,[vi]:9986,[yi]:9729,[xi]:9985,[bi]:9987};function W(R,j,Y){if(Y?(E.texParameteri(R,10242,Te[j.wrapS]),E.texParameteri(R,10243,Te[j.wrapT]),(R===32879||R===35866)&&E.texParameteri(R,32882,Te[j.wrapR]),E.texParameteri(R,10240,Ie[j.magFilter]),E.texParameteri(R,10241,Ie[j.minFilter])):(E.texParameteri(R,10242,33071),E.texParameteri(R,10243,33071),(R===32879||R===35866)&&E.texParameteri(R,32882,33071),(j.wrapS!==ui||j.wrapT!==ui)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),E.texParameteri(R,10240,C(j.magFilter)),E.texParameteri(R,10241,C(j.minFilter)),j.minFilter!==mi&&j.minFilter!==yi&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),O.has("EXT_texture_filter_anisotropic")===!0){let Y=O.get("EXT_texture_filter_anisotropic");if(j.magFilter===mi||j.minFilter!==vi&&j.minFilter!==bi||j.type===Ii&&O.has("OES_texture_float_linear")===!1||se===!1&&j.type===Oi&&O.has("OES_texture_half_float_linear")===!1)return;(j.anisotropy>1||z.get(j).__currentAnisotropy)&&(E.texParameterf(R,Y.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(j.anisotropy,V.getMaxAnisotropy())),z.get(j).__currentAnisotropy=j.anisotropy)}}function oe(O,R){let z=!1;O.__webglInit===void 0&&(O.__webglInit=!0,R.addEventListener("dispose",P));let V=R.source,j=_e.get(V);j===void 0&&(j={},_e.set(V,j));let ee=q(R);if(ee!==O.__cacheKey){j[ee]===void 0&&(j[ee]={texture:E.createTexture(),usedTimes:0},Y.memory.textures++,z=!0),j[ee].usedTimes++;let V=j[O.__cacheKey];V!==void 0&&(j[O.__cacheKey].usedTimes--,V.usedTimes===0&&D(R)),O.__cacheKey=ee,O.__webglTexture=j[ee].texture}return z}function ie(O,V,Y){let ee=3553;(V.isDataArrayTexture||V.isCompressedArrayTexture)&&(ee=35866),V.isData3DTexture&&(ee=32879);let he=oe(O,V),ce=V.source;R.bindTexture(ee,O.__webglTexture,33984+Y);let fe=z.get(ce);if(ce.version!==fe.__version||he===!0){R.activeTexture(33984+Y),E.pixelStorei(37440,V.flipY),E.pixelStorei(37441,V.premultiplyAlpha),E.pixelStorei(3317,V.unpackAlignment),E.pixelStorei(37443,0);let O=w(V)&&S(V.image)===!1,z=v(V.image,O,!1,ue);z=F(V,z);let ve=S(z)||se,we=j.convert(V.format,V.encoding),Se=j.convert(V.type),_e=b(V.internalFormat,we,Se,V.encoding,V.isVideoTexture);W(ee,V,ve);let Ae,Ce=V.mipmaps,Te=se&&V.isVideoTexture!==!0,Ie=fe.__version===void 0||he===!0,Fe=M(V,z,ve);if(V.isDepthTexture)_e=6402,se?_e=V.type===Ii?36012:V.type===Di?33190:V.type===zi?35056:33189:V.type===Ii&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),V.format===Vi&&_e===6402&&V.type!==Ti&&V.type!==Di&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),V.type=Di,Se=j.convert(V.type)),V.format===ji&&_e===6402&&(_e=34041,V.type!==zi&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),V.type=zi,Se=j.convert(V.type))),Ie&&(Te?R.texStorage2D(3553,1,_e,z.width,z.height):R.texImage2D(3553,0,_e,z.width,z.height,0,we,Se,null));else if(V.isDataTexture)if(Ce.length>0&&ve){Te&&Ie&&R.texStorage2D(3553,Fe,_e,Ce[0].width,Ce[0].height);for(let E=0,O=Ce.length;E<O;E++)Ae=Ce[E],Te?R.texSubImage2D(3553,E,0,0,Ae.width,Ae.height,we,Se,Ae.data):R.texImage2D(3553,E,_e,Ae.width,Ae.height,0,we,Se,Ae.data);V.generateMipmaps=!1}else Te?(Ie&&R.texStorage2D(3553,Fe,_e,z.width,z.height),R.texSubImage2D(3553,0,0,0,z.width,z.height,we,Se,z.data)):R.texImage2D(3553,0,_e,z.width,z.height,0,we,Se,z.data);else if(V.isCompressedTexture)if(V.isCompressedArrayTexture){Te&&Ie&&R.texStorage3D(35866,Fe,_e,Ce[0].width,Ce[0].height,z.depth);for(let E=0,O=Ce.length;E<O;E++)Ae=Ce[E],V.format!==Ni?we!==null?Te?R.compressedTexSubImage3D(35866,E,0,0,0,Ae.width,Ae.height,z.depth,we,Ae.data,0,0):R.compressedTexImage3D(35866,E,_e,Ae.width,Ae.height,z.depth,0,Ae.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Te?R.texSubImage3D(35866,E,0,0,0,Ae.width,Ae.height,z.depth,we,Se,Ae.data):R.texImage3D(35866,E,_e,Ae.width,Ae.height,z.depth,0,we,Se,Ae.data)}else{Te&&Ie&&R.texStorage2D(3553,Fe,_e,Ce[0].width,Ce[0].height);for(let E=0,O=Ce.length;E<O;E++)Ae=Ce[E],V.format!==Ni?we!==null?Te?R.compressedTexSubImage2D(3553,E,0,0,Ae.width,Ae.height,we,Ae.data):R.compressedTexImage2D(3553,E,_e,Ae.width,Ae.height,0,Ae.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Te?R.texSubImage2D(3553,E,0,0,Ae.width,Ae.height,we,Se,Ae.data):R.texImage2D(3553,E,_e,Ae.width,Ae.height,0,we,Se,Ae.data)}else if(V.isDataArrayTexture)Te?(Ie&&R.texStorage3D(35866,Fe,_e,z.width,z.height,z.depth),R.texSubImage3D(35866,0,0,0,0,z.width,z.height,z.depth,we,Se,z.data)):R.texImage3D(35866,0,_e,z.width,z.height,z.depth,0,we,Se,z.data);else if(V.isData3DTexture)Te?(Ie&&R.texStorage3D(32879,Fe,_e,z.width,z.height,z.depth),R.texSubImage3D(32879,0,0,0,0,z.width,z.height,z.depth,we,Se,z.data)):R.texImage3D(32879,0,_e,z.width,z.height,z.depth,0,we,Se,z.data);else if(V.isFramebufferTexture){if(Ie)if(Te)R.texStorage2D(3553,Fe,_e,z.width,z.height);else{let E=z.width,O=z.height;for(let z=0;z<Fe;z++)R.texImage2D(3553,z,_e,E,O,0,we,Se,null),E>>=1,O>>=1}}else if(Ce.length>0&&ve){Te&&Ie&&R.texStorage2D(3553,Fe,_e,Ce[0].width,Ce[0].height);for(let E=0,O=Ce.length;E<O;E++)Ae=Ce[E],Te?R.texSubImage2D(3553,E,0,0,we,Se,Ae):R.texImage2D(3553,E,_e,we,Se,Ae);V.generateMipmaps=!1}else Te?(Ie&&R.texStorage2D(3553,Fe,_e,z.width,z.height),R.texSubImage2D(3553,0,0,0,we,Se,z)):R.texImage2D(3553,0,_e,we,Se,z);A(V,ve)&&T(ee),fe.__version=ce.version,V.onUpdate&&V.onUpdate(V)}O.__version=V.version}function re(O,V,Y){if(V.image.length!==6)return;let ee=oe(O,V),he=V.source;R.bindTexture(34067,O.__webglTexture,33984+Y);let ue=z.get(he);if(he.version!==ue.__version||ee===!0){R.activeTexture(33984+Y),E.pixelStorei(37440,V.flipY),E.pixelStorei(37441,V.premultiplyAlpha),E.pixelStorei(3317,V.unpackAlignment),E.pixelStorei(37443,0);let O=V.isCompressedTexture||V.image[0].isCompressedTexture,z=V.image[0]&&V.image[0].isDataTexture,fe=[];for(let E=0;E<6;E++)fe[E]=O||z?z?V.image[E].image:V.image[E]:v(V.image[E],!1,!0,ce),fe[E]=F(V,fe[E]);let ve=fe[0],we=S(ve)||se,Se=j.convert(V.format,V.encoding),_e=j.convert(V.type),Ae=b(V.internalFormat,Se,_e,V.encoding),Ce=se&&V.isVideoTexture!==!0,Te=ue.__version===void 0||ee===!0,Ie=M(V,ve,we);W(34067,V,we);let Fe;if(O){Ce&&Te&&R.texStorage2D(34067,Ie,Ae,ve.width,ve.height);for(let E=0;E<6;E++){Fe=fe[E].mipmaps;for(let O=0;O<Fe.length;O++){let z=Fe[O];V.format!==Ni?Se!==null?Ce?R.compressedTexSubImage2D(34069+E,O,0,0,z.width,z.height,Se,z.data):R.compressedTexImage2D(34069+E,O,Ae,z.width,z.height,0,z.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):Ce?R.texSubImage2D(34069+E,O,0,0,z.width,z.height,Se,_e,z.data):R.texImage2D(34069+E,O,Ae,z.width,z.height,0,Se,_e,z.data)}}}else{Fe=V.mipmaps,Ce&&Te&&(Fe.length>0&&Ie++,R.texStorage2D(34067,Ie,Ae,fe[0].width,fe[0].height));for(let E=0;E<6;E++)if(z){Ce?R.texSubImage2D(34069+E,0,0,0,fe[E].width,fe[E].height,Se,_e,fe[E].data):R.texImage2D(34069+E,0,Ae,fe[E].width,fe[E].height,0,Se,_e,fe[E].data);for(let O=0;O<Fe.length;O++){let z=Fe[O].image[E].image;Ce?R.texSubImage2D(34069+E,O+1,0,0,z.width,z.height,Se,_e,z.data):R.texImage2D(34069+E,O+1,Ae,z.width,z.height,0,Se,_e,z.data)}}else{Ce?R.texSubImage2D(34069+E,0,0,0,Se,_e,fe[E]):R.texImage2D(34069+E,0,Ae,Se,_e,fe[E]);for(let O=0;O<Fe.length;O++){let z=Fe[O];Ce?R.texSubImage2D(34069+E,O+1,0,0,Se,_e,z.image[E]):R.texImage2D(34069+E,O+1,Ae,Se,_e,z.image[E])}}}A(V,we)&&T(34067),ue.__version=he.version,V.onUpdate&&V.onUpdate(V)}O.__version=V.version}function Q(O,V,Y,ee,se){let he=j.convert(Y.format,Y.encoding),ce=j.convert(Y.type),ue=b(Y.internalFormat,he,ce,Y.encoding);z.get(V).__hasExternalTextures||(se===32879||se===35866?R.texImage3D(se,0,ue,V.width,V.height,V.depth,0,he,ce,null):R.texImage2D(se,0,ue,V.width,V.height,0,he,ce,null)),R.bindFramebuffer(36160,O),Re(V)?ve.framebufferTexture2DMultisampleEXT(36160,ee,se,z.get(Y).__webglTexture,0,Ve(V)):(se===3553||se>=34069&&se<=34074)&&E.framebufferTexture2D(36160,ee,se,z.get(Y).__webglTexture,0),R.bindFramebuffer(36160,null)}function Ee(O,R,z){if(E.bindRenderbuffer(36161,O),R.depthBuffer&&!R.stencilBuffer){let V=33189;if(z||Re(R)){let O=R.depthTexture;O&&O.isDepthTexture&&(O.type===Ii?V=36012:O.type===Di&&(V=33190));let z=Ve(R);Re(R)?ve.renderbufferStorageMultisampleEXT(36161,z,V,R.width,R.height):E.renderbufferStorageMultisample(36161,z,V,R.width,R.height)}else E.renderbufferStorage(36161,V,R.width,R.height);E.framebufferRenderbuffer(36160,36096,36161,O)}else if(R.depthBuffer&&R.stencilBuffer){let V=Ve(R);z&&Re(R)===!1?E.renderbufferStorageMultisample(36161,V,35056,R.width,R.height):Re(R)?ve.renderbufferStorageMultisampleEXT(36161,V,35056,R.width,R.height):E.renderbufferStorage(36161,34041,R.width,R.height),E.framebufferRenderbuffer(36160,33306,36161,O)}else{let O=R.isWebGLMultipleRenderTargets===!0?R.texture:[R.texture];for(let V=0;V<O.length;V++){let Y=O[V],ee=j.convert(Y.format,Y.encoding),se=j.convert(Y.type),he=b(Y.internalFormat,ee,se,Y.encoding),ce=Ve(R);z&&Re(R)===!1?E.renderbufferStorageMultisample(36161,ce,he,R.width,R.height):Re(R)?ve.renderbufferStorageMultisampleEXT(36161,ce,he,R.width,R.height):E.renderbufferStorage(36161,he,R.width,R.height)}}E.bindRenderbuffer(36161,null)}function xe(O,V){if(V&&V.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(R.bindFramebuffer(36160,O),!(V.depthTexture&&V.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!z.get(V.depthTexture).__webglTexture||V.depthTexture.image.width!==V.width||V.depthTexture.image.height!==V.height)&&(V.depthTexture.image.width=V.width,V.depthTexture.image.height=V.height,V.depthTexture.needsUpdate=!0),X(V.depthTexture,0);let j=z.get(V.depthTexture).__webglTexture,Y=Ve(V);if(V.depthTexture.format===Vi)Re(V)?ve.framebufferTexture2DMultisampleEXT(36160,36096,3553,j,0,Y):E.framebufferTexture2D(36160,36096,3553,j,0);else{if(V.depthTexture.format!==ji)throw new Error("Unknown depthTexture format");Re(V)?ve.framebufferTexture2DMultisampleEXT(36160,33306,3553,j,0,Y):E.framebufferTexture2D(36160,33306,3553,j,0)}}function de(O){let V=z.get(O),j=O.isWebGLCubeRenderTarget===!0;if(O.depthTexture&&!V.__autoAllocateDepthBuffer){if(j)throw new Error("target.depthTexture not supported in Cube render targets");xe(V.__webglFramebuffer,O)}else if(j){V.__webglDepthbuffer=[];for(let z=0;z<6;z++)R.bindFramebuffer(36160,V.__webglFramebuffer[z]),V.__webglDepthbuffer[z]=E.createRenderbuffer(),Ee(V.__webglDepthbuffer[z],O,!1)}else R.bindFramebuffer(36160,V.__webglFramebuffer),V.__webglDepthbuffer=E.createRenderbuffer(),Ee(V.__webglDepthbuffer,O,!1);R.bindFramebuffer(36160,null)}function De(E,O,R){let V=z.get(E);O!==void 0&&Q(V.__webglFramebuffer,E,E.texture,36064,3553),R!==void 0&&de(E)}function Pe(O){let ee=O.texture,he=z.get(O),ce=z.get(ee);O.addEventListener("dispose",I),O.isWebGLMultipleRenderTargets!==!0&&(ce.__webglTexture===void 0&&(ce.__webglTexture=E.createTexture()),ce.__version=ee.version,Y.memory.textures++);let ue=O.isWebGLCubeRenderTarget===!0,fe=O.isWebGLMultipleRenderTargets===!0,ve=S(O)||se;if(ue){he.__webglFramebuffer=[];for(let O=0;O<6;O++)he.__webglFramebuffer[O]=E.createFramebuffer()}else{if(he.__webglFramebuffer=E.createFramebuffer(),fe)if(V.drawBuffers){let R=O.texture;for(let O=0,V=R.length;O<V;O++){let V=z.get(R[O]);V.__webglTexture===void 0&&(V.__webglTexture=E.createTexture(),Y.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(se&&O.samples>0&&Re(O)===!1){let z=fe?ee:[ee];he.__webglMultisampledFramebuffer=E.createFramebuffer(),he.__webglColorRenderbuffer=[],R.bindFramebuffer(36160,he.__webglMultisampledFramebuffer);for(let R=0;R<z.length;R++){let V=z[R];he.__webglColorRenderbuffer[R]=E.createRenderbuffer(),E.bindRenderbuffer(36161,he.__webglColorRenderbuffer[R]);let Y=j.convert(V.format,V.encoding),ee=j.convert(V.type),se=b(V.internalFormat,Y,ee,V.encoding,O.isXRRenderTarget===!0),ce=Ve(O);E.renderbufferStorageMultisample(36161,ce,se,O.width,O.height),E.framebufferRenderbuffer(36160,36064+R,36161,he.__webglColorRenderbuffer[R])}E.bindRenderbuffer(36161,null),O.depthBuffer&&(he.__webglDepthRenderbuffer=E.createRenderbuffer(),Ee(he.__webglDepthRenderbuffer,O,!0)),R.bindFramebuffer(36160,null)}}if(ue){R.bindTexture(34067,ce.__webglTexture),W(34067,ee,ve);for(let E=0;E<6;E++)Q(he.__webglFramebuffer[E],O,ee,36064,34069+E);A(ee,ve)&&T(34067),R.unbindTexture()}else if(fe){let E=O.texture;for(let V=0,j=E.length;V<j;V++){let j=E[V],Y=z.get(j);R.bindTexture(3553,Y.__webglTexture),W(3553,j,ve),Q(he.__webglFramebuffer,O,j,36064+V,3553),A(j,ve)&&T(3553)}R.unbindTexture()}else{let E=3553;(O.isWebGL3DRenderTarget||O.isWebGLArrayRenderTarget)&&(se?E=O.isWebGL3DRenderTarget?32879:35866:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),R.bindTexture(E,ce.__webglTexture),W(E,ee,ve),Q(he.__webglFramebuffer,O,ee,36064,E),A(ee,ve)&&T(E),R.unbindTexture()}O.depthBuffer&&de(O)}function ke(E){let O=S(E)||se,V=E.isWebGLMultipleRenderTargets===!0?E.texture:[E.texture];for(let j=0,Y=V.length;j<Y;j++){let Y=V[j];if(A(Y,O)){let O=E.isWebGLCubeRenderTarget?34067:3553,V=z.get(Y).__webglTexture;R.bindTexture(O,V),T(O),R.unbindTexture()}}}function ze(O){if(se&&O.samples>0&&Re(O)===!1){let V=O.isWebGLMultipleRenderTargets?O.texture:[O.texture],j=O.width,Y=O.height,ee=16384,se=[],he=O.stencilBuffer?33306:36096,ce=z.get(O),ue=O.isWebGLMultipleRenderTargets===!0;if(ue)for(let O=0;O<V.length;O++)R.bindFramebuffer(36160,ce.__webglMultisampledFramebuffer),E.framebufferRenderbuffer(36160,36064+O,36161,null),R.bindFramebuffer(36160,ce.__webglFramebuffer),E.framebufferTexture2D(36009,36064+O,3553,null,0);R.bindFramebuffer(36008,ce.__webglMultisampledFramebuffer),R.bindFramebuffer(36009,ce.__webglFramebuffer);for(let R=0;R<V.length;R++){se.push(36064+R),O.depthBuffer&&se.push(he);let fe=ce.__ignoreDepthValues!==void 0&&ce.__ignoreDepthValues;if(fe===!1&&(O.depthBuffer&&(ee|=256),O.stencilBuffer&&(ee|=1024)),ue&&E.framebufferRenderbuffer(36008,36064,36161,ce.__webglColorRenderbuffer[R]),fe===!0&&(E.invalidateFramebuffer(36008,[he]),E.invalidateFramebuffer(36009,[he])),ue){let O=z.get(V[R]).__webglTexture;E.framebufferTexture2D(36009,36064,3553,O,0)}E.blitFramebuffer(0,0,j,Y,0,0,j,Y,ee,9728),we&&E.invalidateFramebuffer(36008,se)}if(R.bindFramebuffer(36008,null),R.bindFramebuffer(36009,null),ue)for(let O=0;O<V.length;O++){R.bindFramebuffer(36160,ce.__webglMultisampledFramebuffer),E.framebufferRenderbuffer(36160,36064+O,36161,ce.__webglColorRenderbuffer[O]);let j=z.get(V[O]).__webglTexture;R.bindFramebuffer(36160,ce.__webglFramebuffer),E.framebufferTexture2D(36009,36064+O,3553,j,0)}R.bindFramebuffer(36009,ce.__webglMultisampledFramebuffer)}}function Ve(E){return Math.min(fe,E.samples)}function Re(E){let R=z.get(E);return se&&E.samples>0&&O.has("WEBGL_multisampled_render_to_texture")===!0&&R.__useRenderToTexture!==!1}function Ye(E){let O=Y.render.frame;Se.get(E)!==O&&(Se.set(E,O),E.update())}function F(E,R){let z=E.encoding,V=E.format,j=E.type;return E.isCompressedTexture===!0||E.isVideoTexture===!0||E.format===dn||z!==Xr&&(z===Yr?se===!1?O.has("EXT_sRGB")===!0&&V===Ni?(E.format=dn,E.minFilter=yi,E.generateMipmaps=!1):R=Ln.sRGBToLinear(R):(V!==Ni||j!==wi)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture encoding:",z)),R}this.allocateTextureUnit=H,this.resetTextureUnits=U,this.setTexture2D=X,this.setTexture2DArray=Z,this.setTexture3D=G,this.setTextureCube=J,this.rebindTextures=De,this.setupRenderTarget=Pe,this.updateRenderTargetMipmap=ke,this.updateMultisampleRenderTarget=ze,this.setupDepthRenderbuffer=de,this.setupFrameBufferTexture=Q,this.useMultisampledRTT=Re}function E4(E,O,R){let z=R.isWebGL2;function i(R,V=null){let j;if(R===wi)return 5121;if(R===Li)return 32819;if(R===Bi)return 32820;if(R===Si)return 5120;if(R===_i)return 5122;if(R===Ti)return 5123;if(R===Pi)return 5124;if(R===Di)return 5125;if(R===Ii)return 5126;if(R===Oi)return z?5131:(j=O.get("OES_texture_half_float"),j!==null?j.HALF_FLOAT_OES:null);if(R===Fi)return 6406;if(R===Ni)return 6408;if(R===Ui)return 6409;if(R===ki)return 6410;if(R===Vi)return 6402;if(R===ji)return 34041;if(R===dn)return j=O.get("EXT_sRGB"),j!==null?j.SRGB_ALPHA_EXT:null;if(R===Gi)return 6403;if(R===Wi)return 36244;if(R===qi)return 33319;if(R===Yi)return 33320;if(R===Qi)return 36249;if(R===Ki||R===Ji||R===$i||R===er)if(V===Yr){if(j=O.get("WEBGL_compressed_texture_s3tc_srgb"),j===null)return null;if(R===Ki)return j.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(R===Ji)return j.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(R===$i)return j.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(R===er)return j.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(j=O.get("WEBGL_compressed_texture_s3tc"),j===null)return null;if(R===Ki)return j.COMPRESSED_RGB_S3TC_DXT1_EXT;if(R===Ji)return j.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(R===$i)return j.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(R===er)return j.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(R===tr||R===ir||R===rr||R===nr){if(j=O.get("WEBGL_compressed_texture_pvrtc"),j===null)return null;if(R===tr)return j.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(R===ir)return j.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(R===rr)return j.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(R===nr)return j.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(R===sr)return j=O.get("WEBGL_compressed_texture_etc1"),j!==null?j.COMPRESSED_RGB_ETC1_WEBGL:null;if(R===ar||R===or){if(j=O.get("WEBGL_compressed_texture_etc"),j===null)return null;if(R===ar)return V===Yr?j.COMPRESSED_SRGB8_ETC2:j.COMPRESSED_RGB8_ETC2;if(R===or)return V===Yr?j.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:j.COMPRESSED_RGBA8_ETC2_EAC}if(R===lr||R===hr||R===cr||R===ur||R===pr||R===mr||R===gr||R===vr||R===yr||R===xr||R===br||R===wr||R===_r||R===Ar){if(j=O.get("WEBGL_compressed_texture_astc"),j===null)return null;if(R===lr)return V===Yr?j.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:j.COMPRESSED_RGBA_ASTC_4x4_KHR;if(R===hr)return V===Yr?j.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:j.COMPRESSED_RGBA_ASTC_5x4_KHR;if(R===cr)return V===Yr?j.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:j.COMPRESSED_RGBA_ASTC_5x5_KHR;if(R===ur)return V===Yr?j.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:j.COMPRESSED_RGBA_ASTC_6x5_KHR;if(R===pr)return V===Yr?j.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:j.COMPRESSED_RGBA_ASTC_6x6_KHR;if(R===mr)return V===Yr?j.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:j.COMPRESSED_RGBA_ASTC_8x5_KHR;if(R===gr)return V===Yr?j.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:j.COMPRESSED_RGBA_ASTC_8x6_KHR;if(R===vr)return V===Yr?j.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:j.COMPRESSED_RGBA_ASTC_8x8_KHR;if(R===yr)return V===Yr?j.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:j.COMPRESSED_RGBA_ASTC_10x5_KHR;if(R===xr)return V===Yr?j.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:j.COMPRESSED_RGBA_ASTC_10x6_KHR;if(R===br)return V===Yr?j.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:j.COMPRESSED_RGBA_ASTC_10x8_KHR;if(R===wr)return V===Yr?j.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:j.COMPRESSED_RGBA_ASTC_10x10_KHR;if(R===_r)return V===Yr?j.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:j.COMPRESSED_RGBA_ASTC_12x10_KHR;if(R===Ar)return V===Yr?j.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:j.COMPRESSED_RGBA_ASTC_12x12_KHR}if(R===Mr){if(j=O.get("EXT_texture_compression_bptc"),j===null)return null;if(R===Mr)return V===Yr?j.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:j.COMPRESSED_RGBA_BPTC_UNORM_EXT}if(R===Er||R===Tr||R===Dr||R===Ir){if(j=O.get("EXT_texture_compression_rgtc"),j===null)return null;if(R===Mr)return j.COMPRESSED_RED_RGTC1_EXT;if(R===Tr)return j.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(R===Dr)return j.COMPRESSED_RED_GREEN_RGTC2_EXT;if(R===Ir)return j.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}return R===zi?z?34042:(j=O.get("WEBGL_depth_texture"),j!==null?j.UNSIGNED_INT_24_8_WEBGL:null):E[R]!==void 0?E[R]:null}return{convert:i}}var zd=class extends po{constructor(E=[]){super(),this.isArrayCamera=!0,this.cameras=E}},Fd=class extends ra{constructor(){super(),this.isGroup=!0,this.type="Group"}},Nd={type:"move"},Ud=class{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new Fd,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new Fd,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new Wn,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new Wn),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new Fd,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new Wn,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new Wn),this._grip}dispatchEvent(E){return this._targetRay!==null&&this._targetRay.dispatchEvent(E),this._grip!==null&&this._grip.dispatchEvent(E),this._hand!==null&&this._hand.dispatchEvent(E),this}connect(E){if(E&&E.hand){let O=this._hand;if(O)for(let R of E.hand.values())this._getHandJoint(O,R)}return this.dispatchEvent({type:"connected",data:E}),this}disconnect(E){return this.dispatchEvent({type:"disconnected",data:E}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(E,O,R){let z=null,V=null,j=null,Y=this._targetRay,ee=this._grip,se=this._hand;if(E&&O.session.visibilityState!=="visible-blurred"){if(se&&E.hand){j=!0;for(let z of E.hand.values()){let E=O.getJointPose(z,R),V=this._getHandJoint(se,z);E!==null&&(V.matrix.fromArray(E.transform.matrix),V.matrix.decompose(V.position,V.rotation,V.scale),V.jointRadius=E.radius),V.visible=E!==null}let z=se.joints["index-finger-tip"],V=se.joints["thumb-tip"],Y=z.position.distanceTo(V.position),ee=.02,he=.005;se.inputState.pinching&&Y>ee+he?(se.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:E.handedness,target:this})):!se.inputState.pinching&&Y<=ee-he&&(se.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:E.handedness,target:this}))}else ee!==null&&E.gripSpace&&(V=O.getPose(E.gripSpace,R),V!==null&&(ee.matrix.fromArray(V.transform.matrix),ee.matrix.decompose(ee.position,ee.rotation,ee.scale),V.linearVelocity?(ee.hasLinearVelocity=!0,ee.linearVelocity.copy(V.linearVelocity)):ee.hasLinearVelocity=!1,V.angularVelocity?(ee.hasAngularVelocity=!0,ee.angularVelocity.copy(V.angularVelocity)):ee.hasAngularVelocity=!1));Y!==null&&(z=O.getPose(E.targetRaySpace,R),z===null&&V!==null&&(z=V),z!==null&&(Y.matrix.fromArray(z.transform.matrix),Y.matrix.decompose(Y.position,Y.rotation,Y.scale),z.linearVelocity?(Y.hasLinearVelocity=!0,Y.linearVelocity.copy(z.linearVelocity)):Y.hasLinearVelocity=!1,z.angularVelocity?(Y.hasAngularVelocity=!0,Y.angularVelocity.copy(z.angularVelocity)):Y.hasAngularVelocity=!1,this.dispatchEvent(Nd)))}return Y!==null&&(Y.visible=z!==null),ee!==null&&(ee.visible=V!==null),se!==null&&(se.visible=j!==null),this}_getHandJoint(E,O){if(E.joints[O.jointName]===void 0){let R=new Fd;R.matrixAutoUpdate=!1,R.visible=!1,E.joints[O.jointName]=R,E.add(R)}return E.joints[O.jointName]}},kd=class extends Fn{constructor(E,O,R,z,V,j,Y,ee,se,he){if(he=he!==void 0?he:Vi,he!==Vi&&he!==ji)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");R===void 0&&he===Vi&&(R=Di),R===void 0&&he===ji&&(R=zi),super(null,z,V,j,Y,ee,he,R,se),this.isDepthTexture=!0,this.image={width:E,height:O},this.magFilter=Y!==void 0?Y:mi,this.minFilter=ee!==void 0?ee:mi,this.flipY=!1,this.generateMipmaps=!1}},jd=class extends pn{constructor(E,O){super();let R=this,z=null,V=1,j=null,Y="local-floor",ee=1,se=null,he=null,ce=null,ue=null,fe=null,ve=null,we=O.getContextAttributes(),Se=null,_e=null,Ae=[],Ce=[],Te=new Set,Ie=new Map,Fe=new po;Fe.layers.enable(1),Fe.viewport=new Nn;let Ue=new po;Ue.layers.enable(2),Ue.viewport=new Nn;let Ge=[Fe,Ue],qe=new zd;qe.layers.enable(1),qe.layers.enable(2);let Xe=null,Qe=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(E){let O=Ae[E];return O===void 0&&(O=new Ud,Ae[E]=O),O.getTargetRaySpace()},this.getControllerGrip=function(E){let O=Ae[E];return O===void 0&&(O=new Ud,Ae[E]=O),O.getGripSpace()},this.getHand=function(E){let O=Ae[E];return O===void 0&&(O=new Ud,Ae[E]=O),O.getHandSpace()};function I(E){let O=Ce.indexOf(E.inputSource);if(O===-1)return;let R=Ae[O];R!==void 0&&R.dispatchEvent({type:E.type,data:E.inputSource})}function _(){z.removeEventListener("select",I),z.removeEventListener("selectstart",I),z.removeEventListener("selectend",I),z.removeEventListener("squeeze",I),z.removeEventListener("squeezestart",I),z.removeEventListener("squeezeend",I),z.removeEventListener("end",_),z.removeEventListener("inputsourceschange",D);for(let E=0;E<Ae.length;E++){let O=Ce[E];O!==null&&(Ce[E]=null,Ae[E].disconnect(O))}Xe=null,Qe=null,E.setRenderTarget(Se),fe=null,ue=null,ce=null,z=null,_e=null,$e.stop(),R.isPresenting=!1,R.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(E){V=E,R.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(E){Y=E,R.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return se||j},this.setReferenceSpace=function(E){se=E},this.getBaseLayer=function(){return ue!==null?ue:fe},this.getBinding=function(){return ce},this.getFrame=function(){return ve},this.getSession=function(){return z},this.setSession=async function(he){if(z=he,z!==null){if(Se=E.getRenderTarget(),z.addEventListener("select",I),z.addEventListener("selectstart",I),z.addEventListener("selectend",I),z.addEventListener("squeeze",I),z.addEventListener("squeezestart",I),z.addEventListener("squeezeend",I),z.addEventListener("end",_),z.addEventListener("inputsourceschange",D),we.xrCompatible!==!0&&await O.makeXRCompatible(),z.renderState.layers===void 0||E.capabilities.isWebGL2===!1){let R={antialias:z.renderState.layers!==void 0||we.antialias,alpha:we.alpha,depth:we.depth,stencil:we.stencil,framebufferScaleFactor:V};fe=new XRWebGLLayer(z,O,R),z.updateRenderState({baseLayer:fe}),_e=new Un(fe.framebufferWidth,fe.framebufferHeight,{format:Ni,type:wi,encoding:E.outputEncoding,stencilBuffer:we.stencil})}else{let R=null,j=null,Y=null;we.depth&&(Y=we.stencil?35056:33190,R=we.stencil?ji:Vi,j=we.stencil?zi:Di);let ee={colorFormat:32856,depthFormat:Y,scaleFactor:V};ce=new XRWebGLBinding(z,O),ue=ce.createProjectionLayer(ee),z.updateRenderState({layers:[ue]}),_e=new Un(ue.textureWidth,ue.textureHeight,{format:Ni,type:wi,depthTexture:new kd(ue.textureWidth,ue.textureHeight,j,void 0,void 0,void 0,void 0,void 0,void 0,R),stencilBuffer:we.stencil,encoding:E.outputEncoding,samples:we.antialias?4:0});let se=E.properties.get(_e);se.__ignoreDepthValues=ue.ignoreDepthValues}_e.isXRRenderTarget=!0,this.setFoveation(ee),se=null,j=await z.requestReferenceSpace(Y),$e.setContext(z),$e.start(),R.isPresenting=!0,R.dispatchEvent({type:"sessionstart"})}};function D(E){for(let O=0;O<E.removed.length;O++){let R=E.removed[O],z=Ce.indexOf(R);z>=0&&(Ce[z]=null,Ae[z].disconnect(R))}for(let O=0;O<E.added.length;O++){let R=E.added[O],z=Ce.indexOf(R);if(z===-1){for(let E=0;E<Ae.length;E++){if(E>=Ce.length){Ce.push(R),z=E;break}if(Ce[E]===null){Ce[E]=R,z=E;break}}if(z===-1)break}let V=Ae[z];V&&V.connect(R)}}let Ze=new Wn,Ke=new Wn;function U(E,O,R){Ze.setFromMatrixPosition(O.matrixWorld),Ke.setFromMatrixPosition(R.matrixWorld);let z=Ze.distanceTo(Ke),V=O.projectionMatrix.elements,j=R.projectionMatrix.elements,Y=V[14]/(V[10]-1),ee=V[14]/(V[10]+1),se=(V[9]+1)/V[5],he=(V[9]-1)/V[5],ce=(V[8]-1)/V[0],ue=(j[8]+1)/j[0],fe=Y*ce,ve=Y*ue,we=z/(-ce+ue),Se=we*-ce;O.matrixWorld.decompose(E.position,E.quaternion,E.scale),E.translateX(Se),E.translateZ(we),E.matrixWorld.compose(E.position,E.quaternion,E.scale),E.matrixWorldInverse.copy(E.matrixWorld).invert();let _e=Y+we,Ae=ee+we,Ce=fe-Se,Te=ve+(z-Se),Ie=se*ee/Ae*_e,Fe=he*ee/Ae*_e;E.projectionMatrix.makePerspective(Ce,Te,Ie,Fe,_e,Ae)}function H(E,O){O===null?E.matrixWorld.copy(E.matrix):E.matrixWorld.multiplyMatrices(O.matrixWorld,E.matrix),E.matrixWorldInverse.copy(E.matrixWorld).invert()}this.updateCamera=function(E){if(z===null)return;qe.near=Ue.near=Fe.near=E.near,qe.far=Ue.far=Fe.far=E.far,(Xe!==qe.near||Qe!==qe.far)&&(z.updateRenderState({depthNear:qe.near,depthFar:qe.far}),Xe=qe.near,Qe=qe.far);let O=E.parent,R=qe.cameras;H(qe,O);for(let E=0;E<R.length;E++)H(R[E],O);qe.matrixWorld.decompose(qe.position,qe.quaternion,qe.scale),E.matrix.copy(qe.matrix),E.matrix.decompose(E.position,E.quaternion,E.scale);let V=E.children;for(let E=0,O=V.length;E<O;E++)V[E].updateMatrixWorld(!0);R.length===2?U(qe,Fe,Ue):qe.projectionMatrix.copy(Fe.projectionMatrix)},this.getCamera=function(){return qe},this.getFoveation=function(){if(!(ue===null&&fe===null))return ee},this.setFoveation=function(E){ee=E,ue!==null&&(ue.fixedFoveation=E),fe!==null&&fe.fixedFoveation!==void 0&&(fe.fixedFoveation=E)},this.getPlanes=function(){return Te};let Je=null;function X(O,z){if(he=z.getViewerPose(se||j),ve=z,he!==null){let O=he.views;fe!==null&&(E.setRenderTargetFramebuffer(_e,fe.framebuffer),E.setRenderTarget(_e));let R=!1;O.length!==qe.cameras.length&&(qe.cameras.length=0,R=!0);for(let z=0;z<O.length;z++){let V=O[z],j=null;if(fe!==null)j=fe.getViewport(V);else{let O=ce.getViewSubImage(ue,V);j=O.viewport,z===0&&(E.setRenderTargetTextures(_e,O.colorTexture,ue.ignoreDepthValues?void 0:O.depthStencilTexture),E.setRenderTarget(_e))}let Y=Ge[z];Y===void 0&&(Y=new po,Y.layers.enable(z),Y.viewport=new Nn,Ge[z]=Y),Y.matrix.fromArray(V.transform.matrix),Y.projectionMatrix.fromArray(V.projectionMatrix),Y.viewport.set(j.x,j.y,j.width,j.height),z===0&&qe.matrix.copy(Y.matrix),R===!0&&qe.cameras.push(Y)}}for(let E=0;E<Ae.length;E++){let O=Ce[E],R=Ae[E];O!==null&&R!==void 0&&R.update(O,z,se||j)}if(Je&&Je(O,z),z.detectedPlanes){R.dispatchEvent({type:"planesdetected",data:z.detectedPlanes});let E=null;for(let O of Te)z.detectedPlanes.has(O)||(E===null&&(E=[]),E.push(O));if(E!==null)for(let O of E)Te.delete(O),Ie.delete(O),R.dispatchEvent({type:"planeremoved",data:O});for(let E of z.detectedPlanes)if(Te.has(E)){let O=Ie.get(E);E.lastChangedTime>O&&(Ie.set(E,E.lastChangedTime),R.dispatchEvent({type:"planechanged",data:E}))}else Te.add(E),Ie.set(E,z.lastChangedTime),R.dispatchEvent({type:"planeadded",data:E})}ve=null}let $e=new wP;$e.setAnimationLoop(X),this.setAnimationLoop=function(E){Je=E},this.dispose=function(){}}};function M4(E,O){function e(O,R){R.color.getRGB(O.fogColor.value,SP(E)),R.isFog?(O.fogNear.value=R.near,O.fogFar.value=R.far):R.isFogExp2&&(O.fogDensity.value=R.density)}function r(E,O,R,z,V){O.isMeshBasicMaterial||O.isMeshLambertMaterial?i(E,O):O.isMeshToonMaterial?(i(E,O),u(E,O)):O.isMeshPhongMaterial?(i(E,O),c(E,O)):O.isMeshStandardMaterial?(i(E,O),h(E,O),O.isMeshPhysicalMaterial&&d(E,O,V)):O.isMeshMatcapMaterial?(i(E,O),f(E,O)):O.isMeshDepthMaterial?i(E,O):O.isMeshDistanceMaterial?(i(E,O),p(E,O)):O.isMeshNormalMaterial?i(E,O):O.isLineBasicMaterial?(s(E,O),O.isLineDashedMaterial&&o(E,O)):O.isPointsMaterial?a(E,O,R,z):O.isSpriteMaterial?l(E,O):O.isShadowMaterial?(E.color.value.copy(O.color),E.opacity.value=O.opacity):O.isShaderMaterial&&(O.uniformsNeedUpdate=!1)}function i(R,z){R.opacity.value=z.opacity,z.color&&R.diffuse.value.copy(z.color),z.emissive&&R.emissive.value.copy(z.emissive).multiplyScalar(z.emissiveIntensity),z.map&&(R.map.value=z.map),z.alphaMap&&(R.alphaMap.value=z.alphaMap),z.bumpMap&&(R.bumpMap.value=z.bumpMap,R.bumpScale.value=z.bumpScale,z.side===Ue&&(R.bumpScale.value*=-1)),z.displacementMap&&(R.displacementMap.value=z.displacementMap,R.displacementScale.value=z.displacementScale,R.displacementBias.value=z.displacementBias),z.emissiveMap&&(R.emissiveMap.value=z.emissiveMap),z.normalMap&&(R.normalMap.value=z.normalMap,R.normalScale.value.copy(z.normalScale),z.side===Ue&&R.normalScale.value.negate()),z.specularMap&&(R.specularMap.value=z.specularMap),z.alphaTest>0&&(R.alphaTest.value=z.alphaTest);let V=O.get(z).envMap;if(V&&(R.envMap.value=V,R.flipEnvMap.value=V.isCubeTexture&&V.isRenderTargetTexture===!1?-1:1,R.reflectivity.value=z.reflectivity,R.ior.value=z.ior,R.refractionRatio.value=z.refractionRatio),z.lightMap){R.lightMap.value=z.lightMap;let O=E.physicallyCorrectLights!==!0?Math.PI:1;R.lightMapIntensity.value=z.lightMapIntensity*O}z.aoMap&&(R.aoMap.value=z.aoMap,R.aoMapIntensity.value=z.aoMapIntensity);let j;z.map?j=z.map:z.specularMap?j=z.specularMap:z.displacementMap?j=z.displacementMap:z.normalMap?j=z.normalMap:z.bumpMap?j=z.bumpMap:z.roughnessMap?j=z.roughnessMap:z.metalnessMap?j=z.metalnessMap:z.alphaMap?j=z.alphaMap:z.emissiveMap?j=z.emissiveMap:z.clearcoatMap?j=z.clearcoatMap:z.clearcoatNormalMap?j=z.clearcoatNormalMap:z.clearcoatRoughnessMap?j=z.clearcoatRoughnessMap:z.iridescenceMap?j=z.iridescenceMap:z.iridescenceThicknessMap?j=z.iridescenceThicknessMap:z.specularIntensityMap?j=z.specularIntensityMap:z.specularColorMap?j=z.specularColorMap:z.transmissionMap?j=z.transmissionMap:z.thicknessMap?j=z.thicknessMap:z.sheenColorMap?j=z.sheenColorMap:z.sheenRoughnessMap&&(j=z.sheenRoughnessMap),j!==void 0&&(j.isWebGLRenderTarget&&(j=j.texture),j.matrixAutoUpdate===!0&&j.updateMatrix(),R.uvTransform.value.copy(j.matrix));let Y;z.aoMap?Y=z.aoMap:z.lightMap&&(Y=z.lightMap),Y!==void 0&&(Y.isWebGLRenderTarget&&(Y=Y.texture),Y.matrixAutoUpdate===!0&&Y.updateMatrix(),R.uv2Transform.value.copy(Y.matrix))}function s(E,O){E.diffuse.value.copy(O.color),E.opacity.value=O.opacity}function o(E,O){E.dashSize.value=O.dashSize,E.totalSize.value=O.dashSize+O.gapSize,E.scale.value=O.scale}function a(E,O,R,z){E.diffuse.value.copy(O.color),E.opacity.value=O.opacity,E.size.value=O.size*R,E.scale.value=z*.5,O.map&&(E.map.value=O.map),O.alphaMap&&(E.alphaMap.value=O.alphaMap),O.alphaTest>0&&(E.alphaTest.value=O.alphaTest);let V;O.map?V=O.map:O.alphaMap&&(V=O.alphaMap),V!==void 0&&(V.matrixAutoUpdate===!0&&V.updateMatrix(),E.uvTransform.value.copy(V.matrix))}function l(E,O){E.diffuse.value.copy(O.color),E.opacity.value=O.opacity,E.rotation.value=O.rotation,O.map&&(E.map.value=O.map),O.alphaMap&&(E.alphaMap.value=O.alphaMap),O.alphaTest>0&&(E.alphaTest.value=O.alphaTest);let R;O.map?R=O.map:O.alphaMap&&(R=O.alphaMap),R!==void 0&&(R.matrixAutoUpdate===!0&&R.updateMatrix(),E.uvTransform.value.copy(R.matrix))}function c(E,O){E.specular.value.copy(O.specular),E.shininess.value=Math.max(O.shininess,1e-4)}function u(E,O){O.gradientMap&&(E.gradientMap.value=O.gradientMap)}function h(E,R){E.roughness.value=R.roughness,E.metalness.value=R.metalness,R.roughnessMap&&(E.roughnessMap.value=R.roughnessMap),R.metalnessMap&&(E.metalnessMap.value=R.metalnessMap),O.get(R).envMap&&(E.envMapIntensity.value=R.envMapIntensity)}function d(E,O,R){E.ior.value=O.ior,O.sheen>0&&(E.sheenColor.value.copy(O.sheenColor).multiplyScalar(O.sheen),E.sheenRoughness.value=O.sheenRoughness,O.sheenColorMap&&(E.sheenColorMap.value=O.sheenColorMap),O.sheenRoughnessMap&&(E.sheenRoughnessMap.value=O.sheenRoughnessMap)),O.clearcoat>0&&(E.clearcoat.value=O.clearcoat,E.clearcoatRoughness.value=O.clearcoatRoughness,O.clearcoatMap&&(E.clearcoatMap.value=O.clearcoatMap),O.clearcoatRoughnessMap&&(E.clearcoatRoughnessMap.value=O.clearcoatRoughnessMap),O.clearcoatNormalMap&&(E.clearcoatNormalScale.value.copy(O.clearcoatNormalScale),E.clearcoatNormalMap.value=O.clearcoatNormalMap,O.side===Ue&&E.clearcoatNormalScale.value.negate())),O.iridescence>0&&(E.iridescence.value=O.iridescence,E.iridescenceIOR.value=O.iridescenceIOR,E.iridescenceThicknessMinimum.value=O.iridescenceThicknessRange[0],E.iridescenceThicknessMaximum.value=O.iridescenceThicknessRange[1],O.iridescenceMap&&(E.iridescenceMap.value=O.iridescenceMap),O.iridescenceThicknessMap&&(E.iridescenceThicknessMap.value=O.iridescenceThicknessMap)),O.transmission>0&&(E.transmission.value=O.transmission,E.transmissionSamplerMap.value=R.texture,E.transmissionSamplerSize.value.set(R.width,R.height),O.transmissionMap&&(E.transmissionMap.value=O.transmissionMap),E.thickness.value=O.thickness,O.thicknessMap&&(E.thicknessMap.value=O.thicknessMap),E.attenuationDistance.value=O.attenuationDistance,E.attenuationColor.value.copy(O.attenuationColor)),E.specularIntensity.value=O.specularIntensity,E.specularColor.value.copy(O.specularColor),O.specularIntensityMap&&(E.specularIntensityMap.value=O.specularIntensityMap),O.specularColorMap&&(E.specularColorMap.value=O.specularColorMap)}function f(E,O){O.matcap&&(E.matcap.value=O.matcap)}function p(E,O){E.referencePosition.value.copy(O.referencePosition),E.nearDistance.value=O.nearDistance,E.farDistance.value=O.farDistance}return{refreshFogUniforms:e,refreshMaterialUniforms:r}}function C4(E,O,R,z){let V={},j={},Y=[],ee=R.isWebGL2?E.getParameter(35375):0;function l(E,O){let R=O.program;z.uniformBlockBinding(E,R)}function c(E,R){let Y=V[E.id];Y===void 0&&(p(E),Y=u(E),V[E.id]=Y,E.addEventListener("dispose",g));let ee=R.program;z.updateUBOMapping(E,ee);let se=O.render.frame;j[E.id]!==se&&(d(E),j[E.id]=se)}function u(O){let R=h();O.__bindingPointIndex=R;let z=E.createBuffer(),V=O.__size,j=O.usage;return E.bindBuffer(35345,z),E.bufferData(35345,V,j),E.bindBuffer(35345,null),E.bindBufferBase(35345,R,z),z}function h(){for(let E=0;E<ee;E++)if(Y.indexOf(E)===-1)return Y.push(E),E;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function d(O){let R=V[O.id],z=O.uniforms,j=O.__cache;E.bindBuffer(35345,R);for(let O=0,R=z.length;O<R;O++){let R=z[O];if(f(R,O,j)===!0){let O=R.__offset,z=Array.isArray(R.value)?R.value:[R.value],V=0;for(let j=0;j<z.length;j++){let Y=z[j],ee=m(Y);typeof Y=="number"?(R.__data[0]=Y,E.bufferSubData(35345,O+V,R.__data)):Y.isMatrix3?(R.__data[0]=Y.elements[0],R.__data[1]=Y.elements[1],R.__data[2]=Y.elements[2],R.__data[3]=Y.elements[0],R.__data[4]=Y.elements[3],R.__data[5]=Y.elements[4],R.__data[6]=Y.elements[5],R.__data[7]=Y.elements[0],R.__data[8]=Y.elements[6],R.__data[9]=Y.elements[7],R.__data[10]=Y.elements[8],R.__data[11]=Y.elements[0]):(Y.toArray(R.__data,V),V+=ee.storage/Float32Array.BYTES_PER_ELEMENT)}E.bufferSubData(35345,O,R.__data)}}E.bindBuffer(35345,null)}function f(E,O,R){let z=E.value;if(R[O]===void 0){if(typeof z=="number")R[O]=z;else{let E=Array.isArray(z)?z:[z],V=[];for(let O=0;O<E.length;O++)V.push(E[O].clone());R[O]=V}return!0}if(typeof z=="number"){if(R[O]!==z)return R[O]=z,!0}else{let E=Array.isArray(R[O])?R[O]:[R[O]],V=Array.isArray(z)?z:[z];for(let O=0;O<E.length;O++){let R=E[O];if(R.equals(V[O])===!1)return R.copy(V[O]),!0}}return!1}function p(E){let O=E.uniforms,R=0,z=16,V=0;for(let E=0,j=O.length;E<j;E++){let j=O[E],Y={boundary:0,storage:0},ee=Array.isArray(j.value)?j.value:[j.value];for(let E=0,O=ee.length;E<O;E++){let O=ee[E],R=m(O);Y.boundary+=R.boundary,Y.storage+=R.storage}if(j.__data=new Float32Array(Y.storage/Float32Array.BYTES_PER_ELEMENT),j.__offset=R,E>0){V=R%z;let E=z-V;V!==0&&E-Y.boundary<0&&(R+=z-V,j.__offset=R)}R+=Y.storage}return V=R%z,V>0&&(R+=z-V),E.__size=R,E.__cache={},this}function m(E){let O={boundary:0,storage:0};return typeof E=="number"?(O.boundary=4,O.storage=4):E.isVector2?(O.boundary=8,O.storage=8):E.isVector3||E.isColor?(O.boundary=16,O.storage=12):E.isVector4?(O.boundary=16,O.storage=16):E.isMatrix3?(O.boundary=48,O.storage=48):E.isMatrix4?(O.boundary=64,O.storage=64):E.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",E),O}function g(O){let R=O.target;R.removeEventListener("dispose",g);let z=Y.indexOf(R.__bindingPointIndex);Y.splice(z,1),E.deleteBuffer(V[R.id]),delete V[R.id],delete j[R.id]}function y(){for(let O in V)E.deleteBuffer(V[O]);Y=[],V={},j={}}return{bind:l,update:c,dispose:y}}function P4(){let E=yp("canvas");return E.style.display="block",E}function QS(E={}){this.isWebGLRenderer=!0;let O,R=E.canvas!==void 0?E.canvas:P4(),z=E.context!==void 0?E.context:null,V=E.depth===void 0||E.depth,j=E.stencil===void 0||E.stencil,Y=E.antialias!==void 0&&E.antialias,ee=E.premultipliedAlpha===void 0||E.premultipliedAlpha,se=E.preserveDrawingBuffer!==void 0&&E.preserveDrawingBuffer,he=E.powerPreference!==void 0?E.powerPreference:"default",ce=E.failIfMajorPerformanceCaveat!==void 0&&E.failIfMajorPerformanceCaveat;O=z!==null?z.getContextAttributes().alpha:E.alpha!==void 0&&E.alpha;let ue=null,fe=null,we=[],Se=[];this.domElement=R,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=Xr,this.physicallyCorrectLights=!1,this.toneMapping=Xt,this.toneMappingExposure=1;let _e=this,Ae=!1,Ce=0,Te=0,Ie=null,qe=-1,Xe=null,Qe=new Nn,Ze=new Nn,Ke=null,Je=R.width,$e=R.height,et=1,it=null,rt=null,at=new Nn(0,0,Je,$e),lt=new Nn(0,0,Je,$e),ct=!1,dt=new Eo,ut=!1,pt=!1,mt=null,gt=new Es,yt=new bn,St=new Wn,_t={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function $(){return Ie===null?et:1}let Mt=z;function oe(E,O){for(let z=0;z<E.length;z++){let V=E[z],j=R.getContext(V,O);if(j!==null)return j}return null}try{let E={alpha:!0,depth:V,stencil:j,antialias:Y,premultipliedAlpha:ee,preserveDrawingBuffer:se,powerPreference:he,failIfMajorPerformanceCaveat:ce};if("setAttribute"in R&&R.setAttribute("data-engine",`three.js r${ve}`),R.addEventListener("webglcontextlost",tt,!1),R.addEventListener("webglcontextrestored",ot,!1),R.addEventListener("webglcontextcreationerror",zt,!1),Mt===null){let O=["webgl2","webgl","experimental-webgl"];if(_e.isWebGL1Renderer===!0&&O.shift(),Mt=oe(O,E),Mt===null)throw oe(O)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}Mt.getShaderPrecisionFormat===void 0&&(Mt.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(E){throw console.error("THREE.WebGLRenderer: "+E.message),E}let Et,Tt,It,Lt,Bt,Ft,Ut,jt,Gt,Wt,qt,Qt,Zt,Kt,Jt,$t,ti,ii,ri,ni,si,ai,oi,ui;function je(){Et=new Kk(Mt),Tt=new jk(Mt,Et,E),Et.init(Tt),ai=new E4(Mt,Et,Tt),It=new w4(Mt,Et,Tt),Lt=new Jk,Bt=new u4,Ft=new A4(Mt,Et,It,Bt,Tt,ai,Lt),Ut=new Wk(_e),jt=new Yk(_e),Gt=new aU(Mt,Tt),oi=new kk(Mt,Et,Gt,Tt),Wt=new Qk(Mt,Gt,Lt,oi),qt=new rG(Mt,Wt,Gt,Lt),ri=new tG(Mt,Tt,Ft),$t=new Hk(Bt),Qt=new c4(_e,Ut,jt,Et,Tt,oi,$t),Zt=new M4(_e,Bt),Kt=new d4,Jt=new v4(Et,Tt),ii=new zk(_e,Ut,jt,It,qt,O,ee),ti=new S4(_e,qt,Tt),ui=new C4(Mt,Lt,Tt,It),ni=new Gk(Mt,Et,Lt,Tt),si=new Zk(Mt,Et,Lt,Tt),Lt.programs=Qt.programs,_e.capabilities=Tt,_e.extensions=Et,_e.properties=Bt,_e.renderLists=Kt,_e.shadowMap=ti,_e.state=It,_e.info=Lt}je();let fi=new jd(_e,Mt);this.xr=fi,this.getContext=function(){return Mt},this.getContextAttributes=function(){return Mt.getContextAttributes()},this.forceContextLoss=function(){let E=Et.get("WEBGL_lose_context");E&&E.loseContext()},this.forceContextRestore=function(){let E=Et.get("WEBGL_lose_context");E&&E.restoreContext()},this.getPixelRatio=function(){return et},this.setPixelRatio=function(E){E!==void 0&&(et=E,this.setSize(Je,$e,!1))},this.getSize=function(E){return E.set(Je,$e)},this.setSize=function(E,O,z){fi.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(Je=E,$e=O,R.width=Math.floor(E*et),R.height=Math.floor(O*et),z!==!1&&(R.style.width=E+"px",R.style.height=O+"px"),this.setViewport(0,0,E,O))},this.getDrawingBufferSize=function(E){return E.set(Je*et,$e*et).floor()},this.setDrawingBufferSize=function(E,O,z){Je=E,$e=O,et=z,R.width=Math.floor(E*z),R.height=Math.floor(O*z),this.setViewport(0,0,E,O)},this.getCurrentViewport=function(E){return E.copy(Qe)},this.getViewport=function(E){return E.copy(at)},this.setViewport=function(E,O,R,z){E.isVector4?at.set(E.x,E.y,E.z,E.w):at.set(E,O,R,z),It.viewport(Qe.copy(at).multiplyScalar(et).floor())},this.getScissor=function(E){return E.copy(lt)},this.setScissor=function(E,O,R,z){E.isVector4?lt.set(E.x,E.y,E.z,E.w):lt.set(E,O,R,z),It.scissor(Ze.copy(lt).multiplyScalar(et).floor())},this.getScissorTest=function(){return ct},this.setScissorTest=function(E){It.setScissorTest(ct=E)},this.setOpaqueSort=function(E){it=E},this.setTransparentSort=function(E){rt=E},this.getClearColor=function(E){return E.copy(ii.getClearColor())},this.setClearColor=function(){ii.setClearColor.apply(ii,arguments)},this.getClearAlpha=function(){return ii.getClearAlpha()},this.setClearAlpha=function(){ii.setClearAlpha.apply(ii,arguments)},this.clear=function(E=!0,O=!0,R=!0){let z=0;E&&(z|=16384),O&&(z|=256),R&&(z|=1024),Mt.clear(z)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){R.removeEventListener("webglcontextlost",tt,!1),R.removeEventListener("webglcontextrestored",ot,!1),R.removeEventListener("webglcontextcreationerror",zt,!1),Kt.dispose(),Jt.dispose(),Bt.dispose(),Ut.dispose(),jt.dispose(),qt.dispose(),oi.dispose(),ui.dispose(),Qt.dispose(),fi.dispose(),fi.removeEventListener("sessionstart",He),fi.removeEventListener("sessionend",We),mt&&(mt.dispose(),mt=null),gi.stop()};function tt(E){E.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),Ae=!0}function ot(){console.log("THREE.WebGLRenderer: Context Restored."),Ae=!1;let E=Lt.autoReset,O=ti.enabled,R=ti.autoUpdate,z=ti.needsUpdate,V=ti.type;je(),Lt.autoReset=E,ti.enabled=O,ti.autoUpdate=R,ti.needsUpdate=z,ti.type=V}function zt(E){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",E.statusMessage)}function fr(E){let O=E.target;O.removeEventListener("dispose",fr),Cr(O)}function Cr(E){K(E),Bt.remove(E)}function K(E){let O=Bt.get(E).programs;O!==void 0&&(O.forEach((function(E){Qt.releaseProgram(E)})),E.isShaderMaterial&&Qt.releaseShaderCache(E))}this.renderBufferDirect=function(E,O,R,z,V,j){O===null&&(O=_t);let Y=V.isMesh&&V.matrixWorld.determinant()<0,ee=v1(E,O,R,z,V);It.setMaterial(z,Y);let se=R.index,he=1;z.wireframe===!0&&(se=Wt.getWireframeAttribute(R),he=2);let ce=R.drawRange,ue=R.attributes.position,fe=ce.start*he,ve=(ce.start+ce.count)*he;j!==null&&(fe=Math.max(fe,j.start*he),ve=Math.min(ve,(j.start+j.count)*he)),se!==null?(fe=Math.max(fe,0),ve=Math.min(ve,se.count)):ue!=null&&(fe=Math.max(fe,0),ve=Math.min(ve,ue.count));let we=ve-fe;if(we<0||we===1/0)return;oi.setup(V,z,ee,R,se);let Se,_e=ni;if(se!==null&&(Se=Gt.get(se),_e=si,_e.setIndex(Se)),V.isMesh)z.wireframe===!0?(It.setLineWidth(z.wireframeLinewidth*$()),_e.setMode(1)):_e.setMode(4);else if(V.isLine){let E=z.linewidth;E===void 0&&(E=1),It.setLineWidth(E*$()),V.isLineSegments?_e.setMode(1):V.isLineLoop?_e.setMode(2):_e.setMode(3)}else V.isPoints?_e.setMode(0):V.isSprite&&_e.setMode(4);if(V.isInstancedMesh)_e.renderInstances(fe,we,V.count);else if(R.isInstancedBufferGeometry){let E=R._maxInstanceCount!==void 0?R._maxInstanceCount:1/0,O=Math.min(R.instanceCount,E);_e.renderInstances(fe,we,O)}else _e.render(fe,we)},this.compile=function(E,O){function ge(E,O,R){E.transparent===!0&&E.side===Ge&&E.forceSinglePass===!1?(E.side=Ue,E.needsUpdate=!0,Pn(E,O,R),E.side=Fe,E.needsUpdate=!0,Pn(E,O,R),E.side=Ge):Pn(E,O,R)}fe=Jt.get(E),fe.init(),Se.push(fe),E.traverseVisible((function(E){E.isLight&&E.layers.test(O.layers)&&(fe.pushLight(E),E.castShadow&&fe.pushShadow(E))})),fe.setupLights(_e.physicallyCorrectLights),E.traverse((function(O){let R=O.material;if(R)if(Array.isArray(R))for(let z=0;z<R.length;z++){let V=R[z];ge(V,E,O)}else ge(R,E,O)})),Se.pop(),fe=null};let mi=null;function Me(E){mi&&mi(E)}function He(){gi.stop()}function We(){gi.start()}let gi=new wP;gi.setAnimationLoop(Me),typeof self<"u"&&gi.setContext(self),this.setAnimationLoop=function(E){mi=E,fi.setAnimationLoop(E),E===null?gi.stop():gi.start()},fi.addEventListener("sessionstart",He),fi.addEventListener("sessionend",We),this.render=function(E,O){if(O!==void 0&&O.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(Ae===!0)return;E.matrixWorldAutoUpdate===!0&&E.updateMatrixWorld(),O.parent===null&&O.matrixWorldAutoUpdate===!0&&O.updateMatrixWorld(),fi.enabled===!0&&fi.isPresenting===!0&&(fi.cameraAutoUpdate===!0&&fi.updateCamera(O),O=fi.getCamera()),E.isScene===!0&&E.onBeforeRender(_e,E,O,Ie),fe=Jt.get(E,Se.length),fe.init(),Se.push(fe),gt.multiplyMatrices(O.projectionMatrix,O.matrixWorldInverse),dt.setFromProjectionMatrix(gt),pt=this.localClippingEnabled,ut=$t.init(this.clippingPlanes,pt),ue=Kt.get(E,we.length),ue.init(),we.push(ue),zr(E,O,0,_e.sortObjects),ue.finish(),_e.sortObjects===!0&&ue.sort(it,rt),ut===!0&&$t.beginShadows();let R=fe.state.shadowsArray;if(ti.render(R,E,O),ut===!0&&$t.endShadows(),this.info.autoReset===!0&&this.info.reset(),ii.render(ue,E),fe.setupLights(_e.physicallyCorrectLights),O.isArrayCamera){let R=O.cameras;for(let O=0,z=R.length;O<z;O++){let z=R[O];kr(ue,E,z,z.viewport)}}else kr(ue,E,O);Ie!==null&&(Ft.updateMultisampleRenderTarget(Ie),Ft.updateRenderTargetMipmap(Ie)),E.isScene===!0&&E.onAfterRender(_e,E,O),oi.resetDefaultState(),qe=-1,Xe=null,Se.pop(),fe=Se.length>0?Se[Se.length-1]:null,we.pop(),ue=we.length>0?we[we.length-1]:null};function zr(E,O,R,z){if(E.visible===!1)return;if(E.layers.test(O.layers))if(E.isGroup)R=E.renderOrder;else if(E.isLOD)E.autoUpdate===!0&&E.update(O);else if(E.isLight)fe.pushLight(E),E.castShadow&&fe.pushShadow(E);else if(E.isSprite){if(!E.frustumCulled||dt.intersectsSprite(E)){z&&St.setFromMatrixPosition(E.matrixWorld).applyMatrix4(gt);let O=qt.update(E),V=E.material;V.visible&&ue.push(E,O,V,R,St.z,null)}}else if((E.isMesh||E.isLine||E.isPoints)&&(E.isSkinnedMesh&&E.skeleton.frame!==Lt.render.frame&&(E.skeleton.update(),E.skeleton.frame=Lt.render.frame),!E.frustumCulled||dt.intersectsObject(E))){z&&St.setFromMatrixPosition(E.matrixWorld).applyMatrix4(gt);let O=qt.update(E),V=E.material;if(Array.isArray(V)){let z=O.groups;for(let j=0,Y=z.length;j<Y;j++){let Y=z[j],ee=V[Y.materialIndex];ee&&ee.visible&&ue.push(E,O,ee,R,St.z,Y)}}else V.visible&&ue.push(E,O,V,R,St.z,null)}let V=E.children;for(let E=0,j=V.length;E<j;E++)zr(V[E],O,R,z)}function kr(E,O,R,z){let V=E.opaque,j=E.transmissive,Y=E.transparent;fe.setupLightsView(R),ut===!0&&$t.setGlobalState(_e.clippingPlanes,R),j.length>0&&na(V,O,R),z&&It.viewport(Qe.copy(z)),V.length>0&&Pr(V,O,R),j.length>0&&Pr(j,O,R),Y.length>0&&Pr(Y,O,R),It.buffers.depth.setTest(!0),It.buffers.depth.setMask(!0),It.buffers.color.setMask(!0),It.setPolygonOffset(!1)}function na(E,O,R){let z=Tt.isWebGL2;mt===null&&(mt=new Un(1,1,{generateMipmaps:!0,type:Et.has("EXT_color_buffer_half_float")?Oi:wi,minFilter:bi,samples:z&&Y===!0?4:0})),_e.getDrawingBufferSize(yt),z?mt.setSize(yt.x,yt.y):mt.setSize(dy(yt.x),dy(yt.y));let V=_e.getRenderTarget();_e.setRenderTarget(mt),_e.clear();let j=_e.toneMapping;_e.toneMapping=Xt,Pr(E,O,R),_e.toneMapping=j,Ft.updateMultisampleRenderTarget(mt),Ft.updateRenderTargetMipmap(mt),_e.setRenderTarget(V)}function Pr(E,O,R){let z=O.isScene===!0?O.overrideMaterial:null;for(let V=0,j=E.length;V<j;V++){let j=E[V],Y=j.object,ee=j.geometry,se=z===null?j.material:z,he=j.group;Y.layers.test(R.layers)&&rs(Y,O,R,ee,se,he)}}function rs(E,O,R,z,V,j){E.onBeforeRender(_e,O,R,z,V,j),E.modelViewMatrix.multiplyMatrices(R.matrixWorldInverse,E.matrixWorld),E.normalMatrix.getNormalMatrix(E.modelViewMatrix),V.onBeforeRender(_e,O,R,z,E,j),V.transparent===!0&&V.side===Ge&&V.forceSinglePass===!1?(V.side=Ue,V.needsUpdate=!0,_e.renderBufferDirect(R,O,z,V,E,j),V.side=Fe,V.needsUpdate=!0,_e.renderBufferDirect(R,O,z,V,E,j),V.side=Ge):_e.renderBufferDirect(R,O,z,V,E,j),E.onAfterRender(_e,O,R,z,V,j)}function Pn(E,O,R){O.isScene!==!0&&(O=_t);let z=Bt.get(E),V=fe.state.lights,j=fe.state.shadowsArray,Y=V.state.version,ee=Qt.getParameters(E,V.state,j,O,R),se=Qt.getProgramCacheKey(ee),he=z.programs;z.environment=E.isMeshStandardMaterial?O.environment:null,z.fog=O.fog,z.envMap=(E.isMeshStandardMaterial?jt:Ut).get(E.envMap||z.environment),he===void 0&&(E.addEventListener("dispose",fr),he=new Map,z.programs=he);let ce=he.get(se);if(ce!==void 0){if(z.currentProgram===ce&&z.lightsStateVersion===Y)return Jf(E,ee),ce}else ee.uniforms=Qt.getUniforms(E),E.onBuild(R,ee,_e),E.onBeforeCompile(ee,_e),ce=Qt.acquireProgram(ee,se),he.set(se,ce),z.uniforms=ee.uniforms;let ue=z.uniforms;(!E.isShaderMaterial&&!E.isRawShaderMaterial||E.clipping===!0)&&(ue.clippingPlanes=$t.uniform),Jf(E,ee),z.needsLights=b1(E),z.lightsStateVersion=Y,z.needsLights&&(ue.ambientLightColor.value=V.state.ambient,ue.lightProbe.value=V.state.probe,ue.directionalLights.value=V.state.directional,ue.directionalLightShadows.value=V.state.directionalShadow,ue.spotLights.value=V.state.spot,ue.spotLightShadows.value=V.state.spotShadow,ue.rectAreaLights.value=V.state.rectArea,ue.ltc_1.value=V.state.rectAreaLTC1,ue.ltc_2.value=V.state.rectAreaLTC2,ue.pointLights.value=V.state.point,ue.pointLightShadows.value=V.state.pointShadow,ue.hemisphereLights.value=V.state.hemi,ue.directionalShadowMap.value=V.state.directionalShadowMap,ue.directionalShadowMatrix.value=V.state.directionalShadowMatrix,ue.spotShadowMap.value=V.state.spotShadowMap,ue.spotLightMatrix.value=V.state.spotLightMatrix,ue.spotLightMap.value=V.state.spotLightMap,ue.pointShadowMap.value=V.state.pointShadowMap,ue.pointShadowMatrix.value=V.state.pointShadowMatrix);let ve=ce.getUniforms(),we=bd.seqWithValue(ve.seq,ue);return z.currentProgram=ce,z.uniformsList=we,ce}function Jf(E,O){let R=Bt.get(E);R.outputEncoding=O.outputEncoding,R.instancing=O.instancing,R.skinning=O.skinning,R.morphTargets=O.morphTargets,R.morphNormals=O.morphNormals,R.morphColors=O.morphColors,R.morphTargetsCount=O.morphTargetsCount,R.numClippingPlanes=O.numClippingPlanes,R.numIntersection=O.numClipIntersection,R.vertexAlphas=O.vertexAlphas,R.vertexTangents=O.vertexTangents,R.toneMapping=O.toneMapping}function v1(E,O,R,z,V){O.isScene!==!0&&(O=_t),Ft.resetTextureUnits();let j=O.fog,Y=z.isMeshStandardMaterial?O.environment:null,ee=Ie===null?_e.outputEncoding:Ie.isXRRenderTarget===!0?Ie.texture.encoding:Xr,se=(z.isMeshStandardMaterial?jt:Ut).get(z.envMap||Y),he=z.vertexColors===!0&&!!R.attributes.color&&R.attributes.color.itemSize===4,ce=!!z.normalMap&&!!R.attributes.tangent,ue=!!R.morphAttributes.position,ve=!!R.morphAttributes.normal,we=!!R.morphAttributes.color,Se=z.toneMapped?_e.toneMapping:Xt,Ae=R.morphAttributes.position||R.morphAttributes.normal||R.morphAttributes.color,Ce=Ae!==void 0?Ae.length:0,Te=Bt.get(z),Fe=fe.state.lights;if(ut===!0&&(pt===!0||E!==Xe)){let O=E===Xe&&z.id===qe;$t.setState(z,E,O)}let Ue=!1;z.version===Te.__version?(Te.needsLights&&Te.lightsStateVersion!==Fe.state.version||Te.outputEncoding!==ee||V.isInstancedMesh&&Te.instancing===!1||!V.isInstancedMesh&&Te.instancing===!0||V.isSkinnedMesh&&Te.skinning===!1||!V.isSkinnedMesh&&Te.skinning===!0||Te.envMap!==se||z.fog===!0&&Te.fog!==j||Te.numClippingPlanes!==void 0&&(Te.numClippingPlanes!==$t.numPlanes||Te.numIntersection!==$t.numIntersection)||Te.vertexAlphas!==he||Te.vertexTangents!==ce||Te.morphTargets!==ue||Te.morphNormals!==ve||Te.morphColors!==we||Te.toneMapping!==Se||Tt.isWebGL2===!0&&Te.morphTargetsCount!==Ce)&&(Ue=!0):(Ue=!0,Te.__version=z.version);let Ge=Te.currentProgram;Ue===!0&&(Ge=Pn(z,O,V));let Qe=!1,Ze=!1,Ke=!1,Je=Ge.getUniforms(),it=Te.uniforms;if(It.useProgram(Ge.program)&&(Qe=!0,Ze=!0,Ke=!0),z.id!==qe&&(qe=z.id,Ze=!0),Qe||Xe!==E){if(Je.setValue(Mt,"projectionMatrix",E.projectionMatrix),Tt.logarithmicDepthBuffer&&Je.setValue(Mt,"logDepthBufFC",2/(Math.log(E.far+1)/Math.LN2)),Xe!==E&&(Xe=E,Ze=!0,Ke=!0),z.isShaderMaterial||z.isMeshPhongMaterial||z.isMeshToonMaterial||z.isMeshStandardMaterial||z.envMap){let O=Je.map.cameraPosition;O!==void 0&&O.setValue(Mt,St.setFromMatrixPosition(E.matrixWorld))}(z.isMeshPhongMaterial||z.isMeshToonMaterial||z.isMeshLambertMaterial||z.isMeshBasicMaterial||z.isMeshStandardMaterial||z.isShaderMaterial)&&Je.setValue(Mt,"isOrthographic",E.isOrthographicCamera===!0),(z.isMeshPhongMaterial||z.isMeshToonMaterial||z.isMeshLambertMaterial||z.isMeshBasicMaterial||z.isMeshStandardMaterial||z.isShaderMaterial||z.isShadowMaterial||V.isSkinnedMesh)&&Je.setValue(Mt,"viewMatrix",E.matrixWorldInverse)}if(V.isSkinnedMesh){Je.setOptional(Mt,V,"bindMatrix"),Je.setOptional(Mt,V,"bindMatrixInverse");let E=V.skeleton;E&&(Tt.floatVertexTextures?(E.boneTexture===null&&E.computeBoneTexture(),Je.setValue(Mt,"boneTexture",E.boneTexture,Ft),Je.setValue(Mt,"boneTextureSize",E.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}let rt=R.morphAttributes;if((rt.position!==void 0||rt.normal!==void 0||rt.color!==void 0&&Tt.isWebGL2===!0)&&ri.update(V,R,z,Ge),(Ze||Te.receiveShadow!==V.receiveShadow)&&(Te.receiveShadow=V.receiveShadow,Je.setValue(Mt,"receiveShadow",V.receiveShadow)),z.isMeshGouraudMaterial&&z.envMap!==null&&(it.envMap.value=se,it.flipEnvMap.value=se.isCubeTexture&&se.isRenderTargetTexture===!1?-1:1),Ze&&(Je.setValue(Mt,"toneMappingExposure",_e.toneMappingExposure),Te.needsLights&&x1(it,Ke),j&&z.fog===!0&&Zt.refreshFogUniforms(it,j),Zt.refreshMaterialUniforms(it,z,et,$e,mt),bd.upload(Mt,Te.uniformsList,it,Ft)),z.isShaderMaterial&&z.uniformsNeedUpdate===!0&&(bd.upload(Mt,Te.uniformsList,it,Ft),z.uniformsNeedUpdate=!1),z.isSpriteMaterial&&Je.setValue(Mt,"center",V.center),Je.setValue(Mt,"modelViewMatrix",V.modelViewMatrix),Je.setValue(Mt,"normalMatrix",V.normalMatrix),Je.setValue(Mt,"modelMatrix",V.matrixWorld),V.previousModelViewMatrix&&Je.setValue(Mt,"previousModelViewMatrix",V.previousModelViewMatrix),E.previousProjectionMatrix&&Je.setValue(Mt,"previousProjectionMatrix",E.previousProjectionMatrix),z.isShaderMaterial||z.isRawShaderMaterial){let E=z.uniformsGroups;for(let O=0,R=E.length;O<R;O++)if(Tt.isWebGL2){let R=E[O];ui.update(R,Ge),ui.bind(R,Ge)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return Ge}function x1(E,O){E.ambientLightColor.needsUpdate=O,E.lightProbe.needsUpdate=O,E.directionalLights.needsUpdate=O,E.directionalLightShadows.needsUpdate=O,E.pointLights.needsUpdate=O,E.pointLightShadows.needsUpdate=O,E.spotLights.needsUpdate=O,E.spotLightShadows.needsUpdate=O,E.rectAreaLights.needsUpdate=O,E.hemisphereLights.needsUpdate=O}function b1(E){return E.isMeshLambertMaterial||E.isMeshToonMaterial||E.isMeshPhongMaterial||E.isMeshStandardMaterial||E.isShadowMaterial||E.isShaderMaterial&&E.lights===!0}this.getActiveCubeFace=function(){return Ce},this.getActiveMipmapLevel=function(){return Te},this.getRenderTarget=function(){return Ie},this.setRenderTargetTextures=function(E,O,R){Bt.get(E.texture).__webglTexture=O,Bt.get(E.depthTexture).__webglTexture=R;let z=Bt.get(E);z.__hasExternalTextures=!0,z.__hasExternalTextures&&(z.__autoAllocateDepthBuffer=R===void 0,z.__autoAllocateDepthBuffer||Et.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),z.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(E,O){let R=Bt.get(E);R.__webglFramebuffer=O,R.__useDefaultFramebuffer=O===void 0},this.setRenderTarget=function(E,O=0,R=0){Ie=E,Ce=O,Te=R;let z=!0,V=null,j=!1,Y=!1;if(E){let R=Bt.get(E);R.__useDefaultFramebuffer!==void 0?(It.bindFramebuffer(36160,null),z=!1):R.__webglFramebuffer===void 0?Ft.setupRenderTarget(E):R.__hasExternalTextures&&Ft.rebindTextures(E,Bt.get(E.texture).__webglTexture,Bt.get(E.depthTexture).__webglTexture);let ee=E.texture;(ee.isData3DTexture||ee.isDataArrayTexture||ee.isCompressedArrayTexture)&&(Y=!0);let se=Bt.get(E).__webglFramebuffer;E.isWebGLCubeRenderTarget?(V=se[O],j=!0):V=Tt.isWebGL2&&E.samples>0&&Ft.useMultisampledRTT(E)===!1?Bt.get(E).__webglMultisampledFramebuffer:se,Qe.copy(E.viewport),Ze.copy(E.scissor),Ke=E.scissorTest}else Qe.copy(at).multiplyScalar(et).floor(),Ze.copy(lt).multiplyScalar(et).floor(),Ke=ct;if(It.bindFramebuffer(36160,V)&&Tt.drawBuffers&&z&&It.drawBuffers(E,V),It.viewport(Qe),It.scissor(Ze),It.setScissorTest(Ke),j){let z=Bt.get(E.texture);Mt.framebufferTexture2D(36160,36064,34069+O,z.__webglTexture,R)}else if(Y){let z=Bt.get(E.texture),V=O||0;Mt.framebufferTextureLayer(36160,36064,z.__webglTexture,R||0,V)}qe=-1},this.readRenderTargetPixels=function(E,O,R,z,V,j,Y){if(!(E&&E.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let ee=Bt.get(E).__webglFramebuffer;if(E.isWebGLCubeRenderTarget&&Y!==void 0&&(ee=ee[Y]),ee){It.bindFramebuffer(36160,ee);try{let Y=E.texture,ee=Y.format,se=Y.type;if(ee!==Ni&&ai.convert(ee)!==Mt.getParameter(35739)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}let he=se===Oi&&(Et.has("EXT_color_buffer_half_float")||Tt.isWebGL2&&Et.has("EXT_color_buffer_float"));if(se!==wi&&ai.convert(se)!==Mt.getParameter(35738)&&!(se===Ii&&(Tt.isWebGL2||Et.has("OES_texture_float")||Et.has("WEBGL_color_buffer_float")))&&!he){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}O>=0&&O<=E.width-z&&R>=0&&R<=E.height-V&&Mt.readPixels(O,R,z,V,ai.convert(ee),ai.convert(se),j)}finally{let E=Ie!==null?Bt.get(Ie).__webglFramebuffer:null;It.bindFramebuffer(36160,E)}}},this.readRenderTargetPixelsAsync=async function(E,O,R,z,V,j,Y){if(!(E&&E.isWebGLRenderTarget))throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let ee=Bt.get(E).__webglFramebuffer;if(E.isWebGLCubeRenderTarget&&Y!==void 0&&(ee=ee[Y]),ee){let Y=E.texture,se=Y.format,he=Y.type;if(O>=0&&O<=E.width-z&&R>=0&&R<=E.height-V){It.bindFramebuffer(Mt.FRAMEBUFFER,ee);let E=Mt.createBuffer();Mt.bindBuffer(Mt.PIXEL_PACK_BUFFER,E),Mt.bufferData(Mt.PIXEL_PACK_BUFFER,j.byteLength,Mt.STREAM_READ),Mt.readPixels(O,R,z,V,ai.convert(se),ai.convert(he),0);let Y=Ie!==null?Bt.get(Ie).__webglFramebuffer:null;It.bindFramebuffer(Mt.FRAMEBUFFER,Y);let ce=Mt.fenceSync(Mt.SYNC_GPU_COMMANDS_COMPLETE,0);return Mt.flush(),await HV(Mt,ce,4),Mt.bindBuffer(Mt.PIXEL_PACK_BUFFER,E),Mt.getBufferSubData(Mt.PIXEL_PACK_BUFFER,0,j),Mt.deleteBuffer(E),Mt.deleteSync(ce),j}throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.")}},this.copyFramebufferToTexture=function(E,O,R=0){let z=Math.pow(2,-R),V=Math.floor(O.image.width*z),j=Math.floor(O.image.height*z);Ft.setTexture2D(O,0),Mt.copyTexSubImage2D(3553,R,0,0,E.x,E.y,V,j),It.unbindTexture()},this.copyTextureToTexture=function(E,O,R,z=0){let V=O.image.width,j=O.image.height,Y=ai.convert(R.format),ee=ai.convert(R.type);Ft.setTexture2D(R,0),Mt.pixelStorei(37440,R.flipY),Mt.pixelStorei(37441,R.premultiplyAlpha),Mt.pixelStorei(3317,R.unpackAlignment),O.isDataTexture?Mt.texSubImage2D(3553,z,E.x,E.y,V,j,Y,ee,O.image.data):O.isCompressedTexture?Mt.compressedTexSubImage2D(3553,z,E.x,E.y,O.mipmaps[0].width,O.mipmaps[0].height,Y,O.mipmaps[0].data):Mt.texSubImage2D(3553,z,E.x,E.y,Y,ee,O.image),z===0&&R.generateMipmaps&&Mt.generateMipmap(3553),It.unbindTexture()},this.copyTextureToTexture3D=function(E,O,R,z,V=0){if(_e.isWebGL1Renderer){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");return}let j,Y=E.max.x-E.min.x+1,ee=E.max.y-E.min.y+1,se=E.max.z-E.min.z+1,he=ai.convert(z.format),ce=ai.convert(z.type);if(z.isData3DTexture)Ft.setTexture3D(z,0),j=32879;else{if(!z.isDataArrayTexture){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}Ft.setTexture2DArray(z,0),j=35866}Mt.pixelStorei(37440,z.flipY),Mt.pixelStorei(37441,z.premultiplyAlpha),Mt.pixelStorei(3317,z.unpackAlignment);let ue=Mt.getParameter(3314),fe=Mt.getParameter(32878),ve=Mt.getParameter(3316),we=Mt.getParameter(3315),Se=Mt.getParameter(32877),Ae=R.isCompressedTexture?R.mipmaps[0]:R.image;Mt.pixelStorei(3314,Ae.width),Mt.pixelStorei(32878,Ae.height),Mt.pixelStorei(3316,E.min.x),Mt.pixelStorei(3315,E.min.y),Mt.pixelStorei(32877,E.min.z),R.isDataTexture||R.isData3DTexture?Mt.texSubImage3D(j,V,O.x,O.y,O.z,Y,ee,se,he,ce,Ae.data):R.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),Mt.compressedTexSubImage3D(j,V,O.x,O.y,O.z,Y,ee,se,he,Ae.data)):Mt.texSubImage3D(j,V,O.x,O.y,O.z,Y,ee,se,he,ce,Ae),Mt.pixelStorei(3314,ue),Mt.pixelStorei(32878,fe),Mt.pixelStorei(3316,ve),Mt.pixelStorei(3315,we),Mt.pixelStorei(32877,Se),V===0&&z.generateMipmaps&&Mt.generateMipmap(j),It.unbindTexture()},this.initRenderTarget=function(E){Bt.get(E).__webglFramebuffer===void 0&&Ft.setupRenderTarget(E)},this.initTexture=function(E){E.isCubeTexture?Ft.setTextureCube(E,0):E.isData3DTexture?Ft.setTexture3D(E,0):E.isDataArrayTexture||E.isCompressedArrayTexture?Ft.setTexture2DArray(E,0):Ft.setTexture2D(E,0),It.unbindTexture()},this.resetState=function(){Ce=0,Te=0,Ie=null,It.reset(),oi.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}var Gd=class extends QS{};Gd.prototype.isWebGL1Renderer=!0;var Hd=class{constructor(E,O=1,R=1e3){this.isFog=!0,this.name="",this.color=new On(E),this.near=O,this.far=R}clone(){return new Hd(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}},Wd=class extends ra{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(E,O){return super.copy(E,O),E.background!==null&&(this.background=E.background.clone()),E.environment!==null&&(this.environment=E.environment.clone()),E.fog!==null&&(this.fog=E.fog.clone()),this.backgroundBlurriness=E.backgroundBlurriness,this.backgroundIntensity=E.backgroundIntensity,E.overrideMaterial!==null&&(this.overrideMaterial=E.overrideMaterial.clone()),this.matrixAutoUpdate=E.matrixAutoUpdate,this}toJSON(E){let O=super.toJSON(E);return this.fog!==null&&(O.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(O.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(O.object.backgroundIntensity=this.backgroundIntensity),O}get autoUpdate(){return console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate}set autoUpdate(E){console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate=E}},qd=class{constructor(E,O){this.isInterleavedBuffer=!0,this.array=E,this.stride=O,this.count=E!==void 0?E.length/O:0,this.usage=on,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=ss()}onUploadCallback(){}set needsUpdate(E){E===!0&&this.version++}setUsage(E){return this.usage=E,this}copy(E){return this.array=new E.array.constructor(E.array),this.count=E.count,this.stride=E.stride,this.usage=E.usage,this}copyAt(E,O,R){E*=this.stride,R*=O.stride;for(let z=0,V=this.stride;z<V;z++)this.array[E+z]=O.array[R+z];return this}set(E,O=0){return this.array.set(E,O),this}clone(E){E.arrayBuffers===void 0&&(E.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=ss()),E.arrayBuffers[this.array.buffer._uuid]===void 0&&(E.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);let O=new this.array.constructor(E.arrayBuffers[this.array.buffer._uuid]),R=new this.constructor(O,this.stride);return R.setUsage(this.usage),R}onUpload(E){return this.onUploadCallback=E,this}toJSON(E){return E.arrayBuffers===void 0&&(E.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=ss()),E.arrayBuffers[this.array.buffer._uuid]===void 0&&(E.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}},Xd=new Wn,Yd=class{constructor(E,O,R,z=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=E,this.itemSize=O,this.offset=R,this.normalized=z}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(E){this.data.needsUpdate=E}applyMatrix4(E){for(let O=0,R=this.data.count;O<R;O++)Xd.fromBufferAttribute(this,O),Xd.applyMatrix4(E),this.setXYZ(O,Xd.x,Xd.y,Xd.z);return this}applyNormalMatrix(E){for(let O=0,R=this.count;O<R;O++)Xd.fromBufferAttribute(this,O),Xd.applyNormalMatrix(E),this.setXYZ(O,Xd.x,Xd.y,Xd.z);return this}transformDirection(E){for(let O=0,R=this.count;O<R;O++)Xd.fromBufferAttribute(this,O),Xd.transformDirection(E),this.setXYZ(O,Xd.x,Xd.y,Xd.z);return this}setX(E,O){return this.normalized&&(O=Sr(O,this.array)),this.data.array[E*this.data.stride+this.offset]=O,this}setY(E,O){return this.normalized&&(O=Sr(O,this.array)),this.data.array[E*this.data.stride+this.offset+1]=O,this}setZ(E,O){return this.normalized&&(O=Sr(O,this.array)),this.data.array[E*this.data.stride+this.offset+2]=O,this}setW(E,O){return this.normalized&&(O=Sr(O,this.array)),this.data.array[E*this.data.stride+this.offset+3]=O,this}getX(E){let O=this.data.array[E*this.data.stride+this.offset];return this.normalized&&(O=da(O,this.array)),O}getY(E){let O=this.data.array[E*this.data.stride+this.offset+1];return this.normalized&&(O=da(O,this.array)),O}getZ(E){let O=this.data.array[E*this.data.stride+this.offset+2];return this.normalized&&(O=da(O,this.array)),O}getW(E){let O=this.data.array[E*this.data.stride+this.offset+3];return this.normalized&&(O=da(O,this.array)),O}setXY(E,O,R){return E=E*this.data.stride+this.offset,this.normalized&&(O=Sr(O,this.array),R=Sr(R,this.array)),this.data.array[E+0]=O,this.data.array[E+1]=R,this}setXYZ(E,O,R,z){return E=E*this.data.stride+this.offset,this.normalized&&(O=Sr(O,this.array),R=Sr(R,this.array),z=Sr(z,this.array)),this.data.array[E+0]=O,this.data.array[E+1]=R,this.data.array[E+2]=z,this}setXYZW(E,O,R,z,V){return E=E*this.data.stride+this.offset,this.normalized&&(O=Sr(O,this.array),R=Sr(R,this.array),z=Sr(z,this.array),V=Sr(V,this.array)),this.data.array[E+0]=O,this.data.array[E+1]=R,this.data.array[E+2]=z,this.data.array[E+3]=V,this}clone(E){if(E===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");let E=[];for(let O=0;O<this.count;O++){let R=O*this.data.stride+this.offset;for(let O=0;O<this.itemSize;O++)E.push(this.data.array[R+O])}return new Sa(new this.array.constructor(E),this.itemSize,this.normalized)}return E.interleavedBuffers===void 0&&(E.interleavedBuffers={}),E.interleavedBuffers[this.data.uuid]===void 0&&(E.interleavedBuffers[this.data.uuid]=this.data.clone(E)),new Yd(E.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(E){if(E===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");let E=[];for(let O=0;O<this.count;O++){let R=O*this.data.stride+this.offset;for(let O=0;O<this.itemSize;O++)E.push(this.data.array[R+O])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:E,normalized:this.normalized}}return E.interleavedBuffers===void 0&&(E.interleavedBuffers={}),E.interleavedBuffers[this.data.uuid]===void 0&&(E.interleavedBuffers[this.data.uuid]=this.data.toJSON(E)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}};var Qd=class extends ra{constructor(){super(),this.isBone=!0,this.type="Bone"}},Zd=class extends Fn{constructor(E=null,O=1,R=1,z,V,j,Y,ee,se=mi,he=mi,ce,ue){super(null,j,Y,ee,se,he,z,V,ce,ue),this.isDataTexture=!0,this.image={data:E,width:O,height:R},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}},Kd=new Es,Jd=new Es,$d=class{constructor(E=[],O=[]){this.uuid=ss(),this.bones=E.slice(0),this.boneInverses=O,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){let E=this.bones,O=this.boneInverses;if(this.boneMatrices=new Float32Array(E.length*16),O.length===0)this.calculateInverses();else if(E.length!==O.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let E=0,O=this.bones.length;E<O;E++)this.boneInverses.push(new Es)}}calculateInverses(){this.boneInverses.length=0;for(let E=0,O=this.bones.length;E<O;E++){let O=new Es;this.bones[E]&&O.copy(this.bones[E].matrixWorld).invert(),this.boneInverses.push(O)}}pose(){for(let E=0,O=this.bones.length;E<O;E++){let O=this.bones[E];O&&O.matrixWorld.copy(this.boneInverses[E]).invert()}for(let E=0,O=this.bones.length;E<O;E++){let O=this.bones[E];O&&(O.parent&&O.parent.isBone?(O.matrix.copy(O.parent.matrixWorld).invert(),O.matrix.multiply(O.matrixWorld)):O.matrix.copy(O.matrixWorld),O.matrix.decompose(O.position,O.quaternion,O.scale))}}update(){let E=this.bones,O=this.boneInverses,R=this.boneMatrices,z=this.boneTexture;for(let z=0,V=E.length;z<V;z++){let V=E[z]?E[z].matrixWorld:Jd;Kd.multiplyMatrices(V,O[z]),Kd.toArray(R,z*16)}z!==null&&(z.needsUpdate=!0)}clone(){return new $d(this.bones,this.boneInverses)}computeBoneTexture(){let E=Math.sqrt(this.bones.length*4);E=vP(E),E=Math.max(E,4);let O=new Float32Array(E*E*4);O.set(this.boneMatrices);let R=new Zd(O,E,E,Ni,Ii);return R.needsUpdate=!0,this.boneMatrices=O,this.boneTexture=R,this.boneTextureSize=E,this}getBoneByName(E){for(let O=0,R=this.bones.length;O<R;O++){let R=this.bones[O];if(R.name===E)return R}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(E,O){this.uuid=E.uuid;for(let R=0,z=E.bones.length;R<z;R++){let z=E.bones[R],V=O[z];V===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",z),V=new Qd),this.bones.push(V),this.boneInverses.push((new Es).fromArray(E.boneInverses[R]))}return this.init(),this}toJSON(){let E={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};E.uuid=this.uuid;let O=this.bones,R=this.boneInverses;for(let z=0,V=O.length;z<V;z++){let V=O[z];E.bones.push(V.uuid);let j=R[z];E.boneInverses.push(j.toArray())}return E}},eu=class extends Sa{constructor(E,O,R,z=1){super(E,O,R),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=z}copy(E){return super.copy(E),this.meshPerAttribute=E.meshPerAttribute,this}toJSON(){let E=super.toJSON();return E.meshPerAttribute=this.meshPerAttribute,E.isInstancedBufferAttribute=!0,E}},iu=new Es,ru=new Es,nu=[],su=new Es,au=new eo,ou=class extends eo{constructor(E,O,R){super(E,O),this.isInstancedMesh=!0,this.instanceMatrix=new eu(new Float32Array(R*16),16),this.instanceColor=null,this.count=R,this.frustumCulled=!1;for(let E=0;E<R;E++)this.setMatrixAt(E,su)}copy(E,O){return super.copy(E,O),this.instanceMatrix.copy(E.instanceMatrix),E.instanceColor!==null&&(this.instanceColor=E.instanceColor.clone()),this.count=E.count,this}getColorAt(E,O){O.fromArray(this.instanceColor.array,E*3)}getMatrixAt(E,O){O.fromArray(this.instanceMatrix.array,E*16)}raycast(E,O){let R=this.matrixWorld,z=this.count;if(au.geometry=this.geometry,au.material=this.material,au.material!==void 0)for(let V=0;V<z;V++){this.getMatrixAt(V,iu),ru.multiplyMatrices(R,iu),au.matrixWorld=ru,au.raycast(E,nu);for(let E=0,R=nu.length;E<R;E++){let R=nu[E];R.instanceId=V,R.object=this,O.push(R)}nu.length=0}}setColorAt(E,O){this.instanceColor===null&&(this.instanceColor=new eu(new Float32Array(this.instanceMatrix.count*3),3)),O.toArray(this.instanceColor.array,E*3)}setMatrixAt(E,O){O.toArray(this.instanceMatrix.array,E*16)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}},cu=class extends ya{constructor(E){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new On(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(E)}copy(E){return super.copy(E),this.color.copy(E.color),this.linewidth=E.linewidth,this.linecap=E.linecap,this.linejoin=E.linejoin,this.fog=E.fog,this}},du=new Wn,uu=new Wn,pu=new Es,fu=new Ms,mu=new ps,gu=class extends ra{constructor(E=new Na,O=new cu){super(),this.isLine=!0,this.type="Line",this.geometry=E,this.material=O,this.updateMorphTargets()}copy(E,O){return super.copy(E,O),this.material=E.material,this.geometry=E.geometry,this}computeLineDistances(){let E=this.geometry;if(E.index===null){let O=E.attributes.position,R=[0];for(let E=1,z=O.count;E<z;E++)du.fromBufferAttribute(O,E-1),uu.fromBufferAttribute(O,E),R[E]=R[E-1],R[E]+=du.distanceTo(uu);E.setAttribute("lineDistance",new Ma(R,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(E,O){let R=this.geometry,z=this.matrixWorld,V=E.params.Line.threshold,j=R.drawRange;if(R.boundingSphere===null&&R.computeBoundingSphere(),mu.copy(R.boundingSphere),mu.applyMatrix4(z),mu.radius+=V,E.ray.intersectsSphere(mu)===!1)return;pu.copy(z).invert(),fu.copy(E.ray).applyMatrix4(pu);let Y=V/((this.scale.x+this.scale.y+this.scale.z)/3),ee=Y*Y,se=new Wn,he=new Wn,ce=new Wn,ue=new Wn,fe=this.isLineSegments?2:1,ve=R.index,we=R.attributes.position;if(ve!==null){let R=Math.max(0,j.start),z=Math.min(ve.count,j.start+j.count);for(let V=R,j=z-1;V<j;V+=fe){let R=ve.getX(V),z=ve.getX(V+1);if(se.fromBufferAttribute(we,R),he.fromBufferAttribute(we,z),fu.distanceSqToSegment(se,he,ue,ce)>ee)continue;ue.applyMatrix4(this.matrixWorld);let j=E.ray.origin.distanceTo(ue);j<E.near||j>E.far||O.push({distance:j,point:ce.clone().applyMatrix4(this.matrixWorld),index:V,face:null,faceIndex:null,object:this})}}else{let R=Math.max(0,j.start),z=Math.min(we.count,j.start+j.count);for(let V=R,j=z-1;V<j;V+=fe){if(se.fromBufferAttribute(we,V),he.fromBufferAttribute(we,V+1),fu.distanceSqToSegment(se,he,ue,ce)>ee)continue;ue.applyMatrix4(this.matrixWorld);let R=E.ray.origin.distanceTo(ue);R<E.near||R>E.far||O.push({distance:R,point:ce.clone().applyMatrix4(this.matrixWorld),index:V,face:null,faceIndex:null,object:this})}}}updateMorphTargets(){let E=this.geometry.morphAttributes,O=Object.keys(E);if(O.length>0){let R=E[O[0]];if(R!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let E=0,O=R.length;E<O;E++){let O=R[E].name||String(E);this.morphTargetInfluences.push(0),this.morphTargetDictionary[O]=E}}}}},xu=new Wn,bu=new Wn,wu=class extends gu{constructor(E,O){super(E,O),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){let E=this.geometry;if(E.index===null){let O=E.attributes.position,R=[];for(let E=0,z=O.count;E<z;E+=2)xu.fromBufferAttribute(O,E),bu.fromBufferAttribute(O,E+1),R[E]=E===0?0:R[E-1],R[E+1]=R[E]+xu.distanceTo(bu);E.setAttribute("lineDistance",new Ma(R,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}};var Su=class extends Fn{constructor(E,O,R,z,V,j,Y,ee,se){super(E,O,R,z,V,j,Y,ee,se),this.isVideoTexture=!0,this.minFilter=j!==void 0?j:yi,this.magFilter=V!==void 0?V:yi,this.generateMipmaps=!1;let he=this;function h(){he.needsUpdate=!0,E.requestVideoFrameCallback(h)}"requestVideoFrameCallback"in E&&E.requestVideoFrameCallback(h)}clone(){return new this.constructor(this.image).copy(this)}update(){let E=this.image;"requestVideoFrameCallback"in E===!1&&E.readyState>=E.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}};var _u=class extends Fn{constructor(E,O,R,z,V,j,Y,ee,se){super(E,O,R,z,V,j,Y,ee,se),this.isCanvasTexture=!0,this.needsUpdate=!0}},Au=class{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(E,O){let R=this.getUtoTmapping(E);return this.getPoint(R,O)}getPoints(E=5){let O=[];for(let R=0;R<=E;R++)O.push(this.getPoint(R/E));return O}getSpacedPoints(E=5){let O=[];for(let R=0;R<=E;R++)O.push(this.getPointAt(R/E));return O}getLength(){let E=this.getLengths();return E[E.length-1]}getLengths(E=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===E+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;let O,R=[],z=this.getPoint(0),V=0;R.push(0);for(let j=1;j<=E;j++)O=this.getPoint(j/E),V+=O.distanceTo(z),R.push(V),z=O;return this.cacheArcLengths=R,R}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(E,O){let R,z=this.getLengths(),V=0,j=z.length;R=O||E*z[j-1];let Y,ee=0,se=j-1;for(;ee<=se;)if(V=Math.floor(ee+(se-ee)/2),Y=z[V]-R,Y<0)ee=V+1;else{if(!(Y>0)){se=V;break}se=V-1}if(V=se,z[V]===R)return V/(j-1);let he=z[V],ce=z[V+1]-he,ue=(R-he)/ce;return(V+ue)/(j-1)}getTangent(E,O){let R=E-1e-4,z=E+1e-4;R<0&&(R=0),z>1&&(z=1);let V=this.getPoint(R),j=this.getPoint(z),Y=O||(V.isVector2?new bn:new Wn);return Y.copy(j).sub(V).normalize(),Y}getTangentAt(E,O){let R=this.getUtoTmapping(E);return this.getTangent(R,O)}computeFrenetFrames(E,O){let R=new Wn,z=[],V=[],j=[],Y=new Wn,ee=new Es;for(let O=0;O<=E;O++){let R=O/E;z[O]=this.getTangentAt(R,new Wn)}V[0]=new Wn,j[0]=new Wn;let se=Number.MAX_VALUE,he=Math.abs(z[0].x),ce=Math.abs(z[0].y),ue=Math.abs(z[0].z);he<=se&&(se=he,R.set(1,0,0)),ce<=se&&(se=ce,R.set(0,1,0)),ue<=se&&R.set(0,0,1),Y.crossVectors(z[0],R).normalize(),V[0].crossVectors(z[0],Y),j[0].crossVectors(z[0],V[0]);for(let O=1;O<=E;O++){if(V[O]=V[O-1].clone(),j[O]=j[O-1].clone(),Y.crossVectors(z[O-1],z[O]),Y.length()>Number.EPSILON){Y.normalize();let E=Math.acos(pi(z[O-1].dot(z[O]),-1,1));V[O].applyMatrix4(ee.makeRotationAxis(Y,E))}j[O].crossVectors(z[O],V[O])}if(O===!0){let O=Math.acos(pi(V[0].dot(V[E]),-1,1));O/=E,z[0].dot(Y.crossVectors(V[0],V[E]))>0&&(O=-O);for(let R=1;R<=E;R++)V[R].applyMatrix4(ee.makeRotationAxis(z[R],O*R)),j[R].crossVectors(z[R],V[R])}return{tangents:z,normals:V,binormals:j}}clone(){return(new this.constructor).copy(this)}copy(E){return this.arcLengthDivisions=E.arcLengthDivisions,this}toJSON(){let E={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return E.arcLengthDivisions=this.arcLengthDivisions,E.type=this.type,E}fromJSON(E){return this.arcLengthDivisions=E.arcLengthDivisions,this}},Mu=class extends Au{constructor(E=0,O=0,R=1,z=1,V=0,j=Math.PI*2,Y=!1,ee=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=E,this.aY=O,this.xRadius=R,this.yRadius=z,this.aStartAngle=V,this.aEndAngle=j,this.aClockwise=Y,this.aRotation=ee}getPoint(E,O){let R=O||new bn,z=Math.PI*2,V=this.aEndAngle-this.aStartAngle,j=Math.abs(V)<Number.EPSILON;for(;V<0;)V+=z;for(;V>z;)V-=z;V<Number.EPSILON&&(V=j?0:z),this.aClockwise===!0&&!j&&(V===z?V=-z:V-=z);let Y=this.aStartAngle+E*V,ee=this.aX+this.xRadius*Math.cos(Y),se=this.aY+this.yRadius*Math.sin(Y);if(this.aRotation!==0){let E=Math.cos(this.aRotation),O=Math.sin(this.aRotation),R=ee-this.aX,z=se-this.aY;ee=R*E-z*O+this.aX,se=R*O+z*E+this.aY}return R.set(ee,se)}copy(E){return super.copy(E),this.aX=E.aX,this.aY=E.aY,this.xRadius=E.xRadius,this.yRadius=E.yRadius,this.aStartAngle=E.aStartAngle,this.aEndAngle=E.aEndAngle,this.aClockwise=E.aClockwise,this.aRotation=E.aRotation,this}toJSON(){let E=super.toJSON();return E.aX=this.aX,E.aY=this.aY,E.xRadius=this.xRadius,E.yRadius=this.yRadius,E.aStartAngle=this.aStartAngle,E.aEndAngle=this.aEndAngle,E.aClockwise=this.aClockwise,E.aRotation=this.aRotation,E}fromJSON(E){return super.fromJSON(E),this.aX=E.aX,this.aY=E.aY,this.xRadius=E.xRadius,this.yRadius=E.yRadius,this.aStartAngle=E.aStartAngle,this.aEndAngle=E.aEndAngle,this.aClockwise=E.aClockwise,this.aRotation=E.aRotation,this}},Eu=class extends Mu{constructor(E,O,R,z,V,j){super(E,O,R,R,z,V,j),this.isArcCurve=!0,this.type="ArcCurve"}};function ZS(){let E=0,O=0,R=0,z=0;function i(V,j,Y,ee){E=V,O=Y,R=-3*V+3*j-2*Y-ee,z=2*V-2*j+Y+ee}return{initCatmullRom:function(E,O,R,z,V){i(O,R,V*(R-E),V*(z-O))},initNonuniformCatmullRom:function(E,O,R,z,V,j,Y){let ee=(O-E)/V-(R-E)/(V+j)+(R-O)/j,se=(R-O)/j-(z-O)/(j+Y)+(z-R)/Y;ee*=j,se*=j,i(O,R,ee,se)},calc:function(V){let j=V*V,Y=j*V;return E+O*V+R*j+z*Y}}}var Cu=new Wn,Tu=new ZS,Pu=new ZS,Du=new ZS,Iu=class extends Au{constructor(E=[],O=!1,R="centripetal",z=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=E,this.closed=O,this.curveType=R,this.tension=z}getPoint(E,O=new Wn){let R=O,z=this.points,V=z.length,j=(V-(this.closed?0:1))*E,Y=Math.floor(j),ee=j-Y;this.closed?Y+=Y>0?0:(Math.floor(Math.abs(Y)/V)+1)*V:ee===0&&Y===V-1&&(Y=V-2,ee=1);let se,he;this.closed||Y>0?se=z[(Y-1)%V]:(Cu.subVectors(z[0],z[1]).add(z[0]),se=Cu);let ce=z[Y%V],ue=z[(Y+1)%V];if(this.closed||Y+2<V?he=z[(Y+2)%V]:(Cu.subVectors(z[V-1],z[V-2]).add(z[V-1]),he=Cu),this.curveType==="centripetal"||this.curveType==="chordal"){let E=this.curveType==="chordal"?.5:.25,O=Math.pow(se.distanceToSquared(ce),E),R=Math.pow(ce.distanceToSquared(ue),E),z=Math.pow(ue.distanceToSquared(he),E);R<1e-4&&(R=1),O<1e-4&&(O=R),z<1e-4&&(z=R),Tu.initNonuniformCatmullRom(se.x,ce.x,ue.x,he.x,O,R,z),Pu.initNonuniformCatmullRom(se.y,ce.y,ue.y,he.y,O,R,z),Du.initNonuniformCatmullRom(se.z,ce.z,ue.z,he.z,O,R,z)}else this.curveType==="catmullrom"&&(Tu.initCatmullRom(se.x,ce.x,ue.x,he.x,this.tension),Pu.initCatmullRom(se.y,ce.y,ue.y,he.y,this.tension),Du.initCatmullRom(se.z,ce.z,ue.z,he.z,this.tension));return R.set(Tu.calc(ee),Pu.calc(ee),Du.calc(ee)),R}copy(E){super.copy(E),this.points=[];for(let O=0,R=E.points.length;O<R;O++){let R=E.points[O];this.points.push(R.clone())}return this.closed=E.closed,this.curveType=E.curveType,this.tension=E.tension,this}toJSON(){let E=super.toJSON();E.points=[];for(let O=0,R=this.points.length;O<R;O++){let R=this.points[O];E.points.push(R.toArray())}return E.closed=this.closed,E.curveType=this.curveType,E.tension=this.tension,E}fromJSON(E){super.fromJSON(E),this.points=[];for(let O=0,R=E.points.length;O<R;O++){let R=E.points[O];this.points.push((new Wn).fromArray(R))}return this.closed=E.closed,this.curveType=E.curveType,this.tension=E.tension,this}};function ZC(E,O,R,z,V){let j=.5*(z-O),Y=.5*(V-R),ee=E*E,se=E*ee;return(2*R-2*z+j+Y)*se+(-3*R+3*z-2*j-Y)*ee+j*E+R}function D4(E,O){let R=1-E;return R*R*O}function O4(E,O){return 2*(1-E)*E*O}function R4(E,O){return E*E*O}function fp(E,O,R,z){return D4(E,O)+O4(E,R)+R4(E,z)}function L4(E,O){let R=1-E;return R*R*R*O}function B4(E,O){let R=1-E;return 3*R*R*E*O}function N4(E,O){return 3*(1-E)*E*E*O}function F4(E,O){return E*E*E*O}function pp(E,O,R,z,V){return L4(E,O)+B4(E,R)+N4(E,z)+F4(E,V)}var Ou=class extends Au{constructor(E=new bn,O=new bn,R=new bn,z=new bn){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=E,this.v1=O,this.v2=R,this.v3=z}getPoint(E,O=new bn){let R=O,z=this.v0,V=this.v1,j=this.v2,Y=this.v3;return R.set(pp(E,z.x,V.x,j.x,Y.x),pp(E,z.y,V.y,j.y,Y.y)),R}copy(E){return super.copy(E),this.v0.copy(E.v0),this.v1.copy(E.v1),this.v2.copy(E.v2),this.v3.copy(E.v3),this}toJSON(){let E=super.toJSON();return E.v0=this.v0.toArray(),E.v1=this.v1.toArray(),E.v2=this.v2.toArray(),E.v3=this.v3.toArray(),E}fromJSON(E){return super.fromJSON(E),this.v0.fromArray(E.v0),this.v1.fromArray(E.v1),this.v2.fromArray(E.v2),this.v3.fromArray(E.v3),this}},Ru=class extends Au{constructor(E=new Wn,O=new Wn,R=new Wn,z=new Wn){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=E,this.v1=O,this.v2=R,this.v3=z}getPoint(E,O=new Wn){let R=O,z=this.v0,V=this.v1,j=this.v2,Y=this.v3;return R.set(pp(E,z.x,V.x,j.x,Y.x),pp(E,z.y,V.y,j.y,Y.y),pp(E,z.z,V.z,j.z,Y.z)),R}copy(E){return super.copy(E),this.v0.copy(E.v0),this.v1.copy(E.v1),this.v2.copy(E.v2),this.v3.copy(E.v3),this}toJSON(){let E=super.toJSON();return E.v0=this.v0.toArray(),E.v1=this.v1.toArray(),E.v2=this.v2.toArray(),E.v3=this.v3.toArray(),E}fromJSON(E){return super.fromJSON(E),this.v0.fromArray(E.v0),this.v1.fromArray(E.v1),this.v2.fromArray(E.v2),this.v3.fromArray(E.v3),this}},Lu=class extends Au{constructor(E=new bn,O=new bn){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=E,this.v2=O}getPoint(E,O=new bn){let R=O;return E===1?R.copy(this.v2):(R.copy(this.v2).sub(this.v1),R.multiplyScalar(E).add(this.v1)),R}getPointAt(E,O){return this.getPoint(E,O)}getTangent(E,O){let R=O||new bn;return R.copy(this.v2).sub(this.v1).normalize(),R}copy(E){return super.copy(E),this.v1.copy(E.v1),this.v2.copy(E.v2),this}toJSON(){let E=super.toJSON();return E.v1=this.v1.toArray(),E.v2=this.v2.toArray(),E}fromJSON(E){return super.fromJSON(E),this.v1.fromArray(E.v1),this.v2.fromArray(E.v2),this}},Bu=class extends Au{constructor(E=new Wn,O=new Wn){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=E,this.v2=O}getPoint(E,O=new Wn){let R=O;return E===1?R.copy(this.v2):(R.copy(this.v2).sub(this.v1),R.multiplyScalar(E).add(this.v1)),R}getPointAt(E,O){return this.getPoint(E,O)}copy(E){return super.copy(E),this.v1.copy(E.v1),this.v2.copy(E.v2),this}toJSON(){let E=super.toJSON();return E.v1=this.v1.toArray(),E.v2=this.v2.toArray(),E}fromJSON(E){return super.fromJSON(E),this.v1.fromArray(E.v1),this.v2.fromArray(E.v2),this}},zu=class extends Au{constructor(E=new bn,O=new bn,R=new bn){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=E,this.v1=O,this.v2=R}getPoint(E,O=new bn){let R=O,z=this.v0,V=this.v1,j=this.v2;return R.set(fp(E,z.x,V.x,j.x),fp(E,z.y,V.y,j.y)),R}copy(E){return super.copy(E),this.v0.copy(E.v0),this.v1.copy(E.v1),this.v2.copy(E.v2),this}toJSON(){let E=super.toJSON();return E.v0=this.v0.toArray(),E.v1=this.v1.toArray(),E.v2=this.v2.toArray(),E}fromJSON(E){return super.fromJSON(E),this.v0.fromArray(E.v0),this.v1.fromArray(E.v1),this.v2.fromArray(E.v2),this}},Fu=class extends Au{constructor(E=new Wn,O=new Wn,R=new Wn){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=E,this.v1=O,this.v2=R}getPoint(E,O=new Wn){let R=O,z=this.v0,V=this.v1,j=this.v2;return R.set(fp(E,z.x,V.x,j.x),fp(E,z.y,V.y,j.y),fp(E,z.z,V.z,j.z)),R}copy(E){return super.copy(E),this.v0.copy(E.v0),this.v1.copy(E.v1),this.v2.copy(E.v2),this}toJSON(){let E=super.toJSON();return E.v0=this.v0.toArray(),E.v1=this.v1.toArray(),E.v2=this.v2.toArray(),E}fromJSON(E){return super.fromJSON(E),this.v0.fromArray(E.v0),this.v1.fromArray(E.v1),this.v2.fromArray(E.v2),this}},Nu=class extends Au{constructor(E=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=E}getPoint(E,O=new bn){let R=O,z=this.points,V=(z.length-1)*E,j=Math.floor(V),Y=V-j,ee=z[j===0?j:j-1],se=z[j],he=z[j>z.length-2?z.length-1:j+1],ce=z[j>z.length-3?z.length-1:j+2];return R.set(ZC(Y,ee.x,se.x,he.x,ce.x),ZC(Y,ee.y,se.y,he.y,ce.y)),R}copy(E){super.copy(E),this.points=[];for(let O=0,R=E.points.length;O<R;O++){let R=E.points[O];this.points.push(R.clone())}return this}toJSON(){let E=super.toJSON();E.points=[];for(let O=0,R=this.points.length;O<R;O++){let R=this.points[O];E.points.push(R.toArray())}return E}fromJSON(E){super.fromJSON(E),this.points=[];for(let O=0,R=E.points.length;O<R;O++){let R=E.points[O];this.points.push((new bn).fromArray(R))}return this}},ku=Object.freeze({__proto__:null,ArcCurve:Eu,CatmullRomCurve3:Iu,CubicBezierCurve:Ou,CubicBezierCurve3:Ru,EllipseCurve:Mu,LineCurve:Lu,LineCurve3:Bu,QuadraticBezierCurve:zu,QuadraticBezierCurve3:Fu,SplineCurve:Nu}),Vu=class extends Au{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(E){this.curves.push(E)}closePath(){let E=this.curves[0].getPoint(0),O=this.curves[this.curves.length-1].getPoint(1);E.equals(O)||this.curves.push(new Lu(O,E))}getPoint(E,O){let R=E*this.getLength(),z=this.getCurveLengths(),V=0;for(;V<z.length;){if(z[V]>=R){let E=z[V]-R,j=this.curves[V],Y=j.getLength(),ee=Y===0?0:1-E/Y;return j.getPointAt(ee,O)}V++}return null}getLength(){let E=this.getCurveLengths();return E[E.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;let E=[],O=0;for(let R=0,z=this.curves.length;R<z;R++)O+=this.curves[R].getLength(),E.push(O);return this.cacheLengths=E,E}getSpacedPoints(E=40){let O=[];for(let R=0;R<=E;R++)O.push(this.getPoint(R/E));return this.autoClose&&O.push(O[0]),O}getPoints(E=12){let O,R=[];for(let z=0,V=this.curves;z<V.length;z++){let j=V[z],Y=j.isEllipseCurve?E*2:j.isLineCurve||j.isLineCurve3?1:j.isSplineCurve?E*j.points.length:E,ee=j.getPoints(Y);for(let E=0;E<ee.length;E++){let z=ee[E];O&&O.equals(z)||(R.push(z),O=z)}}return this.autoClose&&R.length>1&&!R[R.length-1].equals(R[0])&&R.push(R[0]),R}copy(E){super.copy(E),this.curves=[];for(let O=0,R=E.curves.length;O<R;O++){let R=E.curves[O];this.curves.push(R.clone())}return this.autoClose=E.autoClose,this}toJSON(){let E=super.toJSON();E.autoClose=this.autoClose,E.curves=[];for(let O=0,R=this.curves.length;O<R;O++){let R=this.curves[O];E.curves.push(R.toJSON())}return E}fromJSON(E){super.fromJSON(E),this.autoClose=E.autoClose,this.curves=[];for(let O=0,R=E.curves.length;O<R;O++){let R=E.curves[O];this.curves.push((new ku[R.type]).fromJSON(R))}return this}},ju=class extends Vu{constructor(E){super(),this.type="Path",this.currentPoint=new bn,E&&this.setFromPoints(E)}setFromPoints(E){this.moveTo(E[0].x,E[0].y);for(let O=1,R=E.length;O<R;O++)this.lineTo(E[O].x,E[O].y);return this}moveTo(E,O){return this.currentPoint.set(E,O),this}lineTo(E,O){let R=new Lu(this.currentPoint.clone(),new bn(E,O));return this.curves.push(R),this.currentPoint.set(E,O),this}quadraticCurveTo(E,O,R,z){let V=new zu(this.currentPoint.clone(),new bn(E,O),new bn(R,z));return this.curves.push(V),this.currentPoint.set(R,z),this}bezierCurveTo(E,O,R,z,V,j){let Y=new Ou(this.currentPoint.clone(),new bn(E,O),new bn(R,z),new bn(V,j));return this.curves.push(Y),this.currentPoint.set(V,j),this}splineThru(E){let O=[this.currentPoint.clone()].concat(E),R=new Nu(O);return this.curves.push(R),this.currentPoint.copy(E[E.length-1]),this}arc(E,O,R,z,V,j){let Y=this.currentPoint.x,ee=this.currentPoint.y;return this.absarc(E+Y,O+ee,R,z,V,j),this}absarc(E,O,R,z,V,j){return this.absellipse(E,O,R,R,z,V,j),this}ellipse(E,O,R,z,V,j,Y,ee){let se=this.currentPoint.x,he=this.currentPoint.y;return this.absellipse(E+se,O+he,R,z,V,j,Y,ee),this}absellipse(E,O,R,z,V,j,Y,ee){let se=new Mu(E,O,R,z,V,j,Y,ee);if(this.curves.length>0){let E=se.getPoint(0);E.equals(this.currentPoint)||this.lineTo(E.x,E.y)}this.curves.push(se);let he=se.getPoint(1);return this.currentPoint.copy(he),this}copy(E){return super.copy(E),this.currentPoint.copy(E.currentPoint),this}toJSON(){let E=super.toJSON();return E.currentPoint=this.currentPoint.toArray(),E}fromJSON(E){return super.fromJSON(E),this.currentPoint.fromArray(E.currentPoint),this}},Hu=class extends Na{constructor(E=[new bn(0,-.5),new bn(.5,0),new bn(0,.5)],O=12,R=0,z=Math.PI*2){super(),this.type="LatheGeometry",this.parameters={points:E,segments:O,phiStart:R,phiLength:z},O=Math.floor(O),z=pi(z,0,Math.PI*2);let V=[],j=[],Y=[],ee=[],se=[],he=1/O,ce=new Wn,ue=new bn,fe=new Wn,ve=new Wn,we=new Wn,Se=0,_e=0;for(let O=0;O<=E.length-1;O++)switch(O){case 0:Se=E[O+1].x-E[O].x,_e=E[O+1].y-E[O].y,fe.x=_e*1,fe.y=-Se,fe.z=_e*0,we.copy(fe),fe.normalize(),ee.push(fe.x,fe.y,fe.z);break;case E.length-1:ee.push(we.x,we.y,we.z);break;default:Se=E[O+1].x-E[O].x,_e=E[O+1].y-E[O].y,fe.x=_e*1,fe.y=-Se,fe.z=_e*0,ve.copy(fe),fe.x+=we.x,fe.y+=we.y,fe.z+=we.z,fe.normalize(),ee.push(fe.x,fe.y,fe.z),we.copy(ve)}for(let V=0;V<=O;V++){let fe=R+V*he*z,ve=Math.sin(fe),we=Math.cos(fe);for(let R=0;R<=E.length-1;R++){ce.x=E[R].x*ve,ce.y=E[R].y,ce.z=E[R].x*we,j.push(ce.x,ce.y,ce.z),ue.x=V/O,ue.y=R/(E.length-1),Y.push(ue.x,ue.y);let z=ee[3*R+0]*ve,he=ee[3*R+1],fe=ee[3*R+0]*we;se.push(z,he,fe)}}for(let R=0;R<O;R++)for(let O=0;O<E.length-1;O++){let z=O+R*E.length,j=z,Y=z+E.length,ee=z+E.length+1,se=z+1;V.push(j,Y,se),V.push(ee,se,Y)}this.setIndex(V),this.setAttribute("position",new Ma(j,3)),this.setAttribute("uv",new Ma(Y,2)),this.setAttribute("normal",new Ma(se,3))}static fromJSON(E){return new Hu(E.points,E.segments,E.phiStart,E.phiLength)}};var Wu=class extends Na{constructor(E=1,O=1,R=1,z=32,V=1,j=!1,Y=0,ee=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:E,radiusBottom:O,height:R,radialSegments:z,heightSegments:V,openEnded:j,thetaStart:Y,thetaLength:ee};let se=this;z=Math.floor(z),V=Math.floor(V);let he=[],ce=[],ue=[],fe=[],ve=0,we=[],Se=R/2,_e=0;x(),j===!1&&(E>0&&v(!0),O>0&&v(!1)),this.setIndex(he),this.setAttribute("position",new Ma(ce,3)),this.setAttribute("normal",new Ma(ue,3)),this.setAttribute("uv",new Ma(fe,2));function x(){let j=new Wn,Ae=new Wn,Ce=0,Te=(O-E)/R;for(let se=0;se<=V;se++){let he=[],_e=se/V,Ce=_e*(O-E)+E;for(let E=0;E<=z;E++){let O=E/z,V=O*ee+Y,se=Math.sin(V),we=Math.cos(V);Ae.x=Ce*se,Ae.y=-_e*R+Se,Ae.z=Ce*we,ce.push(Ae.x,Ae.y,Ae.z),j.set(se,Te,we).normalize(),ue.push(j.x,j.y,j.z),fe.push(O,1-_e),he.push(ve++)}we.push(he)}for(let E=0;E<z;E++)for(let O=0;O<V;O++){let R=we[O][E],z=we[O+1][E],V=we[O+1][E+1],j=we[O][E+1];he.push(R,z,j),he.push(z,V,j),Ce+=6}se.addGroup(_e,Ce,0),_e+=Ce}function v(R){let V=ve,j=new bn,we=new Wn,Ae=0,Ce=R===!0?E:O,Te=R===!0?1:-1;for(let E=1;E<=z;E++)ce.push(0,Se*Te,0),ue.push(0,Te,0),fe.push(.5,.5),ve++;let Ie=ve;for(let E=0;E<=z;E++){let O=E/z*ee+Y,R=Math.cos(O),V=Math.sin(O);we.x=Ce*V,we.y=Se*Te,we.z=Ce*R,ce.push(we.x,we.y,we.z),ue.push(0,Te,0),j.x=R*.5+.5,j.y=V*.5*Te+.5,fe.push(j.x,j.y),ve++}for(let E=0;E<z;E++){let O=V+E,z=Ie+E;R===!0?he.push(z,z+1,O):he.push(z+1,z,O),Ae+=3}se.addGroup(_e,Ae,R===!0?1:2),_e+=Ae}}static fromJSON(E){return new Wu(E.radiusTop,E.radiusBottom,E.height,E.radialSegments,E.heightSegments,E.openEnded,E.thetaStart,E.thetaLength)}},qu=class extends Wu{constructor(E=1,O=1,R=32,z=1,V=!1,j=0,Y=Math.PI*2){super(0,E,O,R,z,V,j,Y),this.type="ConeGeometry",this.parameters={radius:E,height:O,radialSegments:R,heightSegments:z,openEnded:V,thetaStart:j,thetaLength:Y}}static fromJSON(E){return new qu(E.radius,E.height,E.radialSegments,E.heightSegments,E.openEnded,E.thetaStart,E.thetaLength)}},Xu=class extends Na{constructor(E=[],O=[],R=1,z=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:E,indices:O,radius:R,detail:z};let V=[],j=[];a(z),c(R),u(),this.setAttribute("position",new Ma(V,3)),this.setAttribute("normal",new Ma(V.slice(),3)),this.setAttribute("uv",new Ma(j,2)),z===0?this.computeVertexNormals():this.normalizeNormals();function a(E){let R=new Wn,z=new Wn,V=new Wn;for(let j=0;j<O.length;j+=3)f(O[j+0],R),f(O[j+1],z),f(O[j+2],V),l(R,z,V,E)}function l(E,O,R,z){let V=z+1,j=[];for(let z=0;z<=V;z++){j[z]=[];let Y=E.clone().lerp(R,z/V),ee=O.clone().lerp(R,z/V),se=V-z;for(let E=0;E<=se;E++)j[z][E]=E===0&&z===V?Y:Y.clone().lerp(ee,E/se)}for(let E=0;E<V;E++)for(let O=0;O<2*(V-E)-1;O++){let R=Math.floor(O/2);O%2===0?(d(j[E][R+1]),d(j[E+1][R]),d(j[E][R])):(d(j[E][R+1]),d(j[E+1][R+1]),d(j[E+1][R]))}}function c(E){let O=new Wn;for(let R=0;R<V.length;R+=3)O.x=V[R+0],O.y=V[R+1],O.z=V[R+2],O.normalize().multiplyScalar(E),V[R+0]=O.x,V[R+1]=O.y,V[R+2]=O.z}function u(){let E=new Wn;for(let O=0;O<V.length;O+=3){E.x=V[O+0],E.y=V[O+1],E.z=V[O+2];let R=g(E)/2/Math.PI+.5,z=y(E)/Math.PI+.5;j.push(R,1-z)}p(),h()}function h(){for(let E=0;E<j.length;E+=6){let O=j[E+0],R=j[E+2],z=j[E+4],V=Math.max(O,R,z),Y=Math.min(O,R,z);V>.9&&Y<.1&&(O<.2&&(j[E+0]+=1),R<.2&&(j[E+2]+=1),z<.2&&(j[E+4]+=1))}}function d(E){V.push(E.x,E.y,E.z)}function f(O,R){let z=O*3;R.x=E[z+0],R.y=E[z+1],R.z=E[z+2]}function p(){let E=new Wn,O=new Wn,R=new Wn,z=new Wn,Y=new bn,ee=new bn,se=new bn;for(let he=0,ce=0;he<V.length;he+=9,ce+=6){E.set(V[he+0],V[he+1],V[he+2]),O.set(V[he+3],V[he+4],V[he+5]),R.set(V[he+6],V[he+7],V[he+8]),Y.set(j[ce+0],j[ce+1]),ee.set(j[ce+2],j[ce+3]),se.set(j[ce+4],j[ce+5]),z.copy(E).add(O).add(R).divideScalar(3);let ue=g(z);m(Y,ce+0,E,ue),m(ee,ce+2,O,ue),m(se,ce+4,R,ue)}}function m(E,O,R,z){z<0&&E.x===1&&(j[O]=E.x-1),R.x===0&&R.z===0&&(j[O]=z/2/Math.PI+.5)}function g(E){return Math.atan2(E.z,-E.x)}function y(E){return Math.atan2(-E.y,Math.sqrt(E.x*E.x+E.z*E.z))}}static fromJSON(E){return new Xu(E.vertices,E.indices,E.radius,E.details)}},Yu=class extends Xu{constructor(E=1,O=0){let R=(1+Math.sqrt(5))/2,z=1/R,V=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-z,-R,0,-z,R,0,z,-R,0,z,R,-z,-R,0,-z,R,0,z,-R,0,z,R,0,-R,0,-z,R,0,-z,-R,0,z,R,0,z],j=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];super(V,j,E,O),this.type="DodecahedronGeometry",this.parameters={radius:E,detail:O}}static fromJSON(E){return new Yu(E.radius,E.detail)}};var Qu=class extends ju{constructor(E){super(E),this.uuid=ss(),this.type="Shape",this.holes=[]}getPointsHoles(E){let O=[];for(let R=0,z=this.holes.length;R<z;R++)O[R]=this.holes[R].getPoints(E);return O}extractPoints(E){return{shape:this.getPoints(E),holes:this.getPointsHoles(E)}}copy(E){super.copy(E),this.holes=[];for(let O=0,R=E.holes.length;O<R;O++){let R=E.holes[O];this.holes.push(R.clone())}return this}toJSON(){let E=super.toJSON();E.uuid=this.uuid,E.holes=[];for(let O=0,R=this.holes.length;O<R;O++){let R=this.holes[O];E.holes.push(R.toJSON())}return E}fromJSON(E){super.fromJSON(E),this.uuid=E.uuid,this.holes=[];for(let O=0,R=E.holes.length;O<R;O++){let R=E.holes[O];this.holes.push((new ju).fromJSON(R))}return this}},Zu={triangulate:function(E,O,R=2){let z=O&&O.length,V=z?O[0]*R:E.length,j=CP(E,0,V,R,!0),Y=[];if(!j||j.next===j.prev)return Y;let ee,se,he,ce,ue,fe,ve;if(z&&(j=H4(E,O,j,R)),E.length>80*R){ee=he=E[0],se=ce=E[1];for(let O=R;O<V;O+=R)ue=E[O],fe=E[O+1],ue<ee&&(ee=ue),fe<se&&(se=fe),ue>he&&(he=ue),fe>ce&&(ce=fe);ve=Math.max(he-ee,ce-se),ve=ve!==0?32767/ve:0}return Ep(j,Y,R,ee,se,ve,0),Y}};function CP(E,O,R,z,V){let j,Y;if(V===t5(E,O,R,z)>0)for(j=O;j<R;j+=z)Y=JC(j,E[j],E[j+1],Y);else for(j=R-z;j>=O;j-=z)Y=JC(j,E[j],E[j+1],Y);return Y&&zy(Y,Y.next)&&(Mp(Y),Y=Y.next),Y}function Dc(E,O){if(!E)return E;O||(O=E);let R,z=E;do{if(R=!1,z.steiner||!zy(z,z.next)&&jr(z.prev,z,z.next)!==0)z=z.next;else{if(Mp(z),z=O=z.prev,z===z.next)break;R=!0}}while(R||z!==O);return O}function Ep(E,O,R,z,V,j,Y){if(!E)return;!Y&&j&&K4(E,z,V,j);let ee,se,he=E;for(;E.prev!==E.next;)if(ee=E.prev,se=E.next,j?k4(E,z,V,j):z4(E))O.push(ee.i/R|0),O.push(E.i/R|0),O.push(se.i/R|0),Mp(E),E=se.next,he=se.next;else if(E=se,E===he){Y?Y===1?(E=G4(Dc(E),O,R),Ep(E,O,R,z,V,j,2)):Y===2&&j4(E,O,R,z,V,j):Ep(Dc(E),O,R,z,V,j,1);break}}function z4(E){let O=E.prev,R=E,z=E.next;if(jr(O,R,z)>=0)return!1;let V=O.x,j=R.x,Y=z.x,ee=O.y,se=R.y,he=z.y,ce=V<j?V<Y?V:Y:j<Y?j:Y,ue=ee<se?ee<he?ee:he:se<he?se:he,fe=V>j?V>Y?V:Y:j>Y?j:Y,ve=ee>se?ee>he?ee:he:se>he?se:he,we=z.next;for(;we!==O;){if(we.x>=ce&&we.x<=fe&&we.y>=ue&&we.y<=ve&&Uu(V,ee,j,se,Y,he,we.x,we.y)&&jr(we.prev,we,we.next)>=0)return!1;we=we.next}return!0}function k4(E,O,R,z){let V=E.prev,j=E,Y=E.next;if(jr(V,j,Y)>=0)return!1;let ee=V.x,se=j.x,he=Y.x,ce=V.y,ue=j.y,fe=Y.y,ve=ee<se?ee<he?ee:he:se<he?se:he,we=ce<ue?ce<fe?ce:fe:ue<fe?ue:fe,Se=ee>se?ee>he?ee:he:se>he?se:he,_e=ce>ue?ce>fe?ce:fe:ue>fe?ue:fe,Ae=_S(ve,we,O,R,z),Ce=_S(Se,_e,O,R,z),Te=E.prevZ,Ie=E.nextZ;for(;Te&&Te.z>=Ae&&Ie&&Ie.z<=Ce;){if(Te.x>=ve&&Te.x<=Se&&Te.y>=we&&Te.y<=_e&&Te!==V&&Te!==Y&&Uu(ee,ce,se,ue,he,fe,Te.x,Te.y)&&jr(Te.prev,Te,Te.next)>=0||(Te=Te.prevZ,Ie.x>=ve&&Ie.x<=Se&&Ie.y>=we&&Ie.y<=_e&&Ie!==V&&Ie!==Y&&Uu(ee,ce,se,ue,he,fe,Ie.x,Ie.y)&&jr(Ie.prev,Ie,Ie.next)>=0))return!1;Ie=Ie.nextZ}for(;Te&&Te.z>=Ae;){if(Te.x>=ve&&Te.x<=Se&&Te.y>=we&&Te.y<=_e&&Te!==V&&Te!==Y&&Uu(ee,ce,se,ue,he,fe,Te.x,Te.y)&&jr(Te.prev,Te,Te.next)>=0)return!1;Te=Te.prevZ}for(;Ie&&Ie.z<=Ce;){if(Ie.x>=ve&&Ie.x<=Se&&Ie.y>=we&&Ie.y<=_e&&Ie!==V&&Ie!==Y&&Uu(ee,ce,se,ue,he,fe,Ie.x,Ie.y)&&jr(Ie.prev,Ie,Ie.next)>=0)return!1;Ie=Ie.nextZ}return!0}function G4(E,O,R){let z=E;do{let V=z.prev,j=z.next.next;!zy(V,j)&&PP(V,z,z.next,j)&&Tp(V,j)&&Tp(j,V)&&(O.push(V.i/R|0),O.push(z.i/R|0),O.push(j.i/R|0),Mp(z),Mp(z.next),z=E=j),z=z.next}while(z!==E);return Dc(z)}function j4(E,O,R,z,V,j){let Y=E;do{let E=Y.next.next;for(;E!==Y.prev;){if(Y.i!==E.i&&J4(Y,E)){let ee=_P(Y,E);Y=Dc(Y,Y.next),ee=Dc(ee,ee.next),Ep(Y,O,R,z,V,j,0),Ep(ee,O,R,z,V,j,0);return}E=E.next}Y=Y.next}while(Y!==E)}function H4(E,O,R,z){let V,j,Y,ee,se,he=[];for(V=0,j=O.length;V<j;V++)Y=O[V]*z,ee=V<j-1?O[V+1]*z:E.length,se=CP(E,Y,ee,z,!1),se===se.next&&(se.steiner=!0),he.push(Z4(se));for(he.sort(W4),V=0;V<he.length;V++)R=q4(he[V],R);return R}function W4(E,O){return E.x-O.x}function q4(E,O){let R=X4(E,O);if(!R)return O;let z=_P(R,E);return Dc(z,z.next),Dc(R,R.next)}function X4(E,O){let R,z=O,V=-1/0,j=E.x,Y=E.y;do{if(Y<=z.y&&Y>=z.next.y&&z.next.y!==z.y){let E=z.x+(Y-z.y)*(z.next.x-z.x)/(z.next.y-z.y);if(E<=j&&E>V&&(V=E,R=z.x<z.next.x?z:z.next,E===j))return R}z=z.next}while(z!==O);if(!R)return null;let ee,se=R,he=R.x,ce=R.y,ue=1/0;z=R;do{j>=z.x&&z.x>=he&&j!==z.x&&Uu(Y<ce?j:V,Y,he,ce,Y<ce?V:j,Y,z.x,z.y)&&(ee=Math.abs(Y-z.y)/(j-z.x),Tp(z,E)&&(ee<ue||ee===ue&&(z.x>R.x||z.x===R.x&&Y4(R,z)))&&(R=z,ue=ee)),z=z.next}while(z!==se);return R}function Y4(E,O){return jr(E.prev,E,O.prev)<0&&jr(O.next,E,E.next)<0}function K4(E,O,R,z){let V=E;do{V.z===0&&(V.z=_S(V.x,V.y,O,R,z)),V.prevZ=V.prev,V.nextZ=V.next,V=V.next}while(V!==E);V.prevZ.nextZ=null,V.prevZ=null,Q4(V)}function Q4(E){let O,R,z,V,j,Y,ee,se,he=1;do{for(R=E,E=null,j=null,Y=0;R;){for(Y++,z=R,ee=0,O=0;O<he&&(ee++,z=z.nextZ,!!z);O++);for(se=he;ee>0||se>0&&z;)ee!==0&&(se===0||!z||R.z<=z.z)?(V=R,R=R.nextZ,ee--):(V=z,z=z.nextZ,se--),j?j.nextZ=V:E=V,V.prevZ=j,j=V;R=z}j.nextZ=null,he*=2}while(Y>1);return E}function _S(E,O,R,z,V){return E=(E-R)*V|0,O=(O-z)*V|0,E=16711935&(E|E<<8),E=252645135&(E|E<<4),E=858993459&(E|E<<2),E=1431655765&(E|E<<1),O=16711935&(O|O<<8),O=252645135&(O|O<<4),O=858993459&(O|O<<2),O=1431655765&(O|O<<1),E|O<<1}function Z4(E){let O=E,R=E;do{(O.x<R.x||O.x===R.x&&O.y<R.y)&&(R=O),O=O.next}while(O!==E);return R}function Uu(E,O,R,z,V,j,Y,ee){return(V-Y)*(O-ee)>=(E-Y)*(j-ee)&&(E-Y)*(z-ee)>=(R-Y)*(O-ee)&&(R-Y)*(j-ee)>=(V-Y)*(z-ee)}function J4(E,O){return E.next.i!==O.i&&E.prev.i!==O.i&&!$4(E,O)&&(Tp(E,O)&&Tp(O,E)&&e5(E,O)&&(jr(E.prev,E,O.prev)||jr(E,O.prev,O))||zy(E,O)&&jr(E.prev,E,E.next)>0&&jr(O.prev,O,O.next)>0)}function jr(E,O,R){return(O.y-E.y)*(R.x-O.x)-(O.x-E.x)*(R.y-O.y)}function zy(E,O){return E.x===O.x&&E.y===O.y}function PP(E,O,R,z){let V=ry(jr(E,O,R)),j=ry(jr(E,O,z)),Y=ry(jr(R,z,E)),ee=ry(jr(R,z,O));return!!(V!==j&&Y!==ee||V===0&&ty(E,R,O)||j===0&&ty(E,z,O)||Y===0&&ty(R,E,z)||ee===0&&ty(R,O,z))}function ty(E,O,R){return O.x<=Math.max(E.x,R.x)&&O.x>=Math.min(E.x,R.x)&&O.y<=Math.max(E.y,R.y)&&O.y>=Math.min(E.y,R.y)}function ry(E){return E>0?1:E<0?-1:0}function $4(E,O){let R=E;do{if(R.i!==E.i&&R.next.i!==E.i&&R.i!==O.i&&R.next.i!==O.i&&PP(R,R.next,E,O))return!0;R=R.next}while(R!==E);return!1}function Tp(E,O){return jr(E.prev,E,E.next)<0?jr(E,O,E.next)>=0&&jr(E,E.prev,O)>=0:jr(E,O,E.prev)<0||jr(E,E.next,O)<0}function e5(E,O){let R=E,z=!1,V=(E.x+O.x)/2,j=(E.y+O.y)/2;do{R.y>j!=R.next.y>j&&R.next.y!==R.y&&V<(R.next.x-R.x)*(j-R.y)/(R.next.y-R.y)+R.x&&(z=!z),R=R.next}while(R!==E);return z}function _P(E,O){let R=new IS(E.i,E.x,E.y),z=new IS(O.i,O.x,O.y),V=E.next,j=O.prev;return E.next=O,O.prev=E,R.next=V,V.prev=R,z.next=R,R.prev=z,j.next=z,z.prev=j,z}function JC(E,O,R,z){let V=new IS(E,O,R);return z?(V.next=z.next,V.prev=z,z.next.prev=V,z.next=V):(V.prev=V,V.next=V),V}function Mp(E){E.next.prev=E.prev,E.prev.next=E.next,E.prevZ&&(E.prevZ.nextZ=E.nextZ),E.nextZ&&(E.nextZ.prevZ=E.prevZ)}function IS(E,O,R){this.i=E,this.x=O,this.y=R,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function t5(E,O,R,z){let V=0;for(let j=O,Y=R-z;j<R;j+=z)V+=(E[Y]-E[j])*(E[j+1]+E[Y+1]),Y=j;return V}var Ku=class{static area(E){let O=E.length,R=0;for(let z=O-1,V=0;V<O;z=V++)R+=E[z].x*E[V].y-E[V].x*E[z].y;return R*.5}static isClockWise(E){return Ku.area(E)<0}static triangulateShape(E,O){let R=[],z=[],V=[];$C(E),eP(R,E);let j=E.length;O.forEach($C);for(let E=0;E<O.length;E++)z.push(j),j+=O[E].length,eP(R,O[E]);let Y=Zu.triangulate(R,z);for(let E=0;E<Y.length;E+=3)V.push(Y.slice(E,E+3));return V}};function $C(E){let O=E.length;O>2&&E[O-1].equals(E[0])&&E.pop()}function eP(E,O){for(let R=0;R<O.length;R++)E.push(O[R].x),E.push(O[R].y)}var Ju=class extends Xu{constructor(E=1,O=0){let R=(1+Math.sqrt(5))/2,z=[-1,R,0,1,R,0,-1,-R,0,1,-R,0,0,-1,R,0,1,R,0,-1,-R,0,1,-R,R,0,-1,R,0,1,-R,0,-1,-R,0,1],V=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];super(z,V,E,O),this.type="IcosahedronGeometry",this.parameters={radius:E,detail:O}}static fromJSON(E){return new Ju(E.radius,E.detail)}};var $u=class extends Na{constructor(E=1,O=32,R=16,z=0,V=Math.PI*2,j=0,Y=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:E,widthSegments:O,heightSegments:R,phiStart:z,phiLength:V,thetaStart:j,thetaLength:Y},O=Math.max(3,Math.floor(O)),R=Math.max(2,Math.floor(R));let ee=Math.min(j+Y,Math.PI),se=0,he=[],ce=new Wn,ue=new Wn,fe=[],ve=[],we=[],Se=[];for(let fe=0;fe<=R;fe++){let _e=[],Ae=fe/R,Ce=0;fe==0&&j==0?Ce=.5/O:fe==R&&ee==Math.PI&&(Ce=-.5/O);for(let R=0;R<=O;R++){let ee=R/O;ce.x=-E*Math.cos(z+ee*V)*Math.sin(j+Ae*Y),ce.y=E*Math.cos(j+Ae*Y),ce.z=E*Math.sin(z+ee*V)*Math.sin(j+Ae*Y),ve.push(ce.x,ce.y,ce.z),ue.copy(ce).normalize(),we.push(ue.x,ue.y,ue.z),Se.push(ee+Ce,1-Ae),_e.push(se++)}he.push(_e)}for(let E=0;E<R;E++)for(let z=0;z<O;z++){let O=he[E][z+1],V=he[E][z],Y=he[E+1][z],se=he[E+1][z+1];(E!==0||j>0)&&fe.push(O,V,se),(E!==R-1||ee<Math.PI)&&fe.push(V,Y,se)}this.setIndex(fe),this.setAttribute("position",new Ma(ve,3)),this.setAttribute("normal",new Ma(we,3)),this.setAttribute("uv",new Ma(Se,2))}static fromJSON(E){return new $u(E.radius,E.widthSegments,E.heightSegments,E.phiStart,E.phiLength,E.thetaStart,E.thetaLength)}};var ep=class extends Na{constructor(E=1,O=.4,R=12,z=48,V=Math.PI*2){super(),this.type="TorusGeometry",this.parameters={radius:E,tube:O,radialSegments:R,tubularSegments:z,arc:V},R=Math.floor(R),z=Math.floor(z);let j=[],Y=[],ee=[],se=[],he=new Wn,ce=new Wn,ue=new Wn;for(let j=0;j<=R;j++)for(let fe=0;fe<=z;fe++){let ve=fe/z*V,we=j/R*Math.PI*2;ce.x=(E+O*Math.cos(we))*Math.cos(ve),ce.y=(E+O*Math.cos(we))*Math.sin(ve),ce.z=O*Math.sin(we),Y.push(ce.x,ce.y,ce.z),he.x=E*Math.cos(ve),he.y=E*Math.sin(ve),ue.subVectors(ce,he).normalize(),ee.push(ue.x,ue.y,ue.z),se.push(fe/z),se.push(j/R)}for(let E=1;E<=R;E++)for(let O=1;O<=z;O++){let R=(z+1)*E+O-1,V=(z+1)*(E-1)+O-1,Y=(z+1)*(E-1)+O,ee=(z+1)*E+O;j.push(R,V,ee),j.push(V,Y,ee)}this.setIndex(j),this.setAttribute("position",new Ma(Y,3)),this.setAttribute("normal",new Ma(ee,3)),this.setAttribute("uv",new Ma(se,2))}static fromJSON(E){return new ep(E.radius,E.tube,E.radialSegments,E.tubularSegments,E.arc)}},tp=class extends Na{constructor(E=1,O=.4,R=64,z=8,V=2,j=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:E,tube:O,tubularSegments:R,radialSegments:z,p:V,q:j},R=Math.floor(R),z=Math.floor(z);let Y=[],ee=[],se=[],he=[],ce=new Wn,ue=new Wn,fe=new Wn,ve=new Wn,we=new Wn,Se=new Wn,_e=new Wn;for(let Y=0;Y<=R;++Y){let Ae=Y/R*V*Math.PI*2;x(Ae,V,j,E,fe),x(Ae+.01,V,j,E,ve),Se.subVectors(ve,fe),_e.addVectors(ve,fe),we.crossVectors(Se,_e),_e.crossVectors(we,Se),we.normalize(),_e.normalize();for(let E=0;E<=z;++E){let V=E/z*Math.PI*2,j=-O*Math.cos(V),ve=O*Math.sin(V);ce.x=fe.x+(j*_e.x+ve*we.x),ce.y=fe.y+(j*_e.y+ve*we.y),ce.z=fe.z+(j*_e.z+ve*we.z),ee.push(ce.x,ce.y,ce.z),ue.subVectors(ce,fe).normalize(),se.push(ue.x,ue.y,ue.z),he.push(Y/R),he.push(E/z)}}for(let E=1;E<=R;E++)for(let O=1;O<=z;O++){let R=(z+1)*(E-1)+(O-1),V=(z+1)*E+(O-1),j=(z+1)*E+O,ee=(z+1)*(E-1)+O;Y.push(R,V,ee),Y.push(V,j,ee)}this.setIndex(Y),this.setAttribute("position",new Ma(ee,3)),this.setAttribute("normal",new Ma(se,3)),this.setAttribute("uv",new Ma(he,2));function x(E,O,R,z,V){let j=Math.cos(E),Y=Math.sin(E),ee=R/O*E,se=Math.cos(ee);V.x=z*(2+se)*.5*j,V.y=z*(2+se)*Y*.5,V.z=z*Math.sin(ee)*.5}}static fromJSON(E){return new tp(E.radius,E.tube,E.tubularSegments,E.radialSegments,E.p,E.q)}};var ip=class extends lo{constructor(E){super(E),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}};function rl(E,O,R){return IP(E)?new E.constructor(E.subarray(O,R!==void 0?R:E.length)):E.slice(O,R)}function iy(E,O,R){return!E||!R&&E.constructor===O?E:typeof O.BYTES_PER_ELEMENT=="number"?new O(E):Array.prototype.slice.call(E)}function IP(E){return ArrayBuffer.isView(E)&&!(E instanceof DataView)}function r5(E){function t(O,R){return E[O]-E[R]}let O=E.length,R=new Array(O);for(let E=0;E!==O;++E)R[E]=E;return R.sort(t),R}function tP(E,O,R){let z=E.length,V=new E.constructor(z);for(let j=0,Y=0;Y!==z;++j){let z=R[j]*O;for(let R=0;R!==O;++R)V[Y++]=E[z+R]}return V}function DP(E,O,R,z){let V=1,j=E[0];for(;j!==void 0&&j[z]===void 0;)j=E[V++];if(j===void 0)return;let Y=j[z];if(Y!==void 0)if(Array.isArray(Y))do{Y=j[z],Y!==void 0&&(O.push(j.time),R.push.apply(R,Y)),j=E[V++]}while(j!==void 0);else if(Y.toArray!==void 0)do{Y=j[z],Y!==void 0&&(O.push(j.time),Y.toArray(R,R.length)),j=E[V++]}while(j!==void 0);else do{Y=j[z],Y!==void 0&&(O.push(j.time),R.push(Y)),j=E[V++]}while(j!==void 0)}var rp=class{constructor(E,O,R,z){this.parameterPositions=E,this._cachedIndex=0,this.resultBuffer=z!==void 0?z:new O.constructor(R),this.sampleValues=O,this.valueSize=R,this.settings=null,this.DefaultSettings_={}}evaluate(E){let O=this.parameterPositions,R=this._cachedIndex,z=O[R],V=O[R-1];e:{t:{let j;i:{r:if(!(E<z)){for(let j=R+2;;){if(z===void 0){if(E<V)break r;return R=O.length,this._cachedIndex=R,this.copySampleValue_(R-1)}if(R===j)break;if(V=z,z=O[++R],E<z)break t}j=O.length;break i}if(E>=V)break e;{let Y=O[1];E<Y&&(R=2,V=Y);for(let j=R-2;;){if(V===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(R===j)break;if(z=V,V=O[--R-1],E>=V)break t}j=R,R=0}}for(;R<j;){let z=R+j>>>1;E<O[z]?j=z:R=z+1}if(z=O[R],V=O[R-1],V===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(z===void 0)return R=O.length,this._cachedIndex=R,this.copySampleValue_(R-1)}this._cachedIndex=R,this.intervalChanged_(R,V,z)}return this.interpolate_(R,V,E,z)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(E){let O=this.resultBuffer,R=this.sampleValues,z=this.valueSize,V=E*z;for(let E=0;E!==z;++E)O[E]=R[V+E];return O}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}},np=class extends rp{constructor(E,O,R,z){super(E,O,R,z),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:Ur,endingEnd:Ur}}intervalChanged_(E,O,R){let z=this.parameterPositions,V=E-2,j=E+1,Y=z[V],ee=z[j];if(Y===void 0)switch(this.getSettings_().endingStart){case Vr:V=E,Y=2*O-R;break;case Gr:V=z.length-2,Y=O+z[V]-z[V+1];break;default:V=E,Y=R}if(ee===void 0)switch(this.getSettings_().endingEnd){case Vr:j=E,ee=2*R-O;break;case Gr:j=1,ee=R+z[1]-z[0];break;default:j=E-1,ee=O}let se=.5*(R-O),he=this.valueSize;this._weightPrev=se/(O-Y),this._weightNext=se/(ee-R),this._offsetPrev=V*he,this._offsetNext=j*he}interpolate_(E,O,R,z){let V=this.resultBuffer,j=this.sampleValues,Y=this.valueSize,ee=E*Y,se=ee-Y,he=this._offsetPrev,ce=this._offsetNext,ue=this._weightPrev,fe=this._weightNext,ve=(R-O)/(z-O),we=ve*ve,Se=we*ve,_e=-ue*Se+2*ue*we-ue*ve,Ae=(1+ue)*Se+(-1.5-2*ue)*we+(-.5+ue)*ve+1,Ce=(-1-fe)*Se+(1.5+fe)*we+.5*ve,Te=fe*Se-fe*we;for(let E=0;E!==Y;++E)V[E]=_e*j[he+E]+Ae*j[se+E]+Ce*j[ee+E]+Te*j[ce+E];return V}},sp=class extends rp{constructor(E,O,R,z){super(E,O,R,z)}interpolate_(E,O,R,z){let V=this.resultBuffer,j=this.sampleValues,Y=this.valueSize,ee=E*Y,se=ee-Y,he=(R-O)/(z-O),ce=1-he;for(let E=0;E!==Y;++E)V[E]=j[se+E]*ce+j[ee+E]*he;return V}},ap=class extends rp{constructor(E,O,R,z){super(E,O,R,z)}interpolate_(E){return this.copySampleValue_(E-1)}},op=class{constructor(E,O,R,z){if(E===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(O===void 0||O.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+E);this.name=E,this.times=iy(O,this.TimeBufferType),this.values=iy(R,this.ValueBufferType),this.setInterpolation(z||this.DefaultInterpolation)}static toJSON(E){let O,R=E.constructor;if(R.toJSON!==this.toJSON)O=R.toJSON(E);else{O={name:E.name,times:iy(E.times,Array),values:iy(E.values,Array)};let R=E.getInterpolation();R!==E.DefaultInterpolation&&(O.interpolation=R)}return O.type=E.ValueTypeName,O}InterpolantFactoryMethodDiscrete(E){return new ap(this.times,this.values,this.getValueSize(),E)}InterpolantFactoryMethodLinear(E){return new sp(this.times,this.values,this.getValueSize(),E)}InterpolantFactoryMethodSmooth(E){return new np(this.times,this.values,this.getValueSize(),E)}setInterpolation(E){let O;switch(E){case Br:O=this.InterpolantFactoryMethodDiscrete;break;case Fr:O=this.InterpolantFactoryMethodLinear;break;case Nr:O=this.InterpolantFactoryMethodSmooth;break}if(O===void 0){let O="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0){if(E===this.DefaultInterpolation)throw new Error(O);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",O),this}return this.createInterpolant=O,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Br;case this.InterpolantFactoryMethodLinear:return Fr;case this.InterpolantFactoryMethodSmooth:return Nr}}getValueSize(){return this.values.length/this.times.length}shift(E){if(E!==0){let O=this.times;for(let R=0,z=O.length;R!==z;++R)O[R]+=E}return this}scale(E){if(E!==1){let O=this.times;for(let R=0,z=O.length;R!==z;++R)O[R]*=E}return this}trim(E,O){let R=this.times,z=R.length,V=0,j=z-1;for(;V!==z&&R[V]<E;)++V;for(;j!==-1&&R[j]>O;)--j;if(++j,V!==0||j!==z){V>=j&&(j=Math.max(j,1),V=j-1);let E=this.getValueSize();this.times=rl(R,V,j),this.values=rl(this.values,V*E,j*E)}return this}validate(){let E=!0,O=this.getValueSize();O-Math.floor(O)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),E=!1);let R=this.times,z=this.values,V=R.length;V===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),E=!1);let j=null;for(let O=0;O!==V;O++){let z=R[O];if(typeof z=="number"&&isNaN(z)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,O,z),E=!1;break}if(j!==null&&j>z){console.error("THREE.KeyframeTrack: Out of order keys.",this,O,z,j),E=!1;break}j=z}if(z!==void 0&&IP(z))for(let O=0,R=z.length;O!==R;++O){let R=z[O];if(isNaN(R)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,O,R),E=!1;break}}return E}optimize(){let E=rl(this.times),O=rl(this.values),R=this.getValueSize(),z=this.getInterpolation()===Nr,V=E.length-1,j=1;for(let Y=1;Y<V;++Y){let V=!1,ee=E[Y],se=E[Y+1];if(ee!==se&&(Y!==1||ee!==E[0]))if(z)V=!0;else{let E=Y*R,z=E-R,j=E+R;for(let Y=0;Y!==R;++Y){let R=O[E+Y];if(R!==O[z+Y]||R!==O[j+Y]){V=!0;break}}}if(V){if(Y!==j){E[j]=E[Y];let z=Y*R,V=j*R;for(let E=0;E!==R;++E)O[V+E]=O[z+E]}++j}}if(V>0){E[j]=E[V];for(let E=V*R,z=j*R,Y=0;Y!==R;++Y)O[z+Y]=O[E+Y];++j}return j!==E.length?(this.times=rl(E,0,j),this.values=rl(O,0,j*R)):(this.times=E,this.values=O),this}clone(){let E=rl(this.times,0),O=rl(this.values,0),R=this.constructor,z=new R(this.name,E,O);return z.createInterpolant=this.createInterpolant,z}};op.prototype.TimeBufferType=Float32Array;op.prototype.ValueBufferType=Float32Array;op.prototype.DefaultInterpolation=Fr;var lp=class extends op{};lp.prototype.ValueTypeName="bool";lp.prototype.ValueBufferType=Array;lp.prototype.DefaultInterpolation=Br;lp.prototype.InterpolantFactoryMethodLinear=void 0;lp.prototype.InterpolantFactoryMethodSmooth=void 0;var dp=class extends op{};dp.prototype.ValueTypeName="color";var up=class extends op{};up.prototype.ValueTypeName="number";var mp=class extends rp{constructor(E,O,R,z){super(E,O,R,z)}interpolate_(E,O,R,z){let V=this.resultBuffer,j=this.sampleValues,Y=this.valueSize,ee=(R-O)/(z-O),se=E*Y;for(let E=se+Y;se!==E;se+=4)Hn.slerpFlat(V,0,j,se-Y,j,se,ee);return V}},gp=class extends op{InterpolantFactoryMethodLinear(E){return new mp(this.times,this.values,this.getValueSize(),E)}};gp.prototype.ValueTypeName="quaternion";gp.prototype.DefaultInterpolation=Fr;gp.prototype.InterpolantFactoryMethodSmooth=void 0;var vp=class extends op{};vp.prototype.ValueTypeName="string";vp.prototype.ValueBufferType=Array;vp.prototype.DefaultInterpolation=Br;vp.prototype.InterpolantFactoryMethodLinear=void 0;vp.prototype.InterpolantFactoryMethodSmooth=void 0;var xp=class extends op{};xp.prototype.ValueTypeName="vector";var bp=class{constructor(E,O=-1,R,z=Wr){this.name=E,this.tracks=R,this.duration=O,this.blendMode=z,this.uuid=ss(),this.duration<0&&this.resetDuration()}static parse(E){let O=[],R=E.tracks,z=1/(E.fps||1);for(let E=0,V=R.length;E!==V;++E)O.push(n5(R[E]).scale(z));let V=new this(E.name,E.duration,O,E.blendMode);return V.uuid=E.uuid,V}static toJSON(E){let O=[],R=E.tracks,z={name:E.name,duration:E.duration,tracks:O,uuid:E.uuid,blendMode:E.blendMode};for(let E=0,z=R.length;E!==z;++E)O.push(op.toJSON(R[E]));return z}static CreateFromMorphTargetSequence(E,O,R,z){let V=O.length,j=[];for(let E=0;E<V;E++){let Y=[],ee=[];Y.push((E+V-1)%V,E,(E+1)%V),ee.push(0,1,0);let se=r5(Y);Y=tP(Y,1,se),ee=tP(ee,1,se),!z&&Y[0]===0&&(Y.push(V),ee.push(ee[0])),j.push(new up(".morphTargetInfluences["+O[E].name+"]",Y,ee).scale(1/R))}return new this(E,-1,j)}static findByName(E,O){let R=E;if(!Array.isArray(E)){let O=E;R=O.geometry&&O.geometry.animations||O.animations}for(let E=0;E<R.length;E++)if(R[E].name===O)return R[E];return null}static CreateClipsFromMorphTargetSequences(E,O,R){let z={},V=/^([\w-]*?)([\d]+)$/;for(let O=0,R=E.length;O<R;O++){let R=E[O],j=R.name.match(V);if(j&&j.length>1){let E=j[1],O=z[E];O||(z[E]=O=[]),O.push(R)}}let j=[];for(let E in z)j.push(this.CreateFromMorphTargetSequence(E,z[E],O,R));return j}static parseAnimation(E,O){if(!E)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;let r=function(E,O,R,z,V){if(R.length!==0){let j=[],Y=[];DP(R,j,Y,z),j.length!==0&&V.push(new E(O,j,Y))}},R=[],z=E.name||"default",V=E.fps||30,j=E.blendMode,Y=E.length||-1,ee=E.hierarchy||[];for(let E=0;E<ee.length;E++){let z=ee[E].keys;if(!(!z||z.length===0))if(z[0].morphTargets){let E,O={};for(E=0;E<z.length;E++)if(z[E].morphTargets)for(let R=0;R<z[E].morphTargets.length;R++)O[z[E].morphTargets[R]]=-1;for(let V in O){let O=[],j=[];for(let R=0;R!==z[E].morphTargets.length;++R){let R=z[E];O.push(R.time),j.push(R.morphTarget===V?1:0)}R.push(new up(".morphTargetInfluence["+V+"]",O,j))}Y=O.length*V}else{let V=".bones["+O[E].name+"]";r(xp,V+".position",z,"pos",R),r(gp,V+".quaternion",z,"rot",R),r(xp,V+".scale",z,"scl",R)}}return R.length===0?null:new this(z,Y,R,j)}resetDuration(){let E=this.tracks,O=0;for(let R=0,z=E.length;R!==z;++R){let E=this.tracks[R];O=Math.max(O,E.times[E.times.length-1])}return this.duration=O,this}trim(){for(let E=0;E<this.tracks.length;E++)this.tracks[E].trim(0,this.duration);return this}validate(){let E=!0;for(let O=0;O<this.tracks.length;O++)E=E&&this.tracks[O].validate();return E}optimize(){for(let E=0;E<this.tracks.length;E++)this.tracks[E].optimize();return this}clone(){let E=[];for(let O=0;O<this.tracks.length;O++)E.push(this.tracks[O].clone());return new this.constructor(this.name,this.duration,E,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}};function i5(E){switch(E.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return up;case"vector":case"vector2":case"vector3":case"vector4":return xp;case"color":return dp;case"quaternion":return gp;case"bool":case"boolean":return lp;case"string":return vp}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+E)}function n5(E){if(E.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");let O=i5(E.type);if(E.times===void 0){let O=[],R=[];DP(E.keys,O,R,"value"),E.times=O,E.values=R}return O.parse!==void 0?O.parse(E):new O(E.name,E.times,E.values,E.interpolation)}var wp={enabled:!1,files:{},add:function(E,O){this.enabled!==!1&&(this.files[E]=O)},get:function(E){if(this.enabled!==!1)return this.files[E]},remove:function(E){delete this.files[E]},clear:function(){this.files={}}},Sp=class{constructor(E,O,R){let z,V=this,j=!1,Y=0,ee=0,se=[];this.onStart=void 0,this.onLoad=E,this.onProgress=O,this.onError=R,this.itemStart=function(E){ee++,j===!1&&V.onStart!==void 0&&V.onStart(E,Y,ee),j=!0},this.itemEnd=function(E){Y++,V.onProgress!==void 0&&V.onProgress(E,Y,ee),Y===ee&&(j=!1,V.onLoad!==void 0&&V.onLoad())},this.itemError=function(E){V.onError!==void 0&&V.onError(E)},this.resolveURL=function(E){return z?z(E):E},this.setURLModifier=function(E){return z=E,this},this.addHandler=function(E,O){return se.push(E,O),this},this.removeHandler=function(E){let O=se.indexOf(E);return O!==-1&&se.splice(O,2),this},this.getHandler=function(E){for(let O=0,R=se.length;O<R;O+=2){let R=se[O],z=se[O+1];if(R.global&&(R.lastIndex=0),R.test(E))return z}return null}}},_p=new Sp,Ap=class{constructor(E){this.manager=E!==void 0?E:_p,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(E,O){let R=this;return new Promise((function(z,V){R.load(E,z,O,V)}))}parse(){}setCrossOrigin(E){return this.crossOrigin=E,this}setWithCredentials(E){return this.withCredentials=E,this}setPath(E){return this.path=E,this}setResourcePath(E){return this.resourcePath=E,this}setRequestHeader(E){return this.requestHeader=E,this}},Cp={},Pp=class extends Error{constructor(E,O){super(E),this.response=O}},Dp=class extends Ap{constructor(E){super(E)}load(E,O,R,z){E===void 0&&(E=""),this.path!==void 0&&(E=this.path+E),E=this.manager.resolveURL(E);let V=wp.get(E);if(V!==void 0)return this.manager.itemStart(E),setTimeout((()=>{O&&O(V),this.manager.itemEnd(E)}),0),V;if(Cp[E]!==void 0){Cp[E].push({onLoad:O,onProgress:R,onError:z});return}Cp[E]=[],Cp[E].push({onLoad:O,onProgress:R,onError:z});let j=new Request(E,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),Y=this.mimeType,ee=this.responseType;fetch(j).then((O=>{if(O.status===200||O.status===0){if(O.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||O.body===void 0||O.body.getReader===void 0)return O;let R=Cp[E],z=O.body.getReader(),V=O.headers.get("Content-Length")||O.headers.get("X-File-Size"),j=V?parseInt(V):0,Y=j!==0,ee=0,se=new ReadableStream({start(E){x();function x(){z.read().then((({done:O,value:z})=>{if(O)E.close();else{ee+=z.byteLength;let O=new ProgressEvent("progress",{lengthComputable:Y,loaded:ee,total:j});for(let E=0,z=R.length;E<z;E++){let z=R[E];z.onProgress&&z.onProgress(O)}E.enqueue(z),x()}}))}}});return new Response(se)}throw new Pp(`fetch for "${O.url}" responded with ${O.status}: ${O.statusText}`,O)})).then((E=>{switch(ee){case"arraybuffer":return E.arrayBuffer();case"blob":return E.blob();case"document":return E.text().then((E=>(new DOMParser).parseFromString(E,Y)));case"json":return E.json();default:if(Y===void 0)return E.text();{let O=/charset="?([^;"\s]*)"?/i.exec(Y),R=O&&O[1]?O[1].toLowerCase():void 0,z=new TextDecoder(R);return E.arrayBuffer().then((E=>z.decode(E)))}}})).then((O=>{wp.add(E,O);let R=Cp[E];delete Cp[E];for(let E=0,z=R.length;E<z;E++){let z=R[E];z.onLoad&&z.onLoad(O)}})).catch((O=>{let R=Cp[E];if(R===void 0)throw this.manager.itemError(E),O;delete Cp[E];for(let E=0,z=R.length;E<z;E++){let z=R[E];z.onError&&z.onError(O)}this.manager.itemError(E)})).finally((()=>{this.manager.itemEnd(E)})),this.manager.itemStart(E)}setResponseType(E){return this.responseType=E,this}setMimeType(E){return this.mimeType=E,this}};var Ip=class extends Ap{constructor(E){super(E)}load(E,O,R,z){this.path!==void 0&&(E=this.path+E),E=this.manager.resolveURL(E);let V=this,j=wp.get(E);if(j!==void 0)return V.manager.itemStart(E),setTimeout((function(){O&&O(j),V.manager.itemEnd(E)}),0),j;let Y=yp("img");function l(){u(),wp.add(E,this),O&&O(this),V.manager.itemEnd(E)}function c(O){u(),z&&z(O),V.manager.itemError(E),V.manager.itemEnd(E)}function u(){Y.removeEventListener("load",l,!1),Y.removeEventListener("error",c,!1)}return Y.addEventListener("load",l,!1),Y.addEventListener("error",c,!1),E.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(Y.crossOrigin=this.crossOrigin),V.manager.itemStart(E),Y.src=E,Y}};var Op=class extends Ap{constructor(E){super(E)}load(E,O,R,z){let V=new Fn,j=new Ip(this.manager);return j.setCrossOrigin(this.crossOrigin),j.setPath(this.path),j.load(E,(function(E){V.image=E,V.needsUpdate=!0,O!==void 0&&O(V)}),R,z),V}},Rp=class extends ra{constructor(E,O=1){super(),this.isLight=!0,this.type="Light",this.color=new On(E),this.intensity=O}dispose(){}copy(E,O){return super.copy(E,O),this.color.copy(E.color),this.intensity=E.intensity,this}toJSON(E){let O=super.toJSON(E);return O.object.color=this.color.getHex(),O.object.intensity=this.intensity,this.groundColor!==void 0&&(O.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(O.object.distance=this.distance),this.angle!==void 0&&(O.object.angle=this.angle),this.decay!==void 0&&(O.object.decay=this.decay),this.penumbra!==void 0&&(O.object.penumbra=this.penumbra),this.shadow!==void 0&&(O.object.shadow=this.shadow.toJSON()),O}},Bp=class extends Rp{constructor(E,O,R){super(E,R),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(ra.DEFAULT_UP),this.updateMatrix(),this.groundColor=new On(O)}copy(E,O){return super.copy(E,O),this.groundColor.copy(E.groundColor),this}},zp=new Es,Fp=new Wn,Np=new Wn,Up=class{constructor(E){this.camera=E,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new bn(512,512),this.map=null,this.mapPass=null,this.matrix=new Es,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Eo,this._frameExtents=new bn(1,1),this._viewportCount=1,this._viewports=[new Nn(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(E){let O=this.camera,R=this.matrix;Fp.setFromMatrixPosition(E.matrixWorld),O.position.copy(Fp),Np.setFromMatrixPosition(E.target.matrixWorld),O.lookAt(Np),O.updateMatrixWorld(),zp.multiplyMatrices(O.projectionMatrix,O.matrixWorldInverse),this._frustum.setFromProjectionMatrix(zp),R.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),R.multiply(zp)}getViewport(E){return this._viewports[E]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(E){return this.camera=E.camera.clone(),this.bias=E.bias,this.radius=E.radius,this.mapSize.copy(E.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){let E={};return this.bias!==0&&(E.bias=this.bias),this.normalBias!==0&&(E.normalBias=this.normalBias),this.radius!==1&&(E.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(E.mapSize=this.mapSize.toArray()),E.camera=this.camera.toJSON(!1).object,delete E.camera.matrix,E}},kp=class extends Up{constructor(){super(new po(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(E){let O=this.camera,R=yn*2*E.angle*this.focus,z=this.mapSize.width/this.mapSize.height,V=E.distance||O.far;(R!==O.fov||z!==O.aspect||V!==O.far)&&(O.fov=R,O.aspect=z,O.far=V,O.updateProjectionMatrix()),super.updateMatrices(E)}copy(E){return super.copy(E),this.focus=E.focus,this}},Vp=class extends Rp{constructor(E,O,R=0,z=Math.PI/3,V=0,j=2){super(E,O),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(ra.DEFAULT_UP),this.updateMatrix(),this.target=new ra,this.distance=R,this.angle=z,this.penumbra=V,this.decay=j,this.map=null,this.shadow=new kp}get power(){return this.intensity*Math.PI}set power(E){this.intensity=E/Math.PI}dispose(){this.shadow.dispose()}copy(E,O){return super.copy(E,O),this.distance=E.distance,this.angle=E.angle,this.penumbra=E.penumbra,this.decay=E.decay,this.target=E.target.clone(),this.shadow=E.shadow.clone(),this}},jp=new Es,Xp=new Wn,Yp=new Wn,Qp=class extends Up{constructor(){super(new po(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new bn(4,2),this._viewportCount=6,this._viewports=[new Nn(2,1,1,1),new Nn(0,1,1,1),new Nn(3,1,1,1),new Nn(1,1,1,1),new Nn(3,0,1,1),new Nn(1,0,1,1)],this._cubeDirections=[new Wn(1,0,0),new Wn(-1,0,0),new Wn(0,0,1),new Wn(0,0,-1),new Wn(0,1,0),new Wn(0,-1,0)],this._cubeUps=[new Wn(0,1,0),new Wn(0,1,0),new Wn(0,1,0),new Wn(0,1,0),new Wn(0,0,1),new Wn(0,0,-1)]}updateMatrices(E,O=0){let R=this.camera,z=this.matrix,V=E.distance||R.far;V!==R.far&&(R.far=V,R.updateProjectionMatrix()),Xp.setFromMatrixPosition(E.matrixWorld),R.position.copy(Xp),Yp.copy(R.position),Yp.add(this._cubeDirections[O]),R.up.copy(this._cubeUps[O]),R.lookAt(Yp),R.updateMatrixWorld(),z.makeTranslation(-Xp.x,-Xp.y,-Xp.z),jp.multiplyMatrices(R.projectionMatrix,R.matrixWorldInverse),this._frustum.setFromProjectionMatrix(jp)}},Zp=class extends Rp{constructor(E,O,R=0,z=2){super(E,O),this.isPointLight=!0,this.type="PointLight",this.distance=R,this.decay=z,this.shadow=new Qp}get power(){return this.intensity*4*Math.PI}set power(E){this.intensity=E/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(E,O){return super.copy(E,O),this.distance=E.distance,this.decay=E.decay,this.shadow=E.shadow.clone(),this}},Kp=class extends Up{constructor(){super(new Vc(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}},Jp=class extends Rp{constructor(E,O){super(E,O),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(ra.DEFAULT_UP),this.updateMatrix(),this.target=new ra,this.shadow=new Kp}dispose(){this.shadow.dispose()}copy(E){return super.copy(E),this.target=E.target.clone(),this.shadow=E.shadow.clone(),this}};var $p=class extends Na{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(E){return super.copy(E),this.instanceCount=E.instanceCount,this}toJSON(){let E=super.toJSON();return E.instanceCount=this.instanceCount,E.isInstancedBufferGeometry=!0,E}},ef=class extends Ap{constructor(E){super(E)}load(E,O,R,z){let V=this,j=new Dp(V.manager);j.setPath(V.path),j.setRequestHeader(V.requestHeader),j.setWithCredentials(V.withCredentials),j.load(E,(function(R){try{O(V.parse(JSON.parse(R)))}catch(O){z?z(O):console.error(O),V.manager.itemError(E)}}),R,z)}parse(E){let O={},R={};function i(E,R){if(O[R]!==void 0)return O[R];let z=E.interleavedBuffers[R],V=s(E,z.buffer),j=Rg(z.type,V),Y=new qd(j,z.stride);return Y.uuid=z.uuid,O[R]=Y,Y}function s(E,O){if(R[O]!==void 0)return R[O];let z=E.arrayBuffers[O],V=new Uint32Array(z).buffer;return R[O]=V,V}let z=E.isInstancedBufferGeometry?new $p:new Na,V=E.data.index;if(V!==void 0){let E=Rg(V.type,V.array);z.setIndex(new Sa(E,1))}let j=E.data.attributes;for(let O in j){let R,V=j[O];if(V.isInterleavedBufferAttribute){let O=i(E.data,V.data);R=new Yd(O,V.itemSize,V.offset,V.normalized)}else{let E=Rg(V.type,V.array),O=V.isInstancedBufferAttribute?eu:Sa;R=new O(E,V.itemSize,V.normalized)}V.name!==void 0&&(R.name=V.name),V.usage!==void 0&&R.setUsage(V.usage),V.updateRange!==void 0&&(R.updateRange.offset=V.updateRange.offset,R.updateRange.count=V.updateRange.count),z.setAttribute(O,R)}let Y=E.data.morphAttributes;if(Y)for(let O in Y){let R=Y[O],V=[];for(let O=0,z=R.length;O<z;O++){let z,j=R[O];if(j.isInterleavedBufferAttribute){let O=i(E.data,j.data);z=new Yd(O,j.itemSize,j.offset,j.normalized)}else{let E=Rg(j.type,j.array);z=new Sa(E,j.itemSize,j.normalized)}j.name!==void 0&&(z.name=j.name),V.push(z)}z.morphAttributes[O]=V}E.data.morphTargetsRelative&&(z.morphTargetsRelative=!0);let ee=E.data.groups||E.data.drawcalls||E.data.offsets;if(ee!==void 0)for(let E=0,O=ee.length;E!==O;++E){let O=ee[E];z.addGroup(O.start,O.count,O.materialIndex)}let se=E.data.boundingSphere;if(se!==void 0){let E=new Wn;se.center!==void 0&&E.fromArray(se.center),z.boundingSphere=new ps(E,se.radius)}return E.name&&(z.name=E.name),E.userData&&(z.userData=E.userData),z}};var tf=class{constructor(E=!0){this.autoStart=E,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=sP(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let E=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){let O=sP();E=(O-this.oldTime)/1e3,this.oldTime=O,this.elapsedTime+=E}return E}};function sP(){return(typeof performance>"u"?Date:performance).now()}var rf=class{constructor(E,O,R){this.binding=E,this.valueSize=R;let z,V,j;switch(O){case"quaternion":z=this._slerp,V=this._slerpAdditive,j=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(R*6),this._workIndex=5;break;case"string":case"bool":z=this._select,V=this._select,j=this._setAdditiveIdentityOther,this.buffer=new Array(R*5);break;default:z=this._lerp,V=this._lerpAdditive,j=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(R*5)}this._mixBufferRegion=z,this._mixBufferRegionAdditive=V,this._setIdentity=j,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(E,O){let R=this.buffer,z=this.valueSize,V=E*z+z,j=this.cumulativeWeight;if(j===0){for(let E=0;E!==z;++E)R[V+E]=R[E];j=O}else{j+=O;let E=O/j;this._mixBufferRegion(R,V,0,E,z)}this.cumulativeWeight=j}accumulateAdditive(E){let O=this.buffer,R=this.valueSize,z=R*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(O,z,0,E,R),this.cumulativeWeightAdditive+=E}apply(E){let O=this.valueSize,R=this.buffer,z=E*O+O,V=this.cumulativeWeight,j=this.cumulativeWeightAdditive,Y=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,V<1){let E=O*this._origIndex;this._mixBufferRegion(R,z,E,1-V,O)}j>0&&this._mixBufferRegionAdditive(R,z,this._addIndex*O,1,O);for(let E=O,V=O+O;E!==V;++E)if(R[E]!==R[E+O]){Y.setValue(R,z);break}}saveOriginalState(){let E=this.binding,O=this.buffer,R=this.valueSize,z=R*this._origIndex;E.getValue(O,z);for(let E=R,V=z;E!==V;++E)O[E]=O[z+E%R];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){let E=this.valueSize*3;this.binding.setValue(this.buffer,E)}_setAdditiveIdentityNumeric(){let E=this._addIndex*this.valueSize,O=E+this.valueSize;for(let R=E;R<O;R++)this.buffer[R]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){let E=this._origIndex*this.valueSize,O=this._addIndex*this.valueSize;for(let R=0;R<this.valueSize;R++)this.buffer[O+R]=this.buffer[E+R]}_select(E,O,R,z,V){if(z>=.5)for(let z=0;z!==V;++z)E[O+z]=E[R+z]}_slerp(E,O,R,z){Hn.slerpFlat(E,O,E,O,E,R,z)}_slerpAdditive(E,O,R,z,V){let j=this._workIndex*V;Hn.multiplyQuaternionsFlat(E,j,E,O,E,R),Hn.slerpFlat(E,O,E,O,E,j,z)}_lerp(E,O,R,z,V){let j=1-z;for(let Y=0;Y!==V;++Y){let V=O+Y;E[V]=E[V]*j+E[R+Y]*z}}_lerpAdditive(E,O,R,z,V){for(let j=0;j!==V;++j){let V=O+j;E[V]=E[V]+E[R+j]*z}}},nf="\\[\\]\\.:\\/",sf=new RegExp("["+nf+"]","g"),af="[^"+nf+"]",of="[^"+nf.replace("\\.","")+"]",hf=/((?:WC+[\/:])*)/.source.replace("WC",af),df=/(WCOD+)?/.source.replace("WCOD",of),pf=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",af),mf=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",af),gf=new RegExp("^"+hf+df+pf+mf+"$"),vf=["material","materials","bones","map"],yf=class{constructor(E,O,R){let z=R||xf.parseTrackName(O);this._targetGroup=E,this._bindings=E.subscribe_(O,z)}getValue(E,O){this.bind();let R=this._targetGroup.nCachedObjects_,z=this._bindings[R];z!==void 0&&z.getValue(E,O)}setValue(E,O){let R=this._bindings;for(let z=this._targetGroup.nCachedObjects_,V=R.length;z!==V;++z)R[z].setValue(E,O)}bind(){let E=this._bindings;for(let O=this._targetGroup.nCachedObjects_,R=E.length;O!==R;++O)E[O].bind()}unbind(){let E=this._bindings;for(let O=this._targetGroup.nCachedObjects_,R=E.length;O!==R;++O)E[O].unbind()}},xf=class{constructor(E,O,R){this.path=O,this.parsedPath=R||xf.parseTrackName(O),this.node=xf.findNode(E,this.parsedPath.nodeName)||E,this.rootNode=E,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(E,O,R){return E&&E.isAnimationObjectGroup?new xf.Composite(E,O,R):new xf(E,O,R)}static sanitizeNodeName(E){return E.replace(/\s/g,"_").replace(sf,"")}static parseTrackName(E){let O=gf.exec(E);if(O===null)throw new Error("PropertyBinding: Cannot parse trackName: "+E);let R={nodeName:O[2],objectName:O[3],objectIndex:O[4],propertyName:O[5],propertyIndex:O[6]},z=R.nodeName&&R.nodeName.lastIndexOf(".");if(z!==void 0&&z!==-1){let E=R.nodeName.substring(z+1);vf.indexOf(E)!==-1&&(R.nodeName=R.nodeName.substring(0,z),R.objectName=E)}if(R.propertyName===null||R.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+E);return R}static findNode(E,O){if(O===void 0||O===""||O==="."||O===-1||O===E.name||O===E.uuid)return E;if(E.skeleton){let R=E.skeleton.getBoneByName(O);if(R!==void 0)return R}if(E.children){let r=function(E){for(let R=0;R<E.length;R++){let z=E[R];if(z.name===O||z.uuid===O)return z;let V=r(z.children);if(V)return V}return null},R=r(E.children);if(R)return R}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(E,O){E[O]=this.targetObject[this.propertyName]}_getValue_array(E,O){let R=this.resolvedProperty;for(let z=0,V=R.length;z!==V;++z)E[O++]=R[z]}_getValue_arrayElement(E,O){E[O]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(E,O){this.resolvedProperty.toArray(E,O)}_setValue_direct(E,O){this.targetObject[this.propertyName]=E[O]}_setValue_direct_setNeedsUpdate(E,O){this.targetObject[this.propertyName]=E[O],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(E,O){this.targetObject[this.propertyName]=E[O],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(E,O){let R=this.resolvedProperty;for(let z=0,V=R.length;z!==V;++z)R[z]=E[O++]}_setValue_array_setNeedsUpdate(E,O){let R=this.resolvedProperty;for(let z=0,V=R.length;z!==V;++z)R[z]=E[O++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(E,O){let R=this.resolvedProperty;for(let z=0,V=R.length;z!==V;++z)R[z]=E[O++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(E,O){this.resolvedProperty[this.propertyIndex]=E[O]}_setValue_arrayElement_setNeedsUpdate(E,O){this.resolvedProperty[this.propertyIndex]=E[O],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(E,O){this.resolvedProperty[this.propertyIndex]=E[O],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(E,O){this.resolvedProperty.fromArray(E,O)}_setValue_fromArray_setNeedsUpdate(E,O){this.resolvedProperty.fromArray(E,O),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(E,O){this.resolvedProperty.fromArray(E,O),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(E,O){this.bind(),this.getValue(E,O)}_setValue_unbound(E,O){this.bind(),this.setValue(E,O)}bind(){let E=this.node,O=this.parsedPath,R=O.objectName,z=O.propertyName,V=O.propertyIndex;if(E||(E=xf.findNode(this.rootNode,O.nodeName)||this.rootNode,this.node=E),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!E){console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");return}if(R){let z=O.objectIndex;switch(R){case"materials":if(!E.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!E.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}E=E.material.materials;break;case"bones":if(!E.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}E=E.skeleton.bones;for(let O=0;O<E.length;O++)if(E[O].name===z){z=O;break}break;case"map":if("map"in E){E=E.map;break}if(!E.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!E.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}E=E.material.map;break;default:if(E[R]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}E=E[R]}if(z!==void 0){if(E[z]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,E);return}E=E[z]}}let j=E[z];if(j===void 0){let R=O.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+R+"."+z+" but it wasn't found.",E);return}let Y=this.Versioning.None;this.targetObject=E,E.needsUpdate!==void 0?Y=this.Versioning.NeedsUpdate:E.matrixWorldNeedsUpdate!==void 0&&(Y=this.Versioning.MatrixWorldNeedsUpdate);let ee=this.BindingType.Direct;if(V!==void 0){if(z==="morphTargetInfluences"){if(!E.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!E.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}E.morphTargetDictionary[V]!==void 0&&(V=E.morphTargetDictionary[V])}ee=this.BindingType.ArrayElement,this.resolvedProperty=j,this.propertyIndex=V}else j.fromArray!==void 0&&j.toArray!==void 0?(ee=this.BindingType.HasFromToArray,this.resolvedProperty=j):Array.isArray(j)?(ee=this.BindingType.EntireArray,this.resolvedProperty=j):this.propertyName=z;this.getValue=this.GetterByBindingType[ee],this.setValue=this.SetterByBindingTypeAndVersioning[ee][Y]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}};xf.Composite=yf;xf.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};xf.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};xf.prototype.GetterByBindingType=[xf.prototype._getValue_direct,xf.prototype._getValue_array,xf.prototype._getValue_arrayElement,xf.prototype._getValue_toArray];xf.prototype.SetterByBindingTypeAndVersioning=[[xf.prototype._setValue_direct,xf.prototype._setValue_direct_setNeedsUpdate,xf.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[xf.prototype._setValue_array,xf.prototype._setValue_array_setNeedsUpdate,xf.prototype._setValue_array_setMatrixWorldNeedsUpdate],[xf.prototype._setValue_arrayElement,xf.prototype._setValue_arrayElement_setNeedsUpdate,xf.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[xf.prototype._setValue_fromArray,xf.prototype._setValue_fromArray_setNeedsUpdate,xf.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];var bf=class{constructor(E,O,R=null,z=O.blendMode){this._mixer=E,this._clip=O,this._localRoot=R,this.blendMode=z;let V=O.tracks,j=V.length,Y=new Array(j),ee={endingStart:Ur,endingEnd:Ur};for(let E=0;E!==j;++E){let O=V[E].createInterpolant(null);Y[E]=O,O.settings=ee}this._interpolantSettings=ee,this._interpolants=Y,this._propertyBindings=new Array(j),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=Rr,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(E){return this._startTime=E,this}setLoop(E,O){return this.loop=E,this.repetitions=O,this}setEffectiveWeight(E){return this.weight=E,this._effectiveWeight=this.enabled?E:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(E){return this._scheduleFading(E,0,1)}fadeOut(E){return this._scheduleFading(E,1,0)}crossFadeFrom(E,O,R){if(E.fadeOut(O),this.fadeIn(O),R){let R=this._clip.duration,z=E._clip.duration,V=z/R,j=R/z;E.warp(1,V,O),this.warp(j,1,O)}return this}crossFadeTo(E,O,R){return E.crossFadeFrom(this,O,R)}stopFading(){let E=this._weightInterpolant;return E!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(E)),this}setEffectiveTimeScale(E){return this.timeScale=E,this._effectiveTimeScale=this.paused?0:E,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(E){return this.timeScale=this._clip.duration/E,this.stopWarping()}syncWith(E){return this.time=E.time,this.timeScale=E.timeScale,this.stopWarping()}halt(E){return this.warp(this._effectiveTimeScale,0,E)}warp(E,O,R){let z=this._mixer,V=z.time,j=this.timeScale,Y=this._timeScaleInterpolant;Y===null&&(Y=z._lendControlInterpolant(),this._timeScaleInterpolant=Y);let ee=Y.parameterPositions,se=Y.sampleValues;return ee[0]=V,ee[1]=V+R,se[0]=E/j,se[1]=O/j,this}stopWarping(){let E=this._timeScaleInterpolant;return E!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(E)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(E,O,R,z){if(!this.enabled){this._updateWeight(E);return}let V=this._startTime;if(V!==null){let z=(E-V)*R;z<0||R===0?O=0:(this._startTime=null,O=R*z)}O*=this._updateTimeScale(E);let j=this._updateTime(O),Y=this._updateWeight(E);if(Y>0){let E=this._interpolants,O=this._propertyBindings;switch(this.blendMode){case qr:for(let R=0,z=E.length;R!==z;++R)E[R].evaluate(j),O[R].accumulateAdditive(Y);break;case Wr:default:for(let R=0,V=E.length;R!==V;++R)E[R].evaluate(j),O[R].accumulate(z,Y)}}}_updateWeight(E){let O=0;if(this.enabled){O=this.weight;let R=this._weightInterpolant;if(R!==null){let z=R.evaluate(E)[0];O*=z,E>R.parameterPositions[1]&&(this.stopFading(),z===0&&(this.enabled=!1))}}return this._effectiveWeight=O,O}_updateTimeScale(E){let O=0;if(!this.paused){O=this.timeScale;let R=this._timeScaleInterpolant;if(R!==null){let z=R.evaluate(E)[0];O*=z,E>R.parameterPositions[1]&&(this.stopWarping(),O===0?this.paused=!0:this.timeScale=O)}}return this._effectiveTimeScale=O,O}_updateTime(E){let O=this._clip.duration,R=this.loop,z=this.time+E,V=this._loopCount,j=R===Lr;if(E===0)return V===-1?z:j&&(V&1)===1?O-z:z;if(R===Or){V===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(z>=O)z=O;else{if(!(z<0)){this.time=z;break e}z=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=z,this._mixer.dispatchEvent({type:"finished",action:this,direction:E<0?-1:1})}}else{if(V===-1&&(E>=0?(V=0,this._setEndings(!0,this.repetitions===0,j)):this._setEndings(this.repetitions===0,!0,j)),z>=O||z<0){let R=Math.floor(z/O);z-=O*R,V+=Math.abs(R);let Y=this.repetitions-V;if(Y<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,z=E>0?O:0,this.time=z,this._mixer.dispatchEvent({type:"finished",action:this,direction:E>0?1:-1});else{if(Y===1){let O=E<0;this._setEndings(O,!O,j)}else this._setEndings(!1,!1,j);this._loopCount=V,this.time=z,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:R})}}else this.time=z;if(j&&(V&1)===1)return O-z}return z}_setEndings(E,O,R){let z=this._interpolantSettings;R?(z.endingStart=Vr,z.endingEnd=Vr):(z.endingStart=E?this.zeroSlopeAtStart?Vr:Ur:Gr,z.endingEnd=O?this.zeroSlopeAtEnd?Vr:Ur:Gr)}_scheduleFading(E,O,R){let z=this._mixer,V=z.time,j=this._weightInterpolant;j===null&&(j=z._lendControlInterpolant(),this._weightInterpolant=j);let Y=j.parameterPositions,ee=j.sampleValues;return Y[0]=V,ee[0]=O,Y[1]=V+E,ee[1]=R,this}},wf=new Float32Array(1),Sf=class extends pn{constructor(E){super(),this._root=E,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(E,O){let R=E._localRoot||this._root,z=E._clip.tracks,V=z.length,j=E._propertyBindings,Y=E._interpolants,ee=R.uuid,se=this._bindingsByRootAndName,he=se[ee];he===void 0&&(he={},se[ee]=he);for(let E=0;E!==V;++E){let V=z[E],se=V.name,ce=he[se];if(ce!==void 0)++ce.referenceCount,j[E]=ce;else{if(ce=j[E],ce!==void 0){ce._cacheIndex===null&&(++ce.referenceCount,this._addInactiveBinding(ce,ee,se));continue}let z=O&&O._propertyBindings[E].binding.parsedPath;ce=new rf(xf.create(R,se,z),V.ValueTypeName,V.getValueSize()),++ce.referenceCount,this._addInactiveBinding(ce,ee,se),j[E]=ce}Y[E].resultBuffer=ce.buffer}}_activateAction(E){if(!this._isActiveAction(E)){if(E._cacheIndex===null){let O=(E._localRoot||this._root).uuid,R=E._clip.uuid,z=this._actionsByClip[R];this._bindAction(E,z&&z.knownActions[0]),this._addInactiveAction(E,R,O)}let O=E._propertyBindings;for(let E=0,R=O.length;E!==R;++E){let R=O[E];R.useCount++===0&&(this._lendBinding(R),R.saveOriginalState())}this._lendAction(E)}}_deactivateAction(E){if(this._isActiveAction(E)){let O=E._propertyBindings;for(let E=0,R=O.length;E!==R;++E){let R=O[E];--R.useCount===0&&(R.restoreOriginalState(),this._takeBackBinding(R))}this._takeBackAction(E)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;let E=this;this.stats={actions:{get total(){return E._actions.length},get inUse(){return E._nActiveActions}},bindings:{get total(){return E._bindings.length},get inUse(){return E._nActiveBindings}},controlInterpolants:{get total(){return E._controlInterpolants.length},get inUse(){return E._nActiveControlInterpolants}}}}_isActiveAction(E){let O=E._cacheIndex;return O!==null&&O<this._nActiveActions}_addInactiveAction(E,O,R){let z=this._actions,V=this._actionsByClip,j=V[O];if(j===void 0)j={knownActions:[E],actionByRoot:{}},E._byClipCacheIndex=0,V[O]=j;else{let O=j.knownActions;E._byClipCacheIndex=O.length,O.push(E)}E._cacheIndex=z.length,z.push(E),j.actionByRoot[R]=E}_removeInactiveAction(E){let O=this._actions,R=O[O.length-1],z=E._cacheIndex;R._cacheIndex=z,O[z]=R,O.pop(),E._cacheIndex=null;let V=E._clip.uuid,j=this._actionsByClip,Y=j[V],ee=Y.knownActions,se=ee[ee.length-1],he=E._byClipCacheIndex;se._byClipCacheIndex=he,ee[he]=se,ee.pop(),E._byClipCacheIndex=null;let ce=Y.actionByRoot,ue=(E._localRoot||this._root).uuid;delete ce[ue],ee.length===0&&delete j[V],this._removeInactiveBindingsForAction(E)}_removeInactiveBindingsForAction(E){let O=E._propertyBindings;for(let E=0,R=O.length;E!==R;++E){let R=O[E];--R.referenceCount===0&&this._removeInactiveBinding(R)}}_lendAction(E){let O=this._actions,R=E._cacheIndex,z=this._nActiveActions++,V=O[z];E._cacheIndex=z,O[z]=E,V._cacheIndex=R,O[R]=V}_takeBackAction(E){let O=this._actions,R=E._cacheIndex,z=--this._nActiveActions,V=O[z];E._cacheIndex=z,O[z]=E,V._cacheIndex=R,O[R]=V}_addInactiveBinding(E,O,R){let z=this._bindingsByRootAndName,V=this._bindings,j=z[O];j===void 0&&(j={},z[O]=j),j[R]=E,E._cacheIndex=V.length,V.push(E)}_removeInactiveBinding(E){let O=this._bindings,R=E.binding,z=R.rootNode.uuid,V=R.path,j=this._bindingsByRootAndName,Y=j[z],ee=O[O.length-1],se=E._cacheIndex;ee._cacheIndex=se,O[se]=ee,O.pop(),delete Y[V],Object.keys(Y).length===0&&delete j[z]}_lendBinding(E){let O=this._bindings,R=E._cacheIndex,z=this._nActiveBindings++,V=O[z];E._cacheIndex=z,O[z]=E,V._cacheIndex=R,O[R]=V}_takeBackBinding(E){let O=this._bindings,R=E._cacheIndex,z=--this._nActiveBindings,V=O[z];E._cacheIndex=z,O[z]=E,V._cacheIndex=R,O[R]=V}_lendControlInterpolant(){let E=this._controlInterpolants,O=this._nActiveControlInterpolants++,R=E[O];return R===void 0&&(R=new sp(new Float32Array(2),new Float32Array(2),1,wf),R.__cacheIndex=O,E[O]=R),R}_takeBackControlInterpolant(E){let O=this._controlInterpolants,R=E.__cacheIndex,z=--this._nActiveControlInterpolants,V=O[z];E.__cacheIndex=z,O[z]=E,V.__cacheIndex=R,O[R]=V}clipAction(E,O,R){let z=O||this._root,V=z.uuid,j=typeof E=="string"?bp.findByName(z,E):E,Y=j!==null?j.uuid:E,ee=this._actionsByClip[Y],se=null;if(R===void 0&&(R=j!==null?j.blendMode:Wr),ee!==void 0){let E=ee.actionByRoot[V];if(E!==void 0&&E.blendMode===R)return E;se=ee.knownActions[0],j===null&&(j=se._clip)}if(j===null)return null;let he=new bf(this,j,O,R);return this._bindAction(he,se),this._addInactiveAction(he,Y,V),he}existingAction(E,O){let R=O||this._root,z=R.uuid,V=typeof E=="string"?bp.findByName(R,E):E,j=V?V.uuid:E,Y=this._actionsByClip[j];return Y!==void 0&&Y.actionByRoot[z]||null}stopAllAction(){let E=this._actions,O=this._nActiveActions;for(let R=O-1;R>=0;--R)E[R].stop();return this}update(E){E*=this.timeScale;let O=this._actions,R=this._nActiveActions,z=this.time+=E,V=Math.sign(E),j=this._accuIndex^=1;for(let Y=0;Y!==R;++Y)O[Y]._update(z,E,V,j);let Y=this._bindings,ee=this._nActiveBindings;for(let E=0;E!==ee;++E)Y[E].apply(j);return this}setTime(E){this.time=0;for(let E=0;E<this._actions.length;E++)this._actions[E].time=0;return this.update(E)}getRoot(){return this._root}uncacheClip(E){let O=this._actions,R=E.uuid,z=this._actionsByClip,V=z[R];if(V!==void 0){let E=V.knownActions;for(let R=0,z=E.length;R!==z;++R){let z=E[R];this._deactivateAction(z);let V=z._cacheIndex,j=O[O.length-1];z._cacheIndex=null,z._byClipCacheIndex=null,j._cacheIndex=V,O[V]=j,O.pop(),this._removeInactiveBindingsForAction(z)}delete z[R]}}uncacheRoot(E){let O=E.uuid,R=this._actionsByClip;for(let E in R){let z=R[E].actionByRoot,V=z[O];V!==void 0&&(this._deactivateAction(V),this._removeInactiveAction(V))}let z=this._bindingsByRootAndName,V=z[O];if(V!==void 0)for(let E in V){let O=V[E];O.restoreOriginalState(),this._removeInactiveBinding(O)}}uncacheAction(E,O){let R=this.existingAction(E,O);R!==null&&(this._deactivateAction(R),this._removeInactiveAction(R))}},_f=class{constructor(E){this.value=E}clone(){return new _f(this.value.clone===void 0?this.value:this.value.clone())}};var Af=class{constructor(E,O,R=0,z=1/0){this.ray=new Ms(E,O),this.near=R,this.far=z,this.camera=null,this.layers=new Fs,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(E,O){this.ray.set(E,O)}setFromCamera(E,O){O.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(O.matrixWorld),this.ray.direction.set(E.x,E.y,.5).unproject(O).sub(this.ray.origin).normalize(),this.camera=O):O.isOrthographicCamera?(this.ray.origin.set(E.x,E.y,(O.near+O.far)/(O.near-O.far)).unproject(O),this.ray.direction.set(0,0,-1).transformDirection(O.matrixWorld),this.camera=O):console.error("THREE.Raycaster: Unsupported camera type: "+O.type)}intersectObject(E,O=!0,R=[]){return GS(E,this,R,O),R.sort(oP),R}intersectObjects(E,O=!0,R=[]){for(let z=0,V=E.length;z<V;z++)GS(E[z],this,R,O);return R.sort(oP),R}};function oP(E,O){return E.distance-O.distance}function GS(E,O,R,z){if(E.layers.test(O.layers)&&E.raycast(O,R),z===!0){let z=E.children;for(let E=0,V=z.length;E<V;E++)GS(z[E],O,R,!0)}}var Mf=class{constructor(E=1,O=0,R=0){return this.radius=E,this.phi=O,this.theta=R,this}set(E,O,R){return this.radius=E,this.phi=O,this.theta=R,this}copy(E){return this.radius=E.radius,this.phi=E.phi,this.theta=E.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(E){return this.setFromCartesianCoords(E.x,E.y,E.z)}setFromCartesianCoords(E,O,R){return this.radius=Math.sqrt(E*E+O*O+R*R),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(E,R),this.phi=Math.acos(pi(O/this.radius,-1,1))),this}clone(){return(new this.constructor).copy(this)}};var Ef=new bn,Cf=class{constructor(E=new bn(1/0,1/0),O=new bn(-1/0,-1/0)){this.isBox2=!0,this.min=E,this.max=O}set(E,O){return this.min.copy(E),this.max.copy(O),this}setFromPoints(E){this.makeEmpty();for(let O=0,R=E.length;O<R;O++)this.expandByPoint(E[O]);return this}setFromCenterAndSize(E,O){let R=Ef.copy(O).multiplyScalar(.5);return this.min.copy(E).sub(R),this.max.copy(E).add(R),this}clone(){return(new this.constructor).copy(this)}copy(E){return this.min.copy(E.min),this.max.copy(E.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(E){return this.isEmpty()?E.set(0,0):E.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(E){return this.isEmpty()?E.set(0,0):E.subVectors(this.max,this.min)}expandByPoint(E){return this.min.min(E),this.max.max(E),this}expandByVector(E){return this.min.sub(E),this.max.add(E),this}expandByScalar(E){return this.min.addScalar(-E),this.max.addScalar(E),this}containsPoint(E){return!(E.x<this.min.x||E.x>this.max.x||E.y<this.min.y||E.y>this.max.y)}containsBox(E){return this.min.x<=E.min.x&&E.max.x<=this.max.x&&this.min.y<=E.min.y&&E.max.y<=this.max.y}getParameter(E,O){return O.set((E.x-this.min.x)/(this.max.x-this.min.x),(E.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(E){return!(E.max.x<this.min.x||E.min.x>this.max.x||E.max.y<this.min.y||E.min.y>this.max.y)}clampPoint(E,O){return O.copy(E).clamp(this.min,this.max)}distanceToPoint(E){return Ef.copy(E).clamp(this.min,this.max).sub(E).length()}intersect(E){return this.min.max(E.min),this.max.min(E.max),this}union(E){return this.min.min(E.min),this.max.max(E.max),this}translate(E){return this.min.add(E),this.max.add(E),this}equals(E){return E.min.equals(this.min)&&E.max.equals(this.max)}},Tf=new Wn,Pf=new Wn,Df=class{constructor(E=new Wn,O=new Wn){this.start=E,this.end=O}set(E,O){return this.start.copy(E),this.end.copy(O),this}copy(E){return this.start.copy(E.start),this.end.copy(E.end),this}getCenter(E){return E.addVectors(this.start,this.end).multiplyScalar(.5)}delta(E){return E.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(E,O){return this.delta(O).multiplyScalar(E).add(this.start)}closestPointToPointParameter(E,O){Tf.subVectors(E,this.start),Pf.subVectors(this.end,this.start);let R=Pf.dot(Pf),z=Pf.dot(Tf)/R;return O&&(z=pi(z,0,1)),z}closestPointToPoint(E,O,R){let z=this.closestPointToPointParameter(E,O);return this.delta(R).multiplyScalar(z).add(this.start)}applyMatrix4(E){return this.start.applyMatrix4(E),this.end.applyMatrix4(E),this}equals(E){return E.start.equals(this.start)&&E.end.equals(this.end)}clone(){return(new this.constructor).copy(this)}},If=new Wn,Of=class extends ra{constructor(E,O){super(),this.light=E,this.matrix=E.matrixWorld,this.matrixAutoUpdate=!1,this.color=O,this.type="SpotLightHelper";let R=new Na,z=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let E=0,O=1,R=32;E<R;E++,O++){let V=E/R*Math.PI*2,j=O/R*Math.PI*2;z.push(Math.cos(V),Math.sin(V),1,Math.cos(j),Math.sin(j),1)}R.setAttribute("position",new Ma(z,3));let V=new cu({fog:!1,toneMapped:!1});this.cone=new wu(R,V),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1);let E=this.light.distance?this.light.distance:1e3,O=E*Math.tan(this.light.angle);this.cone.scale.set(O,O,E),If.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(If),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}};var Rf=class extends eo{constructor(E,O,R){let z=new $u(O,4,2),V=new xa({wireframe:!0,fog:!1,toneMapped:!1});super(z,V),this.light=E,this.color=R,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}};var Lf=new Wn,Bf=new Wn,zf=new Wn,Nf=class extends ra{constructor(E,O,R){super(),this.light=E,this.matrix=E.matrixWorld,this.matrixAutoUpdate=!1,this.color=R,this.type="DirectionalLightHelper",O===void 0&&(O=1);let z=new Na;z.setAttribute("position",new Ma([-O,O,0,O,O,0,O,-O,0,-O,-O,0,-O,O,0],3));let V=new cu({fog:!1,toneMapped:!1});this.lightPlane=new gu(z,V),this.add(this.lightPlane),z=new Na,z.setAttribute("position",new Ma([0,0,0,0,0,1],3)),this.targetLine=new gu(z,V),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),Lf.setFromMatrixPosition(this.light.matrixWorld),Bf.setFromMatrixPosition(this.light.target.matrixWorld),zf.subVectors(Bf,Lf),this.lightPlane.lookAt(Bf),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(Bf),this.targetLine.scale.z=zf.length()}},Uf=new Wn,Vf=new co,jf=class extends wu{constructor(E){let O=new Na,R=new cu({color:16777215,vertexColors:!0,toneMapped:!1}),z=[],V=[],j={};a("n1","n2"),a("n2","n4"),a("n4","n3"),a("n3","n1"),a("f1","f2"),a("f2","f4"),a("f4","f3"),a("f3","f1"),a("n1","f1"),a("n2","f2"),a("n3","f3"),a("n4","f4"),a("p","n1"),a("p","n2"),a("p","n3"),a("p","n4"),a("u1","u2"),a("u2","u3"),a("u3","u1"),a("c","t"),a("p","c"),a("cn1","cn2"),a("cn3","cn4"),a("cf1","cf2"),a("cf3","cf4");function a(E,O){l(E),l(O)}function l(E){z.push(0,0,0),V.push(0,0,0),j[E]===void 0&&(j[E]=[]),j[E].push(z.length/3-1)}O.setAttribute("position",new Ma(z,3)),O.setAttribute("color",new Ma(V,3)),super(O,R),this.type="CameraHelper",this.camera=E,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=E.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=j,this.update();let Y=new On(16755200),ee=new On(16711680),se=new On(43775),he=new On(16777215),ce=new On(3355443);this.setColors(Y,ee,se,he,ce)}setColors(E,O,R,z,V){let j=this.geometry.getAttribute("color");j.setXYZ(0,E.r,E.g,E.b),j.setXYZ(1,E.r,E.g,E.b),j.setXYZ(2,E.r,E.g,E.b),j.setXYZ(3,E.r,E.g,E.b),j.setXYZ(4,E.r,E.g,E.b),j.setXYZ(5,E.r,E.g,E.b),j.setXYZ(6,E.r,E.g,E.b),j.setXYZ(7,E.r,E.g,E.b),j.setXYZ(8,E.r,E.g,E.b),j.setXYZ(9,E.r,E.g,E.b),j.setXYZ(10,E.r,E.g,E.b),j.setXYZ(11,E.r,E.g,E.b),j.setXYZ(12,E.r,E.g,E.b),j.setXYZ(13,E.r,E.g,E.b),j.setXYZ(14,E.r,E.g,E.b),j.setXYZ(15,E.r,E.g,E.b),j.setXYZ(16,E.r,E.g,E.b),j.setXYZ(17,E.r,E.g,E.b),j.setXYZ(18,E.r,E.g,E.b),j.setXYZ(19,E.r,E.g,E.b),j.setXYZ(20,E.r,E.g,E.b),j.setXYZ(21,E.r,E.g,E.b),j.setXYZ(22,E.r,E.g,E.b),j.setXYZ(23,E.r,E.g,E.b),j.setXYZ(24,O.r,O.g,O.b),j.setXYZ(25,O.r,O.g,O.b),j.setXYZ(26,O.r,O.g,O.b),j.setXYZ(27,O.r,O.g,O.b),j.setXYZ(28,O.r,O.g,O.b),j.setXYZ(29,O.r,O.g,O.b),j.setXYZ(30,O.r,O.g,O.b),j.setXYZ(31,O.r,O.g,O.b),j.setXYZ(32,R.r,R.g,R.b),j.setXYZ(33,R.r,R.g,R.b),j.setXYZ(34,R.r,R.g,R.b),j.setXYZ(35,R.r,R.g,R.b),j.setXYZ(36,R.r,R.g,R.b),j.setXYZ(37,R.r,R.g,R.b),j.setXYZ(38,z.r,z.g,z.b),j.setXYZ(39,z.r,z.g,z.b),j.setXYZ(40,V.r,V.g,V.b),j.setXYZ(41,V.r,V.g,V.b),j.setXYZ(42,V.r,V.g,V.b),j.setXYZ(43,V.r,V.g,V.b),j.setXYZ(44,V.r,V.g,V.b),j.setXYZ(45,V.r,V.g,V.b),j.setXYZ(46,V.r,V.g,V.b),j.setXYZ(47,V.r,V.g,V.b),j.setXYZ(48,V.r,V.g,V.b),j.setXYZ(49,V.r,V.g,V.b),j.needsUpdate=!0}update(){let E=this.geometry,O=this.pointMap,R=1,z=1;Vf.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),ei("c",O,E,Vf,0,0,-1),ei("t",O,E,Vf,0,0,1),ei("n1",O,E,Vf,-R,-z,-1),ei("n2",O,E,Vf,R,-z,-1),ei("n3",O,E,Vf,-R,z,-1),ei("n4",O,E,Vf,R,z,-1),ei("f1",O,E,Vf,-R,-z,1),ei("f2",O,E,Vf,R,-z,1),ei("f3",O,E,Vf,-R,z,1),ei("f4",O,E,Vf,R,z,1),ei("u1",O,E,Vf,R*.7,z*1.1,-1),ei("u2",O,E,Vf,.7*-R,z*1.1,-1),ei("u3",O,E,Vf,0,z*2,-1),ei("cf1",O,E,Vf,-R,0,1),ei("cf2",O,E,Vf,R,0,1),ei("cf3",O,E,Vf,0,-z,1),ei("cf4",O,E,Vf,0,z,1),ei("cn1",O,E,Vf,-R,0,-1),ei("cn2",O,E,Vf,R,0,-1),ei("cn3",O,E,Vf,0,-z,-1),ei("cn4",O,E,Vf,0,z,-1),E.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}};function ei(E,O,R,z,V,j,Y){Uf.set(V,j,Y).unproject(z);let ee=O[E];if(ee!==void 0){let E=R.getAttribute("position");for(let O=0,R=ee.length;O<R;O++)E.setXYZ(ee[O],Uf.x,Uf.y,Uf.z)}}var qf=class extends wu{constructor(E,O=16776960){let R=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),z=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],V=new Na;V.setIndex(new Sa(R,1)),V.setAttribute("position",new Ma(z,3)),super(V,new cu({color:O,toneMapped:!1})),this.box=E,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(E){let O=this.box;O.isEmpty()||(O.getCenter(this.position),O.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(E))}dispose(){this.geometry.dispose(),this.material.dispose()}};var Xf=class extends wu{constructor(E=1){let O=[0,0,0,E,0,0,0,0,0,0,E,0,0,0,0,0,0,E],R=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],z=new Na;z.setAttribute("position",new Ma(O,3)),z.setAttribute("color",new Ma(R,3));let V=new cu({vertexColors:!0,toneMapped:!1});super(z,V),this.type="AxesHelper"}setColors(E,O,R){let z=new On,V=this.geometry.attributes.color.array;return z.set(E),z.toArray(V,0),z.toArray(V,3),z.set(O),z.toArray(V,6),z.toArray(V,9),z.set(R),z.toArray(V,12),z.toArray(V,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}};var Yf=m5();function m5(){let E=new ArrayBuffer(4),O=new Float32Array(E),R=new Uint32Array(E),z=new Uint32Array(512),V=new Uint32Array(512);for(let E=0;E<256;++E){let O=E-127;O<-27?(z[E]=0,z[E|256]=32768,V[E]=24,V[E|256]=24):O<-14?(z[E]=1024>>-O-14,z[E|256]=1024>>-O-14|32768,V[E]=-O-1,V[E|256]=-O-1):O<=15?(z[E]=O+15<<10,z[E|256]=O+15<<10|32768,V[E]=13,V[E|256]=13):O<128?(z[E]=31744,z[E|256]=64512,V[E]=24,V[E|256]=24):(z[E]=31744,z[E|256]=64512,V[E]=13,V[E|256]=13)}let j=new Uint32Array(2048),Y=new Uint32Array(64),ee=new Uint32Array(64);for(let E=1;E<1024;++E){let O=E<<13,R=0;for(;(O&8388608)===0;)O<<=1,R-=8388608;O&=-8388609,R+=947912704,j[E]=O|R}for(let E=1024;E<2048;++E)j[E]=939524096+(E-1024<<13);for(let E=1;E<31;++E)Y[E]=E<<23;Y[31]=1199570944,Y[32]=2147483648;for(let E=33;E<63;++E)Y[E]=2147483648+(E-32<<23);Y[63]=3347054592;for(let E=1;E<64;++E)E!==32&&(ee[E]=1024);return{floatView:O,uint32View:R,baseTable:z,shiftTable:V,mantissaTable:j,exponentTable:Y,offsetTable:ee}}function g5(E){Math.abs(E)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),E=pi(E,-65504,65504),Yf.floatView[0]=E;let O=Yf.uint32View[0],R=O>>23&511;return Yf.baseTable[R]+((O&8388607)>>Yf.shiftTable[R])}function y5(E){let O=E>>10;return Yf.uint32View[0]=Yf.mantissaTable[Yf.offsetTable[O]+(E&1023)]+Yf.exponentTable[O],Yf.floatView[0]}var Qf=Object.freeze({__proto__:null,fromHalfFloat:y5,toHalfFloat:g5});typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:ve}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=ve);var Zf=".",Kf=Symbol("target"),$f=Symbol("unsubscribe");function Lp(E){return E instanceof Date||E instanceof Set||E instanceof Map||E instanceof WeakSet||E instanceof WeakMap||ArrayBuffer.isView(E)}function RP(E){return(typeof E=="object"?E===null:typeof E!="function")||E instanceof RegExp}var em=Array.isArray;function Rc(E){return typeof E=="symbol"}var tm={after:(E,O)=>em(E)?E.slice(O.length):O===""?E:E.slice(O.length+1),concat:(E,O)=>em(E)?(E=[...E],O&&E.push(O),E):O&&O.toString!==void 0?(E!==""&&(E+=Zf),Rc(O)?E+O.toString():E+O):E,initial:E=>{if(em(E))return E.slice(0,-1);if(E==="")return E;let O=E.lastIndexOf(Zf);return O===-1?"":E.slice(0,O)},last:E=>{if(em(E))return E[E.length-1]||"";if(E==="")return E;let O=E.lastIndexOf(Zf);return O===-1?E:E.slice(O+1)},walk:(E,O)=>{if(em(E))for(let R of E)O(R);else if(E!==""){let R=0,z=E.indexOf(Zf);if(z===-1)O(E);else for(;R<E.length;)z===-1&&(z=E.length),O(E.slice(R,z)),R=z+1,z=E.indexOf(Zf,R)}},get(E,O){return this.walk(O,(O=>{E&&(E=E[O])})),E}},im=tm;function tw(E){return typeof E=="object"&&typeof E.next=="function"}function rw(E,O,R,z,V){let j=E.next;if(O.name==="entries")E.next=function(){let E=j.call(this);return E.done===!1&&(E.value[0]=V(E.value[0],O,E.value[0],z),E.value[1]=V(E.value[1],O,E.value[0],z)),E};else if(O.name==="values"){let Y=R[Kf].keys();E.next=function(){let E=j.call(this);return E.done===!1&&(E.value=V(E.value,O,Y.next().value,z)),E}}else E.next=function(){let E=j.call(this);return E.done===!1&&(E.value=V(E.value,O,E.value,z)),E};return E}function ky(E,O,R){return E.isUnsubscribed||O.ignoreSymbols&&Rc(R)||O.ignoreUnderscores&&R.charAt(0)==="_"||"ignoreKeys"in O&&O.ignoreKeys.includes(R)}var sm=class{constructor(E){this._equals=E,this._proxyCache=new WeakMap,this._pathCache=new WeakMap,this.isUnsubscribed=!1}_getDescriptorCache(){return this._descriptorCache===void 0&&(this._descriptorCache=new WeakMap),this._descriptorCache}_getProperties(E){let O=this._getDescriptorCache(),R=O.get(E);return R===void 0&&(R={},O.set(E,R)),R}_getOwnPropertyDescriptor(E,O){if(this.isUnsubscribed)return Reflect.getOwnPropertyDescriptor(E,O);let R=this._getProperties(E),z=R[O];return z===void 0&&(z=Reflect.getOwnPropertyDescriptor(E,O),R[O]=z),z}getProxy(E,O,R,z){if(this.isUnsubscribed)return E;let V=E[z],j=V||E;this._pathCache.set(j,O);let Y=this._proxyCache.get(j);return Y===void 0&&(Y=V===void 0?new Proxy(E,R):E,this._proxyCache.set(j,Y)),Y}getPath(E){return this.isUnsubscribed?void 0:this._pathCache.get(E)}isDetached(E,O){return!Object.is(E,im.get(O,this.getPath(E)))}defineProperty(E,O,R){return!!Reflect.defineProperty(E,O,R)&&(this.isUnsubscribed||(this._getProperties(E)[O]=R),!0)}setProperty(E,O,R,z,V){if(!this._equals(V,R)||!(O in E)){let V=this._getOwnPropertyDescriptor(E,O);return V!==void 0&&"set"in V?Reflect.set(E,O,R,z):Reflect.set(E,O,R)}return!0}deleteProperty(E,O,R){if(Reflect.deleteProperty(E,O)){if(!this.isUnsubscribed){let z=this._getDescriptorCache().get(E);z&&(delete z[O],this._pathCache.delete(R))}return!0}return!1}isSameDescriptor(E,O,R){let z=this._getOwnPropertyDescriptor(O,R);return E!==void 0&&z!==void 0&&Object.is(E.value,z.value)&&(E.writable||!1)===(z.writable||!1)&&(E.enumerable||!1)===(z.enumerable||!1)&&(E.configurable||!1)===(z.configurable||!1)&&E.get===z.get&&E.set===z.set}isGetInvariant(E,O){let R=this._getOwnPropertyDescriptor(E,O);return R!==void 0&&R.configurable!==!0&&R.writable!==!0}unsubscribe(){this._descriptorCache=null,this._pathCache=null,this._proxyCache=null,this.isUnsubscribed=!0}};function uh(E){return toString.call(E)==="[object Object]"}function hh(){return!0}function xl(E,O){return E.length!==O.length||E.some(((E,R)=>O[R]!==E))}var am=new Set(["hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]);var om=new Set(["concat","includes","indexOf","join","keys","lastIndexOf"]),lm={push:hh,pop:hh,shift:hh,unshift:hh,copyWithin:xl,reverse:xl,sort:xl,splice:xl,flat:xl,fill:xl},hm=new Set([...am,...om,...Object.keys(lm)]);function dh(E,O){if(E.size!==O.size)return!0;for(let R of E)if(!O.has(R))return!0;return!1}var cm=["keys","values","entries"],dm=new Set(["has","toString"]),um={add:dh,clear:dh,delete:dh,forEach:dh},pm=new Set([...dm,...Object.keys(um),...cm]);function fh(E,O){if(E.size!==O.size)return!0;let R;for(let[z,V]of E)if(R=O.get(z),R!==V||R===void 0&&!O.has(z))return!0;return!1}var mm=new Set([...dm,"get"]),gm={set:fh,clear:fh,delete:fh,forEach:fh},vm=new Set([...mm,...Object.keys(gm),...cm]);var ym=class{constructor(E,O,R,z){this._path=O,this._isChanged=!1,this._clonedCache=new Set,this._hasOnValidate=z,this._changes=z?[]:null,this.clone=O===void 0?E:this._shallowClone(E)}static isHandledMethod(E){return am.has(E)}_shallowClone(E){let O=E;if(uh(E))O={...E};else if(em(E))O=[...E];else if(E instanceof Date)O=new Date(E);else if(E instanceof Set)O=new Set([...E].map((E=>this._shallowClone(E))));else if(E instanceof Map){O=new Map;for(let[R,z]of E.entries())O.set(R,this._shallowClone(z))}return this._clonedCache.add(O),O}preferredThisArg(E,O,R,z){return E?(em(z)?this._onIsChanged=lm[O]:z instanceof Set?this._onIsChanged=um[O]:z instanceof Map&&(this._onIsChanged=gm[O]),z):R}update(E,O,R){let z=im.after(E,this._path);if(O!=="length"){let E=this.clone;im.walk(z,(O=>{E&&E[O]&&(this._clonedCache.has(E[O])||(E[O]=this._shallowClone(E[O])),E=E[O])})),this._hasOnValidate&&this._changes.push({path:z,property:O,previous:R}),E&&E[O]&&(E[O]=R)}this._isChanged=!0}undo(E){let O;for(let R=this._changes.length-1;R!==-1;R--)O=this._changes[R],im.get(E,O.path)[O.property]=O.previous}isChanged(E){return this._onIsChanged===void 0?this._isChanged:this._onIsChanged(this.clone,E)}};var xm=class extends ym{static isHandledMethod(E){return hm.has(E)}};var _m=class extends ym{undo(E){E.setTime(this.clone.getTime())}isChanged(E,O){return!O(this.clone.valueOf(),E.valueOf())}};var Mm=class extends ym{static isHandledMethod(E){return pm.has(E)}undo(E){for(let O of this.clone)E.add(O);for(let O of E)this.clone.has(O)||E.delete(O)}};var Em=class extends ym{static isHandledMethod(E){return vm.has(E)}undo(E){for(let[O,R]of this.clone.entries())E.set(O,R);for(let O of E.keys())this.clone.has(O)||E.delete(O)}};var Cm=class extends ym{constructor(E,O,R,z){super(void 0,O,R,z),this._arg1=R[0],this._weakValue=E.has(this._arg1)}isChanged(E){return this._weakValue!==E.has(this._arg1)}undo(E){this._weakValue&&!E.has(this._arg1)?E.add(this._arg1):E.delete(this._arg1)}};var Tm=class extends ym{constructor(E,O,R,z){super(void 0,O,R,z),this._weakKey=R[0],this._weakHas=E.has(this._weakKey),this._weakValue=E.get(this._weakKey)}isChanged(E){return this._weakValue!==E.get(this._weakKey)}undo(E){let O=E.has(this._weakKey);this._weakHas&&!O?E.set(this._weakKey,this._weakValue):!this._weakHas&&O?E.delete(this._weakKey):this._weakValue!==E.get(this._weakKey)&&E.set(this._weakKey,this._weakValue)}};var Pm=class{constructor(E){this._stack=[],this._hasOnValidate=E}static isHandledType(E){return uh(E)||em(E)||Lp(E)}static isHandledMethod(E,O){return uh(E)?ym.isHandledMethod(O):em(E)?xm.isHandledMethod(O):E instanceof Set?Mm.isHandledMethod(O):E instanceof Map?Em.isHandledMethod(O):Lp(E)}get isCloning(){return this._stack.length>0}start(E,O,R){let z=ym;em(E)?z=xm:E instanceof Date?z=_m:E instanceof Set?z=Mm:E instanceof Map?z=Em:E instanceof WeakSet?z=Cm:E instanceof WeakMap&&(z=Tm),this._stack.push(new z(E,O,R,this._hasOnValidate))}update(E,O,R){this._stack[this._stack.length-1].update(E,O,R)}preferredThisArg(E,O,R){let{name:z}=E,V=Pm.isHandledMethod(R,z);return this._stack[this._stack.length-1].preferredThisArg(V,z,O,R)}isChanged(E,O,R){return this._stack[this._stack.length-1].isChanged(E,O,R)}undo(E){this._previousClone!==void 0&&this._previousClone.undo(E)}stop(){return this._previousClone=this._stack.pop(),this._previousClone.clone}};var Im={equals:Object.is,isShallow:!1,pathAsArray:!1,ignoreSymbols:!1,ignoreUnderscores:!1,ignoreDetached:!1,details:!1},lw=(E,O,R={})=>{R={...Im,...R};let z=Symbol("ProxyTarget"),{equals:V,isShallow:j,ignoreDetached:Y,details:ee}=R,se=new sm(V),he=typeof R.onValidate=="function",ce=new Pm(he),h=(E,O,z,V,j)=>!he||ce.isCloning||R.onValidate(im.concat(se.getPath(E),O),z,V,j)===!0,d=(O,z,V,j)=>{!ky(se,R,z)&&!(Y&&se.isDetached(O,E))&&f(se.getPath(O),z,V,j)},f=(E,R,z,V,j)=>{ce.isCloning?ce.update(E,R,V):O(im.concat(E,R),z,V,j)},p=E=>E&&(E[z]||E),m=(O,V,ee,he)=>RP(O)||ee==="constructor"||j&&!Pm.isHandledMethod(V,ee)||ky(se,R,ee)||se.isGetInvariant(V,ee)||Y&&se.isDetached(V,E)?O:(he===void 0&&(he=se.getPath(V)),se.getProxy(O,im.concat(he,ee),ue,z)),ue={get(E,O,R){if(Rc(O)){if(O===z||O===Kf)return E;if(O===$f&&!se.isUnsubscribed&&se.getPath(E).length===0)return se.unsubscribe(),E}let V=Lp(E)?Reflect.get(E,O):Reflect.get(E,O,R);return m(V,E,O)},set(E,O,R,j){R=p(R);let Y=E[z]||E,ee=Y[O];if(V(ee,R)&&O in E)return!0;let he=h(E,O,R,ee);return he&&se.setProperty(Y,O,R,j,ee)?(d(E,O,E[O],ee),!0):!he},defineProperty(E,O,R){if(!se.isSameDescriptor(R,E,O)){let z=E[O];h(E,O,R.value,z)&&se.defineProperty(E,O,R,z)&&d(E,O,R.value,z)}return!0},deleteProperty(E,O){if(!Reflect.has(E,O))return!0;let R=Reflect.get(E,O),z=h(E,O,void 0,R);return z&&se.deleteProperty(E,O,R)?(d(E,O,void 0,R),!0):!z},apply(O,R,j){let Y=R[z]||R;if(se.isUnsubscribed)return Reflect.apply(O,Y,j);if((ee===!1||ee!==!0&&!ee.includes(O.name))&&Pm.isHandledType(Y)){let z=im.initial(se.getPath(O)),ee=Pm.isHandledMethod(Y,O.name);ce.start(Y,z,j);let he=Reflect.apply(O,ce.preferredThisArg(O,R,Y),ee?j.map((E=>p(E))):j),fe=ce.isChanged(Y,V),ve=ce.stop();if(Pm.isHandledType(he)&&ee&&(R instanceof Map&&O.name==="get"&&(z=im.concat(z,j[0])),he=se.getProxy(he,z,ue)),fe){let R={name:O.name,args:j,result:he},V=ce.isCloning?im.initial(z):z,ee=ce.isCloning?im.last(z):"";h(im.get(E,V),ee,Y,ve,R)?f(V,ee,Y,ve,R):ce.undo(Y)}return(R instanceof Map||R instanceof Set)&&tw(he)?rw(he,O,R,z,m):he}return Reflect.apply(O,R,j)}},fe=se.getProxy(E,R.pathAsArray?[]:"",ue);return O=O.bind(fe),he&&(R.onValidate=R.onValidate.bind(fe)),fe};lw.target=E=>E&&E[Kf]||E;lw.unsubscribe=E=>E[$f]||E;var Om=lw;var Rm=typeof global=="object"&&global&&global.Object===Object&&global,Lm=Rm;var Bm=typeof self=="object"&&self&&self.Object===Object&&self,Nm=Lm||Bm||Function("return this")(),Um=Nm;var km=Um.Symbol,Vm=km;var jm=Object.prototype,Gm=jm.hasOwnProperty,Hm=jm.toString,Wm=Vm?Vm.toStringTag:void 0;function P5(E){var O=Gm.call(E,Wm),R=E[Wm];try{E[Wm]=void 0;var z=!0}catch{}var V=Hm.call(E);return z&&(O?E[Wm]=R:delete E[Wm]),V}var qm=P5;var Xm=Object.prototype,Ym=Xm.toString;function D5(E){return Ym.call(E)}var Qm=D5;var Zm="[object Null]",eg="[object Undefined]",tg=Vm?Vm.toStringTag:void 0;function L5(E){return E==null?E===void 0?eg:Zm:tg&&tg in Object(E)?qm(E):Qm(E)}var ig=L5;function B5(E){return E!=null&&typeof E=="object"}var rg=B5;var ng="[object Symbol]";function F5(E){return typeof E=="symbol"||rg(E)&&ig(E)==ng}var sg=F5;function V5(E,O){for(var R=-1,z=E==null?0:E.length,V=Array(z);++R<z;)V[R]=O(E[R],R,E);return V}var og=V5;var hg=Array.isArray,dg=hg;var pg=1/0,fg=Vm?Vm.prototype:void 0,mg=fg?fg.toString:void 0;function jP(E){if(typeof E=="string")return E;if(dg(E))return og(E,jP)+"";if(sg(E))return mg?mg.call(E):"";var O=E+"";return O=="0"&&1/E==-pg?"-0":O}var gg=jP;var vg=/\s/;function G5(E){for(var O=E.length;O--&&vg.test(E.charAt(O)););return O}var yg=G5;var xg=/^\s+/;function H5(E){return E&&E.slice(0,yg(E)+1).replace(xg,"")}var bg=H5;function W5(E){var O=typeof E;return E!=null&&(O=="object"||O=="function")}var wg=W5;var Ag=NaN,Mg=/^[-+]0x[0-9a-f]+$/i,Eg=/^0b[01]+$/i,Tg=/^0o[0-7]+$/i,Pg=parseInt;function Q5(E){if(typeof E=="number")return E;if(sg(E))return Ag;if(wg(E)){var O=typeof E.valueOf=="function"?E.valueOf():E;E=wg(O)?O+"":O}if(typeof E!="string")return E===0?E:+E;E=bg(E);var R=Eg.test(E);return R||Tg.test(E)?Pg(E.slice(2),R?2:8):Mg.test(E)?Ag:+E}var Dg=Q5;function Z5(E){return E}var Ig=Z5;var Og="[object AsyncFunction]",Lg="[object Function]",zg="[object GeneratorFunction]",Fg="[object Proxy]";function rj(E){if(!wg(E))return!1;var O=ig(E);return O==Lg||O==zg||O==Og||O==Fg}var Ng=rj;var Ug=Um["__core-js_shared__"],kg=Ug;var Vg=function(){var E=/[^.]+$/.exec(kg&&kg.keys&&kg.keys.IE_PROTO||"");return E?"Symbol(src)_1."+E:""}();function nj(E){return!!Vg&&Vg in E}var jg=nj;var Gg=Function.prototype,Hg=Gg.toString;function aj(E){if(E!=null){try{return Hg.call(E)}catch{}try{return E+""}catch{}}return""}var Wg=aj;var qg=/[\\^$.*+?()[\]{}|]/g,Xg=/^\[object .+?Constructor\]$/,Qg=Function.prototype,Kg=Object.prototype,Jg=Qg.toString,$g=Kg.hasOwnProperty,ev=RegExp("^"+Jg.call($g).replace(qg,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function mj(E){if(!wg(E)||jg(E))return!1;var O=Ng(E)?ev:Xg;return O.test(Wg(E))}var tv=mj;function gj(E,O){return E?.[O]}var iv=gj;function yj(E,O){var R=iv(E,O);return tv(R)?R:void 0}var rv=yj;var nv=rv(Um,"WeakMap"),sv=nv;var av=Object.create,ov=function(){function n(){}return function(E){if(!wg(E))return{};if(av)return av(E);n.prototype=E;var O=new n;return n.prototype=void 0,O}}(),lv=ov;function bj(E,O,R){switch(R.length){case 0:return E.call(O);case 1:return E.call(O,R[0]);case 2:return E.call(O,R[0],R[1]);case 3:return E.call(O,R[0],R[1],R[2])}return E.apply(O,R)}var dv=bj;function Sj(E,O){var R=-1,z=E.length;for(O||(O=Array(z));++R<z;)O[R]=E[R];return O}var uv=Sj;var pv=800,fv=16,vv=Date.now;function Tj(E){var O=0,R=0;return function(){var z=vv(),V=fv-(z-R);if(R=z,V>0){if(++O>=pv)return arguments[0]}else O=0;return E.apply(void 0,arguments)}}var xv=Tj;function Mj(E){return function(){return E}}var wv=Mj;var Av=function(){try{var E=rv(Object,"defineProperty");return E({},"",{}),E}catch{}}(),Cv=Av;var Pv=Cv?function(E,O){return Cv(E,"toString",{configurable:!0,enumerable:!1,value:wv(O),writable:!0})}:Ig,Iv=Pv;var Lv=xv(Iv),Bv=Lv;function Ij(E,O){for(var R=-1,z=E==null?0:E.length;++R<z&&O(E[R],R,E)!==!1;);return E}var zv=Ij;var Fv=9007199254740991,Nv=/^(?:0|[1-9]\d*)$/;function Rj(E,O){var R=typeof E;return O=O??Fv,!!O&&(R=="number"||R!="symbol"&&Nv.test(E))&&E>-1&&E%1==0&&E<O}var Uv=Rj;function Lj(E,O,R){O=="__proto__"&&Cv?Cv(E,O,{configurable:!0,enumerable:!0,value:R,writable:!0}):E[O]=R}var kv=Lj;function Bj(E,O){return E===O||E!==E&&O!==O}var Vv=Bj;var jv=Object.prototype,Gv=jv.hasOwnProperty;function Vj(E,O,R){var z=E[O];(!(Gv.call(E,O)&&Vv(z,R))||R===void 0&&!(O in E))&&kv(E,O,R)}var Hv=Vj;function Uj(E,O,R,z){var V=!R;R||(R={});for(var j=-1,Y=O.length;++j<Y;){var ee=O[j],se=z?z(R[ee],E[ee],ee,R,E):void 0;se===void 0&&(se=E[ee]),V?kv(R,ee,se):Hv(R,ee,se)}return R}var Wv=Uj;var qv=Math.max;function zj(E,O,R){return O=qv(O===void 0?E.length-1:O,0),function(){for(var z=arguments,V=-1,j=qv(z.length-O,0),Y=Array(j);++V<j;)Y[V]=z[O+V];V=-1;for(var ee=Array(O+1);++V<O;)ee[V]=z[V];return ee[O]=R(Y),dv(E,this,ee)}}var Xv=zj;var Yv=9007199254740991;function Gj(E){return typeof E=="number"&&E>-1&&E%1==0&&E<=Yv}var Qv=Gj;function jj(E){return E!=null&&Qv(E.length)&&!Ng(E)}var Zv=jj;var Kv=Object.prototype;function Wj(E){var O=E&&E.constructor,R=typeof O=="function"&&O.prototype||Kv;return E===R}var Jv=Wj;function qj(E,O){for(var R=-1,z=Array(E);++R<E;)z[R]=O(R);return z}var $v=qj;var ey="[object Arguments]";function Yj(E){return rg(E)&&ig(E)==ey}var ny=Yj;var sy=Object.prototype,oy=sy.hasOwnProperty,ly=sy.propertyIsEnumerable,hy=ny(function(){return arguments}())?ny:function(E){return rg(E)&&oy.call(E,"callee")&&!ly.call(E,"callee")},cy=hy;function Jj(){return!1}var uy=Jj;var py=typeof exports=="object"&&exports&&!exports.nodeType&&exports,fy=py&&typeof module=="object"&&module&&!module.nodeType&&module,my=fy&&fy.exports===py,gy=my?Um.Buffer:void 0,vy=gy?gy.isBuffer:void 0,yy=vy||uy,xy=yy;var by="[object Arguments]",wy="[object Array]",Sy="[object Boolean]",_y="[object Date]",Ay="[object Error]",My="[object Function]",Ey="[object Map]",Cy="[object Number]",Ty="[object Object]",Py="[object RegExp]",Dy="[object Set]",Iy="[object String]",Oy="[object WeakMap]",Ry="[object ArrayBuffer]",Ly="[object DataView]",By="[object Float32Array]",Fy="[object Float64Array]",Ny="[object Int8Array]",Vy="[object Int16Array]",jy="[object Int32Array]",Gy="[object Uint8Array]",Hy="[object Uint8ClampedArray]",Wy="[object Uint16Array]",qy="[object Uint32Array]",Xy={};Xy[By]=Xy[Fy]=Xy[Ny]=Xy[Vy]=Xy[jy]=Xy[Gy]=Xy[Hy]=Xy[Wy]=Xy[qy]=!0;Xy[by]=Xy[wy]=Xy[Ry]=Xy[Sy]=Xy[Ly]=Xy[_y]=Xy[Ay]=Xy[My]=Xy[Ey]=Xy[Cy]=Xy[Ty]=Xy[Py]=Xy[Dy]=Xy[Iy]=Xy[Oy]=!1;function MH(E){return rg(E)&&Qv(E.length)&&!!Xy[ig(E)]}var Yy=MH;function CH(E){return function(O){return E(O)}}var Qy=CH;var Zy=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Ky=Zy&&typeof module=="object"&&module&&!module.nodeType&&module,Jy=Ky&&Ky.exports===Zy,$y=Jy&&Lm.process,ex=function(){try{var E=Ky&&Ky.require&&Ky.require("util").types;return E||$y&&$y.binding&&$y.binding("util")}catch{}}(),tx=ex;var ix=tx&&tx.isTypedArray,rx=ix?Qy(ix):Yy,sx=rx;var ox=Object.prototype,lx=ox.hasOwnProperty;function RH(E,O){var R=dg(E),z=!R&&cy(E),V=!R&&!z&&xy(E),j=!R&&!z&&!V&&sx(E),Y=R||z||V||j,ee=Y?$v(E.length,String):[],se=ee.length;for(var he in E)(O||lx.call(E,he))&&!(Y&&(he=="length"||V&&(he=="offset"||he=="parent")||j&&(he=="buffer"||he=="byteLength"||he=="byteOffset")||Uv(he,se)))&&ee.push(he);return ee}var hx=RH;function LH(E,O){return function(R){return E(O(R))}}var cx=LH;var dx=cx(Object.keys,Object),ux=dx;var px=Object.prototype,fx=px.hasOwnProperty;function VH(E){if(!Jv(E))return ux(E);var O=[];for(var R in Object(E))fx.call(E,R)&&R!="constructor"&&O.push(R);return O}var mx=VH;function UH(E){return Zv(E)?hx(E):mx(E)}var gx=UH;function zH(E){var O=[];if(E!=null)for(var R in Object(E))O.push(R);return O}var yx=zH;var xx=Object.prototype,bx=xx.hasOwnProperty;function jH(E){if(!wg(E))return yx(E);var O=Jv(E),R=[];for(var z in E)z=="constructor"&&(O||!bx.call(E,z))||R.push(z);return R}var wx=jH;function HH(E){return Zv(E)?hx(E,!0):wx(E)}var Sx=HH;var _x=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Ax=/^\w*$/;function XH(E,O){if(dg(E))return!1;var R=typeof E;return!(R!="number"&&R!="symbol"&&R!="boolean"&&E!=null&&!sg(E))||(Ax.test(E)||!_x.test(E)||O!=null&&E in Object(O))}var Mx=XH;var Ex=rv(Object,"create"),Cx=Ex;function KH(){this.__data__=Cx?Cx(null):{},this.size=0}var Tx=KH;function QH(E){var O=this.has(E)&&delete this.__data__[E];return this.size-=O?1:0,O}var Px=QH;var Dx="__lodash_hash_undefined__",Ix=Object.prototype,Ox=Ix.hasOwnProperty;function eW(E){var O=this.__data__;if(Cx){var R=O[E];return R===Dx?void 0:R}return Ox.call(O,E)?O[E]:void 0}var Rx=eW;var Lx=Object.prototype,Bx=Lx.hasOwnProperty;function iW(E){var O=this.__data__;return Cx?O[E]!==void 0:Bx.call(O,E)}var zx=iW;var Fx="__lodash_hash_undefined__";function sW(E,O){var R=this.__data__;return this.size+=this.has(E)?0:1,R[E]=Cx&&O===void 0?Fx:O,this}var Nx=sW;function Mh(E){var O=-1,R=E==null?0:E.length;for(this.clear();++O<R;){var z=E[O];this.set(z[0],z[1])}}Mh.prototype.clear=Tx;Mh.prototype.delete=Px;Mh.prototype.get=Rx;Mh.prototype.has=zx;Mh.prototype.set=Nx;var Ux=Mh;function oW(){this.__data__=[],this.size=0}var kx=oW;function aW(E,O){for(var R=E.length;R--;)if(Vv(E[R][0],O))return R;return-1}var Vx=aW;var jx=Array.prototype,Gx=jx.splice;function uW(E){var O=this.__data__,R=Vx(O,E);if(R<0)return!1;var z=O.length-1;return R==z?O.pop():Gx.call(O,R,1),--this.size,!0}var Hx=uW;function hW(E){var O=this.__data__,R=Vx(O,E);return R<0?void 0:O[R][1]}var Wx=hW;function dW(E){return Vx(this.__data__,E)>-1}var qx=dW;function fW(E,O){var R=this.__data__,z=Vx(R,E);return z<0?(++this.size,R.push([E,O])):R[z][1]=O,this}var Xx=fW;function Ch(E){var O=-1,R=E==null?0:E.length;for(this.clear();++O<R;){var z=E[O];this.set(z[0],z[1])}}Ch.prototype.clear=kx;Ch.prototype.delete=Hx;Ch.prototype.get=Wx;Ch.prototype.has=qx;Ch.prototype.set=Xx;var Qx=Ch;var Jx=rv(Um,"Map"),$x=Jx;function mW(){this.size=0,this.__data__={hash:new Ux,map:new($x||Qx),string:new Ux}}var eb=mW;function gW(E){var O=typeof E;return O=="string"||O=="number"||O=="symbol"||O=="boolean"?E!=="__proto__":E===null}var tb=gW;function yW(E,O){var R=E.__data__;return tb(O)?R[typeof O=="string"?"string":"hash"]:R.map}var ib=yW;function vW(E){var O=ib(this,E).delete(E);return this.size-=O?1:0,O}var rb=vW;function xW(E){return ib(this,E).get(E)}var sb=xW;function bW(E){return ib(this,E).has(E)}var ab=bW;function SW(E,O){var R=ib(this,E),z=R.size;return R.set(E,O),this.size+=R.size==z?0:1,this}var ob=SW;function Ph(E){var O=-1,R=E==null?0:E.length;for(this.clear();++O<R;){var z=E[O];this.set(z[0],z[1])}}Ph.prototype.clear=eb;Ph.prototype.delete=rb;Ph.prototype.get=sb;Ph.prototype.has=ab;Ph.prototype.set=ob;var lb=Ph;var cb="Expected a function";function pw(E,O){if(typeof E!="function"||O!=null&&typeof O!="function")throw new TypeError(cb);var e=function(){var R=arguments,z=O?O.apply(this,R):R[0],V=e.cache;if(V.has(z))return V.get(z);var j=E.apply(this,R);return e.cache=V.set(z,j)||V,j};return e.cache=new(pw.Cache||lb),e}pw.Cache=lb;var db=pw;var ub=500;function EW(E){var O=db(E,(function(E){return R.size===ub&&R.clear(),E})),R=O.cache;return O}var pb=EW;var fb=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,mb=/\\(\\)?/g,gb=pb((function(E){var O=[];return E.charCodeAt(0)===46&&O.push(""),E.replace(fb,(function(E,R,z,V){O.push(z?V.replace(mb,"$1"):R||E)})),O})),vb=gb;function PW(E){return E==null?"":gg(E)}var Mb=PW;function _W(E,O){return dg(E)?E:Mx(E,O)?[E]:vb(Mb(E))}var Eb=_W;var Cb=1/0;function DW(E){if(typeof E=="string"||sg(E))return E;var O=E+"";return O=="0"&&1/E==-Cb?"-0":O}var Tb=DW;function OW(E,O){O=Eb(O,E);for(var R=0,z=O.length;E!=null&&R<z;)E=E[Tb(O[R++])];return R&&R==z?E:void 0}var Db=OW;function RW(E,O){for(var R=-1,z=O.length,V=E.length;++R<z;)E[V+R]=O[R];return E}var Rb=RW;var Lb=Vm?Vm.isConcatSpreadable:void 0;function LW(E){return dg(E)||cy(E)||!!(Lb&&E&&E[Lb])}var Bb=LW;function W_(E,O,R,z,V){var j=-1,Y=E.length;for(R||(R=Bb),V||(V=[]);++j<Y;){var ee=E[j];O>0&&R(ee)?O>1?W_(ee,O-1,R,z,V):Rb(V,ee):z||(V[V.length]=ee)}return V}var zb=W_;function BW(E){var O=E==null?0:E.length;return O?zb(E,1):[]}var Fb=BW;function NW(E){return Bv(Xv(E,void 0,Fb),E+"")}var Nb=NW;var Ub=cx(Object.getPrototypeOf,Object),kb=Ub;var Vb="[object Object]",jb=Function.prototype,Gb=Object.prototype,Hb=jb.toString,Wb=Gb.hasOwnProperty,qb=Hb.call(Object);function jW(E){if(!rg(E)||ig(E)!=Vb)return!1;var O=kb(E);if(O===null)return!0;var R=Wb.call(O,"constructor")&&O.constructor;return typeof R=="function"&&R instanceof R&&Hb.call(R)==qb}var Xb=jW;function HW(E,O,R){var z=-1,V=E.length;O<0&&(O=-O>V?0:V+O),R=R>V?V:R,R<0&&(R+=V),V=O>R?0:R-O>>>0,O>>>=0;for(var j=Array(V);++z<V;)j[z]=E[z+O];return j}var Yb=HW;function WW(){this.__data__=new Qx,this.size=0}var Qb=WW;function qW(E){var O=this.__data__,R=O.delete(E);return this.size=O.size,R}var Zb=qW;function XW(E){return this.__data__.get(E)}var Kb=XW;function YW(E){return this.__data__.has(E)}var Jb=YW;var $b=200;function QW(E,O){var R=this.__data__;if(R instanceof Qx){var z=R.__data__;if(!$x||z.length<$b-1)return z.push([E,O]),this.size=++R.size,this;R=this.__data__=new lb(z)}return R.set(E,O),this.size=R.size,this}var ew=QW;function Dh(E){var O=this.__data__=new Qx(E);this.size=O.size}Dh.prototype.clear=Qb;Dh.prototype.delete=Zb;Dh.prototype.get=Kb;Dh.prototype.has=Jb;Dh.prototype.set=ew;var iw=Dh;function ZW(E,O){return E&&Wv(O,gx(O),E)}var nw=ZW;function JW(E,O){return E&&Wv(O,Sx(O),E)}var sw=JW;var aw=typeof exports=="object"&&exports&&!exports.nodeType&&exports,ow=aw&&typeof module=="object"&&module&&!module.nodeType&&module,hw=ow&&ow.exports===aw,cw=hw?Um.Buffer:void 0,dw=cw?cw.allocUnsafe:void 0;function e6(E,O){if(O)return E.slice();var R=E.length,z=dw?dw(R):new E.constructor(R);return E.copy(z),z}var uw=e6;function t6(E,O){for(var R=-1,z=E==null?0:E.length,V=0,j=[];++R<z;){var Y=E[R];O(Y,R,E)&&(j[V++]=Y)}return j}var fw=t6;function r6(){return[]}var mw=r6;var gw=Object.prototype,vw=gw.propertyIsEnumerable,yw=Object.getOwnPropertySymbols,xw=yw?function(E){return E==null?[]:(E=Object(E),fw(yw(E),(function(O){return vw.call(E,O)})))}:mw,_w=xw;function o6(E,O){return Wv(E,_w(E),O)}var Aw=o6;var Ew=Object.getOwnPropertySymbols,Cw=Ew?function(E){for(var O=[];E;)Rb(O,_w(E)),E=kb(E);return O}:mw,Pw=Cw;function c6(E,O){return Wv(E,Pw(E),O)}var Dw=c6;function u6(E,O,R){var z=O(E);return dg(E)?z:Rb(z,R(E))}var Iw=u6;function h6(E){return Iw(E,gx,_w)}var Lw=h6;function d6(E){return Iw(E,Sx,Pw)}var Bw=d6;var Nw=rv(Um,"DataView"),kw=Nw;var Vw=rv(Um,"Promise"),jw=Vw;var Gw=rv(Um,"Set"),Hw=Gw;var Ww="[object Map]",qw="[object Object]",Xw="[object Promise]",Yw="[object Set]",Qw="[object WeakMap]",Zw="[object DataView]",Kw=Wg(kw),Jw=Wg($x),$w=Wg(jw),eS=Wg(Hw),tS=Wg(sv),iS=ig;(kw&&iS(new kw(new ArrayBuffer(1)))!=Zw||$x&&iS(new $x)!=Ww||jw&&iS(jw.resolve())!=Xw||Hw&&iS(new Hw)!=Yw||sv&&iS(new sv)!=Qw)&&(iS=function(E){var O=ig(E),R=O==qw?E.constructor:void 0,z=R?Wg(R):"";if(z)switch(z){case Kw:return Zw;case Jw:return Ww;case $w:return Xw;case eS:return Yw;case tS:return Qw}return O});var rS=iS;var nS=Object.prototype,sS=nS.hasOwnProperty;function E6(E){var O=E.length,R=new E.constructor(O);return O&&typeof E[0]=="string"&&sS.call(E,"index")&&(R.index=E.index,R.input=E.input),R}var aS=E6;var oS=Um.Uint8Array,lS=oS;function M6(E){var O=new E.constructor(E.byteLength);return new lS(O).set(new lS(E)),O}var hS=M6;function C6(E,O){var R=O?hS(E.buffer):E.buffer;return new E.constructor(R,E.byteOffset,E.byteLength)}var cS=C6;var dS=/\w*$/;function _6(E){var O=new E.constructor(E.source,dS.exec(E));return O.lastIndex=E.lastIndex,O}var uS=_6;var pS=Vm?Vm.prototype:void 0,mS=pS?pS.valueOf:void 0;function I6(E){return mS?Object(mS.call(E)):{}}var gS=I6;function D6(E,O){var R=O?hS(E.buffer):E.buffer;return new E.constructor(R,E.byteOffset,E.length)}var vS=D6;var yS="[object Boolean]",bS="[object Date]",wS="[object Map]",SS="[object Number]",AS="[object RegExp]",MS="[object Set]",ES="[object String]",CS="[object Symbol]",TS="[object ArrayBuffer]",PS="[object DataView]",DS="[object Float32Array]",OS="[object Float64Array]",RS="[object Int8Array]",LS="[object Int16Array]",BS="[object Int32Array]",zS="[object Uint8Array]",FS="[object Uint8ClampedArray]",NS="[object Uint16Array]",US="[object Uint32Array]";function Z6(E,O,R){var z=E.constructor;switch(O){case TS:return hS(E);case yS:case bS:return new z(+E);case PS:return cS(E,R);case DS:case OS:case RS:case LS:case BS:case zS:case FS:case NS:case US:return vS(E,R);case wS:return new z;case SS:case ES:return new z(E);case AS:return uS(E);case MS:return new z;case CS:return gS(E)}}var kS=Z6;function J6(E){return typeof E.constructor!="function"||Jv(E)?{}:lv(kb(E))}var VS=J6;var jS="[object Map]";function e8(E){return rg(E)&&rS(E)==jS}var HS=e8;var WS=tx&&tx.isMap,qS=WS?Qy(WS):HS,XS=qS;var JS="[object Set]";function i8(E){return rg(E)&&rS(E)==JS}var $S=i8;var e_=tx&&tx.isSet,t_=e_?Qy(e_):$S,i_=t_;var r_=1,n_=2,s_=4,a_="[object Arguments]",o_="[object Array]",l_="[object Boolean]",h_="[object Date]",c_="[object Error]",d_="[object Function]",u_="[object GeneratorFunction]",p_="[object Map]",f_="[object Number]",m_="[object Object]",g_="[object RegExp]",v_="[object Set]",y_="[object String]",x_="[object Symbol]",b_="[object WeakMap]",w_="[object ArrayBuffer]",S_="[object DataView]",__="[object Float32Array]",A_="[object Float64Array]",M_="[object Int8Array]",E_="[object Int16Array]",C_="[object Int32Array]",T_="[object Uint8Array]",P_="[object Uint8ClampedArray]",D_="[object Uint16Array]",I_="[object Uint32Array]",O_={};O_[a_]=O_[o_]=O_[w_]=O_[S_]=O_[l_]=O_[h_]=O_[__]=O_[A_]=O_[M_]=O_[E_]=O_[C_]=O_[p_]=O_[f_]=O_[m_]=O_[g_]=O_[v_]=O_[y_]=O_[x_]=O_[T_]=O_[P_]=O_[D_]=O_[I_]=!0;O_[c_]=O_[d_]=O_[b_]=!1;function cv(E,O,R,z,V,j){var Y,ee=O&r_,se=O&n_,he=O&s_;if(R&&(Y=V?R(E,z,V,j):R(E)),Y!==void 0)return Y;if(!wg(E))return E;var ce=dg(E);if(ce){if(Y=aS(E),!ee)return uv(E,Y)}else{var ue=rS(E),fe=ue==d_||ue==u_;if(xy(E))return uw(E,ee);if(ue==m_||ue==a_||fe&&!V){if(Y=se||fe?{}:VS(E),!ee)return se?Dw(E,sw(Y,E)):Aw(E,nw(Y,E))}else{if(!O_[ue])return V?E:{};Y=kS(E,ue,ee)}}j||(j=new iw);var ve=j.get(E);if(ve)return ve;j.set(E,Y),i_(E)?E.forEach((function(z){Y.add(cv(z,O,R,z,E,j))})):XS(E)&&E.forEach((function(z,V){Y.set(V,cv(z,O,R,V,E,j))}));var we=he?se?Bw:Lw:se?Sx:gx,Se=ce?void 0:we(E);return zv(Se||E,(function(z,V){Se&&(V=z,z=E[V]),Hv(Y,V,cv(z,O,R,V,E,j))})),Y}var R_=cv;var L_=1,B_=4;function R8(E){return R_(E,L_|B_)}var z_=R8;var F_="__lodash_hash_undefined__";function B8(E){return this.__data__.set(E,F_),this}var N_=B8;function N8(E){return this.__data__.has(E)}var U_=N8;function hv(E){var O=-1,R=E==null?0:E.length;for(this.__data__=new lb;++O<R;)this.add(E[O])}hv.prototype.add=hv.prototype.push=N_;hv.prototype.has=U_;var k_=hv;function F8(E,O){for(var R=-1,z=E==null?0:E.length;++R<z;)if(O(E[R],R,E))return!0;return!1}var V_=F8;function V8(E,O){return E.has(O)}var j_=V8;var G_=1,H_=2;function k8(E,O,R,z,V,j){var Y=R&G_,ee=E.length,se=O.length;if(ee!=se&&!(Y&&se>ee))return!1;var he=j.get(E),ce=j.get(O);if(he&&ce)return he==O&&ce==E;var ue=-1,fe=!0,ve=R&H_?new k_:void 0;for(j.set(E,O),j.set(O,E);++ue<ee;){var we=E[ue],Se=O[ue];if(z)var _e=Y?z(Se,we,ue,O,E,j):z(we,Se,ue,E,O,j);if(_e!==void 0){if(_e)continue;fe=!1;break}if(ve){if(!V_(O,(function(E,O){if(!j_(ve,O)&&(we===E||V(we,E,R,z,j)))return ve.push(O)}))){fe=!1;break}}else if(!(we===Se||V(we,Se,R,z,j))){fe=!1;break}}return j.delete(E),j.delete(O),fe}var q_=k8;function G8(E){var O=-1,R=Array(E.size);return E.forEach((function(E,z){R[++O]=[z,E]})),R}var X_=G8;function j8(E){var O=-1,R=Array(E.size);return E.forEach((function(E){R[++O]=E})),R}var Y_=j8;var Q_=1,Z_=2,K_="[object Boolean]",J_="[object Date]",$_="[object Error]",eA="[object Map]",tA="[object Number]",iA="[object RegExp]",rA="[object Set]",sA="[object String]",aA="[object Symbol]",oA="[object ArrayBuffer]",lA="[object DataView]",cA=Vm?Vm.prototype:void 0,fA=cA?cA.valueOf:void 0;function i9(E,O,R,z,V,j,Y){switch(R){case lA:if(E.byteLength!=O.byteLength||E.byteOffset!=O.byteOffset)return!1;E=E.buffer,O=O.buffer;case oA:return!(E.byteLength!=O.byteLength||!j(new lS(E),new lS(O)));case K_:case J_:case tA:return Vv(+E,+O);case $_:return E.name==O.name&&E.message==O.message;case iA:case sA:return E==O+"";case eA:var ee=X_;case rA:var se=z&Q_;if(ee||(ee=Y_),E.size!=O.size&&!se)return!1;var he=Y.get(E);if(he)return he==O;z|=Z_,Y.set(E,O);var ce=q_(ee(E),ee(O),z,V,j,Y);return Y.delete(E),ce;case aA:if(fA)return fA.call(E)==fA.call(O)}return!1}var mA=i9;var vA=1,xA=Object.prototype,bA=xA.hasOwnProperty;function a9(E,O,R,z,V,j){var Y=R&vA,ee=Lw(E),se=ee.length,he=Lw(O),ce=he.length;if(se!=ce&&!Y)return!1;for(var ue=se;ue--;){var fe=ee[ue];if(!(Y?fe in O:bA.call(O,fe)))return!1}var ve=j.get(E),we=j.get(O);if(ve&&we)return ve==O&&we==E;var Se=!0;j.set(E,O),j.set(O,E);for(var _e=Y;++ue<se;){fe=ee[ue];var Ae=E[fe],Ce=O[fe];if(z)var Te=Y?z(Ce,Ae,fe,O,E,j):z(Ae,Ce,fe,E,O,j);if(!(Te===void 0?Ae===Ce||V(Ae,Ce,R,z,j):Te)){Se=!1;break}_e||(_e=fe=="constructor")}if(Se&&!_e){var Ie=E.constructor,Fe=O.constructor;Ie!=Fe&&"constructor"in E&&"constructor"in O&&!(typeof Ie=="function"&&Ie instanceof Ie&&typeof Fe=="function"&&Fe instanceof Fe)&&(Se=!1)}return j.delete(E),j.delete(O),Se}var wA=a9;var SA=1,AA="[object Arguments]",EA="[object Array]",CA="[object Object]",TA=Object.prototype,PA=TA.hasOwnProperty;function u9(E,O,R,z,V,j){var Y=dg(E),ee=dg(O),se=Y?EA:rS(E),he=ee?EA:rS(O);se=se==AA?CA:se,he=he==AA?CA:he;var ce=se==CA,ue=he==CA,fe=se==he;if(fe&&xy(E)){if(!xy(O))return!1;Y=!0,ce=!1}if(fe&&!ce)return j||(j=new iw),Y||sx(E)?q_(E,O,R,z,V,j):mA(E,O,se,R,z,V,j);if(!(R&SA)){var ve=ce&&PA.call(E,"__wrapped__"),we=ue&&PA.call(O,"__wrapped__");if(ve||we){var Se=ve?E.value():E,_e=we?O.value():O;return j||(j=new iw),V(Se,_e,R,z,j)}}return!!fe&&(j||(j=new iw),wA(E,O,R,z,V,j))}var DA=u9;function Q2(E,O,R,z,V){return E===O||(E==null||O==null||!rg(E)&&!rg(O)?E!==E&&O!==O:DA(E,O,R,z,Q2,V))}var IA=Q2;function h9(E,O){return E!=null&&O in Object(E)}var OA=h9;function d9(E,O,R){O=Eb(O,E);for(var z=-1,V=O.length,j=!1;++z<V;){var Y=Tb(O[z]);if(!(j=E!=null&&R(E,Y)))break;E=E[Y]}return j||++z!=V?j:(V=E==null?0:E.length,!!V&&Qv(V)&&Uv(Y,V)&&(dg(E)||cy(E)))}var zA=d9;function f9(E,O){return E!=null&&zA(E,O,OA)}var kA=f9;var p9=function(){return Um.Date.now()},VA=p9;var HA="Expected a function",WA=Math.max,qA=Math.min;function v9(E,O,R){var z,V,j,Y,ee,se,he=0,ce=!1,ue=!1,fe=!0;if(typeof E!="function")throw new TypeError(HA);O=Dg(O)||0,wg(R)&&(ce=!!R.leading,ue="maxWait"in R,j=ue?WA(Dg(R.maxWait)||0,O):j,fe="trailing"in R?!!R.trailing:fe);function f(O){var R=z,j=V;return z=V=void 0,he=O,Y=E.apply(j,R),Y}function p(E){return he=E,ee=setTimeout(y,O),ce?f(E):Y}function m(E){var R=E-se,z=E-he,V=O-R;return ue?qA(V,j-z):V}function g(E){var R=E-se,z=E-he;return se===void 0||R>=O||R<0||ue&&z>=j}function y(){var E=VA();if(g(E))return x(E);ee=setTimeout(y,m(E))}function x(E){return ee=void 0,fe&&z?f(E):(z=V=void 0,Y)}function v(){ee!==void 0&&clearTimeout(ee),he=0,z=se=V=ee=void 0}function S(){return ee===void 0?Y:x(VA())}function w(){var E=VA(),R=g(E);if(z=arguments,V=this,se=E,R){if(ee===void 0)return p(se);if(ue)return clearTimeout(ee),ee=setTimeout(y,O),f(se)}return ee===void 0&&(ee=setTimeout(y,O)),Y}return w.cancel=v,w.flush=S,w}var XA=v9;function x9(E){var O=E==null?0:E.length;return O?E[O-1]:void 0}var YA=x9;function b9(E,O){return E>O}var JA=b9;function S9(E,O){return O.length<2?E:Db(E,Yb(O,0,-1))}var $A=S9;function w9(E,O){return IA(E,O)}var eM=w9;function A9(E,O,R){for(var z=-1,V=E.length;++z<V;){var j=E[z],Y=O(j);if(Y!=null&&(ee===void 0?Y===Y&&!sg(Y):R(Y,ee)))var ee=Y,se=j}return se}var iM=A9;function E9(E){return E&&E.length?iM(E,Ig,JA):void 0}var nM=E9;function T9(E,O){return O=Eb(O,E),E=$A(E,O),E==null||delete E[Tb(YA(O))]}var sM=T9;function M9(E){return Xb(E)?void 0:E}var aM=M9;var oM=1,lM=2,hM=4,dM=Nb((function(E,O){var R={};if(E==null)return R;var z=!1;O=og(O,(function(O){return O=Eb(O,E),z||(z=O.length>1),O})),Wv(E,Bw(E),R),z&&(R=R_(R,oM|lM|hM,aM));for(var V=O.length;V--;)sM(R,O[V]);return R})),uM=dM;function D9(E,O,R,z){if(!wg(E))return E;O=Eb(O,E);for(var V=-1,j=O.length,Y=j-1,ee=E;ee!=null&&++V<j;){var se=Tb(O[V]),he=R;if(se==="__proto__"||se==="constructor"||se==="prototype")return E;if(V!=Y){var ce=ee[se];he=z?z(ce,se,ee):void 0,he===void 0&&(he=wg(ce)?ce:Uv(O[V+1])?[]:{})}Hv(ee,se,he),ee=ee[se]}return E}var pM=D9;function O9(E,O,R){for(var z=-1,V=O.length,j={};++z<V;){var Y=O[z],ee=Db(E,Y);R(ee,Y)&&pM(j,Eb(Y,E),ee)}return j}var fM=O9;function R9(E,O){return fM(E,O,(function(O,R){return kA(E,R)}))}var mM=R9;var gM=Nb((function(E,O){return E==null?{}:mM(E,O)})),vM=gM;var yM="Expected a function";function N9(E,O,R){var z=!0,V=!0;if(typeof E!="function")throw new TypeError(yM);return wg(R)&&(z="leading"in R?!!R.leading:z,V="trailing"in R?!!R.trailing:V),XA(E,O,{leading:z,maxWait:O,trailing:V})}var xM=N9;function mv(E){for(let O of Object.keys(E))E[O]===void 0&&delete E[O];return E}function Xi(E,O){return Object.setPrototypeOf(E,O),E}var F9=()=>!(typeof window>"u")&&window.navigator.userAgent.toLowerCase().includes(" electron/"),V9=()=>!(typeof window>"u")&&window.navigator.platform.toUpperCase().includes("MAC"),U9=()=>!(typeof window>"u")&&(/iPad|iPhone|iPod/.test(window.navigator.userAgent)||wM&&"ontouchend"in document),z9=()=>!(typeof window>"u")&&window.navigator.userAgent.toLowerCase().indexOf("firefox")>-1,k9=()=>!(typeof window>"u")&&("ontouchstart"in window||navigator.maxTouchPoints>0),G9=()=>{if(typeof window>"u")return!1;let E=navigator.userAgent,O=navigator.vendor;return/Safari/i.test(E)&&/Apple Computer/.test(O)},j9=()=>{if(typeof window>"u")return null;let E=navigator.userAgent.match(/Version\/(\d+\.\d)/);return E&&E[1]},H9=()=>{if(typeof window>"u")return;let E=new URLSearchParams(window.location.search).get("desktop-app-version");return E?(window.localStorage.setItem("desktop-app-version",E),E):window.localStorage.getItem("desktop-app-version")??"0.0.6"},bM=F9(),wM=(bM&&H9(),V9()),_M=U9(),AM=z9(),MM=k9(),EM=G9(),CM=Number(j9());function gv(E){return Array.isArray(E)?E:[E]}function yv(E,O){let R=0;for(;R<E.length&&R<O.length;){if(E[R]<O[R])return-1;if(E[R]>O[R])return 1;R+=1}return R!==O.length?-1:R!==E.length?1:0}function Gp(E){return wM?E.metaKey:E.ctrlKey}function dI(E){return E.wheelDeltaY===0||E.deltaY===0?!(wM&&E.shiftKey&&Math.abs(E.wheelDeltaX)>=120)&&(E.wheelDeltaX?E.wheelDeltaX===-3*E.deltaX||E.wheelDeltaX===-3*window.devicePixelRatio*E.deltaX:E.deltaMode===0):E.wheelDeltaY?E.wheelDeltaY===-3*E.deltaY||E.wheelDeltaY===-3*window.devicePixelRatio*E.deltaY:E.deltaMode===0}var TM=[],PM={},DM={},IM={};function fI(E){TM.includes(E)||TM.push(E)}function Vh(E){delete PM[E.pointerId];for(let O=0;O<TM.length;O++)if(TM[O].pointerId===E.pointerId){TM.splice(O,1);break}}function pI(){TM.splice(0,TM.length)}function bv(E){if(E.pointerType!=="touch")return;let O=PM[E.pointerId];O===void 0&&(O={x:0,y:0},PM[E.pointerId]=O),O.x=E.pageX,O.y=E.pageY}function Sv(E){let O=E.pointerId===TM[0].pointerId?TM[1]:TM[0];return PM[O.pointerId]}function mI(E){DM[E.key]=!0,IM[E.key]=IM[E.key]===void 0?1:IM[E.key]+1}function gI(E){if(wM&&DM.Meta)for(let E in DM)DM[E]=!1;else DM[E.key]=!1;IM={}}function yI(E){E.addEventListener("pointerdown",fI,!0),E.addEventListener("pointerdown",bv,!0),E.addEventListener("pointermove",bv,!0),E.addEventListener("pointerup",Vh,!0),E.addEventListener("pointercancel",Vh,!0),E.addEventListener("pointerleave",Vh,!0),window.addEventListener("keydown",mI,!0),window.addEventListener("keyup",gI,!0)}function vI(E){E.removeEventListener("pointerdown",fI,!0),E.removeEventListener("pointerdown",bv,!0),E.removeEventListener("pointermove",bv,!0),E.removeEventListener("pointerup",Vh,!0),E.removeEventListener("pointercancel",Vh,!0),E.removeEventListener("pointerleave",Vh,!0),window.removeEventListener("keydown",mI,!0),window.removeEventListener("keyup",gI,!0)}var OM,RM=new Promise((E=>{OM=E}));var LM;function SI(){if(LM)return LM;async function n(){let E="https://unpkg.com/@splinetool/navmesh-wasm@1.9.76/build",O=import("../_/C9XezYQF.js"),[R,z]=await Promise.all([O,fetch(`${E}/navmesh.wasm`).then((E=>E.arrayBuffer()))]),V=R.default,j=await V({wasmBinary:z});OM(j)}return LM=n(),LM}var BM,zM=new Promise((E=>{BM=E}));var FM;function EI(){if(FM)return FM;async function n(){let E=await import("../_/DGOvO346.js");await E.init(),BM(E)}return FM=n(),FM}var NM=class{modifyById(E,O){let R=this;if(R[E]===void 0)throw new Error("not expected");{let z={...R,[E]:O};return Object.setPrototypeOf(z,NM.prototype),z}}add(E,O){return this.runOp({type:1,id:E,data:O})?.data??this}runOp(E){let O=this;if(E.type===1){let R,z=O[E.id];R=z===void 0?{type:2,id:E.id}:{type:1,id:E.id,data:z};let{id:V,data:j}=E,Y={...O,[V]:j};return Object.setPrototypeOf(Y,NM.prototype),{data:Y,actual:E,reverse:R}}if(E.type===2){let{id:R}=E,z=O[R];if(z===void 0)return null;{let V={...O};return Object.setPrototypeOf(V,NM.prototype),delete V[R],{data:V,actual:E,reverse:{type:1,id:R,data:z}}}}return null}};function Hp(E){if(E.deepFreeze!==void 0){E.deepFreeze(E);return}let O=Object.getOwnPropertyNames(E);for(let R of O){let O=E[R];O&&typeof O=="object"&&Hp(O)}return Object.freeze(E)}function TI(E,O){let R=0;for(;R<E.length&&R<O.length;){if(E[R]<O[R])return-1;if(E[R]>O[R])return 1;R+=1}return R!==O.length?-1:R!==E.length?1:0}var UM=class extends Error{};function Ev(E){let O={...E};return Object.setPrototypeOf(O,Object.getPrototypeOf(E)),O}function So(E,O,R){if(E===void 0?O===void 0?(E=0,O=10):E=O-10:O===void 0&&(O=E+10),E>O){let R=E;E=O,O=R}let z=[],V=1/(R+1);for(let j=0;j<R;j++){let R=E+(O-E)*(j+.75+Math.random()*.5)*V;z.push(R)}return z}function zh(E){return E instanceof Uint8Array||E instanceof Uint16Array||E instanceof Uint32Array||E instanceof Int8Array||E instanceof Int16Array||E instanceof Int32Array||E instanceof Float32Array||E instanceof Float64Array}function MI(){return typeof process<"u"}function CI(E,O){for(let R of E)O(R.id,R.data)!==!0&&CI(R.children,O)}function PI(E,O){if(O(E.id,E.data)!==!0)for(let R of E.children)PI(R,O)}var kM=class extends Array{constructor(...E){super(...E);Object.setPrototypeOf(this,kM.prototype)}deepFreeze(){let E=0;for(;E<this.length;)Hp(this[E]),E++}fillCaches0(E,O){this.objCaches.set(E.id,E),this.parentCaches.set(E.id,O);for(let O of E.children)this.fillCaches0(O,E.id)}fillCaches(){if(this.objCaches===void 0){this.objCaches=new Map,this.parentCaches=new Map;for(let E of this)this.fillCaches0(E,null)}}randomId(){this.fillCaches();let E=Array.from(this.objCaches.keys());if(E.length!==0)return E[Math.max(0,Math.floor(Math.random()*E.length)-1)]}nonExistOrDescendantOf(E,O){if(!this.has(E))return!0;for(;E;){let R=this.parent(E);if(R===O)return!0;E=R}return!1}rootAcestor(E){for(;E;){let O=this.parent(E);if(!O)return E;E=O}return E}isDescendantOf(E,O){for(;E;){let R=this.parent(E);if(R===O)return!0;E=R}return!1}data(E){return this.get(E)?.data}has(E){return this.childrenOf(E)!==void 0}get(E){return this.fillCaches(),this.objCaches.get(E)}childrenOf(E){return E===null?this:this.get(E)?.children}traverseFrom(E,O){if(E===null)this.traverse(O);else{let R=this.get(E);R&&PI(R,O)}}traverse(E){CI(this,E)}totalSize(){return this.fillCaches(),this.objCaches.size}parent(E){return this.fillCaches(),this.parentCaches.get(E)}childrenArray(E){return E===null?this:this.get(E).children}modifyById(E,O){if(this.get(E)===void 0)throw new Error("not expected");{let R=this.parent(E),z=this.childrenArray(R),V=z.findIndex((O=>O.id===E));if(V<0)throw new Error("not expected");let j=z[V];return z=[...z],z[V]={...j,data:O},this.modifyArrayBy(R,z)}}modifyArrayBy(E,O){let R=E,z=O;for(;R!==null;){let E=z,O=R;if(R=this.parent(R),R===void 0)throw new Error;z=this.childrenArray(R);let V=z.findIndex((E=>E.id===O));if(V<0)throw new Error;z=[...z],z[V]={...z[V],children:E}}Object.setPrototypeOf(z,kM.prototype);let V=z;return V.fillCaches(),V}runOp(E){switch(E.type){case 7:return this.addOp(E);case 8:return this.deleteOp(E);case 9:return this.moveOp(E)}return null}checkDuplicatedIdRec({id:E,children:O}){if(this.get(E)!==void 0)return!0;for(let E of O)if(this.checkDuplicatedIdRec(E))return!0;return!1}addOp(E){let{parent:O,fi:R,id:z,data:V,children:j}=E;if(O!==null&&this.get(O)===void 0)return null;if(this.checkDuplicatedIdRec(E))return null;{let Y=O,ee=this.childrenArray(Y),se={fi:R,id:z,data:V,children:j};return ee=[...ee,se],ee.sort(((E,O)=>E.fi-O.fi)),E.localIndex=ee.indexOf(se),{data:this.modifyArrayBy(Y,ee),actual:E,reverse:{type:8,id:z}}}}deleteOp(E){let{id:O}=E;if(this.get(O)===null)return null;{let R=this.parent(O);if(R===void 0)return null;let z=this.childrenArray(R),V=z.findIndex((E=>E.id===O));E.localIndex=V,z=[...z];let j=z.splice(V,1)[0];return{data:this.modifyArrayBy(R,z),actual:E,reverse:{type:7,...j,parent:R}}}}moveOp(E){let{parent:O,fi:R,id:z}=E;if(O!==null&&this.get(O)===void 0)return this.deleteOp({type:8,id:z});if(O!==null){let E=O;for(;E!==null;){if(E===void 0)throw new Error;if(E===z)throw new UM("cyclic tree");E=this.parent(E)}}let V=this.parent(z);if(V===void 0)return null;let j=V,Y=this.childrenArray(V),ee=Y.findIndex((E=>E.id===z));Y=[...Y];let se=Y.splice(ee,1)[0],he=this.modifyArrayBy(V,Y);V=O,Y=he.childrenArray(V);let ce=se.fi;return se={...se,fi:R},Y=[...Y,se],Y.sort(((E,O)=>E.fi-O.fi)),E.localIndex=Y.indexOf(se),he=he.modifyArrayBy(V,Y),{data:he,actual:E,reverse:{type:9,parent:j,fi:ce,id:z}}}previous(E,O){if(O===null){let O=this.childrenArray(E);return O.length===0?null:O[O.length-1].id}let R=null;for(let z of this.childrenArray(E)){if(z.id===O)return R;R=z.id}return null}traverseSortNext(E){let O=this.parent(E);if(O!==void 0){let R=this.childrenArray(O),z=R.findIndex((O=>O.id===E))+1;if(z<R.length)return R[z].id;if(O)return this.traverseSortNext(O)}}sortNext(E){let O=this.childrenArray(E);return O.length>0?O[0].id:this.traverseSortNext(E)}traverseSortPrevious(E){let O=this.childrenArray(E);return O.length>0?this.traverseSortPrevious(O[O.length-1].id):E}sortPrevious(E){let O=this.parent(E);if(O!==void 0){let R=this.childrenArray(O),z=R.findIndex((O=>O.id===E))-1;return z>=0?this.traverseSortPrevious(R[z].id):O}}getAllSorted(E){let O=[];for(let R of E){let E=this.getWithSortKey(R.id);E!==void 0&&O.push({...R,...E})}O.sort(((E,O)=>TI(E.sortKey,O.sortKey)));for(let E of O)delete E.sortKey;return O}getWithSortKey(E){var O=E;let R=[],z=this.get(O),V=z;if(z!==void 0){for(;O;)R.splice(0,0,z.fi),O=this.parent(O),O!==null&&(z=this.get(O));return{...V,sortKey:R}}}insertBeforeHelper(E,O,R){return this.insertAfterHelper(E,this.previous(E,O),R)}insertAfterHelper(E,O,R){let z=this.childrenArray(E);if(O===null){if(z.length===0)return So(0,R,R);{let E=z[0].fi;return So(E-R,E,R)}}{let V=this.get(O);if(V===void 0||this.parent(O)!==E)throw new Error("illegal args");let j=z.find((E=>E.fi>V.fi));if(j===void 0){let E=z[z.length-1].fi;return So(E,E+R,R)}return So(V.fi,j.fi,R)}}};var VM;(E=>{function n(E,O){if(O.type!==0)return null;if(Array.isArray(E)){let R=O.props,z={},V=[...E],j=!1;if(R)for(let E of Object.keys(R)){let O=parseInt(E);if(isNaN(O))throw new Error("wrong index");z[E]=V[O],V[O]=R[E],j=!0}return j?{data:V,actual:O,reverse:{type:0,props:z}}:null}{let R=O.props,z={},V={...E},j=!1;if(R)for(let E of Object.keys(R)){z[E]=V[E];let O=R[E];O===void 0?delete V[E]:V[E]=O,j=!0}return j?{data:V,actual:O,reverse:{type:0,props:z}}:null}}E.runOp=n})(VM||(VM={}));var jM=class extends Array{constructor(...E){super(...E);Object.setPrototypeOf(this,jM.prototype)}deepFreeze(){let E=0;for(;E<this.length;)Hp(this[E]),E++}fillCaches0(E){this.objCaches.set(E.id,E)}fillCaches(){if(this.objCaches===void 0){this.objCaches=new Map,Object.getOwnPropertyDescriptor(this,"objCaches").enumerable=!1;for(let E of this)this.fillCaches0(E)}}randomId(){this.fillCaches();let E=Array.from(this.objCaches.keys());if(E.length!==0)return E[Math.max(0,Math.floor(Math.random()*E.length)-1)]}data(E){return this.get(E)?.data}get(E){return this.fillCaches(),this.objCaches.get(E)}modifyById(E,O){if(this.get(E)===void 0)throw new Error("not expected");{let R=this,z=R.findIndex((O=>O.id===E));if(z<0)throw new Error("not expected");let V=R[z];return R=[...R],R[z]={...V,data:O},this.modifyArrayBy(R)}}modifyArrayBy(E){Object.setPrototypeOf(E,jM.prototype);let O=E;return MI()||O.fillCaches(),O}runOp(E){switch(E.type){case 4:return this.addOp(E);case 5:return this.deleteOp(E);case 6:return this.moveOp(E)}return null}addOp(E){let{fi:O,id:R,data:z}=E,V=this,j={fi:O,id:R,data:z};return V=[...V,j],V.sort(((E,O)=>E.fi-O.fi)),E.localIndex=V.indexOf(j),{data:this.modifyArrayBy(V),actual:E,reverse:{type:5,id:R}}}deleteOp(E){let{id:O}=E,R=this,z=R.findIndex((E=>E.id===O));if(z===-1)return null;E.localIndex=z,R=[...R];let V=R.splice(z,1)[0];return{data:this.modifyArrayBy(R),actual:E,reverse:{type:4,...V}}}moveOp(E){let{fi:O,id:R}=E,z=this;z=[...z];let V=z.findIndex((E=>E.id===R));if(V===-1)return null;let j=z[V].fi,Y={...z[V],fi:O};return z[V]=Y,z.sort(((E,O)=>E.fi-O.fi)),E.localIndex=z.indexOf(Y),{data:this.modifyArrayBy(z),actual:E,reverse:{type:6,fi:j,id:R}}}previous(E){if(E===null)return this.length===0?null:this[this.length-1].id;let O=null;for(let R of this){if(R.id===E)return O;O=R.id}return null}insertBeforeHelper(E,O){return this.insertAfterHelper(this.previous(E),O)}insertAfterHelper(E,O){let R=this;if(E===null){if(R.length===0)return So(0,O,O);{let E=R[0].fi;return So(E-O,E,O)}}{let z=this.get(E);if(z===void 0)throw new Error("illegal args");let V=R.find((E=>E.fi>z.fi));if(V===void 0){let E=R[R.length-1].fi;return So(E,E+O,O)}return So(z.fi,V.fi,O)}}};function Gh(E){return E&&typeof E=="object"&&E instanceof HM}var GM,HM=class{unusedFunOverridesTable(E){}runOp(E){let O=[],R=this,z=0,V={};for(;z<E.path.length;){if(O.push(R),R=R===void 0?void 0:R[E.path[z]],R!==void 0&&!Gh(R))return null;z+=1}R=R?Ev(R):new HM;for(let[O,z]of Object.entries(E.props)){let E=R[O];V[O]=E,z===void 0?delete R[O]:R[O]=z}for(;z>0;){if(Object.keys(R).length===0){let V=O[z-1];V&&(R=Ev(V),delete R[E.path[z-1]])}else{let V=O[z-1];if(V){let O=Ev(V);O[E.path[z-1]]=R,R=O}else{let O=new HM;O[E.path[z-1]]=R,R=O}}z-=1}let j=Object.setPrototypeOf(R,HM.prototype),Y={...E,props:V};return{data:j,actual:E,reverse:Y}}};(E=>{function n(E,O){return Wp(E,O)??E}E.apply=n;function t(E,O){return Sw(E,O)}E.merge=t;function e(E,O){let R=0,z=O.path,V=E;for(;R<z.length&&V!==void 0;){if(V=lE.zoomOnce(V,z[R]),V===void 0)return O;if(!Gh(V))return;R+=1}if(V===void 0)return O;if(!!Gh(V)){if(O.type===0){let E={...O.props};for(let O of Object.keys(V))delete E[O];return{...O,props:E}}if(O.type===1||O.type===4||O.type===7){let E=bw([O],V);return E?(console.log(E),E):O}return O}}E.filterOp=e})(GM||(GM={}));function bw(E,O){if(O===void 0)return;let R=!1,z=E.map((E=>{let z=E.id,V=Wp(E.data,O[z]);if(R=R||V!==void 0,V===void 0&&(V=E.data),E.children){let j=bw(E.children,O);return j!==void 0?R=!0:j=E.children,{...E,id:z,data:V,children:j}}return{...E,id:z,data:V}}));return R?z:void 0}function W9(E,O){if(O===void 0)return;let R=!1,z=E.map((E=>{let z=E.id,V=Wp(E.data,O[z]);return R=R||V!==void 0,V===void 0&&(V=E.data),{...E,id:z,data:V}}));return R?(Object.setPrototypeOf(z,Object.getPrototypeOf(E)),z):void 0}function Wp(E,O){if(!Gh(O))return O;if(E instanceof kM){let R=bw(E,O);return R!==void 0&&Object.setPrototypeOf(R,Object.getPrototypeOf(E)),R}if(E instanceof jM)return W9(E,O);if(Array.isArray(E)){let R=!1,z=E.map(((E,z)=>{let V=Wp(E,O[z]);return R=R||V!==void 0,V===void 0&&(V=E),V}));return R?(Object.setPrototypeOf(z,Object.getPrototypeOf(E)),z):void 0}if(E instanceof HM)return Sw(E,O);if(E&&typeof E=="object"){let R={},z=!1;for(let[V,j]of Object.entries(E)){let E=Wp(j,O[V]);z=z||E!==void 0,E===void 0&&(E=j),R[V]=E}return z?(Object.setPrototypeOf(R,Object.getPrototypeOf(E)),R):void 0}}function Sw(E,O){if(E===void 0)return O;if(O===void 0)return E;if(!Gh(O))return O;if(!Gh(E))return GM.apply(E,O);let R=new Set;for(let O of Object.keys(E))R.add(O);for(let E of Object.keys(O))R.add(E);let z=new HM;for(let V of R){let R=Sw(E===void 0?void 0:E[V],O===void 0?void 0:O[V]);z[V]=R}return z}function _I(E,O){let R={cur:[],result:[],len:0};return E=qp(E,O,R)??E,[E,R.result]}function Tv(E,O){return E===null?null:(E.cur[E.len]=O,E.len+=1,E)}function Mv(E){E&&(E.len-=1)}function q9(E){if(E===null)return null;E.result.push(E.cur.slice(0,E.len))}function II(E,O,R){let z=!1,V=E.map((E=>{let V=E.id,j=O[V];if(j!==void 0&&typeof j=="string"&&(z=!0,V=j,R!==null))throw new Error("not supported");let Y=qp(E.data,O,Tv(R,V));Mv(R),z=z||Y!==void 0,Y===void 0&&(Y=E.data);let ee=II(E.children,O,R);return ee!==void 0?z=!0:ee=E.children,{...E,id:V,data:Y,children:ee}}));if(z)return V}function X9(E,O,R){let z=!1,V=E.map((E=>{let V=E.id,j=O[V];if(j!==void 0&&typeof j=="string"&&(z=!0,V=j,R!==null))throw new Error("not supported");let Y=qp(E.data,O,Tv(R,V));return Mv(R),z=z||Y!==void 0,Y===void 0&&(Y=E.data),{...E,id:V,data:Y}}));if(z)return Object.setPrototypeOf(V,Object.getPrototypeOf(E)),V}function qp(E,O,R){if(E instanceof kM){let z=II(E,O,R);return z!==void 0&&Object.setPrototypeOf(z,Object.getPrototypeOf(E)),z}if(E instanceof jM)return X9(E,O,R);if(Array.isArray(E)){let z=!1,V=E.map(((E,V)=>{let j=qp(E,O,Tv(R,V));return Mv(R),z=z||j!==void 0,j===void 0&&(j=E),j}));return z?(Object.setPrototypeOf(V,Object.getPrototypeOf(E)),V):void 0}if(E&&typeof E=="object"&&!zh(E)){let z={},V=!1;for(let[j,Y]of Object.entries(E))if(j!=="name"&&j!=="variableId"){let E=O[j];if(typeof E=="string"){if(R!==null)throw new Error("not supported");V=!0,j=E}let ee=qp(Y,O,Tv(R,j));Mv(R),V=V||ee!==void 0,ee===void 0&&(ee=Y),z[j]=ee}else z[j]=Y;return V?(Object.setPrototypeOf(z,Object.getPrototypeOf(E)),z):void 0}if(typeof E=="string"){let z=O[E];return z!==void 0&&q9(R),z}}var WM;(E=>{function n(E,O){let R=lE.zoom(O,E.path);if(typeof R=="object"){let O={};for(let z of Object.keys(E.props))O[z]=R[z];return{...E,props:O}}return{...E,props:{}}}E.replaceProps=n})(WM||(WM={}));var qM;(E=>{function n(E,O){return{...E,path:E.path.slice(O)}}E.drop=n;function t(E,O){return e(E,O)?.data??E}E.applySimple=t;function e(E,O){let R=O.path;for(var z=[];;){let V;if(E instanceof HM&&O.type===0&&(V=E.runOp({...O,path:R.slice(z.length)}),V===null&&(V=void 0)),V===void 0&&z.length===R.length&&(V=E instanceof kM||E instanceof jM||E instanceof NM?E.runOp(O):VM.runOp(E,O)),V!==void 0){if(V!==null){let E=V.data;for(let O=z.length-1;O>=0;O--){let V=R[O],j=z[O];if(j instanceof kM){if(typeof V=="number")throw new Error("illegal arg");E=j.modifyById(V,E)}else if(j instanceof jM){if(typeof V=="number")throw new Error("illegal arg");E=j.modifyById(V,E)}else if(j instanceof NM){if(typeof V=="number")throw new Error("illegal arg");E=j.modifyById(V,E)}else if(j instanceof HM){let O={...j,[V]:E};E=Object.setPrototypeOf(O,HM.prototype)}else{if(typeof j!="object")return null;if(Array.isArray(j)){if(typeof V=="string"&&(V=parseInt(V),isNaN(V)))throw new Error("Invalid path");let O=E;E=[...j],E[V]=O}else E={...j,[V]:E}}}return{data:E,actual:{...V.actual,path:R},reverse:{...V.reverse,path:R}}}return null}let j,Y=R[z.length];if(E instanceof kM){if(typeof Y=="number")throw new Error("");j=E.get(Y)?.data}else if(E instanceof jM){if(typeof Y=="number")throw new Error("");j=E.get(Y)?.data}else E!==null&&(j=E[Y]);if(j===void 0)return null;z.push(E),E=j}}E.apply=e;function r(E,O){for(let R=0;R<E.length&&R<O.length;R++)if(E[R]!==O[R])return!0;return!1}E.pathDisjoint=r;function i(E,O){if(E.length!==O.length)return!1;for(let R=0;R<E.length;R++)if(E[R]!==O[R])return!1;return!0}E.pathEq=i;function s(E,O){return r(E.path,O.path)}E.commutative=s;function o(E,O){return!(E.type!==0||O.type!==0||!i(E.path,O.path))&&Object.keys(E.props).every((E=>O.props[E]!==void 0))}E.subsumed=o})(qM||(qM={}));var XM;(E=>{function n(){return[]}E.empty=n;function t(E,O){let R=[];for(let z of E){let[E,...V]=z.path;E===O&&R.push({...z,path:V})}return R}E.removePrefix=t;function e(E,O){return E.map((E=>({...E,path:[O,...E.path]})))}E.addPrefix=e;function r(E,O){return[...E,...O]}E.concat=r;function i(E,O){return[...E.filter((E=>!O.some((O=>qM.subsumed(E,O))))),...O]}E.compress=i;function s(E,O){return E.every((E=>O.every((O=>qM.commutative(E,O)))))}E.commutative=s;function o(E,O){for(let R of O){let O=a(E,R);O!==null&&(E=O.data)}return E}E.applyAll=o;function a(E,O){var R=E;let z=[],V=[];for(let E of O)try{if(E.type===3||E.type===5&&E.path[E.path.length-1]==="variables"){let O,j,Y;if(E.type===3?(O=lE.zoom(R,[...E.path,E.id]),Y=qM.apply(R,{...E,type:2})):(O=lE.zoom(R,[...E.path,E.id,"value"]),Y=qM.apply(R,E)),Y!==null){R=Y.data;let[ee,se]=_I(R,{[E.id]:O});R=ee;for(let Y=0;Y<se.length;Y++){let ee=se[Y],he=ee.pop();if(typeof he=="number"){let z=[he];for(let E=Y+1;E<se.length;E++){let O=se[E],R=O[O.length-1];if(typeof R!="number"||!lE.equal(ee,O.slice(0,O.length-1)))break;z.push(R),se.splice(E,1)}let V=lE.zoom(R,ee);j=V.map(((O,R)=>z.includes(R)?E.id:O)),O=V,he=ee.pop()}else{if(he==="alphaOverride"||he==="alpha"){O/=100;let E=O,z=lE.zoom(R,ee.slice(0,ee.length-2)),V=z.layers.map((O=>O.id===ee[ee.length-1]?{...O,data:{...O.data,[he]:E}}:O));Object.setPrototypeOf(V,Object.getPrototypeOf(z.layers)),z.layers=V}j=E.id}z.push({type:0,path:ee,props:{[he]:O}}),V.push({type:0,path:ee,props:{[he]:j}})}V.push(Y.reverse),z.push(Y.actual)}}else{let O=qM.apply(R,E);O!==null&&(z.push(O.actual),R=O.data,V.push(O.reverse))}}catch(E){if(E instanceof UM)return null;throw E}return{data:R,actual:z,reverse:V.reverse()}}E.apply=a})(XM||(XM={}));var YM=Symbol(),QM=Symbol(),ZM=Symbol(),KM=class{reportOp(E,O,R=[]){let z=this;if(O===null)return;z._current=O.data;let V=R;for(;!(z instanceof oE);){let E=z._path,O=z._current;if(E!==""&&V.splice(0,0,E),z=z._parent,z===null)return;z.update(E,O)}z.push(V,E,O.actual,O.reverse)}deleteChildren(E){if(this._children){let O=this._children[E];if(O){let R=O[ZM];R&&R(),delete this._children[E]}}}},JM=class extends KM{constructor(E,O,R){super(),this._parent=E,this._path=O,this._current=R}update(E,O){if(Array.isArray(this._current)){if(typeof E=="string"&&(E=parseInt(E),isNaN(E)))throw new Error("Invalid path");this._current=[...this._current],this._current[E]=O}else this._current={...this._current,[E]:O}}runOp(E){this.reportOp(E,VM.runOp(this._current,E),E.path)}},$M=class extends KM{constructor(E,O,R){super(),this._parent=E,this._path=O,this._current=R}update(E,O){this._current={...this._current,[E]:O},Object.setPrototypeOf(this._current,NM.prototype)}runOp(E){this.reportOp(E,this._current.runOp(E))}},eE={get(E,O){if(O===ZM)return()=>{E._parent=null};if(O===YM)return E._current;if(O===QM)return E;let{_current:R,_children:z}=E;if(O==="push"&&Array.isArray(R))throw new Error("not supported to expand array");let V=z===void 0?void 0:z[O];if(V!==void 0)return V;let j=R[O],Y=_v(E,O,j);return Y!==j?(z===void 0&&(z={},E._children=z),z[O]=Y,Y):j},has(E,O){return O in E._current},ownKeys(E){return Reflect.ownKeys(E._current)},defineProperty(){throw Error("not supported")},getPrototypeOf(E){return Object.getPrototypeOf(E._current)},setPrototypeOf(){throw Error("not supported")},getOwnPropertyDescriptor(E,O){let R=E._current,z=Reflect.getOwnPropertyDescriptor(R,O);return z&&{writable:!0,configurable:!0,enumerable:z.enumerable,value:R[O]}}},tE={...eE,set(E,O,R){let z={type:0,props:{[O]:Hr(R)??R}};return E.deleteChildren(O),E.runOp(z),!0},deleteProperty(E,O){let R={type:0,props:{[O]:void 0}};return E.deleteChildren(O),E.runOp(R),!0}},rE={...eE,set(E,O,R){return R===void 0?this.deleteProperty(E,O):(E.deleteChildren(O),E.runOp({type:1,id:O,data:R})),!0},deleteProperty(E,O){return E.runOp({type:2,id:O}),!0}},nE=class extends KM{constructor(E,O,R){super(),this._children={},this._parent=E,this._path=O,this._current=R,this[ZM]=()=>{this._parent=null}}unproxy(){return this._current}update(E,O){this._current=this._current.modifyById(E,O)}runOp(E){this.reportOp(E,this._current.runOp(E))}randomId(){return this._current.randomId()}isDescendantOf(E,O){return this._current.isDescendantOf(E,O)}childrenOf(E){return this._current.childrenOf(E)}traverse(E){return this._current.traverse(E)}get(E){return this._current.get(E)}parent(E){return this._current.parent(E)}traverse(E){this._current.traverse(((O,R)=>{E(O,this.data(O))}))}data(E){let{_current:O,_children:R}=this,z=R===void 0?void 0:R[E];if(z!==void 0)return z;let V=O.get(E)?.data,j=_v(this,E,V);return j!==V?(R===void 0&&(R={},this._children=R),R[E]=j,j):V}add(E,O,R,z,V){this.runOp({type:7,parent:E,fi:O,id:R,data:z,children:V})}move(E,O,R){this.runOp({type:9,parent:E,fi:O,id:R})}insertAfter(E,O,R){let z=this._current.insertAfterHelper(E,O,R.length);for(let O=0;O<R.length;O++){let V=R[O];this.add(E,z[O],V.id,V.data,V.children)}}insertBefore(E,O,R){let z=this._current.insertBeforeHelper(E,O,R.length);for(let O=0;O<R.length;O++){let V=R[O];this.add(E,z[O],V.id,V.data,V.children)}}moveAfter(E,O,R){let z=this._current.insertAfterHelper(E,O,R.length);for(let O=0;O<R.length;O++){let V=R[O];this.move(E,z[O],V)}}moveBefore(E,O,R){let z=this._current.insertBeforeHelper(E,O,R.length);for(let O=0;O<R.length;O++){let V=R[O];this.move(E,z[O],V)}}delete(E){this.deleteChildren(E),this.runOp({type:8,id:E})}sortNext(E){return this._current.sortNext(E)}sortPrevious(E){return this._current.sortPrevious(E)}getAllSorted(E){return this._current.getAllSorted(E)}},sE=class extends KM{constructor(E,O,R){super(),this._children={},this._parent=E,this._path=O,this._current=R,this[ZM]=()=>{this._parent=null}}unproxy(){return this._current}get length(){return this._current.length}forEach(E){let O=this.length;for(let R=0;R<O;R++){let O=this._current[R].id,z=this._current[R].fi;E(this.data(this._current[R].id),O,z)}}find(E){let O=this.length;for(let R=0;R<O;R++){let O=this._current[R].id;if(E(this.data(O),O))return this.get(O)}}update(E,O){this._current=this._current.modifyById(E,O)}randomId(){return this._current.randomId()}get(E){return{...this._current.get(E),data:this.data(E)}}data(E){let{_current:O,_children:R}=this,z=R===void 0?void 0:R[E];if(z!==void 0)return z;let V=O.get(E)?.data,j=_v(this,E,V);return j!==V?(R===void 0&&(R={},this._children=R),R[E]=j,j):V}runOp(E){this.reportOp(E,this._current.runOp(E))}add(E,O,R){this.runOp({type:4,fi:E,id:O,data:R})}move(E,O){this.runOp({type:6,fi:E,id:O})}insertAfter(E,O){let R=this._current.insertAfterHelper(E,O.length);for(let E=0;E<O.length;E++){let z=O[E];this.add(R[E],z.id,z.data)}}insertBefore(E,O){let R=this._current.insertBeforeHelper(E,O.length);for(let E=0;E<O.length;E++){let z=O[E];this.add(R[E],z.id,z.data)}}moveAfter(E,O){let R=this._current.insertAfterHelper(E,O.length);for(let E=0;E<O.length;E++){let z=O[E];this.move(R[E],z)}}moveBefore(E,O){let R=this._current.insertBeforeHelper(E,O.length);for(let E=0;E<O.length;E++){let z=O[E];this.move(R[E],z)}}delete(E){this.deleteChildren(E),this.runOp({type:5,id:E})}};function ww(E,O,R){if(E.length>0){let z=E[E.length-1];if(z.type===0&&O.type===0&&lE.equal(z.path,R)){Object.assign(z.props,O.props);return}}E.push({...O,path:R})}var oE=class extends KM{constructor(E){super(),this.ts=[],this.actual=[],this.reverse=[],this._current=E}update(E,O){if(E!=="")throw new Error("");this._current=O}push(E,O,R,z){ww(this.ts,O,E),ww(this.actual,R,E),ww(this.reverse,z,E)}result(){return{data:this._current,ts:this.ts,actual:this.actual,reverse:this.reverse.reverse()}}};function _v(E,O,R){return R instanceof kM?new nE(E,O,R):R instanceof jM?new sE(E,O,R):R instanceof NM?new Proxy(new $M(E,O,R),rE):R!==null&&typeof R=="object"?zh(R)?R:new Proxy(new JM(E,O,R),tE):R}function Tw(E){let O=new oE(E);return[_v(O,"",E),O]}function Tl(E,O){let[R,z]=Tw(E);return O(R),z.result()}function Hr(E){return E instanceof nE||E instanceof sE?E._current:E!==null&&typeof E=="object"?E[YM]:E}var lE;(E=>{function n(E,O){if(O.length!==E.length)return!1;for(var R=0;R<E.length;){if(E[R]!==O[R])return!1;R+=1}return!0}E.equal=n;function t(E,O,R){let z=r(R,E);if(z!==void 0&&typeof z=="object"&&z!==null){let E={...O};return Object.keys(z).forEach((O=>{delete E[O]})),E}return O}E.removeOverridden=t;function e(E,O){return(E instanceof kM||E instanceof nE)&&typeof O=="string"||(E instanceof jM||E instanceof sE)&&typeof O=="string"?E.data(O):typeof O=="number"&&Array.isArray(E)||typeof O=="string"&&typeof E=="object"&&E!==null?E[O]:void 0}E.zoomOnce=e;function r(E,O,R=0){for(;R<O.length&&E!==void 0;)E=e(E,O[R]),R+=1;return E}E.zoom=r})(lE||(lE={}));function RI(E,O){let R=[];if(O.length!==E.length)return null;for(var z=0;z<E.length;){if(O[z]==="*")R.push(E[z]);else if(E[z]!==O[z])return null;z+=1}return R}function Vt(E,O){let R=[];if(!(O.length<=E.length))return null;for(var z=0;z<O.length;){if(O[z]==="*")R.push(E[z]);else if(E[z]!==O[z])return null;z+=1}return R}var hE=class{},cE=class extends hE{constructor(E){super();this.id=E}},dE=class extends hE{constructor(E){super();this.data=E}};var uE;try{uE=new TextDecoder}catch{}var pE,fE,mE=0;var gE,vE,yE,xE,bE,wE=[],SE=wE,_E=0,AE={},CE=0,TE=0,LE=[],BE={useRecords:!1,mapsAsObjects:!0},zE=class{},FE=new zE;FE.name="MessagePack 0xC1";var UE=!1,VE=class{constructor(E){E&&(E.useRecords===!1&&E.mapsAsObjects===void 0&&(E.mapsAsObjects=!0),E.structures?E.structures.sharedLength=E.structures.length:E.getStructures&&((E.structures=[]).uninitialized=!0,E.structures.sharedLength=0)),Object.assign(this,E)}unpack(E,O){if(pE)return qI((()=>(Ov(),this?this.unpack(E,O):VE.prototype.unpack.call(BE,E,O))));fE=O>-1?O:E.length,mE=0,_E=0,TE=0,vE=null,SE=wE,yE=null,pE=E;try{bE=E.dataView||(E.dataView=new DataView(E.buffer,E.byteOffset,E.byteLength))}catch(O){throw pE=null,E instanceof Uint8Array?O:new Error("Source must be a Uint8Array or Buffer but was a "+(E&&typeof E=="object"?E.constructor.name:typeof E))}if(this instanceof VE){if(AE=this,this.structures)return gE=this.structures,Dv();(!gE||gE.length>0)&&(gE=[])}else AE=BE,(!gE||gE.length>0)&&(gE=[]);return Dv()}unpackMultiple(E,O){let R,z=0;try{UE=!0;let V=E.length,j=this?this.unpack(E,V):eC.unpack(E,V);if(!O){for(R=[j];mE<V;)z=mE,R.push(Dv());return R}for(O(j);mE<V;)if(z=mE,O(Dv())===!1)return}catch(E){throw E.lastPosition=z,E.values=R,E}finally{UE=!1,Ov()}}_mergeStructures(E,O){E=E||[];for(let O=0,R=E.length;O<R;O++){let R=E[O];R&&(R.isShared=!0,O>=32&&(R.highByte=O-32>>5))}E.sharedLength=E.length;for(let R in O||[])if(R>=0){let z=E[R],V=O[R];V&&(z&&((E.restoreStructures||(E.restoreStructures=[]))[R]=z),E[R]=V)}return this.structures=E}decode(E,O){return this.unpack(E,O)}};function Dv(){try{if(!AE.trusted&&!UE){let E=gE.sharedLength||0;E<gE.length&&(gE.length=E)}let E=Zr();if(mE==fE)gE.restoreStructures&&BI(),gE=null,pE=null,xE&&(xE=null);else{if(mE>fE){let E=new Error("Unexpected end of MessagePack data");throw E.incomplete=!0,E}if(!UE)throw new Error("Data read, but end of buffer not reached")}return E}catch(E){throw gE.restoreStructures&&BI(),Ov(),(E instanceof RangeError||E.message.startsWith("Unexpected end of buffer"))&&(E.incomplete=!0),E}}function BI(){for(let E in gE.restoreStructures)gE[E]=gE.restoreStructures[E];gE.restoreStructures=null}function Zr(){let E=pE[mE++];if(E<160){if(E<128){if(E<64)return E;{let O=gE[E&63]||AE.getStructures&&GI()[E&63];return O?(O.read||(O.read=Ow(O,E&63)),O.read()):E}}if(E<144){if(E-=128,AE.mapsAsObjects){let O={};for(let R=0;R<E;R++)O[HI()]=Zr();return O}{let O=new Map;for(let R=0;R<E;R++)O.set(Zr(),Zr());return O}}{E-=144;let O=new Array(E);for(let R=0;R<E;R++)O[R]=Zr();return O}}if(E<192){let O=E-160;if(TE>=mE)return vE.slice(mE-CE,(mE+=O)-CE);if(TE==0&&fE<140){let E=O<16?Rw(O):jI(O);if(E!=null)return E}return HE(O)}{let O;switch(E){case 192:return null;case 193:return yE?(O=Zr(),O>0?yE[1].slice(yE.position1,yE.position1+=O):yE[0].slice(yE.position0,yE.position0-=O)):FE;case 194:return!1;case 195:return!0;case 196:return Mw(pE[mE++]);case 197:return O=bE.getUint16(mE),mE+=2,Mw(O);case 198:return O=bE.getUint32(mE),mE+=4,Mw(O);case 199:return Uc(pE[mE++]);case 200:return O=bE.getUint16(mE),mE+=2,Uc(O);case 201:return O=bE.getUint32(mE),mE+=4,Uc(O);case 202:if(O=bE.getFloat32(mE),AE.useFloat32>2){let E=$E[(pE[mE]&127)<<1|pE[mE+1]>>7];return mE+=4,(E*O+(O>0?.5:-.5)|0)/E}return mE+=4,O;case 203:return O=bE.getFloat64(mE),mE+=8,O;case 204:return pE[mE++];case 205:return O=bE.getUint16(mE),mE+=2,O;case 206:return O=bE.getUint32(mE),mE+=4,O;case 207:return AE.int64AsNumber?(O=bE.getUint32(mE)*4294967296,O+=bE.getUint32(mE+4)):O=bE.getBigUint64(mE),mE+=8,O;case 208:return bE.getInt8(mE++);case 209:return O=bE.getInt16(mE),mE+=2,O;case 210:return O=bE.getInt32(mE),mE+=4,O;case 211:return AE.int64AsNumber?(O=bE.getInt32(mE)*4294967296,O+=bE.getUint32(mE+4)):O=bE.getBigInt64(mE),mE+=8,O;case 212:if(O=pE[mE++],O==114)return zI(pE[mE++]&63);{let E=LE[O];if(E)return E.read?(mE++,E.read(Zr())):E.noBuffer?(mE++,E()):E(pE.subarray(mE,++mE));throw new Error("Unknown extension "+O)}case 213:return O=pE[mE],O==114?(mE++,zI(pE[mE++]&63,pE[mE++])):Uc(2);case 214:return Uc(4);case 215:return Uc(8);case 216:return Uc(16);case 217:return O=pE[mE++],TE>=mE?vE.slice(mE-CE,(mE+=O)-CE):WE(O);case 218:return O=bE.getUint16(mE),mE+=2,TE>=mE?vE.slice(mE-CE,(mE+=O)-CE):qE(O);case 219:return O=bE.getUint32(mE),mE+=4,TE>=mE?vE.slice(mE-CE,(mE+=O)-CE):XE(O);case 220:return O=bE.getUint16(mE),mE+=2,FI(O);case 221:return O=bE.getUint32(mE),mE+=4,FI(O);case 222:return O=bE.getUint16(mE),mE+=2,VI(O);case 223:return O=bE.getUint32(mE),mE+=4,VI(O);default:if(E>=224)return E-256;if(E===void 0){let E=new Error("Unexpected end of MessagePack data");throw E.incomplete=!0,E}throw new Error("Unknown MessagePack token "+E)}}}var GE=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function Ow(E,O){function e(){if(e.count++>2){let R=E.read=new Function("r","return function(){return {"+E.map((E=>GE.test(E)?E+":r()":"["+JSON.stringify(E)+"]:r()")).join(",")+"}}")(Zr);return E.highByte===0&&(E.read=NI(O,E.read)),R()}let R={};for(let O=0,z=E.length;O<z;O++){let z=E[O];R[z]=Zr()}return R}return e.count=0,E.highByte===0?NI(O,e):e}var NI=(E,O)=>function(){let R=pE[mE++];if(R===0)return O();let z=E<32?-(E+(R<<5)):E+(R<<5),V=gE[z]||GI()[z];if(!V)throw new Error("Record id is not defined for "+z);return V.read||(V.read=Ow(V,E)),V.read()};function GI(){let E=qI((()=>(pE=null,AE.getStructures())));return gE=AE._mergeStructures(E,gE)}var HE=Rv,WE=Rv,qE=Rv,XE=Rv;function Rv(E){let O;if(E<16&&(O=Rw(E)))return O;if(E>64&&uE)return uE.decode(pE.subarray(mE,mE+=E));let R=mE+E,z=[];for(O="";mE<R;){let E=pE[mE++];if((E&128)===0)z.push(E);else if((E&224)===192){let O=pE[mE++]&63;z.push((E&31)<<6|O)}else if((E&240)===224){let O=pE[mE++]&63,R=pE[mE++]&63;z.push((E&31)<<12|O<<6|R)}else if((E&248)===240){let O=pE[mE++]&63,R=pE[mE++]&63,V=pE[mE++]&63,j=(E&7)<<18|O<<12|R<<6|V;j>65535&&(j-=65536,z.push(j>>>10&1023|55296),j=56320|j&1023),z.push(j)}else z.push(E);z.length>=4096&&(O+=YE.apply(String,z),z.length=0)}return z.length>0&&(O+=YE.apply(String,z)),O}function FI(E){let O=new Array(E);for(let R=0;R<E;R++)O[R]=Zr();return O}function VI(E){if(AE.mapsAsObjects){let O={};for(let R=0;R<E;R++)O[HI()]=Zr();return O}{let O=new Map;for(let R=0;R<E;R++)O.set(Zr(),Zr());return O}}var YE=String.fromCharCode;function jI(E){let O=mE,R=new Array(E);for(let z=0;z<E;z++){let E=pE[mE++];if((E&128)>0){mE=O;return}R[z]=E}return YE.apply(String,R)}function Rw(E){if(E<4){if(E<2){if(E===0)return"";{let E=pE[mE++];if((E&128)>1){mE-=1;return}return YE(E)}}{let O=pE[mE++],R=pE[mE++];if((O&128)>0||(R&128)>0){mE-=2;return}if(E<3)return YE(O,R);let z=pE[mE++];if((z&128)>0){mE-=3;return}return YE(O,R,z)}}{let O=pE[mE++],R=pE[mE++],z=pE[mE++],V=pE[mE++];if((O&128)>0||(R&128)>0||(z&128)>0||(V&128)>0){mE-=4;return}if(E<6){if(E===4)return YE(O,R,z,V);{let E=pE[mE++];if((E&128)>0){mE-=5;return}return YE(O,R,z,V,E)}}if(E<8){let j=pE[mE++],Y=pE[mE++];if((j&128)>0||(Y&128)>0){mE-=6;return}if(E<7)return YE(O,R,z,V,j,Y);let ee=pE[mE++];if((ee&128)>0){mE-=7;return}return YE(O,R,z,V,j,Y,ee)}{let j=pE[mE++],Y=pE[mE++],ee=pE[mE++],se=pE[mE++];if((j&128)>0||(Y&128)>0||(ee&128)>0||(se&128)>0){mE-=8;return}if(E<10){if(E===8)return YE(O,R,z,V,j,Y,ee,se);{let E=pE[mE++];if((E&128)>0){mE-=9;return}return YE(O,R,z,V,j,Y,ee,se,E)}}if(E<12){let he=pE[mE++],ce=pE[mE++];if((he&128)>0||(ce&128)>0){mE-=10;return}if(E<11)return YE(O,R,z,V,j,Y,ee,se,he,ce);let ue=pE[mE++];if((ue&128)>0){mE-=11;return}return YE(O,R,z,V,j,Y,ee,se,he,ce,ue)}{let he=pE[mE++],ce=pE[mE++],ue=pE[mE++],fe=pE[mE++];if((he&128)>0||(ce&128)>0||(ue&128)>0||(fe&128)>0){mE-=12;return}if(E<14){if(E===12)return YE(O,R,z,V,j,Y,ee,se,he,ce,ue,fe);{let E=pE[mE++];if((E&128)>0){mE-=13;return}return YE(O,R,z,V,j,Y,ee,se,he,ce,ue,fe,E)}}{let ve=pE[mE++],we=pE[mE++];if((ve&128)>0||(we&128)>0){mE-=14;return}if(E<15)return YE(O,R,z,V,j,Y,ee,se,he,ce,ue,fe,ve,we);let Se=pE[mE++];if((Se&128)>0){mE-=15;return}return YE(O,R,z,V,j,Y,ee,se,he,ce,ue,fe,ve,we,Se)}}}}}function Mw(E){return AE.copyBuffers?Uint8Array.prototype.slice.call(pE,mE,mE+=E):pE.subarray(mE,mE+=E)}function Uc(E){let O=pE[mE++];if(LE[O])return LE[O](pE.subarray(mE,mE+=E));throw new Error("Unknown extension type "+O)}var QE=new Array(4096);function HI(){let E=pE[mE++];if(!(E>=160&&E<192))return mE--,Zr();if(E-=160,TE>=mE)return vE.slice(mE-CE,(mE+=E)-CE);if(!(TE==0&&fE<180))return HE(E);let O,R=4095&(E<<5^(E>1?bE.getUint16(mE):E>0?pE[mE]:0)),z=QE[R],V=mE,j=mE+E-3,Y=0;if(z&&z.bytes==E){for(;V<j;){if(O=bE.getUint32(V),O!=z[Y++]){V=1879048192;break}V+=4}for(j+=3;V<j;)if(O=pE[V++],O!=z[Y++]){V=1879048192;break}if(V===j)return mE=V,z.string;j-=3,V=mE}for(z=[],QE[R]=z,z.bytes=E;V<j;)O=bE.getUint32(V),z.push(O),V+=4;for(j+=3;V<j;)O=pE[V++],z.push(O);let ee=E<16?Rw(E):jI(E);return z.string=ee!=null?ee:HE(E)}var zI=(E,O)=>{var R=Zr();let z=E;O!==void 0&&(E=E<32?-((O<<5)+E):(O<<5)+E,R.highByte=O);let V=gE[E];return V&&V.isShared&&((gE.restoreStructures||(gE.restoreStructures=[]))[E]=V),gE[E]=R,R.read=Ow(R,z),R.read()},ZE=typeof self=="object"?self:global;LE[0]=()=>{};LE[0].noBuffer=!0;LE[101]=()=>{let E=Zr();return(ZE[E[0]]||Error)(E[1])};LE[105]=E=>{let O=bE.getUint32(mE-4);xE||(xE=new Map);let R,z=pE[mE];R=z>=144&&z<160||z==220||z==221?[]:{};let V={target:R};xE.set(O,V);let j=Zr();return V.used?Object.assign(R,j):(V.target=j,j)};LE[112]=E=>{let O=bE.getUint32(mE-4),R=xE.get(O);return R.used=!0,R.target};LE[115]=()=>new Set(Zr());var KE=["Int8","Uint8","Uint8Clamped","Int16","Uint16","Int32","Uint32","Float32","Float64","BigInt64","BigUint64"].map((E=>E+"Array"));LE[116]=E=>{let O=E[0],R=KE[O];if(!R)throw new Error("Could not find typed array for code "+O);return new ZE[R](Uint8Array.prototype.slice.call(E,1).buffer)};LE[120]=()=>{let E=Zr();return new RegExp(E[0],E[1])};LE[98]=E=>{let O=(E[0]<<24)+(E[1]<<16)+(E[2]<<8)+E[3],R=mE;mE+=O-4,yE=[Zr(),Zr()],yE.position0=0,yE.position1=0;let z=mE;mE=R;try{return Zr()}finally{mE=z}};LE[255]=E=>E.length==4?new Date((E[0]*16777216+(E[1]<<16)+(E[2]<<8)+E[3])*1e3):E.length==8?new Date(((E[0]<<22)+(E[1]<<14)+(E[2]<<6)+(E[3]>>2))/1e6+(4294967296*(E[3]&3)+E[4]*16777216+(E[5]<<16)+(E[6]<<8)+E[7])*1e3):E.length==12?new Date(((E[0]<<24)+(E[1]<<16)+(E[2]<<8)+E[3])/1e6+((E[4]&128?-281474976710656:0)+E[6]*1099511627776+E[7]*4294967296+E[8]*16777216+(E[9]<<16)+(E[10]<<8)+E[11])*1e3):new Date("invalid");function qI(E){let O=fE,R=mE,z=_E,V=CE,j=TE,Y=vE,ee=SE,se=xE,he=yE,ce=new Uint8Array(pE.slice(0,fE)),ue=gE,fe=gE.slice(0,gE.length),ve=AE,we=UE,Se=E();return fE=O,mE=R,_E=z,CE=V,TE=j,vE=Y,SE=ee,xE=se,yE=he,pE=ce,UE=we,gE=ue,gE.splice(0,gE.length,...fe),AE=ve,bE=new DataView(pE.buffer,pE.byteOffset,pE.byteLength),Se}function Ov(){pE=null,xE=null,gE=null}function XI(E){E.unpack?LE[E.type]=E.unpack:LE[E.type]=E}var $E=new Array(147);for(let E=0;E<256;E++)$E[E]=+("1e"+Math.floor(45.15-E*.30103));var eC=new VE({useRecords:!1}),tC=(eC.unpack,eC.unpackMultiple,eC.unpack,{NEVER:0,ALWAYS:1,DECIMAL_ROUND:3,DECIMAL_FIT:4}),iC=new Float32Array(1);new Uint8Array(iC.buffer,0,4);var rC;try{rC=new TextEncoder}catch{}var nC,sC,aC,oC,lC,hC=typeof Buffer<"u",cC=hC?Buffer.allocUnsafeSlow:Uint8Array,dC=hC?Buffer:Uint8Array,uC=hC?4294967296:2144337920,pC=0,fC=null,mC=/[\u0080-\uFFFF]/,gC=Symbol("record-id"),vC=class extends VE{constructor(E){super(E),this.offset=0;let O,R,z,V,j,Y=0,ee=dC.prototype.utf8Write?function(E,O,R){return aC.utf8Write(E,O,R)}:!(!rC||!rC.encodeInto)&&function(E,O){return rC.encodeInto(E,aC.subarray(O)).written},se=this;E||(E={});let he=E&&E.sequential,ce=E.structures||E.saveStructures,ue=E.maxSharedStructures;if(ue==null&&(ue=ce?32:0),ue>8160)throw new Error("Maximum maxSharedStructure is 8160");let fe=E.maxOwnStructures;fe==null&&(fe=ce?32:64),he&&!E.saveStructures&&(this.structures=[]);let ve=ue>32||fe+ue>64,we=ue+64,Se=ue+fe+64;if(Se>8256)throw new Error("Maximum maxSharedStructure + maxOwnStructure is 8192");let _e=[],Ae=0,Ce=0;this.pack=this.encode=function(E,ee){if(aC||(aC=new cC(8192),oC=new DataView(aC.buffer,0,8192),pC=0),lC=aC.length-10,lC-pC<2048?(aC=new cC(aC.length),oC=new DataView(aC.buffer,0,aC.length),lC=aC.length-10,pC=0):pC=pC+7&2147483640,O=pC,j=se.structuredClone?new Map:null,se.bundleStrings?(fC=["",""],aC[pC++]=214,aC[pC++]=98,fC.position=pC-O,pC+=4):fC=null,R=se.structures,R){R.uninitialized&&(R=se._mergeStructures(se.getStructures()));let E=R.sharedLength||0;if(E>ue)throw new Error("Shared structures is larger than maximum shared structures, try increasing maxSharedStructures to "+R.sharedLength);if(!R.transitions){R.transitions=Object.create(null);for(let O=0;O<E;O++){let E=R[O];if(!E)continue;let z,V=R.transitions;for(let O=0,R=E.length;O<R;O++){let R=E[O];z=V[R],z||(z=V[R]=Object.create(null)),V=z}V[gC]=O+64}Y=E}he||(R.nextId=E+64)}z&&(z=!1),V=R||[];try{if(w(E),fC){oC.setUint32(fC.position+O,pC-fC.position-O);let E=fC;fC=null,w(E[0]),w(E[1])}if(se.offset=pC,j&&j.idsToInsert){pC+=j.idsToInsert.length*6,pC>lC&&T(pC),se.offset=pC;let E=aq(aC.subarray(O,pC),j.idsToInsert);return j=null,E}return ee&_C?(aC.start=O,aC.end=pC,aC):aC.subarray(O,pC)}finally{if(R){if(Ce<10&&Ce++,Ae>1e4)R.transitions=null,Ce=0,Ae=0,_e.length>0&&(_e=[]);else if(_e.length>0&&!he){for(let E=0,O=_e.length;E<O;E++)_e[E][gC]=0;_e=[]}if(z&&se.saveStructures){let z=R.sharedLength||ue;R.length>z&&(R=R.slice(0,z));let V=aC.subarray(O,pC);return se.saveStructures(R,Y)===!1?(se._mergeStructures(se.getStructures()),se.pack(E)):(Y=z,V)}}ee&AC&&(pC=O)}};let w=E=>{pC>lC&&(aC=T(pC));var R,z=typeof E;if(z==="string"){let O=E.length;if(fC&&O>=8&&O<4096){let R=mC.test(E);fC[R?0:1]+=E,aC[pC++]=193,w(R?-O:O);return}let z;z=O<32?1:O<256?2:O<65536?3:5;let V=O*3;if(pC+V>lC&&(aC=T(pC+V)),O<64||!ee){let V,j,Y,ee=pC+z;for(V=0;V<O;V++)j=E.charCodeAt(V),j<128?aC[ee++]=j:j<2048?(aC[ee++]=j>>6|192,aC[ee++]=j&63|128):(j&64512)===55296&&((Y=E.charCodeAt(V+1))&64512)===56320?(j=65536+((j&1023)<<10)+(Y&1023),V++,aC[ee++]=j>>18|240,aC[ee++]=j>>12&63|128,aC[ee++]=j>>6&63|128,aC[ee++]=j&63|128):(aC[ee++]=j>>12|224,aC[ee++]=j>>6&63|128,aC[ee++]=j&63|128);R=ee-pC-z}else R=ee(E,pC+z,V);R<32?aC[pC++]=160|R:R<256?(z<2&&aC.copyWithin(pC+2,pC+1,pC+1+R),aC[pC++]=217,aC[pC++]=R):R<65536?(z<3&&aC.copyWithin(pC+3,pC+2,pC+2+R),aC[pC++]=218,aC[pC++]=R>>8,aC[pC++]=R&255):(z<5&&aC.copyWithin(pC+5,pC+3,pC+3+R),aC[pC++]=219,oC.setUint32(pC,R),pC+=4),pC+=R}else if(z==="number")if(E>>>0===E)E<64?aC[pC++]=E:E<256?(aC[pC++]=204,aC[pC++]=E):E<65536?(aC[pC++]=205,aC[pC++]=E>>8,aC[pC++]=E&255):(aC[pC++]=206,oC.setUint32(pC,E),pC+=4);else if((E|0)===E)E>=-32?aC[pC++]=256+E:E>=-128?(aC[pC++]=208,aC[pC++]=E+256):E>=-32768?(aC[pC++]=209,oC.setInt16(pC,E),pC+=2):(aC[pC++]=210,oC.setInt32(pC,E),pC+=4);else{let O;if((O=this.useFloat32)>0&&E<4294967296&&E>=-2147483648){aC[pC++]=202,oC.setFloat32(pC,E);let R;if(O<4||((R=E*$E[(aC[pC]&127)<<1|aC[pC+1]>>7])|0)===R){pC+=4;return}pC--}aC[pC++]=203,oC.setFloat64(pC,E),pC+=8}else if(z==="object")if(E){if(j){let R=j.get(E);if(R){if(!R.id){let E=j.idsToInsert||(j.idsToInsert=[]);R.id=E.push(R)}aC[pC++]=214,aC[pC++]=112,oC.setUint32(pC,R.id),pC+=4;return}j.set(E,{offset:pC-O})}let z=E.constructor;if(z===Object)Te(E,!0);else if(z===Array){R=E.length,R<16?aC[pC++]=144|R:R<65536?(aC[pC++]=220,aC[pC++]=R>>8,aC[pC++]=R&255):(aC[pC++]=221,oC.setUint32(pC,R),pC+=4);for(let O=0;O<R;O++)w(E[O])}else if(z===Map){R=E.size,R<16?aC[pC++]=128|R:R<65536?(aC[pC++]=222,aC[pC++]=R>>8,aC[pC++]=R&255):(aC[pC++]=223,oC.setUint32(pC,R),pC+=4);for(let[O,R]of E)w(O),w(R)}else{for(let O=0,R=nC.length;O<R;O++){let R=sC[O];if(E instanceof R){let R=nC[O];if(R.write){R.type&&(aC[pC++]=212,aC[pC++]=R.type,aC[pC++]=0),w(R.write.call(this,E));return}let z=aC,V=oC,j=pC;aC=null;let Y;try{Y=R.pack.call(this,E,(E=>(aC=z,z=null,pC+=E,pC>lC&&T(pC),{target:aC,targetView:oC,position:pC-E})),w)}finally{z&&(aC=z,oC=V,pC=j,lC=aC.length-10)}Y&&(Y.length+pC>lC&&T(Y.length+pC),pC=oq(Y,aC,pC,R.type));return}}Te(E,!E.hasOwnProperty)}}else aC[pC++]=192;else if(z==="boolean")aC[pC++]=E?195:194;else if(z==="bigint"){if(E<BigInt(1)<<BigInt(63)&&E>=-(BigInt(1)<<BigInt(63)))aC[pC++]=211,oC.setBigInt64(pC,E);else if(E<BigInt(1)<<BigInt(64)&&E>0)aC[pC++]=207,oC.setBigUint64(pC,E);else{if(!this.largeBigIntToFloat)throw new RangeError(E+" was too large to fit in MessagePack 64-bit integer format, set largeBigIntToFloat to convert to float-64");aC[pC++]=203,oC.setFloat64(pC,Number(E))}pC+=8}else if(z==="undefined")this.encodeUndefinedAsNil?aC[pC++]=192:(aC[pC++]=212,aC[pC++]=0,aC[pC++]=0);else{if(z!=="function")throw new Error("Unknown type: "+z);w(this.writeFunction&&this.writeFunction())}},Te=this.useRecords===!1?this.variableMapSize?E=>{let O=Object.keys(E),R=O.length;R<16?aC[pC++]=128|R:R<65536?(aC[pC++]=222,aC[pC++]=R>>8,aC[pC++]=R&255):(aC[pC++]=223,oC.setUint32(pC,R),pC+=4);let z;for(let V=0;V<R;V++)w(z=O[V]),w(E[z])}:(E,R)=>{aC[pC++]=222;let z=pC-O;pC+=2;let V=0;for(let O in E)(R||E.hasOwnProperty(O))&&(w(O),w(E[O]),V++);aC[z+++O]=V>>8,aC[z+O]=V&255}:E=>{let O,R=Object.keys(E),j=V.transitions||(V.transitions=Object.create(null)),Y=0;for(let E=0,z=R.length;E<z;E++){let z=R[E];O=j[z],O||(O=j[z]=Object.create(null),Y++),j=O}let ee=j[gC];if(ee)ee>=96&&ve?(aC[pC++]=96+(31&(ee-=96)),aC[pC++]=ee>>5):aC[pC++]=ee;else{ee=V.nextId,ee||(ee=64),ee<we&&this.shouldShareStructure&&!this.shouldShareStructure(R)?(ee=V.nextOwnId,ee<Se||(ee=we),V.nextOwnId=ee+1):(ee>=Se&&(ee=we),V.nextId=ee+1);let E=R.highByte=ee>=96&&ve?ee-96>>5:-1;j[gC]=ee,V[ee-64]=R,ee<we?(R.isShared=!0,V.sharedLength=ee-63,z=!0,E>=0?(aC[pC++]=96+(ee&31),aC[pC++]=E):aC[pC++]=ee):(E>=0?(aC[pC++]=213,aC[pC++]=114,aC[pC++]=96+(ee&31),aC[pC++]=E):(aC[pC++]=212,aC[pC++]=114,aC[pC++]=ee),Y&&(Ae+=Ce*Y),_e.length>=fe&&(_e.shift()[gC]=0),_e.push(j),w(R))}for(let O=0,z=R.length;O<z;O++)w(E[R[O]])},T=E=>{let R;if(E>16777216){if(E-O>uC)throw new Error("Packed buffer would be larger than maximum buffer size");R=Math.min(uC,Math.round(Math.max((E-O)*(E>67108864?1.25:2),4194304)/4096)*4096)}else R=1+(Math.max(E-O<<2,aC.length-1)>>12)<<12;let z=new cC(R);return oC=new DataView(z.buffer,0,R),aC.copy?aC.copy(z,0,O,E):z.set(aC.slice(O,E)),pC-=O,O=0,lC=z.length-10,aC=z}}useBuffer(E){aC=E,oC=new DataView(aC.buffer,aC.byteOffset,aC.byteLength),pC=0}};sC=[Date,Set,Error,RegExp,ArrayBuffer,Object.getPrototypeOf(Uint8Array.prototype).constructor,zE];nC=[{pack(E,O,R){let z=E.getTime()/1e3;if((this.useTimestamp32||E.getMilliseconds()===0)&&z>=0&&z<4294967296){let{target:E,targetView:R,position:V}=O(6);E[V++]=214,E[V++]=255,R.setUint32(V,z)}else if(z>0&&z<17179869184){let{target:R,targetView:V,position:j}=O(10);R[j++]=215,R[j++]=255,V.setUint32(j,E.getMilliseconds()*4e6+(z/1e3/4294967296|0)),V.setUint32(j+4,z)}else if(isNaN(z)){if(this.onInvalidDate)return O(0),R(this.onInvalidDate());let{target:E,targetView:z,position:V}=O(3);E[V++]=212,E[V++]=255,E[V++]=255}else{let{target:R,targetView:V,position:j}=O(15);R[j++]=199,R[j++]=12,R[j++]=255,V.setUint32(j,E.getMilliseconds()*1e6),V.setBigInt64(j+4,BigInt(Math.floor(z)))}}},{pack(E,O,R){let z=Array.from(E),{target:V,position:j}=O(this.structuredClone?3:0);this.structuredClone&&(V[j++]=212,V[j++]=115,V[j++]=0),R(z)}},{pack(E,O,R){let{target:z,position:V}=O(this.structuredClone?3:0);this.structuredClone&&(z[V++]=212,z[V++]=101,z[V++]=0),R([E.name,E.message])}},{pack(E,O,R){let{target:z,position:V}=O(this.structuredClone?3:0);this.structuredClone&&(z[V++]=212,z[V++]=120,z[V++]=0),R([E.source,E.flags])}},{pack(E,O){this.structuredClone?KI(E,16,O):QI(hC?Buffer.from(E):new Uint8Array(E),O)}},{pack(E,O){let R=E.constructor;R!==dC&&this.structuredClone?KI(E,KE.indexOf(R.name),O):QI(E,O)}},{pack(E,O){let{target:R,position:z}=O(1);R[z]=193}}];function KI(E,O,R,z){let V=E.byteLength;if(V+1<256){var{target:j,position:Y}=R(4+V);j[Y++]=199,j[Y++]=V+1}else if(V+1<65536){var{target:j,position:Y}=R(5+V);j[Y++]=200,j[Y++]=V+1>>8,j[Y++]=V+1&255}else{var{target:j,position:Y,targetView:ee}=R(7+V);j[Y++]=201,ee.setUint32(Y,V+1),Y+=4}j[Y++]=116,j[Y++]=O,j.set(new Uint8Array(E.buffer,E.byteOffset,E.byteLength),Y)}function QI(E,O){let R=E.byteLength;var z,V;if(R<256){var{target:z,position:V}=O(R+2);z[V++]=196,z[V++]=R}else if(R<65536){var{target:z,position:V}=O(R+3);z[V++]=197,z[V++]=R>>8,z[V++]=R&255}else{var{target:z,position:V,targetView:j}=O(R+5);z[V++]=198,j.setUint32(V,R),V+=4}z.set(E,V)}function oq(E,O,R,z){let V=E.length;switch(V){case 1:O[R++]=212;break;case 2:O[R++]=213;break;case 4:O[R++]=214;break;case 8:O[R++]=215;break;case 16:O[R++]=216;break;default:V<256?(O[R++]=199,O[R++]=V):V<65536?(O[R++]=200,O[R++]=V>>8,O[R++]=V&255):(O[R++]=201,O[R++]=V>>24,O[R++]=V>>16&255,O[R++]=V>>8&255,O[R++]=V&255)}return O[R++]=z,O.set(E,R),R+=V,R}function aq(E,O){let R,z=O.length*6,V=E.length-z;for(O.sort(((E,O)=>E.offset>O.offset?1:-1));R=O.pop();){let O=R.offset,j=R.id;E.copyWithin(O+z,O,V),z-=6;let Y=O+z;E[Y++]=214,E[Y++]=105,E[Y++]=j>>24,E[Y++]=j>>16&255,E[Y++]=j>>8&255,E[Y++]=j&255,V=O}return E}function Pl(E){if(E.Class){if(!E.pack&&!E.write)throw new Error("Extension has no pack or write function");if(E.pack&&!E.type)throw new Error("Extension has no type (numeric code to identify the extension)");sC.unshift(E.Class),nC.unshift(E)}XI(E)}var yC=new vC({useRecords:!1});yC.pack,yC.pack;var{NEVER:xC,ALWAYS:bC,DECIMAL_ROUND:wC,DECIMAL_FIT:SC}=tC,_C=512,AC=1024;var EC=new vC({structuredClone:!0});Pl({Class:NM.prototype.constructor,type:1,write(E){return{...E}},read(E){return Object.setPrototypeOf(E,NM.prototype),E}});Pl({Class:jM.prototype.constructor,type:2,write(E){return[...E]},read(E){return Object.setPrototypeOf(E,jM.prototype),E}});Pl({Class:kM.prototype.constructor,type:3,write(E){return[...E]},read(E){return Object.setPrototypeOf(E,kM.prototype),E}});Pl({Class:cE.prototype.constructor,type:4,write(E){return E.id},read(E){return new cE(E)}});Pl({Class:dE.prototype.constructor,type:5,write(E){return E.data},read(E){return new dE(E)}});Pl({Class:HM.prototype.constructor,type:6,write(E){return{...E}},read(E){return Object.setPrototypeOf(E,HM.prototype),E}});function mq(E){var O=0;if(E.length===0)return O;for(let R=0;R<E.length;R++){let z=E[R];O=(O<<5)-O+z,O|=0}return O}function Fw(E){if(zh(E))return E;if(Array.isArray(E))return E.map(Fw);if(typeof E=="object"&&E!==null){let O={};for(let R of Object.keys(E).sort())O[R]=Fw(E[R]);return Object.setPrototypeOf(O,Object.getPrototypeOf(E)),O}return E}var PC;(E=>{function n(E){return EC.pack(E)}E.serialize=n;function t(E){return EC.unpack(E)}E.deserialize=t;function e(E){return mq(n(Fw(E))).toString()}E.checksum=e})(PC||(PC={}));var DC;(E=>{function n(E){return E.type==="Conditional"?E.condition.type==="Distance"?"Distance":"StateChange":E.type}E.toEventUIType=n;function t(E){return E==="Distance"||E==="StateChange"?"Conditional":E}E.fromEventUIType=t})(DC||(DC={}));function Uw(E){return E==="MouseDown"||E==="MouseUp"||E==="KeyDown"||E==="KeyUp"||E==="Collision"||E==="Trigger"}var IC,OC={LookAt:[],Follow:["Create"],DragDrop:["Transition","Animation","Audio","Particles","Create","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],MouseHover:["Transition","Animation","Particles","Create","Destroy","SwitchCamera","SceneTransition","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],Scroll:["Transition","Animation","Create","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],Start:["Transition","Animation","Audio","Particles","Video","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],Conditional:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],MouseDown:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],MouseUp:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],MousePress:["Transition","Animation","Audio","Particles","Video","Link","Create","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],KeyDown:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],KeyUp:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],KeyPress:["Transition","Animation","Audio","Particles","Video","Link","Create","SwitchCamera","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],GameControl:["Transition","Animation","Audio","Particles","Create","Conditional"],Collision:["Transition","Animation","Audio","Particles","Video","Create","Destroy","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],Trigger:["Transition","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],Resize:["Transition","Animation","Audio","Particles","Video","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],VariableChange:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],API:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],WEBHOOK:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],AIAssistantListener:["SetVariable"],AIAssistantTrigger:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"]};(E=>{function n(E){return E.type==="MouseDown"||E.type==="MouseUp"||E.type==="MousePress"||E.type==="KeyDown"||E.type==="KeyUp"||E.type==="KeyPress"}E.is=n;function t(E){return E==="MouseDown"||E==="MouseUp"||E==="MousePress"?{type:E,mode:"Object",disabled:!1,actions:new jM}:{type:E,disabled:!1,key:void 0,actions:new jM}}E.defaultData=t})(IC||(IC={}));var jC;(E=>{function n(E){return{type:"Property",value:[E??null,"position","x"]}}E.propertyDefaultData=n,E.valueDefaultData={type:"Literal",value:0}})(jC||(jC={}));var HC;(E=>{function n(E){return{type:"Comparison",operator:"==",lOperand:jC.propertyDefaultData(E),rOperand:{...jC.valueDefaultData}}}E.comparisonDefaultData=n;function t(E){return{type:"Distance",toObject:E??null,fromObject:E??null,distance:200}}E.distanceDefaultData=t;function e(E,O){return{type:"State",object:E??null,state:O??null}}E.stateDefaultData=e})(HC||(HC={}));var WC;(E=>{function n(E){return E.find((E=>E==="ifActions"||E==="elseActions"))!==void 0}E.isConditionalSubActions=n})(WC||(WC={}));var qC;(E=>{function n(E){return E.type==="Conditional"}E.is=n;function t(E){return{type:"Conditional",disabled:!1,inActions:new jM,outActions:new jM,condition:HC.distanceDefaultData(E)}}E.defaultData=t})(qC||(qC={}));var XC;(E=>E.defaultData={type:"DragDrop",cursor:"hand",disabled:!1,dampingFactor:1,objects:[],snapTo:"center",snapSurfaceMode:"bbox",snapSurfaceOffset:0,dropOn:"all",autoOrient:!0,dropDestinations:[],plane:"adaptive",planeMode:"locked",referenceFrame:"global",limits:[-1/0,1/0,-1/0,1/0,-1/0,1/0],drop:!1,resetOnSnapFail:!1,snapSpeed:20,resetSpeed:20,dragDropActions:{drag:new jM,drop:new jM}})(XC||(XC={}));var YC;(E=>E.defaultData={type:"Follow",disabled:!1,maxDelta:0,dampingFactor:1,target:"cursor",plane:"custom",resetOnPointerLeave:!0,resetAfterDistanceLimit:!0,enabledTranslation:[!0,!0,!0],limitDistanceEnabled:!1,limitDistance:1e3,snapDelay:0,resetSpeed:5,actions:new jM})(YC||(YC={}));var QC;(E=>E.defaultData={type:"LookAt",disabled:!1,distance:1e3,dampingFactor:1,target:"cursor",tilt:"up",axis:"z",plane:"custom",resetOnPointerLeave:!0,resetAfterDistanceLimit:!0,enabledRotation:[!0,!0,!0],limitDistanceEnabled:!1,limitDistance:1e3,snapDelay:0,resetSpeed:5})(QC||(QC={}));var KC;(E=>{function n(E){return E.type==="MouseHover"}E.is=n;function t(){return{type:"MouseHover",disabled:!1,actions:new jM}}E.defaultData=t})(KC||(KC={}));var eT;(E=>{function n(E){return E.type==="Scroll"}E.is=n;function t(){return{type:"Scroll",disabled:!1,steps:100,trigger:"load",startFrom:"enter",enterAnchor:"top",startOffset:0,endAfter:400,actions:new jM}}E.defaultData=t})(eT||(eT={}));var tT;(E=>{function n(E){return E.type==="Start"}E.is=n;function t(){return{type:"Start",disabled:!1,actions:new jM}}E.defaultData=t})(tT||(tT={}));var nT;(E=>{function n(E){return E.type==="Collision"}E.is=n;function t(){return{type:"Collision",disabled:!1,target:"character",actions:new jM}}E.defaultData=t})(nT||(nT={}));var sT;(E=>{function n(E){return E.type==="Trigger"}E.is=n;function t(E,O){return{type:"Trigger",disabled:!1,target:"all",triggeringObjects:[],actions:new jM,triggerZone:"box",position:O.toArray(),rotation:[0,0,0],size:E.toArray(),radius:E.length()/2,helperVisible:!0}}E.defaultData=t})(sT||(sT={}));var aT;(E=>{E.defaultSizes={mobile:[480,480],tablet:[768,768],desktop:[1200,1200],custom:[769,1200]};function t(E){return E.type==="Resize"}E.is=t;function e(E){return typeof E=="string"?E:"custom"}E.sizeToDevice=e;function r(O){return typeof O=="string"?[...E.defaultSizes[O]]:[...O]}E.deviceToSize=r;function i(){let O={size:"mobile",operator:"<",actions:new jM},R={size:"tablet",operator:"<",actions:new jM},z={size:[...E.defaultSizes.custom],operator:"<>",actions:new jM},V=new jM;return V.push({id:xn.generateUUID(),fi:0,data:O},{id:xn.generateUUID(),fi:1,data:R},{id:xn.generateUUID(),fi:2,data:z}),{type:"Resize",disabled:!1,orientation:"horizontal",breakpoints:V}}E.defaultData=i;function s(){return{size:[...E.defaultSizes.custom],operator:"<>",actions:new jM}}E.defaultBreakpointData=s})(aT||(aT={}));var oT;(E=>{E.propertyPaths={Position:["position"],"Position X":["position","x"],"Position Y":["position","y"],"Position Z":["position","z"],Rotation:["rotation"],"Rotation X":["rotation","x"],"Rotation Y":["rotation","y"],"Rotation Z":["rotation","z"],Scale:["scale"],"Scale X":["scale","x"],"Scale Y":["scale","y"],"Scale Z":["scale","z"],Width:["width"],Height:["height"],Depth:["depth"],"Mouse Position X":["mouse","x"],"Mouse Position Y":["mouse","y"],"Mouse Pressed":["mouse","pressed"],"Screen Width":["mouse","width"],"Screen Height":["mouse","height"],"Hit Position X":["raycast","x"],"Hit Position Y":["raycast","y"],"Hit Position Z":["raycast","z"],"Hit Object Position X":["raycast","objX"],"Hit Object Position Y":["raycast","objY"],"Hit Object Position Z":["raycast","objZ"]};function t(E){return E.type==="VariableChange"}E.is=t;function e(){return{disabled:!1,type:"VariableChange",actions:new jM,variableId:"",objectId:null,property:"Position X"}}E.defaultData=e})(oT||(oT={}));var hT;(E=>{function n(E){return E.type==="API"}E.is=n;function t(){return{disabled:!1,type:"API",successActions:new jM,errorActions:new jM,userAPIId:""}}E.defaultData=t})(hT||(hT={}));var cT;(E=>{function n(E){return E.type==="WEBHOOK"}E.is=n;function t(){return{disabled:!1,type:"WEBHOOK",actions:new jM,userWebhookId:""}}E.defaultData=t})(cT||(cT={}));var dT;(E=>{function n(E){return E.type==="AIAssistantListener"}E.is=n;function t(){return{disabled:!1,type:"AIAssistantListener",actions:new jM,analysis:"average",analysisRange:[0,71],analysisSingle:0}}E.defaultData=t})(dT||(dT={}));var pT;(E=>{function n(E){return E.type==="AIAssistantTrigger"}E.is=n;function t(){return{disabled:!1,description:"",type:"AIAssistantTrigger",actions:new jM}}E.defaultData=t})(pT||(pT={}));var fT="personal camera",gT="a218fcc3-276b-49b9-b485-49037fd14f5f",vT=2960946,yT=5526619;var xT;(E=>{function n(E,O){return E[0]===O[0]&&E[1]===O[1]}E.isEqual=n;function t(E,O,R){return[E[0]+(O[0]-E[0])*R,E[1]+(O[1]-E[1])*R]}E.lerp=t;function e(E,O){return[E[0]+O[0],E[1]+O[1]]}E.add=e;function r(E,O){return[E[0]-O[0],E[1]-O[1]]}E.sub=r;function i(E,O){return[E[0]*O[0],E[1]*O[1]]}E.multiply=i;function s(E,O){return[E[0]/O[0],E[1]/O[1]]}E.divide=s;function o(E,O){return Math.pow(O[0]-E[0],2)+Math.pow(O[1]-E[1],2)}E.distanceSquared=o;function a(E,O){return Math.sqrt(o(E,O))}E.distance=a;function l(E,O){return E[0]*O[0]+E[1]*O[1]}E.dot=l;function c(E,O){return[E[0]*O,E[1]*O]}E.scalarMultiply=c;function u(O,R,z){let V=E.sub(R,O),j=E.sub(z,O),Y=E.dot(V,j)/E.dot(V,V),ee=E.scalarMultiply(V,Y);return E.add(O,ee)}E.projectionOnto=u;function h(E,O,R){return a(E,u(E,O,R))}E.projectionOntoDistance=h;function d(E,O){return[(E[0]+O[0])*.5,(E[1]+O[1])*.5]}E.center=d})(xT||(xT={}));var wT;(E=>{function n(E,O){return E[0]===O[0]&&E[1]===O[1]&&E[2]===O[2]}E.isEqual=n;function t(E,O){return[E[0]+O[0],E[1]+O[1],E[2]+O[2]]}E.add=t;function e(E,O){return[E[0]-O[0],E[1]-O[1],E[2]-O[2]]}E.sub=e;function r(E,O){return[E[0]/O[0],E[1]/O[1],E[2]/O[2]]}E.div=r;function i(E,O){return[E[0]*O[0],E[1]*O[1],E[2]*O[2]]}E.mul=i;function s(E,O){return Math.hypot(E[0]-O[0],E[1]-O[1],E[2]-O[2])}E.dist=s;function o(E,O,R){return[E[0]+(O[0]-E[0])*R,E[1]+(O[1]-E[1])*R,E[2]+(O[2]-E[2])*R]}E.lerp=o})(wT||(wT={}));var AT;(E=>{function n(E,O){return E[0]===O[0]&&E[1]===O[1]&&E[2]===O[2]&&E[3]===O[3]}E.isEqual=n;function t(E,O,R){return[E[0]+(O[0]-E[0])*R,E[1]+(O[1]-E[1])*R,E[2]+(O[2]-E[2])*R,E[3]+(O[3]-E[3])*R]}E.lerp=t})(AT||(AT={}));var MT;(E=>{let O=180/Math.PI,R=Math.PI/180;function e(E){return typeof E=="number"?E*O:E}function r(E){return typeof E=="number"?E*R:E}function i(E){return[e(E[0]),e(E[1]),e(E[2])]}E.radToDeg=i;function s(E){return[r(E[0]),r(E[1]),r(E[2])]}E.degToRad=s})(MT||(MT={}));var ET;(E=>{E.identity=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];function t(E,O){for(let R=0;R<16;R++)if(E[R]!==O[R])return!1;return!0}E.isEqual=t;function e(O){return O??E.identity}E.simplify=e;function r(E,O){let R=O.slice(0);for(var z=0,V=O.length;z<V;z+=3){let V=E[3]*O[z]+E[7]*O[z+1]+E[11]*O[z+2]+E[15];R[z]=(E[0]*O[z]+E[4]*O[z+1]+E[8]*O[z+2]+E[12])/V,R[z+1]=(E[1]*O[z]+E[5]*O[z+1]+E[9]*O[z+2]+E[13])/V,R[z+2]=(E[2]*O[z]+E[6]*O[z+1]+E[10]*O[z+2]+E[14])/V}return R}E.applyMatrix4=r})(ET||(ET={}));var TT;(E=>{function n(E){return typeof E=="object"&&typeof E.r=="number"&&typeof E.g=="number"&&typeof E.b=="number"}E.isRGB=n,E.white={r:1,g:1,b:1},E.red={r:1,g:0,b:0},E.black={r:0,g:0,b:0};function i(E){return{r:Math.round(E.r*255),g:Math.round(E.g*255),b:Math.round(E.b*255),a:1}}E.toRgb255a1=i;function s(E){return{r:E.r,g:E.g,b:E.b}}E.clone=s;function o(E){return E=Math.floor(E),{r:(E>>16&255)/255,g:(E>>8&255)/255,b:(E&255)/255}}E.fromHex=o;function a(E){return Math.round(E.r*255)*65536+Math.round(E.g*255)*256+Math.round(E.b*255)}E.toHex=a;function l(E,O){return E.r===O.r&&E.g===O.g&&E.b===O.b}E.equals=l;function c(E,O){return E.r.toFixed(2)===O.r.toFixed(2)&&E.g.toFixed(2)===O.g.toFixed(2)&&E.b.toFixed(2)===O.b.toFixed(2)}E.equalsFixed=c;function u(E,O,R){return{r:E.r+(O.r-E.r)*R,g:E.g+(O.g-E.g)*R,b:E.b+(O.b-E.b)*R}}E.lerp=u})(TT||(TT={}));var PT;(E=>{E.white={...TT.white,a:1},E.transparent={...TT.white,a:0};function e(E){return{r:E[0],g:E[1],b:E[2],a:E[3]}}E.from0to1=e;function r(E,O){return{...TT.fromHex(E),a:O}}E.fromHexAndA=r;function i(E){return{r:Math.round(E.r*255),g:Math.round(E.g*255),b:Math.round(E.b*255),a:E.a}}E.toRgb255a1=i;function s(E,O){return TT.equals(E,O)&&E.a===O.a}E.equals=s;function o(E,O){return TT.equalsFixed(E,O)&&E.a.toFixed(2)===O.a.toFixed(2)}E.equalsFixed=o;function a(E,O,R){return{r:E.r+(O.r-E.r)*R,g:E.g+(O.g-E.g)*R,b:E.b+(O.b-E.b)*R,a:E.a+(O.a-E.a)*R}}E.lerp=a;function l({r:O,g:R,b:z,a:V}=E.white){return`rgba(${O*255}, ${R*255}, ${z*255}, ${V})`}E.toStyle=l})(PT||(PT={}));var NT;(E=>E.identity={position:[0,0,0],rotation:[0,0,0],scale:[1,1,1]})(NT||(NT={}));var qT;(E=>E.defaultData={mass:1,stiffness:80,damping:10,velocity:0})(qT||(qT={}));var ZT;(E=>E.defaultData={control1:[.5,0],control2:[.5,1]})(ZT||(ZT={}));var JT;(E=>(E.linear=[0,0,1,1],E.ease=[.25,.1,.25,1],E.easeIn=[.42,0,1,1],E.easeOut=[0,0,.58,1],E.easeInOut=[.42,0,.58,1]))(JT||(JT={}));function zw(E){return typeof E=="string"&&E.length===36&&/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(E)}var $T;(E=>{E.all=["PerspectiveCamera","OrthographicCamera"];function t(O){return E.all.includes(O)}E.is=t})($T||($T={}));var iP;(E=>{E.DefaultUp=[0,1,0],E.DefaultTargetOffset=1e3,E.defaultData={far:1e5,type:"OrthographicCamera",perspective:{near:70,fov:45,zoom:1},orthographic:{near:-1e5,zoom:1},up:E.DefaultUp,isUpVectorFlipped:!1,targetOffset:E.DefaultTargetOffset};function r(E){return E.type==="PerspectiveCamera"?E.perspective?.zoom??1:E.orthographic?.zoom??1}E.getZoom=r})(iP||(iP={}));var rP;(E=>{function n(E,O=.1){return{disabled:!1,type:"linear",hideBase:!1,count:3,radial:{radius:Math.max(E[0],E[1])*2,start:0,end:360,alignment:!1,axis:"y",scale:[1,1,1],rotation:[0,0,0],position:[0,0,0]},toObject:{object:"",spreadType:"random",scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],axis:"x",seed:0,count:99,align:"normal"},linear:{scale:[1,1,1],rotation:[0,0,0],position:[E[0]+E[0]*O,0,0]},grid:{count:[2,2,2],size:E.map((E=>E*(1+O))),useCenter:!0},randomness:!1,randomnessObject:{strength:100,scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],movement:1,seed:0,freqScale:10,noiseType:"perlin"}}}E.defaultData=n;function t(E,O){let R={...E};if(aP.forEach((z=>{Object.assign(R,{[z]:O[z]??E[z]})})),R.radial={...E.radial},O.radial){let z=E.radial,V=O.radial;lP.forEach((E=>{Object.assign(R.radial,{[E]:V[E]??z[E]})}))}if(R.linear={...E.linear},O.linear){let z=E.linear,V=O.linear;hP.forEach((E=>{Object.assign(R.linear,{[E]:V[E]??z[E]})}))}if(R.grid={...E.grid},O.grid){let z=E.grid,V=O.grid;cP.forEach((E=>{Object.assign(R.grid,{[E]:V[E]??z[E]})}))}if(R.toObject={...E.toObject},O.toObject){let z=E.toObject,V=O.toObject;dP.forEach((E=>{Object.assign(R.toObject,{[E]:V[E]??z[E]})}))}if(R.randomnessObject={...E.randomnessObject},O.randomnessObject){let z=E.randomnessObject,V=O.randomnessObject;uP.forEach((E=>{Object.assign(R.randomnessObject,{[E]:V[E]??z[E]})}))}return R}E.merge=t})(rP||(rP={}));var nP;(E=>{E.defaultData={radial:{},linear:{},grid:{},toObject:{},randomnessObject:{}};let O=["radial","linear","grid","toObject","randomnessObject"];function e(E,R){let z=[];E.count!==void 0&&z.push({type:0,path:R,props:{count:E.count}});for(let V of O){let O=E[V];O&&Object.keys(O).length>0&&z.push({type:0,path:[...R,V],props:O})}return z}E.toOps=e})(nP||(nP={}));var aP=["count"],lP=["radius","start","end","position","scale","rotation"],hP=["position","scale","rotation"],cP=["count","size"],dP=["count","position","scale","rotation"],uP=["strength","scale","rotation","position","movement","seed","freqScale"];var pP;(E=>{E.all=["PointLight","SpotLight","DirectionalLight","HemisphereLight"];function t(O){return E.all.includes(O)}E.is=t})(pP||(pP={}));var fP;(E=>{function n(E){return t(E)}E.defaultData=n;function t(E){if(E==="PointLight")return{type:E,color:PT.white,intensity:1,distance:2e3,decay:1,shadows:!0,shadowResolution:1024,shadowRadius:1,penumbraSize:.5,depth:1e5};if(E==="SpotLight")return{type:E,color:PT.white,intensity:1,distance:2e3,decay:1,shadows:!0,penumbra:0,angle:30/180*Math.PI,depth:1e5,penumbraSize:.5,shadowResolution:1024,shadowRadius:1};if(E==="DirectionalLight")return{type:E,color:PT.white,intensity:1,shadows:!0,size:2e3,depth:1e5,penumbraSize:.5,shadowResolution:1024,shadowRadius:1};throw new Error("not implemented")}})(fP||(fP={}));var mP;(E=>(E.defaultShapeData={type:"PlaneEmitterShape",size:[100,100,100]},E.defaultCollisionData={colliderEntityId:null,collisionBounce:.75},E.defaultData={renderMaterial:{type:"particleMaterial",color:{r:1,g:.2,b:.545,a:1},color2:{r:.945,g:.714,b:.184,a:1},coloring:"gradient",ease:"linearFadeOut",easeSize:"linearFadeOut",transparent:!0,size:[40,40],texture:"pt_default_particle",spriteRotation:[0,0]},birthRatePerSec:50,gravity:1,noiseStrength:0,noiseScale:0,noiseSeed:1,noiseType:"curl",randomRotation:0,randomScale:.2,randomMass:.5,rootObjectType:"instancedMesh",life:1,direction:[0,0,0],directionMode:"axis",speed:10,shape:E.defaultShapeData,autoPlay:!0,emitTimeDelay:0,emitTimeCycle:"infinity",emitTimeDuration:1,...E.defaultCollisionData}))(mP||(mP={}));var gP;(E=>E.defaultData={enabled:"visibility",fusedBody:!0,rigidBody:"positioned",density:1,pointMass:0,gravityScale:1,friction:.5,damping:0,restitution:.2,colliderType:"convex",enabledRotation:[!0,!0,!0],enabledTranslation:[!0,!0,!0]})(gP||(gP={}));var yP;(E=>{E.defaultData={castShadow:!0,receiveShadow:!0};function t(E,O){return E.castShadow===O.castShadow&&E.receiveShadow===O.receiveShadow}E.equals=t})(yP||(yP={}));var bP;(E=>{E.defaultData={flatShading:!1,wireframe:!1,side:0};function t(E,O){return E.flatShading===O.flatShading&&E.side===O.side&&E.wireframe===O.wireframe}E.equals=t})(bP||(bP={}));var AP;(E=>E.defaultData={...bP.defaultData,...yP.defaultData})(AP||(AP={}));var MP;(E=>{function n(E,O){let R=[];if("material"in E){let z=typeof E.material=="string"?O.materials[E.material]??O.lib.materials[E.material]?.asset:E.material;z&&R.push(z)}else if("materials"in E)for(let z of E.materials){let E=typeof z=="string"?O.materials[z]??O.lib.materials[z]?.asset:z;E&&R.push(E)}return R}E.getMaterialData=n})(MP||(MP={}));var EP;(E=>(E.defaultVideo={data:"",thumb:"/_assets/_videos/catThumb.png",type:"video",name:"Cat video"},E.maxSize=3e7))(EP||(EP={}));var TP;(E=>{function n(E){return E==="texture"||E==="video"||E==="color"||E==="depth"||E==="normal"||E==="gradient"||E==="noise"||E==="fresnel"||E==="rainbow"||E==="toon"||E==="outline"||E==="particle"||E==="transmission"||E==="matcap"||E==="displace"||E==="pattern"||E==="light"}E.is=n})(TP||(TP={}));function wD(E){return E.type!=="displace"}var OP;(E=>{function n(E){return E==="phong"||E==="toon"||E==="lambert"||E==="physical"}E.is=n})(OP||(OP={}));var LP,BP=["mode","gradientType","noiseType","displacementType","projection","cnormal","crop","axis","side"],zP=["wrapping","image","video","name","minFilter","magFilter"];(E=>{function n(E,O){let{texture:R,...z}=O;if(Object.assign(E,z),R){let O=E.texture;O&&Object.assign(O,R)}}E.patch=n;function t(E,O){return E==="light"&&O?e(O):r(E)}E.defaultData=t;function e(E){let O={mode:0,isMask:!1,visible:!0,bumpMap:void 0,bumpMapIntensity:5,roughnessMap:void 0,alphaOverride:1};switch(E){case"phong":return{...O,category:"phong",specular:{r:.2,g:.2,b:.2},shininess:5,type:"light",visible:!0,mode:0,occlusion:!0,alpha:.6};case"toon":return{...O,category:"toon",specular:{r:.2,g:.2,b:.2},shininess:10,type:"light",alpha:1};case"lambert":return{...O,category:"lambert",emissive:{r:0,g:0,b:0},type:"light",alpha:1,visible:!0,mode:0,occlusion:!0};case"physical":return{...O,category:"physical",roughness:.2,metalness:.2,reflectivity:.2,type:"light",alpha:1,visible:!0,mode:0,occlusion:!0}}}function r(E){let O={alpha:1,mode:0,isMask:!1,visible:!0};switch(E){case"texture":return{...O,type:"texture",size:[128,128],blending:0,axis:"x",side:2,projection:0,texture:{image:"image_0",wrapping:1e3,repeat:[1,1],offset:[0,0],rotation:0,minFilter:1008,magFilter:1006},crop:!1};case"video":return{...O,type:"video",size:[128,128],blending:0,axis:"x",side:2,projection:0,texture:{video:EP.defaultVideo,wrapping:1001,repeat:[1,1],offset:[0,0],rotation:0,minFilter:1008,magFilter:1006},crop:!1};case"color":return{...O,type:"color",color:TT.fromHex(yT)};case"depth":return{...O,type:"depth",gradientType:1,smooth:!1,isVector:!0,isWorldSpace:!1,origin:[0,0,0],direction:[1,0,0],colors:[[1,1,1,1],[0,0,0,1]],steps:[0,1],near:50,far:200};case"normal":return{...O,type:"normal",cnormal:[1,1,1]};case"gradient":return{...O,type:"gradient",gradientType:0,smooth:!1,colors:[[0,0,0,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1]],steps:[0,1,1,1,1,1,1,1,1,1],num:2,angle:0,offset:[0,0],morph:[0,0]};case"noise":return{...O,type:"noise",size:[100,100,100],noiseType:0,scale:1,move:1,colorA:{...TT.fromHex(6710886),a:1},colorB:{...TT.fromHex(6710886),a:1},colorC:{...TT.fromHex(16777215),a:1},colorD:{...TT.fromHex(16777215),a:1},distortion:[1,1],fA:[1.7,9.2],fB:[8.3,2.8],voronoiStyle:0,highCut:1,lowCut:0,smoothness:.3,seed:0,quality:1};case"fresnel":return{...O,type:"fresnel",color:PT.fromHexAndA(16777215,1),bias:.1,scale:1,intensity:2,factor:1};case"rainbow":return{...O,type:"rainbow",filmThickness:30,movement:0,wavelengths:[0,0,0],noiseStrength:0,noiseScale:1,offset:[0,0,0]};case"toon":return{...O,type:"toon",positioning:2,colors:[[0,0,0,1],[.5,.5,.5,1],[.5,.5,.5,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1]],steps:[0,.475,.525,1,1,1,1,1,1,1],num:4,source:[0,1e3,0],isWorldSpace:!0,noiseStrength:0,noiseScale:1,shadowColor:PT.fromHexAndA(0,0),offset:[0,0,0]};case"outline":return{...O,type:"outline",outlineColor:PT.fromHexAndA(0,1),contourColor:PT.fromHexAndA(0,1),outlineWidth:2,contourWidth:5,outlineThreshold:.4,contourThreshold:0,outlineSmoothing:0,contourFrequency:10,contourDirection:[0,1,0],positionalLines:!1,compensation:!0};case"matcap":return{...O,type:"matcap",texture:{image:"matcap_0",wrapping:1001,repeat:[1,1],offset:[0,0],rotation:0,minFilter:1008,magFilter:1006}};case"transmission":return{...O,type:"transmission",thickness:10,ior:1.5,roughness:1};case"displace":return{visible:!0,type:"displace",displacementType:"noise",noiseType:0,scale:10,movement:1,offset:[0,0,0],intensity:8,voronoiStyle:0,smoothness:.3,seed:0,highCut:1,lowCut:0,quality:1};case"pattern":return{...O,type:"pattern",style:0,projection:0,axis:"y",blending:0,offset:[0,0],colorA:{...TT.fromHex(0),a:1},colorB:{...TT.fromHex(16777215),a:1},frequency:[10,10],size:.5,variation:0,smoothness:.5,zigzag:0,rotation:0,vertical:[0,1],horizontal:[0,1],sides:6}}}})(LP||(LP={}));var FP;(E=>{function n(E){return!E.layers.some((E=>E.data.type==="texture"&&E.data.projection!==0||E.data.type==="depth"&&!E.data.isWorldSpace||E.data.type==="noise"||E.data.type==="displace"))}E.isMergable=n;function t(E){let O="";return E.layers.forEach((E=>{Object.entries(E.data).forEach((([E,R])=>{O+=`${E}${R}`,Array.isArray(R)?R.forEach((E=>O+=`${E}`)):typeof R=="object"?Object.values(R).forEach((E=>{O+=typeof E=="number"?`${E.toFixed(4)}`:`${E}`})):O+=`${R}`}))})),O}E.getHash=t;function e(){return{layers:new jM}}E.defaultEmptyData=e;function r(E="layer1",O="layer2"){return s("phong",E,O)}E.defaultData=r;function i(E,O){return{...E,name:O}}E.withName=i;function s(E,O="layer1",R="layer2"){let z=new jM;return z.push({fi:0,data:LP.defaultData("light",E),id:O}),z.push({fi:1,data:LP.defaultData("color"),id:R}),{layers:z}}E.defaultTwoLayerData=s;function o(E){let O=LP.defaultData("texture");E&&Object.assign(O.texture,{image:E});let R=new jM;return R.push({fi:0,data:O,id:"layer1"}),R.push({fi:1,data:{...LP.defaultData("transmission"),alpha:1},id:"layer2"}),R.push({fi:2,data:{...LP.defaultData("light","lambert"),alpha:0},id:"layer3"}),{layers:R}}E.defaultUIObjectMaterial=o;function a(E,O="phong",R="layer1",z="layer2"){let V=LP.defaultData("texture");Object.assign(V.texture,{image:E});let j=new jM;return j.push({fi:0,data:V,id:R}),j.push({fi:1,data:LP.defaultData("light",O),id:z}),{layers:j}}E.defaultTwoLayerTextureData=a;function l(E,O="phong",R="layer1",z="layer2"){let V=LP.defaultData("video");Object.assign(V.texture,{video:E});let j=new jM;return j.push({fi:0,data:V,id:R}),j.push({fi:1,data:LP.defaultData("light",O),id:z}),{layers:j}}E.defaultTwoLayerVideoTextureData=l})(FP||(FP={}));var NP;(E=>{function n(){return{points:new jM,roundness:0,shapeHoles:[],isClosed:!1}}E.defaultData=n})(NP||(NP={}));var UP;(E=>{function n(){return{points:new jM,lastInsertionPlane:null,subdivisions:12,isClosed:!1}}E.defaultData=n})(UP||(UP={}));var kP={type:"Ellipse",width:50,height:50,spikes:16,angle:360,innerRadius:0};var VP;(E=>{function n(E,O){let R={...E};return HP.forEach((z=>{Object.assign(R,{[z]:O[z]??E[z]})})),R}E.merge=n})(VP||(VP={}));var GP={shape:kP,depth:1,offset:0,bevel:50,bevelSides:6,angle:0,twist:0,startScale:1,endScale:1,capType:"flat"},HP=["depth","offset","angle","twist","startScale","endScale"];var WP;(E=>{function n(E){return E==="PolygonGeometry"||E==="RectangleGeometry"||E==="StarGeometry"||E==="TriangleGeometry"||E==="EllipseGeometry"||E==="UIGeometry"}E.is2DParametricMesh=n;function t(E){return E==="PolygonGeometry"||E==="PolygonGeometry"||E==="RectangleGeometry"||E==="StarGeometry"||E==="TriangleGeometry"||E==="EllipseGeometry"||E==="PathGeometry"||E==="VectorGeometry"||E==="ConeGeometry"||E==="CubeGeometry"||E==="CylinderGeometry"||E==="DodecahedronGeometry"||E==="HelixGeometry"||E==="IcosahedronGeometry"||E==="LatheGeometry"||E==="PyramidGeometry"||E==="SphereGeometry"||E==="PlaneGeometry"||E==="BackdropGeometry"||E==="TorusGeometry"||E==="TorusKnotGeometry"||E==="BooleanGeometry"||E==="TextGeometry"||E==="InputGeometry"}E.isParametricMesh=t})(WP||(WP={}));var qP;(E=>{function n(E,O){let R={...E};return Object.assign(R,O),R.type==="PathGeometry"&&"extrusion"in O&&O.extrusion&&(R.extrusion={...E.extrusion},Object.assign(R.extrusion,VP.merge(R.extrusion,O.extrusion))),R}E.merge=n})(qP||(qP={}));var XP;(E=>{function n(O){if(O==="RectangleGeometry")return{width:320,height:320,type:O,cornerRadius:[0,0,0,0],cornerType:0,depth:0,extrudeBevelSize:0,extrudeBevelSegments:1};if(O==="UIGeometry")return{type:O,frame:"",cornerRadius:[0,0,0,0],cornerType:0,width:1,height:1};if(O==="PathGeometry")return{type:O,width:1,height:1,depth:1,path:UP.defaultData(),extrusion:GP};if(O==="VectorGeometry")return{width:1,height:1,type:O,subdivisions:12,shape:NP.defaultData(),depth:0,extrudeBevelSize:0,extrudeBevelSegments:1};if(O==="BooleanGeometry")return{type:O,operation:2,width:0,height:0,depth:0,phongAngle:35};if(O==="ShapeBlendGeometry")return{type:O,width:0,height:0,depth:0,resolutionLevel:6,blendRange:100,useChildrenColors:!1};if(O==="TextGeometry")return{type:O,width:100,height:100,depth:0,horizontalAlign:1,verticalAlign:1,fontSize:16,lineHeight:1.2,letterSpacing:0,text:{textValue:""},textTransform:1,font:"Roboto_regular",editable:!1,extrudeBevelSize:0,extrudeBevelSegments:1};if(O==="InputGeometry")return{...E.defaultData("TextGeometry"),type:O,editable:!0};if(O==="SphereGeometry")return{type:"SphereGeometry",width:100,height:100,depth:100,widthSegments:64,heightSegments:64,phiStart:0,phiLength:2*Math.PI,thetaStart:0,thetaLength:180};throw new Error("not implemented")}E.defaultData=n})(XP||(XP={}));var YP=["width","height","depth"];var QP;(E=>E.defaultData={enabled:!1,useBackgroundColor:!1,color:TT.white,near:.1,far:2e3})(QP||(QP={}));var ZP;(E=>{let O={opacity:1,blendFunction:13,enabled:!1};E.defaultData={enabled:!1,pixelation:{...O,blendFunction:16,granularity:15},bloom:{...O,blendFunction:16,intensity:1,blurScale:1,luminanceThreshold:.25,luminanceSmoothing:.025,kernelSize:3},chromaticAberration:{...O,offset:[2,2]},vignette:{...O,darkness:1,offset:0},hueSaturation:{...O,hue:3,saturation:0},brightnessContrast:{...O,brightness:.25,contrast:0},depthOfField:{...O,focusDistance:100,focalLength:20,bokehScale:5},noise:{...O,blendFunction:16}}})(ZP||(ZP={}));var KP;(E=>E.defaultData={softShadowQuality:"low"})(KP||(KP={}));var JP;(E=>E.defaultData={enabled:!0,color:{r:.8274509803921568,g:.8274509803921568,b:.8274509803921568},intensity:.75})(JP||(JP={}));var $P;(E=>E.defaultData={occlusion:!1,aoFullRes:!1,radius:256,bias:.5,aoColor:{r:.19607843137254902,g:.19607843137254902,b:.19607843137254902}})($P||($P={}));var eD;(E=>E.defaultData={usePhysics:!1,gravity:-10})(eD||(eD={}));var tD;(E=>E.defaultData={playCamera:fT,gameControlObject:null})(tD||(tD={}));var iD;(E=>E.defaultData={backgroundColor:PT.fromHexAndA(vT,1),postprocessing:ZP.defaultData,fog:QP.defaultData,globalPhysics:eD.defaultData,ambient:JP.defaultData,ao:$P.defaultData,shadow:KP.defaultData,publish:tD.defaultData})(iD||(iD={}));var rD;(E=>E.defaultData={colliderType:"box",size:[100,100,100],colliderHelperVisible:!0,forceType:"collider",forceRange:"global",forceIntensity:.5,forceDambing:.95})(rD||(rD={}));var nD;(E=>{function n(E){return E==="Component"||E==="Instance"}E.isComponentRelated=n;function t(E){return E==="Empty"||E==="Instance"}E.isEmptyOrComponent=t})(nD||(nD={}));var sD;(E=>{E.identity={...NT.identity,hiddenMatrix:ET.identity};function t(E){return{position:E.position,rotation:E.rotation,scale:E.scale,hiddenMatrix:E.hiddenMatrix}}E.fromObject=t;function e(E,O){return{position:O?.position||E.position,rotation:O?.rotation||E.rotation,scale:O?.scale||E.scale,hiddenMatrix:O?.hiddenMatrix||E.hiddenMatrix}}E.merge=e;function r(E,O){return mv({position:wT.isEqual(E.position,O.position)?void 0:O.position,rotation:wT.isEqual(E.rotation,O.rotation)?void 0:O.rotation,scale:wT.isEqual(E.scale,O.scale)?null:O.scale,hiddenMatrix:ET.isEqual(E.hiddenMatrix,O.hiddenMatrix)?void 0:O.hiddenMatrix})}E.diff=r})(sD||(sD={}));var aD;(E=>E.defaultData={states:new jM,events:new jM,visible:!0,raycastLock:!1,physics:gP.defaultData,pathSnapping:{pathId:null,slide:0,offset:0,orientation:"tangential"},...sD.identity,cloner:null})(aD||(aD={}));var oD;(E=>E.defaultData={type:"Empty",...aD.defaultData})(oD||(oD={}));var lD;(E=>E.defaultData={type:"ParticleCollider",...rD.defaultData,...aD.defaultData})(lD||(lD={}));var hD;(E=>E.defaultData={type:"Component",...aD.defaultData})(hD||(hD={}));var cD;(E=>E.defaultData={type:"Particle",...aD.defaultData,...mP.defaultData})(cD||(cD={}));var dD;(E=>E.defaultData={type:"Mesh",...aD.defaultData,...AP.defaultData})(dD||(dD={}));var uD;(E=>E.defaultData={...aD.defaultData,...sD.identity,position:[0,0,iP.DefaultTargetOffset],...iP.defaultData})(uD||(uD={}));var pD;(E=>{function n(E){return{...aD.defaultData,...fP.defaultData(E)}}E.defaultData=n,E.defaultDirectionalLightData={...E.defaultData("DirectionalLight"),position:[200,300,300],name:"Directional Light",intensity:.7}})(pD||(pD={}));var fD;(E=>{function n(E,O,R=0){for(;R<O.length;){let z=E?E[O[R]]:void 0;if(O.length===R+1)return z;if(!z)return;E=z.descendants,R+=1}}E.resolveWithDes=n;function t(E,O,R=0){let z=n(E,O,R);if(z){let E=Object.keys(z);if(E.length===1&&E[0]==="descendants")return}return z}E.resolve=t})(fD||(fD={}));var mD;(E=>{E.rootOverrideProps=["physics","events"],E.compositeNonOptionalOverrideProps=["geometry"],E.compositeEntireOverrideOverrideProps=["material"];function r(E,O){return{...aD.defaultData,...O,component:E,overrides:new HM,physics:void 0,events:void 0,type:"Instance"}}E.ofComponent=r;function i(E){let O=sD.fromObject(E.data);return r(E.id,O)}E.fromComponentData=i})(mD||(mD={}));var gD;(E=>{E.defaultData={type:"Page",...aD.defaultData,physics:{...gP.defaultData,fusedBody:!1},...iD.defaultData,camera:uD.defaultData};function t(E){return E.uiScene!==void 0}E.isUIPage=t})(gD||(gD={}));var vD;(E=>(E.defaultCamera={position:[0,0,1e3],scale:[1,1,1],rotation:[0,0,0],hiddenMatrix:ET.identity,name:"Play Camera",visible:!0,raycastLock:!1,physics:gP.defaultData,states:new jM,events:new jM,cloner:null,pathSnapping:{pathId:null,orientation:"tangential",slide:0,offset:0},...iP.defaultData},E.KeysByResetCategory={States:["states"],Events:["events"],Material:["material","materials"],Geometry:["geometry"],Position:["position"],Rotation:["rotation"],Scale:["scale"],Transform:["position","scale","rotation","hiddenMatrix"],Name:["name"],Visibility:["visible","raycastLock","flatShading","wireframe","side"],Shadows:["castShadow","receiveShadow"],Cloner:["cloner"],Physics:["physics"]},E.defaultMeshObject={name:"Rectangle",...aD.defaultData,...dD.defaultData,geometry:XP.defaultData("RectangleGeometry"),material:FP.defaultTwoLayerData("phong","layer1","layer2")},E.defaultBooleanObject={name:"Boolean",...aD.defaultData,...dD.defaultData,geometry:XP.defaultData("BooleanGeometry"),material:FP.defaultTwoLayerData("phong","layer1","layer2")},E.defaultShapeBlendObject={name:"Shape Blend",...aD.defaultData,...dD.defaultData,geometry:XP.defaultData("ShapeBlendGeometry"),material:FP.defaultTwoLayerData("phong","layer1","layer2")},E.defaultTextObject={name:"Text",...aD.defaultData,...dD.defaultData,geometry:XP.defaultData("TextGeometry"),material:FP.defaultTwoLayerData("phong","layer1","layer2")},E.defaultInputObject={name:"Input",...aD.defaultData,...dD.defaultData,geometry:XP.defaultData("InputGeometry"),material:FP.defaultTwoLayerData("phong","layer1","layer2")}))(vD||(vD={}));var yD;(E=>{function n(E,O){let R={name:O};return E.type==="Mesh"?(R.geometry={},"material"in E&&(R.material={layers:new HM}),"materials"in E&&(R.materials=E.materials.map((E=>({layers:new HM}))))):$T.is(E.type)&&(R.perspective={},R.orthographic={}),R}E.newEmpty=n;function t(E,O){if(O===void 0)return E;let R={...E};return"material"in R&&"material"in O&&O.material&&(R.material=Tl(R.material,(E=>{if(typeof E!="string")for(let[R,z]of Object.entries(O.material.layers)){let O=E.layers.data(R);O&&LP.patch(O,z)}})).data),R.materials&&O.materials&&(R.materials=Tl(R.materials,(E=>{for(let z=0;z<R.materials.length;z++){let R=O.materials[z];if(typeof R!="string")for(let[O,V]of Object.entries(R.layers)){let R=E[z]?.layers?.data(O);R&&LP.patch(R,V)}}})).data),R}function e(E,O){let R,z=[],V={orthographic:0,perspective:0,geometry:0};function u(E,O){for(let[R,V]of Object.entries(O.layers)){let{texture:O,...j}=V;if(O!==void 0&&Object.keys(O).length>0){let V={path:[...E,"layers",R,"texture"],props:O,type:0};z.push(V)}if(Object.keys(j).length>0){let O={path:[...E,"layers",R],props:j,type:0};z.push(O)}}}for(let[E,j]of Object.entries(O))if(E!=="name")if(E==="cloner")z.push(...nP.toOps(j,["cloner"]));else if(E==="pathSnapping")z.push({path:[E],props:{slide:j.slide,offset:j.offset},type:0});else if(E==="material")u(["material"],j);else if(E==="materials")for(let[E,O]of Object.entries(j))u(["materials",E],O);else if(V[E]===0){if(E==="geometry"&&j.extrusion!==void 0){let O={path:[E,"extrusion"],props:j.extrusion,type:0};z.push(O),j={...j},delete j.extrusion}if(Object.keys(j).length>0){let O={path:[E],props:j,type:0};z.push(O)}}else R===void 0&&(R={path:[],props:{},type:0},z.push(R)),R.props[E]=j;return z}E.toOps=e;function r(E,O){if(O===void 0)return E;let R={...E};if(Object.assign(R,sD.merge(R,O)),Object.assign(R,{pathSnapping:Object.assign({},R.pathSnapping,{slide:O.pathSnapping?.slide??R.pathSnapping?.slide??0,offset:O.pathSnapping?.offset??R.pathSnapping?.offset??0})}),$T.is(E.type)){R.orthographic={...R.orthographic},R.perspective={...R.perspective};let E=O;E.orthographic?.zoom!==void 0&&(R.orthographic.zoom=E.orthographic.zoom),E.perspective?.zoom!==void 0&&(R.perspective.zoom=E.perspective.zoom),E.isUpVectorFlipped!==void 0&&(R.isUpVectorFlipped=E.isUpVectorFlipped),E.targetOffset!==void 0&&(R.targetOffset=E.targetOffset)}else if(E.type==="Mesh")"geometry"in O&&Object.assign(R,{geometry:qP.merge(R.geometry,O.geometry)}),(O.material||O.materials)&&(R=t(R,O)),R.cloner&&"cloner"in O&&Object.assign(R,{cloner:rP.merge(R.cloner,O.cloner)});else if(E.type==="Empty")R.cloner&&"cloner"in O&&Object.assign(R,{cloner:rP.merge(R.cloner,O.cloner)});else if(pP.is(E.type)){let E=O;E.intensity!==void 0&&(R.intensity=E.intensity),E.color!==void 0&&(typeof E.color=="string"?R.color=E.color:R.color=TT.clone(E.color))}return R}E.patch=r})(yD||(yD={}));var xD;(E=>E.defaultData={enablePan:!0,enableZoom:!0,enableRotate:!0,enableDamping:!0,rotationLimitsMode:0,rotationVerticalOffset:{min:Math.PI/4,max:Math.PI/4},rotationHorizontalOffset:{min:Math.PI/4,max:Math.PI/4},rotationSoftLimit:2,panLimitsMode:0,panVerticalOffset:{min:250,max:250},panHorizontalOffset:{min:250,max:250},panSoftLimit:2,zoomLimitsEnabled:!1,zoomLimits:{min:.1,max:2},autoRotate:!1,autoRotateSpeed:2,autoRotateClockwise:!0,hoverRotatePanMode:0,hoverRotatePanStrength:20,hoverRotateDamping:.125,isTouchZoom:!0,orbitTouches:2,panTouches:3,resetHoverEffectOnPointerLeave:!0})(xD||(xD={}));var bD;(E=>E.defaultData={orbitControls:xD.defaultData,playPage:gT,withBackground:!0,preventScroll:!1,preventTouchScroll:!1,hideCursor:!1,mouseEventTarget:"canvas",joystickSizeAndXYOffset:Array(12).fill(0).map(((E,O)=>{let R=0,z=0;return O<5?z=-30:O<10&&(z=30),O===0||O===10||O===5?R=30:(O===4||O===11||O===9)&&(R=-30),[120,[R,z],"show"]})),settings:{image:{format:"jpg",ratio:1},video:{format:"mp4",imageFormat:"jpg",fps:30,mbps:80,ratio:Math.max(1,typeof window<"u"?Math.floor(window.devicePixelRatio):1),stopMode:"manual",duration:5e3},web:{logo:!0,compress:!0,preset:1,preload:!0,hint:!1,imageQuality:70}},stopRaycast:!0,hdTransmission:!1})(bD||(bD={}));var SD;(E=>E.defaultData={id:"basic",label:"Basic",style:"None",prompt:""})(SD||(SD={}));var _D;(E=>E.defaultData={weather:0,shadows:0,lightOrigin:0,temperature:0,sun:0,camera:0,environment:0,particles:0,nature:0,floor:0})(_D||(_D={}));var AD;(E=>(E.defaultData=()=>({mode:"line-art-both",prompt:"",negativePrompt:"",style:{...SD.defaultData},isRandomSeed:!0,seed:E.generateSeed(),guessMode:!1,advanced:!1,steps:20,guidanceScale:7.5,controlNetScale:1,modifiers:_D.defaultData}),E.generateSeed=()=>Math.round(Math.random()*1e5)))(AD||(AD={}));var MD;(E=>{function n(E){return E.find((E=>E.data.type==="Page"&&E.data.globalPhysics.usePhysics))!==void 0}E.physicsEnabled=n;function t(E,O,R){E.scene.objects.traverseFrom(O,((O,z)=>{if(z.type==="Instance"){let V=iI.getComponentData(E,z.component)?.data;V&&R(O,z,V.events)}else R(O,z,z.events)}))}E.traverseModuleInstances=t})(MD||(MD={}));var ED;(E=>{E.TRASH_CAN_ID="830a2708-8ed9-49cf-a68e-085299892222",E.defaultLight={fi:-1,data:pD.defaultDirectionalLightData,id:"830a2708-8ed9-49cf-a68e-085299899103",children:[]};function e(O=!0,R=[]){let z=[],V=vD.defaultMeshObject;O&&(z.push({...E.defaultLight}),z.push({fi:1,id:"7ba78968-2a55-48f2-b14c-5191da3e075e",data:V,children:[]})),z.push(...R);let j=new kM;return j.push({fi:1,id:gT,data:{...gD.defaultData,name:"Scene 1"},children:z}),j}E.createDefaultObjectTreeWithPage=e,E.defaultData={objects:e(),publish:bD.defaultData,styles:AD.defaultData()},E.emptyDataWithoutPage=function(){return{objects:new kM,publish:bD.defaultData,styles:AD.defaultData()}},E.emptyDataWithPage=function(E=!0){return{objects:e(E),publish:bD.defaultData,styles:AD.defaultData()}},E.emptyData=function(){return{objects:new kM,publish:{...bD.defaultData},styles:AD.defaultData()}};function a(O){return{...E.defaultData,objects:Xi(O,kM.prototype)}}E.withObjs=a;function l(E,O){return a([{id:E,data:O,children:[],fi:0}])}E.withObj=l})(ED||(ED={}));var CD;(E=>E.defaultData={preset:"fullscreen",allowResponsive:!1,size:[512,512],coords:[0,0],sceneScale:1,color:{r:0,g:0,b:0,a:.5}})(CD||(CD={}));var TD;(E=>(E.defaultData=E=>({url:E,name:"New Webhook",parametersSchemas:new jM}),E.defaultParameterValueByType=E=>E==="number"?0:E!=="boolean"&&""))(TD||(TD={}));var PD;(E=>E.defaultData=(E,O="GET")=>({url:E,method:O,name:"New API",headers:new jM,queries:new jM,autoStart:!0}))(PD||(PD={}));var ID;(E=>{function n(E){return E.textValue!==void 0}E.isTextValue=n;function t(E){return typeof E=="number"}E.isNumber=t;function e(E){return typeof E=="boolean"}E.isBoolean=e;function r(E){return n(E)?"string":e(E)?"boolean":"number"}E.typeOfVariable=r;function i(O){return E.isTextValue(O)?Array.isArray(O.textValue)?O.textValue.map((E=>E.toString().padStart(O.padding??2,"0"))).join(O.deliminator??":")+(O.suffix!==void 0?" "+O.suffix:""):O.textValue.toString():E.isBoolean(O)?O?"True":"False":E.isNumber(O)?parseFloat(O.toFixed(3)).toString():O.toString()}E.getDisplayedValue=i})(ID||(ID={}));var WD;(E=>E.all=["images","videos","colors","audios","particles","fonts","materials","variables"])(WD||(WD={}));var qD;(E=>E.all=[...WD.all,"components"])(qD||(qD={}));var XD;(E=>{function n(){return{images:new NM,videos:new NM,colors:new NM,audios:new NM,particles:new NM,fonts:new NM,materials:new NM,components:new NM,variables:new NM,userAPIs:new NM,userWebhooks:new NM}}E.defaultData=n})(XD||(XD={}));var QD;(E=>{function n(){return{images:new NM,videos:new NM,colors:new NM,audios:new NM,particles:new NM,fonts:new NM,materials:new NM,components:new NM,variables:new NM,userAPIs:new NM,userWebhooks:new NM}}E.defaultData=n})(QD||(QD={}));var ZD;(E=>{function n(){let E={};return E["89b10010-844c-11ec-a8a3-0242ac120002"]={r:.5,g:.5,b:.5,a:1,name:"Default Color"},Xi(E,NM.prototype)}E.defaultColors=n;function t(){return Xi({},NM.prototype)}E.defaultImages=t;function e(){return{catelogs:new NM,materials:new NM,images:new NM,videos:new NM,colors:new NM,audios:new NM,particles:new NM,fonts:new NM,variables:new jM,userAPIs:new NM,userWebhooks:new NM,lib:QD.defaultData()}}E.emptyData=e;function r(E){switch(E){case"number":return{value:0,name:"Number"};case"boolean":return{value:!1,name:"Boolean"};case"string":return{value:{textValue:"String value"},name:"String"};case"time":let O=[0,0,0];return{name:"Time",value:{textValue:O,deliminator:":",padding:2,suffix:"AM"},dynamicVariableType:"time",format:"HH:mm:ss",format12h24h:"12ampm",timeZone:null,hasEnd:!1,endValue:{textValue:O,deliminator:":",padding:2,suffix:"AM"},autoStart:!0,repeat:!1};case"counter":return{name:"Counter",value:0,dynamicVariableType:"counter",updateInterval:1e3,increment:1,autoStart:!0,hasEnd:!0,endValue:60,repeat:!0,randomStart:!1,range:[0,100],decimals:0};case"random":return{name:"Random",value:0,dynamicVariableType:"random",updateInterval:1e3,increment:1,autoStart:!0,isStatic:!1,hasEnd:!0,endValue:60,repeat:!0,min:0,max:100,decimals:0};default:console.error("Unknown variable type",E)}}E.defaultVariables=r;function i(E,O){if(O.format==="HH:mm:ss"){let O=Math.floor(E/3600),R=Math.floor((E-O*3600)/60),z=Math.round(E-O*3600-R*60);return{textValue:[O,R,z]}}if(O.format==="mm:ss"){let O=Math.floor(E/60),R=Math.round(E-O*60);return{textValue:[O,R]}}return E=O.format==="number"?Math.round(E):Math.round(E*1e3)/1e3,E}E.getFormattedTimerTime=i})(ZD||(ZD={}));var KD;(E=>E.list=["idle","move","jump","run"])(KD||(KD={}));var $D;(E=>(E.defaultColliderData={type:"capsule",height:200,radius:50,position:[0,0,0],rotation:[0,0,0]},E.defaultDataThirdPerson={moveMode:"walk",forwardDirection:"+z",speedTranslate:1e3,speedRotate:100,runMultiplier:2,rotationMode:"normal",rotBy:"keys",rotByTouch:"drag",delayPos:[.3,.3],delayRot:[.3,.3],keyAssignments:[["moveNegZ","W"],["moveNegX","A"],["movePosZ","S"],["movePosX","D"],["rotPosX",""],["rotPosY",""],["rotNegX",""],["rotNegY",""],["jump","Space"],["run",""],["none","Ctrl"]],touchControl:!0,joystickPosLoc:5,joystickRotLoc:11,jumpTouchButtonLoc:9,collider:E.defaultColliderData,colliderHelperVisible:!0,collisionEnabled:!0,jumpPower:100,resetYPosition:3e3,alignToGround:!1,autoOrientMove:!0,orientWith:"camera",orientMode:"radial",delayPosCamera:.3,delayRotCamera:.3,camera:"",cameraXAxis:"Limit",cameraYAxis:"Free",cameraRotXLimits:[0,Math.PI/2],cameraRotYLimits:[-Math.PI/2,Math.PI/2],gameActions:{idle:new jM,move:new jM,jump:new jM,run:new jM},navmesh:{enabled:!1,ch:6,cs:6,walkableClimb:5,walkableHeight:1,walkableRadius:0,zones:"all",objects:[],helperVisible:!0,destinationHelperRadius:0,destinationHelperColor:PT.fromHexAndA(3728051,1)}}))($D||($D={}));function DD(E){E.layers.forEach((E=>{if(E.type==="depth"&&E.colorA!==void 0){let O=E.colorA,R=E.colorB,z=[[O.r,O.g,O.b,O.a],[R.r,R.g,R.b,R.a]],V=[0,1];for(let E=2;E<10;E++)z.push(z[1]),V.push(1);let j={...vM(Hr(E),"type","visible","isVector","isWorldSpace","origin","alpha","mode"),near:Math.max(0,E.near),far:Math.max(0,E.far),colors:z,steps:V,num:2,direction:[1,0,0],smooth:!1,gradientType:1};Object.assign(E,j)}else if(E.type==="depth"&&E.gradientType===1&&(E.near<0||E.far<0)){let O={...Hr(E),near:Math.max(E.near,0),far:Math.max(E.far,0)};Object.assign(E,O)}}))}function Ca(E,O){Object.values(E.shared.materials).forEach((E=>O(E)))}function Pa(E,O){E.scene.objects.traverse(((E,R)=>{"materials"in R?R.materials.forEach(((E,z)=>{E===void 0&&(R.materials[z]=FP.defaultData(),E=R.materials[z]),typeof E!="string"&&O(E)})):"material"in R?typeof R.material!="string"&&(R.material===void 0&&(R.material=FP.defaultData()),O(R.material)):R.type==="Mesh"&&(R.material===void 0&&(R.material=FP.defaultData()),O(R.material)),"overrides"in R&&Object.values(R.overrides).forEach((E=>{E.material&&typeof E.material!="string"&&Object.getPrototypeOf(E.material)!==HM.prototype&&O(E.material)}))}))}function yq(E){Object.assign(E.scene.publish,{orbitControls:{...xD.defaultData,...Hr(E.scene.publish.orbitControls)}})}function vq(E){Object.assign(E.scene.publish.settings,{video:{...bD.defaultData.settings.video,...Hr(E.scene.publish.settings.video)}})}function xq(E){function t(E){if(E.layers)for(let O of Object.values(E.layers))if(O)for(let[E,R]of Object.entries(O))if((BP.includes(E)||typeof R=="boolean")&&delete O[E],E==="texture")for(let[E,O]of Object.entries(R))(zP.includes(E)||typeof O=="boolean")&&delete R[E]}E.scene.objects.traverse(((E,O)=>{O.states.forEach((E=>{let O=E;O.material?t(O.material):O.materials&&O.materials.forEach((E=>{t(E)}))}))}))}function bq(E){E.scene.publish.withBackground=!0}function Sq(E){E.scene.publish.settings.web={compress:!0,preload:!0,preset:1,logo:!0,hint:!1}}function wq(E){E.scene.objects.traverse(((E,O)=>{let R=O.cloner;R&&(R.radial.scale=R.radial.scale.map((E=>E+1)),R.linear.scale=R.linear.scale.map((E=>E+1)))}))}function Aq(E){E.scene.objects.traverse(((E,O)=>{let R=O.geometry;R&&(R.type==="DodecahedronGeometry"||R.type==="IcosahedronGeometry")&&(R.detail=Math.round(R.detail))}))}function Eq(E){E.scene.objects.traverse(((O,R)=>{let z=E.scene.objects.unproxy().parent(O);if(z){let O=Hr(E.scene.objects.data(z));O&&O.type==="Mesh"&&O.geometry.type==="BooleanGeometry"&&R.type==="Mesh"&&(R.visible=Hr(R).booleanExclude!==!0)}}))}function Tq(E){E.scene.objects.traverse(((E,O)=>{if(O.type==="Mesh"){let E=O;O.geometry.type==="NonParametricGeometry"?E.material!==void 0&&delete E.material:E.materials!==void 0&&delete E.materials}}))}function Mq(E){function t(E){Object.setPrototypeOf(E,HM.prototype),E.texture&&Object.setPrototypeOf(E.texture,HM.prototype)}function e(E){Object.setPrototypeOf(E,HM.prototype);for(let O in E)t(E[O])}E.scene.objects.traverse(((E,O)=>{O.states.forEach((E=>{let O=E;if(O.material){let E=Hr(O.material).layers;e(E),O.material.layers=E}if(O.materials)for(let E=0;E<O.materials.length;E++){let R=O.materials[E],z=Hr(R).layers;e(z),R.layers=z}}))}))}function OD(E){E.layers===void 0&&Object.assign(E,FP.defaultTwoLayerData("lambert"))}function nA(E){!E.layers||E.layers.forEach((E=>{if(E.type==="depth"&&E.colors.length===10){let O=[...E.colors];O.push(E.colors[9]);let R=[...E.steps];R.push(E.steps[9]);let z={...Hr(E),colors:O,steps:R};Object.assign(E,z)}}))}function Cq(E){E.scene.objects.traverse(((E,O)=>{O.type==="Mesh"&&(O.geometry.type==="BooleanGeometry"||O.geometry.type==="SubdivGeometry")&&(O.geometry.phongAngle=35)}))}function RD(E){E.scene.objects.traverse(((E,O)=>{"materials"in O?O.materials.forEach((E=>{typeof E!="string"&&nA(E)})):"material"in O&&typeof O.material!="string"&&nA(O.material)})),Object.values(E.shared.materials).forEach((E=>nA(E)))}function Pq(E){E.scene.environment.ambientLight.softShadows=!1,E.scene.environment.ambientLight.softShadowQuality="low",E.scene.objects.traverse(((E,O)=>{(O.type==="DirectionalLight"||O.type==="SpotLight")&&(O.shadowResolution=1024,O.shadowRadius=1,O.depth=1e5)})),E.shared.penumbraSize=new Array(5).fill(.5)}function _q(E){E.shared.audios=Xi({},NM.prototype)}function Iq(E){E.shared.videos=Xi({},NM.prototype)}function Dq(E){let O=E.shared.materials;Object.entries(O).forEach((([E,R])=>{if(!R.layers){let R={name:"Untitled Material",layers:[{fi:0,data:{type:"light",category:"phong",alpha:.6,visible:!0,mode:0,specular:{r:.2,g:.2,b:.2},shininess:5},id:"layer1"},{fi:1,data:{type:"color",alpha:1,visible:!0,mode:0,color:{r:.2823529411764706,g:.2823529411764706,b:.30196078431372547}},id:"layer2"}]};Object.assign(O,{[E]:R})}}))}function Oq(E){Object.entries(Hr(E.shared.images)).filter((E=>E[1].asset===!1)).map((E=>E[0])).forEach((O=>{delete E.shared.images[O]})),Object.entries(Hr(E.shared.audios)).filter((E=>E[1].asset===!1)).map((E=>E[0])).forEach((O=>{delete E.shared.audios[O]}))}function Rq(E){E.scene.publish.settings.web.preload=!1}function LD(E){E.layers&&E.layers.forEach((E=>{E.type==="depth"&&E.num!==void 0&&(E.colors=E.colors.slice(0,E.num),E.steps=E.steps.slice(0,E.num),delete E.num)}))}function BD(E){E.layers&&E.layers.forEach((E=>{wD(E)&&E.isMask===void 0&&(E.isMask=!1),(E.type==="texture"||E.type==="video")&&E.blending===void 0&&(E.blending=0),(E.type==="noise"||E.type==="displace"&&E.displacementType==="noise")&&(E.voronoiStyle===void 0&&(E.voronoiStyle=0),E.highCut===void 0&&(E.highCut=1),E.lowCut===void 0&&(E.lowCut=0),E.smoothness===void 0&&(E.smoothness=.3),E.seed===void 0&&(E.seed=0),E.quality===void 0&&(E.quality=1))}))}function Lq(E){E.shared.fonts=Xi({},NM.prototype)}function Bq(E){return E.replace(".typeface","").replace(/optimer/gi,"open sans").replace("space_mono","space mono").replace(/alma_mono/gi,"varela round").replace(/droid_sans_mono/gi,"noto sans mono").replace(/droid_sans|gentilis|gnomon_(simple|foreground)|helvetiker/gi,"roboto").replace(/droid_serif/gi,"roboto slab").replace("_sans"," sans").replace("crimson_text","crimson text").replace("medium_medium","medium").replace("fatface_fatface","fatface").replace("100hairline","thin").replace("200thin","extralight").replace("300light","light").replace("500medium","medium").replace("600semi","semibold").replace("800heavy","extrabold").replace("900black","black").replace(/bodoni_(11|16|24|36|48|72|96)([^_])/gi,"bodoni_$1_$2").replace(/bodoni_(11|16|24|36|48|72|96)/gi,"bodoni moda").replace(/(thin|hairline)(_regular)?/gi,"100").replace(/(extra|ultra)light(_regular)?/gi,"200").replace(/light(_regular)?/gi,"300").replace(/_book|_normal|_roman/gi,"_regular").replace(/medium(_regular)?/gi,"500").replace(/(semi|demi)bold(_regular)?/gi,"600").replace(/(extra|ultra)bold(_regular)?/gi,"800").replace(/bold(_regular)?/gi,"700").replace(/(black|heavy|fatface)(_regular)?/gi,"900").replace(/([1-9]00)_italic/gi,"$1italic").replace(/regularitalic/gi,"italic").replace(/regularitalic/gi,"italic").split(" ").map((E=>E.charAt(0).toUpperCase()+E.slice(1))).join(" ")}function Nq(E){let O=[];E.scene.objects.traverse(((R,z)=>{let V=z;if(V.type==="TextFrame"){let z=FP.defaultTwoLayerData("phong"),j=typeof V.color=="string"?E.shared.colors[V.color]:V.color;z.layers[1].data.color={r:j.r,g:j.g,b:j.b},z.layers[1].data.alpha=V.alpha;let Y=Bq(V.font);E.shared.fonts[Y]===void 0&&(E.shared.fonts[Y]={name:Y});let ee={name:V.name,...aD.defaultData,...dD.defaultData,flatShading:!1,wireframe:!1,geometry:{...XP.defaultData("TextGeometry"),width:V.width,height:V.height,font:Y,depth:0,horizontalAlign:V.horizontalAlign,verticalAlign:V.verticalAlign,fontSize:V.fontSize*1.40625,lineHeight:V.lineHeight/1.40625,letterSpacing:V.letterSpacing-1,text:V.text,textTransform:V.textTransform,extrudeBevelSize:0,extrudeBevelSegments:1},material:z,states:Hr(V.states),events:Hr(V.events),visible:V.visible,raycastLock:V.raycastLock,position:V.position,rotation:V.rotation,scale:V.scale,hiddenMatrix:V.hiddenMatrix},se=Hr(E.scene.objects).parent(R);E.scene.objects.insertAfter(se??null,R,[{id:R+"new",data:ee,children:[]}]),O.push(R)}})),O.forEach((O=>{E.scene.objects.delete(O)}))}function Fq(E){let O={0:"MouseDown",1:"MouseUp",2:"MouseHover",5:"KeyDown",6:"KeyUp",7:"Start",9:"LookAt",10:"Follow",11:"Scroll",12:"Audio",13:"GameControl"};E.scene.objects.traverse(((E,R)=>{R.events.forEach((E=>{if(!!O[Number(E.type)])if(Object.assign(E,{type:O[Number(E.type)]}),E.type==="Audio"&&"audioEvent"in E&&(Object.assign(E,{playAudio:E.audioEvent}),delete E.audioEvent),E.type==="GameControl")Object.assign(E,{gameActions:{idle:new jM,move:new jM,jump:new jM}});else{let O=new jM;Object.assign(E,{actions:O}),(E.type==="MouseDown"||E.type==="MouseUp"||E.type==="KeyDown"||E.type==="KeyUp")&&"url"in E&&O.push({fi:0,id:xn.generateUUID(),data:{type:"Link",url:E.url,delay:0}}),"targets"in E&&(E.targets.forEach(((E,R,z)=>{let V={state:void 0,repeat:0,delay:0,delayDirection:void 0,direction:"normal",duration:0,easing:4},j={easing:E.easing,duration:E.duration};E.easing===6?Object.assign(j,vM(E,"mass","stiffness","damping","velocity")):E.easing===5&&Object.assign(j,{control1:{...E.control1},control2:{...E.control2}});let Y={repeat:E.repeat?-1:0,delay:E.delay,delayDirection:E.delayDirection,direction:E.cycle&&E.rewind?"pingpong-rewind":E.cycle?"pingpong":"normal"},ee={state:E.state,...Y,...j},se={allowSlerp:!0,type:"Transition",object:E.object,repeat:0,delay:0,delayDirection:void 0,direction:"normal",tweens:new jM({fi:0,id:xn.generateUUID(),data:V},{fi:1,id:xn.generateUUID(),data:ee})};O.push({fi:z,id:R,data:se})})),delete E.targets)}}))}))}function Vq(E){E.scene.objects.traverse(((E,O)=>{function r(E,R){let z=new jM,V=[];if(O.events.forEach(((E,O,j)=>{if(E.type==="Audio"&&E.trigger===R){let R;V.push(O),E.interaction==="play"?R={...vM(E,"interaction","audio","delay","volume","loop"),triggerAfter:"after"in E?E.after:void 0,toggle:"after"in E?E.toggle:void 0,type:"Audio"}:(E.interaction==="pause"||E.interaction==="stop")&&(R={...vM(E,"interaction","delay","object","playAudio"),type:"Audio"}),R&&z.push({fi:j,id:O,data:R})}})),V.forEach((E=>O.events.delete(E))),z.length){let R=O.events.find((O=>O.type===E))?.data;R?"actions"in R&&R.actions.insertBefore(null,z):O.events.insertBefore(null,[{id:xn.generateUUID(),data:{type:E,actions:z}}])}}r("Start","start"),r("MouseDown","mouseDown"),r("MouseUp","mouseUp"),r("KeyDown","keyDown"),r("KeyUp","keyUp")}))}function ND(E){let O=E.layers.find((E=>E.type==="light"))?.data;if(O?.category==="basic"){let E=LP.defaultData("light","phong"),R=O;Object.assign(R,E),R.visible=!1}}function FD(E){Ca(E,ND),Pa(E,ND)}function Uq(E){E.scene.objects.traverse(((E,O)=>{O.type==="Mesh"&&O.geometry.type==="SubdivGeometry"&&(O.geometry.scaleBaked||(O.geometry.scaleBaked=[1,1,1]))}))}function zq(E){E.scene.objects.traverse(((E,O)=>{(O.type==="Empty"||O.type==="Mesh")&&O.cloner&&!O.cloner.randomnessObject&&!O.cloner.toObject&&!O.cloner.randomness&&(O.cloner={...O.cloner,toObject:{object:"",spreadType:"random",scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],axis:"x",seed:0,count:99,align:"normal"},randomness:!1,randomnessObject:{strength:100,scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],movement:1,seed:0,freqScale:10,noiseType:"perlin"}})}))}function kq(E){E.scene.objects.traverse(((E,O)=>{O.type==="Mesh"&&O.geometry.type==="NonParametricGeometry"&&!("material"in O)&&!("materials"in O)&&(O.material=FP.defaultTwoLayerData("phong"))}))}function Gq(E){E.scene.publish.orbitControls.autoZoom===void 0&&(E.scene.publish.orbitControls.autoZoom=!1),E.scene.objects.traverse(((E,O)=>{(O.type==="OrthographicCamera"||O.type==="PerspectiveCamera")&&(O.orthographic.autoZoom===void 0&&(O.orthographic.autoZoom=!1),O.orthographic.autoZoomFrustumSize===void 0&&(O.orthographic.autoZoomFrustumSize=790))}))}function jq(E){E.scene.objects.traverse(((E,O)=>{O.pathSnapping===void 0&&(O.pathSnapping={pathId:null,slide:0,offset:0,orientation:"tangential"}),O.pathSnapping.offset===void 0&&(O.pathSnapping.offset=0)}))}function Hq(E){E.scene.publish.mouseEventTarget===void 0&&(E.scene.publish.mouseEventTarget="canvas"),E.scene.publish.settings.web.hint===void 0&&(E.scene.publish.settings.web.hint=!1)}function Wq(E){let{video:O}=E.scene.publish.settings;O.format==="gif"&&O.fps>48&&(O.fps=15)}function qq(E){E.scene.objects.traverse(((E,O)=>{O.events.forEach((E=>{E.type==="GameControl"&&(E.resetYPosition=Math.abs(E.resetYPosition-O.position[1]))}))}))}function Xq(E){let O=E.scene.environment.usePhysics;E.scene.objects.traverse(((E,R)=>{O&&R.physics===null?R.collision=!1:R.collision="visibility"}))}function Yq(E){E.scene.objects.traverse(((E,O)=>{O.events.forEach((E=>{E.type==="GameControl"&&(E.navmesh=$D.defaultDataThirdPerson.navmesh)}))}))}function Kq(E){E.scene.styles||(E.scene.styles=AD.defaultData())}function VD(E){E.layers.forEach((E=>{E.type==="light"&&E.category!=="toon"&&E.occlusion===void 0&&(E.occlusion=!0)}))}function Qq(E){E.scene.environment.ambientLight.occlusion===void 0&&(E.scene.environment.ambientLight.occlusion=!1),E.scene.environment.ambientLight.aoFullRes===void 0&&(E.scene.environment.ambientLight.aoFullRes=!1),E.scene.environment.ambientLight.radius===void 0&&(E.scene.environment.ambientLight.radius=256),E.scene.environment.ambientLight.bias===void 0&&(E.scene.environment.ambientLight.bias=.5),E.scene.environment.ambientLight.aoColor===void 0&&(E.scene.environment.ambientLight.aoColor={r:.19607843137254902,g:.19607843137254902,b:.19607843137254902}),Pa(E,VD),Ca(E,VD)}function Zq(E){E.scene.objects.traverse(((E,O)=>{O.events.forEach((E=>{E.type==="GameControl"&&Object.assign(E.gameActions,{run:new jM})}))}))}function Jq(E){E.scene.objects.traverse(((E,O)=>{O.events.forEach((E=>{E.type==="GameControl"&&(E.keyAssignments=[...E.keyAssignments,["run",""],["none","Ctrl"]])}))}))}function UD(E){E.layers&&E.layers.forEach((E=>{E.type==="light"&&E.bumpMapIntensity===void 0&&(E.bumpMapIntensity=5)}))}function zD(E,O){if(O<1&&(Pa(E,DD),Ca(E,DD),E.schema=1),O<2&&(yq(E),E.schema=2),O<3&&(xq(E),E.schema=3),O<4&&(bq(E),E.schema=4),O<5&&(Sq(E),E.schema=5),O<6&&(wq(E),E.schema=6),O<7&&(Aq(E),E.schema=7),O<8&&(E.schema=8),O<9&&(RD(E),E.schema=9),O<10&&(Cq(E),E.schema=10),O<11&&(Pq(E),E.schema=11),O<12&&(RD(E),E.schema=12),O<13&&(_q(E),E.schema=13),O<14&&(Dq(E),E.schema=14),O<15&&(Oq(E),E.schema=15),O<16&&(Rq(E),E.schema=16),O<17&&(Pa(E,LD),Ca(E,LD),E.schema=17),O<18&&(Pa(E,OD),Ca(E,OD),E.schema=18),O<19&&(vq(E),E.schema=19),O<20&&(Lq(E),Nq(E),E.schema=20),O<21&&(Fq(E),Vq(E),E.schema=21),O<22&&(FD(E),E.schema=22),O<23&&(Uq(E),E.schema=23),O<24&&(zq(E),E.schema=24),(O<25||E.shared.videos===void 0)&&(Iq(E),O<25&&(E.schema=25)),O<26&&(Eq(E),E.schema=26),O<27&&(Tq(E),E.schema=27),O<28&&(FD(E),E.schema=28),O<29&&(Mq(E),E.schema=29),O<30&&(kq(E),E.schema=30),O<31&&(Gq(E),E.schema=31),O<33&&(jq(E),E.schema=33),O<34&&(Hq(E),E.schema=34),O<35&&(Wq(E),E.schema=35),O<36&&(qq(E),E.schema=36),O<37&&(Xq(E),E.schema=37),O<38&&(Pa(E,BD),Ca(E,BD),E.schema=38),O<39&&(Yq(E),E.schema=39),O<40&&(Kq(E),E.schema=40),O<41&&(Qq(E),E.schema=41),O<42&&(Zq(E),E.schema=42),O<43&&(Jq(E),E.schema=43),O<99){Pa(E,UD),Ca(E,UD),E.scene.publish.playCamera===null&&(E.scene.publish.playCamera=fT);let O=Hr(E.scene.objects),R=E.scene.objects;E.scene.publish.playPage=gT,R.insertBefore(null,null,[{id:gT,data:{...gD.defaultData,backgroundColor:E.scene.backgroundColor,fog:E.scene.fog,postprocessing:E.scene.postprocessing,ao:vM(E.scene.environment.ambientLight,"occlusion","aoFullRes","radius","bias","aoColor"),publish:{playCamera:E.scene.publish.playCamera,gameControlObject:E.scene.publish.gameControlObject},shadow:vM(E.scene.environment.ambientLight,"softShadowQuality"),globalPhysics:{...eD.defaultData,...vM(E.scene.environment,"usePhysics","gravity")},camera:Hr(E.scene.ownerCamera)??gD.defaultData.camera,name:"Scene"},children:[]}]);for(let E of O)E.id!==ED.TRASH_CAN_ID&&R.move(gT,E.fi,E.id);let z=0,V=0;E.shared.penumbraSize&&E.scene.objects.traverse(((O,R)=>{R.type==="DirectionalLight"?(R.penumbraSize=E.shared.penumbraSize[Math.min(z,2)],z+=1):R.type==="SpotLight"&&(R.penumbraSize=E.shared.penumbraSize[3+Math.min(V,1)],V+=1),(R.physics===void 0||R.physics===null)&&R.type!=="Instance"&&(R.physics={},Object.assign(R.physics,gP.defaultData)),R.physics!==void 0&&R.physics!==null&&(R.physics.enabled=R.collision??"visibility",delete R.collision)})),E.schema=99}}function kD(E){E.layers&&E.layers.forEach((E=>{E.type==="light"&&E.alphaOverride===void 0&&(E.alphaOverride=1)}))}function $q(E){E.scene.objects.traverse(((E,O)=>{let R=O.geometry;R&&R.type==="PathGeometry"&&(R.extrusion.capType="flat",R.extrusion.bevel=50,R.extrusion.bevelSides=6,R.extrusion.shape.type==="Custom"&&(R.extrusion.shape.shapeQuality="low"))}))}function e7(E){Array.isArray(Hr(E.events))&&E.events?.forEach((E=>{"disabled"in E||(E.disabled=!1),(E.type==="MouseDown"||E.type==="MouseUp"||E.type==="MousePress")&&(E.mode=E.mode||"Object")}))}var eI=180/Math.PI;function GD(E){E.rotation=E.rotation.slice(0,3).map((E=>E*eI))}function jD(E){GD(E),E.type==="Page"&&GD(E.camera),E.states?.forEach((E=>{E.rotation===void 0||E.rotation===null||(E.rotation=E.rotation.slice(0,3).map((E=>E*eI)))}));let O=E.geometry;O&&O.type==="SphereGeometry"&&(O.thetaLength=(O.thetaLength??180)*eI),O&&O.type==="TorusGeometry"&&(O.arc=O.arc*eI),O&&O.type==="PathGeometry"&&(O.extrusion.angle*=eI,O.extrusion.twist*=eI),E.type==="Mesh"&&E.geometry.type==="TextGeometry"&&(E.geometry.text={textValue:E.geometry.text}),Array.isArray(Hr(E.events))&&E.events?.forEach((E=>{(E.type==="MouseDown"||E.type==="MouseUp"||E.type==="MousePress"||E.type==="KeyDown"||E.type==="KeyUp"||E.type==="KeyPress"||E.type==="Collision"||E.type==="Trigger")&&(E.runMode=E.toggle?"Toggle":"Repeat")}))}function t7(E){E.shared.variables=Xi({},NM.prototype)}function r7(E){let O=Hr(E.shared.variables);E.shared.variables=Xi(Object.entries(O??{}).map((([E,O],R)=>({fi:R,id:E,data:O}))),jM.prototype)}var tI=115;function HD(E,O){O(E.data);for(let R of E.children)HD(R,O)}function i7(E){let O=E.schema??104;O!==tI&&O<105&&(HD(E.asset,jD),E.schema=105)}function n7(E){E.shared.particles=Xi({},NM.prototype),E.shared.lib&&(E.shared.lib.particles=QD.defaultData().particles)}function s7(E){E.scene.objects.traverse(((E,O)=>{O.type==="Particle"&&typeof O.renderMaterial.size=="number"&&Object.assign(O.renderMaterial,{size:[O.renderMaterial.size,O.renderMaterial.size]})}))}function o7(E){E.scene.objects.traverse(((E,O)=>{O.type==="Page"&&(O.postprocessing.depthOfField.focusDistance=100,O.postprocessing.depthOfField.focalLength=20,O.postprocessing.depthOfField.bokehScale=5)}))}function a7(E){E.scene.objects.traverse(((E,O)=>{Array.isArray(Hr(O.events))!==!1&&O.events?.forEach((E=>{let O=E.runMode;E.type==="MouseDown"||E.type==="MouseUp"||E.type==="KeyDown"||E.type==="KeyUp"||E.type==="Collision"||E.type==="Trigger"?E.actions?.forEach((E=>{E.type==="Transition"&&(E.runMode=O??"Repeat"),(E.type==="Animation"||E.type==="SwitchCamera")&&(E.runMode=O==="Toggle"?"Toggle":"Normal")})):E.type==="MouseHover"||E.type==="MousePress"||E.type==="KeyPress"?E.actions?.forEach((E=>{(E.type==="Transition"||E.type==="Animation"||E.type==="SwitchCamera")&&(E.runMode="Toggle")})):E.type==="GameControl"?(delete E.actions,Object.keys(E.gameActions).forEach((O=>{E.gameActions[O]?.forEach((E=>{E.type==="Transition"&&(E.runMode="Repeat"),E.type==="Animation"&&(E.runMode="Normal")}))}))):E.type==="DragDrop"?(delete E.actions,E.dragDropActions?.drag?.forEach((E=>{(E.type==="Transition"||E.type==="Animation"||E.type==="SwitchCamera")&&(E.runMode="Toggle")})),E.dragDropActions?.drop?.forEach((E=>{(E.type==="Transition"||E.type==="Animation"||E.type==="SwitchCamera")&&(E.runMode="Toggle")}))):E.type==="Resize"?(delete E.actions,E.breakpoints?.forEach((E=>{E.actions?.forEach((E=>{(E.type==="Transition"||E.type==="Animation"||E.type==="SwitchCamera")&&(E.runMode="Toggle")}))}))):E.type==="Start"?E.actions?.forEach((E=>{E.type==="Transition"&&(E.runMode="Once"),(E.type==="Animation"||E.type==="SwitchCamera")&&(E.runMode="Normal")})):E.type==="VariableChange"||E.type==="Scroll"?E.actions?.forEach((E=>{E.type==="Transition"&&(E.runMode="Repeat"),(E.type==="Animation"||E.type==="SwitchCamera")&&(E.runMode="Normal")})):E.type==="Conditional"&&(delete E.actions,E.inActions?.forEach((E=>{E.type==="Transition"&&(E.runMode="Repeat"),(E.type==="Animation"||E.type==="SwitchCamera")&&(E.runMode="Normal")})),E.outActions?.forEach((E=>{E.type==="Transition"&&(E.runMode="Repeat"),(E.type==="Animation"||E.type==="SwitchCamera")&&(E.runMode="Normal")})))}))}))}function l7(E){E.shared.userAPIs=Xi({},NM.prototype),E.shared.userWebhooks=Xi({},NM.prototype),E.shared.lib&&(E.shared.lib.userAPIs=QD.defaultData().userAPIs,E.shared.lib.userWebhooks=QD.defaultData().userWebhooks)}function c0(E){let O=E.schema??0;if(O!==tI){console.warn("updating from ",O,"to ",tI),zD(E,O),O<100&&(E.scene.publish.joystickSizeAndXYOffset===void 0&&(E.scene.publish.joystickSizeAndXYOffset=bD.defaultData.joystickSizeAndXYOffset),E.schema=100),O<101&&(Pa(E,kD),Ca(E,kD),E.schema=101),O<102&&($q(E),E.schema=102),O<104&&(E.shared.catelogs=new NM,E.shared.lib=QD.defaultData(),E.schema=104),O<105&&(t7(E),E.scene.objects.traverse(((E,O)=>{jD(O)})),E.schema=105);for(let O of Object.values(E.shared.lib.components))i7(O);O<106&&(r7(E),E.schema=106),O<107&&(E.shared.lib.variables=QD.defaultData().variables,E.schema=107),O<109&&(n7(E),E.schema=109),O<110&&(s7(E),E.schema=110),O<111&&(E.scene.objects.traverse(((E,O)=>{e7(O)})),E.schema=111),O<112&&(o7(E),E.schema=112),O<113&&(a7(E),E.schema=113),O<114&&(E.scene.publish.settings.web.imageQuality===void 0&&(E.scene.publish.settings.web.imageQuality=70),E.schema=114),O<115&&(l7(E),E.schema=115)}}var iI;(E=>{E.defaultData={schema:tI,scene:ED.defaultData,frames:(new NM).add("72fc2993-2da3-4b6b-96ac-2879db3a28bd",CD.defaultData),shared:{...ZD.emptyData(),colors:ZD.defaultColors()}},E.emptyDataForImports=function(){let E=ED.emptyDataWithPage();return{schema:tI,scene:E,frames:(new NM).add("72fc2993-2da3-4b6b-96ac-2879db3a28bd",CD.defaultData),shared:{...ZD.emptyData(),colors:ZD.defaultColors(),images:ZD.defaultImages()}}},E.emptyData=function(){return{schema:tI,scene:ED.emptyDataWithPage(),frames:(new NM).add("72fc2993-2da3-4b6b-96ac-2879db3a28bd",CD.defaultData),shared:ZD.emptyData()}},E.clipboard2dData=function(){return{schema:tI,scene:ED.emptyData(),frames:new NM,shared:ZD.emptyData()}},E.collabHelper={...XM,updateSchema(E){return(E.schema??0)<tI?Tl(E,c0):(E.schema??0)-tI}};function s(O){let R=E.collabHelper.updateSchema(O);return typeof R=="number"?R===0?O:null:R.data}E.updateSchemaDirectly=s;function o(E){return{...E,shared:{...E.shared,lib:QD.defaultData()}}}E.withoutLib=o;function a(E,O){let R=E.scene.objects.get(O);if(R&&R.data.type==="Component")return R;{let R=E.shared.lib.components[O];if(R)return R.asset}}E.getComponentData=a;function l(E){let O=Object.values(E.shared.userAPIs);for(let E of O){let O=E.headers;for(let E of O)if(E.data.key.toLowerCase()==="authorization"&&E.data.value!=="")return!0}return!1}E.hasSensitiveData=l})(iI||(iI={}));var rI;(E=>E.emptyImage={data:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVQYV2NgYAAAAAMAAWgmWQ0AAAAASUVORK5CYII=",name:"empty"})(rI||(rI={}));var nI;(E=>{function n(E){return!0}E.is=n})(nI||(nI={}));var sI;(E=>{E.defaultData={position:[0,0],scale:[1,1],rotation:0,shear:[0,0]};function t(E,O){return{position:O?.position??E.position,rotation:O?.rotation??E.rotation,scale:O?.scale??E.scale,shear:O?.shear??E.shear}}E.merge=t;function e(E,O){return mv({position:xT.isEqual(E.position,O.position)?void 0:O.position,rotation:E.rotation===O.rotation?void 0:O.rotation,scale:xT.isEqual(E.scale,O.scale)?void 0:O.scale,shear:E.shear&&O.shear&&xT.isEqual(E.shear,O.shear)?void 0:O.shear})}E.diff=e})(sI||(sI={}));var aI;(E=>E.defaultData={horizontalConstraint:0,verticalConstraint:0})(aI||(aI={}));var oI;(E=>E.defaultData={direction:"row",wrap:"unwrap",align:"top-left",gap:10,rowGap:10,autoGap:!1,autoRowGap:!1,leftPadding:8,rightPadding:8,topPadding:8,bottomPadding:8})(oI||(oI={}));var lI;(E=>E.defaultData={opacity:1,fill:{color:PT.fromHexAndA(yT,1),enabled:!0},stroke:{color:PT.from0to1([0,0,0,1]),thickness:1,enabled:!1,mode:"inside"},layerBlur:{radius:2,enabled:!1},backgroundBlur:{radius:2,enabled:!1},dropShadow:{offset:[10,10],blurRadius:10,color:PT.from0to1([0,0,0,1]),enabled:!1,spread:0},innerShadow:{offset:[10,10],blurRadius:10,color:PT.from0to1([0,0,0,1]),enabled:!1,spread:0}})(lI||(lI={}));var hI;(E=>{function n(E,O){return{name:O}}E.newEmpty=n;function t(E,O){if(O===void 0)return E;let R={...E},z=["width","height","cornerRadius"];for(let E of z)E in R&&E in O&&O[E]!==void 0&&Object.assign(R,{[E]:O[E]});return R}function e(E,O){if(O===void 0)return E;let R={...E};return"fill"in R&&"fill"in O&&O.fill!==void 0&&Object.assign(R,{fill:{...R.fill,...O.fill}}),"stroke"in R&&"stroke"in O&&O.stroke!==void 0&&Object.assign(R,{stroke:{...R.stroke,...O.stroke}}),"layerBlur"in R&&"layerBlur"in O&&O.layerBlur!==void 0&&Object.assign(R,{layerBlur:{...R.layerBlur,...O.layerBlur}}),"backgroundBlur"in R&&"backgroundBlur"in O&&O.backgroundBlur!==void 0&&Object.assign(R,{backgroundBlur:{...R.backgroundBlur,...O.backgroundBlur}}),"dropShadow"in R&&"dropShadow"in O&&O.dropShadow!==void 0&&Object.assign(R,{dropShadow:{...R.dropShadow,...O.dropShadow}}),"innerShadow"in R&&"innerShadow"in O&&O.innerShadow!==void 0&&Object.assign(R,{innerShadow:{...R.innerShadow,...O.innerShadow}}),R}function r(E,O){if(O===void 0)return E;let R={...E};return Object.assign(R,sI.merge(R,O)),R=t(R,O),R=e(R,O),R}E.patch=r;function i(E,O){let R,z=[];for(let[E,V]of Object.entries(O))E!=="name"&&(R===void 0&&(R={path:[],props:{},type:0},z.push(R)),R.props[E]=V);return z}E.toOps=i})(hI||(hI={}));var cI;(E=>E.defaultData={...sI.defaultData,...aI.defaultData,states:new jM,events:new jM,visible:!0,raycastLock:!1})(cI||(cI={}));var uI;(E=>E.defaultData={...cI.defaultData,...lI.defaultData})(uI||(uI={}));var xI;(E=>E.defaultData={cornerRadius:[0,0,0,0]})(xI||(xI={}));var bI;(E=>E.defaultData={...uI.defaultData,type:"ellipse2d",width:100,height:100,name:"Ellipse"})(bI||(bI={}));var wI;(E=>E.defaultData={...uI.defaultData,...xI.defaultData,type:"rectangle2d",width:100,height:100,name:"Rectangle"})(wI||(wI={}));var AI;(E=>E.defaultData={...uI.defaultData,type:"text2d",width:100,height:100,fontSize:12,lineHeight:1.2,letterSpacing:0,text:{textValue:"Hello world"},horizontalAlign:1,verticalAlign:1,textTransform:1,font:"Roboto_regular",name:"Text"})(AI||(AI={}));var DI;(E=>E.defaultData={...uI.defaultData,type:"path2d",path:"",name:"Path"})(DI||(DI={}));var OI;(E=>{function n(E){return E.type==="ellipse2d"||E.type==="rectangle2d"||E.type==="text2d"||E.type==="vector2d"||E.type==="path2d"}E.is=n})(OI||(OI={}));var LI;(E=>E.defaultData={...cI.defaultData,name:"Group",type:"group2d"})(LI||(LI={}));var UI;(E=>E.defaultData=()=>({...cI.defaultData,...xI.defaultData,...lI.defaultData,name:"Frame",type:"frame2d",clipped:!0,width:200,height:200,fill:{color:PT.fromHexAndA(4737101,1),enabled:!0},stroke:{color:PT.fromHexAndA(0,1),thickness:1,enabled:!1,mode:"inside"},backgroundBlur:{radius:2,enabled:!1},layerBlur:{radius:2,enabled:!1}}))(UI||(UI={}));var kI;(E=>{function n(E){switch(E){case"rectangle2d":return{...wI.defaultData};case"ellipse2d":return{...bI.defaultData};case"text2d":return{...AI.defaultData};case"vector2d":return{...wI.defaultData};case"path2d":return{...DI.defaultData};case"frame2d":return{...UI.defaultData()};case"group2d":return{...LI.defaultData}}}E.defaultData=n;function t(E){return"width"in E&&"height"in E?[typeof E.width=="number"?E.width*.5:0,typeof E.height=="number"?E.height*.5:0]:[0,0]}E.getPivot=t;function e(E){return E.type==="rectangle2d"||E.type==="ellipse2d"||E.type==="text2d"||E.type==="frame2d"}E.isResizeable=e;function r(E){return E.type==="frame2d"&&E.autoLayout!==void 0}E.isAutoLayoutable=r;function i(E){return E.type==="rectangle2d"||E.type==="frame2d"}E.hasCorners=i})(kI||(kI={}));var WI;(E=>(E.defaultData={name:"UI",type:"scene2d",objects:new kM},E.emptyData=function(){return{type:"scene2d",objects:new kM}}))(WI||(WI={}));function js(E,O=!1){let R=E[0].index!==null,z=new Set(Object.keys(E[0].attributes)),V=new Set(Object.keys(E[0].morphAttributes)),j={},Y={},ee=E[0].morphTargetsRelative,se=new Na,he=0;for(let ce=0;ce<E.length;++ce){let ue=E[ce],fe=0;if(R!==(ue.index!==null))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+ce+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(let E in ue.attributes){if(!z.has(E))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+ce+'. All geometries must have compatible attributes; make sure "'+E+'" attribute exists among all geometries, or in none of them.'),null;j[E]===void 0&&(j[E]=[]),j[E].push(ue.attributes[E]),fe++}if(fe!==z.size)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+ce+". Make sure all geometries have the same number of attributes."),null;if(ee!==ue.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+ce+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(let E in ue.morphAttributes){if(!V.has(E))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+ce+".  .morphAttributes must be consistent throughout all geometries."),null;Y[E]===void 0&&(Y[E]=[]),Y[E].push(ue.morphAttributes[E])}if(O){let E;if(R)E=ue.index.count;else{if(ue.attributes.position===void 0)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+ce+". The geometry must have either an index or a position attribute"),null;E=ue.attributes.position.count}se.addGroup(he,E,ce),he+=E}}if(R){let O=0,R=[];for(let z=0;z<E.length;++z){let V=E[z].index;for(let E=0;E<V.count;++E)R.push(V.getX(E)+O);O+=E[z].attributes.position.count}se.setIndex(R)}for(let E in j){let O=YD(j[E]);if(!O)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+E+" attribute."),null;se.setAttribute(E,O)}for(let E in Y){let O=Y[E][0].length;if(O===0)break;se.morphAttributes=se.morphAttributes||{},se.morphAttributes[E]=[];for(let R=0;R<O;++R){let O=[];for(let z=0;z<Y[E].length;++z)O.push(Y[E][z][R]);let z=YD(O);if(!z)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+E+" morphAttribute."),null;se.morphAttributes[E].push(z)}}return se}function YD(E){let O,R,z,V=0;for(let j=0;j<E.length;++j){let Y=E[j];if(Y.isInterleavedBufferAttribute)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. InterleavedBufferAttributes are not supported."),null;if(O===void 0&&(O=Y.array.constructor),O!==Y.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(R===void 0&&(R=Y.itemSize),R!==Y.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(z===void 0&&(z=Y.normalized),z!==Y.normalized)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;V+=Y.array.length}let j=new O(V),Y=0;for(let O=0;O<E.length;++O)j.set(E[O].array,Y),Y+=E[O].array.length;return new Sa(j,R,z)}var YI=Math.pow(2,-24);var ZI=class{constructor(){}};function ms(E,O,R){return R.min.x=O[E],R.min.y=O[E+1],R.min.z=O[E+2],R.max.x=O[E+3],R.max.y=O[E+4],R.max.z=O[E+5],R}function uA(E){let O=-1,R=-1/0;for(let z=0;z<3;z++){let V=E[z+3]-E[z];V>R&&(R=V,O=z)}return O}function hA(E,O){O.set(E)}function dA(E,O,R){let z,V;for(let j=0;j<3;j++){let Y=j+3;z=E[j],V=O[j],R[j]=z<V?z:V,z=E[Y],V=O[Y],R[Y]=z>V?z:V}}function rm(E,O,R){for(let z=0;z<3;z++){let V=O[E+2*z],j=O[E+2*z+1],Y=V-j,ee=V+j;Y<R[z]&&(R[z]=Y),ee>R[z+3]&&(R[z+3]=ee)}}function ld(E){let O=E[3]-E[0],R=E[4]-E[1],z=E[5]-E[2];return 2*(O*R+R*z+z*O)}function h7(E,O){if(!E.index){let R,z=E.attributes.position.count,V=O.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;R=z>65535?new Uint32Array(new V(4*z)):new Uint16Array(new V(2*z)),E.setIndex(new Sa(R,1));for(let E=0;E<z;E++)R[E]=E}}function d7(E){if(!E.groups||!E.groups.length)return[{offset:0,count:E.index.count/3}];let O=[],R=new Set;for(let O of E.groups)R.add(O.start),R.add(O.start+O.count);let z=Array.from(R.values()).sort(((E,O)=>E-O));for(let E=0;E<z.length-1;E++){let R=z[E],V=z[E+1];O.push({offset:R/3,count:(V-R)/3})}return O}function pA(E,O,R,z,V=null){let j=1/0,Y=1/0,ee=1/0,se=-1/0,he=-1/0,ce=-1/0,ue=1/0,fe=1/0,ve=1/0,we=-1/0,Se=-1/0,_e=-1/0,Ae=V!==null;for(let z=O*6,V=(O+R)*6;z<V;z+=6){let O=E[z+0],R=E[z+1],V=O-R,Ce=O+R;V<j&&(j=V),Ce>se&&(se=Ce),Ae&&O<ue&&(ue=O),Ae&&O>we&&(we=O);let Te=E[z+2],Ie=E[z+3],Fe=Te-Ie,Ue=Te+Ie;Fe<Y&&(Y=Fe),Ue>he&&(he=Ue),Ae&&Te<fe&&(fe=Te),Ae&&Te>Se&&(Se=Te);let Ge=E[z+4],qe=E[z+5],Xe=Ge-qe,Qe=Ge+qe;Xe<ee&&(ee=Xe),Qe>ce&&(ce=Qe),Ae&&Ge<ve&&(ve=Ge),Ae&&Ge>_e&&(_e=Ge)}z[0]=j,z[1]=Y,z[2]=ee,z[3]=se,z[4]=he,z[5]=ce,Ae&&(V[0]=ue,V[1]=fe,V[2]=ve,V[3]=we,V[4]=Se,V[5]=_e)}function f7(E,O,R,z){let V=1/0,j=1/0,Y=1/0,ee=-1/0,se=-1/0,he=-1/0;for(let z=O*6,ce=(O+R)*6;z<ce;z+=6){let O=E[z+0];O<V&&(V=O),O>ee&&(ee=O);let R=E[z+2];R<j&&(j=R),R>se&&(se=R);let ce=E[z+4];ce<Y&&(Y=ce),ce>he&&(he=ce)}z[0]=V,z[1]=j,z[2]=Y,z[3]=ee,z[4]=se,z[5]=he}function p7(E,O,R,z,V){let j=R,Y=R+z-1,ee=V.pos,se=V.axis*2;for(;;){for(;j<=Y&&O[j*6+se]<ee;)j++;for(;j<=Y&&O[Y*6+se]>=ee;)Y--;if(!(j<Y))return j;for(let R=0;R<3;R++){let z=E[j*3+R];E[j*3+R]=E[Y*3+R],E[Y*3+R]=z;let V=O[j*6+R*2+0];O[j*6+R*2+0]=O[Y*6+R*2+0],O[Y*6+R*2+0]=V;let ee=O[j*6+R*2+1];O[j*6+R*2+1]=O[Y*6+R*2+1],O[Y*6+R*2+1]=ee}j++,Y--}}var JI=32,m7=(E,O)=>E.candidate-O.candidate,$I=new Array(JI).fill().map((()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0}))),eO=new Float32Array(6);function g7(E,O,R,z,V,j){let Y=-1,ee=0;if(j===0)Y=uA(O),Y!==-1&&(ee=(O[Y]+O[Y+3])/2);else if(j===1)Y=uA(E),Y!==-1&&(ee=y7(R,z,V,Y));else if(j===2){let j=ld(E),se=1.25*V,he=z*6,ce=(z+V)*6;for(let E=0;E<3;E++){let z=O[E],ue=(O[E+3]-z)/JI;if(V<JI/4){let O=[...$I];O.length=V;let z=0;for(let V=he;V<ce;V+=6,z++){let j=O[z];j.candidate=R[V+2*E],j.count=0;let{bounds:Y,leftCacheBounds:ee,rightCacheBounds:se}=j;for(let E=0;E<3;E++)se[E]=1/0,se[E+3]=-1/0,ee[E]=1/0,ee[E+3]=-1/0,Y[E]=1/0,Y[E+3]=-1/0;rm(V,R,Y)}O.sort(m7);let ue=V;for(let E=0;E<ue;E++){let R=O[E];for(;E+1<ue&&O[E+1].candidate===R.candidate;)O.splice(E+1,1),ue--}for(let z=he;z<ce;z+=6){let V=R[z+2*E];for(let E=0;E<ue;E++){let j=O[E];V>=j.candidate?rm(z,R,j.rightCacheBounds):(rm(z,R,j.leftCacheBounds),j.count++)}}for(let R=0;R<ue;R++){let z=O[R],he=z.count,ce=V-z.count,ue=z.leftCacheBounds,fe=z.rightCacheBounds,ve=0;he!==0&&(ve=ld(ue)/j);let we=0;ce!==0&&(we=ld(fe)/j);let Se=1+1.25*(ve*he+we*ce);Se<se&&(Y=E,se=Se,ee=z.candidate)}}else{for(let E=0;E<JI;E++){let O=$I[E];O.count=0,O.candidate=z+ue+E*ue;let R=O.bounds;for(let E=0;E<3;E++)R[E]=1/0,R[E+3]=-1/0}for(let O=he;O<ce;O+=6){let V=~~((R[O+2*E]-z)/ue);V>=JI&&(V=JI-1);let j=$I[V];j.count++,rm(O,R,j.bounds)}let O=$I[JI-1];hA(O.bounds,O.rightCacheBounds);for(let E=JI-2;E>=0;E--){let O=$I[E],R=$I[E+1];dA(O.bounds,R.rightCacheBounds,O.rightCacheBounds)}let fe=0;for(let O=0;O<JI-1;O++){let R=$I[O],z=R.count,he=R.bounds,ce=$I[O+1].rightCacheBounds;z!==0&&(fe===0?hA(he,eO):dA(he,eO,eO)),fe+=z;let ue=0,ve=0;fe!==0&&(ue=ld(eO)/j);let we=V-fe;we!==0&&(ve=ld(ce)/j);let Se=1+1.25*(ue*fe+ve*we);Se<se&&(Y=E,se=Se,ee=R.candidate)}}}}else console.warn(`MeshBVH: Invalid build strategy value ${j} used.`);return{axis:Y,pos:ee}}function y7(E,O,R,z){let V=0;for(let j=O,Y=O+R;j<Y;j++)V+=E[j*6+z*2];return V/R}function v7(E,O){let R=E.attributes.position,z=E.index.array,V=z.length/3,j=new Float32Array(V*6),Y=R.normalized,ee=R.array,se=R.offset||0,he=3;R.isInterleavedBufferAttribute&&(he=R.data.stride);let ce=["getX","getY","getZ"];for(let E=0;E<V;E++){let V,ue,fe,ve=E*3,we=E*6;Y?(V=z[ve+0],ue=z[ve+1],fe=z[ve+2]):(V=z[ve+0]*he+se,ue=z[ve+1]*he+se,fe=z[ve+2]*he+se);for(let E=0;E<3;E++){let z,se,he;Y?(z=R[ce[E]](V),se=R[ce[E]](ue),he=R[ce[E]](fe)):(z=ee[V+E],se=ee[ue+E],he=ee[fe+E]);let ve=z;se<ve&&(ve=se),he<ve&&(ve=he);let Se=z;se>Se&&(Se=se),he>Se&&(Se=he);let _e=(Se-ve)/2,Ae=E*2;j[we+Ae+0]=ve+_e,j[we+Ae+1]=_e+(Math.abs(ve)+_e)*YI,ve<O[E]&&(O[E]=ve),Se>O[E+3]&&(O[E+3]=Se)}}return j}function x7(E,O){function e(E){ce&&ce(E/ue)}function r(O,R,ce,ue=null,ve=0){if(!fe&&ve>=Y&&(fe=!0,ee&&(console.warn(`MeshBVH: Max depth of ${Y} reached when generating BVH. Consider increasing maxDepth.`),console.warn(E))),ce<=se||ve>=Y)return e(R+ce),O.offset=R,O.count=ce,O;let we=g7(O.boundingData,ue,V,R,ce,he);if(we.axis===-1)return e(R+ce),O.offset=R,O.count=ce,O;let Se=p7(j,V,R,ce,we);if(Se===R||Se===R+ce)e(R+ce),O.offset=R,O.count=ce;else{O.splitAxis=we.axis;let E=new ZI,j=R,Y=Se-R;O.left=E,E.boundingData=new Float32Array(6),pA(V,j,Y,E.boundingData,z),r(E,j,Y,z,ve+1);let ee=new ZI,se=Se,he=ce-Y;O.right=ee,ee.boundingData=new Float32Array(6),pA(V,se,he,ee.boundingData,z),r(ee,se,he,z,ve+1)}return O}h7(E,O);let R=new Float32Array(6),z=new Float32Array(6),V=v7(E,R),j=E.index.array,Y=O.maxDepth,ee=O.verbose,se=O.maxLeafTris,he=O.strategy,ce=O.onProgress,ue=E.index.count/3,fe=!1,ve=[],we=d7(E);if(we.length===1){let E=we[0],O=new ZI;O.boundingData=R,f7(V,E.offset,E.count,z),r(O,E.offset,E.count,z),ve.push(O)}else for(let E of we){let O=new ZI;O.boundingData=new Float32Array(6),pA(V,E.offset,E.count,O.boundingData,z),r(O,E.offset,E.count,z),ve.push(O)}return ve}function JD(E,O){let R,z,V,j=x7(E,O),Y=[],ee=O.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;for(let E=0;E<j.length;E++){let O=j[E],se=l(O),he=new ee(32*se);R=new Float32Array(he),z=new Uint32Array(he),V=new Uint16Array(he),c(0,O),Y.push(he)}return Y;function l(E){return E.count?1:1+l(E.left)+l(E.right)}function c(E,O){let j=E/4,Y=E/2,ee=!!O.count,se=O.boundingData;for(let E=0;E<6;E++)R[j+E]=se[E];if(ee){let R=O.offset,ee=O.count;return z[j+6]=R,V[Y+14]=ee,V[Y+15]=65535,E+32}{let R,V=O.left,Y=O.right,ee=O.splitAxis;if(R=c(E+32,V),R/4>Math.pow(2,32))throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return z[j+6]=R/4,R=c(R,Y),z[j+7]=ee,R}}}var tO=class{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(E,O){let R=1/0,z=-1/0;for(let V=0,j=E.length;V<j;V++){let j=E[V][O];R=j<R?j:R,z=j>z?j:z}this.min=R,this.max=z}setFromPoints(E,O){let R=1/0,z=-1/0;for(let V=0,j=O.length;V<j;V++){let j=O[V],Y=E.dot(j);R=Y<R?Y:R,z=Y>z?Y:z}this.min=R,this.max=z}isSeparated(E){return this.min>E.max||E.min>this.max}};tO.prototype.setFromBox=function(){let E=new Wn;return function(O,R){let z=R.min,V=R.max,j=1/0,Y=-1/0;for(let R=0;R<=1;R++)for(let ee=0;ee<=1;ee++)for(let se=0;se<=1;se++){E.x=z.x*R+V.x*(1-R),E.y=z.y*ee+V.y*(1-ee),E.z=z.z*se+V.z*(1-se);let he=O.dot(E);j=Math.min(he,j),Y=Math.max(he,Y)}this.min=j,this.max=Y}}();(function(){let E=new tO})();var rO=function(){let E=new Wn,O=new Wn,R=new Wn;return function(z,V,j){let Y=z.start,ee=E,se=V.start,he=O;R.subVectors(Y,se),E.subVectors(z.end,z.start),O.subVectors(V.end,V.start);let ce,ue,fe=R.dot(he),ve=he.dot(ee),we=he.dot(he),Se=R.dot(ee),_e=ee.dot(ee)*we-ve*ve;ce=_e!==0?(fe*ve-Se*we)/_e:0,ue=(fe+ce*ve)/we,j.x=ce,j.y=ue}}(),aO=function(){let E=new bn,O=new Wn,R=new Wn;return function(z,V,j,Y){rO(z,V,E);let ee=E.x,se=E.y;if(ee>=0&&ee<=1&&se>=0&&se<=1)z.at(ee,j),V.at(se,Y);else if(ee>=0&&ee<=1)se<0?V.at(0,Y):V.at(1,Y),z.closestPointToPoint(Y,!0,j);else{if(!(se>=0&&se<=1)){let E;E=ee<0?z.start:z.end;let he;he=se<0?V.start:V.end;let ce=O,ue=R;if(z.closestPointToPoint(he,!0,O),V.closestPointToPoint(E,!0,R),ce.distanceToSquared(he)<=ue.distanceToSquared(E)){j.copy(ce),Y.copy(he);return}j.copy(E),Y.copy(ue);return}ee<0?z.at(0,j):z.at(1,j),V.closestPointToPoint(j,!0,Y)}}}(),oO=function(){let E=new Wn,O=new Wn,R=new _o,z=new Df;return function(V,j){let{radius:Y,center:ee}=V,{a:se,b:he,c:ce}=j;if(z.start=se,z.end=he,z.closestPointToPoint(ee,!0,E).distanceTo(ee)<=Y||(z.start=se,z.end=ce,z.closestPointToPoint(ee,!0,E).distanceTo(ee)<=Y)||(z.start=he,z.end=ce,z.closestPointToPoint(ee,!0,E).distanceTo(ee)<=Y))return!0;let ue=j.getPlane(R);if(Math.abs(ue.distanceToPoint(ee))<=Y){let E=ue.projectPoint(ee,O);if(j.containsPoint(E))return!0}return!1}}();var lO=1e-15;function cd(E){return Math.abs(E)<lO}var hO=class extends ga{constructor(...E){super(...E),this.isExtendedTriangle=!0,this.satAxes=new Array(4).fill().map((()=>new Wn)),this.satBounds=new Array(4).fill().map((()=>new tO)),this.points=[this.a,this.b,this.c],this.sphere=new ps,this.plane=new _o,this.needsUpdate=!0}intersectsSphere(E){return oO(E,this)}update(){let E=this.a,O=this.b,R=this.c,z=this.points,V=this.satAxes,j=this.satBounds,Y=V[0],ee=j[0];this.getNormal(Y),ee.setFromPoints(Y,z);let se=V[1],he=j[1];se.subVectors(E,O),he.setFromPoints(se,z);let ce=V[2],ue=j[2];ce.subVectors(O,R),ue.setFromPoints(ce,z);let fe=V[3],ve=j[3];fe.subVectors(R,E),ve.setFromPoints(fe,z),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(Y,E),this.needsUpdate=!1}};hO.prototype.closestPointToSegment=function(){let E=new Wn,O=new Wn,R=new Df;return function(z,V=null,j=null){let Y,{start:ee,end:se}=z,he=this.points,ce=1/0;for(let ee=0;ee<3;ee++){let se=(ee+1)%3;R.start.copy(he[ee]),R.end.copy(he[se]),aO(R,z,E,O),Y=E.distanceToSquared(O),Y<ce&&(ce=Y,V&&V.copy(E),j&&j.copy(O))}return this.closestPointToPoint(ee,E),Y=ee.distanceToSquared(E),Y<ce&&(ce=Y,V&&V.copy(E),j&&j.copy(ee)),this.closestPointToPoint(se,E),Y=se.distanceToSquared(E),Y<ce&&(ce=Y,V&&V.copy(E),j&&j.copy(se)),Math.sqrt(ce)}}();hO.prototype.intersectsTriangle=function(){let E=new hO,O=new Array(3),R=new Array(3),z=new tO,V=new tO,j=new Wn,Y=new Wn,ee=new Wn,se=new Wn,he=new Df,ce=new Df,ue=new Df;return function(fe,ve=null,we=!1){this.needsUpdate&&this.update(),fe.isExtendedTriangle?fe.needsUpdate&&fe.update():(E.copy(fe),E.update(),fe=E);let Se=this.plane,_e=fe.plane;if(Math.abs(Se.normal.dot(_e.normal))>1-1e-10){let E=this.satBounds,Y=this.satAxes;R[0]=fe.a,R[1]=fe.b,R[2]=fe.c;for(let O=0;O<4;O++){let V=E[O],j=Y[O];if(z.setFromPoints(j,R),V.isSeparated(z))return!1}let ee=fe.satBounds,se=fe.satAxes;O[0]=this.a,O[1]=this.b,O[2]=this.c;for(let E=0;E<4;E++){let R=ee[E],V=se[E];if(z.setFromPoints(V,O),R.isSeparated(z))return!1}for(let E=0;E<4;E++){let ee=Y[E];for(let E=0;E<4;E++){let Y=se[E];if(j.crossVectors(ee,Y),z.setFromPoints(j,O),V.setFromPoints(j,R),z.isSeparated(V))return!1}}return ve&&(we||console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),ve.start.set(0,0,0),ve.end.set(0,0,0)),!0}{let E=this.points,O=!1,R=0;for(let z=0;z<3;z++){let V=E[z],j=E[(z+1)%3];he.start.copy(V),he.end.copy(j),he.delta(Y);let ee=O?ce.start:ce.end,se=cd(_e.distanceToPoint(V));if(cd(_e.normal.dot(Y))&&se){ce.copy(he),R=2;break}if((_e.intersectLine(he,ee)||se)&&!cd(ee.distanceTo(j))){if(R++,O)break;O=!0}}if(R===1&&fe.containsPoint(ce.end))return ve&&(ve.start.copy(ce.end),ve.end.copy(ce.end)),!0;if(R!==2)return!1;let z=fe.points,V=!1,j=0;for(let E=0;E<3;E++){let O=z[E],R=z[(E+1)%3];he.start.copy(O),he.end.copy(R),he.delta(ee);let Y=V?ue.start:ue.end,se=cd(Se.distanceToPoint(O));if(cd(Se.normal.dot(ee))&&se){ue.copy(he),j=2;break}if((Se.intersectLine(he,Y)||se)&&!cd(Y.distanceTo(R))){if(j++,V)break;V=!0}}if(j===1&&this.containsPoint(ue.end))return ve&&(ve.start.copy(ue.end),ve.end.copy(ue.end)),!0;if(j!==2)return!1;if(ce.delta(Y),ue.delta(ee),Y.dot(ee)<0){let E=ue.start;ue.start=ue.end,ue.end=E}let we=ce.start.dot(Y),Ae=ce.end.dot(Y),Ce=ue.start.dot(Y),Te=ue.end.dot(Y),Ie=Ae<Ce,Fe=we<Te;return(we===Te||Ce===Ae||Ie!==Fe)&&(ve&&(se.subVectors(ce.start,ue.start),se.dot(Y)>0?ve.start.copy(ce.start):ve.start.copy(ue.start),se.subVectors(ce.end,ue.end),se.dot(Y)<0?ve.end.copy(ce.end):ve.end.copy(ue.end)),!0)}}}();hO.prototype.distanceToPoint=function(){let E=new Wn;return function(O){return this.closestPointToPoint(O,E),O.distanceTo(E)}}();hO.prototype.distanceToTriangle=function(){let E=new Wn,O=new Wn,R=["a","b","c"],z=new Df,V=new Df;return function(j,Y=null,ee=null){let se=Y||ee?z:null;if(this.intersectsTriangle(j,se))return(Y||ee)&&(Y&&se.getCenter(Y),ee&&se.getCenter(ee)),0;let he=1/0;for(let O=0;O<3;O++){let z,V=R[O],se=j[V];this.closestPointToPoint(se,E),z=se.distanceToSquared(E),z<he&&(he=z,Y&&Y.copy(E),ee&&ee.copy(se));let ce=this[V];j.closestPointToPoint(ce,E),z=ce.distanceToSquared(E),z<he&&(he=z,Y&&Y.copy(ce),ee&&ee.copy(E))}for(let se=0;se<3;se++){let ce=R[se],ue=R[(se+1)%3];z.set(this[ce],this[ue]);for(let se=0;se<3;se++){let ce=R[se],ue=R[(se+1)%3];V.set(j[ce],j[ue]),aO(z,V,E,O);let fe=E.distanceToSquared(O);fe<he&&(he=fe,Y&&Y.copy(E),ee&&ee.copy(O))}}return Math.sqrt(he)}}();var cO=class{constructor(E,O,R){this.isOrientedBox=!0,this.min=new Wn,this.max=new Wn,this.matrix=new Es,this.invMatrix=new Es,this.points=new Array(8).fill().map((()=>new Wn)),this.satAxes=new Array(3).fill().map((()=>new Wn)),this.satBounds=new Array(3).fill().map((()=>new tO)),this.alignedSatBounds=new Array(3).fill().map((()=>new tO)),this.needsUpdate=!1,E&&this.min.copy(E),O&&this.max.copy(O),R&&this.matrix.copy(R)}set(E,O,R){this.min.copy(E),this.max.copy(O),this.matrix.copy(R),this.needsUpdate=!0}copy(E){this.min.copy(E.min),this.max.copy(E.max),this.matrix.copy(E.matrix),this.needsUpdate=!0}};cO.prototype.update=function(){return function(){let E=this.matrix,O=this.min,R=this.max,z=this.points;for(let V=0;V<=1;V++)for(let j=0;j<=1;j++)for(let Y=0;Y<=1;Y++){let ee=1*V|2*j|4*Y,se=z[ee];se.x=V?R.x:O.x,se.y=j?R.y:O.y,se.z=Y?R.z:O.z,se.applyMatrix4(E)}let V=this.satBounds,j=this.satAxes,Y=z[0];for(let E=0;E<3;E++){let O=j[E],R=V[E],ee=1<<E,se=z[ee];O.subVectors(Y,se),R.setFromPoints(O,z)}let ee=this.alignedSatBounds;ee[0].setFromPointsField(z,"x"),ee[1].setFromPointsField(z,"y"),ee[2].setFromPointsField(z,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1}}();cO.prototype.intersectsBox=function(){let E=new tO;return function(O){this.needsUpdate&&this.update();let R=O.min,z=O.max,V=this.satBounds,j=this.satAxes,Y=this.alignedSatBounds;if(E.min=R.x,E.max=z.x,Y[0].isSeparated(E)||(E.min=R.y,E.max=z.y,Y[1].isSeparated(E))||(E.min=R.z,E.max=z.z,Y[2].isSeparated(E)))return!1;for(let R=0;R<3;R++){let z=j[R],Y=V[R];if(E.setFromBox(z,O),Y.isSeparated(E))return!1}return!0}}();cO.prototype.intersectsTriangle=function(){let E=new hO,O=new Array(3),R=new tO,z=new tO,V=new Wn;return function(j){this.needsUpdate&&this.update(),j.isExtendedTriangle?j.needsUpdate&&j.update():(E.copy(j),E.update(),j=E);let Y=this.satBounds,ee=this.satAxes;O[0]=j.a,O[1]=j.b,O[2]=j.c;for(let E=0;E<3;E++){let z=Y[E],V=ee[E];if(R.setFromPoints(V,O),z.isSeparated(R))return!1}let se=j.satBounds,he=j.satAxes,ce=this.points;for(let E=0;E<3;E++){let O=se[E],z=he[E];if(R.setFromPoints(z,ce),O.isSeparated(R))return!1}for(let E=0;E<3;E++){let j=ee[E];for(let E=0;E<4;E++){let Y=he[E];if(V.crossVectors(j,Y),R.setFromPoints(V,O),z.setFromPoints(V,ce),R.isSeparated(z))return!1}}return!0}}();cO.prototype.closestPointToPoint=function(){return function(E,O){return this.needsUpdate&&this.update(),O.copy(E).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),O}}();cO.prototype.distanceToPoint=function(){let E=new Wn;return function(O){return this.closestPointToPoint(O,E),O.distanceTo(E)}}();cO.prototype.distanceToBox=function(){let E=["x","y","z"],O=new Array(12).fill().map((()=>new Df)),R=new Array(12).fill().map((()=>new Df)),z=new Wn,V=new Wn;return function(j,Y=0,ee=null,se=null){if(this.needsUpdate&&this.update(),this.intersectsBox(j))return(ee||se)&&(j.getCenter(V),this.closestPointToPoint(V,z),j.closestPointToPoint(z,V),ee&&ee.copy(z),se&&se.copy(V)),0;let he=Y*Y,ce=j.min,ue=j.max,fe=this.points,ve=1/0;for(let E=0;E<8;E++){let O=fe[E];V.copy(O).clamp(ce,ue);let R=O.distanceToSquared(V);if(R<ve&&(ve=R,ee&&ee.copy(O),se&&se.copy(V),R<he))return Math.sqrt(R)}let we=0;for(let z=0;z<3;z++)for(let V=0;V<=1;V++)for(let j=0;j<=1;j++){let Y=(z+1)%3,ee=(z+2)%3,se=V<<Y|j<<ee,he=1<<z|V<<Y|j<<ee,ve=fe[se],Se=fe[he];O[we].set(ve,Se);let _e=E[z],Ae=E[Y],Ce=E[ee],Te=R[we],Ie=Te.start,Fe=Te.end;Ie[_e]=ce[_e],Ie[Ae]=V?ce[Ae]:ue[Ae],Ie[Ce]=j?ce[Ce]:ue[Ae],Fe[_e]=ue[_e],Fe[Ae]=V?ce[Ae]:ue[Ae],Fe[Ce]=j?ce[Ce]:ue[Ae],we++}for(let E=0;E<=1;E++)for(let O=0;O<=1;O++)for(let R=0;R<=1;R++){V.x=E?ue.x:ce.x,V.y=O?ue.y:ce.y,V.z=R?ue.z:ce.z,this.closestPointToPoint(V,z);let j=V.distanceToSquared(z);if(j<ve&&(ve=j,ee&&ee.copy(z),se&&se.copy(V),j<he))return Math.sqrt(j)}for(let E=0;E<12;E++){let j=O[E];for(let E=0;E<12;E++){let O=R[E];aO(j,O,z,V);let Y=z.distanceToSquared(V);if(Y<ve&&(ve=Y,ee&&ee.copy(z),se&&se.copy(V),Y<he))return Math.sqrt(Y)}}return Math.sqrt(ve)}}();var uO=new Wn,mO=new Wn,gO=new Wn,vO=new bn,bO=new bn,wO=new bn,SO=new Wn,MO=new Wn,TO=new Wn,zO=new Wn;function w7(E,O,R,z,V,j){let Y;return Y=j===Ue?E.intersectTriangle(z,R,O,!0,V):E.intersectTriangle(O,R,z,j!==Ge,V),Y===null?null:{distance:E.origin.distanceTo(V),point:V.clone()}}function A7(E,O,R,z,V,j,Y,ee,se){uO.fromBufferAttribute(O,j),mO.fromBufferAttribute(O,Y),gO.fromBufferAttribute(O,ee);let he=w7(E,uO,mO,gO,zO,se);if(he){z&&(vO.fromBufferAttribute(z,j),bO.fromBufferAttribute(z,Y),wO.fromBufferAttribute(z,ee),he.uv=ga.getInterpolation(zO,uO,mO,gO,vO,bO,wO,new bn)),V&&(vO.fromBufferAttribute(V,j),bO.fromBufferAttribute(V,Y),wO.fromBufferAttribute(V,ee),he.uv1=ga.getInterpolation(zO,uO,mO,gO,vO,bO,wO,new bn)),R&&(SO.fromBufferAttribute(R,j),MO.fromBufferAttribute(R,Y),TO.fromBufferAttribute(R,ee),he.normal=ga.getInterpolation(zO,uO,mO,gO,SO,MO,TO,new Wn),he.normal.dot(E.direction)>0&&he.normal.multiplyScalar(-1));let O={a:j,b:Y,c:ee,normal:new Wn,materialIndex:0};ga.getNormal(uO,mO,gO,O.normal),he.face=O,he.faceIndex=j}return he}function gA(E,O,R,z,V){let j=z*3,Y=E.index.getX(j),ee=E.index.getX(j+1),se=E.index.getX(j+2),{position:he,normal:ce,uv:ue,uv1:fe}=E.attributes,ve=A7(R,he,ce,ue,fe,Y,ee,se,O);return ve?(ve.faceIndex=z,V&&V.push(ve),ve):null}function iO(E,O,R,z,V,j){for(let Y=z,ee=z+V;Y<ee;Y++)gA(E,O,R,Y,j)}function nO(E,O,R,z,V){let j=1/0,Y=null;for(let ee=z,se=z+V;ee<se;ee++){let z=gA(E,O,R,ee);z&&z.distance<j&&(Y=z,j=z.distance)}return Y}function gs(E,O,R,z){let V=E.a,j=E.b,Y=E.c,ee=O,se=O+1,he=O+2;R&&(ee=R.getX(O),se=R.getX(O+1),he=R.getX(O+2)),V.x=z.getX(ee),V.y=z.getY(ee),V.z=z.getZ(ee),j.x=z.getX(se),j.y=z.getY(se),j.z=z.getZ(se),Y.x=z.getX(he),Y.y=z.getY(he),Y.z=z.getZ(he)}function yA(E,O,R,z,V,j,Y){let ee=R.index,se=R.attributes.position;for(let R=E,he=O+E;R<he;R++)if(gs(Y,R*3,ee,se),Y.needsUpdate=!0,z(Y,R,V,j))return!0;return!1}var UO=class{constructor(E){this._getNewPrimitive=E,this._primitives=[]}getPrimitive(){let E=this._primitives;return E.length===0?this._getNewPrimitive():E.pop()}releasePrimitive(E){this._primitives.push(E)}};function Oa(E,O){return O[E+15]===65535}function jc(E,O){return O[E+6]}function pd(E,O){return O[E+14]}function md(E){return E+8}function gd(E,O){return O[E+6]}function sO(E,O){return O[E+7]}var kO=new Yn,VO=new Wn,jO=["x","y","z"];function A0(E,O,R,z,V){let j=E*2,Y=$O,ee=eR,se=tR;if(Oa(j,ee)){let Y=jc(E,se),he=pd(j,ee);iO(O,R,z,Y,he,V)}else{let j=md(E);T0(j,Y,z,VO)&&A0(j,O,R,z,V);let ee=gd(E,se);T0(ee,Y,z,VO)&&A0(ee,O,R,z,V)}}function E0(E,O,R,z){let V=E*2,j=$O,Y=eR,ee=tR;if(Oa(V,Y)){let j=jc(E,ee),se=pd(V,Y);return nO(O,R,z,j,se)}{let V,Y,se=sO(E,ee),he=jO[se],ce=z.direction[he]>=0;ce?(V=md(E),Y=gd(E,ee)):(V=gd(E,ee),Y=md(E));let ue=T0(V,j,z,VO)?E0(V,O,R,z):null;if(ue){let E=ue.point[he];if(ce?E<=j[Y+se]:E>=j[Y+se+3])return ue}let fe=T0(Y,j,z,VO)?E0(Y,O,R,z):null;return ue&&fe?ue.distance<=fe.distance?ue:fe:ue||fe||null}}var XO=function(){let E,O,R=[],z=new UO((()=>new Yn));return function(...V){E=z.getPrimitive(),O=z.getPrimitive(),R.push(E,O);let j=i(...V);z.releasePrimitive(E),z.releasePrimitive(O),R.pop(),R.pop();let Y=R.length;return Y>0&&(O=R[Y-1],E=R[Y-2]),j};function i(R,z,V,j,Y=null,ee=0,se=0){function d(E){let O=E*2,R=eR,z=tR;for(;!Oa(O,R);)E=md(E),O=E*2;return jc(E,z)}function f(E){let O=E*2,R=eR,z=tR;for(;!Oa(O,R);)E=gd(E,z),O=E*2;return jc(E,z)+pd(O,R)}let he=R*2,ce=$O,ue=eR,fe=tR;if(Oa(he,ue)){let O=jc(R,fe),z=pd(he,ue);return ms(R,ce,E),j(O,z,!1,se,ee+R,E)}{let he,ve,we,Se,_e=md(R),Ae=gd(R,fe),Ce=_e,Te=Ae;if(Y&&(we=E,Se=O,ms(Ce,ce,we),ms(Te,ce,Se),he=Y(we),ve=Y(Se),ve<he)){Ce=Ae,Te=_e;let E=he;he=ve,ve=E,we=Se}we||(we=E,ms(Ce,ce,we));let Ie,Fe=Oa(Ce*2,ue),Ue=V(we,Fe,he,se+1,ee+Ce);if(Ue===2){let E=d(Ce),O=f(Ce)-E;Ie=j(E,O,!0,se+1,ee+Ce,we)}else Ie=Ue&&i(Ce,z,V,j,Y,ee,se+1);if(Ie)return!0;Se=O,ms(Te,ce,Se);let Ge,qe=Oa(Te*2,ue),Xe=V(Se,qe,ve,se+1,ee+Te);if(Xe===2){let E=d(Te),O=f(Te)-E;Ge=j(E,O,!0,se+1,ee+Te,Se)}else Ge=Xe&&i(Te,z,V,j,Y,ee,se+1);return!!Ge}}}(),YO=function(){let E=new hO,O=new hO,R=new Es,z=new cO,V=new cO;return function s(j,Y,ee,se,he=null){let ce=j*2,ue=$O,fe=eR,ve=tR;if(he===null&&(ee.boundingBox||ee.computeBoundingBox(),z.set(ee.boundingBox.min,ee.boundingBox.max,se),he=z),!Oa(ce,fe)){let E=j+8,O=ve[j+6];return ms(E,ue,kO),!!(he.intersectsBox(kO)&&s(E,Y,ee,se,he)||(ms(O,ue,kO),he.intersectsBox(kO)&&s(O,Y,ee,se,he)))}{let z=Y,he=z.index,we=z.attributes.position,Se=ee.index,_e=ee.attributes.position,Ae=jc(j,ve),Ce=pd(ce,fe);if(R.copy(se).invert(),ee.boundsTree)return ms(j,ue,V),V.matrix.copy(R),V.needsUpdate=!0,ee.boundsTree.shapecast({intersectsBounds:E=>V.intersectsBox(E),intersectsTriangle:E=>{E.a.applyMatrix4(se),E.b.applyMatrix4(se),E.c.applyMatrix4(se),E.needsUpdate=!0;for(let R=Ae*3,z=(Ce+Ae)*3;R<z;R+=3)if(gs(O,R,he,we),O.needsUpdate=!0,E.intersectsTriangle(O))return!0;return!1}});for(let z=Ae*3,V=Ce+Ae*3;z<V;z+=3){gs(E,z,he,we),E.a.applyMatrix4(R),E.b.applyMatrix4(R),E.c.applyMatrix4(R),E.needsUpdate=!0;for(let R=0,z=Se.count;R<z;R+=3)if(gs(O,R,Se,_e),O.needsUpdate=!0,E.intersectsTriangle(O))return!0}}}}();function T0(E,O,R,z){return ms(E,O,kO),R.intersectBox(kO,z)}var KO,$O,eR,tR,iR=[];function xd(E){KO&&iR.push(KO),KO=E,$O=new Float32Array(E),eR=new Uint16Array(E),tR=new Uint32Array(E)}function nm(){KO=null,$O=null,eR=null,tR=null,iR.length&&xd(iR.pop())}var rR=Symbol("skip tree generation"),nR=new Yn,sR=new Yn,aR=new Es,oR=new cO,hR=new cO,cR=new Wn,pR=new Wn,fR=new Wn,gR=new Wn,vR=new Wn,yR=new Yn,xR=new UO((()=>new hO)),bR=class{static serialize(E,O={}){if(O.isBufferGeometry)return console.warn("MeshBVH.serialize: The arguments for the function have changed. See documentation for new signature."),bR.serialize(arguments[0],{cloneBuffers:arguments[2]===void 0||arguments[2]});O={cloneBuffers:!0,...O};let R,z=E.geometry,V=E._roots,j=z.getIndex();return R=O.cloneBuffers?{roots:V.map((E=>E.slice())),index:j.array.slice()}:{roots:V,index:j.array},R}static deserialize(E,O,R={}){if(typeof R=="boolean")return console.warn("MeshBVH.deserialize: The arguments for the function have changed. See documentation for new signature."),bR.deserialize(arguments[0],arguments[1],{setIndex:arguments[2]===void 0||arguments[2]});R={setIndex:!0,...R};let{index:z,roots:V}=E,j=new bR(O,{...R,[rR]:!0});if(j._roots=V,R.setIndex){let R=O.getIndex();if(R===null){let R=new Sa(E.index,1,!1);O.setIndex(R)}else R.array!==z&&(R.array.set(z),R.needsUpdate=!0)}return j}constructor(E,O={}){if(!E.isBufferGeometry)throw new Error("MeshBVH: Only BufferGeometries are supported.");if(E.index&&E.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.");if(O=Object.assign({strategy:0,maxDepth:40,maxLeafTris:10,verbose:!0,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,[rR]:!1},O),O.useSharedArrayBuffer&&typeof SharedArrayBuffer>"u")throw new Error("MeshBVH: SharedArrayBuffer is not available.");this._roots=null,O[rR]||(this._roots=JD(E,O),!E.boundingBox&&O.setBoundingBox&&(E.boundingBox=this.getBoundingBox(new Yn))),this.geometry=E}refit(E=null){E&&Array.isArray(E)&&(E=new Set(E));let O,R,z,V,j=this.geometry,Y=j.index.array,ee=j.attributes.position,se=0,he=this._roots;for(let E=0,j=he.length;E<j;E++)O=he[E],R=new Uint32Array(O),z=new Uint16Array(O),V=new Float32Array(O),h(0,se),se+=O.byteLength;function h(O,j,se=!1){let he=O*2;if(z[he+15]===65535){let E=R[O+6],j=z[he+14],se=1/0,ce=1/0,ue=1/0,fe=-1/0,ve=-1/0,we=-1/0;for(let O=3*E,R=3*(E+j);O<R;O++){let E=Y[O],R=ee.getX(E),z=ee.getY(E),V=ee.getZ(E);R<se&&(se=R),R>fe&&(fe=R),z<ce&&(ce=z),z>ve&&(ve=z),V<ue&&(ue=V),V>we&&(we=V)}return(V[O+0]!==se||V[O+1]!==ce||V[O+2]!==ue||V[O+3]!==fe||V[O+4]!==ve||V[O+5]!==we)&&(V[O+0]=se,V[O+1]=ce,V[O+2]=ue,V[O+3]=fe,V[O+4]=ve,V[O+5]=we,!0)}{let z=O+8,Y=R[O+6],ee=z+j,he=Y+j,ce=se,ue=!1,fe=!1;E?ce||(ue=E.has(ee),fe=E.has(he),ce=!ue&&!fe):(ue=!0,fe=!0);let ve=ce||ue,we=ce||fe,Se=!1;ve&&(Se=h(z,j,ce));let _e=!1;we&&(_e=h(Y,j,ce));let Ae=Se||_e;if(Ae)for(let E=0;E<3;E++){let R=z+E,j=Y+E,ee=V[R],se=V[R+3],he=V[j],ce=V[j+3];V[O+E]=ee<he?ee:he,V[O+E+3]=se>ce?se:ce}return Ae}}}traverse(E,O=0){let R=this._roots[O],z=new Uint32Array(R),V=new Uint16Array(R);o(0);function o(O,j=0){let Y=O*2,ee=V[Y+15]===65535;if(ee){let se=z[O+6],he=V[Y+14];E(j,ee,new Float32Array(R,O*4,6),se,he)}else{let V=O+8,Y=z[O+6],se=z[O+7];E(j,ee,new Float32Array(R,O*4,6),se)||(o(V,j+1),o(Y,j+1))}}}raycast(E,O=Fe){let R=this._roots,z=this.geometry,V=[],j=O.isMaterial,Y=Array.isArray(O),ee=z.groups,se=j?O.side:O;for(let j=0,he=R.length;j<he;j++){let he=Y?O[ee[j].materialIndex].side:se,ce=V.length;if(xd(R[j]),A0(0,z,he,E,V),nm(),Y){let E=ee[j].materialIndex;for(let O=ce,R=V.length;O<R;O++)V[O].face.materialIndex=E}}return V}raycastFirst(E,O=Fe){let R=this._roots,z=this.geometry,V=O.isMaterial,j=Array.isArray(O),Y=null,ee=z.groups,se=V?O.side:O;for(let V=0,he=R.length;V<he;V++){let he=j?O[ee[V].materialIndex].side:se;xd(R[V]);let ce=E0(0,z,he,E);nm(),ce!=null&&(Y==null||ce.distance<Y.distance)&&(Y=ce,j&&(ce.face.materialIndex=ee[V].materialIndex))}return Y}intersectsGeometry(E,O){let R=this.geometry,z=!1;for(let V of this._roots)if(xd(V),z=YO(0,R,E,O),nm(),z)break;return z}shapecast(E,O,R){let z=this.geometry;if(E instanceof Function){if(O){let E=O;O=(O,R,z,V)=>{let j=R*3;return E(O,j,j+1,j+2,z,V)}}E={boundsTraverseOrder:R,intersectsBounds:E,intersectsTriangle:O,intersectsRange:null},console.warn("MeshBVH: Shapecast function signature has changed and now takes an object of callbacks as a second argument. See docs for new signature.")}let V=xR.getPrimitive(),{boundsTraverseOrder:j,intersectsBounds:Y,intersectsRange:ee,intersectsTriangle:se}=E;if(ee&&se){let E=ee;ee=(O,R,j,Y,ee)=>!!E(O,R,j,Y,ee)||yA(O,R,z,se,j,Y,V)}else ee||(ee=se?(E,O,R,j)=>yA(E,O,z,se,R,j,V):(E,O,R)=>R);let he=!1,ce=0;for(let E of this._roots){if(xd(E),he=XO(0,z,Y,ee,j,ce),nm(),he)break;ce+=E.byteLength}return xR.releasePrimitive(V),he}bvhcast(E,O,R){let{intersectsRanges:z,intersectsTriangles:V}=R,j=this.geometry.index,Y=this.geometry.attributes.position,ee=E.geometry.index,se=E.geometry.attributes.position;aR.copy(O).invert();let he=xR.getPrimitive(),ce=xR.getPrimitive();if(V){let f=function(E,R,z,ue,fe,ve,we,Se){for(let _e=z,Ae=z+ue;_e<Ae;_e++){gs(ce,_e*3,ee,se),ce.a.applyMatrix4(O),ce.b.applyMatrix4(O),ce.c.applyMatrix4(O),ce.needsUpdate=!0;for(let O=E,z=E+R;O<z;O++)if(gs(he,O*3,j,Y),he.needsUpdate=!0,V(he,ce,O,_e,fe,ve,we,Se))return!0}return!1};if(z){let E=z;z=function(O,R,z,V,j,Y,ee,se){return!!E(O,R,z,V,j,Y,ee,se)||f(O,R,z,V,j,Y,ee,se)}}else z=f}E.getBoundingBox(sR),sR.applyMatrix4(O);let ue=this.shapecast({intersectsBounds:E=>sR.intersectsBox(E),intersectsRange:(O,R,V,j,Y,ee)=>(nR.copy(ee),nR.applyMatrix4(aR),E.shapecast({intersectsBounds:E=>nR.intersectsBox(E),intersectsRange:(E,V,ee,se,he)=>z(O,R,E,V,j,Y,se,he)}))});return xR.releasePrimitive(he),xR.releasePrimitive(ce),ue}intersectsBox(E,O){return oR.set(E.min,E.max,O),oR.needsUpdate=!0,this.shapecast({intersectsBounds:E=>oR.intersectsBox(E),intersectsTriangle:E=>oR.intersectsTriangle(E)})}intersectsSphere(E){return this.shapecast({intersectsBounds:O=>E.intersectsBox(O),intersectsTriangle:O=>O.intersectsSphere(E)})}closestPointToGeometry(E,O,R={},z={},V=0,j=1/0){E.boundingBox||E.computeBoundingBox(),oR.set(E.boundingBox.min,E.boundingBox.max,O),oR.needsUpdate=!0;let Y=this.geometry,ee=Y.attributes.position,se=Y.index,he=E.attributes.position,ce=E.index,ue=xR.getPrimitive(),fe=xR.getPrimitive(),ve=pR,we=fR,Se=null,_e=null;z&&(Se=gR,_e=vR);let Ae=1/0,Ce=null,Te=null;return aR.copy(O).invert(),hR.matrix.copy(aR),this.shapecast({boundsTraverseOrder:E=>oR.distanceToBox(E),intersectsBounds:(E,O,R)=>R<Ae&&R<j&&(O&&(hR.min.copy(E.min),hR.max.copy(E.max),hR.needsUpdate=!0),!0),intersectsRange:(R,z)=>{if(E.boundsTree)return E.boundsTree.shapecast({boundsTraverseOrder:E=>hR.distanceToBox(E),intersectsBounds:(E,O,R)=>R<Ae&&R<j,intersectsRange:(E,j)=>{for(let Y=E*3,Ie=(E+j)*3;Y<Ie;Y+=3){gs(fe,Y,ce,he),fe.a.applyMatrix4(O),fe.b.applyMatrix4(O),fe.c.applyMatrix4(O),fe.needsUpdate=!0;for(let E=R*3,O=(R+z)*3;E<O;E+=3){gs(ue,E,se,ee),ue.needsUpdate=!0;let O=ue.distanceToTriangle(fe,ve,Se);if(O<Ae&&(we.copy(ve),_e&&_e.copy(Se),Ae=O,Ce=E/3,Te=Y/3),O<V)return!0}}}});{let E=ce?ce.count:he.count;for(let j=0,Y=E;j<Y;j+=3){gs(fe,j,ce,he),fe.a.applyMatrix4(O),fe.b.applyMatrix4(O),fe.c.applyMatrix4(O),fe.needsUpdate=!0;for(let E=R*3,O=(R+z)*3;E<O;E+=3){gs(ue,E,se,ee),ue.needsUpdate=!0;let O=ue.distanceToTriangle(fe,ve,Se);if(O<Ae&&(we.copy(ve),_e&&_e.copy(Se),Ae=O,Ce=E/3,Te=j/3),O<V)return!0}}}}}),xR.releasePrimitive(ue),xR.releasePrimitive(fe),Ae===1/0?null:(R.point?R.point.copy(we):R.point=we.clone(),R.distance=Ae,R.faceIndex=Ce,z&&(z.point?z.point.copy(_e):z.point=_e.clone(),z.point.applyMatrix4(aR),we.applyMatrix4(aR),z.distance=we.sub(z.point).length(),z.faceIndex=Te),R)}closestPointToPoint(E,O={},R=0,z=1/0){let V=R*R,j=z*z,Y=1/0,ee=null;if(this.shapecast({boundsTraverseOrder:O=>(cR.copy(E).clamp(O.min,O.max),cR.distanceToSquared(E)),intersectsBounds:(E,O,R)=>R<Y&&R<j,intersectsTriangle:(O,R)=>{O.closestPointToPoint(E,cR);let z=E.distanceToSquared(cR);return z<Y&&(pR.copy(cR),Y=z,ee=R),z<V}}),Y===1/0)return null;let se=Math.sqrt(Y);return O.point?O.point.copy(pR):O.point=pR.clone(),O.distance=se,O.faceIndex=ee,O}getBoundingBox(E){return E.makeEmpty(),this._roots.forEach((O=>{ms(0,new Float32Array(O),yR),E.union(yR)})),E}};var SR=Za(Y());var _R=.5*(Math.sqrt(3)-1),MR=(3-Math.sqrt(3))/6,CR=1/3,TR=1/6,PR=(Math.sqrt(5),Math.sqrt(5),E=>Math.floor(E)|0),DR=new Float64Array([1,1,-1,1,1,-1,-1,-1,1,0,-1,0,1,0,-1,0,0,1,0,-1,0,1,0,-1]),IR=new Float64Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]);function dO(E=Math.random){let O=pO(E),R=new Float64Array(O).map((E=>DR[E%12*2])),z=new Float64Array(O).map((E=>DR[E%12*2+1]));return function(E,V){let j,Y,ee=0,se=0,he=0,ce=(E+V)*_R,ue=PR(E+ce),fe=PR(V+ce),ve=(ue+fe)*MR,we=ue-ve,Se=fe-ve,_e=E-we,Ae=V-Se;_e>Ae?(j=1,Y=0):(j=0,Y=1);let Ce=_e-j+MR,Te=Ae-Y+MR,Ie=_e-1+2*MR,Fe=Ae-1+2*MR,Ue=ue&255,Ge=fe&255,qe=.5-_e*_e-Ae*Ae;if(qe>=0){let E=Ue+O[Ge],V=R[E],j=z[E];qe*=qe,ee=qe*qe*(V*_e+j*Ae)}let Xe=.5-Ce*Ce-Te*Te;if(Xe>=0){let E=Ue+j+O[Ge+Y],V=R[E],ee=z[E];Xe*=Xe,se=Xe*Xe*(V*Ce+ee*Te)}let Qe=.5-Ie*Ie-Fe*Fe;if(Qe>=0){let E=Ue+1+O[Ge+1],V=R[E],j=z[E];Qe*=Qe,he=Qe*Qe*(V*Ie+j*Fe)}return 70*(ee+se+he)}}function fO(E=Math.random){let O=pO(E),R=new Float64Array(O).map((E=>IR[E%12*3])),z=new Float64Array(O).map((E=>IR[E%12*3+1])),V=new Float64Array(O).map((E=>IR[E%12*3+2]));return function(E,j,Y){let ee,se,he,ce,ue,fe,ve,we,Se,_e,Ae=(E+j+Y)*CR,Ce=PR(E+Ae),Te=PR(j+Ae),Ie=PR(Y+Ae),Fe=(Ce+Te+Ie)*TR,Ue=Ce-Fe,Ge=Te-Fe,qe=Ie-Fe,Xe=E-Ue,Qe=j-Ge,Ze=Y-qe;Xe>=Qe?Qe>=Ze?(ue=1,fe=0,ve=0,we=1,Se=1,_e=0):Xe>=Ze?(ue=1,fe=0,ve=0,we=1,Se=0,_e=1):(ue=0,fe=0,ve=1,we=1,Se=0,_e=1):Qe<Ze?(ue=0,fe=0,ve=1,we=0,Se=1,_e=1):Xe<Ze?(ue=0,fe=1,ve=0,we=0,Se=1,_e=1):(ue=0,fe=1,ve=0,we=1,Se=1,_e=0);let Ke=Xe-ue+TR,Je=Qe-fe+TR,$e=Ze-ve+TR,et=Xe-we+2*TR,it=Qe-Se+2*TR,rt=Ze-_e+2*TR,at=Xe-1+3*TR,lt=Qe-1+3*TR,ct=Ze-1+3*TR,dt=Ce&255,ut=Te&255,pt=Ie&255,mt=.6-Xe*Xe-Qe*Qe-Ze*Ze;if(mt<0)ee=0;else{let E=dt+O[ut+O[pt]];mt*=mt,ee=mt*mt*(R[E]*Xe+z[E]*Qe+V[E]*Ze)}let gt=.6-Ke*Ke-Je*Je-$e*$e;if(gt<0)se=0;else{let E=dt+ue+O[ut+fe+O[pt+ve]];gt*=gt,se=gt*gt*(R[E]*Ke+z[E]*Je+V[E]*$e)}let yt=.6-et*et-it*it-rt*rt;if(yt<0)he=0;else{let E=dt+we+O[ut+Se+O[pt+_e]];yt*=yt,he=yt*yt*(R[E]*et+z[E]*it+V[E]*rt)}let St=.6-at*at-lt*lt-ct*ct;if(St<0)ce=0;else{let E=dt+1+O[ut+1+O[pt+1]];St*=St,ce=St*St*(R[E]*at+z[E]*lt+V[E]*ct)}return 32*(ee+se+he+ce)}}function pO(E){let O=new Uint8Array(512);for(let E=0;E<256;E++)O[E]=E;for(let R=0;R<255;R++){let z=R+~~(E()*(256-R)),V=O[R];O[R]=O[z],O[z]=V}for(let E=256;E<512;E++)O[E]=O[E-256];return O}var OR=new ga,LR=class{constructor(E){this.weightAttribute=null;let O=E.geometry;if(!O.isBufferGeometry||O.attributes.position.itemSize!==3)throw new Error("THREE.MeshSurfaceSampler: Requires BufferGeometry triangle mesh.");O.index&&(O=O.toNonIndexed()),this.geometry=O,this.randomFunction=Math.random,this.positionAttribute=this.geometry.getAttribute("position"),this.distribution=null}build(){let E=this.positionAttribute,O=new Float32Array(E.count/3);for(let R=0;R<E.count;R+=3){let z=1;OR.a.fromBufferAttribute(E,R),OR.b.fromBufferAttribute(E,R+1),OR.c.fromBufferAttribute(E,R+2),z*=OR.getArea(),O[R/3]=z}this.distribution=new Float32Array(E.count/3);let R=0;for(let E=0;E<O.length;E++)R+=O[E],this.distribution[E]=R;return this}setRandomGenerator(E){return this.randomFunction=E,this}sample(E,O){if(this.distribution){let R=this.distribution[this.distribution.length-1],z=this.binarySearch(this.randomFunction()*R);return this.sampleFace(z,E,O)}}binarySearch(E){if(!this.distribution)return 0;let O=this.distribution,R=0,z=O.length-1,V=-1;for(;R<=z;){let j=Math.ceil((R+z)/2);if(j===0||O[j-1]<=E&&O[j]>E){V=j;break}E<O[j]?z=j-1:R=j+1}return V}sampleFace(E,O,R){let z=this.randomFunction(),V=this.randomFunction();return z+V>1&&(z=1-z,V=1-V),OR.a.fromBufferAttribute(this.positionAttribute,E*3),OR.b.fromBufferAttribute(this.positionAttribute,E*3+1),OR.c.fromBufferAttribute(this.positionAttribute,E*3+2),O.set(0,0,0).addScaledVector(OR.a,z).addScaledVector(OR.b,V).addScaledVector(OR.c,1-(z+V)),OR.getNormal(R),this}};var zR,FR=Za(ee()),UR=new Es,kR=new Es,jR=new Es;(E=>{function n(E){return E&&E.__isSPEObject}E.is=n})(zR||(zR={}));var Sd=E=>class extends E{constructor(){super(...arguments);this.previousModelViewMatrix=new Es;this.copyPreviousMatrix=!0;this.hiddenMatrix=new Es;this.matrixWorldRigid=new Es;this.shearScale=new Es;this.shearScaleInv=new Es}get __isSPEObject(){return!0}isDescendantOf(E){E instanceof ra&&(E=E.uuid);let O=this;for(;O.parent;){if(O.parent.uuid===E)return!0;O=O.parent}return!1}updateMatrixWorld(E){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||E)&&(this.parent===null?this.matrixWorld.multiplyMatrices(this.hiddenMatrix,this.matrix):(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.hiddenMatrix),this.matrixWorld.multiplyMatrices(this.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,E=!0);for(let O of this.children)O.updateMatrixWorld(E)}updateWorldMatrix(E,O){let R=this.parent;if(E&&R!==null&&R.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.multiplyMatrices(this.hiddenMatrix,this.matrix):(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.hiddenMatrix),this.matrixWorld.multiplyMatrices(this.matrixWorld,this.matrix)),O)for(let E of this.children)E.updateWorldMatrix(!1,!0)}traverseChildren(E,O=0){for(let R of this.children)zR.is(R)&&R.traverseObject(E,O+1)}traverseObject(E,O=0){if(E(this,O)!==!0)for(let R of this.children)zR.is(R)&&R.traverseObject(E,O+1)}updateMatrixWorldSVD(){let E=this.matrixWorld.elements,O=[[E[0],E[4],E[8]],[E[1],E[5],E[9]],[E[2],E[6],E[10]]],{u:R,v:z,q:V}=(0,FR.SVD)(O),j=UR.set(R[0][0],R[0][1],R[0][2],0,R[1][0],R[1][1],R[1][2],0,R[2][0],R[2][1],R[2][2],0,0,0,0,1),Y=kR.set(z[0][0],z[0][1],z[0][2],0,z[1][0],z[1][1],z[1][2],0,z[2][0],z[2][1],z[2][2],0,0,0,0,1),ee=jR.copy(Y).transpose();this.shearScale.makeScale(V[0],V[1],V[2]).multiply(ee).premultiply(Y),this.shearScaleInv.copy(this.shearScale).invert(),this.matrixWorldRigid.multiplyMatrices(j,ee).copyPosition(this.matrixWorld),V.every((E=>Math.abs(V[0]-E)<.01))?this.hasNonUniformScale=!1:this.hasNonUniformScale=!0}attach(E,O){this.updateWorldMatrix(!0,!1);let R=(new Es).copy(this.matrixWorld).invert();return E.parent!==null&&(E.parent.updateWorldMatrix(!0,!1),R.multiply(E.parent.matrixWorld)),"hiddenMatrix"in E&&E.hiddenMatrix instanceof Es?E.hiddenMatrix.premultiply(R):E.applyMatrix4(R),E.updateWorldMatrix(!1,!1),this.add(E),O!==void 0&&(this.children.pop(),this.children.splice(O,0,E)),this}copy(E,O=!1){return super.copy(E,O),this.hasNonUniformScale=E.hasNonUniformScale,this}onAfterRender(E,O,R,z,V,j){this.copyPreviousMatrix&&this.previousModelViewMatrix.copy(this.modelViewMatrix)}};var GR=class extends(Sd(ra)){},L7=E=>E.type==="Mesh",HR=class extends GR{constructor(E){super();this.object=E;this.matrixAutoUpdate=!1,this.hasNonUniformScale=E.hasNonUniformScale}raycast(E,O){}expand(){let E=0,O=this.object.entityChildren(E);for(;O;){let R=this.children[E];R?.object!==O&&(R&&this.remove(R),R=new HR(O),this.add(R),this.children.splice(E,0,this.children.pop()),R.matrixWorldNeedsUpdate=!0,R.matrixAutoUpdate=!1,R.matrix=O.matrix,R.hiddenMatrix=O.hiddenMatrix),R.expand(),E+=1,O=this.object.entityChildren(E)}for(;this.children.length>E;)this.remove(this.children[E])}get visible(){return this.playModeVisible!==void 0?this.playModeVisible:this.object.visible||this.object.dataPatched.visible&&this.object.dataPatched.cloner?.hideBase===!0}set visible(E){}get castShadow(){return this.object.castShadow}set castShadow(E){}get receiveShadow(){return this.object.receiveShadow}set receiveShadow(E){}get isMesh(){return L7(this.object)}get isLight(){return this.object.isLight}get layers(){return this.object.layers}set layers(E){}get isCamera(){return!1}get geometry(){if(this.object.geometry)return this.object.geometry}get material(){if(this.object.material)return this.object.material}};var WR=new Wn,KR=new Wn,$R=new Es,eL=[new Wn(-1,1,1),new Wn(-1,-1,1),new Wn(1,-1,1),new Wn(1,1,1),new Wn(-1,1,-1),new Wn(-1,-1,-1),new Wn(1,-1,-1),new Wn(1,1,-1)],tL=[[0,3],[1,2],[5,6],[4,7],[0,1],[3,2],[7,6],[4,5],[0,4],[1,5],[2,6],[3,7]],iL=[[0,2],[7,5],[4,1],[3,6],[4,3],[1,6]],yO=(E,O,R)=>{E.updateEntityBoxSize(WR,KR),$R.copy(O).multiply(E.matrixWorld),KR.x===0&&KR.y===0&&KR.z===0?R.push(new Wn(WR.x,WR.y,WR.z).applyMatrix4($R)):eL.forEach((E=>{R.push(E.clone().multiply(KR).add(WR).applyMatrix4($R))}))},rL=class extends Yn{constructor(){super(...arguments);this.matrix=new Es;this.vertices=[];this.faces=[];this.edges=[];this.centerEdges=[]}copy(E){return super.copy(E),this.matrix.copy(E.matrix),this.vertices=E.vertices.map((E=>E.clone())),this.faces=E.faces.map((E=>E.clone())),this.edges=E.edges.map((E=>E.clone())),this.centerEdges=E.centerEdges.map((E=>E.clone())),this}setFromObjectSize(E,O=!1){E.updateWorldMatrix(!1,O),this.makeEmpty(),this.matrix.copy(E.matrixWorld);let R=(new Es).copy(E.matrixWorld).invert();return this.expandByObjectSize(E,R,O)}expandByObjectSize(E,O,R=!1){let z=[];return R===!0?E.traverseEntity((E=>{if(E.visible||E.cloner&&E.data.visible){if(!("geometry"in E)){z.push(new Wn);return}yO(E,O,z)}})):yO(E,O,z),this.setFromPoints(z)}getCenter(E){return E=super.getCenter(E),E.applyMatrix4(this.matrix),E}getPositionToCenter(E){return E=super.getCenter(E),E.applyMatrix4($R.copy(this.matrix).setPosition(0,0,0)),E}computeVertices(){this.getSize(KR).multiplyScalar(.5),this.getCenter(WR),$R.copy(this.matrix).setPosition(WR),this.vertices=eL.map((E=>E.clone().multiply(KR).applyMatrix4($R)))}computeEdges(){this.vertices.length>0&&this.computeVertices(),this.edges=tL.map((([E,O])=>new Df(this.vertices[E],this.vertices[O]))),this.centerEdges=this.edges.map((E=>E.getCenter(new Wn)))}computeFaces(){this.vertices.length>0&&this.computeVertices(),this.faces=iL.map((([E,O])=>this.vertices[E].clone().add(this.vertices[O]).multiplyScalar(.5)))}};var nL={Cloner:()=>{},changeEntityProptotype:()=>{},createEntity:()=>{}};var sL=class extends Vu{constructor(){super()}getPoints(E=12){let O,R=[],z=this.getCurveLengths(),V=z[z.length-1]/z.length;for(let j=0,Y=this.curves;j<Y.length;j++){let ee=Y[j],se=j===0?z[j]:z[j]-z[j-1],he=Math.ceil(E*se/V),ce=ee.getPoints(he);for(let E=0;E<ce.length;E++){let z=ce[E];O&&O.equals(z)||(R.push(z),O=z)}}return this.autoClose&&R.length>1&&!R[R.length-1].equals(R[0])&&R.push(R[0]),R}};var aL=.001;function _A(E,O,R){return O.clone().sub(E).cross(O.clone().sub(R)).length()<=aL}function MA(E,O){let R=new Wn(...E.position),z=new Wn(...E.controlNext.position),V=new Wn(...O.controlPrevious.position),j=new Wn(...O.position);return _A(R,z,j)&&_A(R,V,j)}function _0(E){let O=E.points.map((E=>new Wn(...E.data.position))),R=[E.points[0]],z=new Wn(...R[0].data.position);for(let V=0;V<E.points.length-1;V++)_A(z,O[V],O[V+1])||(R.push(E.points[V]),z=O[V]);R.push(E.points[E.points.length-1]);let V=E.isClosed,j=R.length-(V?0:1),Y=R.length,ee=[];for(let O=0;O<Y;O++){let z=R[O].data,j=new Wn(...z.position),se=new Wn(...z.controlPrevious.position),he=new Wn(...z.controlNext.position),ce={position:j,baseRoundness:z.roundness,controlPrevious:se,controlNext:he};if(z.roundness===0||!E.isClosed&&(O===0||O===Y-1)){ee[O]={...ce,removedLength:0};continue}let ue=V&&O==0?Y-1:O-1,fe=V&&O==Y-1?0:O+1,ve=R[ue].data,we=R[fe].data,Se=new Wn(...ve.position),_e=new Wn(...we.position),Ae=Se.clone().sub(j).normalize(),Ce=_e.clone().sub(j).normalize();Object.assign(ce,{prevDir:Ae,nextDir:Ce});let Te=MA(ve,z),Ie=MA(z,we);if(Te&&Ie){let E=Ae.clone().add(Ce).normalize(),R=E.clone().cross(Ae).length()/Ae.dot(E);ee[O]={...ce,tan:R,removedLength:z.roundness/R}}else ee[O]={...ce,removedLength:0}}for(let E=0;E<j;E++){let O=E,R=V&&E===Y-1?0:E+1,z=ee[O],j=ee[R];if(z.removedLength!==0||j.removedLength!==0){let E=z.position.distanceTo(j.position);z.removedLength=Math.min(z.removedLength,E/2),j.removedLength=Math.min(j.removedLength,E/2)}}let se=[];for(let E=0;E<j;E++){let O=E,z=V&&E===Y-1?0:E+1,j=ee[O],he=ee[z],ce=null;if(MA(R[O].data,R[z].data)){let E=j.position.clone(),O=he.position.clone();(j.removedLength!==0||he.removedLength!==0)&&(j.nextDir&&E.add(j.nextDir.clone().setLength(j.removedLength)),he.prevDir&&O.add(he.prevDir.clone().setLength(he.removedLength))),E.distanceTo(O)>aL&&(ce=new Ru(E,E.clone().lerp(O,.3),O.clone().lerp(E,.3),O))}else j.position.distanceTo(he.position)>aL&&(ce=new Ru(j.position,j.controlNext,he.controlPrevious,he.position));se[2*E+1]=ce}for(let E=0;E<Y;E++){let O=ee[E];if(O.removedLength===0){se[2*E]=null;continue}let R=O.position,z=O.prevDir.clone().multiplyScalar(O.removedLength).add(R),V=O.nextDir.clone().multiplyScalar(O.removedLength).add(R),j=O.tan*O.removedLength,Y=O.prevDir.clone().add(O.nextDir).normalize(),he=z.clone().lerp(V,.5),ce=z.distanceTo(V)/2,ue=Y.clone().multiplyScalar(Math.sqrt(Math.pow(j,2)-Math.pow(ce,2))).add(he),fe=Y.clone().multiplyScalar(-j).add(ue),ve=R.distanceTo(fe)/R.distanceTo(he),we=O.prevDir.clone().multiplyScalar(ve*R.distanceTo(z)).add(R),Se=we.clone().lerp(fe,2),_e=z.clone().lerp(we,4/3),Ae=V.clone().lerp(Se,4/3);se[2*E]=new Ru(z,_e,Ae,V)}let he=new sL;return se.forEach((E=>{E&&he.add(E)})),he}var oL;(E=>{function n(E){return E&&E.__isEntity}E.is=n})(oL||(oL={}));var Bo=E=>oL.is(E),lL={type:"completeState",isfromEntity:!0},hL=["x","y","z"],cL=new Wn,dL=(new Wn).set(0,1,0),Ad=E=>class extends(Sd(E)){constructor(){super(...arguments);this.raycastLock=!1;this.scaleLock=!1;this.disposed=!1;this.stateSelection=null;this.destroyedInAction=!1;this.instances=[];this.prevState=null;this.currentState=null;this.reversibleToState=null;this.currentTransitionEvent=null;this.previousAction=null;this._singleBBox=new rL;this._recursiveBBox=new rL;this.singleBBoxNeedsUpdate=!0;this.recursiveBBoxNeedsUpdate=!0;this._needApplyPathSnapping=!0;this.attachedPaths=new Set}get __isEntity(){return!0}entityChildren(E){let O=this.children[E];if(oL.is(O))return O}entityChildrenCount(){let E=this.children.length;for(;E--;)if(oL.is(this.children[E]))return E+1;return 0}get isConcreteEntity(){return typeof this.identity=="string"}get isVirtualEntity(){return typeof this.identity!="string"}get isInstanceRoot(){return this.isConcreteEntity&&this.data.type==="Instance"}nearestInstanceSelfOrParent(){let E=this;for(;E.data.type!=="Instance";){let O=E.parent;if(!oL.is(O))return;E=O}return E}forInstancesRec(E){this.instances.forEach((O=>{O.disposed||E(O),O.forInstancesRec(E)}))}super_Entity(E,O){typeof E=="string"&&(this.uuid=E),this.identity=E,this.data=O,this.matrixAutoUpdate=!1,this.dataPatched=this.data}changeSelectedState(E,O,R=!1){if(!(this.data.states.length===0&&!R)){for(let E of this.data.states)yD.toOps(this.data,E.data).forEach((E=>{let R=WM.replaceProps(E,this.data);this.dataPatched=this.data,this.updateByPatchedOp(R,this.data,O)}));if(E!==null){let R=this.data.states.data(E);R&&(this.dataPatched=yD.patch(this.data,R),yD.toOps(this.data,R).forEach((E=>{this.updateByPatchedOp(E,this.dataPatched,O)})))}R&&this.updateTransformState(this.dataPatched,O),this.stateSelection=E,this.updatePathSnapping(this.dataPatched.pathSnapping)}}get singleBBox(){return this.singleBBoxNeedsUpdate&&(this.singleBBoxNeedsUpdate=!1,this._singleBBox.setFromObjectSize(this,!1),this._singleBBox.computeVertices(),this._singleBBox.computeEdges(),this._singleBBox.computeFaces()),this._singleBBox}get recursiveBBox(){return this.recursiveBBoxNeedsUpdate&&(this.recursiveBBoxNeedsUpdate=!1,this._recursiveBBox.setFromObjectSize(this,!0),this._recursiveBBox.computeVertices(),this._recursiveBBox.computeEdges(),this._recursiveBBox.computeFaces()),this._recursiveBBox}updateEntityBoxSize(E,O){E.setScalar(0),O.setScalar(0)}resetBBoxNeedsUpdateSelf(){this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0}resetBBoxNeedsUpdate(){this.resetBBoxNeedsUpdateSelf(),this.traverseAncestors((E=>{Bo(E)&&E.resetBBoxNeedsUpdateSelf()})),this.traverseEntity((E=>{E.resetBBoxNeedsUpdateSelf()}))}find(E){let O;return this.traverseEntity((R=>{R.uuid===E&&(O=R)})),O}traverseSortNextHelper(){let E=this.parent;if(E){let O=E.children,R=O.indexOf(this)+1;if(oL.is(O[R]))return O[R];if(oL.is(E))return E.traverseSortNextHelper()}}sortNext(){let E=this.children;return this.children.length>0&&oL.is(this.children[0])?E[0]:this.traverseSortNextHelper()}goUp(E){let O=this;for(;E>0&&O!==null;)O=O.parent,E-=1;return O}hasAnccestorOrSelf(E){return this===E||this.hasAnccestor(E)}hasAnccestor(E){let O=this.parent;for(;O;){if(E===O)return!0;O=O.parent}return!1}countToAccestor(E){let O=0,R=this;for(;R!==E;){if(R===null)return-1;R=R.parent,O+=1}return O}forEachEntity(E){for(let O of this.children)Bo(O)&&E(O)}traverseEntityAncestors(E){this.traverseAncestors((O=>{oL.is(O)&&E(O)}))}traverseConcreteEntity(E,O=0){if(E(this,O)!==!0)for(let R of this.children)Bo(R)&&R.isConcreteEntity&&R.traverseEntity(E,O+1)}traverseEntity(E,O=0){if(E(this,O)!==!0)for(let R of this.children)Bo(R)&&R.traverseEntity(E,O+1)}traverseVisibleEntity(E){E(this);for(let O of this.children)Bo(O)&&O.visible&&O.traverseVisibleEntity(E)}updateMatrix(){super.updateMatrix(),this.cloner&&this.cloner.onObjUpdateMatrix(),this.dispatchEvent({type:"updateMatrix"})}updateMatrixWorld(E){super.updateMatrixWorld(E),this.dispatchEvent({type:"updateMatrixWorld"})}copy(E,O=!1){return super.copy(E,O),this.dataPatched=E.dataPatched,this.raycastLock=E.raycastLock,this.scaleLock=E.scaleLock,this.hiddenMatrix.copy(E.hiddenMatrix),this}hasEntityChild(){return this.children.some((E=>Bo(E)))}isAncestorOf(E){if(this.uuid===E)return!1;let O=!1;return this.traverseEntity((R=>{R.uuid===E&&(O=!0)})),O}toObjectTransformState(E=[]){this.updateWorldMatrix(!0,!1);let O={position:this.position.toArray(),rotation:[this.rotation.x*xn.RAD2DEG,this.rotation.y*xn.RAD2DEG,this.rotation.z*xn.RAD2DEG],scale:this.scale.toArray(),hiddenMatrix:this.hiddenMatrix.toArray()};return uM(O,E)}getTransformValues(E,O,R){return O[E].map(((O,z)=>R?.shared.getVariable(O,[this.uuid,E,hL[z]])??O))}updateTransformState(E,O){let R=!1;return E.position&&(this.position.fromArray(this.getTransformValues("position",E,O)),R=!0),E.rotation&&(cL.fromArray(this.getTransformValues("rotation",E,O)).multiplyScalar(xn.DEG2RAD),this.rotation.setFromVector3(cL),R=!0),E.scale&&(this.scale.fromArray(this.getTransformValues("scale",E,O)),R=!0),E.hiddenMatrix!==void 0&&(R=!0,this.hiddenMatrix.fromArray(E.hiddenMatrix??ET.identity)),R&&(this.updateMatrix(),this.resetBBoxNeedsUpdate(),this.invalidateClonerTransform(this),this.traverseEntityAncestors((E=>{E.invalidateClonerTransform(this)}))),E.position&&E.rotation&&E.scale&&E.hiddenMatrix!==void 0&&this.updateWorldMatrix(!1,!0),R}onVariableUpdate(E=!1){E?this.resetBBoxNeedsUpdate():(this.updateMatrix(),this.resetBBoxNeedsUpdate(),this.invalidateClonerTransform(this),this.traverseEntityAncestors((E=>{E.invalidateClonerTransform(this)})))}dispose(){this.disposed=!0,this.cloner&&(this.cloner.removeFromParent(),this.cloner=void 0)}disposeChildrenRecursively(){for(let E of this.children)oL.is(E)&&E.disposeRecursively()}disposeRecursively(){this.dispose(),this.children.forEach((E=>{oL.is(E)&&E.disposeRecursively()}))}toState(E=[]){let O={name:this.name,visible:this.visible,raycastLock:this.raycastLock,...this.toObjectTransformState(E)};return uM(O,E)}updateByObjUpdateOp(E,O){E!==void 0&&this.updateByOp({type:0,props:E,path:[]},{...this.data,...E},O,!1)}updateByOp(E,O,R,z){let V=this.data;this.data=O;let j=E,Y=Vt(E.path,["states","*"]);if(Y!==null){if(E.type===0){let[O]=Y;if(this?.stateSelection===O){let O={...E.props};if(delete O.name,Object.values(E.props).some((E=>E===void 0))){let R=this.data;if(R!==void 0){let z=lE.zoom(R,E.path.slice(2));if(z)for(let R in E.props)E.props[R]===void 0&&R in z&&(O[R]=z[R])}}j={...E,props:O,path:E.path.slice(2)}}}}else if(E.type===0){let O=this.stateSelection?this.data.states.data(this.stateSelection):void 0;if(O!==void 0){if(E.props.name!==void 0&&O.name){let{name:E,...R}=O;O=R}if(E.props.material!==void 0&&"material"in O){let{material:E,...R}=O;O=R}let R=lE.removeOverridden(E.path,E.props,O);j={...E,props:R}}}if(this.updateByPatchedOpBase(j,yD.patch(this.data,this.stateSelection?this.data.states.data(this.stateSelection):void 0),R),Vt(E.path,["overrides"])){let z=[],V=[...E.path];for(z.push(V[1]),V.splice(0,2);V.length>0&&V[0]==="descendants";)z.push(V[1]),V.splice(0,2);if(z[z.length-1]===void 0){if(E.type===0)for(let O of Object.keys(E.props)){z[z.length-1]=O;let V=R.scene.findInstance([this.uuid,...z]);V&&(V.overrideData=E.props[O],V.updateState(GM.apply(V.component.data,V.overrideData),R))}}else{let j=R.scene.findInstance([this.uuid,...z]);if(j){let Y=lE.zoom(j.component.data,V);if(E={...E,path:V},E.type===0){let O=E.props;if(Y)for(let[R,z]of Object.entries(E.props))z===void 0&&(O===E.props&&(O={...E.props}),O[R]=Y[R]);E={...E,props:O}}j.overrideData=fD.resolve(O.overrides,z),j.updateByOp(E,qM.applySimple(j.data,E),R,!1)}}}else if(this.instances.length>0){let z;if(E.path.length===0&&E.type===0){let O;for(let R of mD.rootOverrideProps)R in E.props&&(O===void 0&&(O={}),O[R]=E.props[R]);O&&(z={...E,props:O})}else for(let O of mD.rootOverrideProps)if(Vt(E.path,[O])){z=E;break}z!==void 0&&this.instances.forEach((E=>{if(E.isInstanceRoot){let O=GM.filterOp(E.overrideData,z);O&&E.updateByOp(O,qM.applySimple(E.data,O),R,!0)}})),this.instances.forEach((z=>{if(!z.isInstanceRoot){let j=GM.filterOp(z.overrideData,E);if(j){let Y;Y=V===z.data&&E===j?O:qM.applySimple(z.data,j),z.updateByOp(j,Y,R,!0)}}}))}}updateByPatchedOpBase(E,O,R){if(this.dataPatched=O,E.path.length===0&&E.type===0)E.props.type!==void 0&&!$T.is(E.props.type)&&nL.changeEntityProptotype(this,O,R);else if(E.path.length===1&&E.path[0]==="geometry"&&E.type===0&&"type"in E.props){nL.changeEntityProptotype(this,O,R);for(let E of this.children)oL.is(E)&&E.updateVisible(R.scene)}this.updateByPatchedOp(E,O,R)}updateByPatchedOp(E,O,R){if(E.path.length===0&&E.type===0?this.updateState(E.props,R):E.type===0&&("resolutionLevel"in E.props||"useChildrenColors"in E.props)&&this.updateState(O,R),E.path[0]==="morphTargetInfluences"&&E.type===0){let z=O.morphTargetInfluences.get(E.path[1])?.data.name;z&&this.updateMorphInfluences(z,R.shared.getVariable(E.props.value,[this.uuid,"morphTargetInfluences",z]))}if(Vt(E.path,["pathSnapping"])!==null&&this.updatePathSnapping(O.pathSnapping),Vt(E.path,["cloner"])!==null){let z=qM.drop(E,1);z.path.length===0&&z.type===0&&z.props.disabled===!0?this.setFromClonerState(null,R):this.cloner?this.cloner.updateState(O.cloner,R.scene):(this.setFromClonerState(O.cloner,R),this.expandCloner(R.scene)),this.updateVisible(R.scene)}}updatePathSnapping(E=this.dataPatched.pathSnapping){this._updatedPathSnapping=E,this._needApplyPathSnapping=!0}get updatedPathSnapping(){return this._updatedPathSnapping}applyPathSnapping(E){let O=this._updatedPathSnapping?.pathId??this.dataPatched.pathSnapping.pathId,R=this._updatedPathSnapping?.slide??this.dataPatched.pathSnapping.slide??0,z=this._updatedPathSnapping?.offset??this.dataPatched.pathSnapping.offset??0,V=this._updatedPathSnapping?.orientation??this.dataPatched.pathSnapping.orientation;if(O===null)return;let j=E.find(O);if(!j||this._needApplyPathSnapping===!1)return;this._needApplyPathSnapping=!1;let Y=j.data;if(Y.geometry.path.points.length<=1)return;let ee=_0(Y.geometry.path),se=(R+z)%1;R+z===1&&se===0&&(se=1);let he=null;try{he=ee.curves.length?ee.getPointAt(se):null}catch(E){!1}if(he===null)return;let ce=this.parent?this.parent?.matrixWorld:new Es;j.updateMatrixWorld();let ue=(new Es).multiplyMatrices(ce.clone().invert(),j.matrixWorld);he.applyMatrix4(ue);let fe={position:he.toArray(),rotation:Y.rotation};if(V==="tangential"){let E=(new Es).extractRotation(j.matrixWorld),O=ee.getTangentAt(se).applyMatrix4(E).add(he),R=(new Es).lookAt(he,O,dL),z=cL.setFromEuler((new zs).setFromRotationMatrix(R)).multiplyScalar(xn.RAD2DEG);fe={...fe,rotation:z.toArray()}}this.updateTransformState(fe),this.traverseEntity((E=>{E._cameraType&&E.dispatchEvent(lL)}))}updateVisible(E){if(this.visible=this.dataPatched.visible&&(!this.dataPatched.cloner||(this.dataPatched.cloner.disabled??!1)||this.dataPatched.cloner?.hideBase!==!0),!E)return;let O=!1;this.traverseEntity((E=>{if(E.data.type==="Splat")return O=!0,!0})),O&&E.reloadSplats()}updateState_Entity(E,O){E.name!==void 0&&(this.name=E.name),E.raycastLock!==void 0&&(this.raycastLock=E.raycastLock),E.visible!==void 0&&(this.updateVisible(O?.scene),this.resetBBoxNeedsUpdate()),O&&"cloner"in E&&E.cloner!==void 0&&(this.setFromClonerState(E.cloner,O),this.updateVisible(O.scene)),this.updateTransformState(E,O)}get attachedSurfaceCloners(){return this.children.filter((E=>E instanceof nL.Cloner&&E.parameters.type==="toObject"))}setFromClonerState(E,O){this.disposed||(E===null||E.disabled?(this.cloner&&this.cloner.removeFromParent(),this.cloner=void 0):this.cloner===void 0?(this.cloner=new nL.Cloner(this,E),O.scene.addPendingExpandCloner(this)):this.cloner.updateState(E,O.scene))}expandCloner(E){!this.disposed&&this.cloner&&this.cloner.expandClones(E)}invalidateClonerTransform(E){this.cloner&&this.cloner.invalidateTransform(E)}requestRender(){this.dispatchEvent({type:"requestRender"})}};var uL=class{static create(E){return this.build(this.normalizeInputs(E))}static normalizeInputs(E,O){let R=E.parameters?.radiusTop,z=E.parameters?.radiusBottom,V=Object.assign({},O?.parameters??{width:100,radialSegments:64,heightSegments:1,openEnded:!1,thetaStart:0,thetaLength:360,cornerRadius:8,cornerSegments:8,hollow:0},E.parameters);V.thetaLength=xn.clamp(V.thetaLength,0,360);let j=V.width/2,Y=V.radiusTop??j,ee=V.radiusBottom??j;if(Y===ee?(Y=j,ee=j):Y>ee?(Y=j,ee=ee*j/Y):(Y=Y*j/ee,ee=j),V.shapeBlendNode){Y=R??j,ee=z??j;let E=Math.max(Y,ee)*2;V.width=E,V.depth=E}return{parameters:Object.assign(V,{width:Math.abs(V.width),height:Math.abs(V.height??V.width),depth:Math.abs(V.depth??V.width),radiusTop:Y,radiusBottom:ee})}}static build(E){let O,{width:R,depth:z,height:V,radialSegments:j,heightSegments:Y,openEnded:ee,thetaStart:se,thetaLength:he,radiusTop:ce,radiusBottom:ue,cornerRadius:fe,cornerSegments:ve,hollow:we}=E.parameters;return he===0?(O=new Na,O.setAttribute("position",new Ma([],3))):O=fe||we?new pL(ce,ue,V,j,Y,ee,se,he*Math.PI/180,fe,fe,ve,we):new Wu(ce,ue,V,j,Y,ee,se,he*Math.PI/180),O.scale(1,1,z/R),Object.assign(O,{userData:{...E,type:"CylinderGeometry"}})}};function Vl(E,O,R){R.x=E.x*O.x,R.y=E.y,R.z=E.x*O.y}function xO(E){return new bn(E.y,-E.x)}var pL=class extends Na{constructor(E,O,R,z,V,j,Y,ee,se,he,ce,ue,fe=!1){super(),this.type="RoundedCylinderBufferGeometry",E=E!==void 0?E:1,O=O!==void 0?O:1,R=R||1,z=Math.floor(z)||8,V=Math.floor(V)||1,j=j!==void 0&&j,Y=Y!==void 0?Y:0,ee=ee!==void 0?ee:Math.PI*2,j&&(se=0,he=0);let ve=[],we=[],Se=[],_e=[],Ae=0,Ce=R/2,Te=new Wn,Ie=new Wn;fe&&E==0&&(E=se),fe&&O==0&&(O=he);let Fe=new bn(E,Ce),Ue=new bn(O,-Ce),Ge=null,qe=null,Xe=null,Qe=null,Ze=Fe.clone().sub(Ue),Ke=0,Je=0,$e=0;ue>0&&(Ke=Math.min(E,O)*(1-ue),Je=E-Ke,$e=O-Ke);let et=Fe.clone();et.x-=Ke;let it=Math.PI-Ze.angle(),rt=Ze.angle(),at=Math.tan(rt/2),lt=Math.tan(it/2),ct=at+lt,dt=ue?ct:lt,ut=ue?ct:at;if(se=Math.min(se,(E-Je)/dt,Ze.length()/ct),he=Math.min(he,(O-$e)/ut,Ze.length()/ct),se>0){let E=se/at;Ge=Fe.clone().sub(new bn(E,se)),ue&&(Xe=Ge.clone(),Xe.x-=Ke-ct*se),Fe.sub(Ze.clone().setLength(E))}if(he>0){let E=he/lt;qe=Ue.clone().sub(new bn(E,-he)),Ue.add(Ze.clone().setLength(E)),ue&&(Qe=qe.clone(),Qe.x-=Ke-ct*he,et.sub(Ze.clone().setLength(E)))}Ze=Fe.clone().sub(Ue);let pt=Ze.length()<.5,mt=[];for(let ce=0;ce<=z;ce++){let fe=[],ve=ce/z,Ce=ve*ee+Y,Fe=new bn(Math.sin(Ce),Math.cos(Ce));Qe&&qe?(W(fe,ve,Fe,it,he,Qe,-1,!0),W(fe,ve,Fe,rt,he,qe,-1,!1)):qe?(oe(fe,Fe,qe.x,0,-1),W(fe,ve,Fe,rt,he,qe,-1,!1)):j||oe(fe,Fe,O,$e,-1);let Ke=xO(Ze).normalize();if(Vl(Ke,Fe,Te),!pt)for(let E=0;E<=V;E++){let O=E/V,z=Ze.clone().multiplyScalar(O).add(Ue);Vl(z,Fe,Ie),we.push(Ie.x,Ie.y,Ie.z),Se.push(Te.x,Te.y,Te.z),_e.push(ve,.5+Ie.y/R),fe.push(Ae++)}if(Xe&&Ge?(W(fe,ve,Fe,it,se,Ge,1,!1),W(fe,ve,Fe,rt,se,Xe,1,!0)):Ge?(W(fe,ve,Fe,it,se,Ge,1,!1),oe(fe,Fe,Ge.x,0,1)):j||oe(fe,Fe,E,Je,1),ue&&!pt){let E=xO(Ze).multiplyScalar(-1).normalize();Vl(E,Fe,Te);for(let E=0;E<=V;E++){let O=E/V,z=Ze.clone().multiplyScalar(-O).add(et);Vl(z,Fe,Ie),we.push(Ie.x,Ie.y,Ie.z),Se.push(Te.x,Te.y,Te.z),_e.push(ve,.5+Ie.y/R),fe.push(Ae++)}}ue&&!j&&fe.push(fe[0]),mt.push(fe)}for(let E=0;E<mt.length-1;E++)for(let O=0;O<mt[0].length-1;O++){if(j&&ue&&O==V)continue;let R=mt[E][O],z=mt[E+1][O],Y=mt[E+1][O+1],ee=mt[E][O+1],se=we[Y*3+0],he=we[Y*3+2];ve.push(R,z,ee),(se!=0||he!=0)&&ve.push(z,Y,ee)}ee<Math.PI*2&&(ie(-1,mt[0],Y),ie(1,mt[mt.length-1],Y+ee)),this.setIndex(ve),this.setAttribute("position",new Ma(we,3)),this.setAttribute("normal",new Ma(Se,3)),this.setAttribute("uv",new Ma(_e,2));function W(E,O,z,V,j,Y,ee,se){for(let he=0;he<ce+1;he++){let ue=he/ce,fe=ee<0?ue:1-ue;se&&(fe-=1),fe*=V;let ve=new bn(Math.sin(fe),Math.cos(fe)*ee),Ce=ve.clone().multiplyScalar(j).add(Y);Vl(Ce,z,Ie),we.push(Ie.x,Ie.y,Ie.z),Vl(ve,z,Te),Se.push(Te.x,Te.y,Te.z),_e.push(O,.5+Ie.y/R),E.push(Ae++)}}function oe(E,O,R,z,V){let j=new Wn,Y=new bn,ee=[R,z];V<0&&ee.reverse();for(let R of ee)Y.set(R,Ce*V),Vl(Y,O,j),we.push(j.x,j.y,j.z),Se.push(0,V,0),_e.push(.5,.5),E.push(Ae++)}function ie(R,z,V){let j=new bn(Math.sin(V),Math.cos(V)),Y=new bn(-Math.cos(V),Math.sin(V)),ee=new Wn,se=R<0?(E,O,R)=>ve.push(E,O,R):(E,O,R)=>ve.push(E,R,O),he=new bn((E+O+Je+$e)/4,0);Vl(he,j,ee),we.push(ee.x,ee.y,ee.z),Se.push(Y.x,0,Y.y),_e.push(.5,.5);let ce=Ae++;for(let E of z){let O=we.slice(E*3,E*3+3);we.push(...O),Se.push(Y.x,0,Y.y);let R=_e.slice(E*2,E*2+2);_e.push(...R),Ae++}for(let E=ce+1;E<Ae-1;E++)se(ce,E,E+1);se(ce,Ae-1,ce+1)}}};var fL=class{static create(E){return this.build(this.normalizeInputs(E))}static normalizeInputs(E,O){let R=Object.assign({},O?.parameters??{width:100,radialSegments:32,heightSegments:8,openEnded:!1,thetaStart:0,thetaLength:360,cornerRadiusTop:8,cornerRadiusBottom:8,cornerSegments:8},E.parameters);return R.thetaLength=xn.clamp(R.thetaLength,0,360),{parameters:Object.assign(R,{width:Math.abs(R.width),height:Math.abs(R.height??R.width),depth:Math.abs(R.depth??R.width)})}}static build(E){let O,{width:R,depth:z,height:V,radialSegments:j,heightSegments:Y,openEnded:ee,thetaStart:se,thetaLength:he,cornerRadiusTop:ce,cornerRadiusBottom:ue,cornerSegments:fe}=E.parameters;return he===0?(O=new Na,O.setAttribute("position",new Ma([],3))):O=ce>0||ue>0||he<360?new pL(0,R/2,V,j,Y,ee,se,he*Math.PI/180,ce,ue,fe,0,!0):new qu(R/2,V,j,Y,ee),O.scale(1,1,z/R),Object.assign(O,{userData:{...E,type:"ConeGeometry"}})}};var mL=class{static create(E){return this.build(this.normalizeInputs(E))}static normalizeInputs(E,O){let R=Object.assign({},O?.parameters??{width:100,widthSegments:1,heightSegments:1,depthSegments:1,cornerRadius:8,cornerSegments:8},E.parameters);return{parameters:Object.assign(R,{width:Math.abs(R.width),height:Math.abs(R.height??R.width),depth:Math.abs(R.depth??R.width)})}}static build(E){let O,{width:R,height:z,depth:V,widthSegments:j,heightSegments:Y,depthSegments:ee,cornerRadius:se,cornerSegments:he}=E.parameters;return O=se===0?new to(R,z,V,j,Y,ee):new vL(R,z,V,j,Y,ee,se,he),Object.assign(O,{userData:{...E,type:"CubeGeometry"}})}},gL=Math.PI/2,vL=class extends Na{constructor(E=1,O=1,R=1,z=1,V=1,j=1,Y=0,ee=4){super(),this.type="BoxGeometry",z=Math.floor(z),V=Math.floor(V),j=Math.floor(j),ee=Math.floor(ee),Y=Math.min(Y,E/2,O/2,R/2);let se=[],he=[],ce=[],ue=[],fe=0;p("z","y","x",-1,-1,R,O,E,j,V),p("z","y","x",1,-1,R,O,-E,j,V),p("x","z","y",1,1,E,R,O,z,j),p("x","z","y",1,-1,E,R,-O,z,j),p("x","y","z",1,-1,E,O,R,z,V),p("x","y","z",-1,-1,E,O,-R,z,V),Y>0&&(m("z","y","x",-1,-1,1,R,O,E,j),m("z","y","x",1,-1,-1,R,O,E,j),m("z","y","x",-1,1,-1,R,O,E,j),m("z","y","x",1,1,1,R,O,E,j),m("x","y","z",-1,-1,-1,E,O,R,z),m("x","y","z",1,-1,1,E,O,R,z),m("x","y","z",-1,1,1,E,O,R,z),m("x","y","z",1,1,-1,E,O,R,z),m("y","x","z",-1,-1,1,O,E,R,V),m("y","x","z",1,-1,-1,O,E,R,V),m("y","x","z",1,1,1,O,E,R,V),m("y","x","z",-1,1,-1,O,E,R,V),g(1,1,1),g(-1,1,1),g(1,-1,1),g(-1,-1,1),g(1,1,-1),g(-1,1,-1),g(1,-1,-1),g(-1,-1,-1)),this.setIndex(se),this.setAttribute("position",new Ma(he,3)),this.setAttribute("normal",new Ma(ce,3)),this.setAttribute("uv",new Ma(ue,2));function p(E,O,R,z,V,j,ee,ve,we,Se){let _e=(j-2*Y)/we,Ae=(ee-2*Y)/Se,Ce=j/2-Y,Te=ee/2-Y,Ie=ve/2,Fe=we+1,Ue=Se+1,Ge=0,qe=new Wn;for(let j=0;j<Ue;j++){let Y=j*Ae-Te;for(let ee=0;ee<Fe;ee++){let se=ee*_e-Ce;qe[E]=se*z,qe[O]=Y*V,qe[R]=Ie,he.push(qe.x,qe.y,qe.z),qe[E]=0,qe[O]=0,qe[R]=ve>0?1:-1,ce.push(qe.x,qe.y,qe.z),ue.push(ee/we),ue.push(1-j/Se),Ge+=1}}for(let E=0;E<Se;E++)for(let O=0;O<we;O++){let R=fe+O+Fe*E,z=fe+O+Fe*(E+1),V=fe+(O+1)+Fe*(E+1),j=fe+(O+1)+Fe*E;se.push(R,z,j),se.push(z,V,j)}fe+=Ge}function m(E,O,R,z,V,j,ve,we,Se,_e){let Ae=(ve-2*Y)/_e,Ce=ve/2-Y,Te=we/2-Y,Ie=Se/2,Fe=_e+1,Ue=0,Ge=new Wn,qe=new Wn;for(let se=0;se<ee+1;se++){let fe=se/ee*gL,ve=Math.sin(fe)*Y,we=(1-Math.cos(fe))*Y,Se=Math.sin(fe),Xe=Math.cos(fe);Ge[O]=(Te+ve)*V,Ge[R]=(Ie-we)*j,qe[E]=0,qe[O]=Se*Math.sign(Ge[O]),qe[R]=Xe*Math.sign(Ge[R]);for(let O=0;O<Fe;O++){let R=O*Ae-Ce;Ge[E]=R*z,he.push(Ge.x,Ge.y,Ge.z),ce.push(qe.x,qe.y,qe.z),ue.push(O/_e),ue.push(0),Ue+=1}}for(let E=0;E<ee;E++)for(let O=0;O<_e;O++){let R=fe+O+Fe*E,z=fe+O+Fe*(E+1),V=fe+(O+1)+Fe*(E+1),j=fe+(O+1)+Fe*E;se.push(R,z,j),se.push(z,V,j)}fe+=Ue}function g(z,V,j){let ve=new Wn,we=new Wn(E/2,O/2,R/2);we.subScalar(Y);let Se=[],_e=z*V*j>0?(E,O,R)=>se.push(E,O,R):(E,O,R)=>se.push(E,R,O);for(let E=0;E<=ee;E++){let O=[],R=gL*(1-E/ee),se=Math.cos(R),_e=Math.sin(R),Ae=0;for(let R=0;R<=E;R++){let R=Math.cos(Ae),ee=Math.sin(Ae);ve.x=se*R,ve.y=_e,ve.z=se*ee;let Se=we.clone().addScaledVector(ve,Y);he.push(z*Se.x,V*Se.y,j*Se.z),ce.push(z*ve.x,V*ve.y,j*ve.z),ue.push(0,0),O.push(fe++),Ae+=gL/E}Se.push(O)}let Ae=Se.length-1;for(let E=0;E<Ae;E++){let O=Se[E],R=Se[E+1],z=O.length-1;_e(O[0],R[1],R[0]);for(let E=1;E<=z;E++)_e(O[E-1],O[E],R[E]),_e(O[E],R[E+1],R[E])}}}};var bL=class extends Na{constructor(E=[],O=[],R="",z=1,V=.2,j=4){super(),this.type="PolyhedronGeometryRound";let Y=[],ee=[],se=[];u(),h(),this.setAttribute("position",new Ma(Y,3)),this.setAttribute("normal",new Ma(se,3)),this.setAttribute("uv",new Ma(ee,2));return;function u(){V=Math.min(.99999,V),V==0&&(j=0);let ee={IcosahedronGeometry:5,DodecahedronGeometry:3,HexahedronGeometry:3,OctahedronGeometry:4,TetrahedronGeometry:3}[R],he=new Wn,ce=he.clone(),ue=new ga,fe=V*z,ve=z-fe,we=j+1,Se=new Wn,w=(E,O)=>Se.subVectors(E,O).normalize(),A=(E,O)=>Array(E).fill(void 0).map(O),_e=A(E.length/3,((O,R)=>(new Wn).fromArray(E,R*3).setLength(z))),Ae=[],Ce=1e6;for(let E=0;E<_e.length;E++){let R,z,V,j=_e[E],Y=[],ee=1e10,se=-1;for(;(se=O.indexOf(E,se+1))!=-1;){let E=se-se%3;R=O[E+(se+1)%3],z=O[E+(se+2)%3],V=j.distanceToSquared(_e[R]),ee=Math.min(ee,V),Y.push([R,z,V])}ee+=1e-6;let he=[],ce=0,ue=Y.length;for(let O=0;O<ue;O++){[R,z,V]=Y[ce];let O=Ae[R]?.includes(E)==!0;V<=ee&&he.push(R+ +O*Ce),ce=Y.findIndex((E=>E[0]==z))}Ae.push(he)}let Te=[];{let E,O,R=0,z=0,V=ee==3;for(let Y=0;Y<=j;Y++){E=Y*(Y+1)/2,O=(Y+1)*(Y+2)/2;for(let ee=0;ee<j-Y;ee++)[R,z]=[E+ee+Y+2,O+ee+Y+3],Te.push(E,O,...V?[z,E]:[R,O],z,R),[E,O]=[R,z];Te.push(E,O,E+j+2)}}let Ie=he.clone(),Fe=he.clone(),Ue=he.clone(),Ge=he.clone(),qe=he.clone(),Xe=[],Qe=A(_e.length,(()=>A(ee,(()=>he.clone()))));for(let E=0;E<_e.length;E++){he.copy(_e[E]).normalize(),Ie.copy(he).multiplyScalar(ve);let O=Ae[E];for(let R=0;R<O.length;R++){let z=O[R],V=O[(R+1)%ee];ue.setFromPointsAndIndices(_e,E,z%Ce,V%Ce),ue.b.sub(ue.a).setLength(1e10).add(ue.a),ue.c.sub(ue.a).setLength(1e10).add(ue.a),ue.closestPointToPoint(Ie,Qe[E][R])}let R=[],z=[],V=[],Ze=new Wn;j==0&&[...Qe[E]].reduce(((E,O)=>E.add(O)),Ze).multiplyScalar(1/ee);for(let O=0;O<ee;O++){let Y=[],se=(O-1+ee)%ee,ue=Qe[E][se],_e=Qe[E][O];he.copy(ue).sub(Ie),ce.copy(_e).sub(Ie);let Ae=Ie.angleTo(he),Ce=he.angleTo(ce),Te=Math.cos(Ae)*fe;j==0?Fe.copy(Ze):Fe.copy(Ie).setLength(ve+Te),z.push(Te);let Xe=[Fe,ue,_e];for(let E=0;E<2;E++){let O=Xe[E],z=Xe[E+1];Ge.subVectors(O,Ie),qe.subVectors(z,Ie),Ue.crossVectors(Ge,qe).normalize();for(let z=0;z<we;z++){let V=[Ae,Ce][E]*z/we;he.copy(Ge).applyAxisAngle(Ue,V).add(Ie),R.push(he.clone()),E&&(w(he,Ie),Y.push([z==0?O:he.clone(),Se.clone()]))}E&&(w(z,Ie),Y.push([z,Se.clone()]))}V.push(Y)}Xe.push(V);let Ke=2*we,Je=2;for(let E=0;E<ee;E++){let O=Ke*E,V=Ke*((E+1)%ee),j=[R[O]];for(let Y=1;Y<we;Y++){Ge=R[O+Y],qe=R[V+Y],j.push(Ge);for(let O=1,R=Y-Je+1;O<=R;O++)he.lerpVectors(Ge,qe,O/(R+1)),he.sub(Ie).setLength(z[E]).add(Ie),j.push(he.clone());j.push(qe)}for(let E=0;E<we;E++)j.push(R[E+we+O]);j.push(R[V+we]);let ce=Te.map((E=>j[E]));Y.push(...ce.map((E=>[E.x,E.y,E.z])).flat()),se.push(...ce.map((E=>(w(E,Ie),[Se.x,Se.y,Se.z]))).flat())}}let Ze=[];for(let E=0;E<Ae.length;E++)for(let O=0;O<ee;O++){let R=Ae[E][O];if(R<Ce){let z=Ae[R].findIndex((O=>O%Ce==E)),V=Xe[E][O],j=Xe[R][z];for(let E=0;E<we;E++){let O=V[E],R=j[we-E],z=V[E+1],ee=j[we-(E+1)];[O,R,z,z,R,ee].forEach((E=>{Y.push(E[0].x,E[0].y,E[0].z),se.push(E[1].x,E[1].y,E[1].z)}))}Ze.push(V[0][0],j[we][0],V[we][0],j[0][0])}}for(;Ze.length;){let E,O,R,z;[E,O]=Ze.splice(0,2);let V=[E];for(;E!=O;)V.push(O),R=Ze.indexOf(O),z=R%2,O=Ze.splice(R-z,2)[1-z];Se.subVectors(V[0],V[1]).cross(he.subVectors(V[0],V[2])).normalize();let j=Se.dot(V[0])<0;j&&Se.negate();for(let E=1;E<=V.length-2;E++)[V[E+ +j],V[E+1-+j],V[0]].forEach((E=>{Y.push(E.x,E.y,E.z),se.push(Se.x,Se.y,Se.z)}))}}function h(){let E=new Wn;for(let O=0;O<Y.length;O+=3){E.x=Y[O+0],E.y=Y[O+1],E.z=Y[O+2];let R=w(E)/2/Math.PI+.5,z=A(E)/Math.PI+.5;ee.push(R,1-z)}let O=new Wn,R=new Wn,z=new Wn,V=new Wn,j=new bn,se=new bn,he=new bn,S=(E,O,R,z)=>{z<0&&E.x===1&&(ee[O]=E.x-1),R.x===0&&R.z===0&&(ee[O]=z/2/Math.PI+.5)};for(let E=0,ce=0;E<Y.length;E+=9,ce+=6){O.set(Y[E+0],Y[E+1],Y[E+2]),R.set(Y[E+3],Y[E+4],Y[E+5]),z.set(Y[E+6],Y[E+7],Y[E+8]),j.set(ee[ce+0],ee[ce+1]),se.set(ee[ce+2],ee[ce+3]),he.set(ee[ce+4],ee[ce+5]),V.copy(O).add(R).add(z).divideScalar(3);let ue=w(V);S(j,ce+0,O,ue),S(se,ce+2,R,ue),S(he,ce+4,z,ue)}for(let E=0;E<ee.length;E+=6){let O=ee[E+0],R=ee[E+2],z=ee[E+4],V=Math.max(O,R,z),j=Math.min(O,R,z);V>.9&&j<.1&&(O<.2&&(ee[E+0]+=1),R<.2&&(ee[E+2]+=1),z<.2&&(ee[E+4]+=1))}function w(E){return Math.atan2(E.z,-E.x)}function A(E){return Math.atan2(-E.y,Math.sqrt(E.x*E.x+E.z*E.z))}}}static fromJSON(E){return new bL(E.vertices,E.indices,E.radius,E.corner,E.cornerSides)}};var SL=class{static create(E){return this.build(this.normalizeInputs(E))}static normalizeInputs(E,O){let R=Object.assign({},O?.parameters??{width:100,detail:0,corner:0,cornerSides:4},E.parameters);return{parameters:Object.assign(R,{width:Math.abs(R.width),height:Math.abs(R.height??R.width),depth:Math.abs(R.depth??R.width)})}}static build(E){let{width:O,height:R,depth:z,detail:V,corner:j,cornerSides:Y}=E.parameters,ee=V===0&&j!==0?new AL(O*.5,j,Y):new Yu(O*.5,V);return ee.scale(1,R/O,z/O),Object.assign(ee,{userData:{...E,type:"DodecahedronGeometry"}})}},AL=class extends bL{constructor(E=1,O=.2,R=4){let z=(1+Math.sqrt(5))/2,V=1/z,j=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-V,-z,0,-V,z,0,V,-z,0,V,z,-V,-z,0,-V,z,0,V,-z,0,V,z,0,-z,0,-V,z,0,-V,-z,0,V,z,0,V],Y=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],ee="DodecahedronGeometry";super(j,Y,ee,E,O,R),this.type=ee}static fromJSON(E){return new AL(E.radius,E.corner,E.cornerSides)}};var EL=1e-12,TL=class{constructor(E){this.position=new bn;this.startPosition=new bn;this.uuid=xn.generateUUID();this.position=E.clone()}start(){this.reset()}reset(){this.startPosition.copy(this.position)}applyOffset(E){this.position.copy(this.startPosition).add(E)}copy(E){return this.position.copy(E.position),this.startPosition.copy(E.startPosition),this}clone(){return new TL(this.position).copy(this)}toJSON(){return[this.position.x,this.position.y]}},OL=class extends TL{constructor(E){super(E.position);this.parent=E}copy(E){return super.copy(E),this}clone(){return new OL(this.parent).copy(this)}},RL=class extends TL{constructor(E,O){super(O);this.controls=[];this.roundness=0;this.areControlsDirectionsMirrored=!0;this.uuid=E,this.controls.push(new OL(this),new OL(this))}static create(E,O){let R=new RL(E,new bn(...O.position));return R.controls[0].position.set(...O.controlPrevious.position),R.controls[1].position.set(...O.controlNext.position),R.roundness=O.roundness,R.areControlsDirectionsMirrored=O.areControlsDirectionsMirrored,R}getOppositeControl(E){let O=this.controls.indexOf(E);return O===0?this.controls[1]:O===1?this.controls[0]:null}applyOffsetToControls(E,O=1){for(let R=0,z=this.controls.length;R<z;R++){let z=this.controls[R];this.position.distanceTo(z.position)<=O?z.position.copy(this.position):z.applyOffset(E)}}controlsMoved(){return!(this.position.equals(this.controls[0].position)&&this.position.equals(this.controls[1].position))}copy(E){return super.copy(E),this.controls[0].copy(E.controls[0]),this.controls[1].copy(E.controls[1]),this.roundness=E.roundness,this.uuid=E.uuid,this}clone(){return new RL(this.uuid,this.position).copy(this)}toJSON(){return super.toJSON().concat(this.controls[0].toJSON(),this.controls[1].toJSON(),[this.roundness])}computeTangents(){let E=this.curveBefore?.getTangentAt(1),O=this.curveAfter?.getTangentAt(0);return[E,O]}computeNormals(E=new bn,O=new bn){let[R,z]=this.computeTangents();return R&&z&&(AO(R,E),AO(z,O)),[E,O]}computeTangent(E=new bn){let[O,R]=this.computeTangents();return O&&R&&E.copy(O).add(R).normalize(),E}computeNormal(E=new bn){let[O,R]=this.computeNormals();return E.copy(O).add(R).normalize(),E}};function AO(E,O=new bn){let R=E.length();return O.set(-E.y/R,E.x/R)}var LA=E=>E,LL=new bn,BL=new bn,zL=new bn,FL=new bn,UL=new bn,kL=new bn,GL=new Wn,qL=new Wn;function CO(E){let O=new bn;O.addVectors(E.v0,LL.subVectors(E.v1,E.v0).multiplyScalar(2/3));let R=new bn;return R.addVectors(E.v2,BL.subVectors(E.v1,E.v2).multiplyScalar(2/3)),new Ou(E.v0,O,R,E.v2)}function fm(E,O,R=Number.EPSILON){return Math.abs(E-O)<R}function H7(E,O,R=Number.EPSILON){return E.distanceTo(O)<R}function W7(E,O,R=Number.EPSILON){return E.distanceTo(O)<R}function BA(E,O,R){let z=Math.sqrt(Math.pow(O.x-E.x,2)+Math.pow(O.y-E.y,2)),V=Math.sqrt(Math.pow(O.x-R.x,2)+Math.pow(O.y-R.y,2)),j=Math.sqrt(Math.pow(R.x-E.x,2)+Math.pow(R.y-E.y,2));return Math.acos((V*V+z*z-j*j)/(2*V*z))}function PO(E,O,R){return EO(E,O)&&EO(O,R)&&RA(E.position,O.position,R.position)}function RA(E,O,R){return LL.copy(O).sub(E).cross(BL.copy(R).sub(E))===0}function _O(E,O,R,z,V){let j=Math.sqrt(Math.pow(O.x-E.x,2)+Math.pow(O.y-E.y,2)),Y=(E.y+O.y)/2,ee=(E.x+O.x)/2,se=Math.sqrt(Math.pow(R,2)-Math.pow(j/2,2))*(E.y-O.y)/j,he=Math.sqrt(Math.pow(R,2)-Math.pow(j/2,2))*(O.x-E.x)/j;return z.set(ee+se,Y+he),V.set(ee-se,Y-he),[z,V]}function IO(E,O,R){let z=E.distanceTo(R),V=O.distanceTo(R);return z<V?O:E}function DO(E,O,R,z,V,j){let Y,ee=O.x-E.x,se=O.y-E.y,he=R.x-E.x,ce=R.y-E.y,ue=Math.sqrt((ee+he)*(ee+he)+(se+ce)*(se+ce));return BA(O,E,R)>Math.PI&&(ue*=-1),Y=fm(ce,se)?(se+ce)*(z/ue-.5)*8/3/(ee-he):(ee+he)*(z/ue-.5)*8/3/(ce-se),V.set(O.x-Y*se,O.y+Y*ee),j.set(R.x+Y*ce,R.y-Y*he),[V,j]}function NA(E,O){return E.position.equals(E.controls[1].position)&&O.position.equals(O.controls[0].position)}function EO(E,O){return RA(E.position,E.controls[1].position,O.position)&&RA(E.position,O.controls[0].position,O.position)}function OO(E,O,R,z,V=.5){let j=LL.subVectors(O,E).multiplyScalar(V).add(E),Y=BL.subVectors(R,O).multiplyScalar(V).add(O),ee=zL.subVectors(z,R).multiplyScalar(V).add(R),se=j,he=FL.subVectors(Y,j).multiplyScalar(V).add(j),ce=UL.subVectors(ee,Y).multiplyScalar(V).add(Y),ue=ee,fe=kL.subVectors(ce,he).multiplyScalar(V).add(he);return[E.x,E.y,se.x,se.y,he.x,he.y,fe.x,fe.y,ce.x,ce.y,ue.x,ue.y,z.x,z.y]}function RO(E,O,R=12,z=!0){let V,j=qL.set(0,0,0),Y=0,ee=[];for(let z=0;z<O.length;z++){let se=LA(O[z]),he=LL,ce=zl(se,R);ee.push(ce);for(let O=0;O<=ce;O++)if(se instanceof Ou||se instanceof zu||se instanceof Lu){if(se.getPoint(O/ce,he),j.set(he.x,he.y,0),V!==void 0&&W7(V,j))continue;V===void 0&&(V=GL),V.copy(j),E.setXYZ(Y,j.x,j.y,j.z),Y++}}return z&&Y>1&&!(E.getX(Y-1)===E.getX(0)&&E.getY(Y-1)===E.getY(0)&&E.getZ(Y-1)===E.getZ(0))&&(E.setXYZ(Y,E.getX(0),E.getY(0),E.getZ(0)),Y++),E}function LO(E,O,R,z=12,V=!0){let j=qL.set(0,0,0),Y=0,ee=[];for(let V=0;V<O.length;V++){if(R[V]===!1)continue;let se,he=LA(O[V]),ce=LL,ue=zl(he,z);ee.push(ue);for(let O=0;O<=ue;O++)if(he instanceof Ou||he instanceof zu||he instanceof Lu){if(he.getPoint(O/ue,ce),j.set(ce.x,ce.y,0),se?.equals(j))continue;se===void 0?se=GL:(E.setXYZ(Y,se.x,se.y,se.z),Y++,E.setXYZ(Y,j.x,j.y,j.z),Y++),se.copy(j)}}return V&&Y>1&&!(E.getX(Y-1)===E.getX(0)&&E.getY(Y-1)===E.getY(0)&&E.getZ(Y-1)===E.getZ(0))&&(E.setXYZ(Y,E.getX(0),E.getY(0),E.getZ(0)),Y++),ee}function FA(E,O=12,R=!1){let z=[];for(let V=0,j=E.length;V<j;V++){let j=E[V],Y=0;if(R&&j.roundedCurveCorner!==void 0){let E=zl(j.roundedCurveCorner,O)*.5;V>0&&(z[V-1]+=E),Y+=E}j.curveAfter!==void 0&&(Y+=zl(j.curveAfter,O)),z.push(Y)}return E.length>0&&R&&E[0].roundedCurveCorner!==void 0&&(z[E.length-1]+=zl(E[0].roundedCurveCorner,O)*.5),z}function zl(E,O=12){return E&&E instanceof Mu?O*2:E&&(E instanceof Lu||E instanceof Bu)?1:E&&E instanceof Nu?O*E.points.length:O}function BO(E,O,R=12,z=!0){let V,j=0;for(let z=0;z<O.length;z++){let Y=LA(O[z]),ee=zl(Y,R),se=LL;for(let O=0;O<=ee;O++)if(Y instanceof Ou||Y instanceof zu||Y instanceof Lu){if(Y.getPoint(O/ee,se),V!==void 0&&H7(V,se,EL))continue;V===void 0&&(V=BL),V.copy(se),E.push(se.x,se.y),j++}}return fm(E[0],E[E.length-2],EL)&&fm(E[1],E[E.length-1],EL)&&(E.pop(),E.pop()),z&&j>1&&!(fm(E[j-1],E[1],EL)&&fm(E[j-2],E[0],EL))&&(E.push(E[0],E[1]),j++),E}var tB=new bn,iB=new bn,rB=new bn,nB=new bn,sB=new bn,aB=new bn,oB=class extends Qu{constructor(E=100,O=100){super();this.points=[];this.shapeHoles=[];this.plane=new _o(new Wn(0,0,-1));this.subdivision=0;this.controlSnapDistance=4;this.pointIDs=0;this.isMesh2D=!1;this.isText=!1;this._roundness=0;this.isClosed=!1;this.useCubicForRoundedCorners=!0;this.uuid=xn.generateUUID();this.needsUpdate=!1;this.roundedCurves=[];this._width=E,this._height=O}static createFromState(E,O,R){let z=new oB;return z.isClosed=E.isClosed,z.points=E.points.map((E=>RL.create(E.id,E.data))),typeof E.roundness=="number"&&(z.roundness=E.roundness),z.shapeHoles=E.shapeHoles.map((E=>oB.createFromState(E))),O!==void 0&&R!==void 0&&z.applySize(O,R),z.update(),z}get width(){return this._width}get height(){return this._height}get roundness(){return this._roundness}set roundness(E){if(this._roundness!==E){this._roundness=E;for(let O=0,R=this.points.length;O<R;O++)this.points[O].roundness=E;this.needsUpdate=!0}}getPointsIndexesByIds(E){return E.map((E=>this.getPointIndexById(E))).filter((E=>E>=0))}getPointIndexById(E){let O=this.points.length,R=this.points.findIndex((O=>O.uuid===E));if(R<0){let R=O;for(let O=0,z=this.shapeHoles.length;O<z;O++){let z=this.shapeHoles[O],V=z.points.length,j=z.getPointIndexById(E);if(!(j<0))return j+R;R+=V}}return R}getLineIndexById(E){return this.getPointIndexById(E)}getBezierPoint(E){if(E<=this.points.length-1)return this.points[E];if(this.shapeHoles.length>0){let O=this.points.length;for(let R=0,z=this.shapeHoles.length;R<z;R++){let z=this.shapeHoles[R],V=E-O;if(V<=z.points.length-1)return z.points[V];O+=z.points.length}}throw new Error("This shape does not have a point for this index: "+E)}getBezierPointIndex(E){let O=this.points.indexOf(E);if(O>=0)return O;if(O=this.points.length,this.shapeHoles.length>0)for(let R=0,z=this.shapeHoles.length;R<z;R++){let z=this.shapeHoles[R],V=z.points.indexOf(E);if(V>=0)return O+V;O+=z.points.length}return-1}getAllPoints(){let E=[].concat(...this.shapeHoles.map((E=>E.points)));return[...this.points,...E]}applySize(E,O){E===0&&(E=.001),O===0&&(O=.001),this._width=E,this._height=O}applyScale(E,O){let R=tB.set(E,O);for(let E=0,O=this.points.length;E<O;E++){let O=this.points[E];O.position.multiply(R),O.controls[0].position.multiply(R),O.controls[1].position.multiply(R)}for(let R=0,z=this.shapeHoles.length;R<z;R++)this.shapeHoles[R].applyScale(E,O);this._update()}createPoint(E,O=0,R=xn.generateUUID()){let z;z=E instanceof bn?E:new bn(E,O);let V=new RL(R,z);return V.roundness=this.roundness,V}addPoint(E){this.points.push(E),this.needsUpdate=!0}addPointAt(E,O){this.points.splice(O,0,E),this.needsUpdate=!0}getPointByUuid(E){for(let O=0,R=this.points.length;O<R;O++){let R=this.points[O];if(R.uuid===E)return R}for(let O=0,R=this.shapeHoles.length;O<R;O++){let R=this.shapeHoles[O].getPointByUuid(E);if(R)return R}}getFirstPoint(){return this.points[0]}getLastPoint(){return this.points[this.points.length-1]}removePoint(E){let O=this.points.indexOf(E);O>=0&&this.points.splice(O,1),this.needsUpdate=!0}removePointById(E){let O=this.points.find((O=>O.uuid===E));O&&this.removePoint(O)}update(){for(let E=0,O=this.shapeHoles.length;E<O;E++)this.shapeHoles[E].update();this._update()}extractShapePointsToBuffer(E,O=12,R=!1){this.subdivision=O,this.curveDivisions===void 0&&this.computeCurveDivisions(O);let z=R?this.roundedCurveDivisions:this.curveDivisions;return RO(E,R?this.roundedCurves:this.curves,O,this.autoClose),z.reduce(((E,O)=>E+O),0)+1}computeCurveDivisions(E=12){return this.curveDivisions=FA(this.points,E,!1),this.roundedCurveDivisions=FA(this.points,E,!0),this.curveDivisions}extractFilteredShapePointsToBuffer(E,O,R=12){return LO(E,this.curves,O,R,this.autoClose).reduce(((E,O)=>E+O),0)*2}extractShapePointsToFlatArray(E,O=12){return this.subdivision=O,this.curveDivisions===void 0&&this.computeCurveDivisions(O),BO(E,this.roundedCurves,O,this.autoClose)}getCurveIndexFromVertexId(E,O=!1){let R=0;this.curveDivisions===void 0&&this.computeCurveDivisions(this.subdivision);let z=O?this.roundedCurveDivisions:this.curveDivisions,V=0;O&&this.points[0].roundedCurveCorner!==void 0&&(V=zl(this.points[0].roundedCurveCorner,this.subdivision)*.5);let j=E-V;j<0&&(j+=z.reduce(((E,O)=>E+O),0));for(let E=0,O=z.length;E<O;E++){let O=z[E];if(j<R+O)return[E,(j-R+1)/O];R+=O}return[0,1]}getCurveT(E,O,R){let z=this.points[E],V=this.points[E>=this.points.length-1?0:E+1],j=this.curveDivisions,Y=j[E];if(NA(z,V)){let E=z.position.distanceTo(V.position);return z.position.distanceTo(tB.set(R.x,R.y))/E}let ee=0;for(let O=0;O<E;O++)ee+=j[O];return(O-ee)/Y}dispose(){}_applyCurveForPoint(E,O){NA(O,E)?this.lineTo(E.position.x,E.position.y):this.bezierCurveTo(O.controls[1].position.x,O.controls[1].position.y,E.controls[0].position.x,E.controls[0].position.y,E.position.x,E.position.y);let R=this.curves[this.curves.length-1];E.curveBefore=R,O.curveAfter=R;let z=R.clone();E.roundedCurveBefore=z,O.roundedCurveAfter=z,E.roundedCurveCorner=void 0,this.roundedCurves.push(z)}_update(){if(this.curves=[],this.roundedCurves=[],!this.points.length)return;for(let E=0,O=this.points.length;E<O;E++){let O=this.points[E];if(E===0)this.moveTo(O.position.x,O.position.y);else{let R=this.points[E-1];this._applyCurveForPoint(O,R)}}let E=this.getLastPoint();if(E?.curveAfter&&(E.curveAfter=void 0),this.isClosed){let E=this.points[0],O=this.points[this.points.length-1];this._applyCurveForPoint(E,O)}if(this.points.length>2){let E=0;for(let O=0,R=this.points.length;O<R;O++){let R=this.points[O],z=this.points[O-1]??this.points[this.points.length-1],V=this.points[O+1]??this.points[0],j=R.roundness,Y=z&&V&&PO(z,R,V);if(!R.controlsMoved()&&j>0&&!Y){let z=R.curveBefore,V=R.curveAfter;if(z===void 0||V===void 0)continue;let Y=R.roundedCurveBefore,ee=R.roundedCurveAfter,se=z.getLength(),he=V.getLength(),ce=Math.min(j,se*.499),ue=Math.min(j,he*.499),fe=Math.min(ce,ue),ve=1-fe/se,we=fe/he,Se=z.getPointAt(ve,tB),_e=V.getPointAt(we,iB);this._subSplitCurve(z,Y,ve,Se,void 0),this._subSplitCurve(V,ee,we,void 0,_e);let Ae;if(this.useCubicForRoundedCorners){let E=BA(Se,R.position,_e)/2,O=Math.tan(E)*Se.distanceTo(R.position),[z,V]=_O(Se,_e,O,rB,nB),j=IO(z,V,R.position),[Y,ee]=DO(j,Se,_e,O,sB,aB);Ae=new Ou(Se.clone(),Y.clone(),ee.clone(),_e.clone())}else Ae=new zu(Se.clone(),R.position.clone(),_e.clone());R.roundedCurveCorner=Ae,this.roundedCurves.splice(O+E,0,Ae),E++}}}}_subSplitCurve(E,O,R,z,V){if(!(E instanceof Lu)){let j=E,Y=O,ee=j.getUtoTmapping(R,0),se=OO(j.v0,j.v1,j.v2,j.v3,ee);return z!==void 0&&(Y.v0.set(se[0],se[1]),Y.v1.set(se[2],se[3]),Y.v2.set(se[4],se[5]),Y.v3.set(se[6],se[7])),V!==void 0&&(Y.v0.set(se[6],se[7]),Y.v1.set(se[8],se[9]),Y.v2.set(se[10],se[11]),Y.v3.set(se[12],se[13])),Y}z!==void 0&&O.v2.copy(z),V!==void 0&&O.v1.copy(V);return O}clone(){let E=new oB(this._width,this._height);return E.points=this.points.map((E=>E.clone())),E.isClosed=this.isClosed,E.roundness=this.roundness,E.isMesh2D=this.isMesh2D,E.shapeHoles=this.shapeHoles.map((E=>E.clone())),E}toJSON(){return{points:this.points.reduce(((E,O)=>E.concat(O.toJSON())),[]),shapeHoles:this.shapeHoles.map((E=>E.toJSON())),isClosed:this.isClosed,roundness:this.roundness}}fromJSON(E){this.points=[],this.pointIDs=0;let O=E.points.length/7;for(let R=0;R<O;R++){let O=R*7,z=E.points[O+0],V=E.points[O+1],j=E.points[O+2],Y=E.points[O+3],ee=E.points[O+4],se=E.points[O+5],he=E.points[O+6],ce=new RL(xn.generateUUID(),new bn(z,V));ce.controls[0].position.set(j,Y),ce.controls[1].position.set(ee,se),ce.roundness=he,this.points.push(ce)}return this.shapeHoles=E.shapeHoles?.length?E.shapeHoles.map((E=>{let O=new oB;return O.fromJSON(E),O})):[],this.isClosed=E.isClosed,this._roundness=E.roundness,this._update(),this}fromShape(E,O=!1){this.isText=O;let i=(E,O)=>{O instanceof Ou&&O.v3.equals(E.position)&&E.controls[0].position.copy(O.v2)},s=E=>{let O,R,z=[];for(O=0,R=E.length;O<R;O++)E[O]instanceof zu&&(E[O]=CO(E[O]));for(O=0,R=E.length;O<R;O++){let R,V=E[O],j=O>0?E[O-1]:null;V instanceof Ou?(R=this.createPoint(V.v0),R.controls[1].position.copy(V.v1)):V instanceof Lu&&(R=this.createPoint(V.v1)),R!==void 0&&(j!==null&&i(R,j),z.push(R))}let V=E[E.length-1],j=!1;return V instanceof Ou?V.v3.equals(z[0].position)&&(z[0].controls[0].position.copy(V.v2),j=!0):V instanceof Lu&&V.v2.equals(z[0].position)&&(j=!0),this.isClosed=j,z};return this.points=s(E.curves),E instanceof Qu&&(this.shapeHoles=E.holes.map((E=>{let O=new oB;return O.fromShape(E),O}))),this.update(),this}updatePoint(E,O){let R=this.getPointByUuid(E);R&&(O.position!==void 0&&R.position.fromArray(O.position),O.roundness!==void 0&&(R.roundness=O.roundness),O.areControlsDirectionsMirrored!==void 0&&(R.areControlsDirectionsMirrored=O.areControlsDirectionsMirrored),this.needsUpdate=!0)}updatePreviousControl(E,O){let R=this.getPointByUuid(E)?.controls[0];R&&(O.position&&R.position.fromArray(O.position),this.needsUpdate=!0)}updateNextControl(E,O){let R=this.getPointByUuid(E)?.controls[1];R&&(O.position&&R.position.fromArray(O.position),this.needsUpdate=!0)}};var lB=Math.PI*2;function UA({x:E,y:O},R,z,V,j){return{x:E*R+V,y:O*z+j}}function Z7(E,O){let R=O===1.5707963267948966?.551915024494:O===-1.5707963267948966?-.551915024494:1.3333333333333333*Math.tan(O/4),z=Math.cos(E),V=Math.sin(E),j=Math.cos(E+O),Y=Math.sin(E+O);return[{x:z-V*R,y:V+z*R},{x:j+Y*R,y:Y-j*R},{x:j,y:Y}]}function NO(E,O,R,z){let V=E*z-O*R<0?-1:1,j=Math.min(1,Math.max(-1,E*R+O*z));return V*Math.acos(j)}function J7(E,O,R,z,V,j,Y,ee,se,he){let ce=Math.pow(V,2),ue=Math.pow(j,2),fe=Math.pow(Y,2),ve=Math.pow(ee,2),we=ce*ue-ce*ve-ue*fe;we<0&&(we=0),we/=ce*ve+ue*fe,we=Math.sqrt(we)*(se===he?-1:1);let Se=we*V/j*ee,_e=we*-j/V*Y,Ae=Se+(E+R)/2,Ce=_e+(O+z)/2,Te=(Y-Se)/V,Ie=(ee-_e)/j,Fe=(-Y-Se)/V,Ue=(-ee-_e)/j,Ge=NO(1,0,Te,Ie),qe=NO(Te,Ie,Fe,Ue);return!he&&qe>0&&(qe-=lB),he&&qe<0&&(qe+=lB),{centerx:Ae,centery:Ce,ang1:Ge,ang2:qe}}function FO({px:E,py:O,cx:R,cy:z,rx:V,ry:j,largeArcFlag:Y,sweepFlag:ee}){let se=[];if(V===0||j===0)return[];let he=(E-R)/2,ce=(O-z)/2;if(he===0&&ce===0)return[];V=Math.abs(V),j=Math.abs(j);let ue=Math.pow(he,2)/Math.pow(V,2)+Math.pow(ce,2)/Math.pow(j,2);ue>1&&(V*=Math.sqrt(ue),j*=Math.sqrt(ue));let fe=J7(E,O,R,z,V,j,he,ce,Y,ee),{ang1:ve,ang2:we}=fe,{centerx:Se,centery:_e}=fe,Ae=Math.abs(we)/(lB/4);Math.abs(1-Ae)<1e-7&&(Ae=1);let Ce=Math.max(Math.ceil(Ae),1);we/=Ce;for(let E=0;E<Ce;E++)se.push(Z7(ve,we)),ve+=we;return se.map((E=>{let{x:O,y:R}=UA(E[0],V,j,Se,_e),{x:z,y:Y}=UA(E[1],V,j,Se,_e),{x:ee,y:se}=UA(E[2],V,j,Se,_e);return{x1:O,y1:R,x2:z,y2:Y,x:ee,y:se}}))}var hB;(function(E){E[E.ODD=0]="ODD",E[E.NONZERO=1]="NONZERO",E[E.POSITIVE=2]="POSITIVE",E[E.NEGATIVE=3]="NEGATIVE",E[E.ABS_GEQ_TWO=4]="ABS_GEQ_TWO"})(hB||(hB={}));var cB;(function(E){E[E.POLYGONS=0]="POLYGONS",E[E.CONNECTED_POLYGONS=1]="CONNECTED_POLYGONS",E[E.BOUNDARY_CONTOURS=2]="BOUNDARY_CONTOURS"})(cB||(cB={}));function ht(E,O){if(!E)throw O||"Assertion Failed!"}var pB=function(){function n(){}return n.vertEq=function(E,O){return E.s===O.s&&E.t===O.t},n.vertLeq=function(E,O){return E.s<O.s||E.s===O.s&&E.t<=O.t},n.transLeq=function(E,O){return E.t<O.t||E.t===O.t&&E.s<=O.s},n.edgeGoesLeft=function(E){return n.vertLeq(E.Dst,E.Org)},n.edgeGoesRight=function(E){return n.vertLeq(E.Org,E.Dst)},n.vertL1dist=function(E,O){return Math.abs(E.s-O.s)+Math.abs(E.t-O.t)},n.edgeEval=function(E,O,R){ht(n.vertLeq(E,O)&&n.vertLeq(O,R));var z=O.s-E.s,V=R.s-O.s;return z+V>0?z<V?O.t-E.t+(E.t-R.t)*(z/(z+V)):O.t-R.t+(R.t-E.t)*(V/(z+V)):0},n.edgeSign=function(E,O,R){ht(n.vertLeq(E,O)&&n.vertLeq(O,R));var z=O.s-E.s,V=R.s-O.s;return z+V>0?(O.t-R.t)*z+(O.t-E.t)*V:0},n.transEval=function(E,O,R){ht(n.transLeq(E,O)&&n.transLeq(O,R));var z=O.t-E.t,V=R.t-O.t;return z+V>0?z<V?O.s-E.s+(E.s-R.s)*(z/(z+V)):O.s-R.s+(R.s-E.s)*(V/(z+V)):0},n.transSign=function(E,O,R){ht(n.transLeq(E,O)&&n.transLeq(O,R));var z=O.t-E.t,V=R.t-O.t;return z+V>0?(O.s-R.s)*z+(O.s-E.s)*V:0},n.vertCCW=function(E,O,R){return E.s*(O.t-R.t)+O.s*(R.t-E.t)+R.s*(E.t-O.t)>=0},n.interpolate=function(E,O,R,z){return E=E<0?0:E,R=R<0?0:R,E<=R?R===0?(O+z)/2:O+E/(E+R)*(z-O):z+R/(E+R)*(O-z)},n.intersect=function(E,O,R,z,V){var j,Y,ee;n.vertLeq(E,O)||(ee=E,E=O,O=ee),n.vertLeq(R,z)||(ee=R,R=z,z=ee),n.vertLeq(E,R)||(ee=E,E=R,R=ee,ee=O,O=z,z=ee),n.vertLeq(R,O)?n.vertLeq(O,z)?(j=n.edgeEval(E,R,O),Y=n.edgeEval(R,O,z),j+Y<0&&(j=-j,Y=-Y),V.s=n.interpolate(j,R.s,Y,O.s)):(j=n.edgeSign(E,R,O),Y=-n.edgeSign(E,z,O),j+Y<0&&(j=-j,Y=-Y),V.s=n.interpolate(j,R.s,Y,z.s)):V.s=(R.s+O.s)/2,n.transLeq(E,O)||(ee=E,E=O,O=ee),n.transLeq(R,z)||(ee=R,R=z,z=ee),n.transLeq(E,R)||(ee=E,E=R,R=ee,ee=O,O=z,z=ee),n.transLeq(R,O)?n.transLeq(O,z)?(j=n.transEval(E,R,O),Y=n.transEval(R,O,z),j+Y<0&&(j=-j,Y=-Y),V.t=n.interpolate(j,R.t,Y,O.t)):(j=n.transSign(E,R,O),Y=-n.transSign(E,z,O),j+Y<0&&(j=-j,Y=-Y),V.t=n.interpolate(j,R.t,Y,z.t)):V.t=(R.t+O.t)/2},n}(),fB=function(){function n(){this.next=null,this.prev=null,this.anEdge=null,this.trail=null,this.n=0,this.marked=!1,this.inside=!1}return n}(),bB=function(){function n(E){this.side=E,this.next=null,this.Org=null,this.Sym=null,this.Onext=null,this.Lnext=null,this.Lface=null,this.activeRegion=null,this.winding=0}return Object.defineProperty(n.prototype,"Rface",{get:function(){return this.Sym.Lface},set:function(E){this.Sym.Lface=E},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"Dst",{get:function(){return this.Sym.Org},set:function(E){this.Sym.Org=E},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"Oprev",{get:function(){return this.Sym.Lnext},set:function(E){this.Sym.Lnext=E},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"Lprev",{get:function(){return this.Onext.Sym},set:function(E){this.Onext.Sym=E},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"Dprev",{get:function(){return this.Lnext.Sym},set:function(E){this.Lnext.Sym=E},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"Rprev",{get:function(){return this.Sym.Onext},set:function(E){this.Sym.Onext=E},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"Dnext",{get:function(){return this.Sym.Onext.Sym},set:function(E){this.Sym.Onext.Sym=E},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"Rnext",{get:function(){return this.Sym.Lnext.Sym},set:function(E){this.Sym.Lnext.Sym=E},enumerable:!0,configurable:!0}),n}(),_B=function(){function n(){this.next=null,this.prev=null,this.anEdge=null,this.coords=[0,0,0],this.s=0,this.t=0,this.pqHandle=0,this.n=0,this.idx=0}return n}(),AB=function(){function n(){var E=new _B,O=new fB,R=new bB(0),z=new bB(1);E.next=E.prev=E,E.anEdge=null,O.next=O.prev=O,R.next=R,R.Sym=z,z.next=z,z.Sym=R,this.vHead=E,this.fHead=O,this.eHead=R,this.eHeadSym=z}return n.prototype.makeEdge_=function(E){var O=new bB(0),R=new bB(1);E.Sym.side<E.side&&(E=E.Sym);var z=E.Sym.next;return R.next=z,z.Sym.next=O,O.next=E,E.Sym.next=R,O.Sym=R,O.Onext=O,O.Lnext=R,O.Org=null,O.Lface=null,O.winding=0,O.activeRegion=null,R.Sym=O,R.Onext=R,R.Lnext=O,R.Org=null,R.Lface=null,R.winding=0,R.activeRegion=null,O},n.prototype.splice_=function(E,O){var R=E.Onext,z=O.Onext;R.Sym.Lnext=O,z.Sym.Lnext=E,E.Onext=z,O.Onext=R},n.prototype.makeVertex_=function(E,O,R){var z=E;ht(z,"Vertex can't be null!");var V=R.prev;z.prev=V,V.next=z,z.next=R,R.prev=z,z.anEdge=O;var j=O;do{j.Org=z,j=j.Onext}while(j!==O)},n.prototype.makeFace_=function(E,O,R){var z=E;ht(z,"Face can't be null");var V=R.prev;z.prev=V,V.next=z,z.next=R,R.prev=z,z.anEdge=O,z.trail=null,z.marked=!1,z.inside=R.inside;var j=O;do{j.Lface=z,j=j.Lnext}while(j!==O)},n.prototype.killEdge_=function(E){E.Sym.side<E.side&&(E=E.Sym);var O=E.next,R=E.Sym.next;O.Sym.next=R,R.Sym.next=O},n.prototype.killVertex_=function(E,O){var R=E.anEdge,z=R;do{z.Org=O,z=z.Onext}while(z!==R);var V=E.prev,j=E.next;j.prev=V,V.next=j},n.prototype.killFace_=function(E,O){var R=E.anEdge,z=R;do{z.Lface=O,z=z.Lnext}while(z!==R);var V=E.prev,j=E.next;j.prev=V,V.next=j},n.prototype.makeEdge=function(){var E=new _B,O=new _B,R=new fB,z=this.makeEdge_(this.eHead);return this.makeVertex_(E,z,this.vHead),this.makeVertex_(O,z.Sym,this.vHead),this.makeFace_(R,z,this.fHead),z},n.prototype.splice=function(E,O){var R=!1,z=!1;if(E!==O){if(O.Org!==E.Org&&(z=!0,this.killVertex_(O.Org,E.Org)),O.Lface!==E.Lface&&(R=!0,this.killFace_(O.Lface,E.Lface)),this.splice_(O,E),!z){var V=new _B;this.makeVertex_(V,O,E.Org),E.Org.anEdge=E}if(!R){var j=new fB;this.makeFace_(j,O,E.Lface),E.Lface.anEdge=E}}},n.prototype.delete=function(E){var O=E.Sym,R=!1;if(E.Lface!==E.Rface&&(R=!0,this.killFace_(E.Lface,E.Rface)),E.Onext===E)this.killVertex_(E.Org,null);else if(E.Rface.anEdge=E.Oprev,E.Org.anEdge=E.Onext,this.splice_(E,E.Oprev),!R){var z=new fB;this.makeFace_(z,E,E.Lface)}O.Onext===O?(this.killVertex_(O.Org,null),this.killFace_(O.Lface,null)):(E.Lface.anEdge=O.Oprev,O.Org.anEdge=O.Onext,this.splice_(O,O.Oprev)),this.killEdge_(E)},n.prototype.addEdgeVertex=function(E){var O=this.makeEdge_(E),R=O.Sym;this.splice_(O,E.Lnext),O.Org=E.Dst;var z=new _B;return this.makeVertex_(z,R,O.Org),O.Lface=R.Lface=E.Lface,O},n.prototype.splitEdge=function(E){var O=this.addEdgeVertex(E),R=O.Sym;return this.splice_(E.Sym,E.Sym.Oprev),this.splice_(E.Sym,R),E.Dst=R.Org,R.Dst.anEdge=R.Sym,R.Rface=E.Rface,R.winding=E.winding,R.Sym.winding=E.Sym.winding,R.idx=E.idx,R.Sym.idx=E.Sym.idx,R},n.prototype.connect=function(E,O){var R=!1,z=this.makeEdge_(E),V=z.Sym;if(O.Lface!==E.Lface&&(R=!0,this.killFace_(O.Lface,E.Lface)),this.splice_(z,E.Lnext),this.splice_(V,O),z.Org=E.Dst,V.Org=O.Org,z.Lface=V.Lface=E.Lface,E.Lface.anEdge=V,!R){var j=new fB;this.makeFace_(j,z,E.Lface)}return z},n.prototype.zapFace=function(E){var O,R,z,V,j,Y=E.anEdge;R=Y.Lnext;do{O=R,R=O.Lnext,O.Lface=null,O.Rface===null&&(O.Onext===O?this.killVertex_(O.Org,null):(O.Org.anEdge=O.Onext,this.splice_(O,O.Oprev)),z=O.Sym,z.Onext===z?this.killVertex_(z.Org,null):(z.Org.anEdge=z.Onext,this.splice_(z,z.Oprev)),this.killEdge_(O))}while(O!=Y);V=E.prev,j=E.next,j.prev=V,V.next=j},n.prototype.countFaceVerts_=function(E){var O=E.anEdge,R=0;do{R++,O=O.Lnext}while(O!==E.anEdge);return R},n.prototype.mergeConvexFaces=function(E){var O,R,z,V,j,Y,ee;for(O=this.fHead.next;O!==this.fHead;O=O.next)if(!!O.inside)for(R=O.anEdge,j=R.Org;z=R.Lnext,V=R.Sym,V&&V.Lface&&V.Lface.inside&&(Y=this.countFaceVerts_(O),ee=this.countFaceVerts_(V.Lface),Y+ee-2<=E&&pB.vertCCW(R.Lprev.Org,R.Org,V.Lnext.Lnext.Org)&&pB.vertCCW(V.Lprev.Org,V.Org,R.Lnext.Lnext.Org)&&(z=V.Lnext,this.delete(V),R=null,V=null)),!(R&&R.Lnext.Org===j);)R=z;return!0},n.prototype.check=function(){var E,O,R,z,V,j,Y=this.fHead,ee=this.vHead,se=this.eHead;for(O=Y,O=Y;(E=O.next)!==Y;O=E){ht(E.prev===O),V=E.anEdge;do{ht(V.Sym!==V),ht(V.Sym.Sym===V),ht(V.Lnext.Onext.Sym===V),ht(V.Onext.Sym.Lnext===V),ht(V.Lface===E),V=V.Lnext}while(V!==E.anEdge)}for(ht(E.prev===O&&E.anEdge===null),z=ee,z=ee;(R=z.next)!==ee;z=R){ht(R.prev===z),V=R.anEdge;do{ht(V.Sym!==V),ht(V.Sym.Sym===V),ht(V.Lnext.Onext.Sym===V),ht(V.Onext.Sym.Lnext===V),ht(V.Org===R),V=V.Onext}while(V!==R.anEdge)}for(ht(R.prev===z&&R.anEdge===null),j=se,j=se;(V=j.next)!==se;j=V)ht(V.Sym.next===j.Sym),ht(V.Sym!==V),ht(V.Sym.Sym===V),ht(V.Org!==null),ht(V.Dst!==null),ht(V.Lnext.Onext.Sym===V),ht(V.Onext.Sym.Lnext===V);ht(V.Sym.next===j.Sym&&V.Sym===this.eHeadSym&&V.Sym.Sym===V&&V.Org===null&&V.Dst===null&&V.Lface===null&&V.Rface===null)},n}(),MB=function(){function n(){this.handle=null}return n}(),CB=function(){function n(){this.key=null,this.node=0}return n}(),PB=function(){function n(E,O){this.leq=O,this.max=0,this.nodes=[],this.handles=[],this.initialized=!1,this.freeList=0,this.size=0,this.max=E,this.nodes=[],this.handles=[];for(var R=0;R<E+1;R++)this.nodes[R]=new MB,this.handles[R]=new CB;this.initialized=!1,this.nodes[1].handle=1,this.handles[1].key=null}return n.prototype.floatDown_=function(E){var O,R,z,V=this.nodes,j=this.handles;for(O=V[E].handle;;){if(z=E<<1,z<this.size&&this.leq(j[V[z+1].handle].key,j[V[z].handle].key)&&++z,ht(z<=this.max),R=V[z].handle,z>this.size||this.leq(j[O].key,j[R].key)){V[E].handle=O,j[O].node=E;break}V[E].handle=R,j[R].node=E,E=z}},n.prototype.floatUp_=function(E){var O,R,z,V=this.nodes,j=this.handles;for(O=V[E].handle;;){if(z=E>>1,R=V[z].handle,z===0||this.leq(j[R].key,j[O].key)){V[E].handle=O,j[O].node=E;break}V[E].handle=R,j[R].node=E,E=z}},n.prototype.init=function(){for(var E=this.size;E>=1;--E)this.floatDown_(E);this.initialized=!0},n.prototype.min=function(){return this.handles[this.nodes[1].handle].key},n.prototype.insert=function(E){var O,R;if(O=++this.size,O*2>this.max){this.max*=2;var z,V;for(V=this.nodes.length,this.nodes.length=this.max+1,z=V;z<this.nodes.length;z++)this.nodes[z]=new MB;for(V=this.handles.length,this.handles.length=this.max+1,z=V;z<this.handles.length;z++)this.handles[z]=new CB}return this.freeList===0?R=O:(R=this.freeList,this.freeList=this.handles[R].node),this.nodes[O].handle=R,this.handles[R].node=O,this.handles[R].key=E,this.initialized&&this.floatUp_(O),R},n.prototype.extractMin=function(){var E=this.nodes,O=this.handles,R=E[1].handle,z=O[R].key;return this.size>0&&(E[1].handle=E[this.size].handle,O[E[1].handle].node=1,O[R].key=null,O[R].node=this.freeList,this.freeList=R,--this.size,this.size>0&&this.floatDown_(1)),z},n.prototype.delete=function(E){var O,R=this.nodes,z=this.handles;ht(E>=1&&E<=this.max&&z[E].key!==null),O=z[E].node,R[O].handle=R[this.size].handle,z[R[O].handle].node=O,--this.size,O<=this.size&&(O<=1||this.leq(z[R[O>>1].handle].key,z[R[O].handle].key)?this.floatDown_(O):this.floatUp_(O)),z[E].key=null,z[E].node=this.freeList,this.freeList=E},n}(),zB=function(){function n(){this.eUp=null,this.nodeUp=null,this.windingNumber=0,this.inside=!1,this.sentinel=!1,this.dirty=!1,this.fixUpperEdge=!1}return n}(),FB=function(){function n(){this.key=null,this.next=null,this.prev=null}return n}(),UB=function(){function n(E,O){this.frame=E,this.leq=O,this.head=new FB,this.head.next=this.head,this.head.prev=this.head}return n.prototype.min=function(){return this.head.next},n.prototype.max=function(){return this.head.prev},n.prototype.insert=function(E){return this.insertBefore(this.head,E)},n.prototype.search=function(E){var O=this.head;do{O=O.next}while(O.key!==null&&!this.leq(this.frame,E,O.key));return O},n.prototype.insertBefore=function(E,O){do{E=E.prev}while(E.key!==null&&!this.leq(this.frame,E.key,O));var R=new FB;return R.key=O,R.next=E.next,E.next.prev=R,R.prev=E,E.next=R,R},n.prototype.delete=function(E){E.next.prev=E.prev,E.prev.next=E.next},n}(),kB=function(){function n(){}return n.regionBelow=function(E){return E.nodeUp.prev.key},n.regionAbove=function(E){return E.nodeUp.next.key},n.debugEvent=function(E){},n.addWinding=function(E,O){E.winding+=O.winding,E.Sym.winding+=O.Sym.winding},n.edgeLeq=function(E,O,R){var z=E.event,V=O.eUp,j=R.eUp;if(V.Dst===z)return j.Dst===z?pB.vertLeq(V.Org,j.Org)?pB.edgeSign(j.Dst,V.Org,j.Org)<=0:pB.edgeSign(V.Dst,j.Org,V.Org)>=0:pB.edgeSign(j.Dst,z,j.Org)<=0;if(j.Dst===z)return pB.edgeSign(V.Dst,z,V.Org)>=0;var Y=pB.edgeEval(V.Dst,z,V.Org),ee=pB.edgeEval(j.Dst,z,j.Org);return Y>=ee},n.deleteRegion=function(E,O){O.fixUpperEdge&&ht(O.eUp.winding===0),O.eUp.activeRegion=null,E.dict.delete(O.nodeUp)},n.fixUpperEdge=function(E,O,R){ht(O.fixUpperEdge),E.mesh.delete(O.eUp),O.fixUpperEdge=!1,O.eUp=R,R.activeRegion=O},n.topLeftRegion=function(E,O){var R,z=O.eUp.Org;do{O=n.regionAbove(O)}while(O.eUp.Org===z);if(O.fixUpperEdge){if(R=E.mesh.connect(n.regionBelow(O).eUp.Sym,O.eUp.Lnext),R===null)return null;n.fixUpperEdge(E,O,R),O=n.regionAbove(O)}return O},n.topRightRegion=function(E){var O=E.eUp.Dst;do{E=n.regionAbove(E)}while(E.eUp.Dst===O);return E},n.addRegionBelow=function(E,O,R){var z=new zB;return z.eUp=R,z.nodeUp=E.dict.insertBefore(O.nodeUp,z),z.fixUpperEdge=!1,z.sentinel=!1,z.dirty=!1,R.activeRegion=z,z},n.isWindingInside=function(E,O){switch(E.windingRule){case hB.ODD:return(O&1)!==0;case hB.NONZERO:return O!==0;case hB.POSITIVE:return O>0;case hB.NEGATIVE:return O<0;case hB.ABS_GEQ_TWO:return O>=2||O<=-2}throw new Error("Invalid winding rulle")},n.computeWinding=function(E,O){O.windingNumber=n.regionAbove(O).windingNumber+O.eUp.winding,O.inside=n.isWindingInside(E,O.windingNumber)},n.finishRegion=function(E,O){var R=O.eUp,z=R.Lface;z.inside=O.inside,z.anEdge=R,n.deleteRegion(E,O)},n.finishLeftRegions=function(E,O,R){for(var z,V=null,j=O,Y=O.eUp;j!==R;){if(j.fixUpperEdge=!1,V=n.regionBelow(j),z=V.eUp,z.Org!=Y.Org){if(!V.fixUpperEdge){n.finishRegion(E,j);break}z=E.mesh.connect(Y.Lprev,z.Sym),n.fixUpperEdge(E,V,z)}Y.Onext!==z&&(E.mesh.splice(z.Oprev,z),E.mesh.splice(Y,z)),n.finishRegion(E,j),Y=V.eUp,j=V}return Y},n.addRightEdges=function(E,O,R,z,V,j){var Y,ee,se,he,ce=!0;se=R;do{ht(pB.vertLeq(se.Org,se.Dst)),n.addRegionBelow(E,O,se.Sym),se=se.Onext}while(se!==z);for(V===null&&(V=n.regionBelow(O).eUp.Rprev),ee=O,he=V;Y=n.regionBelow(ee),se=Y.eUp.Sym,se.Org===he.Org;)se.Onext!==he&&(E.mesh.splice(se.Oprev,se),E.mesh.splice(he.Oprev,se)),Y.windingNumber=ee.windingNumber-se.winding,Y.inside=n.isWindingInside(E,Y.windingNumber),ee.dirty=!0,!ce&&n.checkForRightSplice(E,ee)&&(n.addWinding(se,he),n.deleteRegion(E,ee),E.mesh.delete(he)),ce=!1,ee=Y,he=se;ee.dirty=!0,ht(ee.windingNumber-se.winding===Y.windingNumber),j&&n.walkDirtyRegions(E,ee)},n.spliceMergeVertices=function(E,O,R){E.mesh.splice(O,R)},n.vertexWeights=function(E,O,R){var z=pB.vertL1dist(O,E),V=pB.vertL1dist(R,E),j=.5*V/(z+V),Y=.5*z/(z+V);E.coords[0]+=j*O.coords[0]+Y*R.coords[0],E.coords[1]+=j*O.coords[1]+Y*R.coords[1],E.coords[2]+=j*O.coords[2]+Y*R.coords[2]},n.getIntersectData=function(E,O,R,z,V,j){O.coords[0]=O.coords[1]=O.coords[2]=0,O.idx=-1,n.vertexWeights(O,R,z),n.vertexWeights(O,V,j)},n.checkForRightSplice=function(E,O){var R=n.regionBelow(O),z=O.eUp,V=R.eUp;if(pB.vertLeq(z.Org,V.Org)){if(pB.edgeSign(V.Dst,z.Org,V.Org)>0)return!1;pB.vertEq(z.Org,V.Org)?z.Org!==V.Org&&(E.pq.delete(z.Org.pqHandle),n.spliceMergeVertices(E,V.Oprev,z)):(E.mesh.splitEdge(V.Sym),E.mesh.splice(z,V.Oprev),O.dirty=R.dirty=!0)}else{if(pB.edgeSign(z.Dst,V.Org,z.Org)<0)return!1;n.regionAbove(O).dirty=O.dirty=!0,E.mesh.splitEdge(z.Sym),E.mesh.splice(V.Oprev,z)}return!0},n.checkForLeftSplice=function(E,O){var R,z=n.regionBelow(O),V=O.eUp,j=z.eUp;if(ht(!pB.vertEq(V.Dst,j.Dst)),pB.vertLeq(V.Dst,j.Dst)){if(pB.edgeSign(V.Dst,j.Dst,V.Org)<0)return!1;n.regionAbove(O).dirty=O.dirty=!0,R=E.mesh.splitEdge(V),E.mesh.splice(j.Sym,R),R.Lface.inside=O.inside}else{if(pB.edgeSign(j.Dst,V.Dst,j.Org)>0)return!1;O.dirty=z.dirty=!0,R=E.mesh.splitEdge(j),E.mesh.splice(V.Lnext,j.Sym),R.Rface.inside=O.inside}return!0},n.checkForIntersect=function(E,O){var R,z,V,j,Y=n.regionBelow(O),ee=O.eUp,se=Y.eUp,he=ee.Org,ce=se.Org,ue=ee.Dst,fe=se.Dst,ve=new _B;if(ht(!pB.vertEq(fe,ue)),ht(pB.edgeSign(ue,E.event,he)<=0),ht(pB.edgeSign(fe,E.event,ce)>=0),ht(he!==E.event&&ce!==E.event),ht(!O.fixUpperEdge&&!Y.fixUpperEdge),he===ce||(R=Math.min(he.t,ue.t),z=Math.max(ce.t,fe.t),R>z))return!1;if(pB.vertLeq(he,ce)){if(pB.edgeSign(fe,he,ce)>0)return!1}else if(pB.edgeSign(ue,ce,he)<0)return!1;return n.debugEvent(E),pB.intersect(ue,he,fe,ce,ve),ht(Math.min(he.t,ue.t)<=ve.t),ht(ve.t<=Math.max(ce.t,fe.t)),ht(Math.min(fe.s,ue.s)<=ve.s),ht(ve.s<=Math.max(ce.s,he.s)),pB.vertLeq(ve,E.event)&&(ve.s=E.event.s,ve.t=E.event.t),V=pB.vertLeq(he,ce)?he:ce,pB.vertLeq(V,ve)&&(ve.s=V.s,ve.t=V.t),pB.vertEq(ve,he)||pB.vertEq(ve,ce)?(n.checkForRightSplice(E,O),!1):!pB.vertEq(ue,E.event)&&pB.edgeSign(ue,E.event,ve)>=0||!pB.vertEq(fe,E.event)&&pB.edgeSign(fe,E.event,ve)<=0?fe===E.event?(E.mesh.splitEdge(ee.Sym),E.mesh.splice(se.Sym,ee),O=n.topLeftRegion(E,O),ee=n.regionBelow(O).eUp,n.finishLeftRegions(E,n.regionBelow(O),Y),n.addRightEdges(E,O,ee.Oprev,ee,ee,!0),!0):ue===E.event?(E.mesh.splitEdge(se.Sym),E.mesh.splice(ee.Lnext,se.Oprev),Y=O,O=n.topRightRegion(O),j=n.regionBelow(O).eUp.Rprev,Y.eUp=se.Oprev,se=n.finishLeftRegions(E,Y,null),n.addRightEdges(E,O,se.Onext,ee.Rprev,j,!0),!0):(pB.edgeSign(ue,E.event,ve)>=0&&(n.regionAbove(O).dirty=O.dirty=!0,E.mesh.splitEdge(ee.Sym),ee.Org.s=E.event.s,ee.Org.t=E.event.t),pB.edgeSign(fe,E.event,ve)<=0&&(O.dirty=Y.dirty=!0,E.mesh.splitEdge(se.Sym),se.Org.s=E.event.s,se.Org.t=E.event.t),!1):(E.mesh.splitEdge(ee.Sym),E.mesh.splitEdge(se.Sym),E.mesh.splice(se.Oprev,ee),ee.Org.s=ve.s,ee.Org.t=ve.t,ee.Org.pqHandle=E.pq.insert(ee.Org),n.getIntersectData(E,ee.Org,he,ue,ce,fe),n.regionAbove(O).dirty=O.dirty=Y.dirty=!0,!1)},n.walkDirtyRegions=function(E,O){for(var R,z,V=n.regionBelow(O);;){for(;V.dirty;)O=V,V=n.regionBelow(V);if(!O.dirty&&(V=O,O=n.regionAbove(O),O===null||!O.dirty))return;if(O.dirty=!1,R=O.eUp,z=V.eUp,R.Dst!==z.Dst&&n.checkForLeftSplice(E,O)&&(V.fixUpperEdge?(n.deleteRegion(E,V),E.mesh.delete(z),V=n.regionBelow(O),z=V.eUp):O.fixUpperEdge&&(n.deleteRegion(E,O),E.mesh.delete(R),O=n.regionAbove(V),R=O.eUp)),R.Org!==z.Org)if(R.Dst===z.Dst||O.fixUpperEdge||V.fixUpperEdge||R.Dst!==E.event&&z.Dst!==E.event)n.checkForRightSplice(E,O);else if(n.checkForIntersect(E,O))return;R.Org===z.Org&&R.Dst===z.Dst&&(n.addWinding(z,R),n.deleteRegion(E,O),E.mesh.delete(R),O=n.regionAbove(V))}},n.connectRightVertex=function(E,O,R){var z,V=R.Onext,j=n.regionBelow(O),Y=O.eUp,ee=j.eUp,se=!1;Y.Dst!==ee.Dst&&n.checkForIntersect(E,O),pB.vertEq(Y.Org,E.event)&&(E.mesh.splice(V.Oprev,Y),O=n.topLeftRegion(E,O),V=n.regionBelow(O).eUp,n.finishLeftRegions(E,n.regionBelow(O),j),se=!0),pB.vertEq(ee.Org,E.event)&&(E.mesh.splice(R,ee.Oprev),R=n.finishLeftRegions(E,j,null),se=!0),se?n.addRightEdges(E,O,R.Onext,V,V,!0):(z=pB.vertLeq(ee.Org,Y.Org)?ee.Oprev:Y,z=E.mesh.connect(R.Lprev,z),n.addRightEdges(E,O,z,z.Onext,z.Onext,!1),z.Sym.activeRegion.fixUpperEdge=!0,n.walkDirtyRegions(E,O))},n.connectLeftDegenerate=function(E,O,R){var z,V,j,Y,ee;z=O.eUp,pB.vertEq(z.Org,R)?(ht(!1),n.spliceMergeVertices(E,z,R.anEdge)):pB.vertEq(z.Dst,R)?(ht(!1),O=n.topRightRegion(O),ee=n.regionBelow(O),j=ee.eUp.Sym,V=Y=j.Onext,ee.fixUpperEdge&&(ht(V!==j),n.deleteRegion(E,ee),E.mesh.delete(j),j=V.Oprev),E.mesh.splice(R.anEdge,j),pB.edgeGoesLeft(V)||(V=null),n.addRightEdges(E,O,j.Onext,Y,V,!0)):(E.mesh.splitEdge(z.Sym),O.fixUpperEdge&&(E.mesh.delete(z.Onext),O.fixUpperEdge=!1),E.mesh.splice(R.anEdge,z),n.sweepEvent(E,R))},n.connectLeftVertex=function(E,O){var R,z,V,j,Y,ee,se=new zB;if(se.eUp=O.anEdge.Sym,R=E.dict.search(se).key,z=n.regionBelow(R),!!z){if(j=R.eUp,Y=z.eUp,pB.edgeSign(j.Dst,O,j.Org)===0){n.connectLeftDegenerate(E,R,O);return}if(V=pB.vertLeq(Y.Dst,j.Dst)?R:z,R.inside||V.fixUpperEdge){if(V===R)ee=E.mesh.connect(O.anEdge.Sym,j.Lnext);else{var he=E.mesh.connect(Y.Dnext,O.anEdge);ee=he.Sym}V.fixUpperEdge?n.fixUpperEdge(E,V,ee):n.computeWinding(E,n.addRegionBelow(E,R,ee)),n.sweepEvent(E,O)}else n.addRightEdges(E,R,O.anEdge,O.anEdge,null,!0)}},n.sweepEvent=function(E,O){E.event=O,n.debugEvent(E);for(var R=O.anEdge;R.activeRegion===null;)if(R=R.Onext,R===O.anEdge){n.connectLeftVertex(E,O);return}var z=n.topLeftRegion(E,R.activeRegion);ht(z!==null);var V=n.regionBelow(z),j=V.eUp,Y=n.finishLeftRegions(E,V,null);Y.Onext===j?n.connectRightVertex(E,z,Y):n.addRightEdges(E,z,Y.Onext,j,j,!0)},n.addSentinel=function(E,O,R,z){var V=new zB,j=E.mesh.makeEdge();j.Org.s=R,j.Org.t=z,j.Dst.s=O,j.Dst.t=z,E.event=j.Dst,V.eUp=j,V.windingNumber=0,V.inside=!1,V.fixUpperEdge=!1,V.sentinel=!0,V.dirty=!1,V.nodeUp=E.dict.insert(V)},n.initEdgeDict=function(E){E.dict=new UB(E,n.edgeLeq);var O=E.bmax[0]-E.bmin[0],R=E.bmax[1]-E.bmin[1],z=E.bmin[0]-O,V=E.bmax[0]+O,j=E.bmin[1]-R,Y=E.bmax[1]+R;n.addSentinel(E,z,V,j),n.addSentinel(E,z,V,Y)},n.doneEdgeDict=function(E){for(var O,R=0;(O=E.dict.min().key)!==null;)O.sentinel||(ht(O.fixUpperEdge),ht(++R===1)),ht(O.windingNumber===0),n.deleteRegion(E,O)},n.removeDegenerateEdges=function(E){var O,R,z,V=E.mesh.eHead;for(O=V.next;O!==V;O=R)R=O.next,z=O.Lnext,pB.vertEq(O.Org,O.Dst)&&O.Lnext.Lnext!==O&&(n.spliceMergeVertices(E,z,O),E.mesh.delete(O),O=z,z=O.Lnext),z.Lnext===O&&(z!==O&&((z===R||z===R.Sym)&&(R=R.next),E.mesh.delete(z)),(O===R||O===R.Sym)&&(R=R.next),E.mesh.delete(O))},n.initPriorityQ=function(E){var O,R,z,V=0;for(z=E.mesh.vHead,R=z.next;R!==z;R=R.next)V++;for(V+=8,O=E.pq=new PB(V,pB.vertLeq),z=E.mesh.vHead,R=z.next;R!==z;R=R.next)R.pqHandle=O.insert(R);return R===z&&(O.init(),!0)},n.donePriorityQ=function(E){E.pq=null},n.removeDegenerateFaces=function(E,O){var R,z,V;for(R=O.fHead.next;R!==O.fHead;R=z)z=R.next,V=R.anEdge,ht(V.Lnext!==V),V.Lnext.Lnext===V&&(n.addWinding(V.Onext,V),E.mesh.delete(V));return!0},n.computeInterior=function(E,O){O===void 0&&(O=!0);var R,z;if(n.removeDegenerateEdges(E),!n.initPriorityQ(E))return!1;for(n.initEdgeDict(E);(R=E.pq.extractMin())!==null;){for(;z=E.pq.min(),!(z===null||!pB.vertEq(z,R));)z=E.pq.extractMin(),n.spliceMergeVertices(E,R.anEdge,z.anEdge);n.sweepEvent(E,R)}return E.event=E.dict.min().key.eUp.Org,n.debugEvent(E),n.doneEdgeDict(E),n.donePriorityQ(E),!!n.removeDegenerateFaces(E,E.mesh)&&(O&&E.mesh.check(),!0)},n}(),VB=function(){function n(){this.mesh=new AB,this.normal=[0,0,0],this.sUnit=[0,0,0],this.tUnit=[0,0,0],this.bmin=[0,0],this.bmax=[0,0],this.windingRule=hB.ODD,this.dict=null,this.pq=null,this.event=null,this.vertexIndexCounter=0,this.vertices=[],this.vertexIndices=[],this.vertexCount=0,this.elements=[],this.elementCount=0}return n.prototype.dot_=function(E,O){return E[0]*O[0]+E[1]*O[1]+E[2]*O[2]},n.prototype.normalize_=function(E){var O=E[0]*E[0]+E[1]*E[1]+E[2]*E[2];if(!O)throw"Zero-size vector!";O=Math.sqrt(O),E[0]/=O,E[1]/=O,E[2]/=O},n.prototype.longAxis_=function(E){var O=0;return Math.abs(E[1])>Math.abs(E[0])&&(O=1),Math.abs(E[2])>Math.abs(E[O])&&(O=2),O},n.prototype.computeNormal_=function(E){var O,R,z,V,j,Y,ee=[0,0,0],se=[0,0,0],he=[0,0,0],ce=[0,0,0],ue=[0,0,0],fe=[null,null,null],ve=[null,null,null],we=this.mesh.vHead;O=we.next;for(var Se=0;Se<3;++Se)V=O.coords[Se],se[Se]=V,ve[Se]=O,ee[Se]=V,fe[Se]=O;for(O=we.next;O!==we;O=O.next)for(var _e=0;_e<3;++_e)V=O.coords[_e],V<se[_e]&&(se[_e]=V,ve[_e]=O),V>ee[_e]&&(ee[_e]=V,fe[_e]=O);var Ae=0;if(ee[1]-se[1]>ee[0]-se[0]&&(Ae=1),ee[2]-se[2]>ee[Ae]-se[Ae]&&(Ae=2),se[Ae]>=ee[Ae])E[0]=0,E[1]=0,E[2]=1;else{for(Y=0,R=ve[Ae],z=fe[Ae],he[0]=R.coords[0]-z.coords[0],he[1]=R.coords[1]-z.coords[1],he[2]=R.coords[2]-z.coords[2],O=we.next;O!==we;O=O.next)ce[0]=O.coords[0]-z.coords[0],ce[1]=O.coords[1]-z.coords[1],ce[2]=O.coords[2]-z.coords[2],ue[0]=he[1]*ce[2]-he[2]*ce[1],ue[1]=he[2]*ce[0]-he[0]*ce[2],ue[2]=he[0]*ce[1]-he[1]*ce[0],j=ue[0]*ue[0]+ue[1]*ue[1]+ue[2]*ue[2],j>Y&&(Y=j,E[0]=ue[0],E[1]=ue[1],E[2]=ue[2]);Y<=0&&(E[0]=E[1]=E[2]=0,E[this.longAxis_(he)]=1)}},n.prototype.checkOrientation_=function(){for(var E,O,R=this.mesh.fHead,z=this.mesh.vHead,V=0,j=R.next;j!==R;j=j.next)if(O=j.anEdge,!(O.winding<=0))do{V+=(O.Org.s-O.Dst.s)*(O.Org.t+O.Dst.t),O=O.Lnext}while(O!==j.anEdge);if(V<0){for(E=z.next;E!==z;E=E.next)E.t=-E.t;this.tUnit[0]=-this.tUnit[0],this.tUnit[1]=-this.tUnit[1],this.tUnit[2]=-this.tUnit[2]}},n.prototype.projectPolygon_=function(){var E,O,R=this.mesh.vHead,z=[0,0,0],V=!1;z[0]=this.normal[0],z[1]=this.normal[1],z[2]=this.normal[2],!z[0]&&!z[1]&&!z[2]&&(this.computeNormal_(z),V=!0),E=this.sUnit,O=this.tUnit;var j=this.longAxis_(z);E[j]=0,E[(j+1)%3]=1,E[(j+2)%3]=0,O[j]=0,O[(j+1)%3]=0,O[(j+2)%3]=z[j]>0?1:-1;for(var Y=R.next;Y!==R;Y=Y.next)Y.s=this.dot_(Y.coords,E),Y.t=this.dot_(Y.coords,O);V&&this.checkOrientation_();for(var ee=!0,se=R.next;se!==R;se=se.next)ee?(this.bmin[0]=this.bmax[0]=se.s,this.bmin[1]=this.bmax[1]=se.t,ee=!1):(se.s<this.bmin[0]&&(this.bmin[0]=se.s),se.s>this.bmax[0]&&(this.bmax[0]=se.s),se.t<this.bmin[1]&&(this.bmin[1]=se.t),se.t>this.bmax[1]&&(this.bmax[1]=se.t))},n.prototype.addWinding_=function(E,O){E.winding+=O.winding,E.Sym.winding+=O.Sym.winding},n.prototype.tessellateMonoRegion_=function(E,O){var R,z;if(R=O.anEdge,!(R.Lnext!==R&&R.Lnext.Lnext!==R))throw"Mono region invalid";for(;pB.vertLeq(R.Dst,R.Org);R=R.Lprev);for(;pB.vertLeq(R.Org,R.Dst);R=R.Lnext);z=R.Lprev;for(var V=void 0;R.Lnext!==z;)if(pB.vertLeq(R.Dst,z.Org)){for(;z.Lnext!==R&&(pB.edgeGoesLeft(z.Lnext)||pB.edgeSign(z.Org,z.Dst,z.Lnext.Dst)<=0);)V=E.connect(z.Lnext,z),z=V.Sym;z=z.Lprev}else{for(;z.Lnext!==R&&(pB.edgeGoesRight(R.Lprev)||pB.edgeSign(R.Dst,R.Org,R.Lprev.Org)>=0);)V=E.connect(R,R.Lprev),R=V.Sym;R=R.Lnext}if(z.Lnext===R)throw"Mono region invalid";for(;z.Lnext.Lnext!==R;)V=E.connect(z.Lnext,z),z=V.Sym;return!0},n.prototype.tessellateInterior_=function(E){for(var O,R=E.fHead.next;R!==E.fHead;R=O)if(O=R.next,R.inside&&!this.tessellateMonoRegion_(E,R))return!1;return!0},n.prototype.discardExterior_=function(E){for(var O,R=E.fHead.next;R!==E.fHead;R=O)O=R.next,R.inside||E.zapFace(R)},n.prototype.setWindingNumber_=function(E,O,R){for(var z,V=E.eHead.next;V!==E.eHead;V=z)z=V.next,V.Rface.inside!==V.Lface.inside?V.winding=V.Lface.inside?O:-O:R?E.delete(V):V.winding=0},n.prototype.getNeighbourFace_=function(E){return E.Rface&&E.Rface.inside?E.Rface.n:-1},n.prototype.outputPolymesh_=function(E,O,R,z){var V,j,Y=0,ee=0;R>3&&E.mergeConvexFaces(R);for(var se=E.vHead.next;se!==E.vHead;se=se.next)se.n=-1;for(var he=E.fHead.next;he!==E.fHead;he=he.next)if(he.n=-1,!!he.inside){V=he.anEdge,j=0;do{se=V.Org;se.n===-1&&(se.n=ee,ee++),j++,V=V.Lnext}while(V!==he.anEdge);if(j>R)throw"Face vertex greater that support polygon";he.n=Y,++Y}this.elementCount=Y,O===cB.CONNECTED_POLYGONS&&(Y*=2),this.elements=[],this.elements.length=Y*R,this.vertexCount=ee,this.vertices=[],this.vertices.length=ee*z,this.vertexIndices=[],this.vertexIndices.length=ee;for(se=E.vHead.next;se!==E.vHead;se=se.next)if(se.n!==-1){var ce=se.n*z;this.vertices[ce+0]=se.coords[0],this.vertices[ce+1]=se.coords[1],z>2&&(this.vertices[ce+2]=se.coords[2]),this.vertexIndices[se.n]=se.idx}var ue=0;for(he=E.fHead.next;he!==E.fHead;he=he.next)if(!!he.inside){V=he.anEdge,j=0;do{se=V.Org;this.elements[ue++]=se.n,j++,V=V.Lnext}while(V!==he.anEdge);for(var fe=j;fe<R;++fe)this.elements[ue++]=-1;if(O===cB.CONNECTED_POLYGONS){V=he.anEdge;do{this.elements[ue++]=this.getNeighbourFace_(V),V=V.Lnext}while(V!==he.anEdge);for(var ve=j;ve<R;++ve)this.elements[ue++]=-1}}},n.prototype.outputContours_=function(E,O){var R,z,V=0,j=0;this.vertexCount=0,this.elementCount=0;for(var Y=E.fHead.next;Y!==E.fHead;Y=Y.next)if(!!Y.inside){z=R=Y.anEdge;do{this.vertexCount++,R=R.Lnext}while(R!==z);this.elementCount++}this.elements=[],this.elements.length=this.elementCount*2,this.vertices=[],this.vertices.length=this.vertexCount*O,this.vertexIndices=[],this.vertexIndices.length=this.vertexCount;var ee=0,se=0,he=0;V=0;for(Y=E.fHead.next;Y!==E.fHead;Y=Y.next)if(!!Y.inside){j=0,z=R=Y.anEdge;do{this.vertices[ee++]=R.Org.coords[0],this.vertices[ee++]=R.Org.coords[1],O>2&&(this.vertices[ee++]=R.Org.coords[2]),this.vertexIndices[se++]=this.vertexIdCallback?this.vertexIdCallback(R):R.Org.idx,j++,R=R.Lnext}while(R!==z);this.elements[he++]=V,this.elements[he++]=j,V+=j}},n.prototype.addContour=function(E,O){this.mesh===null&&(this.mesh=new AB),E<2&&(E=2),E>3&&(E=3);for(var R=null,z=0;z<O.length;z+=E)R===null?(R=this.mesh.makeEdge(),this.mesh.splice(R,R.Sym)):(this.mesh.splitEdge(R),R=R.Lnext),R.Org.coords[0]=O[z+0],R.Org.coords[1]=O[z+1],R.Org.coords[2]=E>2?O[z+2]:0,R.Org.idx=this.vertexIndexCounter++,this.edgeCreateCallback&&this.edgeCreateCallback(R),R.winding=1,R.Sym.winding=-1},n.prototype.tesselate=function(E,O,R,z,V,j){if(E===void 0&&(E=hB.ODD),O===void 0&&(O=cB.POLYGONS),j===void 0&&(j=!0),this.vertices=[],this.elements=[],this.vertexIndices=[],this.vertexIndexCounter=0,V&&(this.normal[0]=V[0],this.normal[1]=V[1],this.normal[2]=V[2]),this.windingRule=E,z<2&&(z=2),z>3&&(z=3),!this.mesh)return!1;this.projectPolygon_(),kB.computeInterior(this,j);var Y=this.mesh;return O===cB.BOUNDARY_CONTOURS?this.setWindingNumber_(Y,1,!0):this.tessellateInterior_(Y),j&&Y.check(),O===cB.BOUNDARY_CONTOURS?this.outputContours_(Y,z):this.outputPolymesh_(Y,O,R,z),!0},n}();function Xs(E){var O=E.windingRule,R=O===void 0?hB.ODD:O,z=E.elementType,V=z===void 0?cB.POLYGONS:z,j=E.polySize,Y=j===void 0?3:j,ee=E.vertexSize,se=ee===void 0?2:ee,he=E.normal,ce=he===void 0?[0,0,1]:he,ue=E.contours,fe=ue===void 0?[]:ue,ve=E.strict,we=ve===void 0||ve,Se=E.debug,_e=Se!==void 0&&Se;if(!fe&&we)throw new Error("Contours can't be empty");if(!!fe){var Ae=new VB;E.edgeCreateCallback&&(Ae.edgeCreateCallback=E.edgeCreateCallback),E.vertexIdCallback&&(Ae.vertexIdCallback=E.vertexIdCallback);for(var Ce=0;Ce<fe.length;Ce++)Ae.addContour(se||2,fe[Ce]);return Ae.tesselate(R,V,Y,se,ce,we),{vertices:Ae.vertices,vertexIndices:Ae.vertexIndices,vertexCount:Ae.vertexCount,elements:Ae.elements,elementCount:Ae.elementCount,mesh:_e?Ae.mesh:void 0}}}hB.ODD,hB.NONZERO,hB.POSITIVE,hB.NEGATIVE,hB.ABS_GEQ_TWO,cB.POLYGONS,cB.CONNECTED_POLYGONS,cB.BOUNDARY_CONTOURS;var jB=class{constructor(E=256,O=!1){this.capacity=E,this.size=0,this.debug=O,this.debug&&console.log(`allocating with cap ${E}`);let R=E*jB.eSize;this.buffer=new ArrayBuffer(R);let z=Float32Array.BYTES_PER_ELEMENT,V=0;this.positions=new Float32Array(this.buffer,V*z,3*E),V+=3*E,this.normals=new Float32Array(this.buffer,V*z,3*E),V+=3*E,this.uvs=new Float32Array(this.buffer,V*z,2*E)}realloc(E,O=!1){if(E<this.size)throw Error("cannot shrink buffer");if(E<=this.capacity&&!O)return;this.debug&&console.log(`resizing from ${this.capacity}  ${E}`);let R=E*jB.eSize,z=new ArrayBuffer(R),V=Float32Array.BYTES_PER_ELEMENT,j=0,Y=new Float32Array(z,j*V,3*E);j+=3*E;let ee=new Float32Array(z,j*V,3*E);j+=3*E;let se=new Float32Array(z,j*V,2*E);O?(Y.set(this.positions.subarray(0,this.size*3)),ee.set(this.normals.subarray(0,this.size*3)),se.set(this.uvs.subarray(0,this.size*2))):(Y.set(this.positions),ee.set(this.normals),se.set(this.uvs)),this.buffer=z,this.positions=Y,this.normals=ee,this.uvs=se,this.capacity=E}get(E=1){let O=this.size+E;if(O>this.capacity){let E=this.capacity;for(;O>E;)E*=2;this.realloc(E)}let R=this.size;return this.size=O,R}reserve(E){let O=this.size+E;O>this.capacity&&this.realloc(O)}shrink(){this.debug&&console.log(`shrinking ${this.capacity}  ${this.size}`),this.realloc(this.size,!0)}},GB=jB;GB.eSize=8*Float32Array.BYTES_PER_ELEMENT;var HB=class{constructor(E=[],O=(E,O)=>E<O?-1:E>O?1:0){if(this.data=E,this.length=this.data.length,this.compare=O,this.length>0)for(let E=(this.length>>1)-1;E>=0;E--)this._down(E)}push(E){this.data.push(E),this._up(this.length++)}pop(){if(this.length===0)return;let E=this.data[0],O=this.data.pop();return--this.length>0&&(this.data[0]=O,this._down(0)),E}peek(){return this.data[0]}_up(E){let{data:O,compare:R}=this,z=O[E];for(;E>0;){let V=E-1>>1,j=O[V];if(R(z,j)>=0)break;O[E]=j,E=V}O[E]=z}_down(E){let{data:O,compare:R}=this,z=this.length>>1,V=O[E];for(;E<z;){let z=1+(E<<1),j=z+1;if(j<this.length&&R(O[j],O[z])<0&&(z=j),R(O[z],V)>=0)break;O[E]=O[z],E=z}O[E]=V}};function GA(E,O,R=1,z=!1){let V=1/0,j=1/0,Y=-1/0,ee=-1/0;for(let[O,R]of E[0])O<V&&(V=O),R<j&&(j=R),O>Y&&(Y=O),R>ee&&(ee=R);let se=Y-V,he=ee-j,ce=Math.max(R,Math.min(se,he));if(ce===R){let E=[V,j];return E.distance=0,E.distance}let ue=new HB([],((E,O)=>O.max-E.max)),fe=nX(E),ve=new L0(V+se/2,j+he/2,0,E);ve.d>fe.d&&(fe=ve);let we=2;function m(V,j,Y){let ee=new L0(V,j,Y,E);if(we++,ee.max>fe.d+R&&ue.push(ee),ee.d>fe.d&&(fe=ee,z&&console.log(`found best ${Math.round(1e4*ee.d)/1e4} after ${we} probes`),fe.d>O))return O}let Se=ce/2;for(let E=V;E<Y;E+=ce)for(let O=j;O<ee;O+=ce)m(E+Se,O+Se,Se);for(;ue.length;){let{max:E,x:O,y:z,h:V}=ue.pop();if(E-fe.d<=R)break;Se=V/2,m(O-Se,z-Se,Se),m(O+Se,z-Se,Se),m(O-Se,z+Se,Se),m(O+Se,z+Se,Se)}z&&console.log(`num probes: ${we}\nbest distance: ${fe.d}`);let _e=[fe.x,fe.y];return _e.distance=fe.d,_e.distance}function L0(E,O,R,z){this.x=E,this.y=O,this.h=R,this.d=iX(E,O,z),this.max=this.d+this.h*Math.SQRT2}function iX(E,O,R){let z=!1,V=1/0;for(let j of R)for(let R=0,Y=j.length,ee=Y-1;R<Y;ee=R++){let Y=j[R],se=j[ee];Y[1]>O!=se[1]>O&&E<(se[0]-Y[0])*(O-Y[1])/(se[1]-Y[1])+Y[0]&&(z=!z),V=Math.min(V,sX(E,O,Y,se))}return V===0?0:(z?1:-1)*Math.sqrt(V)}function nX(E){let O=0,R=0,z=0,V=E[0];for(let E=0,j=V.length,Y=j-1;E<j;Y=E++){let j=V[E],ee=V[Y],se=j[0]*ee[1]-ee[0]*j[1];R+=(j[0]+ee[0])*se,z+=(j[1]+ee[1])*se,O+=se*3}let j=new L0(R/O,z/O,0,E);return O===0||j.d<0?new L0(V[0][0],V[0][1],0,E):j}function sX(E,O,R,z){let V=R[0],j=R[1],Y=z[0]-V,ee=z[1]-j;if(Y!==0||ee!==0){let R=((E-V)*Y+(O-j)*ee)/(Y*Y+ee*ee);R>1?(V=z[0],j=z[1]):R>0&&(V+=Y*R,j+=ee*R)}return Y=E-V,ee=O-j,Y*Y+ee*ee}var WB={vertices:[160,160,-160,160,-160,-160,160,-160],vertexIndices:[1,0,3,2],vertexCount:4,elements:[0,4],elementCount:1,mesh:void 0},QB={vertices:[],vertexIndices:[],vertexCount:0,elements:[],elementCount:0,mesh:void 0},KB={vertices:[-160,160,160,-160,160,160,-160,-160],vertexIndices:[1,3,0,2],vertexCount:4,elements:[0,1,2,1,0,3],elementCount:2,mesh:void 0},jA=(E,O)=>([R,z])=>(z<R&&(z+=O),(E>=R?E:E+O)<=z),JB=class extends Na{constructor(E,O,R=0,z=12,V=3,j=hB.ODD,Y=!1){super();this.forPathBevel=Y;this.type="ShapeGeometry";this.vertexCache={};this._shape=E,this._depth=O,this._curveSegments=z,this._bevelSegmentsInput=V;let ee=this._shape.extractShapePointsToFlatArray([],z),se=this._shape.shapeHoles.map((E=>{let O=E.extractShapePointsToFlatArray([],z),R=[];for(let E=O.length-1;E>=1;E-=2){let z=O[E-1],V=O[E-0];R.push(z,V)}return R})),he=[],ce=[];for(let E=0;E<ee.length;E+=2)ce.push([ee[E],ee[E+1]]);he.push(ce);for(let E=0;E<se.length;E++){let O=se[E],R=[];for(let E=0;E<O.length;E+=2)R.push([O[E],O[E+1]]);he.push(R)}let ue;ue=E.isText?(new Cf).setFromPoints(E.points.map((E=>E.position))).getSize(new bn).length()*.1:he[0].length===0?R:R>0?GA(he,R):1e-5,R<=0?(this._bevel=0,this._bevelSegments=0):(this._bevel=Math.min(R,ue,O/2),this._bevelSegments=Math.floor(V));let fe;try{fe=Xs({windingRule:j,elementType:cB.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[ee]})}catch{fe=WB}let ve;try{ve=Xs({windingRule:hB.ODD,elementType:cB.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[...se]})}catch{ve=QB}if(!fe)throw new Error("error generating geometry");let we=fe.elementCount;if(ve){fe.elementCount+=ve.elementCount;for(let E=0;E<ve.elements.length;E++){let O=ve.elements[E],R=E%2===0?fe.vertexCount:0;fe.elements.push(O+R)}for(let E=0;E<ve.vertexIndices.length;E++){let O=ve.vertexIndices[E],R=fe.vertexCount;fe.vertexIndices.push(O+R)}for(let E=0;E<ve.vertices.length;E++){let O=ve.vertices[E];fe.vertices.push(O)}}let Se=1/0,_e=-1/0,Ae=1/0,Ce=-1/0;for(let E=0,O=fe.vertexCount;E<O;E++){let O=E*2,R=fe.vertices[O+0],z=fe.vertices[O+1];R<Se&&(Se=R),R>_e&&(_e=R),z<Ae&&(Ae=z),z>Ce&&(Ce=z)}this._minX=Se,this._minY=Ae,this._width=_e-Se,this._height=Ce-Ae,this._buffer=new GB(this._computeBufferEstimatedSize(fe));let Te=[],Ie=[];for(let E=fe.elementCount-1;E>=0;E--){let O=E>=we,R=E*2,V=fe.elements[R+0],j=fe.elements[R+1],ee=V+j,he={start:V,count:j,normals:[],continuous:[],concave:[]},ce=V,ve=ee-1,Se=V+1,_e=this._shape.roundedCurves.length;do{let E=ce-V,R=fe.vertices[ve*2+0],z=fe.vertices[ve*2+1],Y=fe.vertices[ce*2+0],se=fe.vertices[ce*2+1],ue=fe.vertices[Se*2+0],we=fe.vertices[Se*2+1],Ae=Y-R,Ce=se-z,Te=Math.sqrt(Ae*Ae+Ce*Ce);Ae/=Te,Ce/=Te;let Ie=Y-ue,Fe=se-we,Ue=Math.sqrt(Ie*Ie+Fe*Fe);Ie/=Ue,Fe/=Ue,he.normals[E*2+0]=-Fe,he.normals[E*2+1]=Ie,he.concave[E]=Ae*Fe-Ce*Ie>0;let Ge=fe.vertexIndices[ce];if(Array.isArray(Ge))he.continuous[E]=!1;else{let[O,R]=this._shape.getCurveIndexFromVertexId(Ge-1,!0);if(R>0&&R<1)he.continuous[E]=!0;else{let z=R===1?O+1:O-1;z=(z+_e)%_e;let V=R===1?0:1,j=this._shape.roundedCurves[O].getTangent(R),Y=this._shape.roundedCurves[z].getTangent(V);he.continuous[E]=j.dot(Y)>.95}}O&&(he.normals[E*2+0]*=-1,he.normals[E*2+1]*=-1),[ve,ce,Se]=[ce,Se,Se+1],Se>=ee&&(Se-=j)}while(Se!==V+1);let Ae=[];Ae.push({bevelI:0,angle:0,size:0,boundary:{vertices:fe.vertices.slice(V*2,ee*2),vertexCount:j,vertexIndices:new Array(j).fill(!0).map(((E,O)=>[O,O])),elements:[0,j],elementCount:1,mesh:null},reverseMap:[],insetPoints:fe.vertices.slice(V*2,ee*2)});let Ce=0;for(let E=1;E<=this._bevelSegments;E++){let R=E/this._bevelSegments*Math.PI/2,V=(1-Math.cos(R))*this._bevel,Y=[],ee=[],se=[],ce=[],ue=0;for(let E=0;E<j;E++){let R=E*2,ve=(E-1+j)%j*2,we=fe.vertices[he.start*2+R+0],Se=fe.vertices[he.start*2+R+1],_e=-he.normals[ve+0]*V,Ae=-he.normals[ve+1]*V,Ce=-he.normals[R+0]*V,Te=-he.normals[R+1]*V;if(he.concave[E]||!he.concave[E]&&O){let R=Math.atan2(Ae,_e),j=Math.atan2(Te,Ce);j>R&&(j-=Math.PI*2);let ee=j-R;if(he.continuous[E]||O){let z=R+ee/2,j=Math.cos(z)*V,se=Math.sin(z)*V;Y[2*ue+0]=we+j*(O?-1:1),Y[2*ue+1]=Se+se*(O?-1:1),ce[ue]=E,ue++}else{let O=Math.max(1,Math.floor(z/4*Math.abs(ee)/Math.PI));for(let z=0;z<=O;z++){let j=R+ee*(z/O),se=Math.cos(j)*V,he=Math.sin(j)*V;Y[2*ue+0]=we+se,Y[2*ue+1]=Se+he,ce[ue]=E,ue++}}}else Y[2*ue+0]=we+_e,Y[2*ue+1]=Se+Ae,ce[ue]=E,ee[E]=ue,ue++,Y[2*ue+0]=we,Y[2*ue+1]=Se,ce[ue]=E,ue++,Y[2*ue+0]=we+Ce,Y[2*ue+1]=Se+Te,ce[ue]=E,se[E]=ue,ue++}let ve=Xs({windingRule:hB.POSITIVE,elementType:cB.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[Y],edgeCreateCallback:E=>{let O=E.Org.idx,R=ce[O],z=ce[(O+1)%ce.length];E.idx=[R,z],E.Sym.idx=[z,R]},vertexIdCallback:E=>{let O=E.Lprev.idx;return[O?O[1]:0,E.idx?E.idx[0]:0]}});if(!ve)throw console.log("Error"),new Error(`error generating bevel geometry for ${E}'th loop`);if(!ve.vertexCount){let O=(E-1)/this._bevelSegments*Math.PI/2;Ce=(1-Math.sin(O))*this._bevel;break}for(let E=0;E<ve.vertexIndices.length;E++){let[O,R]=ve.vertexIndices[E];if(O===R)continue;let z=R;R<O&&(z+=j);for(let V=O;V<z;V++){let z=V%j,Y=(V+1)%j;if(!he.continuous[z]||!he.continuous[Y]){ve.vertexIndices[E]=[O,z],ve.vertexIndices.splice(E+1,0,[Y,R]),ve.vertices.splice((E+1)*2,0,ve.vertices[E*2],ve.vertices[E*2+1]);break}}}Ae.push({bevelI:E,angle:R,size:V,boundary:ve,reverseMap:ce,insetPoints:Y})}let te=(E,O,R)=>{let z=0,V=E.boundary.vertexIndices.length;for(;z<V&&R(E.boundary.vertexIndices[O]);)O=(O+1)%V,z++;return z},Fe=Te.length;for(let E=1;E<Ae.length;E++){let O=Ae[E-1],R=Ae[E],z=O.boundary.vertexIndices.length,V=R.boundary.vertexIndices.length;if(!z||!V)break;let ee=he.concave.length,se=0,ce=jA(se,j);for(;!O.boundary.vertexIndices.filter(ce).length||!R.boundary.vertexIndices.filter(ce).length;)se++,ce=jA(se,j);let ue=O.boundary.vertexIndices.findIndex(ce),fe=R.boundary.vertexIndices.findIndex(ce);do{ue=(ue+1)%z}while(ce(O.boundary.vertexIndices[ue]));do{fe=(fe+1)%V}while(ce(R.boundary.vertexIndices[fe]));se=(se+1)%j;let ve,we,Se=se,_e=0,Ce=this._buildBevelVert(he,O,(ue-1+z)%z,void 0,_e),Ie=this._buildBevelVert(he,R,(fe-1+V)%V,void 0,_e),Fe=Ce,Ue=Ie,Ge=!1;do{_e=(se||ee)/ee,ce=jA(se,j);let E=te(O,ue,ce),Se=te(R,fe,ce),Ae=Ge;if(Ge=!1,E&&!Se){for(let R=0;R<E;R++)ve=this._buildBevelVert(he,O,(ue+R)%z,R/(E-1),_e),Te.push(Fe.topN,ve.topP,Ue.topN),Y===!1&&Te.push(ve.bottomP,Fe.bottomN,Ue.bottomN),Fe=ve;Ge=!0}else if(!E&&Se)for(let E=0;E<Se;E++)we=this._buildBevelVert(he,R,(fe+E)%V,E/(Se-1),_e),Te.push(Ue.topN,Fe.topP,we.topP),Y===!1&&Te.push(Fe.bottomP,Ue.bottomN,we.bottomP),Ue=we;else if(E&&Se)if(ve=this._buildBevelVert(he,O,ue,0,_e),we=this._buildBevelVert(he,R,fe,0,_e),Ae?(Te.push(Fe.topN,we.topP,Ue.topN),Te.push(Fe.topN,ve.topP,we.topP),Y===!1&&(Te.push(we.bottomP,Fe.bottomN,Ue.bottomN),Te.push(we.bottomP,ve.bottomP,Fe.bottomN))):(Te.push(Ue.topN,Fe.topN,ve.topP),Te.push(Ue.topN,ve.topP,we.topP),Y===!1&&(Te.push(ve.bottomP,Fe.bottomN,Ue.bottomN),Te.push(ve.bottomP,Ue.bottomN,we.bottomP))),Fe=ve,Ue=we,E===Se)for(let j=1;j<E;j++)ve=this._buildBevelVert(he,O,(ue+j)%z,j/(E-1),_e),we=this._buildBevelVert(he,R,(fe+j)%V,j/(Se-1),_e),Te.push(Fe.topN,ve.topP,Ue.topN),Te.push(Ue.topN,ve.topP,we.topP),Y===!1&&(Te.push(ve.bottomP,Fe.bottomN,Ue.bottomN),Te.push(ve.bottomP,Ue.bottomN,we.bottomP)),Fe=ve,Ue=we;else if(E>Se){let j=E/Se,ee=0;for(let se=1;se<E;se++)ve=this._buildBevelVert(he,O,(ue+se)%z,se/(E-1),_e),Te.push(Fe.topN,ve.topP,Ue.topN),Y===!1&&Te.push(ve.bottomP,Fe.bottomN,Ue.bottomN),Fe=ve,se>(ee+1)*j&&(ee++,we=this._buildBevelVert(he,R,(fe+ee)%V,ee/(Se-1),_e),Te.push(Ue.topN,ve.topP,we.topP),Y===!1&&Te.push(ve.bottomP,Ue.bottomN,we.bottomP),Ue=we)}else{let j=Se/E,ee=0;for(let se=1;se<Se;se++)we=this._buildBevelVert(he,R,(fe+se)%V,se/(Se-1),_e),Te.push(Ue.topN,ve.topP,we.topP),Y===!1&&Te.push(ve.bottomP,Ue.bottomN,we.bottomP),Ue=we,se>(ee+1)*j&&(ee++,ve=this._buildBevelVert(he,O,(ue+ee)%z,ee/(E-1),_e),Te.push(Fe.topN,ve.topP,Ue.topN),Y===!1&&Te.push(ve.bottomP,Fe.bottomN,Ue.bottomN),Fe=ve)}ue=(ue+E)%z,fe=(fe+Se)%V,se=(se+1)%ee}while(se!==Se)}if(Y===!1&&this._depth>this._bevel*2&&this._buildWall(Ae,he,Te),O){let E=[];for(let O=Te.length-1;O>=Fe+2;O-=3){let R=Te[O-2],z=Te[O-1],V=Te[O-0];E.push(V,z,R)}Te.splice(Fe,Te.length-Fe,...E)}if(O){let E=[];for(let O=Ae[Ae.length-1].boundary.vertices.length-1;O>=1;O-=2){let R=Ae[Ae.length-1].boundary.vertices[O-1],z=Ae[Ae.length-1].boundary.vertices[O-0];E.push(R,z)}Ie.push(E)}if(!O){let E,O=Ae[Ae.length-1];try{E=Xs({windingRule:Ae.length>1?hB.POSITIVE:hB.ODD,elementType:cB.POLYGONS,vertexSize:2,strict:!0,contours:[O.insetPoints,...Ie]})}catch{E=KB}if(!E)throw new Error("Error generating geometry for surface");se.length===0&&this._bevel<ue&&Object.assign(this,{useNgonForTopBottomFaceDuringBake:!0});for(let O=0;O<E.elementCount*3;O+=3){let R=this._buildSurfaceVert(E,E.elements[O+0],Ce),z=this._buildSurfaceVert(E,E.elements[O+1],Ce),V=this._buildSurfaceVert(E,E.elements[O+2],Ce);Te.push(R.top,z.top,V.top),Y===!1&&Te.push(V.bottom,z.bottom,R.bottom)}}this.vertexCache={}}this._buffer.shrink();let Fe=new Sa(Uint32Array.from(Te),1),Ue=new Sa(this._buffer.positions,3),Ge=new Sa(this._buffer.normals,3),qe=new Sa(this._buffer.uvs,2);Ue.needsUpdate=!0,Ge.needsUpdate=!0,qe.needsUpdate=!0,Fe.needsUpdate=!0,this.setAttribute("position",Ue),this.setAttribute("normal",Ge),this.setAttribute("uv",qe),this.setIndex(Fe)}_computeBufferEstimatedSize(E){return E.vertexCount*2*(2+this._bevelSegments)}_buildWall(E,O,R){let z=E[0];for(let E=0,V=z.boundary.vertexCount;E<V;E++){let j=this._buildBevelVert(O,z,E),Y=this._buildBevelVert(O,z,(E+1)%V);R.push(Y.topP,j.topN,j.bottomN),R.push(Y.topP,j.bottomN,Y.bottomP)}}_buildSurfaceVert(E,O,R){let z=O.toString();if(z in this.vertexCache)return this.vertexCache[z];let V=E.vertices[O*2+0],j=E.vertices[O*2+1],Y=(V-this._minX)/this._width,ee=(j-this._minY)/this._height;this.forPathBevel&&(ee=1);let se=this._buffer.get(this.forPathBevel?1:2),he=se*3,ce=se*2,ue={top:se+0,bottom:se+1};return this._buffer.positions[he+0]=V,this._buffer.positions[he+1]=j,this._buffer.positions[he+2]=this.forPathBevel?this._bevel:this._depth-R,this._buffer.normals[he+0]=0,this._buffer.normals[he+1]=0,this._buffer.normals[he+2]=1,this._buffer.uvs[ce+0]=Y,this._buffer.uvs[ce+1]=ee,this.forPathBevel===!1&&(this._buffer.positions[he+3]=V,this._buffer.positions[he+4]=j,this._buffer.positions[he+5]=R,this._buffer.normals[he+3]=0,this._buffer.normals[he+4]=0,this._buffer.normals[he+5]=-1,this._buffer.uvs[ce+2]=Y,this._buffer.uvs[ce+3]=ee),this.vertexCache[z]=ue,ue}_buildBevelVert(E,O,R,z=1,V){let j=`${O.bevelI}:${R}`;if(j in this.vertexCache&&V!==0&&V!==1&&(!V||V===this.vertexCache[j].pathBevelUCoord))return this.vertexCache[j];let Y,ee,se,he,[ce,ue]=O.boundary.vertexIndices[R];ce!==ue?(ee=ce,Y=ue,he=!1,se=E.continuous[ee]&&E.continuous[Y]):(Y=ce,ee=(Y-1+E.count)%E.count,he=E.concave[Y]&&O.bevelI>0,se=E.continuous[Y]||he);let fe=Math.cos(O.angle),ve=Math.sin(O.angle),we=R*2,Se=Y*2,_e=ee*2,Ae=O.boundary.vertices[we+0],Ce=O.boundary.vertices[we+1],Te=(1-ve)*this._bevel,Ie=(Ae-this._minX)/this._width,Fe=(Ce-this._minY)/this._height;this.forPathBevel&&(V!==void 0&&(Ie=V),Fe=1);let Ue=E.normals[Se+0],Ge=E.normals[Se+1],qe=E.normals[_e+0],Xe=E.normals[_e+1];if(he){let E=qe-Ue,O=Xe-Ge;Ue+=E*(1-z),Ge+=O*(1-z);let R=Math.sqrt(Ue*Ue+Ge*Ge);Ue/=R,Ge/=R}let Qe=this.forPathBevel?this._buffer.get(se?1:2):this._buffer.get(se?2:4),Ze=Qe*3,Ke=Qe*2,Je={i:R,fi:Y,topP:Qe+0,topN:Qe+0,bottomP:Qe+1,bottomN:Qe+1,pathBevelUCoord:V};return this._buffer.positions[Ze+0]=Ae,this._buffer.positions[Ze+1]=Ce,this._buffer.positions[Ze+2]=(this.forPathBevel?this._bevel:this._depth)-Te,this._buffer.normals[Ze+0]=Ue*fe,this._buffer.normals[Ze+1]=Ge*fe,this._buffer.normals[Ze+2]=ve,this._buffer.uvs[Ke+0]=Ie,this._buffer.uvs[Ke+1]=Fe,this.forPathBevel===!1&&(this._buffer.positions[Ze+3]=Ae,this._buffer.positions[Ze+4]=Ce,this._buffer.positions[Ze+5]=Te,this._buffer.normals[Ze+3]=Ue*fe,this._buffer.normals[Ze+4]=Ge*fe,this._buffer.normals[Ze+5]=-ve,this._buffer.uvs[Ke+2]=Fe,this._buffer.uvs[Ke+3]=Ie),se||(this.forPathBevel?(Qe+=1,Ze+=3,Ke+=2):(Qe+=2,Ze+=6,Ke+=4),Je.topP=Qe+0,Je.bottomP=Qe+1,this._buffer.positions[Ze+0]=Ae,this._buffer.positions[Ze+1]=Ce,this._buffer.positions[Ze+2]=(this.forPathBevel?this._bevel:this._depth)-Te,this._buffer.normals[Ze+0]=qe*fe,this._buffer.normals[Ze+1]=Xe*fe,this._buffer.normals[Ze+2]=ve,this._buffer.uvs[Ke+0]=Ie,this._buffer.uvs[Ke+1]=Fe,this.forPathBevel===!1&&(this._buffer.positions[Ze+3]=Ae,this._buffer.positions[Ze+4]=Ce,this._buffer.positions[Ze+5]=Te,this._buffer.normals[Ze+3]=qe*fe,this._buffer.normals[Ze+4]=Xe*fe,this._buffer.normals[Ze+5]=-ve,this._buffer.uvs[Ke+2]=Fe,this._buffer.uvs[Ke+3]=Ie)),this.vertexCache[j]=Je,Je}clone(){let E=new JB(this._shape,this._depth,this._bevel,this._curveSegments,this._bevelSegmentsInput);return E.userData=z_(this.userData),E}};var ez=class extends Na{constructor(E,O=12,R={}){super();this.type="ShapeGeometry";this.windingRule=hB.ODD;this.elementType=cB.POLYGONS;this.polySize=3;this.vertexSize=2;this.strict=!0;this._shape=E,this._curveSegments=O,this._triangulationOptions=Object.assign({windingRule:hB.ODD,elementType:cB.POLYGONS,polySize:3,vertexSize:2,strict:!0},R);let z,V,j,Y=this._shape.extractShapePointsToFlatArray([],this._curveSegments),ee=this._shape.shapeHoles.map((E=>E.extractShapePointsToFlatArray([],this._curveSegments))),se=!0,he=!0;for(let E=0,O=Y.length/2;E<O;E++){let O=E*2,R=Y[O+0],z=Y[O+1];if(V!==void 0&&R!==V&&(se=!1),j!==void 0&&z!==j&&(he=!1),V=R,j=z,!se&&!he)break}if(!se&&!he)try{z=Xs({contours:[Y,...ee],windingRule:this._triangulationOptions.windingRule,elementType:this._triangulationOptions.elementType,polySize:this._triangulationOptions.polySize,vertexSize:this._triangulationOptions.vertexSize,strict:this._triangulationOptions.strict})}catch{z=WB}let ce=z?.vertexCount??1,ue=z?.elementCount??1;if(this._positionAttribute=new Sa(new Float32Array(ce*3),3),this._normalAttribute=new Sa(new Float32Array(ce*3),3),this._uvAttribute=new Sa(new Float32Array(ce*2),2),this._indexAttribute=new Sa(new Uint32Array(ue*3),1),z){let E=1/0,O=-1/0,R=1/0,V=-1/0;for(let j=0,Y=ce;j<Y;j++){let Y=j*2,ee=z.vertices[Y+0],se=z.vertices[Y+1];ee<E&&(E=ee),ee>O&&(O=ee),se<R&&(R=se),se>V&&(V=se)}let j=O-E,Y=V-R;for(let O=0,V=ce;O<V;O++){let V=O*2,ee=z.vertices[V+0],se=z.vertices[V+1],he=(ee-E)/j,ce=(se-R)/Y;this._positionAttribute.setXYZ(O,ee,se,0),this._normalAttribute.setXYZ(O,0,0,1),this._uvAttribute.setXY(O,he,ce)}for(let E=0,O=ue;E<O;E++){let O=E*3,R=z.elements[O+0],V=z.elements[O+1],j=z.elements[O+2];this._indexAttribute.setX(O+0,R),this._indexAttribute.setX(O+1,V),this._indexAttribute.setX(O+2,j)}}this.setAttribute("position",this._positionAttribute),this.setAttribute("normal",this._normalAttribute),this.setAttribute("uv",this._uvAttribute),this.setIndex(this._indexAttribute),this.setDrawRange(0,(z?.elementCount??1)*3)}clone(){let E=new ez(this._shape,this._curveSegments);return E.userData=z_(this.userData),E}};var tz=class extends JB{constructor(E,O,R=0,z=12,V=3,j=hB.ODD){super(E,O,R,z,V,j);this.type="ShapeGeometry"}_computeBufferEstimatedSize(E){return E.vertexCount*2*(2+this._bevelSegments)}_buildWall(E,O,R){let z=E[0];for(let E=0,V=z.boundary.vertexCount;E<V;E++){let j=this._buildBevelVert(O,z,E),Y=this._buildBevelVert(O,z,(E+1)%V);R.push(Y.topP,j.topN,j.bottomN),R.push(Y.topP,j.bottomN,Y.bottomP)}}clone(){let E=new tz(this._shape,this._depth,this._bevel,this._curveSegments,this._bevelSegmentsInput);return E.userData=z_(this.userData),E}};var iz=class{static create(E){return this.build(this.normalizeInputs(E))}static normalizeInputs(E,O){let R=Object.assign({},O?.parameters??{width:100,subdivisions:40,roundness:0,extrudeBevelSize:0,extrudeBevelSegments:3,windingRule:hB.ODD},E.parameters),z=Math.abs(R.width),V=Math.abs(R.height??R.width),j=Math.abs(R.depth??0),Y=E.shape??O?.shape,ee=Y?.roundness??R.roundness;Y!==void 0&&(Y instanceof oB?(Y.width!==z||Y.height!==V)&&Y.applySize(z,V):Y=new oB(z,V).fromJSON(Y),E.parameters?.roundness!==void 0&&E.parameters?.roundness>0&&Y.update());let se=Y??new oB(z,V);return{parameters:Object.assign(R,{width:z,height:V,depth:j,roundness:ee}),shape:se}}static build(E){let{depth:O,extrudeBevelSize:R,extrudeBevelSegments:z,subdivisions:V,roundness:j,windingRule:Y}=E.parameters;E.shape.roundness=j;let ee;return ee=O<=0?new ez(E.shape,V,{windingRule:Y}):new tz(E.shape,O,R,V,z,Y),Object.assign(ee,{userData:{...E,type:"VectorGeometry"}})}};var rz=Math.PI*2,nz=class{static create(E){return this.build(this.normalizeInputs(E))}static normalizeInputs(E,O){let R=Object.assign({},O?.parameters??{width:100,depth:0,spikes:64,angle:360,innerRadius:0,extrudeBevelSize:0,extrudeBevelSegments:1},E.parameters);return R.angle=xn.clamp(R.angle,0,360),{shape:E.shape&&E.shape instanceof oB?E.shape:new oB,parameters:Object.assign(R,{width:Math.abs(R.width),height:Math.abs(R.height??R.width),depth:Math.abs(R.depth??0)})}}static build(E){let{width:O,height:R,spikes:z,angle:V,innerRadius:j,depth:Y,extrudeBevelSize:ee,extrudeBevelSegments:se}=E.parameters,he=E.shape,ce=O*.5,ue=R*.5,fe=oX(he,ce,ue,V*Math.PI/180,z,j);he.isClosed=!0,he.update();let ve;return V===0?(ve=new Na,ve.setAttribute("position",new Ma([],3))):ve=iz.create({shape:he,parameters:{subdivisions:fe,depth:Y,extrudeBevelSize:ee,extrudeBevelSegments:se}}),Object.assign(ve,{userData:{...E,type:"EllipseGeometry"}})}};function oX(E,O,R,z,V,j){if(z>=rz)return V>30||V%4===0?(lX(E,O,R,j),Math.round(V/4)):GO(E,z,V,O,R,j);z=Math.max(z,.001);let Y={x:0,y:R},ee=z+Math.PI*.5,se={x:Math.cos(ee)*O,y:Math.sin(ee)*R},he=FO({px:Y.x,py:Y.y,cx:se.x,cy:se.y,rx:O,ry:R,largeArcFlag:z>Math.PI,sweepFlag:!0});return V>30||V%he.length===0?aX(E,Y.x,Y.y,he,V,O,R,j):GO(E,z,V,O,R,j)}function aX(E,O,R,z,V,j,Y,ee){let se=Math.round(V/z.length);E.addPoint(Id(O,R));for(let O=0,R=z.length;O<R;O++){let R=z[O],V=E.points[O],j=Id(R.x,R.y);V.controls[1].position.set(R.x1,R.y1),j.controls[0].position.set(R.x2,R.y2),E.addPoint(j)}return ee>0?HO(E,j,Y,ee):E.addPoint(Id(0,0)),se}function GO(E,O,R,z,V,j){let Y=-O/R;for(let O=0;O<=R;O++){let R=Y*O,j=Math.sin(R)*z,ee=Math.cos(R)*V;E.addPoint(Id(j,ee))}return O<rz?j>0?HO(E,z,V,j):E.addPoint(Id(0,0)):(E.removePoint(E.points[E.points.length-1]),j>0&&WO(E,z,V,j)),1}function lX(E,O,R,z=0,V=0,j=0){let Y=.5522847498,ee=O*Y,se=R*Y;E.addPoint(B0(V-O,j,V-O,j-se,V-O,j+se)),E.addPoint(B0(V,j+R,V-ee,j+R,V+ee,j+R)),E.addPoint(B0(V+O,j,V+O,j+se,V+O,j-se)),E.addPoint(B0(V,j-R,V+ee,j-R,V-ee,j-R)),z>0&&WO(E,O,R,z)}function Id(E,O){return new RL(xn.generateUUID(),new bn(E,O))}function B0(E,O,R,z,V,j){let Y=Id(E,O);return Y.controls[0].position.set(R,z),Y.controls[1].position.set(V,j),Y}function HO(E,O,R,z){qO(E,O,R,z).forEach((O=>E.addPoint(O)))}function WO(E,O,R,z){let V=qO(E,O,R,z),j=new oB;V.forEach((E=>j.addPoint(E))),j.isClosed=!0,E.shapeHoles.push(j)}function qO(E,O,R,z){let V=z*O/100,j=V*(Math.abs(R)/Math.abs(O)),Y=new bn(V/O,j/R),ee=E.points.map((E=>{let O=E.clone();return O.uuid=xn.generateUUID(),O})).reverse();return ee.forEach((E=>{E.position.multiply(Y);let O=E.controls[0].position.clone().multiply(Y),R=E.controls[1].position.clone().multiply(Y);E.controls[0].position.copy(R),E.controls[1].position.copy(O)})),ee}var sz=class{static create(E){return this.build(this.normalizeInputs(E))}static normalizeInputs(E,O){let R=Object.assign({},O?.parameters??{width:100,revolutions:2,segments:40,pathRadius:10,pathType:0,pathSegments:30,cornerRadius:30,cornerSegments:4},E.parameters),z=Math.abs(R.width),V=Math.abs(R.height??z),j=Math.abs(R.depth??z),Y=Math.abs(Math.min(z,j))/2;return{parameters:Object.assign(R,{width:z,height:V,depth:j,radius:Y,segments:Math.round(R.segments),pathSegments:Math.round(R.pathSegments),cornerSegments:Math.round(R.cornerSegments)})}}static build(E){let{width:O,height:R,depth:z,radius:V,revolutions:j,segments:Y,pathRadius:ee,pathType:se,pathSegments:he,cornerRadius:ce,cornerSegments:ue}=E.parameters,fe=new oz(!1,O,R,z,V,j,Y,ee,se,he,ce,ue);return Object.assign(fe,{userData:{...E,type:"HelixGeometry"}})}},az=new Aa([0,0,0],1),oz=class extends Na{constructor(E=!0,O=1,R=1,z=1,V=1,j=1,Y=1,ee=1,se=1,he=1,ce=1,ue=1){if(super(),j===0)return;let fe=E&&j===1;fe&&(ue=0),ce>100&&(ce=100),ce===0&&(ue=0);let ve,we,Se,_e,Ae,Ce,Te,Ie,p=()=>new Wn,Fe=new Wn,Ue=p(),Ge=p(),qe=p(),Xe=p(),Qe=p(),Ze=p(),Ke=p(),Je=p(),$e=p(),et=p(),it=p(),rt=R-2*ee+.001,at=rt/j,lt=Math.ceil(Y*j),ct=lt+1,dt=rt/lt,ut=-rt/2,pt=he+1,mt=2*Math.PI/he,gt=Math.PI/2/ue,yt=.01,St=Math.min((1-ce/100)*ee,ee-yt),_t=ee-St,Mt=0,Et=2,Tt=ue*Et+Et,It=pt*Tt/Et,Lt=It+pt*ct,Bt=Math.max(0,pt*(ct+Tt)),[Ft,Ut,jt]=[3,3,2].map((E=>Array(Bt*E).fill(0))),Gt=[],Wt=V-ee;function N(O,R){let z=Math.PI/2;Ce=R*dt,Ie=2*Math.PI*(Ce%at)/at+z,Ce+=ut,Te=Math.sin(Ie)*Wt,Ae=Math.cos(Ie)*Wt,E?O.set(Ae,Te,Ce):O.set(Ae,Ce,Te)}N(Fe,-1e-10),N(Ue,0),Xe.copy(Fe),N(Fe,1);let qt=Fe.distanceTo(Ue),Xt=fe?0:_t+St,Qt=qt*lt+2*Xt,Zt=St,Kt=Qt-Xt;for(let O=0;O<=lt;O++){N(Ge,O),it.subVectors(Ge,Xe).normalize(),Xe.copy(Ge),$e.copy(Ge).setComponent(+E+1,0).normalize(),et.crossVectors(it,$e).normalize();let R=O===0,z=O===lt,V=R?3*Math.PI/2:gt,j=R?Zt:Kt,Y=R?pt:Lt,se=R?0:Bt-pt,ce=it.clone().multiplyScalar(R?-_t:_t).add(Ge),ve=it.clone().multiplyScalar(R?-1:1).normalize();for(let E=0;E<pt;E++){let we=E*mt;if(Qe.addVectors(Fe.copy($e).multiplyScalar(ee*Math.cos(we)),Ue.copy(et).multiplyScalar(ee*Math.sin(we))),Ze.copy(Qe).normalize(),R||z){fe||(Mt=se+E,[0,1,2].forEach((E=>{Ft[Mt*3+E]=ce.getComponent(E),Ut[Mt*3+E]=ve.getComponent(E)})),jt[Mt*2]=+z,jt[Mt*2+1]=E/he),Ue.copy(Ze).multiplyScalar(St),qe.addVectors(Ge,Ue);for(let O=0;O<ue;O++){let z=O*gt+V;Ke.addVectors(Fe.copy(it).multiplyScalar(_t*Math.sin(z)),Ue.copy(Ze).multiplyScalar(_t*Math.cos(z))),Je.copy(Ke).normalize(),Ue.addVectors(qe,Ke),Ke.normalize(),Mt=Y+O*pt+E,[0,1,2].forEach((E=>{Ft[Mt*3+E]=Ue.getComponent(E),Ut[Mt*3+E]=Je.getComponent(E)}));let ee=+R+Math.sin(z);jt[Mt*2]=(j+_t*ee)/Qt,jt[Mt*2+1]=E/he}}Ue.addVectors(Ge,Qe),Mt=It+O*pt+E,[0,1,2].forEach((E=>{Ft[Mt*3+E]=Ue.getComponent(E),Ut[Mt*3+E]=Ze.getComponent(E)})),jt[Mt*2]=(Xt+O*qt)/Qt,jt[Mt*2+1]=E/he}}let Jt=ct+2*ue+Et,[$t,ti]=[+fe,Jt-1];for(let E=$t;E<=ti-1;E++){let O=fe&&E===ti-1;for(let R=0;R<pt-1;R++)ve=E*pt+R,we=ve+1,Se=(O?R:ve)+pt,_e=(O?R+1:we)+pt,E===0?Gt.push(we,_e,Se):E===Jt-2?Gt.push(ve,we,Se):Gt.push(ve,we,Se,we,_e,Se)}this.setIndex(Gt),this.setAttribute("position",new Ma(Ft,3)),this.setAttribute("normal",new Ma(Ut,3)),this.setAttribute("uv",new Ma(jt,2))}getClosedTorusIndicesForBooleanOrSubdiv(){let E,O,R,z,V=this.userData.parameters,j=Math.ceil(V.tubularSegments),Y=V.radialSegments+1,ee=Array.from(this.getIndex().array),se=6*(j-1)*V.radialSegments,he=j,ce=he===j;for(let j=0;j<V.radialSegments;j++)E=he*Y+j,O=E+1,R=(ce?j:E)+Y,z=(ce?j+1:O)+Y,ee[se++]=E,ee[se++]=O,ee[se++]=R,ee[se++]=O,ee[se++]=z,ee[se++]=R;return ee.length=se,az.array=ee,az.count=ee.length,az}};var lz=class{static create(E){return this.build(this.normalizeInputs(E))}static normalizeInputs(E,O){let R=Object.assign({},O?.parameters??{width:100,detail:0,corner:0,cornerSides:4},E.parameters);return{parameters:Object.assign(R,{width:Math.abs(R.width),height:Math.abs(R.height??R.width),depth:Math.abs(R.depth??R.width)})}}static build(E){let{width:O,height:R,depth:z,detail:V,corner:j,cornerSides:Y}=E.parameters,ee=V===0&&j!==0?new hz(O*.5,j,Y):new Ju(O*.5,V);return ee.scale(1,R/O,z/O),Object.assign(ee,{userData:{...E,type:"IcosahedronGeometry"}})}},hz=class extends bL{constructor(E=1,O=.2,R=4){let z=(1+Math.sqrt(5))/2,V=[-1,z,0,1,z,0,-1,-z,0,1,-z,0,0,-1,z,0,1,z,0,-1,-z,0,1,-z,z,0,-1,z,0,1,-z,0,-1,-z,0,1],j=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],Y="IcosahedronGeometry";super(V,j,Y,E,O,R),this.type=Y}static fromJSON(E){return new hz(E.radius,E.corner,E.cornerSides)}};var cz=class{static create(E){return this.build(this.normalizeInputs(E))}static normalizeInputs(E,O){(E.parameters?.points??[]).forEach((E=>{Array.isArray(E)&&(E.x=E[0],E.y=E[1])}));let R=Object.assign({},O?.parameters??{width:100,segments:64,verticalSegments:64,points:[{x:0,y:-50,id:0},{x:50,y:-50,id:1},{x:50,y:50,id:2},{x:0,y:50,id:3}]},E.parameters);return{parameters:Object.assign(R,{width:Math.abs(R.width),height:Math.abs(R.height??R.width),depth:Math.abs(R.depth??R.width)})}}static build(E){let{points:O,segments:R,verticalSegments:z}=E.parameters,V=new Qu;V.moveTo(O[0].x,O[0].y),V.bezierCurveTo(O[1].x,O[1].y,O[2].x,O[2].y,O[3].x,O[3].y);let j=new Hu(V.extractPoints(z).shape,R);return j.rotateZ(Math.PI),Object.assign(j,{userData:{...E,type:"LatheGeometry"}})}};var dz=new Es,uz=new ra,pz=new Wn,fz=class extends pn{constructor(){super(),this.uuid=xn.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}applyMatrix4(E){let O=(new wn).getNormalMatrix(E);for(let O=0,R=this.vertices.length;O<R;O++)this.vertices[O].applyMatrix4(E);for(let E=0,R=this.faces.length;E<R;E++){let R=this.faces[E];R.normal.applyMatrix3(O).normalize();for(let E=0,z=R.vertexNormals.length;E<z;E++)R.vertexNormals[E].applyMatrix3(O).normalize()}return this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this}rotateX(E){return dz.makeRotationX(E),this.applyMatrix4(dz),this}rotateY(E){return dz.makeRotationY(E),this.applyMatrix4(dz),this}rotateZ(E){return dz.makeRotationZ(E),this.applyMatrix4(dz),this}translate(E,O,R){return dz.makeTranslation(E,O,R),this.applyMatrix4(dz),this}scale(E,O,R){return dz.makeScale(E,O,R),this.applyMatrix4(dz),this}lookAt(E){return uz.lookAt(E),uz.updateMatrix(),this.applyMatrix4(uz.matrix),this}fromBufferGeometry(E){let O=this,R=E.index!==null?E.index:void 0,z=E.attributes;if(z.position===void 0)return console.error("THREE.Geometry.fromBufferGeometry(): Position attribute required for conversion."),this;let V=z.position,j=z.normal,Y=z.color,ee=z.uv,se=z.uv2;se!==void 0&&(this.faceVertexUvs[1]=[]);for(let E=0;E<V.count;E++)O.vertices.push((new Wn).fromBufferAttribute(V,E)),Y!==void 0&&O.colors.push((new On).fromBufferAttribute(Y,E));function u(E,R,z,V){let he=Y===void 0?[]:[O.colors[E].clone(),O.colors[R].clone(),O.colors[z].clone()],ce=j===void 0?[]:[(new Wn).fromBufferAttribute(j,E),(new Wn).fromBufferAttribute(j,R),(new Wn).fromBufferAttribute(j,z)],ue=new gz(E,R,z,ce,he,V);O.faces.push(ue),ee!==void 0&&O.faceVertexUvs[0].push([(new bn).fromBufferAttribute(ee,E),(new bn).fromBufferAttribute(ee,R),(new bn).fromBufferAttribute(ee,z)]),se!==void 0&&O.faceVertexUvs[1].push([(new bn).fromBufferAttribute(se,E),(new bn).fromBufferAttribute(se,R),(new bn).fromBufferAttribute(se,z)])}let he=E.groups;if(he.length>0)for(let E=0;E<he.length;E++){let O=he[E],z=O.start,V=O.count;for(let E=z,j=z+V;E<j;E+=3)R!==void 0?u(R.getX(E),R.getX(E+1),R.getX(E+2),O.materialIndex):u(E,E+1,E+2,O.materialIndex)}else if(R!==void 0)for(let E=0;E<R.count;E+=3)u(R.getX(E),R.getX(E+1),R.getX(E+2));else for(let E=0;E<V.count;E+=3)u(E,E+1,E+2);return this.computeFaceNormals(),E.boundingBox!==null&&(this.boundingBox=E.boundingBox.clone()),E.boundingSphere!==null&&(this.boundingSphere=E.boundingSphere.clone()),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(pz).negate(),this.translate(pz.x,pz.y,pz.z),this}normalize(){this.computeBoundingSphere();let E=this.boundingSphere.center,O=this.boundingSphere.radius,R=O===0?1:1/O,z=new Es;return z.set(R,0,0,-R*E.x,0,R,0,-R*E.y,0,0,R,-R*E.z,0,0,0,1),this.applyMatrix4(z),this}computeFaceNormals(){let E=new Wn,O=new Wn;for(let R=0,z=this.faces.length;R<z;R++){let z=this.faces[R],V=this.vertices[z.a],j=this.vertices[z.b],Y=this.vertices[z.c];E.subVectors(Y,j),O.subVectors(V,j),E.cross(O),E.normalize(),z.normal.copy(E)}}computeVertexNormals(E=!0){let O=new Array(this.vertices.length);for(let E=0,R=this.vertices.length;E<R;E++)O[E]=new Wn;if(E){let E=new Wn,R=new Wn;for(let z=0,V=this.faces.length;z<V;z++){let V=this.faces[z],j=this.vertices[V.a],Y=this.vertices[V.b],ee=this.vertices[V.c];E.subVectors(ee,Y),R.subVectors(j,Y),E.cross(R),O[V.a].add(E),O[V.b].add(E),O[V.c].add(E)}}else{this.computeFaceNormals();for(let E=0,R=this.faces.length;E<R;E++){let R=this.faces[E];O[R.a].add(R.normal),O[R.b].add(R.normal),O[R.c].add(R.normal)}}for(let E=0,R=this.vertices.length;E<R;E++)O[E].normalize();for(let E=0,R=this.faces.length;E<R;E++){let R=this.faces[E],z=R.vertexNormals;z.length===3?(z[0].copy(O[R.a]),z[1].copy(O[R.b]),z[2].copy(O[R.c])):(z[0]=O[R.a].clone(),z[1]=O[R.b].clone(),z[2]=O[R.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)}computeFlatVertexNormals(){this.computeFaceNormals();for(let E=0,O=this.faces.length;E<O;E++){let O=this.faces[E],R=O.vertexNormals;R.length===3?(R[0].copy(O.normal),R[1].copy(O.normal),R[2].copy(O.normal)):(R[0]=O.normal.clone(),R[1]=O.normal.clone(),R[2]=O.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)}computeMorphNormals(){for(let E=0,O=this.faces.length;E<O;E++){let O=this.faces[E];O.__originalFaceNormal?O.__originalFaceNormal.copy(O.normal):O.__originalFaceNormal=O.normal.clone(),O.__originalVertexNormals||(O.__originalVertexNormals=[]);for(let E=0,R=O.vertexNormals.length;E<R;E++)O.__originalVertexNormals[E]?O.__originalVertexNormals[E].copy(O.vertexNormals[E]):O.__originalVertexNormals[E]=O.vertexNormals[E].clone()}let E=new fz;E.faces=this.faces;for(let O=0,R=this.morphTargets.length;O<R;O++){if(!this.morphNormals[O]){this.morphNormals[O]={},this.morphNormals[O].faceNormals=[],this.morphNormals[O].vertexNormals=[];let E=this.morphNormals[O].faceNormals,R=this.morphNormals[O].vertexNormals;for(let O=0,z=this.faces.length;O<z;O++){let O=new Wn,z={a:new Wn,b:new Wn,c:new Wn};E.push(O),R.push(z)}}let R=this.morphNormals[O];E.vertices=this.morphTargets[O].vertices,E.computeFaceNormals(),E.computeVertexNormals();for(let E=0,O=this.faces.length;E<O;E++){let O=this.faces[E],z=R.faceNormals[E],V=R.vertexNormals[E];z.copy(O.normal),V.a.copy(O.vertexNormals[0]),V.b.copy(O.vertexNormals[1]),V.c.copy(O.vertexNormals[2])}}for(let E=0,O=this.faces.length;E<O;E++){let O=this.faces[E];O.normal=O.__originalFaceNormal,O.vertexNormals=O.__originalVertexNormals}}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Yn),this.boundingBox.setFromPoints(this.vertices)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new ps),this.boundingSphere.setFromPoints(this.vertices)}merge(E,O,R=0){if(!(E&&E.isGeometry)){console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",E);return}let z,V=this.vertices.length,j=this.vertices,Y=E.vertices,ee=this.faces,se=E.faces,he=this.colors,ce=E.colors;O!==void 0&&(z=(new wn).getNormalMatrix(O));for(let E=0,R=Y.length;E<R;E++){let R=Y[E].clone();O!==void 0&&R.applyMatrix4(O),j.push(R)}for(let E=0,O=ce.length;E<O;E++)he.push(ce[E].clone());for(let E=0,O=se.length;E<O;E++){let O,j,Y=se[E],he=Y.vertexNormals,ce=Y.vertexColors,ue=new gz(Y.a+V,Y.b+V,Y.c+V);ue.normal.copy(Y.normal),z!==void 0&&ue.normal.applyMatrix3(z).normalize();for(let E=0,R=he.length;E<R;E++)O=he[E].clone(),z!==void 0&&O.applyMatrix3(z).normalize(),ue.vertexNormals.push(O);ue.color.copy(Y.color);for(let E=0,O=ce.length;E<O;E++)j=ce[E],ue.vertexColors.push(j.clone());ue.materialIndex=Y.materialIndex+R,ee.push(ue)}for(let O=0,R=E.faceVertexUvs.length;O<R;O++){let R=E.faceVertexUvs[O];this.faceVertexUvs[O]===void 0&&(this.faceVertexUvs[O]=[]);for(let E=0,z=R.length;E<z;E++){let z=R[E],V=[];for(let E=0,O=z.length;E<O;E++)V.push(z[E].clone());this.faceVertexUvs[O].push(V)}}}mergeMesh(E){E&&E.isMesh?(E.matrixAutoUpdate&&E.updateMatrix(),this.merge(E.geometry,E.matrix)):console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",E)}mergeVertices(E=4){let O={},R=[],z=[],V=Math.pow(10,E);for(let E=0,j=this.vertices.length;E<j;E++){let j=this.vertices[E],Y=Math.round(j.x*V)+"_"+Math.round(j.y*V)+"_"+Math.round(j.z*V);O[Y]===void 0?(O[Y]=E,R.push(this.vertices[E]),z[E]=R.length-1):z[E]=z[O[Y]]}let j=[];for(let E=0,O=this.faces.length;E<O;E++){let O=this.faces[E];O.a=z[O.a],O.b=z[O.b],O.c=z[O.c];let R=[O.a,O.b,O.c];for(let O=0;O<3;O++)if(R[O]===R[(O+1)%3]){j.push(E);break}}for(let E=j.length-1;E>=0;E--){let O=j[E];this.faces.splice(O,1);for(let E=0,R=this.faceVertexUvs.length;E<R;E++)this.faceVertexUvs[E].splice(O,1)}let Y=this.vertices.length-R.length;return this.vertices=R,Y}setFromPoints(E){this.vertices=[];for(let O=0,R=E.length;O<R;O++){let R=E[O];this.vertices.push(new Wn(R.x,R.y,R.z||0))}return this}sortFacesByMaterialIndex(){let E=this.faces,O=E.length;for(let R=0;R<O;R++)E[R]._id=R;function r(E,O){return E.materialIndex-O.materialIndex}E.sort(r);let R,z,V=this.faceVertexUvs[0],j=this.faceVertexUvs[1];V&&V.length===O&&(R=[]),j&&j.length===O&&(z=[]);for(let Y=0;Y<O;Y++){let O=E[Y]._id;R&&R.push(V[O]),z&&z.push(j[O])}R&&(this.faceVertexUvs[0]=R),z&&(this.faceVertexUvs[1]=z)}toJSON(){let E={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(E.uuid=this.uuid,E.type=this.type,this.name!==""&&(E.name=this.name),this.parameters!==void 0){let O=this.parameters;for(let R in O)O[R]!==void 0&&(E[R]=O[R]);return E}let O=[];for(let E=0;E<this.vertices.length;E++){let R=this.vertices[E];O.push(R.x,R.y,R.z)}let R=[],z=[],V={},j=[],Y={},ee=[],se={};for(let E=0;E<this.faces.length;E++){let O=this.faces[E],z=!0,V=!1,j=this.faceVertexUvs[0][E]!==void 0,Y=O.normal.length()>0,ee=O.vertexNormals.length>0,se=O.color.r!==1||O.color.g!==1||O.color.b!==1,he=O.vertexColors.length>0,ce=0;if(ce=u(ce,0,0),ce=u(ce,1,z),ce=u(ce,2,V),ce=u(ce,3,j),ce=u(ce,4,Y),ce=u(ce,5,ee),ce=u(ce,6,se),ce=u(ce,7,he),R.push(ce),R.push(O.a,O.b,O.c),R.push(O.materialIndex),j){let O=this.faceVertexUvs[0][E];R.push(f(O[0]),f(O[1]),f(O[2]))}if(Y&&R.push(h(O.normal)),ee){let E=O.vertexNormals;R.push(h(E[0]),h(E[1]),h(E[2]))}if(se&&R.push(d(O.color)),he){let E=O.vertexColors;R.push(d(E[0]),d(E[1]),d(E[2]))}}function u(E,O,R){return R?E|1<<O:E&~(1<<O)}function h(E){let O=E.x.toString()+E.y.toString()+E.z.toString();return V[O]!==void 0||(V[O]=z.length/3,z.push(E.x,E.y,E.z)),V[O]}function d(E){let O=E.r.toString()+E.g.toString()+E.b.toString();return Y[O]!==void 0||(Y[O]=j.length,j.push(E.getHex())),Y[O]}function f(E){let O=E.x.toString()+E.y.toString();return se[O]!==void 0||(se[O]=ee.length/2,ee.push(E.x,E.y)),se[O]}return E.data={},E.data.vertices=O,E.data.normals=z,j.length>0&&(E.data.colors=j),ee.length>0&&(E.data.uvs=[ee]),E.data.faces=R,E}clone(){return(new fz).copy(this)}copy(E){this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=E.name;let O=E.vertices;for(let E=0,R=O.length;E<R;E++)this.vertices.push(O[E].clone());let R=E.colors;for(let E=0,O=R.length;E<O;E++)this.colors.push(R[E].clone());let z=E.faces;for(let E=0,O=z.length;E<O;E++)this.faces.push(z[E].clone());for(let O=0,R=E.faceVertexUvs.length;O<R;O++){let R=E.faceVertexUvs[O];this.faceVertexUvs[O]===void 0&&(this.faceVertexUvs[O]=[]);for(let E=0,z=R.length;E<z;E++){let z=R[E],V=[];for(let E=0,O=z.length;E<O;E++){let O=z[E];V.push(O.clone())}this.faceVertexUvs[O].push(V)}}let V=E.morphTargets;for(let E=0,O=V.length;E<O;E++){let O={};if(O.name=V[E].name,V[E].vertices!==void 0){O.vertices=[];for(let R=0,z=V[E].vertices.length;R<z;R++)O.vertices.push(V[E].vertices[R].clone())}if(V[E].normals!==void 0){O.normals=[];for(let R=0,z=V[E].normals.length;R<z;R++)O.normals.push(V[E].normals[R].clone())}this.morphTargets.push(O)}let j=E.morphNormals;for(let E=0,O=j.length;E<O;E++){let O={};if(j[E].vertexNormals!==void 0){O.vertexNormals=[];for(let R=0,z=j[E].vertexNormals.length;R<z;R++){let z=j[E].vertexNormals[R],V={};V.a=z.a.clone(),V.b=z.b.clone(),V.c=z.c.clone(),O.vertexNormals.push(V)}}if(j[E].faceNormals!==void 0){O.faceNormals=[];for(let R=0,z=j[E].faceNormals.length;R<z;R++)O.faceNormals.push(j[E].faceNormals[R].clone())}this.morphNormals.push(O)}let Y=E.skinWeights;for(let E=0,O=Y.length;E<O;E++)this.skinWeights.push(Y[E].clone());let ee=E.skinIndices;for(let E=0,O=ee.length;E<O;E++)this.skinIndices.push(ee[E].clone());let se=E.lineDistances;for(let E=0,O=se.length;E<O;E++)this.lineDistances.push(se[E]);let he=E.boundingBox;he!==null&&(this.boundingBox=he.clone());let ce=E.boundingSphere;return ce!==null&&(this.boundingSphere=ce.clone()),this.elementsNeedUpdate=E.elementsNeedUpdate,this.verticesNeedUpdate=E.verticesNeedUpdate,this.uvsNeedUpdate=E.uvsNeedUpdate,this.normalsNeedUpdate=E.normalsNeedUpdate,this.colorsNeedUpdate=E.colorsNeedUpdate,this.lineDistancesNeedUpdate=E.lineDistancesNeedUpdate,this.groupsNeedUpdate=E.groupsNeedUpdate,this}toBufferGeometry(){let E=(new mz).fromGeometry(this),O=new Na,R=new Float32Array(E.vertices.length*3);if(O.setAttribute("position",F0.call(new Sa(R,3),E.vertices)),E.normals.length>0){let R=new Float32Array(E.normals.length*3);O.setAttribute("normal",F0.call(new Sa(R,3),E.normals))}if(E.colors.length>0){let R=new Float32Array(E.colors.length*3);O.setAttribute("color",QO.call(new Sa(R,3),E.colors))}if(E.uvs.length>0){let R=new Float32Array(E.uvs.length*2);O.setAttribute("uv",ZO.call(new Sa(R,2),E.uvs))}if(E.uvs2.length>0){let R=new Float32Array(E.uvs2.length*2);O.setAttribute("uv2",ZO.call(new Sa(R,2),E.uvs2))}O.groups=E.groups;for(let R in E.morphTargets){let z=[],V=E.morphTargets[R];for(let E=0,O=V.length;E<O;E++){let O=V[E],R=new Ma(O.data.length*3,3);R.name=O.name,z.push(F0.call(R,O.data))}O.morphAttributes[R]=z}if(E.skinIndices.length>0){let R=new Ma(E.skinIndices.length*4,4);O.setAttribute("skinIndex",JO.call(R,E.skinIndices))}if(E.skinWeights.length>0){let R=new Ma(E.skinWeights.length*4,4);O.setAttribute("skinWeight",JO.call(R,E.skinWeights))}return E.boundingSphere!==null&&(O.boundingSphere=E.boundingSphere.clone()),E.boundingBox!==null&&(O.boundingBox=E.boundingBox.clone()),O}computeTangents(){console.error("THREE.Geometry: .computeTangents() has been removed.")}computeLineDistances(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")}applyMatrix(E){return console.warn("THREE.Geometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(E)}dispose(){this.dispatchEvent({type:"dispose"})}static createBufferGeometryFromObject(E){let O=new Na,R=E.geometry;if(E.isPoints||E.isLine){let E=new Ma(R.vertices.length*3,3),z=new Ma(R.colors.length*3,3);if(O.setAttribute("position",F0.call(E,R.vertices)),O.setAttribute("color",QO.call(z,R.colors)),R.lineDistances&&R.lineDistances.length===R.vertices.length){let E=new Ma(R.lineDistances.length,1);O.setAttribute("lineDistance",cX.call(E,R.lineDistances))}R.boundingSphere!==null&&(O.boundingSphere=R.boundingSphere.clone()),R.boundingBox!==null&&(O.boundingBox=R.boundingBox.clone())}else E.isMesh&&(O=R.toBufferGeometry());return O}};fz.prototype.isGeometry=!0;var mz=class{constructor(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}computeGroups(E){let O,R,z,V=[],j=E.faces;for(R=0;R<j.length;R++){let E=j[R];E.materialIndex!==z&&(z=E.materialIndex,O!==void 0&&(O.count=R*3-O.start,V.push(O)),O={start:R*3,materialIndex:z})}O!==void 0&&(O.count=R*3-O.start,V.push(O)),this.groups=V}fromGeometry(E){let O,R=E.faces,z=E.vertices,V=E.faceVertexUvs,j=V[0]&&V[0].length>0,Y=V[1]&&V[1].length>0,ee=E.morphTargets,se=ee.length;if(se>0){O=[];for(let E=0;E<se;E++)O[E]={name:ee[E].name,data:[]};this.morphTargets.position=O}let he,ce=E.morphNormals,ue=ce.length;if(ue>0){he=[];for(let E=0;E<ue;E++)he[E]={name:ce[E].name,data:[]};this.morphTargets.normal=he}let fe=E.skinIndices,ve=E.skinWeights,we=fe.length===z.length,Se=ve.length===z.length;z.length>0&&R.length===0&&console.error("THREE.DirectGeometry: Faceless geometries are not supported.");for(let E=0;E<R.length;E++){let _e=R[E];this.vertices.push(z[_e.a],z[_e.b],z[_e.c]);let Ae=_e.vertexNormals;if(Ae.length===3)this.normals.push(Ae[0],Ae[1],Ae[2]);else{let E=_e.normal;this.normals.push(E,E,E)}let Ce=_e.vertexColors;if(Ce.length===3)this.colors.push(Ce[0],Ce[1],Ce[2]);else{let E=_e.color;this.colors.push(E,E,E)}if(j===!0){let O=V[0][E];O!==void 0?this.uvs.push(O[0],O[1],O[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",E),this.uvs.push(new bn,new bn,new bn))}if(Y===!0){let O=V[1][E];O!==void 0?this.uvs2.push(O[0],O[1],O[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",E),this.uvs2.push(new bn,new bn,new bn))}for(let E=0;E<se;E++){let R=ee[E].vertices;O[E].data.push(R[_e.a],R[_e.b],R[_e.c])}for(let O=0;O<ue;O++){let R=ce[O].vertexNormals[E];he[O].data.push(R.a,R.b,R.c)}we&&this.skinIndices.push(fe[_e.a],fe[_e.b],fe[_e.c]),Se&&this.skinWeights.push(ve[_e.a],ve[_e.b],ve[_e.c])}return this.computeGroups(E),this.verticesNeedUpdate=E.verticesNeedUpdate,this.normalsNeedUpdate=E.normalsNeedUpdate,this.colorsNeedUpdate=E.colorsNeedUpdate,this.uvsNeedUpdate=E.uvsNeedUpdate,this.groupsNeedUpdate=E.groupsNeedUpdate,E.boundingSphere!==null&&(this.boundingSphere=E.boundingSphere.clone()),E.boundingBox!==null&&(this.boundingBox=E.boundingBox.clone()),this}},gz=class{constructor(E,O,R,z,V,j=0){this.a=E,this.b=O,this.c=R,this.normal=z&&z.isVector3?z:new Wn,this.vertexNormals=Array.isArray(z)?z:[],this.color=V&&V.isColor?V:new On,this.vertexColors=Array.isArray(V)?V:[],this.materialIndex=j}clone(){return(new this.constructor).copy(this)}copy(E){this.a=E.a,this.b=E.b,this.c=E.c,this.normal.copy(E.normal),this.color.copy(E.color),this.materialIndex=E.materialIndex;for(let O=0,R=E.vertexNormals.length;O<R;O++)this.vertexNormals[O]=E.vertexNormals[O].clone();for(let O=0,R=E.vertexColors.length;O<R;O++)this.vertexColors[O]=E.vertexColors[O].clone();return this}};function cX(E){return this.array.set(E),this}function QO(E){let O=this.array,R=0;for(let z=0,V=E.length;z<V;z++){let V=E[z];V===void 0&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",z),V=new On),O[R++]=V.r,O[R++]=V.g,O[R++]=V.b}return this}function ZO(E){let O=this.array,R=0;for(let z=0,V=E.length;z<V;z++){let V=E[z];V===void 0&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",z),V=new bn),O[R++]=V.x,O[R++]=V.y}return this}function F0(E){let O=this.array,R=0;for(let z=0,V=E.length;z<V;z++){let V=E[z];V===void 0&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",z),V=new Wn),O[R++]=V.x,O[R++]=V.y,O[R++]=V.z}return this}function JO(E){let O=this.array,R=0;for(let z=0,V=E.length;z<V;z++){let V=E[z];V===void 0&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",z),V=new Nn),O[R++]=V.x,O[R++]=V.y,O[R++]=V.z,O[R++]=V.w}return this}var vz=["a","b","c"];function hX(E,O){switch(O){case"c":return E.c;case"b":return E.b;case"a":default:return E.a}}function KA(E,O,R){let z=Math.min(E,O),V=Math.max(E,O),j=z+"_"+V;return R.get(j)}function QA(E,O,R,z,V,j){let Y,ee=Math.min(E,O),se=Math.max(E,O),he=ee+"_"+se;if(z.has(he))Y=z.get(he);else{let E=R[ee],O=R[se];Y={a:E,b:O,newEdge:null,faces:[]},z.set(he,Y)}Y.faces.push(V),j[E].edges.push(Y),j[O].edges.push(Y)}function dX(E,O,R,z){let V,j,Y;for(V=0,j=E.length;V<j;V++)R[V]={edges:[]};for(V=0,j=O.length;V<j;V++)Y=O[V],QA(Y.a,Y.b,E,z,Y,R),QA(Y.b,Y.c,E,z,Y,R),QA(Y.c,Y.a,E,z,Y,R)}function V0(E,O,R,z,V){E.push(new gz(O,R,z,void 0,void 0,V))}function Rd(E,O){return Math.abs(O-E)/2+Math.min(E,O)}function U0(E,O,R,z){E.push([O.clone(),R.clone(),z.clone()])}var yz=class{constructor(E=1){this.subdivisions=E}modify(E){E=E instanceof Na?(new fz).fromBufferGeometry(E):E.clone(),E.mergeVertices();let O=this.subdivisions;for(;O-- >0;)this._smooth(E);return E.computeFaceNormals(),E.computeVertexNormals(),E}_smooth(E){let O,R,z,V,j,Y=new Wn,ee=E.vertices,se=E.faces,he=E.faceVertexUvs[0],ce=he!==void 0&&he.length>0,ue=[],fe=new Map;dX(ee,se,ue,fe);let ve,we,Se,_e,Ae,Ce,Te,Ie=[];for(let E of Array.from(fe.keys())){for(we=fe.get(E),Se=new Wn,Ae=3/8,Ce=1/8,Te=we.faces.length,Te!=2&&(Ae=.5,Ce=0,Te!=1),Se.addVectors(we.a,we.b).multiplyScalar(Ae),Y.set(0,0,0),V=0;V<Te;V++){for(_e=we.faces[V],j=0;j<3&&(ve=ee[hX(_e,vz[j])],!(ve!==we.a&&ve!==we.b));j++);ve&&Y.add(ve)}Y.multiplyScalar(Ce),Se.add(Y),we.newEdge=Ie.length,Ie.push(Se)}let Fe,Ue,Ge,qe,Xe,Qe,Ze,Ke=[];for(R=0,z=ee.length;R<z;R++){for(Qe=ee[R],Xe=ue[R].edges,O=Xe.length,O==3?Fe=3/16:O>3&&(Fe=3/(8*O)),Ue=1-O*Number(Fe),Ge=Fe,O<=2&&(O==2?(Ue=3/4,Ge=1/8):O==1||O==0),Ze=Qe.clone().multiplyScalar(Ue),Y.set(0,0,0),V=0;V<O;V++)qe=Xe[V],ve=qe.a!==Qe?qe.a:qe.b,Y.add(ve);Y.multiplyScalar(Number(Ge)),Ze.add(Y),Ke.push(Ze)}let Je,$e,et,it,rt,at,lt,ct=Ke.concat(Ie),dt=Ke.length,ut=[],pt=[],mt=new bn,gt=new bn,yt=new bn;for(R=0,z=se.length;R<z;R++)_e=se[R],Je=Number(KA(_e.a,_e.b,fe).newEdge)+dt,$e=Number(KA(_e.b,_e.c,fe).newEdge)+dt,et=Number(KA(_e.c,_e.a,fe).newEdge)+dt,V0(ut,Je,$e,et,_e.materialIndex),V0(ut,_e.a,Je,et,_e.materialIndex),V0(ut,_e.b,$e,Je,_e.materialIndex),V0(ut,_e.c,et,$e,_e.materialIndex),ce&&(it=he[R],rt=it[0],at=it[1],lt=it[2],mt.set(Rd(rt.x,at.x),Rd(rt.y,at.y)),gt.set(Rd(at.x,lt.x),Rd(at.y,lt.y)),yt.set(Rd(rt.x,lt.x),Rd(rt.y,lt.y)),U0(pt,mt,gt,yt),U0(pt,rt,mt,yt),U0(pt,at,gt,mt),U0(pt,lt,yt,gt));E.vertices=ct,E.faces=ut,ce&&(E.faceVertexUvs[0]=pt)}};var xz=new Wn,bz=class{static create(E){return this.build(this.normalizeInputs(E))}static normalizeInputs(E,O){let R,z=E.geometry??O?.geometry??(new Na).copy(new to(100,100,100));O===void 0?(z.computeBoundingBox(),z.boundingBox.getSize(xz),R={width:xz.x,height:xz.y,depth:xz.z,subdivisions:0}):R=O.parameters;let V={...R,...E.parameters};return{parameters:{width:Math.abs(V.width),height:Math.abs(V.height),depth:Math.abs(V.depth),subdivisions:Math.abs(V.subdivisions)},geometry:z}}static build(E){let{width:O,height:R,depth:z,subdivisions:V}=E.parameters,j=E.geometry??(new Na).copy(new to(100,100,100)),Y=j.userData.parameters;Y===void 0?(j.computeBoundingBox(),j.boundingBox.getSize(xz)):xz.set(Y.width,Y.height,Y.depth),(O!==xz.x||R!==xz.y||z!==xz.z)&&j.scale(xz.x===0?1:O/xz.x,xz.y===0?1:R/xz.y,xz.z===0?1:z/xz.z);let ee=j.originalGeometry;try{V>0?(ee===void 0||Y?.subdivisions!==V)&&(ee===void 0&&(ee=j),j=new yz(V).modify(ee).toBufferGeometry()):(ee!==void 0&&(j=ee),ee=void 0,j.getAttribute("normal")===void 0&&j.computeVertexNormals())}catch{ee!==void 0&&(j=ee),ee=void 0,j.getAttribute("normal")===void 0&&j.computeVertexNormals()}return ee!==void 0&&Object.assign(j,{originalGeometry:ee}),delete E.geometry,Object.assign(j,{userData:{...E,type:"NonParametricGeometry"}})}static loadFromUrl(E,O,R){new ef(R).load(E,(E=>{let R=this.normalizeInputs({geometry:E});E.boundingBox.getSize(xz);let z=100/xz.x;Object.assign(R.parameters,{width:100,height:xz.y*z,depth:xz.z*z}),O(this.build(R))}))}};var wz=class{static create(E){return this.build(this.normalizeInputs(E))}static normalizeInputs(E,O){let R=Object.assign({},O?.parameters??{width:100,depth:0,spikes:5,cornerRadius:0,extrudeBevelSize:0,extrudeBevelSegments:3},E.parameters);return{shape:E.shape&&E.shape instanceof oB?E.shape:new oB,parameters:Object.assign(R,{width:Math.abs(R.width),height:Math.abs(R.height??R.width),depth:Math.abs(R.depth??0)})}}static build(E){let{width:O,height:R,spikes:z,cornerRadius:V,depth:j,extrudeBevelSize:Y,extrudeBevelSegments:ee}=E.parameters,se=E.shape,he=O*.5,ce=R*.5,ue=0,fe=0,ve=2*Math.PI/z;for(let E=0;E<z;E++){let O=ve*E,R=ue+Math.sin(O)*he,z=fe+Math.cos(O)*ce;se.addPoint(se.createPoint(R,z))}se.isClosed=!0;for(let E=0,O=se.points.length;E<O;E++)se.points[E].roundness=V;se.roundness=V,se.update();let we=iz.create({shape:se,parameters:{roundness:V,depth:j,extrudeBevelSize:Y,extrudeBevelSegments:ee}});return Object.assign(we,{userData:{...E,type:"PolygonGeometry"}})}};var Sz=class{static create(E){return this.build(this.normalizeInputs(E))}static normalizeInputs(E,O){let R=Object.assign({},O?.parameters??{width:100,radialSegments:4,heightSegments:1,cornerRadius:0,cornerSegments:8,openEnded:!1},E.parameters);return{parameters:Object.assign(R,{width:Math.abs(R.width),height:Math.abs(R.height??R.width),depth:Math.abs(R.depth??R.width)})}}static build(E){let{width:O,height:R,depth:z,radialSegments:V,heightSegments:j,openEnded:Y,cornerRadius:ee,cornerSegments:se}=E.parameters,he=new _z(O*.5,R,V,j,Y,ee,se);return he.scale(1,1,z/O),Object.assign(he,{userData:{...E,type:"PyramidGeometry"}})}};function bm(E,O,R){R.x=E.x*O.x,R.y=E.y,R.z=E.x*O.y}function ZA(E,O,R,z,V,j){let Y=O.clone().sub(E),ee=R.clone().sub(E),se=Y.angleTo(ee);if(Y.normalize(),ee.normalize(),z===V){let O=Y.add(ee).normalize();j.copy(E).addScaledVector(O,z/Math.sin(se/2))}else{let O=Y.angleTo(ee);j.copy(E),j.addScaledVector(Y,V/Math.sin(O)),j.addScaledVector(ee,z/Math.sin(O))}}function fX(E,O,R){let z=E.clone().sub(O),V=R.clone().sub(O);return z.projectOnVector(V),z.add(O)}var _z=class extends Na{constructor(E=.5,O=1,R=4,z=1,V=!1,j=0,Y=4){super(),R=Math.floor(Math.max(3,R)),z=Math.floor(z),Y=Math.floor(Y);let ee=[],se=[],he=[],ce=[],ue=0,fe=O/2,ve=Math.PI/R,we=E*Math.cos(Math.PI/R),Se=2*Math.PI/R,_e=(R-2)*Math.PI/R,Ae=Math.PI-_e,Ce=new Wn(0,-fe,0),Te=new Wn(0,fe,0),Ie=new bn(E,-fe),Fe=new bn(we,-fe),Ue=new bn(0,Te.y).sub(Fe),Ge=new bn(0,Te.y).sub(Ie),qe=new bn(Ue.y,-Ue.x).normalize(),Xe=new bn(Ge.y,-Ge.x).normalize(),Qe=E*Math.cos(Math.PI/R)*Math.tan((Math.PI-Ue.angle())/2)-1e-8;j=Math.min(j,Qe);let Ze;{let E=new Wn(qe.x,qe.y,0),O=new Wn(Math.cos(Se)*E.x,E.y,Math.sin(Se)*E.x);Ze=E.angleTo(O)}let Ke=j/Math.tan((Math.PI-Ue.angle())/2),Je=j/Math.tan((Math.PI-Ze)/2),$e=new Wn;if(!V){se.push(Ce.x,Ce.y,Ce.z),he.push(0,-1,0),ce.push(0,0);let E=ue++,O=[],z=Ie.clone(),V=Ke/Math.cos(Math.PI/R);z.x-=V;for(let E=0;E<R;E++){let V=E/R*Math.PI*2+ve,j=new bn(Math.sin(V),Math.cos(V));bm(z,j,$e),se.push($e.x,$e.y,$e.z),he.push(0,-1,0),ce.push(0,0),O.push(ue++)}for(let R=0;R<O.length;R++)ee.push(O[R],E,O[(R+1)%O.length])}let et=[];{let E=new Wn,O=new Wn,z=new Wn,V=new Wn,fe=new Wn,we=new Wn;for(let Se=0;Se<R;Se++){let _e=Se/R*Math.PI*2+ve,Ae=(Se+.5)/R*Math.PI*2+ve,Fe=(Se+1)/R*Math.PI*2+ve,Ge=new bn(Math.sin(_e),Math.cos(_e)),Qe=new bn(Math.sin(Ae),Math.cos(Ae)),$e=new bn(Math.sin(Fe),Math.cos(Fe));bm(Ie,Ge,O),bm(Ie,$e,z),bm(qe,Qe,E),ZA(Te,O,z,Je,Je,V),se.push(V.x,V.y,V.z),ZA(O,Te,z,Je,Ke,fe),se.push(fe.x,fe.y,fe.z),ZA(z,O,Te,Ke,Je,we),se.push(we.x,we.y,we.z),he.push(E.x,E.y,E.z),he.push(E.x,E.y,E.z),he.push(E.x,E.y,E.z),ce.push(0,0),ce.push(0,0),ce.push(0,0);let it=ue++,rt=ue++,at=ue++;if(ee.push(it,rt,at),j>0){{let E=O.clone().add(z).multiplyScalar(.5),R=Te.clone().sub(E).normalize(),V=Ce.clone().sub(E).normalize().add(R).normalize().multiplyScalar(-1),j=we.clone().sub(fe);H(E,j,V,Ue.angle())}let ve,Se;{let E=new Wn;bm(Xe,$e,E);let O=we.clone().add(V).multiplyScalar(.5);O=fX(O,z,Te);let R=we.clone().sub(V);[ve,Se]=H(O,R,E,Ze,V.y)}{let E=ve,O=E.clone().setY(0).normalize(),R=new Wn(0,-1,0),z=O.clone().cross(R);q(E,O,R,z)}et.concat(Se);{let O=Ue.angle(),z=Math.PI-O,V=Te.clone();V.y-=j/Math.sin(O-Math.PI/2);let fe=new Wn,ve=[];for(let O=0;O<Y;O++){let ee=[],we=Math.PI/2-z*O/Y,Se=Math.cos(we),_e=Math.sin(we),Ce=Ae;for(let z=0;z<=O;z++){let z=Math.cos(Ce),Y=Math.sin(Ce);E.x=Se*Y,E.y=_e,E.z=Se*z,fe.copy(V).addScaledVector(E,j),se.push(fe.x,fe.y,fe.z),he.push(E.x,E.y,E.z),ce.push(0,0),ee.push(ue++),Ce+=Math.PI*2/O/R}ve.push(ee)}Se.reverse(),ve.push(Se);let we=ve.length-1;for(let E=0;E<we;E++){let O=ve[E],R=ve[E+1],z=O.length-1;ee.push(R[1],O[0],R[0]);for(let E=1;E<=z;E++)ee.push(O[E],O[E-1],R[E]),ee.push(R[E+1],O[E],R[E])}}}}}this.setIndex(ee),this.setAttribute("position",new Ma(se,3)),this.setAttribute("normal",new Ma(he,3)),this.setAttribute("uv",new Ma(ce,2));function H(E,O,R,z,V){let fe=-z/2,ve=(Math.PI-z)/2,we=O.clone().normalize().cross(R);E.addScaledVector(R,-j/Math.sin(ve));let Se=new Wn,_e=new Wn,Ae=1,Ce=ue,Te=[];for(let ee=0;ee<=Y;ee++){let ve=fe+ee/Y*z;_e.set(0,0,0),_e.addScaledVector(we,Math.sin(ve)),_e.addScaledVector(R,Math.cos(ve));for(let R=0;R<=Ae;R++){let z=R/Ae-.5;if(Se.copy(E),Se.addScaledVector(O,z),Se.addScaledVector(_e,j),V!=null){let E=Math.max(0,Se.y-V);Se.addScaledVector(O,-E/O.y)}se.push(Se.x,Se.y,Se.z),he.push(_e.x,_e.y,_e.z),ce.push(0,0),R===0&&Te.push(ue),ue++}}for(let E=0;E<Y;E++)for(let O=0;O<Ae;O++){let R=Ce+O+(Ae+1)*E,z=R+(Ae+1),V=z+1,j=R+1;ee.push(R,z,j),ee.push(z,V,j)}return[E.clone().addScaledVector(O,.5),Te]}function q(E,O,R,z){let V=Math.PI/2,fe=Ge.angle()-V,ve=[],we=new Wn,Se=new Wn;for(let ee=0;ee<=Y;ee++){let _e=[],Ce=ee/Y;for(let Y=0;Y<=ee;Y++){let ve=((ee?Y/ee:0)-.5)*Ae,Te=Math.cos(ve),Ie=Math.sin(ve),Fe=Math.atan(Math.tan(fe)*Te),Ue=(V+Fe)*Ce,Ge=Math.cos(Ue),qe=Math.sin(Ue);we.set(0,0,0),we.addScaledVector(O,qe*Te),we.addScaledVector(R,Ge),we.addScaledVector(z,qe*Ie),Se.copy(E).addScaledVector(we,j),se.push(Se.x,Se.y,Se.z),he.push(we.x,we.y,we.z),ce.push(0,0),_e.push(ue++)}ve.push(_e)}let _e=ve.length-1;for(let E=0;E<_e;E++){let O=ve[E],R=ve[E+1],z=O.length-1;ee.push(O[0],R[1],R[0]);for(let E=1;E<=z;E++)ee.push(O[E-1],O[E],R[E]),ee.push(O[E],R[E+1],R[E])}}}};var Az=class{static create(E){return this.build(this.normalizeInputs(E))}static normalizeInputs(E,O){let R=Object.assign({},O?.parameters??{width:100,depth:0,cornerRadius:[0,0,0,0],cornerType:1,extrudeBevelSize:0,extrudeBevelSegments:1},E.parameters),z=Object.assign(O?.ui??{enabledIndieCorners:!1},E.ui);return{shape:E.shape&&E.shape instanceof oB?E.shape:new oB,parameters:Object.assign(R,{width:Math.abs(R.width),height:Math.abs(R.height??R.width),depth:Math.abs(R.depth??0)}),ui:z}}static build(E){let O=E.shape,{width:R,height:z,cornerRadius:V,cornerType:j,depth:Y,extrudeBevelSize:ee,extrudeBevelSegments:se}=E.parameters,he={x:R*.5,y:z*.5},ce={x:-he.x,y:-he.y},ue={x:he.x,y:he.y};function d(E,O,V){return O>R&&V>z?Math.min(E*R/O,E*z/V):O>R?E*R/O:V>z?E*z/V:E}let fe=[];fe[0]=V[0]===0?0:d(V[0],V[0]+V[3],V[0]+V[1]),fe[1]=V[1]===0?0:d(V[1],V[1]+V[2],V[1]+V[0]),fe[2]=V[2]===0?0:d(V[2],V[2]+V[1],V[2]+V[3]),fe[3]=V[3]===0?0:d(V[3],V[3]+V[0],V[3]+V[2]);let ve=ce.x,we=ue.x,Se=ue.y,_e=ce.y;O.addPoint(O.createPoint(ve,Se)),O.addPoint(O.createPoint(we,Se)),O.addPoint(O.createPoint(we,_e)),O.addPoint(O.createPoint(ve,_e)),O.isClosed=!0;let Ae=!0;for(let E=0,R=O.points.length;E<R;E++)O.points[E].roundness=fe[E],E>0&&fe[E]!==fe[E-1]&&(Ae=!1);Ae&&(O.roundness=fe[0]),O.useCubicForRoundedCorners=j!==1,O.update();let Ce=iz.create({shape:O,parameters:{depth:Y,extrudeBevelSize:ee,extrudeBevelSegments:se}});return Object.assign(Ce,{userData:{...E,type:"RectangleGeometry"}})}};var Mz=class{static create(E){return this.build(this.normalizeInputs(E))}static normalizeInputs(E,O){let R=Object.assign({},O?.parameters??{width:100,widthSegments:64,heightSegments:64,phiStart:0,phiLength:2*Math.PI,thetaStart:0,thetaLength:180},E.parameters);return R.thetaLength=xn.clamp(R.thetaLength,0,180),{parameters:Object.assign(R,{width:Math.abs(R.width),height:Math.abs(R.height??R.width),depth:Math.abs(R.depth??R.width)})}}static build(E){let O,{width:R=100,height:z=R,depth:V=R,widthSegments:j=64,heightSegments:Y=64,phiStart:ee,phiLength:se,thetaStart:he,thetaLength:ce}=E.parameters;return ce===0?(O=new Na,O.setAttribute("position",new Ma([],3))):O=new $u(.5*R,j,Y,ee,se,he,ce*xn.DEG2RAD),O.scale(1,z/R,V/R),Object.assign(O,{userData:{...E,type:"SphereGeometry"}})}};var Ez=class{static create(E){return this.build(this.normalizeInputs(E))}static normalizeInputs(E,O){let R=Object.assign({},O?.parameters??{width:100,depth:0,widthSegments:8,heightSegments:8},E.parameters);return{parameters:Object.assign(R,{width:Math.abs(R.width),height:Math.abs(R.height??R.width),depth:0})}}static build(E){let{width:O=100,height:R=O,widthSegments:z=8,heightSegments:V=8}=E.parameters,j=new Co(O,R,z,V);return j.scale(1,1,1),Object.assign(j,{userData:{...E,type:"PlaneGeometry"}})}};var Cz=class{static create(E){return this.build(this.normalizeInputs(E))}static normalizeInputs(E,O){let R=Object.assign({},O?.parameters??{width:100,angle:90,cornerRadius:24,cornerSegments:8},E.parameters);return{parameters:Object.assign(R,{width:Math.abs(R.width),height:Math.abs(R.height??R.width),depth:Math.abs(R.depth??R.width)})}}static build(E){let{width:O,height:R,depth:z,angle:V,cornerRadius:j,cornerSegments:Y}=E.parameters,ee=new Tz(O,R,z,V,j,Y);return Object.assign(ee,{userData:{...E,type:"BackdropGeometry"}})}},Tz=class extends Na{constructor(E=1,O=1,R=1,z=90,V=10,j=24){super(),this.type="BackdropGeometry";let Y=[],ee=[],se=[],he=.001;V==0&&(j=1),j=Math.max(1,Math.floor(j)),V=Math.min(V,100),z=Math.min(180-he,z),z*=Math.PI/180;let ce=[],ue=Math.PI/2,f=(E=0,O=0,R=0)=>new Wn(E,O,R),fe=f(),ve=f(),[we,Se,_e]=[O/2,E/2,R/2],Ae=-Se,Ce=+Se,[Te,Ie,Fe]=[f(Ae,-we,+_e),f(Ae,-we,-_e),f(Ae,+we,-_e)],b=(E,O=!1)=>Math.sin(E-Math.PI/(+O+1)),M=(E,O=!1)=>Math.cos(E-Math.PI/(+O+1));Fe.y=Math.sin(z)*O-we;let Ue=Math.cos(z)*O-_e,Ge=Te.z-he;z<=ue?(Fe.z=Math.min(Ue,Ge),Fe.z==Ge&&(Fe.y-=(Ue-Ge)/Math.tan(ue-z))):Ie.z=Math.min(Ie.z-Ue-_e,Te.z-he),fe.subVectors(Te,Ie),ve.subVectors(Fe,Ie);let qe=Math.min(fe.length(),ve.length())*V/100,Xe=qe*Math.tan(z/2),Qe=qe/Math.cos(z/2),Ze=fe.clone().normalize().add(ve.normalize()).setLength(Qe).add(Ie);fe.set(0,b(z,!0),M(z,!0)),ce.push([Fe,fe.clone()]);let Ke=(Math.PI-z)/j;for(let E=0;E<=j;E++){let O=ue+z+E*Ke;fe.set(0,Math.sin(O)*Xe,Math.cos(O)*Xe),fe.add(Ze),ve.set(0,b(O),M(O)),ce.push([fe.clone(),ve.clone()])}ce.push([Te,f(0,1,0)]);let Je=Math.sin(Ke/2)*Xe*2,$e=ce.length-1,et=ce[0][0].distanceTo(ce[1][0]),it=ce[$e-1][0].distanceTo(ce[$e][0]),rt=et+Je*j+it;ce[0].push(1);for(let E=0;E<=j;E++)ce[E+1].push(1-(et+E*Je)/rt);ce[$e].push(0);let at,lt,ct,[dt,ut,pt]=ce[0];for(let E=1;E<ce.length;E++)[at,lt,ct]=ce[E],Y.push(Ae,dt.y,dt.z,Ae,at.y,at.z,Ce,dt.y,dt.z,Ce,dt.y,dt.z,Ae,at.y,at.z,Ce,at.y,at.z),ee.push(0,ut.y,ut.z,0,lt.y,lt.z,0,ut.y,ut.z,0,ut.y,ut.z,0,lt.y,lt.z,0,lt.y,lt.z),se.push(0,pt,0,ct,1,pt,1,pt,0,ct,1,ct),[dt,ut,pt]=[at,lt,ct];this.setAttribute("position",new Ma(Y,3)),this.setAttribute("normal",new Ma(ee,3)),this.setAttribute("uv",new Ma(se,2))}};var Pz=class{static create(E){return this.build(this.normalizeInputs(E))}static normalizeInputs(E,O){let R=Object.assign({},O?.parameters??{width:100,depth:0,innerRadiusPercent:38.19,spikes:5,cornerRadius:0,angle:360,extrudeBevelSize:0,extrudeBevelSegments:1},E.parameters);return{shape:E.shape&&E.shape instanceof oB?E.shape:new oB,parameters:Object.assign(R,{width:Math.abs(R.width),height:Math.abs(R.height??R.width),depth:Math.abs(R.depth??0)})}}static build(E){let{width:O,height:R,innerRadiusPercent:z,spikes:V,cornerRadius:j,angle:Y,depth:ee,extrudeBevelSize:se,extrudeBevelSegments:he}=E.parameters,ce=E.shape,ue=O*.5,fe=R*.5,ve=0,we=0,Se=Y*Math.PI/360/V,_e=Math.PI/2*3*-1,Ae=ue*z/100,Ce=fe*z/100;if(V===3&&z===50){Se=2*Math.PI/V;for(let E=0;E<V;E++){let O=Se*E,R=ve+Math.sin(O)*ue,z=we+Math.cos(O)*fe;ce.addPoint(ce.createPoint(R,z))}}else for(let E=0;E<V;E++){let O=ve+Math.cos(_e)*ue,R=we+Math.sin(_e)*fe;ce.addPoint(ce.createPoint(O,R)),_e+=Se,O=ve+Math.cos(_e)*Ae,R=we+Math.sin(_e)*Ce,E<=V,ce.addPoint(ce.createPoint(O,R)),_e+=Se}ce.isClosed=!0;for(let E=0,O=ce.points.length;E<O;E++)ce.points[E].roundness=j;ce.roundness=j,ce.update();let Te=iz.create({shape:ce,parameters:{roundness:j,depth:ee,extrudeBevelSize:se,extrudeBevelSegments:he}});return Object.assign(Te,{userData:{...E,type:"StarGeometry"}})}};var Dz=class{static create(E){return this.build(this.normalizeInputs(E))}static normalizeInputs(E,O){let R=Object.assign({},O?.parameters??{width:100,depth:0},E.parameters);return{parameters:Object.assign(R,{width:Math.abs(R.width),height:Math.abs(R.height??R.width),depth:Math.abs(R.depth??0)})}}static build(E){let{width:O,height:R}=E.parameters,z=new Co(O,R);return Object.assign(z,{userData:{...E,type:"TextFrameGeometry"}})}};var Iz=class{static create(E){return this.build(this.normalizeInputs(E))}static normalizeInputs(E,O){let R=Object.assign({},O?.parameters??{width:100,radialSegments:32,tubularSegments:64,arc:360,cornerRadius:30,cornerSegments:8},E.parameters),z=Math.abs(R.width),V=Math.abs(R.height??R.width);R.shapeBlendNode&&(V=z);let j=Math.round(Math.abs(R.depth??R.width*.25));return{parameters:Object.assign(R,{width:z,height:V,depth:j})}}static build(E){let{width:O,height:R,depth:z,radialSegments:V,tubularSegments:j,arc:Y,cornerRadius:ee,cornerSegments:se}=E.parameters,he=pX(O,R,z,O*.5,Y,j,0,0,V,ee,se);return he.scale(1,R/O,1),Object.assign(he,{userData:{...E,type:"TorusGeometry"}})}};function pX(E,O,R,z,V,j,Y,ee,se,he,ce){[O,R]=[R,O],Y=O/2;let ue=xn.clamp(V/360,0,1);if(ue===0){let E=new Na;return E.setAttribute("position",new Ma([],3)),E}return ue===1&&(he=0),new oz(!0,E,O,R,z,ue,j,Y,ee,se,he,ce)}var Oz=class{static create(E){return this.build(this.normalizeInputs(E))}static normalizeInputs(E,O){let R=Object.assign({},O?.parameters??{width:100,tubularSegments:64,radialSegments:32,p:2,q:3},E.parameters);return{parameters:Object.assign(R,{width:Math.abs(R.width),height:Math.abs(R.height??R.width),depth:Math.abs(R.depth??R.width),tube:R.tube??R.width*.125})}}static build(E){let{width:O,tube:R,tubularSegments:z,radialSegments:V,p:j,q:Y}=E.parameters,ee=O*.5;ee!==R&&(ee-=R);let se=new tp(ee,R,z,V,j,Y);return Object.assign(se,{userData:{...E,type:"TorusKnotGeometry"}})}};var Rz=class{static create(E){return this.build(this.normalizeInputs(E))}static normalizeInputs(E,O){let R=Object.assign({},O?.parameters??{width:100,depth:0,spikes:5,cornerRadius:0,extrudeBevelSize:0,extrudeBevelSegments:1,isRect:!1},E.parameters);return{shape:E.shape&&E.shape instanceof oB?E.shape:new oB,parameters:Object.assign(R,{width:Math.abs(R.width),height:Math.abs(R.height??R.width*(R.isRect?1:Math.sqrt(3)/2)),depth:Math.abs(R.depth??0)})}}static build(E){let{width:O=100,height:R,cornerRadius:z,depth:V,extrudeBevelSize:j,extrudeBevelSegments:Y,isRect:ee}=E.parameters,se=E.shape,he=O*.5,ce=R*.5;ee?(se.addPoint(se.createPoint(-he,ce)),se.addPoint(se.createPoint(he,-ce)),se.addPoint(se.createPoint(-he,-ce))):(se.addPoint(se.createPoint(0,ce)),se.addPoint(se.createPoint(he,-ce)),se.addPoint(se.createPoint(-he,-ce))),se.isClosed=!0;for(let E=0,O=se.points.length;E<O;E++)se.points[E].roundness=z;se.roundness=z,se.update();let ue=iz.create({shape:se,parameters:{roundness:z,depth:V,extrudeBevelSize:j,extrudeBevelSegments:Y}});return Object.assign(ue,{userData:{...E,type:"TriangleGeometry"}})}};function lR(E,O){let R=2*Math.PI;return(E%R+R)%R===(O%R+R)%R}function mX(E){return/^(rgba)?\(\s*(\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+(?:\.\d+)?))?\s*\)$/.exec(E.toLowerCase())}function gX(E,O,R){let z,V,j,Y=Math.floor(E*6),ee=E*6-Y,se=R*(1-O),he=R*(1-ee*O),ce=R*(1-(1-ee)*O);switch(Y%6){case 0:z=R,V=ce,j=se;break;case 1:z=he,V=R,j=se;break;case 2:z=se,V=R,j=ce;break;case 3:z=se,V=he,j=R;break;case 4:z=ce,V=se,j=R;break;case 5:default:z=R,V=se,j=he;break}return{r:z*255,g:V*255,b:j*255}}function yX(E,O,R){E/=255,O/=255,R/=255;let z,V=Math.max(E,O,R),j=Math.min(E,O,R),Y=V,ee=V-j,se=V==0?0:ee/V;if(V==j)z=0;else{switch(V){case E:z=(O-R)/ee+(O<R?6:0);break;case O:z=(R-E)/ee+2;break;case R:default:z=(E-O)/ee+4;break}z/=6}return{h:z,s:se,v:Y}}function vX(E){return E=Math.floor(E),{r:E>>16&255,g:E>>8&255,b:E&255}}function xX(E,O,R){return(E<<16)+(O<<8)+R}function bX(E,O,R){return E=Math.round(E),O=Math.round(O),R=Math.round(R),"#"+[E,O,R].map((E=>E.toString(16).padStart(2,"0"))).join("").toUpperCase()}function SX(E){let O=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;E=E.replace(O,((E,O,R,z)=>String(O+O+R+R+z+z)));let R=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(E);return R?{r:parseInt(R[1],16),g:parseInt(R[2],16),b:parseInt(R[3],16)}:null}var Lz={parseRgba:mX,hsvToRgb:gX,rgbToHsv:yX,hexToRgb:vX,rgbToHex:xX,rgbToHexString:bX,hexStringToRgb:SX};var Bz=class{add(E,O,R){if(typeof arguments[0]!="string")for(let E in arguments[0])this.add(E,arguments[0][E],arguments[1]);else(Array.isArray(E)?E:[E]).forEach((function(E){this[E]=this[E]||[],O&&this[E][R?"unshift":"push"](O)}),this)}run(E,O){this[E]=this[E]||[],this[E].forEach((function(E){E.call(O&&O.context?O.context:O,O)}))}},zz=class{constructor(E){this.jsep=E,this.registered={}}register(...E){E.forEach((E=>{if(typeof E!="object"||!E.name||!E.init)throw new Error("Invalid JSEP plugin format");this.registered[E.name]||(E.init(this.jsep),this.registered[E.name]=E)}))}},Fz=class{static get version(){return"1.3.8"}static toString(){return"JavaScript Expression Parser (JSEP) v"+Fz.version}static addUnaryOp(E){return Fz.max_unop_len=Math.max(E.length,Fz.max_unop_len),Fz.unary_ops[E]=1,Fz}static addBinaryOp(E,O,R){return Fz.max_binop_len=Math.max(E.length,Fz.max_binop_len),Fz.binary_ops[E]=O,R?Fz.right_associative.add(E):Fz.right_associative.delete(E),Fz}static addIdentifierChar(E){return Fz.additional_identifier_chars.add(E),Fz}static addLiteral(E,O){return Fz.literals[E]=O,Fz}static removeUnaryOp(E){return delete Fz.unary_ops[E],E.length===Fz.max_unop_len&&(Fz.max_unop_len=Fz.getMaxKeyLen(Fz.unary_ops)),Fz}static removeAllUnaryOps(){return Fz.unary_ops={},Fz.max_unop_len=0,Fz}static removeIdentifierChar(E){return Fz.additional_identifier_chars.delete(E),Fz}static removeBinaryOp(E){return delete Fz.binary_ops[E],E.length===Fz.max_binop_len&&(Fz.max_binop_len=Fz.getMaxKeyLen(Fz.binary_ops)),Fz.right_associative.delete(E),Fz}static removeAllBinaryOps(){return Fz.binary_ops={},Fz.max_binop_len=0,Fz}static removeLiteral(E){return delete Fz.literals[E],Fz}static removeAllLiterals(){return Fz.literals={},Fz}get char(){return this.expr.charAt(this.index)}get code(){return this.expr.charCodeAt(this.index)}constructor(E){this.expr=E,this.index=0}static parse(E){return new Fz(E).parse()}static getMaxKeyLen(E){return Math.max(0,...Object.keys(E).map((E=>E.length)))}static isDecimalDigit(E){return E>=48&&E<=57}static binaryPrecedence(E){return Fz.binary_ops[E]||0}static isIdentifierStart(E){return E>=65&&E<=90||E>=97&&E<=122||E>=128&&!Fz.binary_ops[String.fromCharCode(E)]||Fz.additional_identifier_chars.has(String.fromCharCode(E))}static isIdentifierPart(E){return Fz.isIdentifierStart(E)||Fz.isDecimalDigit(E)}throwError(E){let O=new Error(E+" at character "+this.index);throw O.index=this.index,O.description=E,O}runHook(E,O){if(Fz.hooks[E]){let R={context:this,node:O};return Fz.hooks.run(E,R),R.node}return O}searchHook(E){if(Fz.hooks[E]){let O={context:this};return Fz.hooks[E].find((function(E){return E.call(O.context,O),O.node})),O.node}}gobbleSpaces(){let E=this.code;for(;E===Fz.SPACE_CODE||E===Fz.TAB_CODE||E===Fz.LF_CODE||E===Fz.CR_CODE;)E=this.expr.charCodeAt(++this.index);this.runHook("gobble-spaces")}parse(){this.runHook("before-all");let E=this.gobbleExpressions(),O=E.length===1?E[0]:{type:Fz.COMPOUND,body:E};return this.runHook("after-all",O)}gobbleExpressions(E){let O,R,z=[];for(;this.index<this.expr.length;)if(O=this.code,O===Fz.SEMCOL_CODE||O===Fz.COMMA_CODE)this.index++;else if(R=this.gobbleExpression())z.push(R);else if(this.index<this.expr.length){if(O===E)break;this.throwError('Unexpected "'+this.char+'"')}return z}gobbleExpression(){let E=this.searchHook("gobble-expression")||this.gobbleBinaryExpression();return this.gobbleSpaces(),this.runHook("after-expression",E)}gobbleBinaryOp(){this.gobbleSpaces();let E=this.expr.substr(this.index,Fz.max_binop_len),O=E.length;for(;O>0;){if(Fz.binary_ops.hasOwnProperty(E)&&(!Fz.isIdentifierStart(this.code)||this.index+E.length<this.expr.length&&!Fz.isIdentifierPart(this.expr.charCodeAt(this.index+E.length))))return this.index+=O,E;E=E.substr(0,--O)}return!1}gobbleBinaryExpression(){let E,O,R,z,V,j,Y,ee,se;if(j=this.gobbleToken(),!j||(O=this.gobbleBinaryOp(),!O))return j;for(V={value:O,prec:Fz.binaryPrecedence(O),right_a:Fz.right_associative.has(O)},Y=this.gobbleToken(),Y||this.throwError("Expected expression after "+O),z=[j,V,Y];O=this.gobbleBinaryOp();){if(R=Fz.binaryPrecedence(O),R===0){this.index-=O.length;break}V={value:O,prec:R,right_a:Fz.right_associative.has(O)},se=O;let u=E=>V.right_a&&E.right_a?R>E.prec:R<=E.prec;for(;z.length>2&&u(z[z.length-2]);)Y=z.pop(),O=z.pop().value,j=z.pop(),E={type:Fz.BINARY_EXP,operator:O,left:j,right:Y},z.push(E);E=this.gobbleToken(),E||this.throwError("Expected expression after "+se),z.push(V,E)}for(ee=z.length-1,E=z[ee];ee>1;)E={type:Fz.BINARY_EXP,operator:z[ee-1].value,left:z[ee-2],right:E},ee-=2;return E}gobbleToken(){let E,O,R,z;if(this.gobbleSpaces(),z=this.searchHook("gobble-token"),z)return this.runHook("after-token",z);if(E=this.code,Fz.isDecimalDigit(E)||E===Fz.PERIOD_CODE)return this.gobbleNumericLiteral();if(E===Fz.SQUOTE_CODE||E===Fz.DQUOTE_CODE)z=this.gobbleStringLiteral();else if(E===Fz.OBRACK_CODE)z=this.gobbleArray();else{for(O=this.expr.substr(this.index,Fz.max_unop_len),R=O.length;R>0;){if(Fz.unary_ops.hasOwnProperty(O)&&(!Fz.isIdentifierStart(this.code)||this.index+O.length<this.expr.length&&!Fz.isIdentifierPart(this.expr.charCodeAt(this.index+O.length)))){this.index+=R;let E=this.gobbleToken();return E||this.throwError("missing unaryOp argument"),this.runHook("after-token",{type:Fz.UNARY_EXP,operator:O,argument:E,prefix:!0})}O=O.substr(0,--R)}Fz.isIdentifierStart(E)?(z=this.gobbleIdentifier(),Fz.literals.hasOwnProperty(z.name)?z={type:Fz.LITERAL,value:Fz.literals[z.name],raw:z.name}:z.name===Fz.this_str&&(z={type:Fz.THIS_EXP})):E===Fz.OPAREN_CODE&&(z=this.gobbleGroup())}return z?(z=this.gobbleTokenProperty(z),this.runHook("after-token",z)):this.runHook("after-token",!1)}gobbleTokenProperty(E){this.gobbleSpaces();let O=this.code;for(;O===Fz.PERIOD_CODE||O===Fz.OBRACK_CODE||O===Fz.OPAREN_CODE||O===Fz.QUMARK_CODE;){let R;if(O===Fz.QUMARK_CODE){if(this.expr.charCodeAt(this.index+1)!==Fz.PERIOD_CODE)break;R=!0,this.index+=2,this.gobbleSpaces(),O=this.code}this.index++,O===Fz.OBRACK_CODE?(E={type:Fz.MEMBER_EXP,computed:!0,object:E,property:this.gobbleExpression()},this.gobbleSpaces(),O=this.code,O!==Fz.CBRACK_CODE&&this.throwError("Unclosed ["),this.index++):O===Fz.OPAREN_CODE?E={type:Fz.CALL_EXP,arguments:this.gobbleArguments(Fz.CPAREN_CODE),callee:E}:(O===Fz.PERIOD_CODE||R)&&(R&&this.index--,this.gobbleSpaces(),E={type:Fz.MEMBER_EXP,computed:!1,object:E,property:this.gobbleIdentifier()}),R&&(E.optional=!0),this.gobbleSpaces(),O=this.code}return E}gobbleNumericLiteral(){let E,O,R="";for(;Fz.isDecimalDigit(this.code);)R+=this.expr.charAt(this.index++);if(this.code===Fz.PERIOD_CODE)for(R+=this.expr.charAt(this.index++);Fz.isDecimalDigit(this.code);)R+=this.expr.charAt(this.index++);if(E=this.char,E==="e"||E==="E"){for(R+=this.expr.charAt(this.index++),E=this.char,(E==="+"||E==="-")&&(R+=this.expr.charAt(this.index++));Fz.isDecimalDigit(this.code);)R+=this.expr.charAt(this.index++);Fz.isDecimalDigit(this.expr.charCodeAt(this.index-1))||this.throwError("Expected exponent ("+R+this.char+")")}return O=this.code,Fz.isIdentifierStart(O)?this.throwError("Variable names cannot start with a number ("+R+this.char+")"):(O===Fz.PERIOD_CODE||R.length===1&&R.charCodeAt(0)===Fz.PERIOD_CODE)&&this.throwError("Unexpected period"),{type:Fz.LITERAL,value:parseFloat(R),raw:R}}gobbleStringLiteral(){let E="",O=this.index,R=this.expr.charAt(this.index++),z=!1;for(;this.index<this.expr.length;){let O=this.expr.charAt(this.index++);if(O===R){z=!0;break}if(O==="\\")switch(O=this.expr.charAt(this.index++),O){case"n":E+="\n";break;case"r":E+="\r";break;case"t":E+="\t";break;case"b":E+="\b";break;case"f":E+="\f";break;case"v":E+="\v";break;default:E+=O}else E+=O}return z||this.throwError('Unclosed quote after "'+E+'"'),{type:Fz.LITERAL,value:E,raw:this.expr.substring(O,this.index)}}gobbleIdentifier(){let E=this.code,O=this.index;for(Fz.isIdentifierStart(E)?this.index++:this.throwError("Unexpected "+this.char);this.index<this.expr.length&&(E=this.code,Fz.isIdentifierPart(E));)this.index++;return{type:Fz.IDENTIFIER,name:this.expr.slice(O,this.index)}}gobbleArguments(E){let O=[],R=!1,z=0;for(;this.index<this.expr.length;){this.gobbleSpaces();let V=this.code;if(V===E){R=!0,this.index++,E===Fz.CPAREN_CODE&&z&&z>=O.length&&this.throwError("Unexpected token "+String.fromCharCode(E));break}if(V===Fz.COMMA_CODE){if(this.index++,z++,z!==O.length)if(E===Fz.CPAREN_CODE)this.throwError("Unexpected token ,");else if(E===Fz.CBRACK_CODE)for(let E=O.length;E<z;E++)O.push(null)}else if(O.length!==z&&z!==0)this.throwError("Expected comma");else{let E=this.gobbleExpression();(!E||E.type===Fz.COMPOUND)&&this.throwError("Expected comma"),O.push(E)}}return R||this.throwError("Expected "+String.fromCharCode(E)),O}gobbleGroup(){this.index++;let E=this.gobbleExpressions(Fz.CPAREN_CODE);if(this.code===Fz.CPAREN_CODE)return this.index++,E.length===1?E[0]:!!E.length&&{type:Fz.SEQUENCE_EXP,expressions:E};this.throwError("Unclosed (")}gobbleArray(){return this.index++,{type:Fz.ARRAY_EXP,elements:this.gobbleArguments(Fz.CBRACK_CODE)}}},Nz=new Bz;Object.assign(Fz,{hooks:Nz,plugins:new zz(Fz),COMPOUND:"Compound",SEQUENCE_EXP:"SequenceExpression",IDENTIFIER:"Identifier",MEMBER_EXP:"MemberExpression",LITERAL:"Literal",THIS_EXP:"ThisExpression",CALL_EXP:"CallExpression",UNARY_EXP:"UnaryExpression",BINARY_EXP:"BinaryExpression",ARRAY_EXP:"ArrayExpression",TAB_CODE:9,LF_CODE:10,CR_CODE:13,SPACE_CODE:32,PERIOD_CODE:46,COMMA_CODE:44,SQUOTE_CODE:39,DQUOTE_CODE:34,OPAREN_CODE:40,CPAREN_CODE:41,OBRACK_CODE:91,CBRACK_CODE:93,QUMARK_CODE:63,SEMCOL_CODE:59,COLON_CODE:58,unary_ops:{"-":1,"!":1,"~":1,"+":1},binary_ops:{"||":1,"&&":2,"|":3,"^":4,"&":5,"==":6,"!=":6,"===":6,"!==":6,"<":7,">":7,"<=":7,">=":7,"<<":8,">>":8,">>>":8,"+":9,"-":9,"*":10,"/":10,"%":10},right_associative:new Set,additional_identifier_chars:new Set(["$","_"]),literals:{true:!0,false:!1,null:null},this_str:"this"});Fz.max_unop_len=Fz.getMaxKeyLen(Fz.unary_ops);Fz.max_binop_len=Fz.getMaxKeyLen(Fz.binary_ops);var Xc=E=>new Fz(E).parse(),Uz=Object.getOwnPropertyNames(Fz);Uz.forEach((E=>{Xc[E]===void 0&&E!=="prototype"&&(Xc[E]=Fz[E])}));Xc.Jsep=Fz;var kz="ConditionalExpression",Vz={name:"ternary",init(E){E.hooks.add("after-expression",(function(O){if(O.node&&this.code===E.QUMARK_CODE){this.index++;let R=O.node,z=this.gobbleExpression();if(z||this.throwError("Expected expression"),this.gobbleSpaces(),this.code===E.COLON_CODE){this.index++;let V=this.gobbleExpression();if(V||this.throwError("Expected expression"),O.node={type:kz,test:R,consequent:z,alternate:V},R.operator&&E.binary_ops[R.operator]<=.9){let z=R;for(;z.right.operator&&E.binary_ops[z.right.operator]<=.9;)z=z.right;O.node.test=z.right,z.right=O.node,O.node=R}}else this.throwError("Expected :")}}))}};Xc.plugins.register(Vz);function La(E){return{all:E=E||new Map,on:function(O,R){var z=E.get(O);z?z.push(R):E.set(O,[R])},off:function(O,R){var z=E.get(O);z&&(R?z.splice(z.indexOf(R)>>>0,1):E.set(O,[]))},emit:function(O,R){var z=E.get(O);z&&z.slice().map((function(E){E(R)})),(z=E.get("*"))&&z.slice().map((function(E){E(O,R)}))}}}var jz=class{constructor(E,O,R){this.id=E;this.userAPI=O;this.result=void 0;this.error="null";this.isPrefetched=!1;this.isLoading=!1;this.isLoaded=!1;this.prefetchPromise=new Promise((E=>E()));this.emitter=La();this._innerCallUserAPI=async E=>{this.emitter.emit("start",{userAPIId:this.id}),this.isLoading=!0,this.isLoading=!1;try{this.result=await IX(this.userAPI,E),this.error="null",this.emitter.emit("success",{userAPIId:this.id})}catch(E){let O=E.message?.split("_:_")?.[0]?.replace("status:","")??"null";this.error=O,this.result=null,this.emitter.emit("error",{userAPIId:this.id})}this.isLoading=!1,this.isPrefetched=!0,this.isLoaded=!0};O?.integration?.type==="OpenAI"?this.result={content:""}:O.method==="GET"&&O.url!==""&&(this.prefetchPromise=this.prefetch(R)),this._debouncedCallUserAPI=this._innerCallUserAPI,this._updateDebouncedCallUserAPI(),this._debouncedPrefetch=XA(this.prefetch,1e3,{trailing:!0})}_updateDebouncedCallUserAPI(){this._debouncedCallUserAPI=this.userAPI.debounce!==void 0&&this.userAPI.debounce>0?XA(this._innerCallUserAPI,this.userAPI.debounce,{leading:!0,trailing:!0}):this._innerCallUserAPI}async prefetch(E){await this.callUserAPI(E)}async callUserAPI(E){await this._debouncedCallUserAPI(E)}update(E,O,R=!0){this.userAPI=E,this._updateDebouncedCallUserAPI(),this.userAPI.url!==""&&this.userAPI.method==="GET"&&R&&this._debouncedPrefetch(O)}retrieveValue(E){if(this.result)try{return lE.zoom(this.result,E)}catch(E){console.error(E)}}retrieveZoomedKeyValues(E){if(this.result){let O=E&&E.length?lE.zoom(this.result,E):this.result;if(_X(O))return Object.entries(O);if(PX(O))return O.map(((E,O)=>[O.toString(),E]));throw CX(O)?new Error("This path points to a value, use retrieveValue() instead. "+E?.join(".")):new Error("Path error"+E?.join("."))}}dispose(){}on(E,O){this.emitter.on(E,O)}off(E,O){this.emitter.off(E,O)}get autostart(){return this.userAPI.autoStart}};function MX(E){let O=new Headers;return E.headers.forEach((E=>{E.data.key!==""&&O.append(E.data.key,E.data.value)})),O}function CX(E){return typeof E=="string"||typeof E=="number"||typeof E=="boolean"||E===null}function PX(E){return Array.isArray(E)}function _X(E){return typeof E=="object"&&E!==null}async function IX(E,O,R=new AbortController){let z,V,j=E.url,Y=E.proxy?.enabled??!1;if(E.integration?.type==="OpenAI"){let R=Sm(E.integration.prompt===""?[]:JSON.parse(E.integration.prompt),O),z=E.integration.behavior===""?[]:Sm(JSON.parse(E.integration.behavior),O);V=`{\n\t\t"model": "${E.integration.model}",\n\t\t"messages": [${E.integration.useBehavior?`\n\t\t{\n\t\t\t"role": "system",\n\t\t\t"content": "${z}"\n\t\t},`:""}\n\t\t{\n\t\t\t"role": "user",\n\t\t\t"content": "${R}"\n\t\t}\n\t\t]\n\t}`}if(Y){j=`https://apis.spline.design/file/${E.proxy.fileId}/external-api/request?uuidexternalapi=${E.proxy.proxyId}`;let R;V!==void 0?R=V:E.method==="POST"&&E.body&&(R=Sm(JSON.parse(E.body),O)),R!==void 0&&(j+=`&data=${encodeURIComponent(R.replace(/(\r\n|\n|\r|\t)/gm,""))}`)}else E.integration?.type==="OpenAI"?z=V:E.method==="POST"&&E.body&&(z=Sm(JSON.parse(E.body),O));let ee=await fetch(j,{method:Y?"GET":E.method,headers:Y?void 0:MX(E),signal:R.signal,body:z});if(!ee.ok)throw new Error("status:"+ee.status+"_:_"+ee.statusText);if(E.integration?.type==="OpenAI"){let E=await ee.json();return Y&&(E=E.response),{content:E.choices[0].message.content}}{let E=await ee.json();return Y&&(E=E.response),E}}var uR=(E,O)=>{if(typeof E=="string"){let R=O.getVariable(E);if(R)return uR(R,O)}return ID.isBoolean(E)?ID.getDisplayedValue(E).toLowerCase():ID.getDisplayedValue(E)},Sm=(E,O)=>E.map(((E,R)=>{if("text"in E)return E.text;if("type"in E){if(E.type==="paragraph")return(R>0?"\n":"")+Sm(E.children,O);if(E.type==="variable"){let R=O.getVariable(E.variableId);if(R!==void 0)return uR(R,O)}}return""})).join("");var Gz=["+","-","*","/","(",")","==","!=",">","<",">=","<=","and","or","!","%","^",","],Hz=["0","1","2","3","4","5","6","7","8","9","."],Wz=["sin","cos","tan","asin","acos","atan","atan2","sqrt","abs","log","exp","floor","ceil","round","min","max","random"];function LX(E){return typeof E=="string"&&(!isNaN(E)&&!isNaN(parseFloat(E)))}Xc.addBinaryOp("^",11,!0);function j0(E,O,R="number"){let z="";for(let V=0;V<E.length;V++){let j=E[V];if("objType"in j&&j.objType==="api"){let E=JSON.parse(j.id),R=E[0],V=O.getUserAPI(R);if(V!==void 0&&V instanceof jz){let O=V.retrieveValue(E.slice(1));O!==void 0&&(z+=O)}}else if("objType"in j&&j.objType==="webhook"){let E=JSON.parse(j.id),[R,V]=E,Y=O.getUserWebhook(R);if(Y!==void 0){let E=Y.getParameterValue(V);E!==void 0&&(z+=E)}}else if("objType"in j&&j.objType==="aiAssistant"){let E=O.openAIRealtime;if("objId"in j&&j.objId!==void 0){let R;if(O.scene.data.objects.traverse(((E,O)=>{let z=O.events?.find((E=>E.id===j.objId));z&&(R=z)})),R!==void 0&&R.data.type==="AIAssistantListener"){let O=E?.computeAnalysisForListenerEvent(R.data);if(O!==void 0){z+=O;continue}}}z+=E?.voice??0}else if("id"in j){let Y=E[V-1];if(V>0&&"id"in Y){console.error("Two variables in a row",E);return}let ee=O.getVariable(j.id),se=ID.getDisplayedValue(ee);R==="number"&&ID.isTextValue(ee)&&Array.isArray(ee.textValue)&&ee.textValue.length===1?se=parseFloat(se).toString():R==="boolean"&&ID.isBoolean(ee)?se=ee?"true":"false":R==="boolean"&&ID.isTextValue(ee)&&!Array.isArray(ee.textValue)&&(se='"'+se+'"'),z+=se}else R!=="string"?j.name!=="and"?j.name!=="or"?j.name!=="True"?j.name!=="False"?R!=="boolean"||LX(j.name)||Hz.includes(j.name)||Gz.includes(j.name)||Wz.includes(j.name.replace(/\($/g,""))?z+=j.name:z+='"'+j.name+'"':z+="false":z+="true":z+="||":z+="&&":(j.name!=='"'&&(j.name!=="+"||j.escaped)&&(z+=j.name),j.name==="+"&&!j.escaped&&z[z.length-1]==="\\"&&(z=z.slice(0,-1)+j.name))}if(R==="string")return z;if(E.length===0){if(R==="number")return 0;if(R==="boolean")return!1}let V;try{V=Xc(z)}catch(E){console.error(z,E);return}let j;try{j=Yt(V)}catch(E){console.error(z,V,E)}return j}function Yt(E){switch(E.type){case"BinaryExpression":switch(E.operator){case"==":return Number(Yt(E.left)===Yt(E.right));case"!=":return Number(Yt(E.left)!==Yt(E.right));case">":return Number(Yt(E.left)>Yt(E.right));case">=":return Number(Yt(E.left)>=Yt(E.right));case"<":return Number(Yt(E.left)<Yt(E.right));case"<=":return Number(Yt(E.left)<=Yt(E.right));case"+":return Yt(E.left)+Yt(E.right);case"-":return Yt(E.left)-Yt(E.right);case"*":return Yt(E.left)*Yt(E.right);case"/":return Yt(E.left)/Yt(E.right);case"%":return Yt(E.left)%Yt(E.right);case"&&":return Yt(E.left)&&Yt(E.right);case"||":return Yt(E.left)||Yt(E.right);case"^":return Math.pow(Yt(E.left),Yt(E.right));default:throw new Error("Unknown operator: "+E.operator)}case"UnaryExpression":switch(E.operator){case"-":return-Yt(E.argument);case"!":return Number(!Yt(E.argument));default:throw new Error("Unknown operator: "+E.operator)}case"Identifier":throw new Error("Unknown identifier: "+E.name);case"Literal":return E.value;case"CallExpression":if(E.callee.type==="Identifier"){if(E.callee.name==="random"){let O=0,R=1;if(E.arguments.length>=1)try{O=Yt(E.arguments[0])}catch(E){console.warn(E)}if(E.arguments.length>=2)try{R=Yt(E.arguments[1])}catch(E){console.warn(E)}return O=Math.min(R,O),R=Math.max(R,O),O+Math.random()*(R-O)}return Math[E.callee.name].apply(null,E.arguments.map(Yt))}throw new Error("Unknown node");default:throw new Error("Unknown node type: "+E.type)}}var qz=new Es,Xz=new Es;function FX(E,O,R){let z=[new Wn,new Wn,new Wn],V=[new Wn,new Wn,new Wn];return E.extractBasis(z[0],z[1],z[2]),O.extractBasis(V[0],V[1],V[2]),z.forEach(((E,O)=>{let z=V[O],j=xn.lerp(E.length(),z.length(),R);E.lerp(z,R).setLength(j)})),(new Es).makeBasis(z[0],z[1],z[2])}var Yz=class{static create(E){return this.build(this.normalizeInputs(E))}static normalizeInputs(E,O){let R=Object.assign({},O?.parameters??{width:100,height:100,depth:1,subdivisions:12,roundness:0,extrudeBevelSize:0,extrudeBevelSegments:3},E.parameters),z=Math.abs(R.width),V=Math.abs(R.height??R.width),j=Math.abs(R.depth??0),Y=O?.shapeData??nz.create({parameters:kP}).userData.shape;return{path:E.path??UP.defaultData(),parameters:Object.assign(R,{width:z,height:V,depth:j,extrusion:{...GP,...R.extrusion}}),shapeData:Y}}static build(E){if(E.path.points.length>=2){let O=new Qz(E);return Object.assign(O,{userData:{...E,type:"PathGeometry"}})}return Object.assign(new Na,{userData:{...E,type:"PathGeometry"}})}},Qz=class extends Na{constructor(E){super();this.type="PathExtrusionGeometry",this.inputs=E,this.build()}_isGeometryClosed(){return this.inputs.path.isClosed&&this.inputs.parameters.extrusion.depth===1}_isOpenEnded(){let E=this.inputs.parameters.extrusion;return!(this.inputs.path.isClosed&&E.depth===1)||!lR(E.twist,0)||E.startScale!==E.endScale}build(){let E=this._extractPathPoints();if(E.length<2)return;let O=this._computeBasisMatrices(E),{depth:R,offset:z}=this.inputs.parameters.extrusion;R=Math.max(0,Math.min(R,1)),z=Math.max(0,Math.min(z,1));let V=this.inputs.path.isClosed?E.length:E.length-1,j=Math.floor(z*V),Y=this.inputs.path.isClosed?Math.ceil((R+z)*V):Math.ceil(Math.min(1,R+z)*V),ee=Math.min(Math.max(2,Y-j+1),V+2),se=[],he=[];for(let R=0;R<ee;R++){let z=this.inputs.path.isClosed?(R+j)%E.length:Math.min(R+j,E.length-1);se.push(E[z].clone()),he.push(O[z].clone())}let d=(E,O,R)=>{se[E]=se[E].clone().lerp(se[O],R),he[E]=FX(he[E],he[O],R)},ce=0,ue=z*V%1;(!this.inputs.path.isClosed||R<=1)&&(ue||z===0)&&(ce=ue,d(0,1,ce));let fe=0,ve=(z+R)*V%1;if((this.inputs.path.isClosed&&R<=1||!this.inputs.path.isClosed&&z+R<1)&&ve&&(fe=ve,d(se.length-1,se.length-2,1-fe)),R===0){let E=se.length-1;se[E].copy(se[0]),he[E].copy(he[0])}this._applyPathModifiers(he,ce,fe);let{bevel:we,bevelSides:Se}=this.inputs.parameters.extrusion,_e=we>0?this.inputs.parameters.extrusion.capType:"flat",Ae=5;this.inputs.parameters.extrusion.shape.type==="Custom"&&(Ae=this.inputs.parameters.extrusion.shape.shapeQuality==="low"?5:12);let Ce,{regions:Te,infos:Ie,vertices:Fe}=this._computeShapePoints(Ae),Ue=0;_e==="round"&&(Ce=new JB(this.inputs.shapeData,2*we,we,Ae,Se,void 0,!0),Ue=Ce.getAttribute("position").count);let Ge=0,qe=0;Ie.sort(((E,O)=>E.start-O.start)),Ie.forEach((E=>{E.verticesStart=Ge,E.verticesCount=E.continuous.reduce(((E,O,R)=>E+(R!==0&&O?1:2)),0),qe+=E.verticesCount,Ge=qe}));let Xe,Qe=qe*ee,Ze=0;if(this._isOpenEnded()&&_e==="flat"){try{Xe=Xs({windingRule:hB.ODD,elementType:cB.POLYGONS,polySize:3,vertexSize:2,strict:!0,contours:Te})}catch{Xe=KB}Ze=Xe.vertexCount}let Ke=Qe+2*Ze+Ue*2,Je=Qe+2*Ze,$e={positions:new Float32Array(Ke*3),normals:new Float32Array(Ke*3),uvs:new Float32Array(Ke*2)},et=[];if(Ie.forEach((E=>{this._extrudeRegion(E,Fe,he,se,$e,et,this._isGeometryClosed()&&!this._isOpenEnded())})),Xe&&(this._closeEnd(Xe,Qe,et,$e,he[0],se[0],!1),this._closeEnd(Xe,Qe+Ze,et,$e,he[he.length-1],se[se.length-1],!0)),Ce){$e.positions.set(Ce.getAttribute("position").array,Je*3),$e.normals.set(Ce.getAttribute("normal").array,Je*3),$e.uvs.set(Ce.getAttribute("uv").array,Je*2);for(let E=Je;E<Je+Ue;E++)$e.uvs[E*2+1]=1e-4;let E=et.length;et.push(...Ce.getIndex().array.map((E=>E+Je))),Je+=Ue,$e.positions.set(Ce.getAttribute("position").array,Je*3),$e.normals.set(Ce.getAttribute("normal").array,Je*3),$e.uvs.set(Ce.getAttribute("uv").array,Je*2);let O=et.length;et.push(...Ce.getIndex().array.map((E=>E+Je))),this.setAttribute("position",new Sa($e.positions,3)),this.setAttribute("normal",new Sa($e.normals,3)),this.setAttribute("uv",new Sa($e.uvs,2)),this.setIndex(et);let R=qz;R.copy(he[he.length-1]).setPosition(se[se.length-1]),this.applyMatrix4OnRange(R,Je,Ke),R.copy(he[0]).setPosition(se[0]).multiply(Xz.makeScale(1,1,-1)),this.applyMatrix4OnRange(R,Je-Ue,Je),this.reverseIndicesOnRange(E,O)}else this.setAttribute("position",new Sa($e.positions,3)),this.setAttribute("normal",new Sa($e.normals,3)),this.setAttribute("uv",new Sa($e.uvs,2)),this.setIndex(et)}_extractPathPoints(){let E=_0(this.inputs.path).getPoints(this.inputs.path.subdivisions);if(E.length<2)return[];let O=[E[0]];return E.forEach((E=>{O[O.length-1].distanceToSquared(E)>.001&&O.push(E)})),this.inputs.path.isClosed&&O[O.length-1].distanceTo(O[0])<.001&&O.pop(),O}_computeBasisMatrices(E){let O=[],R=E.length,z=this.inputs.path.isClosed,V=new Wn,j=new Wn,Y=new Wn,ee=new Wn,se=new Wn(0,1,0);for(let he=0;he<R;he++){let ce,ue=E[he];ce=he===0?z?E[E.length-2]:ue.clone().multiplyScalar(2).sub(E[1]):E[he-1];let fe;fe=he===R-1?z?E[1]:ue.clone().multiplyScalar(2).sub(E[he-1]):E[he+1];let ve=ue.clone().sub(ce).normalize(),we=fe.clone().sub(ue).normalize(),Se=ve.clone().add(we).normalize();Y.copy(Se),he===0&&(Se.equals(se)||Se.clone().negate().equals(se))&&se.set(0,0,1);let _e=se.clone().cross(Se).normalize(),Ae=Se.clone().cross(_e).normalize();se.copy(Ae),ee.copy(_e),he===0&&(V.copy(Ae),j.copy(Se));let Ce=(new Es).makeBasis(_e,Ae,Se);O.push(Ce)}let he=z?j:Y,ce=z?V:new Wn(0,1,0),ue=he.clone().cross(ee).normalize(),fe=Math.acos(ce.dot(ue));if(isNaN(fe))return O;let ve=ce.clone().cross(ue);he.dot(ve)>0&&(fe*=-1);for(let E=1;E<O.length;E++){let R=(new Es).makeRotationZ(fe*E/O.length);O[E].multiply(R)}return O}_applyPathModifiers(E,O,R){let z=E.length,{angle:V,twist:j,startScale:Y,endScale:ee}=this.inputs.parameters.extrusion,se=new Es,he=new Es;return E.forEach(((E,ce)=>{let ue=ce===0?0:ce===z-1?1:(ce-O)/(z-(R===0?0:1)-(O+(1-R)));se.makeRotationZ(xn.lerp(V,V+j,ue)*xn.DEG2RAD);let fe=xn.lerp(Y,ee,ue);he.makeScale(fe,fe,fe),E.multiply(se).multiply(he)})),E}_computeShapePoints(E=12,O=hB.ODD){let R,z=this.inputs.shapeData,V=z.extractShapePointsToFlatArray([],E),j=z.shapeHoles.map((O=>{let R=O.extractShapePointsToFlatArray([],E),z=[];for(let E=R.length-1;E>=1;E-=2){let O=R[E-1],V=R[E-0];z.push(O,V)}return z}));try{R=Xs({windingRule:O,elementType:cB.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[V]})}catch{R=WB}let Y;try{Y=Xs({windingRule:hB.ODD,elementType:cB.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[...j]})}catch{Y=QB}if(!R)throw new Error("error generating geometry");let ee=R.elementCount;if(Y){R.elementCount+=Y.elementCount;for(let E=0;E<Y.elements.length;E++){let O=Y.elements[E],z=E%2===0?R.vertexCount:0;R.elements.push(O+z)}for(let E=0;E<Y.vertexIndices.length;E++){let O=Y.vertexIndices[E],z=R.vertexCount;R.vertexIndices.push(O+z)}for(let E=0;E<Y.vertices.length;E++){let O=Y.vertices[E];R.vertices.push(O)}}let se=1/0,he=-1/0,ce=1/0,ue=-1/0;for(let E=0,O=R.vertexCount;E<O;E++){let O=E*2,z=R.vertices[O+0],V=R.vertices[O+1];z<se&&(se=z),z>he&&(he=z),V<ce&&(ce=V),V>ue&&(ue=V)}let fe=[];for(let E=R.elementCount-1;E>=0;E--){let O=E>=ee,V=E*2,j=R.elements[V+0],Y=R.elements[V+1],se=j+Y,he={start:j,count:Y,normals:[],isHole:O,continuous:[],verticesStart:0,verticesCount:0};fe.push(he);let ce=j,ue=se-1,ve=j+1,we=z.roundedCurves.length;do{let E=ce-j,V=R.vertices[ue*2+0],ee=R.vertices[ue*2+1],fe=R.vertices[ce*2+0],Se=R.vertices[ce*2+1],_e=R.vertices[ve*2+0],Ae=R.vertices[ve*2+1],Ce=fe-V,Te=Se-ee,Ie=Math.sqrt(Ce*Ce+Te*Te);Ce/=Ie,Te/=Ie;let Fe=fe-_e,Ue=Se-Ae,Ge=Math.sqrt(Fe*Fe+Ue*Ue);Fe/=Ge,Ue/=Ge,he.normals[E*2+0]=-Ue,he.normals[E*2+1]=Fe;let qe=R.vertexIndices[ce];if(Array.isArray(qe))he.continuous[E]=!1;else{let[O,R]=z.getCurveIndexFromVertexId(qe-1,!0);if(R>0&&R<1)he.continuous[E]=!0;else{let V=R===1?O+1:O-1;V=(V+we)%we;let j=R===1?0:1,Y=z.roundedCurves[O].getTangent(R),ee=z.roundedCurves[V].getTangent(j);he.continuous[E]=Y.dot(ee)>.95}}O&&(he.normals[E*2+0]*=-1,he.normals[E*2+1]*=-1),[ue,ce,ve]=[ce,ve,ve+1],ve>=se&&(ve-=Y)}while(ve!==j+1)}return{regions:[V,...j],infos:fe,vertices:R.vertices}}_insertVertex(E,O,R,z,V){let j=O*2,Y=O*3;E.positions[Y+0]=R.x,E.positions[Y+1]=R.y,E.positions[Y+2]=R.z,E.normals[Y+0]=z.x,E.normals[Y+1]=z.y,E.normals[Y+2]=z.z,E.uvs[j+0]=V.x,E.uvs[j+1]=V.y}_extrudeRegion(E,O,R,z,V,j,Y){let ee=new Wn,se=new Wn,he=new Wn,ce=new Wn,ue=new bn;R.forEach(((j,Y)=>{let fe=z[Y],ve=E.verticesStart*R.length+E.verticesCount*Y;for(let z=0;z<E.count;z++){let we=(E.start+z)*2;if(ee.set(O[we+0],O[we+1],0),he.copy(ee).applyMatrix4(j).add(fe),E.continuous[z])ce.set(E.normals[z*2+0],E.normals[z*2+1],0);else{let R=z===0?2*(E.start+E.count-1):we-2;se.set(O[R+0],O[R+1],0),ce.copy(ee).sub(se),ce.set(-ce.y,ce.x,0),E.isHole||ce.negate()}if(ce.applyMatrix4(j).normalize(),ue.set(z===0?1:z/E.count,Y/(R.length-1)),this._insertVertex(V,ve,he,ce,ue),ve++,!E.continuous[z]||z===0){if(z===0)ce.set(E.normals[z*2+0],E.normals[z*2+1],0),ue.set(0,Y/(R.length-1));else{let R=z===E.count-1?E.start*2:we+2;se.set(O[R+0],O[R+1],0),ce.copy(se).sub(ee),ce.set(-ce.y,ce.x,0),E.isHole||ce.negate()}ce.applyMatrix4(j).normalize(),this._insertVertex(V,ve,he,ce,ue),ve++}}}));let fe=R.length-1;for(let O=0;O<fe;O++){let z=E.verticesStart*R.length+E.verticesCount*O,V=E.verticesStart*R.length+E.verticesCount*(O+1),Y=0;for(let O=0;O<E.count;O++){(!E.continuous[O]||O===0)&&Y++;let R=O===E.count-1?0:Y+1,ee=z+Y,se=z+R,he=V+R,ce=V+Y;E.isHole?j.push(ee,he,se,ee,ce,he):j.push(ee,se,he,ee,he,ce),Y++}}}_closeEnd(E,O,R,z,V,j,Y){let ee=E.vertexCount,se=new Wn(0,0,Y?-1:1).applyMatrix4(V),he=new Wn,ce=new bn;for(let R=0;R<ee;R++){let Y=2*R;he.set(E.vertices[Y+0],E.vertices[Y+1],0).applyMatrix4(V).add(j),this._insertVertex(z,O+R,he,se,ce)}let ue=E.elements;for(let z=0;z<E.elementCount;z++){let E=3*z,V=ue[E+0]+O,j=ue[E+(Y?1:2)]+O,ee=ue[E+(Y?2:1)]+O;R.push(V,j,ee)}}applyMatrix4OnRange(E,O,R){let z,V,j,Y,ee=E.elements,se=(new wn).getNormalMatrix(E).elements,he=this.attributes.position,ce=this.attributes.normal;if(!he||!ce)return;let ue=he.array,fe=ce.array,ve=he.itemSize;for(let E=O*ve,he=R*ve;E<he;E+=ve){if(E===O)debugger;z=ue[E+0],V=ue[E+1],j=ue[E+2],Y=1/(ee[3]*z+ee[7]*V+ee[11]*j+ee[15]),ue[E+0]=(ee[0]*z+ee[4]*V+ee[8]*j+ee[12])*Y,ue[E+1]=(ee[1]*z+ee[5]*V+ee[9]*j+ee[13])*Y,ue[E+2]=(ee[2]*z+ee[6]*V+ee[10]*j+ee[14])*Y,z=fe[E+0],V=fe[E+1],j=fe[E+2],fe[E+0]=se[0]*z+se[3]*V+se[6]*j,fe[E+1]=se[1]*z+se[4]*V+se[7]*j,fe[E+2]=se[2]*z+se[5]*V+se[8]*j}he.needsUpdate=!0,ce.needsUpdate=!0}reverseIndicesOnRange(E,O){let R=this.index;if(R){for(let z=E;z<O;z+=3){let E=R.getX(z),O=R.getX(z+1),V=R.getX(z+2);R.setXYZ(z,V,O,E)}R.needsUpdate=!0}}};function dR(){let E=new Na;return E.setAttribute("position",new Sa(new Float32Array([]),3)),E.setIndex(new Sa(new Uint16Array([]),1)),E}var Zz=dR().attributes,Kz=12,Jz=1,$z=class extends Na{constructor(E,O){super();this.charWidths=[];this.charCoords=[];this.wrappedText=[];this.isLowResolution=!1;this.vectorShapes=[];Object.assign(this.attributes,Zz),this.userData={parameters:E,type:"TextGeometry"};let R=O.getFont(E.font);R?.isLoaded?(this.font=R,this.update(E)):this.updateFont(E.font,O).then((()=>{this.update(E),O?.requestRender()}))}async updateFont(E,O){let R=O.getFont(E);R&&(this.font=R,await R.loadingPromise)}update(E){let O=this.font;if(this.userData={parameters:E,type:"TextGeometry"},!O?.isLoaded){console.warn("Cannot update text because its font is not loaded");return}let{width:R,height:z,depth:V,extrudeBevelSize:j,extrudeBevelSegments:Y,text:ee,textTransform:se}=E,he=ID.getDisplayedValue(ee),ce=se===2?he.toUpperCase():se===3?he.toLowerCase():he,ue=GX(E,O,ce),{shapes:fe,charWidths:ve,charCoords:we}=O.generateShapes(ue,E),Se=(typeof R=="number"?R:1)*.5,_e=(typeof z=="number"?z:1)*.5,Ae=fe.map((E=>(new oB).fromShape(E,!0)));this.vectorShapes=Ae;let Ce=Ae.map((E=>iz.create({shape:E,parameters:{depth:V,extrudeBevelSegments:Y,extrudeBevelSize:j,windingRule:V<=0?hB.NONZERO:hB.ODD,subdivisions:this.isLowResolution&&V>0?Jz:Kz}}))),Te=Ce.length?js(Ce):dR();Te.translate(-Se,_e,0),this.dispose(),this.wrappedText=ue,this.charCoords=we,this.charWidths=ve,this.deleteAttribute("extrudeNormal"),Object.entries(Te.attributes).forEach((([E,O])=>{this.setAttribute(E,O)})),this.setIndex(Te.index),this.computeBoundingSphere()}clone(){let E=Xi(new Na,$z.prototype);return E.copy(this),console.log("CloneGeometry",this,E),E}copy(E){return Object.entries(E.attributes).forEach((([E,O])=>{this.setAttribute(E,O)})),this.setIndex(E.index),this.userData={parameters:{...E.userData.parameters},type:"TextGeometry"},this}async setText(E){this.font&&await this.font.loadingPromise,await this.update({...this.userData.parameters,text:{textValue:E}})}get text(){return this.userData.parameters.text??""}};function GX(E,O,R){let z=[""],V="";for(let j of R)V+=j,j===" "||j==="\n"?(z[z.length-1]+=V,V="",j==="\n"&&z.push("")):O.getTextWidth(z[z.length-1]+V,E)>E.width&&(z[z.length-1].length&&z.push(""),O.getTextWidth(z[z.length-1]+V,E)>E.width&&(V.length===1?(z[z.length-1]+=V,V=""):(z[z.length-1]+=V.slice(0,-1),V=V[V.length-1],z.push(""))));return z[z.length-1]+=V,z}var eF,tF=new Promise((E=>{eF=E})),iF=!1;var nF;function mR(){if(!iF)return nF||(nF=n(),nF);async function n(){let E="https://unpkg.com/@splinetool/modelling-wasm@1.9.76/build",O=import("../_/LIKM2G_C.js"),[R,z]=await Promise.all([O,fetch(`${E}/process.wasm`).then((E=>E.arrayBuffer()))]),V=R.default,j=await V({wasmBinary:z});eF(j),iF=!0}}var sF=["font"];function Ba(E,O,R,z){let V,j,Y;E.type==="PathGeometry"?(j=JSON.parse(JSON.stringify(E)),Y=[[],["extrusion"]]):(j={...E},Y=[[]]);for(let E of Y){let R=j;for(let O of E)R=R[O];for(V in R){let j=R[V];zw(j)&&!sF.includes(V)&&(R[V]=O.getVariable(j,[z.uuid,"geometry",...E,V]),zw(R[V])&&(R[V]=1))}}let ee={parameters:j,type:j.type};if(j.type==="PathGeometry")ee.path=j.path;else if(j.type==="VectorGeometry"){let E=oB.createFromState(j.shape,j.width,j.height);ee.shape=E}else if(j.type==="NonParametricGeometry"){if(j.data.groups&&j.data.groups?.forEach((E=>E.materialIndex=Math.max(E.materialIndex??0,0))),ee.geometry=(new ef).parse(j),ee.geometry.groups.length===0){let E=ee.geometry;E.addGroup(0,Math.max(E.getIndex()?.count??0,E.getAttribute("position").count),0)}}else{if(j.type==="SubdivGeometry"){let O=new bF(j,R);return O.data=E,O}if(j.type==="TextGeometry")return new $z(j,O);if(j.type==="InputGeometry")return new $z(j,O);if(j.type==="UIGeometry")return Az.create({parameters:{width:j.width,height:j.height,cornerRadius:j.cornerRadius,cornerType:j.cornerType}})}let se;try{se=iE(ee)}catch(E){console.error(E)}if(!se){let E=oB.createFromState(NP.defaultData(),100,100);ee.shape=E,se=iE(ee)}return se}var aF=new Es;function wm(E,O,R,z){let V,j,Y,ee=E.position.array,se=E.normal.array,he=aF.makeScale(O,R,z).invert().elements;for(var ce=0,ue=ee.length;ce<ue;ce+=3)ee[ce]*=O,ee[ce+1]*=R,ee[ce+2]*=z,V=se[ce],j=se[ce+1],Y=se[ce+2],se[ce]=he[0]*V+he[4]*j+he[8]*Y,se[ce+1]=he[1]*V+he[5]*j+he[9]*Y,se[ce+2]=he[2]*V+he[6]*j+he[10]*Y;E.position.needsUpdate=!0,E.normal.needsUpdate=!0}var oF,lF=new Yn,hF=new Wn;tF.then((E=>{oF=E}));var dF=new Float32Array([10,10,0,-10,10,0,-10,-10,0,10,-10,0]),uF=new Uint32Array([0,1,2,3]),mF=new Uint8Array([4]),bF=class extends Na{constructor(E,O){super();this.data=E;this.flatShading=O;this.subdivPointer=0;this.rebuild(),this.freeSubdivPointer()}mutateDirectlyScaleBaked(E,O){this.freeSubdivPointer();let R=this.data.scaleBaked,z=wT.div(O,R);this.subdividedGeometry&&wm(this.subdividedGeometry.attributes,...z),this.originalGeometry&&wm(this.originalGeometry.attributes,...z),this.data=E;let V=this.userData.parameters;this.userData.parameters={width:V.width*z[0],height:V.height*z[1],depth:V.depth*z[2]},this.originalGeometry.boundingSphere.center.multiply(hF.fromArray(z));let j=hF.set(V.width,V.height,V.depth).length();this.originalGeometry.boundingSphere.radius=j/2}ensureSubdivPointer(){return this.subdivPointer===0&&this.rebuild(),this.subdivPointer}rebuild(){let E,O,R;try{({originalGeometry:E,subdividedGeometry:O,subdivPointer:R}=bF.build(this.data,void 0,!this.flatShading,void 0))}catch{E=new to(100,100,100),R=0}this.subdivPointer=R,this.originalGeometry=E,this.subdividedGeometry=O??void 0;let z=this.subdividedGeometry??this.originalGeometry;Object.assign(this,z),this.calcBoundingBox()}freeSubdivPointer(){this.subdivPointer&&(bF.freeSubdivPointer(this.subdivPointer),this.subdivPointer=0)}dispose(){super.dispose(),this.freeSubdivPointer()}calcBoundingBox(){let E=this.originalGeometry;E.boundingSphere===null&&(E.boundingSphere=new ps,this.subdividedGeometry&&(this.subdividedGeometry.boundingSphere=E.boundingSphere));let O=E.attributes.position,R=E.boundingSphere.center;lF.setFromBufferAttribute(O),lF.getCenter(R),E.boundingSphere.radius=R.distanceTo(lF.max),isNaN(E.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this),lF.getSize(hF);let z={width:hF.x,height:hF.y,depth:hF.z};return this.userData.parameters=z,z}static build(E,O,R,z){let V,j,Y,ee=E?.phongAngle??35;R===!1&&(ee=-1),O&&(oF.free_bvh(O),oF.free_subdivision_surface(O));try{V=bF.allocate(E,z)}catch(O){console.error(O,E),V=bF.allocate({positionWASM:dF,indexWASM:uF,verticesPerFaceWASM:mF},z)}if(oF.set_destination_refinement_level(V,0),j=bF.buildLevel(V,!0,ee),E.subdivisions>0)try{oF.set_destination_refinement_level(V,E.subdivisions),Y=bF.buildLevel(V,!1,ee)}catch{try{oF.set_destination_refinement_level(V,E.subdivisions-1),Y=bF.buildLevel(V,!1,ee)}catch{Y=null}}else Y=null;return{subdivPointer:V,originalGeometry:j,subdividedGeometry:Y}}static primitiveToQuads(E,O,R){E.widthSegments>16&&(E.widthSegments=16),E.heightSegments>16&&(E.heightSegments=16),E.depthSegments>16&&(E.depthSegments=16),E.radialSegments>16&&(E.radialSegments=16),E.type==="DodecahedronGeometry"&&(E.detail=0);let z,V=E.shape!==void 0||E.path!==void 0?O.geometry:Ba(E,R,!1);z=E.type==="TorusGeometry"&&E.arc===Math.PI*2?V.getClosedTorusIndicesForBooleanOrSubdiv():V.getIndex();let j,Y,ee,se;({positions:j,triIndices:se}=Kc(V.getAttribute("position"),z));let he;if(E.type==="CylinderGeometry"&&E.cornerRadius===0&&E.hollow===0&&E.openEnded===!1){let O=E.radialSegments*E.heightSegments*3*2,R=O+E.radialSegments*3;he=[O,R]}return({indices:Y,verticesPerFace:ee}=aE(j,se,V,he)),{positions:j,indices:Y,verticesPerFace:ee}}static allocate(E,O){let R,z,V,j=[],Y=[];E.positionWASM&&E.positionWASM.length>0?(R=E.positionWASM,z=E.indexWASM,V=E.verticesPerFaceWASM):(R=dF,z=uF,V=mF);let ee=R.length,se=z.length,he=V.length,ce=R.length+j.length+Y.length,ue=z.length+V.length,fe=ce*Float32Array.BYTES_PER_ELEMENT+ue*Uint32Array.BYTES_PER_ELEMENT,ve=ce*Float32Array.BYTES_PER_ELEMENT,we=(Uint32Array.BYTES_PER_ELEMENT,oF._malloc(fe)),Se=new Float32Array(oF.HEAPF32.buffer,we,ce),_e=new Uint32Array(oF.HEAPU32.buffer,we+ve,ue);Se.set(R,0),Se.set(j,R.length),Se.set(Y,R.length+j.length),_e.set(z,0),_e.set(V,z.length);let Ae;E?.scaleBaked?.some((E=>E!==1))&&(Ae=(new Es).makeScale(...E.scaleBaked)),O&&(Ae?Ae.premultiply(O):Ae=O);let Ce=Ae?oF.alloc_subdivision_surface2(we,ee,we+ve,se,we+ve+z.length*Uint32Array.BYTES_PER_ELEMENT,he,Ae.elements):oF.alloc_subdivision_surface(we,ee,we+ve,se,we+ve+z.length*Uint32Array.BYTES_PER_ELEMENT,he);return oF._free(we),Ce}static buildLevel(E,O,R,z,V){let j=V?oF.get_mesh_data2(E,O?oF.Level.CONTROL:oF.Level.REFINED,R,V.elements):oF.get_mesh_data(E,O?oF.Level.CONTROL:oF.Level.REFINED,R),Y=8,ee=oF.HEAPU32.subarray(j>>2,(j>>2)+Y),se=ee.subarray(4,8),he=0,ce=oF.HEAPU32[ee[he]>>2],ue=oF.HEAPF32.subarray(ce>>2,(ce>>2)+se[he]);he++;let fe=oF.HEAPU32[ee[he]>>2],ve=oF.HEAPF32.subarray(fe>>2,(fe>>2)+se[he]);he++;let we=oF.HEAPU32[ee[he]>>2],Se=oF.HEAPU32.subarray(we>>2,(we>>2)+se[he]);he++;let _e=oF.HEAPU32[ee[he]>>2],Ae=oF.HEAPU32.subarray(_e>>2,(_e>>2)+se[he]);if(he++,z===void 0){let E=new Na;if(E.setIndex(new Aa(Ae,1)),E.setAttribute("position",new Ma(ue,3)),E.setAttribute("normal",new Ma(ve,3)),O){E.setAttribute("faceMap",new Aa(Se,1));let O=new Float32Array(ve.length/3*4).fill(0);E.setAttribute("color",new Sa(O,4))}return oF.free_mesh_data(j),E.userData.type="SubdivGeometry",E}z.getAttribute("position").copyArray(ue),z.getAttribute("normal").copyArray(ve),z.attributes.position.needsUpdate=!0,z.attributes.normal.needsUpdate=!0,oF.free_mesh_data(j)}static freeSubdivPointer(E){oF.free_bvh(E),oF.free_subdivision_surface(E)}static buildControlCageWireframe(E,O,R){let z=oF.get_wireframe_data_for_base_level(E),V=4,j=oF.HEAPU32.subarray(z>>2,(z>>2)+V),Y=j.subarray(2,4),ee=0,se=oF.HEAPU32[j[ee]>>2],he=oF.HEAPF32.subarray(se>>2,(se>>2)+Y[ee]);ee++;let ce=oF.HEAPU32[j[ee]>>2],ue=oF.HEAPU32.subarray(ce>>2,(ce>>2)+Y[ee]);if(O===void 0){let E=new Na;E.setAttribute("position",new Ma(he,3));let O=new Float32Array(he.length);for(let E=0,z=he.length;E<z;)O[E++]=R.r,O[E++]=R.g,O[E++]=R.b;return E.setAttribute("color",new Sa(O,3)),E.setIndex(new Aa(ue,1)),oF.free_wireframe_data_for_base_level(z),E}O.getAttribute("position").copyArray(he),O.attributes.position.needsUpdate=!0,oF.free_wireframe_data_for_base_level(z)}static updateCollabMesh(E,O,R){let z=O===0;z||oF.set_destination_refinement_level(E,O);let V=R?oF.get_topological_data2(E,z?oF.Level.CONTROL:oF.Level.REFINED,R.elements):oF.get_topological_data(E,z?oF.Level.CONTROL:oF.Level.REFINED),j=6,Y=oF.HEAPU32.subarray(V>>2,(V>>2)+j),ee=Y.subarray(3,6),se=0,he=oF.HEAPU32[Y[se]>>2],ce=new Float32Array(oF.HEAPF32.subarray(he>>2,(he>>2)+ee[se]));se++;let ue=oF.HEAPU32[Y[se]>>2],fe=new Uint32Array(oF.HEAPU32.subarray(ue>>2,(ue>>2)+ee[se]));se++;let ve=oF.HEAPU32[Y[se]>>2],we=new Uint8Array(oF.HEAPU32.subarray(ve>>2,(ve>>2)+ee[se]));return oF.free_topological_data(V),{positions:ce,indices:fe,verticesPerFace:we}}};var wF=["getX","getY","getZ"];function Kc(E,O){let R={},z=O?O.count:E.count,V=0,j=[],Y=[],ee=1e4;for(let se=0;se<z;se++){let z=O?O.getX(se):se,he="";for(let O=0;O<3;O++)he+=~~(E[wF[O]](z)*ee)+",";if(he in R)j.push(R[he]);else{for(let O=0;O<3;O++)Y.push(E[wF[O]](z));R[he]=V,j.push(V),V++}}let se=[];for(let E=0;E<j.length;E+=3)j[E]===j[E+1]||j[E]===j[E+2]||j[E+1]===j[E+2]||se.push(j[E],j[E+1],j[E+2]);return{positions:Y,triIndices:se}}var SF=new Wn,_F=new Wn,MF=new Wn,CF=new Wn;function aE(E,O,R,z){let V=[],j=[];if(R.userData.shape!==void 0&&R.userData.parameters.depth===0&&R.userData.shape.shapeHoles.length===0){let O=R.userData.shape.extractShapePointsToFlatArray([]),z=R.userData.parameters.spikes;if(R.userData.type==="EllipseGeometry"&&z<=24&&z%4===0&&R.userData.parameters.angle>=360){let E=O.length/2/z;O=O.filter(((O,R)=>Math.floor(R/2)%E===0))}let Y=0;for(let E=0;E<O.length;E+=2)Y+=(O[E]-O[(E===0?O.length:E)-2])*(O[E+1]+O[(E===0?O.length:E)-1]);E.length=0;let ee=0;if(Y<0)for(let R=0;R<O.length;R+=2)E.push(O[R],O[R+1],0),V.push(ee++);else for(let R=O.length-2;R>=0;R-=2)E.push(O[R],O[R+1],0),V.push(ee++);return j.push(ee),{indices:V,verticesPerFace:j}}let Y=new Float32Array([R.userData.parameters.depth])[0],ee=0;for(;ee<O.length;){if(R.useNgonForTopBottomFaceDuringBake){let R=0;if((E[O[ee]*3+2]===Y||E[O[ee]*3+2]===0)&&R++,(E[O[ee+1]*3+2]===Y||E[O[ee+1]*3+2]===0)&&R++,(E[O[ee+2]*3+2]===Y||E[O[ee+2]*3+2]===0)&&R++,R===3)break}if(O[ee+1]===O[ee+3]&&O[ee+2]===O[ee+5]||O[ee+0]===O[ee+3]&&O[ee+2]===O[ee+4]){SF.set(E[O[ee]*3],E[O[ee]*3+1],E[O[ee]*3+2]),_F.set(E[O[ee+1]*3],E[O[ee+1]*3+1],E[O[ee+1]*3+2]),MF.set(E[O[ee+4]*3],E[O[ee+4]*3+1],E[O[ee+4]*3+2]),CF.set(E[O[ee+5]*3],E[O[ee+5]*3+1],E[O[ee+5]*3+2]),_F.sub(SF).normalize(),MF.sub(SF).normalize(),CF.sub(SF).normalize();let R=_F.cross(MF).dot(CF);Math.abs(R)>.005||z&&z.some(((E,O)=>O%2!==1&&(ee>=z[O]&&ee<z[O+1])))?(V.push(O[ee],O[ee+1],O[ee+2]),j.push(3),ee+=3):(V.push(O[ee],O[ee+1],O[ee+4],O[ee+5]),j.push(4),ee+=6)}else V.push(O[ee],O[ee+1],O[ee+2]),j.push(3),ee+=3}if(R.useNgonForTopBottomFaceDuringBake){let O=[],z=[],ee=0;for(let R=0,V=0;R<E.length;R+=3,V++)E[R+2]===0&&(O.push(V),ee++),E[R+2]===Y&&z.push(V);if(R.userData.parameters.extrudeBevelSize===0){let E=z[0];z[0]=z[1],z[1]=E}O.reverse(),V.push(...O,...z),j.push(ee,ee)}return{indices:V,verticesPerFace:j}}var PF={};NF(PF,{calcBoolean:()=>XX,calcBooleanTopological:()=>qX,freeMeshSet:()=>ZX,getMeshSet:()=>YX,hasOpenEdges:()=>KX,transformMeshSet:()=>QX});var DF,IF=new Promise((E=>{DF=E}));var OF;function wR(){if(OF)return OF;async function n(){let E="https://unpkg.com/@splinetool/boolean-wasm@1.9.76/build",O=import("../_/B9oyBR00.js"),[R,z]=await Promise.all([O,fetch(`${E}/boolean.wasm`).then((E=>E.arrayBuffer()))]),V=R.default,j=await V({wasmBinary:z});DF(j)}return OF=n(),OF}var RF,LF;IF.then((E=>RF=E));function WX(E,O,R){let z,V;V=E.userData.parameters.type==="TorusGeometry"&&E.userData.parameters.arc===Math.PI*2?E.getClosedTorusIndicesForBooleanOrSubdiv():E.getIndex();let j,{positions:Y,triIndices:ee}=Kc(E.getAttribute("position"),V);if(O&&R){let{indices:O,verticesPerFace:R}=aE(Y,ee,E);j=R.length,z=[];for(let E=0,V=0;E<j;E++){z.push(R[E]);for(let j=0;j<R[E];j++)z.push(O[V++])}}else{let E=ee.length;z=Array(E+E/3),j=0;for(let E=0,O=0;O<z.length;)z[O++]=3,j++,z[O++]=ee[E++],z[O++]=ee[E++],z[O++]=ee[E++]}return{positions:Y,faceIndices:z,nFaces:j}}function AR(E){let O=E.length,R=O*Uint32Array.BYTES_PER_ELEMENT,z=O*Float32Array.BYTES_PER_ELEMENT,V=Number.isInteger(E[0])?R:z,j=RF._malloc(V);return(Number.isInteger(E[0])?new Uint32Array(RF.HEAPU32.buffer,j,O):new Float32Array(RF.HEAPF32.buffer,j,O)).set(E,0),j}function ER(E){switch(E){case 0:return RF.OP.UNION;case 1:return RF.OP.INTERSECTION;case 2:return RF.OP.A_MINUS_B;default:throw new Error("Unknown boolean operation "+E)}}function qX(E,O){LF===void 0&&(LF=RF.init_csg());let R=AR(E),z=RF.csg_calc_topological(LF,R,E.length,ER(O));RF._free(R);let V=6,j=RF.HEAPU32.subarray(z>>2,(z>>2)+V),Y=j.subarray(3,6),ee=0,se=RF.HEAPU32[j[ee]>>2],he=new Float32Array(RF.HEAPF32.subarray(se>>2,(se>>2)+Y[ee]));ee++;let ce=RF.HEAPU32[j[ee]>>2],ue=new Uint32Array(RF.HEAPU32.subarray(ce>>2,(ce>>2)+Y[ee]));ee++;let fe=RF.HEAPU32[j[ee]>>2],ve=new Uint8Array(RF.HEAPU32.subarray(fe>>2,(fe>>2)+Y[ee]));return RF.free_mesh_data(z),{positions:he,indices:ue,verticesPerFace:ve}}function XX(E,O,R,z){LF===void 0&&(LF=RF.init_csg());let V=AR(E),j=RF.csg_calc(LF,V,E.length,z,ER(O));RF._free(V);let Y=5,ee=RF.HEAPU32.subarray(j>>2,(j>>2)+Y),se=ee.subarray(2,5),he=0,ce=RF.HEAPU32[ee[he]>>2],ue=RF.HEAPF32.subarray(ce>>2,(ce>>2)+se[he]);he++;let fe=RF.HEAPU32[ee[he]>>2],ve=RF.HEAPF32.subarray(fe>>2,(fe>>2)+se[he]);he++;let we=se[he];R.setAttribute("position",new Ma(ue,3)),R.setAttribute("normal",new Ma(ve,3));let Se=RF.HEAPF32.subarray(5+(j>>2),5+(j>>2)+6);return R.boundingSphere===null&&(R.boundingSphere=new ps),R.boundingSphere.center.set(Se[0],Se[1],Se[2]),R.boundingSphere.radius=(Se[3]**2+Se[4]**2+Se[5]**2)**.5,R.userData.parameters={width:Se[3]*2,height:Se[4]*2,depth:Se[5]*2},RF.free_mesh_data(j),we}function YX(E,O,R){if(RF===void 0)return-1;let z,V,j;if(O&&E.userData.positions!==void 0){let O=E.userData;j=O.verticesPerFace.length,z=O.positions,V=Array(O.verticesPerFace.reduce(((E,O)=>E+O),0)+j);for(let E=0,R=0,z=0;E<O.verticesPerFace.length;E++){V[z++]=O.verticesPerFace[E];for(let j=0;j<O.verticesPerFace[E];j++)V[z++]=O.indices[R++]}}else({positions:z,faceIndices:V,nFaces:j}=WX(E,O,R));let Y=z.length,ee=V.length,se=z.length,he=V.length,ce=se*Float32Array.BYTES_PER_ELEMENT+he*Uint32Array.BYTES_PER_ELEMENT,ue=se*Float32Array.BYTES_PER_ELEMENT,fe=(Uint32Array.BYTES_PER_ELEMENT,RF._malloc(ce)),ve=new Float32Array(RF.HEAPF32.buffer,fe,se),we=new Uint32Array(RF.HEAPU32.buffer,fe+ue,he);ve.set(z,0),we.set(V,0);let Se=RF.get_csg_mesh(fe,Y,fe+ue,ee,j);return RF._free(fe),Se}function KX(E){return RF.has_open_edges(E)}function QX(E,O){RF.transform_csg_mesh(E,O.elements)}function ZX(E){RF.free_csg_mesh(E)}var zF={ConeGeometry:fL,CubeGeometry:mL,CylinderGeometry:uL,DodecahedronGeometry:SL,EllipseGeometry:nz,HelixGeometry:sz,IcosahedronGeometry:lz,LatheGeometry:cz,NonParametricGeometry:bz,PolygonGeometry:wz,PyramidGeometry:Sz,RectangleGeometry:Az,SphereGeometry:Mz,PlaneGeometry:Ez,BackdropGeometry:Cz,StarGeometry:Pz,TextFrameGeometry:Dz,TorusGeometry:Iz,TorusKnotGeometry:Oz,TriangleGeometry:Rz,PathGeometry:Yz,VectorGeometry:iz},iE=E=>zF[E.type].create(E);function Vd(E){return E!==null&&"booleanOp"in E}var UF=class extends(Ad(eo)){constructor(){super(...arguments);this.booleanMeshSetAddress=-1;this.booleanWasTransformed=!1;this.booleanMatrixInvOld=new Es}updateVisible(E){super.updateVisible(E),this.visible=!Vd(this.parent)&&this.visible,Vd(this.parent)&&this.parent.invalidateDownstreamBooleanData()}freeBooleanPointer(){this.booleanMeshSetAddress!==-1&&(PF.freeMeshSet(this.booleanMeshSetAddress),this.booleanMeshSetAddress=-1)}invalidateDownstreamBooleanData(E=!1){return E?this.booleanWasTransformed=!0:this.freeBooleanPointer(),Vd(this.parent)?this.parent.invalidateDownstreamBooleanData():this}invalidateUpstreamBooleanData(){this.freeBooleanPointer();for(let E of this.children)E instanceof UF&&(E.freeBooleanPointer(),Vd(E)&&E.invalidateUpstreamBooleanData())}updateTransformState(E,O){let R=super.updateTransformState(E,O);return R&&Vd(this.parent)&&this.invalidateDownstreamBooleanData(!0),R}onVariableUpdate(E=!1){super.onVariableUpdate(E),Vd(this.parent)&&this.invalidateDownstreamBooleanData(!0)}};var kF=new Yn;function Am(E,O=0,R=E.count,z,V){let j=1/0,Y=1/0,ee=1/0,se=-1/0,he=-1/0,ce=-1/0;for(let z=O;z<R;z++){let O=E.getX(z),R=E.getY(z),V=E.getZ(z);O<j&&(j=O),R<Y&&(Y=R),V<ee&&(ee=V),O>se&&(se=O),R>he&&(he=R),V>ce&&(ce=V)}kF.min.set(j,Y,ee),kF.max.set(se,he,ce),kF.getCenter(z),kF.getSize(V).multiplyScalar(.5)}var VF=new Na,jF=new xa,GF=class extends UF{constructor(E,O){super(VF,jF),this.super_Entity(E,O)}updateState(E,O){this.updateState_Entity(E,O)}updateEntityBoxSize(E,O){let R=this.geometry.getAttribute("position");R!==void 0?Am(R,this.geometry.drawRange.start,this.geometry.drawRange.count<1/0?this.geometry.drawRange.count:R.count,E,O):super.updateEntityBoxSize(E,O)}};var HF=class{constructor(E){this.hashProperties=void 0;this.isNode=!0;this.shortcuts={};if(HF.uuidContext===null)throw new Error("plz startContext");HF.uuidContext===HF.globalContext?this.uuid="_gid"+HF.uuidContext.nodeContextUuid++:this.uuid="_uid"+HF.uuidContext.nodeContextUuid++,this.type=E,this.name=""}static startContext(E){this.uuidContext===null||this.uuidContext===HF.globalContext?this.uuidContext=E:console.error("Can't start context twice")}static endContext(E){this.uuidContext!==E&&console.error("Can't end context twice"),this.uuidContext=null}analyze(E,O){O=O??{},E.analyzing=!0,this.build(E.addFlow(O.slot,O.cache,O.context),"v4"),E.clearVertexNodeCode(),E.clearFragmentNodeCode(),E.removeFlow(),E.analyzing=!1}analyzeAndFlow(E,O,R){return R=R??{},this.analyze(E,R),this.flow(E,O,R)}flow(E,O,R){R=R??{},E.addFlow(R.slot,R.cache,R.context);let z={result:this.build(E,O),code:E.clearNodeCode(),extra:E.context.extra};return E.removeFlow(),z}build(E,O,R){O=O??this.getType(E,O);let z=E.getNodeData(R??this);return E.analyzing&&this.appendDepsNode(E,z,O),E.nodes.indexOf(this)===-1&&E.nodes.push(this),this.updateFrame!==void 0&&E.updaters.indexOf(this)===-1&&E.updaters.push(this),this.generate(E,O,R)}updateFrame(E){}generateReadonly(E,O,R,z,V,j){return""}generate(E,O,R,z,V){return""}parse(E,O,R,z){}appendDepsNode(E,O,R){O.deps=(O.deps||0)+1;let z=E.getTypeLength(R);(z>(O.outputMax||0)||this.getType(E,R))&&(O.outputMax=z,O.output=R)}setName(E){this.name=E}getName(){return this.name}getType(E,O){return O==="sampler2D"||O==="samplerCube"?O:this.type}},WF=HF;WF.globalContext={nodeContextUuid:0},WF.uuidContext=HF.globalContext;var qF=class{constructor(E){E=E??{},this.name=E.name,this.type=E.type,this.node=E.node,this.size=E.size,this.needsUpdate=E.needsUpdate}get value(){return this.node.value}set value(E){this.node.value=E}};var XF=class{constructor(){this.nodes={};this.keywords={}}add(E){this.nodes[E.name]=E}addKeyword(E,O,R){R=R===void 0||R,this.keywords[E]={callback:O,cache:R}}remove(E){delete this.nodes[E.name]}removeKeyword(E){delete this.keywords[E]}get(E){return this.nodes[E]}getKeyword(E,O){return this.keywords[E].callback(O)}getKeywordData(E){return this.keywords[E]}contains(E){return this.nodes[E]!==void 0}containsKeyword(E){return this.keywords[E]!==void 0}},YF=new XF;var QF=class extends WF{constructor(E,O){super(E);this.scope="";O=O??{},this.shared=O.shared===void 0||O.shared,this.unique=O.unique!==void 0&&O.unique}build(E,O,R,z){if(O=O??this.getType(E),this.getShared(E,O)){let V=this.getUnique(E,O);V&&this.uuid===void 0&&(this.uuid=xn.generateUUID()),R=E.getUUID(R??this.getUUID(),!V);let j=E.getNodeData(R),Y=j.output||this.getType(E);if(E.analyzing)return(j.deps||0)>0||this.getLabel()?(this.appendDepsNode(E,j,O),this.generate(E,O,R)):super.build(E,O,R);if(V)return j.name=j.name||super.build(E,O,R),j.name;if(!this.getLabel()&&(!this.getShared(E,Y)||E.context.ignoreCache||j.deps===1))return super.build(E,O,R);R=this.getUUID(!1);let ee=this.getTemp(E,R);if(ee)return E.format(ee,Y,O);{ee=super.generate(E,O,R,j.output,z);let V=this.generate(E,Y,R);return E.addNodeCode(ee+" = "+V+";"),E.format(ee,Y,O)}}return super.build(E,O,R)}getShared(E,O){return O!=="sampler2D"&&O!=="samplerCube"&&this.shared}getUnique(E,O){return this.unique}setLabel(E){return this.label=E,this}getLabel(){return this.label}getUUID(E){let O=this.uuid;return typeof this.scope=="string"&&(O=this.scope+"-"+O),O}getTemp(E,O){O=O||this.uuid;let R=E.getVars()[O];return R?R.name:void 0}generate(E,O,R,z,V){return this.getShared(E,O)||console.error("TempNode is not shared"),R=R??this.uuid,E.getTempVar(R,z??this.getType(E),V,this.getLabel()).name}};var ZF=class extends QF{constructor(E,O){O=O??{},O.shared=O.shared!==void 0&&O.shared;super(E,O);this.readonly=!1}setReadonly(E){return this.readonly=E,this.hashProperties=this.readonly?["value"]:void 0,this}getReadonly(){return this.readonly}generate(E,O,R,z,V,j){R=E.getUUID(R??this.getUUID()),z=z??this.getType(E);let Y=E.getNodeData(R);return this.getReadonly()&&this.generateReadonly!==void 0?this.generateReadonly(E,O,R,z,V,j):E.isShader("vertex")?(Y.vertex||(Y.vertex=E.createVertexUniform(z,this,V,j,this.getLabel())),E.format(Y.vertex.name,z,O)):(Y.fragment||(Y.fragment=E.createFragmentUniform(z,this,V,j,this.getLabel())),E.format(Y.fragment.name,z,O))}};var KF=class extends ZF{constructor(E=0,O){super("v2");this.nodeType="Vector2";this.value=E instanceof bn?E:new bn(E,O)}get x(){return this.value.x}set x(E){this.value.x=E}get y(){return this.value.y}set y(E){this.value.y=E}generateReadonly(E,O,R,z,V,j){return E.format("vec2("+this.value.x+", "+this.value.y+")",z,O)}};var JF=class extends ZF{constructor(E=0,O,R){super("v3");this.nodeType="Vector3";this.value=E instanceof Wn?E:new Wn(E,O,R)}get x(){return this.value.x}set x(E){this.value.x=E}get y(){return this.value.y}set y(E){this.value.y=E}get z(){return this.value.z}set z(E){this.value.z=E}generateReadonly(E,O,R,z,V,j){return E.format("vec3("+this.value.x+", "+this.value.y+", "+this.value.z+")",z,O)}};var $F=class extends On{constructor(E,O,R,z){super(E,O,R);this.isColorA=!0;this.a=z}setRGBA(E,O,R,z){super.setRGB(E,O,R),this.a=z}copy(E){return super.copy(E),this.a="a"in E?E.a:1,this}clone(){return new this.constructor(this.r,this.g,this.b,this.a)}equals(E){return super.equals(E)&&this.a===E.a}setStyle(E,O="srgb"){let R;if(E==="transparent")return this.setRGBA(0,0,0,0),this;if(R=/^((?:rgb|hsl)a?)\(([^)]*)\)/.exec(E)){let z,V=R[1],j=R[2];switch(V){case"rgb":case"rgba":if(z=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(j))return this.a=V==="rgba"?parseFloat(z[4]):1,super.setStyle(E,O);break;case"hsl":case"hsla":if(z=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)%\s*,\s*(\d*\.?\d+)%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(j))return this.a=V==="hsla"?parseFloat(z[4]):1,super.setStyle(E,O);break}}return super.setStyle(E,O)}get x(){return this.r}get y(){return this.g}get z(){return this.b}get w(){return this.a}set x(E){this.r=E}set y(E){this.g=E}set z(E){this.b=E}set w(E){this.a=E}};var tN=class extends ZF{constructor(E){super("v4");this.nodeType="Vector4";this.value=E instanceof $F?E:new $F(E.r,E.g,E.b,E.a)}generateReadonly(E,O,R,z,V,j){return E.format("vec4("+this.value.r+", "+this.value.g+", "+this.value.b+", "+this.value.a+")",z,O)}};var hN=/^\s*([a-z_0-9]+)\s([a-z_0-9]+)\s*\((.*?)\)/i,pN=/[a-z_0-9]+/gi,mN=class extends QF{constructor(E,O,R,z,V){super(V);this.src="";this.nodeType="Function";this.useKeywords=!0;this.includes=[];this.extensions={};this.keywords={};this.isMethod=V===void 0,this.isInterface=!1,this.parse(E,O,R,z)}getShared(E,O){return!this.isMethod}getType(E){return E.getTypeByFormat(this.type)}getInputByName(E){if(this.inputs){let O=this.inputs.length;for(;O--;)if(this.inputs[O].name===E)return this.inputs[O]}}getIncludeByName(E){if(this.includes){let O=this.includes.length;for(;O--;)if(this.includes[O].name===E)return this.includes[O]}}generate(E,O,R,z,V){let j,Y=0,ee=this.src;if(this.includes)for(let O=0;O<this.includes.length;O++)E.include(this.includes[O],this);for(let O in this.extensions)E.extensions[O]=!0;let se=[];for(;j=pN.exec(this.src);)se.push(j);for(let O=0;O<se.length;O++){let R=se[O],z=R[0],V=!this.isMethod||!this.getInputByName(z),j=z;if(this.keywords[z]||this.useKeywords&&V&&YF.containsKeyword(z)){let O=this.keywords[z];if(!O){let R=YF.getKeywordData(z);R.cache&&(O=E.keywords[z]),O=O||YF.getKeyword(z,E),R.cache&&(E.keywords[z]=O)}j=O.build(E)}z!==j&&ee[R.index+Y-1]!=="."&&(ee=ee.substring(0,R.index+Y)+j+ee.substring(R.index+z.length+Y),Y+=j.length-z.length),this.getIncludeByName(j)===void 0&&YF.contains(j)&&E.include(YF.get(j))}return O==="source"?ee:this.isMethod?(this.isInterface||E.include(this,void 0,ee),this.name):E.format("( "+ee+" )",this.getType(E),O)}parse(E,O,R,z){if(this.src=E||"",this.includes=O??[],this.extensions=R??{},this.keywords=z??{},this.isMethod){let E=hN.exec(this.src);if(this.inputs=[],E&&E.length==4){this.type=E[1],this.name=E[2];let O=E[3].match(pN);if(O){let E=0;for(;E<O.length;){let R,z=O[E++];z==="in"||z==="out"||z==="inout"?R=O[E++]:(R=z,z="");let V=O[E++];this.inputs.push({name:V,type:R,qualifier:z})}}this.isInterface=this.src.indexOf("{")===-1}else this.type="",this.name=""}}};var gN=/^([a-z_0-9]+)\s([a-z_0-9]+)\s?\=?\s?(.*?)(\;|$)/i,MN=class extends QF{constructor(E="",O){super();this.src="";this.useDefine=!1;this.nodeType="Const";this.parse(E||MN.PI,void 0,void 0,void 0,O)}getType(E){return E.getTypeByFormat(this.type)}parse(E,O,R,z,V){this.src=E||"";let j,Y,ee="",se=gN.exec(E);this.useDefine=V??this.src.charAt(0)==="#",se&&se.length>1?(Y=se[1],j=se[2],ee=se[3]):(j=this.src,Y="f"),this.name=j,this.type=Y,this.value=ee}build(E,O){if(O==="source"){if(this.value)return this.useDefine?"#define "+this.name+" "+this.value:"const "+this.type+" "+this.name+" = "+this.value+";";if(this.useDefine)return this.src}return E.include(this),E.format(this.name,this.getType(E),O)}generate(E,O,R,z,V){return E.format(this.name,this.getType(E),O)}},IN=MN;IN.PI="PI",IN.PI2="PI2",IN.RECIPROCAL_PI="RECIPROCAL_PI",IN.RECIPROCAL_PI2="RECIPROCAL_PI2",IN.LOG2="LOG2",IN.EPSILON="EPSILON";var RN=new RegExp("^structs*([a-z_0-9]+)s*{s*((.|\n)*?)}","gim"),LN=new RegExp("s*(w*?)s*(w*?)(=|;)","gim"),zN=class extends QF{constructor(E=""){super();this.inputs=[];this.src="";this.nodeType="Struct";this.parse(E)}getType(E){return E.getTypeByFormat(this.name)}getInputByName(E){let O=this.inputs.length;for(;O--;)if(this.inputs[O].name===E)return this.inputs[O]}generate(E,O,R,z,V){return O==="source"?this.src+";":E.format("( "+this.src+" )",this.getType(E),O)}parse(E=""){this.src=E,this.inputs=[];let O=RN.exec(E);if(O){let E,R=O[2];for(;E=LN.exec(R);)this.inputs.push({type:E[1],name:E[2]});this.name=O[1]}else this.name="";this.type=this.name}};var FN=class extends QF{constructor(E){super("v2",{shared:!1});this.nodeType="UV";this.index=E??0}generate(E,O){E.requires.uv[this.index]=!0;let R=this.index>0?this.index+1:"",z=E.isShader("vertex")?"uv"+R:"vUv"+R;return E.format(z,this.getType(E),O)}};YF.addKeyword("uv",(function(){return new FN}));YF.addKeyword("uv2",(function(){return new FN(1)}));var NN=class extends QF{constructor(E,O){super("v4");this.nodeType="ColorSpace";this.input=E,this.method=O??NN.LINEAR_TO_LINEAR,this.hashProperties=["method"]}static getEncodingComponents(E){switch(E){case Xr:return["Linear"];case Yr:return["sRGB"];default:return[]}}generate(E,O){let R=this.input.build(E,"v4"),z=this.getType(E),V=NN.Nodes[this.method],j=E.include(V);if(j===NN.LINEAR_TO_LINEAR)return E.format(R,z,O);if(V.inputs?.length===2){let V=this.factor.build(E,"f");return E.format(j+"( "+R+", "+V+" )",z,O)}return E.format(j+"( "+R+" )",z,O)}fromEncoding(E){let O=NN.getEncodingComponents(E);this.method="LinearTo"+O[0],this.factor=O[1]}fromDecoding(E){let O=NN.getEncodingComponents(E);this.method=O[0]+"ToLinear",this.factor=O[1]}},UN=NN;UN.Nodes={LinearToLinear:new mN(["vec4 LinearToLinear( in vec4 value ) {","\treturn value;","}"].join("\n")),sRGBToLinear:new mN(["vec4 sRGBToLinear( in vec4 value ) {","\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );","}"].join("\n")),LinearTosRGB:new mN(["vec4 LinearTosRGB( in vec4 value ) {","\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.w );","}"].join("\n"))},UN.LINEAR_TO_LINEAR="LinearToLinear",UN.SRGB_TO_LINEAR="sRGBToLinear",UN.LINEAR_TO_SRGB="LinearTosRGB";var kN=class extends mN{constructor(E="",O,R,z,V){super(E,V,z,R,O);this.nodeType="Expression"}};var jN=class extends ZF{constructor(E=new Fn,O,R,z){super("v4",{shared:!0});this.nodeType="Texture";this.value=E,this.uv=O??new FN,this.bias=R,this.project=z!==void 0&&z}getTexture(E,O){return super.generate(E,O,this.value.uuid,"t")}generate(E,O){if(O==="sampler2D")return this.getTexture(E,O);let R=this.getTexture(E,O),z=this.uv.build(E,this.project?"v4":"v2"),V=this.bias?this.bias.build(E,"f"):void 0;V===void 0&&E.context.bias&&(V=E.context.bias.setTexture(this).build(E,"f"));let j,Y;j=this.project?"texture2DProj":V?"tex2DBias":"tex2D",Y=V?j+"( "+R+", "+z+", "+V+" )":j+"( "+R+", "+z+" )";let ee={include:E.isShader("vertex"),ignoreCache:!0},se=this.getType(E);return E.addContext(ee),this.colorSpace=this.colorSpace??new UN(new kN("",se)),this.colorSpace.fromDecoding(E.getTextureEncodingFromMap(this.value)),this.colorSpace.input.parse(Y),Y=this.colorSpace.build(E,se),E.removeContext(),E.format(Y,se,O)}};var GN=class extends ZF{constructor(E){super("f");this.nodeType="Float";this.value=E??0}generateReadonly(E,O,R,z,V,j){return E.format(this.value+(this.value%1?"":".0"),z,O)}};var HN=class extends QF{constructor(E,O){super();this.inputs=[];this.nodeType="FunctionCall";this.value=E,this.inputs=O??[]}getFunction(){return this.value}getType(E){return this.value.getType(E)}generate(E,O,R,z,V){z=this.getType(E);let j=this.value,Y=j.build(E,O)+"( ",ee=[];if(j.inputs){for(let O=0;O<j.inputs.length;O++){let R=j.inputs[O],z=this.inputs[O]||this.inputs[R.name];ee.push(z.build(E,E.getTypeByFormat(R.type)))}Y+=ee.join(", ")+" )"}return E.format(Y,z,O)}};var WN=class extends QF{constructor(E,O,R=WN.ADD){super();this.nodeType="Operator";this.type=E.type,this.a=E,this.b=O,this.op=R}getType(E){let O=this.a.getType(E),R=this.b.getType(E);return E.isTypeMatrix(O)?"v4":E.getTypeLength(R)>E.getTypeLength(O)?R:O}generate(E,O){let R=this.getType(E);this.type=R;let z=this.a.build(E,R),V=this.b.build(E,R);return E.format("( "+z+" "+this.op+" "+V+" )",R,O)}},qN=WN;qN.ADD="+",qN.SUB="-",qN.MUL="*",qN.DIV="/";var ZN=class extends QF{constructor(E,O=ZN.ABS,R,z){super();this.nodeType="Math";this.a=E,typeof O!="string"?this.b=O:z=O,typeof R!="string"?this.c=R:z=R,this.method=z,this.hashProperties=["method"]}getNumInputs(E){switch(this.method){case ZN.MIX:case ZN.CLAMP:case ZN.REFRACT:case ZN.SMOOTHSTEP:case ZN.FACEFORWARD:return 3;case ZN.MIN:case ZN.MAX:case ZN.MOD:case ZN.STEP:case ZN.REFLECT:case ZN.DISTANCE:case ZN.DOT:case ZN.CROSS:case ZN.POW:return 2;default:return 1}}getInputType(E){let O=E.getTypeLength(this.a.getType(E)),R=this.b?E.getTypeLength(this.b.getType(E)):0,z=this.c?E.getTypeLength(this.c.getType(E)):0;return O>R&&O>z?this.a.getType(E):R>z?this.b.getType(E):this.c.getType(E)}getType(E){switch(this.method){case ZN.LENGTH:case ZN.DISTANCE:case ZN.DOT:return"f";case ZN.CROSS:return"v3"}return this.getInputType(E)}generate(E,O){let R,z,V,j=this.a?E.getTypeLength(this.a.getType(E)):0,Y=this.b?E.getTypeLength(this.b.getType(E)):0,ee=this.c?E.getTypeLength(this.c.getType(E)):0,se=this.getInputType(E),he=this.getType(E);switch(this.type=he,this.method){case ZN.NEGATE:return E.format("( -"+this.a.build(E,se)+" )",se,O);case ZN.INVERT:return E.format("( 1.0 - "+this.a.build(E,se)+" )",se,O);case ZN.CROSS:R=this.a.build(E,"v3"),z=this.b.build(E,"v3");break;case ZN.STEP:R=this.a.build(E,j===1?"f":se),z=this.b.build(E,se);break;case ZN.MIN:case ZN.MAX:case ZN.MOD:R=this.a.build(E,se),z=this.b.build(E,Y===1?"f":se);break;case ZN.REFRACT:R=this.a.build(E,se),z=this.b.build(E,se),V=this.c.build(E,"f");break;case ZN.MIX:R=this.a.build(E,se),z=this.b.build(E,se),V=this.c.build(E,ee===1?"f":se);break;default:R=this.a.build(E,se),this.b&&(z=this.b.build(E,se)),this.c&&(V=this.c.build(E,se));break}let ce=[];ce.push(R),z&&ce.push(z),V&&ce.push(V);let ue=this.getNumInputs(E);if(ce.length!==ue)throw Error(`Arguments not match used in "${this.method}". Require ${ue}, currently ${ce.length}.`);return E.format(this.method+"( "+ce.join(", ")+" )",he,O)}},JN=ZN;JN.RAD="radians",JN.DEG="degrees",JN.EXP="exp",JN.EXP2="exp2",JN.LOG="log",JN.LOG2="log2",JN.SQRT="sqrt",JN.INV_SQRT="inversesqrt",JN.FLOOR="floor",JN.CEIL="ceil",JN.NORMALIZE="normalize",JN.FRACT="fract",JN.SATURATE="saturate",JN.SIN="sin",JN.COS="cos",JN.TAN="tan",JN.ASIN="asin",JN.ACOS="acos",JN.ARCTAN="atan",JN.ABS="abs",JN.SIGN="sign",JN.LENGTH="length",JN.NEGATE="negate",JN.INVERT="invert",JN.MIN="min",JN.MAX="max",JN.MOD="mod",JN.STEP="step",JN.REFLECT="reflect",JN.DISTANCE="distance",JN.DOT="dot",JN.CROSS="cross",JN.POW="pow",JN.MIX="mix",JN.CLAMP="clamp",JN.REFRACT="refract",JN.SMOOTHSTEP="smoothstep",JN.FACEFORWARD="faceforward";var $N=class extends QF{constructor(E,O,R){super("v4");this.nodeType="TextureCubeUV";this.value=E,this.uv=O,this.bias=R}bilinearCubeUV(E,O,R,z){let V=new HN($N.Nodes.bilinearCubeUV,[O,R,z]);this.colorSpaceTL=this.colorSpaceTL??new UN(new kN("","v4")),this.colorSpaceTL.fromDecoding(E.getTextureEncodingFromMap(this.value.value)),this.colorSpaceTL.input.parse(V.build(E)+".tl"),this.colorSpaceTR=this.colorSpaceTR??new UN(new kN("","v4")),this.colorSpaceTR.fromDecoding(E.getTextureEncodingFromMap(this.value.value)),this.colorSpaceTR.input.parse(V.build(E)+".tr"),this.colorSpaceBL=this.colorSpaceBL??new UN(new kN("","v4")),this.colorSpaceBL.fromDecoding(E.getTextureEncodingFromMap(this.value.value)),this.colorSpaceBL.input.parse(V.build(E)+".bl"),this.colorSpaceBR=this.colorSpaceBR??new UN(new kN("","v4")),this.colorSpaceBR.fromDecoding(E.getTextureEncodingFromMap(this.value.value)),this.colorSpaceBR.input.parse(V.build(E)+".br");let j={include:E.isShader("vertex"),ignoreCache:!0};E.addContext(j),this.colorSpaceTLExp=new kN(this.colorSpaceTL.build(E,"v4"),"v4"),this.colorSpaceTRExp=new kN(this.colorSpaceTR.build(E,"v4"),"v4"),this.colorSpaceBLExp=new kN(this.colorSpaceBL.build(E,"v4"),"v4"),this.colorSpaceBRExp=new kN(this.colorSpaceBR.build(E,"v4"),"v4"),E.removeContext();let Y=new kN("mix( mix( cubeUV_TL, cubeUV_TR, cubeUV.f.x ), mix( cubeUV_BL, cubeUV_BR, cubeUV.f.x ), cubeUV.f.y )","v4");return Y.keywords.cubeUV_TL=this.colorSpaceTLExp,Y.keywords.cubeUV_TR=this.colorSpaceTRExp,Y.keywords.cubeUV_BL=this.colorSpaceBLExp,Y.keywords.cubeUV_BR=this.colorSpaceBRExp,Y.keywords.cubeUV=V,Y}generate(E,O){if(E.isShader("fragment")){let R=this.uv,z=this.bias||E.context.roughness,V=new HN($N.Nodes.roughnessToMip,[z]),j=new JN(V,$N.Nodes.m0,$N.Nodes.cubeUV_maxMipLevel,JN.CLAMP),Y=new JN(j,JN.FLOOR),ee=new JN(j,JN.FRACT),se=this.bilinearCubeUV(E,this.value,R,Y),he=this.bilinearCubeUV(E,this.value,R,new qN(Y,new GN(1).setReadonly(!0),qN.ADD)),ce=new JN(se,he,ee,JN.MIX);return E.format(ce.build(E),"v4",O)}return console.warn("TextureCubeUVNode is not compatible with "+E.shader+" shader."),E.format("vec4( 0.0 )",this.getType(E),O)}},eU=$N;eU.Nodes=function(){let E=new zN("struct TextureCubeUVData {\n\t\t\tvec4 tl;\n\t\t\tvec4 tr;\n\t\t\tvec4 br;\n\t\t\tvec4 bl;\n\t\t\tvec2 f;\n\t\t}"),O=new IN("float cubeUV_maxMipLevel 8.0",!0),R=new IN("float cubeUV_minMipLevel 4.0",!0),z=new IN("float cubeUV_maxTileSize 256.0",!0),V=new IN("float cubeUV_minTileSize 16.0",!0),j=new mN("float getFace(vec3 direction) {\n\t\t\t\tvec3 absDirection = abs(direction);\n\t\t\t\tfloat face = -1.0;\n\t\t\t\tif (absDirection.x > absDirection.z) {\n\t\t\t\t\tif (absDirection.x > absDirection.y)\n\t\t\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\t\t\telse\n\t\t\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t\t\t} else {\n\t\t\t\t\tif (absDirection.z > absDirection.y)\n\t\t\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\t\t\telse\n\t\t\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t\t\t}\n\t\t\t\treturn face;\n\t\t}");j.useKeywords=!1;let Y=new mN("vec2 getUV(vec3 direction, float face) {\n\t\t\t\tvec2 uv;\n\t\t\t\tif (face == 0.0) {\n\t\t\t\t\tuv = vec2(direction.z, direction.y) / abs(direction.x); // pos x\n\t\t\t\t} else if (face == 1.0) {\n\t\t\t\t\tuv = vec2(-direction.x, -direction.z) / abs(direction.y); // pos y\n\t\t\t\t} else if (face == 2.0) {\n\t\t\t\t\tuv = vec2(-direction.x, direction.y) / abs(direction.z); // pos z\n\t\t\t\t} else if (face == 3.0) {\n\t\t\t\t\tuv = vec2(-direction.z, direction.y) / abs(direction.x); // neg x\n\t\t\t\t} else if (face == 4.0) {\n\t\t\t\t\tuv = vec2(-direction.x, direction.z) / abs(direction.y); // neg y\n\t\t\t\t} else {\n\t\t\t\t\tuv = vec2(direction.x, direction.y) / abs(direction.z); // neg z\n\t\t\t\t}\n\t\t\t\treturn 0.5 * (uv + 1.0);\n\t\t}");Y.useKeywords=!1;let ee=new mN("TextureCubeUVData bilinearCubeUV(sampler2D envMap, vec3 direction, float mipInt) {\n\t\t\tfloat face = getFace(direction);\n\t\t\tfloat filterInt = max(cubeUV_minMipLevel - mipInt, 0.0);\n\t\t\tmipInt = max(mipInt, cubeUV_minMipLevel);\n\t\t\tfloat faceSize = exp2(mipInt);\n\t\t\tfloat texelSize = 1.0 / (3.0 * cubeUV_maxTileSize);\n\t\t\tvec2 uv = getUV(direction, face) * (faceSize - 1.0);\n\t\t\tvec2 f = fract(uv);\n\t\t\tuv += 0.5 - f;\n\t\t\tif (face > 2.0) {\n\t\t\t\tuv.y += faceSize;\n\t\t\t\tface -= 3.0;\n\t\t\t}\n\t\t\tuv.x += face * faceSize;\n\t\t\tif(mipInt < cubeUV_maxMipLevel){\n\t\t\t\tuv.y += 2.0 * cubeUV_maxTileSize;\n\t\t\t}\n\t\t\tuv.y += filterInt * 2.0 * cubeUV_minTileSize;\n\t\t\tuv.x += 3.0 * max(0.0, cubeUV_maxTileSize - 2.0 * faceSize);\n\t\t\tuv *= texelSize;\n\t\t\tvec4 tl = texture2D(envMap, uv);\n\t\t\tuv.x += texelSize;\n\t\t\tvec4 tr = texture2D(envMap, uv);\n\t\t\tuv.y += texelSize;\n\t\t\tvec4 br = texture2D(envMap, uv);\n\t\t\tuv.x -= texelSize;\n\t\t\tvec4 bl = texture2D(envMap, uv);\n\t\t\treturn TextureCubeUVData( tl, tr, br, bl, f );\n\t\t}",[E,j,Y,O,R,z,V]);ee.useKeywords=!1;let se=new IN("float r0 1.0",!0),he=new IN("float v0 0.339",!0),ce=new IN("float m0 -2.0",!0),ue=new IN("float r1 0.8",!0),fe=new IN("float v1 0.276",!0),ve=new IN("float m1 -1.0",!0),we=new IN("float r4 0.4",!0),Se=new IN("float v4 0.046",!0),_e=new IN("float m4 2.0",!0),Ae=new IN("float r5 0.305",!0),Ce=new IN("float v5 0.016",!0),Te=new IN("float m5 3.0",!0),Ie=new IN("float r6 0.21",!0),Fe=new IN("float v6 0.0038",!0),Ue=new IN("float m6 4.0",!0),Ge=[se,he,ce,ue,fe,ve,we,Se,_e,Ae,Ce,Te,Ie,Fe,Ue],qe=new mN("float roughnessToMip(float roughness) {\n\t\t\tfloat mip = 0.0;\n\t\t\tif (roughness >= r1) {\n\t\t\t\tmip = (r0 - roughness) * (m1 - m0) / (r0 - r1) + m0;\n\t\t\t} else if (roughness >= r4) {\n\t\t\t\tmip = (r1 - roughness) * (m4 - m1) / (r1 - r4) + m1;\n\t\t\t} else if (roughness >= r5) {\n\t\t\t\tmip = (r4 - roughness) * (m5 - m4) / (r4 - r5) + m4;\n\t\t\t} else if (roughness >= r6) {\n\t\t\t\tmip = (r5 - roughness) * (m6 - m5) / (r5 - r6) + m5;\n\t\t\t} else {\n\t\t\t\tmip = -2.0 * log2(1.16 * roughness);// 1.16 = 1.79^0.25\n\t\t\t}\n\t\t\treturn mip;\n\t\t}",Ge);return{bilinearCubeUV:ee,roughnessToMip:qe,m0:ce,cubeUV_maxMipLevel:O}}();var iU=class extends QF{constructor(E){super("v3");this.nodeType="Normal";this.scope=E??iU.VIEW}getShared(){return this.scope===iU.WORLD}build(E,O,R,z){let V=E.context[this.scope+"Normal"];return V?V.build(E,O,R,z):super.build(E,O,R)}generate(E,O,R,z,V){let j;switch(this.scope){case iU.VIEW:j=E.isShader("vertex")?"transformedNormal":"geometryNormal";break;case iU.LOCAL:E.isShader("vertex")?j="objectNormal":(E.requires.normal=!0,j="vObjectNormal");break;case iU.WORLD:E.isShader("vertex")?j="inverseTransformDirection( transformedNormal, viewMatrix ).xyz":(E.requires.worldNormal=!0,j="vWNormal");break}return E.format(j,this.getType(E),O)}},nU=iU;nU.LOCAL="local",nU.WORLD="world",nU.VIEW="view",nU.NORMAL="normal";YF.addKeyword("viewNormal",(function(){return new nU(nU.VIEW)}));YF.addKeyword("localNormal",(function(){return new nU(nU.NORMAL)}));YF.addKeyword("worldNormal",(function(){return new nU(nU.WORLD)}));var sU=class extends QF{constructor(E){super("v3");this.nodeType="Position";this.scope=E??sU.LOCAL}getType(){switch(this.scope){case sU.PROJECTION:return"v4"}return this.type}getShader(){switch(this.scope){case sU.LOCAL:case sU.WORLD:return!1}return!0}generate(E,O,R,z,V){let j;switch(this.scope){case sU.LOCAL:E.isShader("vertex")?j="transformed":(E.requires.position=!0,j="vPosition");break;case sU.WORLD:if(E.isShader("vertex"))return"( modelMatrix * vec4( transformed, 1.0 ) ).xyz";E.requires.worldPosition=!0,j="vWPosition";break;case sU.VIEW:j=E.isShader("vertex")?"-mvPosition.xyz":"vViewPosition";break;case sU.PROJECTION:j=E.isShader("vertex")?"( projectionMatrix * modelViewMatrix * vec4( position, 1.0 ) )":"vec4( 0.0 )";break}return E.format(j,this.getType(),O)}},oU=sU;oU.LOCAL="local",oU.WORLD="world",oU.VIEW="view",oU.PROJECTION="projection";YF.addKeyword("position",(function(){return new oU}));YF.addKeyword("worldPosition",(function(){return new oU(oU.WORLD)}));YF.addKeyword("viewPosition",(function(){return new oU(oU.VIEW)}));var lU=class extends QF{constructor(E){super("v3");this.nodeType="Reflect";this.scope=E??lU.CUBE}getUnique(E){return!E.context.viewNormal}getType(){switch(this.scope){case lU.SPHERE:return"v2"}return this.type}generate(E,O){let R=this.getUnique(E);if(E.isShader("fragment")){let z;switch(this.scope){case lU.VECTOR:{let O=new nU(nU.VIEW),V=E.context.roughness,j=O.build(E,"v3"),Y=new oU(oU.VIEW).build(E,"v3"),ee=V?V.build(E,"f"):void 0,se=`reflect( -normalize( ${Y} ), ${j} )`;ee&&(se=`normalize( mix( ${se}, ${j}, ${ee} * ${ee} ) )`);let he=`inverseTransformDirection( ${se}, viewMatrix )`;R?(E.addNodeCode(`vec3 reflectVec = ${he};`),z="reflectVec"):z=he;break}case lU.CUBE:{let O=new lU(lU.VECTOR).build(E,"v3"),V="vec3( -"+O+".x, "+O+".yz )";R?(E.addNodeCode(`vec3 reflectCubeVec = ${V};`),z="reflectCubeVec"):z=V;break}case lU.SPHERE:{let O="normalize( ( viewMatrix * vec4( "+new lU(lU.VECTOR).build(E,"v3")+", 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) ).xy * 0.5 + 0.5";R?(E.addNodeCode(`vec2 reflectSphereVec = ${O};`),z="reflectSphereVec"):z=O;break}}return E.format(z,this.getType(),O)}return console.warn("ReflectNode is not compatible with "+E.shader+" shader."),E.format("vec3( 0.0 )",this.type,O)}},hU=lU;hU.CUBE="cube",hU.SPHERE="sphere",hU.VECTOR="vector";var cU=class extends QF{constructor(E=new jN,O,R){super("v4");this.nodeType="TextureCube";this.value=E,this.radianceNode=new eU(this.value,O??new hU(hU.VECTOR),R),this.irradianceNode=new eU(this.value,new nU(nU.WORLD),new GN(1).setReadonly(!0))}generate(E,O){return E.isShader("fragment")?(E.require("irradiance"),E.context.bias&&E.context.bias.setTexture(this.value),(E.slot==="irradiance"?this.irradianceNode:this.radianceNode).build(E,O)):(console.warn("TextureCubeNode is not compatible with "+E.shader+" shader."),E.format("vec4( 0.0 )",this.getType(E),O))}};var dU=class extends ZF{constructor(E=new vo,O,R){super("v4",{shared:!0});this.nodeType="CubeTexture";this.value=E,this.uv=O??new hU,this.bias=R}getTexture(E,O){return super.generate(E,O,this.value.uuid,"tc")}generate(E,O){if(O==="samplerCube")return this.getTexture(E,O);let R=this.getTexture(E,O),z=this.uv?.build(E,"v3"),V=this.bias?this.bias.build(E,"f"):void 0;V===void 0&&E.context.bias&&(V=E.context.bias.setTexture(this).build(E,"f"));let j;j=V?"texCubeBias( "+R+", "+z+", "+V+" )":"texCube( "+R+", "+z+" )";let Y={include:E.isShader("vertex"),ignoreCache:!0},ee=this.getType(E);return E.addContext(Y),this.colorSpace=this.colorSpace??new UN(new kN("",ee)),this.colorSpace.fromDecoding(E.getTextureEncodingFromMap(this.value)),this.colorSpace.input.parse(j),j=this.colorSpace.build(E,ee),E.removeContext(),E.format(j,ee,O)}};var uU="\nuniform int frameIndex;\nuniform vec2 resolution;\nuniform mat4 previousModelViewMatrix;\nuniform mat4 previousProjectionMatrix;\n\nvarying vec4 vCurrentPosition;\nvarying vec4 vPreviousPosition;\n",pU="\nlayout(location = 1) out vec4 gVelocity;\n\nuniform int frameIndex;\nuniform vec2 resolution;\n\nvarying vec4 vCurrentPosition;\nvarying vec4 vPreviousPosition;\n\nconst vec2 haltonSequence[16] = vec2[16](\nvec2( 0.000000,-0.333334),\nvec2(-0.500000, 0.333334),\nvec2( 0.500000,-0.777778),\nvec2(-0.750000,-0.111112),\nvec2( 0.250000, 0.555556),\nvec2(-0.250000,-0.555556),\nvec2( 0.750000, 0.111112),\nvec2(-0.875000, 0.777778),\nvec2(0.125000, -0.925926),\nvec2(-0.375000, -0.259260),\nvec2(0.625000, 0.407408),\nvec2(-0.625000, -0.703704),\nvec2(0.375000, -0.037038),\nvec2(-0.125000, 0.629630),\nvec2(0.875000, -0.481482),\nvec2(-0.937500, 0.185186));\n\nvec2 vogelDiskSample(int sampleIndex, int sampleCount, float angle) {\n  const float goldenAngle = 2.399963f; // radians\n  float r = sqrt(float(sampleIndex) + 0.5f) / sqrt(float(sampleCount));\n  float theta = float(sampleIndex) * goldenAngle + angle;\n  float sine = sin(theta);\n  float cosine = cos(theta);\n  return vec2(cosine, sine) * r;\n}\n\n// Derived from the interleaved gradient function from Jimenez 2014 http:goo.gl/eomGso\nfloat getNoiseInterleavedGradient(vec2 screenPos) {\n    vec3 magic = vec3(0.06711056f, 0.00583715f, 52.9829189f);\n    return fract(magic.z * fract(dot(screenPos, magic.xy)));\n}\n\n",fU="\n// TODO: This could be generated CPU side and passed to the shader every frame\nconst vec2 haltonSequence[16] = vec2[16](\nvec2( 0.000000,-0.333334),\nvec2(-0.500000, 0.333334),\nvec2( 0.500000,-0.777778),\nvec2(-0.750000,-0.111112),\nvec2( 0.250000, 0.555556),\nvec2(-0.250000,-0.555556),\nvec2( 0.750000, 0.111112),\nvec2(-0.875000, 0.777778),\nvec2(0.125000, -0.925926),\nvec2(-0.375000, -0.259260),\nvec2(0.625000, 0.407408),\nvec2(-0.625000, -0.703704),\nvec2(0.375000, -0.037038),\nvec2(-0.125000, 0.629630),\nvec2(0.875000, -0.481482),\nvec2(-0.937500, 0.185186));\n\n// TODO: Pass correct view size\nvec2 offset = haltonSequence[frameIndex];\noffset.x /= resolution.x;\noffset.y /= resolution.y;\n\nvec4 currentPosition = gl_Position;\nvec4 currentPositionJittered = currentPosition + (vec4(offset.x, offset.y, 0.0, 0.0) * currentPosition.w);\n\n// We want to calculate the velocity with unjittered positions\n// so that things that are not moving get a velocity = 0\nvCurrentPosition = currentPosition;\nvPreviousPosition = previousProjectionMatrix * previousModelViewMatrix * vec4(transformed, 1.0);\n#ifdef OUTLINE_COMPENSATION\nvPreviousPosition.xy += OUTLINE_COMPENSATION;\n#endif\ngl_Position = currentPositionJittered;\n\n",mU="\nvec2 oldPos = vPreviousPosition.xy;\n    oldPos /= vPreviousPosition.w;\n    oldPos.xy = (oldPos.xy+1.)/2.0;\n\nvec2 newPos = vCurrentPosition.xy;\n    newPos /= vCurrentPosition.w;\n    newPos.xy = (newPos.xy+1.)/2.0;\n\nvec2 velocity = (newPos - oldPos);\n\n// Discard fully transparent pixels \nif (gl_FragColor.a <= 0.0) discard;\n\ngVelocity = vec4(velocity, 0.0, 1.0);\n",gU="\nlayout(location = 1) out vec4 gVelocity;\n",vU="\n    // Discard fully transparent pixels \n    if (gl_FragColor.a <= 0.0) discard;\n\n    gVelocity = vec4(0.0, 0.0, 0.0, 1.0);\n";var yU=["x","y","z","w"],xU=["float","vec2","vec3","vec4"],bU={float:"f",vec2:"v2",vec3:"v3",vec4:"v4",mat4:"v4",int:"i",bool:"b","float[]":"f[]","vec4[]":"v4[]"},wU={t:"sampler2D",tc:"samplerCube",b:"bool",i:"int",f:"float",c:"vec3",v2:"vec2",v3:"vec3",v4:"vec4",m3:"mat3",m4:"mat4","f[]":"float[]","v4[]":"vec4[]"},SU=class{constructor(){this.includes={consts:{},functions:{},structs:{}};this.cache="";this.slot="";this.shader="";this.context={};this.needsJitter=!0;this.getIncludesCode=function(){function t(E,O){return E.deps.length-O.deps.length}return function(E,O){let R=this.getIncludes(E,O);if(!R)return"";let z="";R=R.sort(t);for(let E=0;E<R.length;E++)R[E].src&&(z+=R[E].src+"\n");return z}}();this.slots=[],this.caches=[],this.contexts=[],this.keywords={},this.nodeData={},this.fragmentVariables={},this.fragmentParsVariables={},this.vertexParsVariables={},this.requires={uv:[],color:[],transparent:!1,irradiance:!1,position:!1,worldPosition:!1,normal:!1,worldNormal:!1,vWorldViewDir:!1,modelMatrix:!1,viewMatrix:!1,projectionMatrix:!1},this.includes={consts:[],functions:[],structs:[]},this.attributes={},this.prefixCode=["#ifdef TEXTURE_LOD_EXT","\t#define texCube(a, b) textureCube(a, b)","\t#define texCubeBias(a, b, c) textureCubeLodEXT(a, b, c)","\t#define tex2D(a, b) texture2D(a, b)","\t#define tex2DBias(a, b, c) texture2DLodEXT(a, b, c)","#else","\t#define texCube(a, b) textureCube(a, b)","\t#define texCubeBias(a, b, c) textureCube(a, b, c)","\t#define tex2D(a, b) texture2D(a, b)","\t#define tex2DBias(a, b, c) texture2D(a, b, c)","#endif","\n\t\t\t// NOTE: Include Spline's blending modes. This could be part of BlendNode\n\t\t\t#define SPE_BLENDING_NORMAL 0\n\t\t\t#define SPE_BLENDING_MULTIPLY 1\n\t\t\t#define SPE_BLENDING_SCREEN 2\n\t\t\t#define SPE_BLENDING_OVERLAY 3\n\n\t\t\tvec3 spe_normalBlend( vec3 a, vec3 b, float alpha ) {\n\t\t\t\treturn mix( a, b, alpha );\n\t\t\t}\n\n\t\t\tvec3 spe_multiplyBlend( vec3 a, vec3 b, float alpha ) {\n\t\t\t\treturn mix( a, a * b, alpha );\n\t\t\t}\n\n\t\t\tvec3 spe_screenBlend( vec3 a, vec3 b, float alpha ) {\n\t\t\t\tvec3 tmp = 1.0 - ( 1.0 - a ) * ( 1.0 - b );\n\t\t\t\treturn mix( a, tmp, alpha );\n\t\t\t}\n\n\t\t\tvec3 spe_overlayBlend( vec3 a, vec3 b, float alpha ) {\n\t\t\t\tvec3 tmp = mix( 1. - 2. * (1. - a) * (1. - b), 2. * a * b, step( a, vec3(.5) ) );\n\t\t\t\treturn clamp( mix( a, tmp, alpha ), 0.0, 1.0 );\n\t\t\t}\n\n\t\t\tvec3 spe_blend( vec3 a, vec3 b, float alpha, int mode ) {\n\t\t\t\tif ( mode == SPE_BLENDING_NORMAL ) return spe_normalBlend( a, b, alpha );\n\t\t\t\telse if ( mode == SPE_BLENDING_MULTIPLY ) return spe_multiplyBlend( a, b, alpha );\n\t\t\t\telse if ( mode == SPE_BLENDING_SCREEN ) return spe_screenBlend( a, b, alpha );\n\t\t\t\telse if ( mode == SPE_BLENDING_OVERLAY ) return spe_overlayBlend( a, b, alpha );\n\t\t\t\treturn vec3( 1.0 );\n\t\t\t}\n\t\t\t","#include <packing>","#include <common>"].join("\n"),this.parsCode={vertex:["float neighbor_offset = 0.0001;",""].join("\n"),fragment:["float accumAlpha = 0.0;","void accumulateAlpha(float alpha) {\n\t\t\t\t\taccumAlpha += (1.0 - accumAlpha) * alpha;\n\t\t\t\t}",""].join("\n")},this.code={vertex:"",fragment:""},this.nodeCode={vertex:"",fragment:""},this.resultCode={vertex:"",fragment:""},this.finalCode={vertex:"",fragment:""},this.inputs={uniforms:{list:[],vertex:[],fragment:[]},arrayUniforms:{list:[],vertex:[],fragment:[]},vars:{varying:[],vertex:[],fragment:[]}},this.defines={},this.uniforms={},this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.updaters=[],this.nodes=[],this.analyzing=!1}build(E,O){this.addVertexParsCode(uU),this.addFragmentParsCode(pU),this.buildShader("vertex",E),this.buildShader("fragment",O);for(let E=0;E<this.requires.uv.length;E++)if(this.requires.uv[E]){let O=E>0?E+1:"";this.addVaryCode("varying vec2 vUv"+O+";"),E>0&&this.addVertexParsCode("attribute vec2 uv"+O+";"),this.addVertexFinalCode("vUv"+O+" = uv"+O+";")}return this.requires.color[0]&&(this.addVaryCode("varying vec4 vColor;"),this.addVertexParsCode("attribute vec4 color;"),this.addVertexFinalCode("vColor = color;")),this.requires.color[1]&&(this.addVaryCode("varying vec4 vColor2;"),this.addVertexParsCode("attribute vec4 color2;"),this.addVertexFinalCode("vColor2 = color2;")),this.requires.position&&(this.addVaryCode("varying vec3 vPosition;"),this.addVertexFinalCode("vPosition = transformed;")),this.requires.worldPosition,this.requires.normal&&(this.addVaryCode("varying vec3 vObjectNormal;"),this.addVertexFinalCode("\n\t\t\t\t#ifndef SHAPEBLEND \n\t\t\t\t\tvObjectNormal = normal;\n\t\t\t\t#else\n\t\t\t\t\tvObjectNormal = objectNormal;\n\t\t\t\t#endif\n\t\t\t")),this.requires.modelMatrix&&this.addFragmentParsCode("uniform mat4 modelMatrix;"),this.requires.viewMatrix&&this.addFragmentParsCode("uniform mat4 viewMatrix;"),this.requires.projectionMatrix&&this.addFragmentParsCode("uniform mat4 projectionMatrix;"),this.requires.worldNormal&&(this.addVaryCode("varying vec3 vWNormal;"),this.addVertexFinalCode("vWNormal = inverseTransformDirection( transformedNormal, viewMatrix ).xyz;")),this.requires.vWorldViewDir&&(this.addVaryCode("varying vec3 vWorldViewDir;"),this.addVertexFinalCode("vWorldViewDir = isPerspectiveMatrix( projectionMatrix ) ?  ( (modelMatrix * vec4(position, 1.0)).xyz - cameraPosition ) : vec3( -viewMatrix[0][2], -viewMatrix[1][2], -viewMatrix[2][2] );")),this.needsJitter&&(this.addVertexFinalCode(fU),this.addFragmentFinalCode(mU)),this}buildShader(E,O){this.resultCode[E]=O.build(this.setShader(E),"v4")}setMaterial(E,O){return this.defines={},this}addFlow(E,O,R){return this.addSlot(E).addCache(O).addContext(R)}removeFlow(){return this.removeSlot().removeCache().removeContext()}addCache(E){return this.cache=E??"",this.caches.push(this.cache),this}removeCache(){return this.caches.pop(),this.cache=this.caches[this.caches.length-1]||"",this}addContext(E){return this.context=Object.assign({},this.context,E),this.context.extra=this.context.extra||{},this.contexts.push(this.context),this}removeContext(){return this.contexts.pop(),this.context=this.contexts[this.contexts.length-1]||{},this}addSlot(E){return this.slot=E||"",this.slots.push(this.slot),this}removeSlot(){return this.slots.pop(),this.slot=this.slots[this.slots.length-1]||"",this}addFragmentVariable(E,O){this.fragmentVariables[E]===void 0&&(this.addFragmentCode(`${O} ${E};`),this.fragmentVariables[E]="")}addFragmentParsVariable(E,O){this.fragmentParsVariables[E]===void 0&&(this.addFragmentParsCode(`${O} ${E};`),this.fragmentParsVariables[E]="")}addVertexParsVariable(E,O){this.vertexParsVariables[E]===void 0&&(this.addVertexParsCode(`${O} ${E};`),this.vertexParsVariables[E]="")}addVertexCode(E){this.addCode(E,"vertex")}addFragmentCode(E){this.addCode(E,"fragment")}addCode(E,O){this.code[O??this.shader]+=E+"\n"}addVertexNodeCode(E){this.addNodeCode(E,"vertex")}addFragmentNodeCode(E){this.addNodeCode(E,"fragment")}addNodeCode(E,O){this.nodeCode[O??this.shader]+=E+"\n"}clearNodeCode(E){E=E??this.shader;let O=this.nodeCode[E];return this.nodeCode[E]="",O}clearVertexNodeCode(){return this.clearNodeCode("vertex")}clearFragmentNodeCode(){return this.clearNodeCode("fragment")}addVertexFinalCode(E){this.addFinalCode(E,"vertex")}addFragmentFinalCode(E){this.addFinalCode(E,"fragment")}addFinalCode(E,O){this.finalCode[O??this.shader]+=E+"\n"}addVertexParsCode(E){this.addParsCode(E,"vertex")}addFragmentParsCode(E){this.addParsCode(E,"fragment")}addParsCode(E,O){this.parsCode[O??this.shader]+=E+"\n"}addVaryCode(E){this.addVertexParsCode(E),this.addFragmentParsCode(E)}isCache(E){return this.caches.indexOf(E)!==-1}isSlot(E){return this.slots.indexOf(E)!==-1}define(E,O){this.defines[E]=O===void 0?1:O}require(E){this.requires[E]=!0}isDefined(E){return this.defines[E]!==void 0}getVar(E,O,R,z="varying",V="V",j=""){let Y=this.getVars(z),ee=Y[E];if(!ee){let z=Y.length;ee={name:R||"node"+V+z+(j?"_"+j:""),type:O},Y.push(ee),Y[E]=ee}return ee}getTempVar(E,O,R,z){return this.getVar(E,O,R,this.shader,"T",z)}getAttribute(E,O){if(!this.attributes[E]){let R=this.getVar(E,O);this.addVertexParsCode("attribute "+O+" "+E+";"),this.addVertexFinalCode(R.name+" = "+E+";"),this.attributes[E]={varying:R,name:E,type:O}}return this.attributes[E]}getCode(E){return[this.prefixCode,this.parsCode[E],this.getVarListCode(this.getVars("varying"),"varying"),this.getVarListCode(this.inputs.uniforms[E],"uniform"),this.getVarListCode(this.inputs.arrayUniforms[E],"uniform"),this.getIncludesCode("consts",E),this.getIncludesCode("structs",E),this.getIncludesCode("functions",E),"void main() {",this.getVarListCode(this.getVars(E)),this.code[E],this.resultCode[E],this.finalCode[E],"}"].join("\n")}getVarListCode(E,O){O=O??"";let R="";for(let z=0,V=E.length;z<V;++z){let V=E[z],j=V.type,Y=V.name,ee=V.size,se=this.getFormatByType(j);if(se===void 0)throw new Error("Node pars "+se+" not found.");se.includes("[]")?R+=O+" "+se.substring(0,se.length-2)+" "+Y+`[${ee}];\n`:R+=O+" "+se+" "+Y+";\n"}return R}getVars(E){return this.inputs.vars[E??this.shader]}getNodeData(E){let O=E instanceof WF?E.uuid:E;return this.nodeData[O]=this.nodeData[O]||{}}createUniform(E,O,R,z,V,j){if(O.includes("[]")){let Y=this.inputs.arrayUniforms,ee=Y.list.length,se=new qF({type:O,size:R.size,name:z||"nodeUA"+ee+(j?"_"+j:""),node:R,needsUpdate:V});return Y.list.push(se),Y[E].push(se),Y[E][se.name]=se,this.uniforms[se.name]=se,se}{let Y=this.inputs.uniforms,ee=Y.list.length,se=new qF({type:O,name:z||"nodeU"+ee+(j?"_"+j:""),node:R,needsUpdate:V});return Y.list.push(se),Y[E].push(se),Y[E][se.name]=se,this.uniforms[se.name]=se,se}}createVertexUniform(E,O,R,z,V){return this.createUniform("vertex",E,O,R,z,V)}createFragmentUniform(E,O,R,z,V){return this.createUniform("fragment",E,O,R,z,V)}include(E,O,R){let z;if(E=typeof E=="string"?YF.get(E):E,this.context.include===!1)return E.name;E instanceof mN?z=this.includes.functions:E instanceof IN?z=this.includes.consts:E instanceof zN&&(z=this.includes.structs);let V=z[this.shader]=z[this.shader]||[];if(E){let z=V[E.name];if(z||(z=V[E.name]={node:E,deps:[]},V.push(z),z.src=E.build(this,"source")),E instanceof mN&&O&&V[O.name]&&V[O.name].deps.indexOf(E)===-1&&(V[O.name].deps.push(E),E.includes?.length)){let R=0;do{this.include(E.includes[R++],O)}while(R<E.includes.length)}return R&&(z.src=R),E.name}throw new Error("Include not found.")}colorToVectorProperties(E){return E.replace("r","x").replace("g","y").replace("b","z").replace("a","w")}colorToVector(E){return E.replace(/c/g,"v3")}getIncludes(E,O){return this.includes[E][O||this.shader]}getConstructorFromLength(E){return xU[E-1]}isTypeMatrix(E){return/^m/.test(E)}getTypeLength(E){return E==="f"?1:parseInt(this.colorToVector(E).substr(1))}getTypeFromLength(E){return E===1?"f":"v"+E}findNode(...E){for(let O=0;O<arguments.length;O++){let R=E[O];if(R?.isNode)return R}}resolve(...E){for(let O=0;O<arguments.length;O++){let R=E[O];if(R!==void 0){if(R.isNode)return R;if(R.isTexture)switch(R.mapping){case ii:case ri:return new dU(R);case ai:return new cU(new jN(R));default:return new jN(R)}else{if(R.isVector2)return new KF(R);if(R.isVector3)return new JF(R);if(R.isVector4)return new tN(R)}}}}format(E,O,R){switch(this.colorToVector(R+" <- "+O)){case"f <- v2":return E+".x";case"f <- v3":return E+".x";case"f <- v4":return E+".x";case"f <- i":case"f <- b":return"float( "+E+" )";case"v2 <- f":return"vec2( "+E+" )";case"v2 <- v3":return E+".xy";case"v2 <- v4":return E+".xy";case"v2 <- i":case"v2 <- b":return"vec2( float( "+E+" ) )";case"v3 <- f":return"vec3( "+E+" )";case"v3 <- v2":return"vec3( "+E+", 0.0 )";case"v3 <- v4":return E+".xyz";case"v3 <- i":case"v3 <- b":return"vec2( float( "+E+" ) )";case"v4 <- f":return"vec4( "+E+" )";case"v4 <- v2":return"vec4( "+E+", 0.0, 1.0 )";case"v4 <- v3":return"vec4( "+E+", 1.0 )";case"v4 <- i":case"v4 <- b":return"vec4( float( "+E+" ) )";case"i <- f":case"i <- b":return"int( "+E+" )";case"i <- v2":return"int( "+E+".x )";case"i <- v3":return"int( "+E+".x )";case"i <- v4":return"int( "+E+".x )";case"b <- f":return"( "+E+" != 0.0 )";case"b <- v2":return"( "+E+" != vec2( 0.0 ) )";case"b <- v3":return"( "+E+" != vec3( 0.0 ) )";case"b <- v4":return"( "+E+" != vec4( 0.0 ) )";case"b <- i":return"( "+E+" != 0 )"}return E}getTypeByFormat(E){return bU[E]||E}getFormatByType(E){return wU[E]||E}getUUID(E,O){return O=O===void 0||O,O&&this.cache&&(E=this.cache+"-"+E),E}getElementByIndex(E){return yU[E]}getIndexByElement(E){return yU.indexOf(E)}isShader(E){return this.shader===E}setShader(E){return this.shader=E,this}mergeDefines(E){for(let O in E)this.defines[O]=E[O];return this.defines}mergeUniform(E){for(let O in E)this.uniforms[O]=E[O];return this.uniforms}getTextureEncodingFromMap(E){let O;return E?E.isTexture&&(O=E.encoding):O=Xr,O===Xr&&this.context.gamma&&(O=Yr),O}};var _U=class extends ZF{constructor(E=0,O,R,z){super("c");this.nodeType="Color";this.value=E instanceof $F?E:new $F(E||0,O,R,z)}setRGBA(E){this.value.setRGBA(E.r,E.g,E.b,E.a)}generate(E,O,R,z,V,j){R=E.getUUID(R??this.getUUID()),z=z??this.getType(E);let Y=E.getNodeData(R),ee=this.getReadonly()&&this.generateReadonly!==void 0;if(this.alpha){let O=this.alpha.build(E,"f");E.addFragmentNodeCode(`accumAlpha += ( 1.0 - accumAlpha ) * ${O};`)}return ee?this.generateReadonly(E,O,R,z,V,j):E.isShader("vertex")?(Y.vertex||(Y.vertex=E.createVertexUniform(z,this,V,j,this.getLabel())),E.format(Y.vertex.name,z,O)):(Y.fragment||(Y.fragment=E.createFragmentUniform(z,this,V,j,this.getLabel())),E.format(Y.fragment.name,z,O))}generateReadonly(E,O,R,z,V,j){return E.format("vec3("+this.value.r+", "+this.value.g+", "+this.value.b+")",z,O)}};var AU=class extends ZF{constructor(E){super("i");this.nodeType="Int";this.value=Math.floor(E??0)}generateReadonly(E,O,R,z,V,j){return E.format(this.value.toString(),z,O)}};var MU=class extends ZF{constructor(E){super("b");this.nodeType="Bool";this.value=E??!1}generateReadonly(E,O,R,z){return E.format(this.value?"true":"false",z,O)}};var EU=class extends ZF{constructor(E=1,O){super("f[]");this.nodeType="FloatArray";this.size=E,this.value=Array.isArray(O)?O:typeof O=="number"?new Array(E).fill(O):new Array(E).fill(0)}};var CU=class extends ZF{};var TU=class extends CU{constructor(E){super("v3");this.image=E;this._value=new Wn}get value(){return this._value.x=this.image.isVideo?this.image.img.videoWidth??0:this.image.img.width,this._value.y=this.image.isVideo?this.image.img.videoHeight??0:this.image.img.height,this._value}};var PU=class extends CU{constructor(E,O,R=1008,z=1006){super("t");this.image=E;this.wrap=O;this.minFilter=R;this.magFilter=z}get value(){return this.image.getTexture(this.wrap,this.minFilter,this.magFilter)}};var DU=class extends ZF{constructor(E){super("m3");this.nodeType="Matrix3";this.value=E??new wn}generateReadonly(E,O,R,z,V,j){return E.format("mat3("+this.value.elements.join(", ")+")",z,O)}get elements(){return this.value.elements}set elements(E){this.value.fromArray(E)}};var IU=class extends ZF{constructor(E){super("m4");this.nodeType="Matrix4";this.value=E??new Es}generateReadonly(E,O,R,z,V,j){return E.format("mat4("+this.value.elements.join(", ")+")",z,O)}get elements(){return this.value.elements}set elements(E){this.value.fromArray(E)}};function RR(E,O,R,z=0){E.setUvTransform(R[0],R[1],O[0],O[1],0,0,0).premultiply((new wn).makeRotation(z*xn.DEG2RAD))}var OU=class extends DU{constructor(E,O,R=0){super(new wn);this.repeat=E;this.offset=O;this.rotation=R;RR(this.value,E,O,R)}updateMatrix(){RR(this.value,this.repeat,this.offset,this.rotation)}};var RU=class extends ZF{constructor(E=1,O){super("v4[]");this.nodeType="Vector4Array";this.size=E,this.value=Array.isArray(O)?O:O instanceof Nn?new Array(E).fill(O):new Array(E).fill(new Nn(0))}};var LU=class extends QF{constructor(E,O,R,z){super("v3");this.nodeType="Blend";this.a=E,this.b=O,this.alpha=R,this.mode=z}generate(E,O){if(E.isShader("fragment")){let R=[];return R.push(this.a.build(E,"c")),R.push(this.b.build(E,"c")),R.push(this.alpha.build(E,"f")),R.push(this.mode.build(E,"i")),E.format("spe_blend("+R.join(",")+")",this.getType(E),O)}return console.warn("BlendNode is not compatible with "+E.shader+" shader."),E.format("vec3( 0.0 )",this.getType(E),O)}};var BU=class extends QF{constructor(E,O){super("v3");this.nodeType="CustomColor";this.color=E,this.alpha=O,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(E,O){if(E.isShader("fragment")){let R=E.include(BU.Nodes.customColor);E.addFragmentVariable(this.calpha,"float");let z=[];return z.push(this.color.build(E,"v3")),z.push(this.mask?`luminance(${this.mask.build(E,"v3")})`:"1.0"),z.push(this.alpha.build(E,"f")),z.push(this.calpha),E.format(R+"("+z.join(",")+")",this.getType(E),O)}return console.warn("CustomColorNode is not compatible with "+E.shader+" shader."),E.format("vec3( 0.0 )",this.getType(E),O)}},zU=BU;zU.Nodes=function(){return{customColor:new mN("vec3 customColor(vec3 color, float mask, float alpha, out float calpha) {\n\t\t\t\tfloat lalpha = alpha * mask;\n\t\t\t\tcalpha =  lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0);\n\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha;\n\n\t\t\t\treturn color;\n\t\t\t}")}}();var FU=class extends QF{constructor(E,O){super("v3");this.nodeType="CustomNormal";this.cnormal=E,this.alpha=O,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(E,O){if(E.isShader("fragment")){let R=E.include(FU.Nodes.customNormal);E.addFragmentVariable(this.calpha,"float");let z=[];return z.push(this.cnormal.build(E,"v3")),z.push("normal"),z.push(this.mask?`luminance(${this.mask.flow(E,"v3").result})`:"1.0"),z.push(this.alpha.build(E,"f")),z.push(this.calpha),E.format(R+"("+z.join(",")+")",this.getType(E),O)}return console.warn("CustomNormalNode is not compatible with "+E.shader+" shader."),E.format("vec3( 0.0 )",this.getType(E),O)}},NU=FU;NU.Nodes=function(){return{customNormal:new mN("vec3 customNormal(vec3 cnormal, vec3 norm, float mask, float alpha, out float calpha) {\n\t\t\t\tvec3 normal = packNormalToRGB( norm ).rgb;\n\t\t\t\tnormal *= step( vec3(0.5), cnormal );\n\n\t\t\t\tfloat lalpha = alpha * mask;\n\t\t\t\tcalpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );\n\t\t\t\taccumAlpha += ( 1.0 - accumAlpha ) * lalpha;\n\n\t\t\t\treturn normal;\n\t\t\t}")}}();var UU=class extends QF{constructor(E,O,R,z,V,j,Y,ee,se,he,ce,ue){super("v3");this.nodeType="CustomTexture";this.texture=E,this.textureSize=O,this.crop=R,this.projection=z,this.axis=V,this.side=j,this.size=Y,this.blending=ee,this.mat=se,this.isMask=ue,this.alpha=he,this.mode=ce,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(E,O){E.require("position"),E.require("normal"),E.require("uv"),E.requires.uv=[!0],E.extensions.shaderTextureLOD=!0,E.extensions.derivatives=!0;let R,z=`g${this.uuid.toString().replace(/-/g,"")}`;switch(this.projection.value){case 3:R=E.include(UU.Nodes.cylindrical);break;case 2:R=E.include(UU.Nodes.spherical);break;case 1:let O=["vec3(1.0, 0.0, 0.0)","vec3(0.0, 1.0, 0.0)","vec3(0.0, 0.0, 1.0)"][this.axis.value],V=["zy","xz","xy"][this.axis.value],j=new mN(`\n\t\tvec3 ${z}_planarTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUv) {\n\t\t\t\tvec2 projected = (1. + (position.${V})) / 2.;\n\t\t\t\tvec2 uvs = ( mat * vec3( (projected * 2. - 1.) / (size * .5), 1. ) / 2. + 0.5 ).xy;\n\t\t\t\twriteUv = uvs;\n\n\t\t\t\tvec4 tmp = texture2D( tex, uvs );\n\n\t\t\t\tvec3 col = tmp.rgb;\n\t\t\t\tfloat lalpha = alpha * tmp.a;\n\t\t\t\t${this.side.value===2?"":`lalpha *= step(0.0, ${this.side.value===1?"-1.0 * ":""}dot(vObjectNormal, ${O}));`}\n\n\t\t\t\tif ( crop > 0.5 ) {\n\t\t\t\t\tif ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {\n\t\t\t\t\t\tlalpha = 0.0;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tlalpha *= mask;\n\n\t\t\t\tcalpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );\n\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\n\t\t\t\treturn col;\n\t\t\t}`);R=E.include(j);break;case 4:R=E.include(UU.Nodes.triplanar);break;default:R=E.include(UU.Nodes.uv);break}E.addFragmentVariable(this.calpha,"float");let V=[];if(V.push("normal"),V.push(this.texture.generate(E,"t")),V.push(this.textureSize.build(E,"v2")),V.push(this.crop.build(E,"f")),V.push(this.mat.build(E,"mat3")),V.push(this.size.build(E,"v2")),V.push(this.blending.build(E,"f")),V.push(this.isMask.build(E,"b")),V.push(this.mask?`luminance(${this.mask.flow(E,"v3").result})`:"1.0"),V.push(this.alpha.build(E,"f")),V.push(this.mode.build(E,"i")),V.push(this.calpha),this.projection.value===4){let O=`${z}_writeUvs`,R=O+"0",j=O+"1",Y=O+"2",ee=`${z}_triplanarWeights`;E.addFragmentVariable(R,"vec2"),E.addFragmentVariable(j,"vec2"),E.addFragmentVariable(Y,"vec2"),E.addFragmentVariable(ee,"vec3"),V.push(R),V.push(j),V.push(Y),V.push(ee)}else{let O=`${z}_writeUvs`;E.addFragmentVariable(O,"vec2"),V.push(O)}return E.format(R+"("+V.join(",")+")",this.getType(E),O)}},kU=UU;kU.Nodes=function(){let E=new mN("\nvec3 cylindricalTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUv) {\n                vec3 posN = normalize(position);\n                float u = 0.5 + atan(posN.z, posN.x) / (2.*3.1415);\n                float scaledHeight = position.y / (size.y * 0.5);\n                float v =  (scaledHeight / 2.) + .5;\n\n                vec2 calculatedUv = vec2(u,v);\n\t\t\t\tvec2 uvs = ( mat * vec3( calculatedUv * 2. - 1., 1. ) / 2. + 0.5 ).xy;\n\t\t\t\twriteUv = uvs;\n\n                vec2 df = fwidth(uvs);\n               \tif(df.x > 0.5) df.x = 0.;\n\n\t\t\t\t#ifdef GL_EXT_shader_texture_lod\n                vec4 tmp = texture2DLodEXT(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));\n\t\t\t\t#else\n                vec4 tmp = textureLod(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));\n\t\t\t\t#endif\n\n\t\t\t\tvec3 col = tmp.rgb;\n\t\t\t\tfloat lalpha = alpha * tmp.a;\n\t\t\t\tif ( crop > 0.5 ) {\n\t\t\t\t\tif ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {\n\t\t\t\t\t\tlalpha = 0.0;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tlalpha *= mask;\n\t\t\t\t\n\t\t\t\tcalpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );\n\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\n\t\t\t\treturn col;\n\t\t\t}\n"),O=new mN("\nvec3 sphericalTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUv) {\n                vec3 posN = normalize(vPosition);\n                float u = 0.5 + atan(posN.z, posN.x) / (2.*3.1415);\n                float v = 0.5 + asin(posN.y) / 3.1415;\n\n                vec2 calculatedUv = vec2(u,v);\n\t\t\t\tvec2 uvs = ( mat * vec3( calculatedUv * 2. - 1., 1. ) / 2. + 0.5 ).xy;\n\t\t\t\twriteUv = uvs;\n\n                vec2 df = fwidth(uvs);\n               \tif(df.x > 0.5) df.x = 0.;\n\t\t\t\t#ifdef GL_EXT_shader_texture_lod\n                vec4 tmp = texture2DLodEXT(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));\n\t\t\t\t#else\n                vec4 tmp = textureLod(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));\n\t\t\t\t#endif\n\n\t\t\t\tvec3 col = tmp.rgb;\n\t\t\t\tfloat lalpha = alpha * tmp.a;\n\t\t\t\tif ( crop > 0.5 ) {\n\t\t\t\t\tif ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {\n\t\t\t\t\t\tlalpha = 0.0;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tlalpha *= mask;\n\n\t\t\t\tcalpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );\n\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\n\t\t\t\treturn col;\n\t\t\t}\n"),R=new mN("vec3 uvTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUv) {\n\t\t\t\tvec2 uvs = ( mat * vec3( vUv * 2. - 1., 1. ) / 2. + 0.5 ).xy;\n\t\t\t\twriteUv = uvs;\n\n\t\t\t\tvec4 tmp = texture2D( tex, uvs );\n\n\t\t\t\tvec3 col = tmp.rgb;\n\n\t\t\t\tfloat lalpha = alpha * tmp.a;\n\t\t\t\tif ( crop > 0.5 ) {\n\t\t\t\t\tif ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {\n\t\t\t\t\t\tlalpha = 0.0;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tlalpha *= mask;\n\n\t\t\t\tcalpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );\n\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\n\t\t\t\treturn col;\n\t\t\t}"),z=new mN("vec3 triplanarTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUvs0, out vec2 writeUvs1, out vec2 writeUvs2, out vec3 writeWeights) {\n\t\t\t\tvec3 p = position;\n\t\t\t\tvec2 uv0 = (1.0 + p.xy) / 2.0;     \n\t\t\t\tvec2 uv1 = (1.0 + p.zy) / 2.0;\t\t\n\t\t\t\tvec2 uv2 = (1.0 + p.xz) / 2.0;\t\t\n\t\n\t\t\t\tuv0 = (mat * vec3((uv0 * 2.0 - 1.0) / (size * 0.5), 1.0) / 2.0 + 0.5).xy;\n\t\t\t\tuv1 = (mat * vec3((uv1 * 2.0 - 1.0) / (size * 0.5), 1.0) / 2.0 + 0.5).xy;\n\t\t\t\tuv2 = (mat * vec3((uv2 * 2.0 - 1.0) / (size * 0.5), 1.0) / 2.0 + 0.5).xy;\n\n\t\t\t\t// Range from 3 to 128 seems to be good\n\t\t\t\tfloat exponent = (1.0 - blending) * 125.0 + 3.0;\n\n\t\t\t\tvec3 n = vObjectNormal;\n\t\t\t\tvec3 weights = abs(normalize(n));\n\t\t\t\tweights = pow(weights, vec3(exponent));\n\t\t\t\tweights /= dot(weights, vec3(1.0));\n\n\t\t\t\t// Write out all sets of UVs that we generated\n\t\t\t\twriteUvs0 = uv0;\n\t\t\t\twriteUvs1 = uv1;\n\t\t\t\twriteUvs2 = uv2;\n\t\t\t\twriteWeights = weights;\n\n\t\t\t\t// Derivatives for LOD\n\t\t\t\tvec2 df0 = fwidth(uv0);\n\t\t\t\tvec2 df1 = fwidth(uv1);\n\t\t\t\tvec2 df2 = fwidth(uv2);\n\t\t\t\tif (df0.x > 0.5) df0.x = 0.0;\n\t\t\t\tif (df1.x > 0.5) df1.x = 0.0;\n\t\t\t\tif (df2.x > 0.5) df2.x = 0.0;\n\n\t\t\t\t#ifdef GL_EXT_shader_texture_lod\n                \tvec4 tmp = \n\t\t\t\t\t\ttexture2DLodEXT(tex, uv0, log2(max(df0.x, df0.y)*min(textureSize.x, textureSize.y))) * weights.z + \n\t\t\t\t\t\ttexture2DLodEXT(tex, uv1, log2(max(df1.x, df1.y)*min(textureSize.x, textureSize.y))) * weights.x + \n\t\t\t\t\t\ttexture2DLodEXT(tex, uv2, log2(max(df2.x, df2.y)*min(textureSize.x, textureSize.y))) * weights.y;\n\t\t\t\t#else\n                \tvec4 tmp = \n\t\t\t\t\t\ttextureLod(tex, uv0, log2(max(df0.x, df0.y)*min(textureSize.x, textureSize.y))) * weights.z + \n\t\t\t\t\t\ttextureLod(tex, uv1, log2(max(df1.x, df1.y)*min(textureSize.x, textureSize.y))) * weights.x + \n\t\t\t\t\t\ttextureLod(tex, uv2, log2(max(df2.x, df2.y)*min(textureSize.x, textureSize.y))) * weights.y;\n\t\t\t\t#endif\n\n\t\t\t\tvec3 col = tmp.rgb;\n\t\t\t\tfloat lalpha = alpha * tmp.a;\n\n\t\t\t\t// Apply cropping across all 3 planes\n\t\t\t\tif ( crop > 0.5 ) {\n\t\t\t\t\tif ( uv0.x < 0.0 || uv0.x > 1.0 || uv0.y < 0.0 || uv0.y > 1.0 )  {\n\t\t\t\t\t\tlalpha = 0.0;\n\t\t\t\t\t}\n\t\t\t\t\tif ( uv1.x < 0.0 || uv1.x > 1.0 || uv1.y < 0.0 || uv1.y > 1.0 )  {\n\t\t\t\t\t\tlalpha = 0.0;\n\t\t\t\t\t}\n\t\t\t\t\tif ( uv2.x < 0.0 || uv2.x > 1.0 || uv2.y < 0.0 || uv2.y > 1.0 )  {\n\t\t\t\t\t\tlalpha = 0.0;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tlalpha *= mask;\n\t\t\t\tcalpha =  lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0);\n\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\n\t\t\t\treturn col;//n * 0.5 + 0.5;\n\t\t\t}\t\t\t\n\t\t\t");return{cylindrical:E,spherical:O,uv:R,triplanar:z}}();var VU=class extends QF{constructor(E,O,R,z,V,j,Y,ee,se,he,ce,ue){super("v3");this.nodeType="Depth";this.gradientType=E,this.smooth=O,this.near=R,this.far=z,this.isVector=V,this.isWorldSpace=j,this.origin=Y,this.direction=ee,this.colors=se,this.steps=he,this.isMask=ue,this.alpha=ce,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(E,O){let R=`g${this.uuid.toString().replace(/-/g,"")}`,z=new mN(`vec3 ${R}_sdepth(float near, float far, vec3 origin, vec3 direction, vec4 colors[${R}_MAX_COLORS], float steps[${R}_MAX_COLORS], bool isMask, float mask, float alpha, out float calpha) {\n               vec4 color = colors[0];\n               #ifdef ${R}_IS_VECTOR\n                   #ifdef ${R}_LINEAR\n                       #ifdef ${R}_WORLDSPACE\n                       float depth = vectorLinearWorldSpaceDepth(direction, origin, near, far);\n                       #else\n                       float depth = vectorLinearObjectSpaceDepth(direction, origin, near, far);\n                       #endif\n                   #else\n                       #ifdef ${R}_WORLDSPACE\n                           float depth = vectorSphericalWorldSpaceDepth(origin, near, far);\n                       #else\n                           float depth = vectorSphericalObjectSpaceDepth(origin, near, far);\n                       #endif\n                   #endif\n               #else\n                   float dist = length(vWPosition - cameraPosition);\n\t\t\t       float depth = ( dist - near ) / ( far - near );\n               #endif\n\n\n              float p;\n              #ifdef ${R}_SMOOTH\n\t\t\t\tfor ( int i = 1; i < ${R}_MAX_COLORS; i++ ) {\n\t\t\t\t\t\tp = clamp( ( depth - steps[i-1] ) / ( steps[i] - steps[i-1] ), 0.0, 1.0 );\n\t\t\t\t\t\tcolor = mix(color, colors[i], smoothstep(0.0, 1.0, p));\n\t\t\t\t\t}\n              #else\n                for ( int i = 1; i < ${R}_MAX_COLORS; i++ ) {\n                   p = clamp(( depth - steps[i - 1] ) / ( steps[i] - steps[i - 1] ), 0.0, 1.0);\n                   color = mix(color, colors[i], p);\n                 }\n              #endif\n\n               float lalpha = alpha * color.a * mask;\n               calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));\n\t\t\t   accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\t\t\t   \n               return color.rgb;\n\t\t\t}`,[VU.Nodes.vectorLinearWorldSpaceDepth,VU.Nodes.vectorLinearObjectSpaceDepth,VU.Nodes.vectorSphericalObjectSpaceDepth,VU.Nodes.vectorSphericalWorldSpaceDepth]);if(E.isShader("fragment")){E.define(`${R}_MAX_COLORS`,this.colors.value.length),this.smooth.value&&E.define(`${R}_SMOOTH`),this.isVector.value>.5&&E.define(`${R}_IS_VECTOR`),this.gradientType.value===0&&E.define(`${R}_LINEAR`),this.isWorldSpace.value>.5&&E.define(`${R}_WORLDSPACE`),E.require("worldPosition"),E.addFragmentVariable(this.calpha,"float");let V=E.include(z),j=[];return j.push(this.near.build(E,"f")),j.push(this.far.build(E,"f")),j.push(this.origin.build(E,"v3")),j.push(this.direction.build(E,"v3")),j.push(this.colors.build(E,"v4[]")),j.push(this.steps.build(E,"f[]")),j.push(this.isMask.build(E,"b")),j.push(this.mask?`luminance(${this.mask.flow(E,"v3").result})`:"1.0"),j.push(this.alpha.build(E,"f")),j.push(this.calpha),E.format(V+"("+j.join(",")+")",this.getType(E),O)}return console.warn("DepthNode is not compatible with "+E.shader+" shader."),E.format("vec3( 0.0 )",this.getType(E),O)}},jU=VU;jU.Nodes=function(){let E=new mN("float vectorLinearWorldSpaceDepth(vec3 direction, vec3 origin, float near, float far) {\n               vec3 n = normalize(direction);\n               float dist = (n.x*(vWPosition.x - origin.x) + n.y*(vWPosition.y - origin.y) + n.z*(vWPosition.z - origin.z));\n               return ( dist - near ) / ( far - near );\n            }"),O=new mN("float vectorLinearObjectSpaceDepth(vec3 direction, vec3 origin, float near, float far) {\n               vec3 n = normalize(direction);\n               float dist = (n.x*(position.x - origin.x) + n.y*(position.y - origin.y) + n.z*(position.z - origin.z));\n               return ( dist - near ) / ( far - near );\n            }"),R=new mN("float vectorSphericalWorldSpaceDepth(vec3 origin, float near, float far) {\n               float dist = length(vWPosition - origin);\n               return ( dist - near ) / ( far - near );\n            }"),z=new mN("float vectorSphericalObjectSpaceDepth(vec3 origin, float near, float far) {\n               float dist = length(position - origin);\n               return ( dist - near ) / ( far - near );\n            }");return{vectorLinearWorldSpaceDepth:E,vectorLinearObjectSpaceDepth:O,vectorSphericalWorldSpaceDepth:R,vectorSphericalObjectSpaceDepth:z}}();var GU=class extends QF{constructor(E,O,R,z,V,j,Y,ee){super("v3");this.nodeType="Fresnel";this.color=E,this.bias=O,this.scale=R,this.intensity=z,this.factor=V,this.isMask=ee,this.alpha=j,this.mode=Y,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(E,O){if(E.require("vWorldViewDir"),E.require("worldNormal"),E.isShader("fragment")){E.addFragmentVariable(this.calpha,"float");let R=new mN("vec3 fresnel(vec3 color, float bias, float scale, float intensity, float factor, bool isMask, float mask, float alpha, int mode, out float calpha) {\n\t\t\t\t\tfloat fresnel = bias + scale * pow( abs( factor + dot( normalize( vWorldViewDir ), normalize( vWNormal ) ) ), intensity );\n\n\t\t\t\t\tfloat lalpha = clamp(fresnel, 0.0, 1.0) * alpha * mask;\n\t\t\t\t\tcalpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));\n\t\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\n\t\t\t\t\treturn color;\n\t\t\t\t}"),z=E.include(R),V=[];return V.push(this.color.build(E,"c")),V.push(this.bias.build(E,"f")),V.push(this.scale.build(E,"f")),V.push(this.intensity.build(E,"f")),V.push(this.factor.build(E,"f")),V.push(this.isMask.build(E,"b")),V.push(this.mask?`luminance(${this.mask.flow(E,"v3").result})`:"1.0"),V.push(this.alpha.build(E,"f")),V.push(this.mode.build(E,"i")),V.push(this.calpha),E.format(z+"("+V.join(",")+")",this.getType(E),O)}return console.warn("FresnelNode is not compatible with "+E.shader+" shader."),E.format("vec3( 0.0 )",this.getType(E),O)}};var HU=class extends QF{constructor(E,O,R,z,V,j,Y,ee,se){super("v3");this.nodeType="Gradient";this.gradientType=E,this.smooth=O,this.colors=R,this.steps=z,this.offset=V,this.morph=j,this.angle=Y,this.isMask=se,this.alpha=ee,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(E,O){if(E.isShader("fragment")){E.define("GRAD_MAX",10),E.require("uv"),E.requires.uv=[!0],E.addFragmentVariable(this.calpha,"float");let R=E.include(HU.Nodes.gradient),z=[];return z.push(this.gradientType.build(E,"i")),z.push(this.smooth.build(E,"b")),z.push(this.colors.build(E,"v4[]")),z.push(this.steps.build(E,"f[]")),z.push(this.offset.build(E,"v2")),z.push(this.morph.build(E,"v2")),z.push(this.angle.build(E,"f")),z.push(this.isMask.build(E,"b")),z.push(this.mask?`luminance(${this.mask.flow(E,"v3").result})`:"1.0"),z.push(this.alpha.build(E,"f")),z.push(this.calpha),E.format(R+"("+z.join(",")+")",this.getType(E),O)}return console.warn("GradientNode is not compatible with "+E.shader+" shader."),E.format("vec3( 0.0 )",this.getType(E),O)}},WU=HU;WU.Nodes=function(){return{gradient:new mN("vec3 gradient(int gradientType, bool smoothed, vec4 colors[GRAD_MAX], float steps[GRAD_MAX], vec2 offset, vec2 morph, float angle, bool isMask, float mask, float alpha, out float calpha) {\n\t\t\t\tvec4 color = colors[0];\n\t\t\t\tvec2 m = morph / vUv.xy;\n\t\t\t\tvec2 rot = vec2( 0.5 + m.x, m.y );\n\t\t\t\tvec2 dt = vec2(\n\t\t\t\t\tcos( angle ) * rot.x - sin( angle ) * rot.y,\n\t\t\t\t\tsin( angle ) * rot.x + cos( angle ) * rot.y\n\t\t\t\t);\n\t\t\t\tvec2 pt = ( vUv - 0.5 + offset ) / 2.0 + dt / 2.0;\n\t\t\t\tfloat t = dot( pt, dt ) / dot( dt, dt );\n\t\t\t\tif ( gradientType == 1 ) {\n\t\t\t\t\tt = distance (\n\t\t\t\t\t\t( vUv + morph ) * 3.0,\n\t\t\t\t\t\t( vUv + offset ) + 1.0\n\t\t\t\t\t) + angle;\n\t\t\t\t} else if ( gradientType == 2 ) {\n\t\t\t\t\tfloat polar = atan(\n\t\t\t\t\t\tvUv.x + morph.x - 0.5 + offset.x,\n\t\t\t\t\t\tvUv.y + morph.y - 0.5 + offset.y\n\t\t\t\t\t) * -1.0;\n\t\t\t\t\tt = fract( ( angle / PI / -2.0 ) + 0.5 * ( polar / PI ) );\n\t\t\t\t}\n\n\t\t\t\tfloat p;\n\t\t\t\tif (smoothed) {\n\t\t\t\t\tfor ( int i = 1; i < GRAD_MAX; i++ ) {\n\t\t\t\t\t\tp = clamp( ( t - steps[i-1] ) / ( steps[i] - steps[i-1] ), 0.0, 1.0 );\n\t\t\t\t\t\tcolor = mix(color, colors[i], smoothstep(0.0, 1.0, p));\n\t\t\t\t\t}\n\n\t\t\t\t} else {\n\t\t\t\t\tfor ( int i = 1; i < GRAD_MAX; i++ ) {\n\t\t\t\t\t\tp = clamp( ( t - steps[i-1] ) / ( steps[i] - steps[i-1] ), 0.0, 1.0 );\n\t\t\t\t\t\tcolor = mix(color, colors[i], p);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfloat lalpha = alpha * color.a * mask;\n\t\t\t\tcalpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));\n\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\t\t\t\t\n\t\t\t\treturn color.xyz;\n\t\t\t}")}}();var qU=class extends QF{constructor(E,O,R,z,V){super("v3");this.nodeType="Matcap";this.texture=E,this.isMask=z,this.alpha=O,this.mode=R,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`,this.rotation=V}generate(E,O){if(E.isShader("fragment")){E.addFragmentVariable(this.calpha,"float");let R=E.include(qU.Nodes.matcap);E.require("normal"),E.requires.normal=!0;let z=[];return z.push(this.texture.generate(E,"t")),z.push("normal"),z.push(this.isMask.build(E,"b")),z.push(this.mask?`luminance(${this.mask.flow(E,"v3").result})`:"1.0"),z.push(this.alpha.build(E,"f")),z.push(this.mode.build(E,"i")),z.push(this.calpha),z.push(this.rotation.build(E,"f")),E.format(R+"("+z.join(",")+")",this.getType(E),O)}return console.warn("MatcapNode is not compatible with "+E.shader+" shader."),E.format("vec3( 0.0 )",this.getType(E),O)}},XU=qU;XU.Nodes=function(){return{matcap:new mN("vec3 matcap(sampler2D matcapTex, vec3 normal, bool isMask, float mask, float alpha, int mode, out float calpha, float rotation) {\n\t\t\t\t\tvec3 viewDir = normalize( vViewPosition );\n\t\t\t\t\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\t\t\t\t\tvec3 y = cross( viewDir, x );\n\t\t\t\t\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) );\n\t\t\t\t\tuv = mat2( cos(rotation), sin(rotation), -sin(rotation), cos(rotation) ) * uv;\n\t\t\t\t\tuv = uv * 0.495 + 0.5;\n\t\t\t\t\tvec4 matcapColor = texture2D( matcapTex, uv );\n\n\t\t\t\t\tfloat lalpha = alpha * mask;\n\t\t\t\t\tcalpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));\n\t\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\t\t\t\t\t\n\t\t\t\t\treturn matcapColor.rgb;\n            \t}")}}();var YU=function(){let E=new mN("vec3 random3(vec3 c) {\n\t\t\tfloat j = 4096.0*sin(dot(c,vec3(17.0, 59.4, 15.0)));\n\t\t\tvec3 r;\n\t\t\tr.z = fract(512.0*j);\n\t\t\tj *= .125;\n\t\t\tr.x = fract(512.0*j);\n\t\t\tj *= .125;\n\t\t\tr.y = fract(512.0*j);\n\t\t\treturn r-0.5;\n\t\t}"),O=new mN("float simplexFast(vec3 p) {\n\t\t\t vec3 s = floor(p + dot(p, vec3(F3)));\n\t\t\t mediump vec3 x = p - s + dot(s, vec3(G3));\n\t\t\t mediump vec3 hs = s;\n\t\t\t \n\t\t\t mediump vec3 e = step(vec3(0.0), x - x.yzx);\n\t\t\t mediump vec3 i1 = e*(1.0 - e.zxy);\n\t\t\t mediump vec3 i2 = 1.0 - e.zxy*(1.0 - e);\n\t\t\t\t\n\t\t\t mediump vec3 x1 = x - i1 + G3;\n\t\t\t mediump vec3 x2 = x - i2 + 2.0*G3;\n\t\t\t mediump vec3 x3 = x - 1.0 + 3.0*G3;\n\t\t\t \n\t\t\t mediump vec4 w, d;\n\t\t\t \n\t\t\t w.x = dot(x, x);\n\t\t\t w.y = dot(x1, x1);\n\t\t\t w.z = dot(x2, x2);\n\t\t\t w.w = dot(x3, x3);\n\t\t\t \n\t\t\t w = max(0.6 - w, 0.0);\n\t\t\t \n\t\t\t d.x = dot(random3(hs), x);\n\t\t\t d.y = dot(random3(hs + i1), x1);\n\t\t\t d.z = dot(random3(hs + i2), x2);\n\t\t\t d.w = dot(random3(hs + 1.0), x3);\n\t\t\t \n\t\t\t w *= w;\n\t\t\t w *= w;\n\t\t\t d *= w;\n\t\t\t \n\t\t\t return dot(d, vec4(52.0));\n\t\t}",[E]);O.keywords.F3=new IN("float F3 0.3333333"),O.keywords.G3=new IN("float G3 0.1666667");let R=new mN("float simplexPrecise(vec3 p) {\n\t\t\t vec3 s = floor(p + dot(p, vec3(F3)));\n\t\t\t vec3 x = p - s + dot(s, vec3(G3));\n\t\t\t \n\t\t\t vec3 e = step(vec3(0.0), x - x.yzx);\n\t\t\t vec3 i1 = e*(1.0 - e.zxy);\n\t\t\t vec3 i2 = 1.0 - e.zxy*(1.0 - e);\n\t\t\t\t\n\t\t\t vec3 x1 = x - i1 + G3;\n\t\t\t vec3 x2 = x - i2 + 2.0*G3;\n\t\t\t vec3 x3 = x - 1.0 + 3.0*G3;\n\t\t\t \n\t\t\t vec4 w, d;\n\t\t\t \n\t\t\t w.x = dot(x, x);\n\t\t\t w.y = dot(x1, x1);\n\t\t\t w.z = dot(x2, x2);\n\t\t\t w.w = dot(x3, x3);\n\t\t\t \n\t\t\t w = max(0.6 - w, 0.0);\n\t\t\t \n\t\t\t d.x = dot(random3(s), x);\n\t\t\t d.y = dot(random3(s + i1), x1);\n\t\t\t d.z = dot(random3(s + i2), x2);\n\t\t\t d.w = dot(random3(s + 1.0), x3);\n\t\t\t \n\t\t\t w *= w;\n\t\t\t w *= w;\n\t\t\t d *= w;\n\t\t\t \n\t\t\t return dot(d, vec4(52.0));\n\t\t}",[E]);R.keywords.F3=new IN("float F3 0.3333333"),R.keywords.G3=new IN("float G3 0.1666667");let z=new mN("float simplexFractal(vec3 m) {\n\t\t\tmat3 rot1 = mat3(-0.37, 0.36, 0.85,-0.14,-0.93, 0.34,0.92, 0.01,0.4);\n\t\t\tmat3 rot2 = mat3(-0.55,-0.39, 0.74, 0.33,-0.91,-0.24,0.77, 0.12,0.63);\n\t\t\tmat3 rot3 = mat3(-0.71, 0.52,-0.47,-0.08,-0.72,-0.68,-0.7,-0.45,0.56);\n\t\t\treturn 0.5333333 * simplexFast(m * rot1)\n\t\t\t\t + 0.2666667 * simplexFast(2.0 * m * rot2)\n\t\t\t\t + 0.1333333 * simplexFast(4.0 * m * rot3)\n\t\t\t\t + 0.0666667 * simplexFast(8.0 * m);\n\t\t}",[O]),V=new mN("vec4 permute(vec4 x){return mod(((x*34.0)+1.0)*x, 289.0);}"),j=new mN("vec4 taylorInvSqrt(vec4 r){return 1.79284291400159 - 0.85373472095314 * r;}"),Y=new mN("float simplexAshima(vec3 v) {\n\t\t  const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;\n\t\t  const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);\n\t\t  vec3 i  = floor(v + dot(v, C.yyy) );\n\t\t  vec3 x0 =   v - i + dot(i, C.xxx) ;\n\t\t  vec3 g = step(x0.yzx, x0.xyz);\n\t\t  vec3 l = 1.0 - g;\n\t\t  vec3 i1 = min( g.xyz, l.zxy );\n\t\t  vec3 i2 = max( g.xyz, l.zxy );\n\t\t  vec3 x1 = x0 - i1 + 1.0 * C.xxx;\n\t\t  vec3 x2 = x0 - i2 + 2.0 * C.xxx;\n\t\t  vec3 x3 = x0 - 1. + 3.0 * C.xxx;\n\t\t  i = mod(i, 289.0 ); \n\t\t  vec4 p = permute( permute( permute( \n\t\t\t\t\t i.z + vec4(0.0, i1.z, i2.z, 1.0 ))\n\t\t\t\t   + i.y + vec4(0.0, i1.y, i2.y, 1.0 )) \n\t\t\t\t   + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));\n\t\t  float n_ = 1.0/7.0; // N=7\n\t\t  vec3  ns = n_ * D.wyz - D.xzx;\n\t\t  vec4 j = p - 49.0 * floor(p * ns.z *ns.z);  //  mod(p,N*N)\n\t\t  vec4 x_ = floor(j * ns.z);\n\t\t  vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)\n\t\t  vec4 x = x_ *ns.x + ns.yyyy;\n\t\t  vec4 y = y_ *ns.x + ns.yyyy;\n\t\t  vec4 h = 1.0 - abs(x) - abs(y);\n\t\t  vec4 b0 = vec4( x.xy, y.xy );\n\t\t  vec4 b1 = vec4( x.zw, y.zw );\n\t\t  vec4 s0 = floor(b0)*2.0 + 1.0;\n\t\t  vec4 s1 = floor(b1)*2.0 + 1.0;\n\t\t  vec4 sh = -step(h, vec4(0.0));\n\t\t  vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;\n\t\t  vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;\n\t\t  vec3 p0 = vec3(a0.xy,h.x);\n\t\t  vec3 p1 = vec3(a0.zw,h.y);\n\t\t  vec3 p2 = vec3(a1.xy,h.z);\n\t\t  vec3 p3 = vec3(a1.zw,h.w);\n\t\t  vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));\n\t\t  p0 *= norm.x;\n\t\t  p1 *= norm.y;\n\t\t  p2 *= norm.z;\n\t\t  p3 *= norm.w;\n\t\t  vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);\n\t\t  m = m * m;\n\t\t  return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1), \n\t\t\t\t\t\t\t\t\t\tdot(p2,x2), dot(p3,x3) ) );\n\t\t}",[V,j]),ee=new mN("vec4 mod289(vec4 x){return x - floor(x * (1.0 / 289.0)) * 289.0;}"),se=new mN("vec4 perm(vec4 x){return mod289(((x * 34.0) + 1.0) * x);}",[ee]),he=new mN("float noise(vec3 p){\n\t\t\tvec3 a = floor(p);\n\t\t\tvec3 d = p - a;\n\t\t\td = d * d * (3.0 - 2.0 * d);\n\t\t\tvec4 b = a.xxyy + vec4(0.0, 1.0, 0.0, 1.0);\n\t\t\tvec4 k1 = perm(b.xyxy);\n\t\t\tvec4 k2 = perm(k1.xyxy + b.zzww);\n\t\t\tvec4 c = k2 + a.zzzz;\n\t\t\tvec4 k3 = perm(c);\n\t\t\tvec4 k4 = perm(c + 1.0);\n\t\t\tvec4 o1 = fract(k3 * (1.0 / 41.0));\n\t\t\tvec4 o2 = fract(k4 * (1.0 / 41.0));\n\t\t\tvec4 o3 = o2 * d.z + o1 * (1.0 - d.z);\n\t\t\tvec2 o4 = o3.yw * d.x + o3.xz * (1.0 - d.x);\n\t\t\treturn o4.y * d.y + o4.x * (1.0 - d.y);\n\t\t}",[se]),ce=new mN("float fbm(vec3 x) {\n\t\t\tfloat v = 0.0;\n\t\t\tfloat a = 0.5;\n\t\t\tvec3 shift = vec3(100);\n\t\t\tfor (int i = 0; i < NUM_OCTAVES; ++i) {\n\t\t\t\tv += a * noise(x);\n\t\t\t\tx = x * 2.0 + shift;\n\t\t\t\ta *= 0.5;\n\t\t\t}\n\t\t\treturn v;\n\t\t}",[he]);ce.keywords.NUM_OCTAVES=new IN("int NUM_OCTAVES 5");let ue=new mN("vec3 fade(vec3 t) {return t*t*t*(t*(t*6.0-15.0)+10.0);}"),fe=new mN("float perlin(vec3 P){\n\t\t  vec3 Pi0 = floor(P);\n\t\t  vec3 Pi1 = Pi0 + vec3(1.0);\n\t\t  Pi0 = mod(Pi0, 289.0);\n\t\t  Pi1 = mod(Pi1, 289.0);\n\t\t  vec3 Pf0 = fract(P);\n\t\t  vec3 Pf1 = Pf0 - vec3(1.0);\n\t\t  vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);\n\t\t  vec4 iy = vec4(Pi0.yy, Pi1.yy);\n\t\t  vec4 iz0 = Pi0.zzzz;\n\t\t  vec4 iz1 = Pi1.zzzz;\n\t\t  vec4 ixy = permute(permute(ix) + iy);\n\t\t  vec4 ixy0 = permute(ixy + iz0);\n\t\t  vec4 ixy1 = permute(ixy + iz1);\n\t\t  vec4 gx0 = ixy0 / 7.0;\n\t\t  vec4 gy0 = fract(floor(gx0) / 7.0) - 0.5;\n\t\t  gx0 = fract(gx0);\n\t\t  vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);\n\t\t  vec4 sz0 = step(gz0, vec4(0.0));\n\t\t  gx0 -= sz0 * (step(0.0, gx0) - 0.5);\n\t\t  gy0 -= sz0 * (step(0.0, gy0) - 0.5);\n\t\t  vec4 gx1 = ixy1 / 7.0;\n\t\t  vec4 gy1 = fract(floor(gx1) / 7.0) - 0.5;\n\t\t  gx1 = fract(gx1);\n\t\t  vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);\n\t\t  vec4 sz1 = step(gz1, vec4(0.0));\n\t\t  gx1 -= sz1 * (step(0.0, gx1) - 0.5);\n\t\t  gy1 -= sz1 * (step(0.0, gy1) - 0.5);\n\t\t  vec3 g000 = vec3(gx0.x,gy0.x,gz0.x);\n\t\t  vec3 g100 = vec3(gx0.y,gy0.y,gz0.y);\n\t\t  vec3 g010 = vec3(gx0.z,gy0.z,gz0.z);\n\t\t  vec3 g110 = vec3(gx0.w,gy0.w,gz0.w);\n\t\t  vec3 g001 = vec3(gx1.x,gy1.x,gz1.x);\n\t\t  vec3 g101 = vec3(gx1.y,gy1.y,gz1.y);\n\t\t  vec3 g011 = vec3(gx1.z,gy1.z,gz1.z);\n\t\t  vec3 g111 = vec3(gx1.w,gy1.w,gz1.w);\n\t\t  vec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));\n\t\t  g000 *= norm0.x;\n\t\t  g010 *= norm0.y;\n\t\t  g100 *= norm0.z;\n\t\t  g110 *= norm0.w;\n\t\t  vec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));\n\t\t  g001 *= norm1.x;\n\t\t  g011 *= norm1.y;\n\t\t  g101 *= norm1.z;\n\t\t  g111 *= norm1.w;\n\t\t  float n000 = dot(g000, Pf0);\n\t\t  float n100 = dot(g100, vec3(Pf1.x, Pf0.yz));\n\t\t  float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));\n\t\t  float n110 = dot(g110, vec3(Pf1.xy, Pf0.z));\n\t\t  float n001 = dot(g001, vec3(Pf0.xy, Pf1.z));\n\t\t  float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));\n\t\t  float n011 = dot(g011, vec3(Pf0.x, Pf1.yz));\n\t\t  float n111 = dot(g111, Pf1);\n\t\t  vec3 fade_xyz = fade(Pf0);\n\t\t  vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fade_xyz.z);\n\t\t  vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);\n\t\t  float n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x); \n\t\t  return 2.2 * n_xyz;\n\t\t}",[V,j,ue]),ve=new mN("float hashwithoutsine13(vec3 p3)\n\t\t{\n\t\t\tp3  = fract(p3 * .1031);\n\t\t\tp3 += dot(p3, p3.yzx + 33.33);\n\t\t\treturn fract((p3.x + p3.y) * p3.z);\n\t\t}"),we=new mN("vec3 hashwithoutsine33(vec3 p3)\n\t\t{\n\t\t\tp3 = fract(p3 * vec3(.1031, .1030, .0973));\n\t\t\tp3 += dot(p3, p3.yxz+33.33);\n\t\t\treturn fract((p3.xxy + p3.yxx)*p3.zyx);\n\t\t}"),Se=new mN("float metric(in vec3 p)\n\t\t{\n\t\t\t// L2 \n\t\t\treturn length(p);\n\n\t\t\t// Chebyshev \n\t\t\t// vec3 a = abs(p);\n\t\t\t// return max(a.x, max(a.y, a.z));\n\t\t}"),_e=new mN("float smin( float a, float b, float k )\n\t\t{\n\t\t\tfloat h = smoothstep(0.0, 1.0, 0.5 + 0.5 * (b - a) / k);\n\t\t\tfloat correction = k * h * (1.0 - h);\n\t\t\treturn mix(b, a, h) - correction;\n\t\t}"),Ae=new mN("float smax( float a, float b, float k )\n\t\t{\n\t\t\tfloat h = smoothstep(1.0, 0.0, 0.5 + 0.5 * (a - b) / k);\n\t\t\tfloat correction = k * h * (1.0 - h);\n\t\t\treturn mix(a, b, h) + correction;\n\t\t}"),Ce=new mN("float remap(float value, float input_min, float input_max, float output_min, float output_max) {\n\t\t\t// Compute width of each interval\n\t\t\tfloat input_width = input_max - input_min;\n\t\t\tfloat output_width = output_max - output_min;\n\t\t\n\t\t\t// Convert input range into a 0-1 range \n\t\t\tfloat scaled = (value - input_min) / input_width;\n\t\t\n\t\t\t// Convert the 0-1 range into a value in output range\n\t\t\treturn output_min + (scaled * output_width);\n\t\t}"),Te=new mN('float voronoi(in vec3 x, in int style, in float smoothness, in float seed, in int quality) \n\t\t{\n\t\t\t// Integer and fractional parts of this point\'s coordinates\n\t\t\tivec3 p = ivec3(floor(x));\n\t\t\tvec3 f = fract(x);\n\n\t\t\t// Different variables that we will use to construct noise:\n\t\t\t//\n\t\t\t// f1: distance to the closest feature point\n\t\t\t// f2: distance to the second closest feature point\n\t\t\t// e: distance to the closest edge (cell boundary)\n\t\t\t//\n\t\t\t// We also compute "smooth" versions of all of the above quantites, essentially\n\t\t\t// replacing "hard" minimums with "smooth" minimums (described by IQ)\n\t\t\tfloat f1_smooth = 8.0;\n\t\t\tfloat f1 = 8.0;\n\t\t\tfloat f2_smooth = 8.0;\n\t\t\tfloat f2 = 8.0;\n\t\t\tfloat e_smooth = 8.0;\n\t\t\tfloat e = 8.0;\n\n\t\t\t// Variables stored from closest cell\n\t\t\tivec3 mb;\n\t\t\tvec3 mr; \n\n\t\t\tint steps = quality;\n\t\t\t\n\t\t\tfor (int x = -steps; x <= steps; x++) \n\t\t\tfor (int y = -steps; y <= steps; y++)\n\t\t\tfor (int z = -steps; z <= steps; z++)\n\t\t\t{\n\t\t\t\tivec3 b = ivec3(x, y, z);\n\t\t\t\tvec3 r = vec3(b) + hashwithoutsine33(vec3(p + b) + seed) - f;\n\t\t\t\tfloat d = length(r);\n\t\t\t\t\n\t\t\t\tf1_smooth = smin(d, f1_smooth, smoothness);\n\n\t\t\t\t// Store un-smoothed distances too \n\t\t\t\tif (d < f1) \n\t\t\t\t{\n\t\t\t\t\tf2 = f1;\n\t\t\t\t\tf1 = d;\n\n\t\t\t\t\tmb = ivec3(x, y, z);\n\t\t\t\t\tmr = r;\n\t\t\t\t} \n\t\t\t\telse if (d < f2) \n\t\t\t\t{\n\t\t\t\t\tf2 = d;\n\t\t\t\t}\n\t\t\t}\t\n\t\t\t\n\t\t\t// Second pass for edge distance  \n\t\t\t// skip for styles don\'t need\n\t\t\tif (style != 0 &&  style != 5 && style != 7)\n\t\t\tfor (int x = -steps; x <= steps; x++) \n\t\t\tfor (int y = -steps; y <= steps; y++)\n\t\t\tfor (int z = -steps; z <= steps; z++)\n\t\t\t{\n\t\t\t\t// Start search at the cell that contains the closest point to "x" (found in 1st pass)\n\t\t\t\tivec3 b = mb + ivec3(x, y, z);\n\t\t\t\tvec3 r = vec3(b) + hashwithoutsine33(vec3(p + b) + seed) - f;\n\t\t\t\tfloat d1 = dot(0.5 * (mr + r), (r - mr)); \t\t\t\t// IQ normalizes "r - mr" but that breaks things for the smooth version?\n\t\t\t\tfloat d2 = dot(0.5 * (mr + r), normalize(r - mr));\n\n\t\t\t\te_smooth = smin(d1, e_smooth, smoothness);\n\n\t\t\t\te = min(e, d2);\n\n\t\t\t\t// Also compute a smooth version of F2 in this pass\n\t\t\t\t{\n\t\t\t\t\tivec3 b = ivec3(x, y, z);\n\t\t\t\t\tif (b != mb) \n\t\t\t\t\t{\n\t\t\t\t\t\tvec3 r = vec3(b) + hashwithoutsine33(vec3(p + b) + seed) - f;\n\t\t\t\t\t\tfloat d = length(r);\n\n\t\t\t\t\t\tf2_smooth = smin(d, f2_smooth, smoothness);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Different visualization modes \n\t\t\tif (style == 0) \n\t\t\t{\n\t\t\t\treturn f1_smooth;\n\t\t\t}\n\t\t\tif (style == 1) \n\t\t\t{\n\t\t\t\treturn f2_smooth;\n\t\t\t}\n\t\t\tif (style == 2) \n\t\t\t{\n\t\t\t\treturn f2_smooth - f1_smooth;\n\t\t\t\t\n\t\t\t\t// "Pebbles" also cool\n\t\t\t\t//return step(0.2, f2_smooth - f1_smooth);\n\t\t\t}\n\t\t\tif (style == 3) \n\t\t\t{\n\t\t\t\t// This one is really good for rock / stone effects\n\t\t\t\tfloat a = f1; \n\t\t\t\tfloat b = f2;\n\t\t\t\tfloat k = 3.0;\n\t\t\t\tfloat h = max(k - abs(a - b), 0.0) / k;\n\t\t\t\tfloat final = min(a, b) - h * h * k * (1.0 / 4.0);\n\t\t\t\treturn final;\n\t\t\t}\n\t\t\tif (style == 4) \n\t\t\t{\n\t\t\t\t// Some random adjustments to make this style stand out more \n\t\t\t\treturn exp(5.0 * e_smooth);\n\t\t\t}\n\t\t\tif (style == 5) \n\t\t\t{\n\t\t\t\treturn pow(f1_smooth, 3.0);\n\t\t\t}\n\t\t\tif (style == 6) \n\t\t\t{\t\t\t\t\n\t\t\t\tconst float eps = 0.0125;\n\n\t\t\t\t// Thicker lines as the user increases the smoothness slider\n\t\t\t\tfloat thickness = smoothness * 0.25 + eps;\n\n\t\t\t\t// Blurrier lines as the user increases the smoothness slider\n\t\t\t\tfloat blur = pow(smoothness, 3.0) * 0.25 + eps;\n\n\t\t\t\treturn smoothstep(\n\t\t\t\t\tthickness - thickness * blur, \n\t\t\t\t\tthickness + thickness * blur, \n\t\t\t\t\te\n\t\t\t\t);\n\t\t\t}\n\t\t\tif (style == 7) \n\t\t\t{\n\t\t\t\treturn hashwithoutsine13(vec3(p + mb) + seed);\n\t\t\t}\n\t\t}\n\t',[ve,we,Se,_e,Ae,Ce]);return{simplexFast:O,simplexPrecise:R,simplexFractal:z,simplexAshima:Y,fbm:ce,perlin:fe,voronoi:Te}}();var QU=class extends QF{constructor(E,O,R,z,V,j,Y,ee,se,he,ce,ue,fe,ve,we,Se,_e,Ae,Ce){super("v3");this.nodeType="Noise";this.scale=E,this.size=O,this.move=R,this.fA=z,this.fB=V,this.distortion=j,this.colorA=Y,this.colorB=ee,this.colorC=se,this.colorD=he,this.noiseType=ue,this.voronoiStyle=ve,this.highCut=we,this.lowCut=Se,this.smoothness=_e,this.seed=Ae,this.quality=Ce,this.isMask=fe,this.alpha=ce,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(E,O,R,z,V){E.require("uv"),E.requires.uv=[!0],E.addFragmentVariable(this.calpha,"float");let j=["simplexFast","simplexFractal","simplexAshima","fbm","perlin","voronoi"][this.noiseType.value],Y=j=="voronoi"?`\n\t\tfloat v = ${j}(st + move, voronoiStyle, smoothness, seed, quality);\n\n\t\t// Apply clipping to colors\n\t\tv = remap(v, lowCut, highCut, 0.0, 1.0);\n\t\tv = smax(v, 0.0, smoothness * 0.25);\n\t\tv = smin(v, 1.0, smoothness * 0.25);\n\n\t\t// Note that the voronoi mode only uses colors "A" and "C" from the UI \n\t\tvec4 color = mix(colorA, colorC, v); \n\t\t`:`\n\t\tvec3 q = vec3(${j}(st),\n\t\t\t\t\t   ${j}(st + vec3(1.0)),\n\t\t\t\t\t   ${j}(st + vec3(1.0)));\n\t\tvec3 r = vec3(${j}(st + vec3(distortion, 1.0) * q + vec3(fA, 1.0) + move),\n\t\t\t\t\t  ${j}(st + vec3(distortion, 1.0) * q + vec3(fB, 1.0) + move), \n\t\t\t\t\t  ${j}(st * q));\n\t\tfloat f = ${j}(st + r);\n\t\tvec4 color;\n\t\tcolor = mix(colorA, colorB, clamp((f * f) * 4.0, 0.0, 1.0));\n\t\tcolor = mix(color, colorC, clamp(length(q), 0.0, 1.0));\n\t\tcolor = mix(color, colorD, clamp(length(r.x), 0.0, 1.0));\n\t\t`,ee=new mN(`vec3 ${j}customNoise(float scale, vec3 size, float move, vec2 fA, vec2 fB, vec2 distortion, vec4 colorA, vec4 colorB, vec4 colorC, vec4 colorD, int voronoiStyle, float highCut, float lowCut, float smoothness, float seed, int quality, bool isMask, float mask, float alpha, out float calpha) \n\t\t\t{\n                // Prevent scale of zero \n\t\t\t\tscale = max(abs(scale), 0.001);\n\n\t\t\t\tvec3 st = position / size;\n\t\t\t\tst /= scale;\n\n\t\t\t\t${Y}\n\n\t\t\t\tfloat lalpha = alpha * color.a * mask;\n\t\t\t\tcalpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));\n\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\n\t\t\t\treturn clamp(color, 0.0, 1.0).rgb;\n\t\t\t}`,[YU.simplexFast,YU.simplexFractal,YU.simplexAshima,YU.fbm,YU.perlin,YU.voronoi]),se=E.include(ee),he=[];return he.push(this.scale.build(E,"f")),he.push(this.size.build(E,"v3")),he.push(this.move.build(E,"f")),he.push(this.fA.build(E,"v2")),he.push(this.fB.build(E,"v2")),he.push(this.distortion.build(E,"v2")),he.push(this.colorA.build(E,"v4")),he.push(this.colorB.build(E,"v4")),he.push(this.colorC.build(E,"v4")),he.push(this.colorD.build(E,"v4")),he.push(this.voronoiStyle.build(E,"i")),he.push(this.highCut.build(E,"f")),he.push(this.lowCut.build(E,"f")),he.push(this.smoothness.build(E,"f")),he.push(this.seed.build(E,"f")),he.push(this.quality.build(E,"i")),he.push(this.isMask.build(E,"b")),he.push(this.mask?`luminance(${this.mask.flow(E,"v3").result})`:"1.0"),he.push(this.alpha.build(E,"f")),he.push(this.calpha),E.format(se+"("+he.join(",")+")",this.getType(E),O)}};QU.numOctaves=5;var ZU=class extends QF{constructor(E,O,R,z,V,j,Y,ee,se,he,ce,ue,fe,ve,we,Se){super("v3");this.nodeType="Outline";this.firstTime=!0,this.outlineColor=E,this.contourColor=O,this.outlineWidth=R,this.contourWidth=z,this.contourThreshold=V,this.outlineThreshold=j,this.contourFrequency=Y,this.outlineSmoothing=ee,this.contourDirection=se,this.positionalLines=he,this.compensation=ce,this.resolution=ue,this.normalMap=fe,this.depthMap=ve,this.pixelRatio=we,this.alpha=Se,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(E,O){let R=`g${this.uuid.toString().replace(/-/g,"")}`;if(E.require("vWorldViewDir"),E.require("worldNormal"),E.extensions.derivatives=!0,this.compensation.value&&E.define("OUTLINE_COMPENSATION",`${R}_offset`),this.firstTime){let O=this.outlineWidth.build(E,"f"),z=this.resolution.build(E,"v2"),V=this.compensation.build(E,"b"),j=this.pixelRatio.build(E,"f");E.addVertexParsVariable("randomColor","attribute vec3"),E.addVertexParsVariable("extrudeNormal","attribute vec3"),E.addVertexParsVariable(O,"uniform float"),E.addVertexParsVariable(z,"uniform vec2"),E.addVertexParsVariable(V,"uniform bool"),E.addVertexParsVariable(j,"uniform float"),E.addVertexParsVariable("vID","flat out float"),E.addFragmentParsVariable("vID","flat in float"),E.addVertexFinalCode(`\n                vID = randomColor.r;\n                vec2 ${R}_offset = vec2(0.0);\n                if (${V}) {\n                    vec4 ${R}_clipPosition = projectionMatrix * (modelViewMatrix * vec4(transformed, 1.0));\n                    // NOTE: For certain shapes, like spheres, we get incorrect extrusion when the\n                    // normals face the camera directly. So we hackily fix this by offsetting the normal\n                    // by a tiny amount.\n                    vec3 ${R}_clipNormal = mat3(projectionMatrix) * (mat3(modelViewMatrix) * extrudeNormal) + 0.0000001;\n                    ${R}_offset = normalize(${R}_clipNormal.xy) / ${z} * (${O} / 2.0) * ${R}_clipPosition.w * 2.0 * ${j};\n                    ${R}_clipPosition.xy += ${R}_offset;\n                    // TODO(MAX): To handle multiple outline layers, we only want to extrude\n                    // if this offset is the biggest of all the potential offsets\n                    gl_Position = ${R}_clipPosition;\n                }\n            `)}if(E.isShader("fragment")){E.require("uv"),E.requires.uv=[!0],E.addFragmentVariable(this.calpha,"float");let R=E.include(ZU.Nodes.outline),z=[];return z.push(this.outlineColor.build(E,"c")),z.push(this.contourColor.build(E,"c")),z.push(this.outlineWidth.build(E,"f")),z.push(this.contourWidth.build(E,"f")),z.push(this.contourThreshold.build(E,"f")),z.push(this.outlineThreshold.build(E,"f")),z.push(this.contourFrequency.build(E,"f")),z.push(this.outlineSmoothing.build(E,"f")),z.push(this.contourDirection.build(E,"v3")),z.push(this.positionalLines.build(E,"b")),z.push(this.resolution.build(E,"v2")),z.push(this.normalMap.getTexture(E,"t")),z.push(this.depthMap.getTexture(E,"t")),z.push(this.pixelRatio.build(E,"f")),z.push(this.compensation.build(E,"b")),z.push(this.mask?`luminance(${this.mask.flow(E,"v3").result})`:"1.0"),z.push(this.alpha.build(E,"f")),z.push(this.calpha),this.firstTime=!this.firstTime,E.format(R+"("+z.join(",")+")",this.getType(E),O)}return console.warn("OutlineNode is not compatible with "+E.shader+" shader."),""}},KU=ZU;KU.Nodes=function(){let E=new mN("\nfloat sobelSample(sampler2D t, sampler2D d, vec2 uv, vec2 resolution, float outlineWidth, float pixelRatio)\n{\n    vec2 halton = haltonSequence[frameIndex];\n    float temporalOffset = getNoiseInterleavedGradient(gl_FragCoord.xy + halton);\n    float temporalAngle  = temporalOffset * PI2;\n\n    vec2 texelSize = (vec2(1.0) / resolution);\n    vec2 offsetSize = texelSize * outlineWidth * pixelRatio;\n\n    vec2 uvSamples[9];\n    vec4 normalSamples[9];\n\n\tuvSamples[0] = uv + vec2( -offsetSize.x, -offsetSize.y) + (vogelDiskSample(0, 9, temporalAngle) * texelSize);\n\tuvSamples[1] = uv + vec2(0.0, -offsetSize.y) + (vogelDiskSample(1, 9, temporalAngle) * texelSize);\n\tuvSamples[2] = uv + vec2(  offsetSize.x, -offsetSize.y) + (vogelDiskSample(2, 9, temporalAngle) * texelSize);\n\tuvSamples[3] = uv + vec2( -offsetSize.x, 0.0) + (vogelDiskSample(3, 9, temporalAngle) * texelSize);\n\tuvSamples[4] = uv;\n\tuvSamples[5] = uv + vec2(  offsetSize.x, 0.0) + (vogelDiskSample(5, 9, temporalAngle) * texelSize);\n\tuvSamples[6] = uv + vec2( -offsetSize.x, offsetSize.y) + (vogelDiskSample(6, 9, temporalAngle) * texelSize);\n\tuvSamples[7] = uv + vec2(0.0, offsetSize.y) + (vogelDiskSample(7, 9, temporalAngle) * texelSize);\n\tuvSamples[8] = uv + vec2(  offsetSize.x, offsetSize.y) + (vogelDiskSample(8, 9, temporalAngle) * texelSize);\n\n\n    normalSamples[0] = texture2D(t, uvSamples[0]);\n    normalSamples[1] = texture2D(t, uvSamples[1]);\n    normalSamples[2] = texture2D(t, uvSamples[2]);\n    normalSamples[3] = texture2D(t, uvSamples[3]);\n    normalSamples[4] = texture2D(t, uvSamples[4]);\n    normalSamples[5] = texture2D(t, uvSamples[5]);\n    normalSamples[6] = texture2D(t, uvSamples[6]);\n    normalSamples[7] = texture2D(t, uvSamples[7]);\n    normalSamples[8] = texture2D(t, uvSamples[8]);\n\n    float depthBias = 0.0001;\n    // TODO(MAX): Can we somehow reduce the number of conditionals here with MATH?!\n    if (normalSamples[0].a != vID && normalSamples[0].a != 0.0) {\n        float depthAtSample = texture2D(d, uvSamples[0]).r + depthBias;\n        if (gl_FragCoord.z > depthAtSample) {\n           return 0.0;\n        }\n    }\n\n    if (normalSamples[1].a != vID && normalSamples[1].a != 0.0) {\n        float depthAtSample = texture2D(d, uvSamples[1]).r + depthBias;\n        if (gl_FragCoord.z > depthAtSample) {\n           return 0.0;\n        }\n    }\n\n    if (normalSamples[2].a != vID && normalSamples[2].a != 0.0) {\n        float depthAtSample = texture2D(d, uvSamples[2]).r + depthBias;\n        if (gl_FragCoord.z > depthAtSample) {\n           return 0.0;\n        }\n    }\n\n    if (normalSamples[3].a != vID && normalSamples[3].a != 0.0) {\n        float depthAtSample = texture2D(d, uvSamples[3]).r + depthBias;\n        if (gl_FragCoord.z > depthAtSample) {\n           return 0.0;\n        }\n    }\n\n\n    if (normalSamples[4].a != vID && normalSamples[4].a != 0.0) {\n        float depthAtSample = texture2D(d, uvSamples[4]).r + depthBias;\n        if (gl_FragCoord.z > depthAtSample) {\n           return 0.0;\n        }\n    }\n\n    if (normalSamples[5].a != vID && normalSamples[5].a != 0.0) {\n        float depthAtSample = texture2D(d, uvSamples[5]).r + depthBias;\n        if (gl_FragCoord.z > depthAtSample) {\n           return 0.0;\n        }\n    }\n\n    if (normalSamples[6].a != vID && normalSamples[6].a != 0.0) {\n        float depthAtSample = texture2D(d, uvSamples[6]).r + depthBias;\n        if (gl_FragCoord.z > depthAtSample) {\n           return 0.0;\n        }\n    }\n\n    if (normalSamples[7].a != vID && normalSamples[7].a != 0.0) {\n        float depthAtSample = texture2D(d, uvSamples[7]).r + depthBias;\n        if (gl_FragCoord.z > depthAtSample) {\n           return 0.0;\n        }\n    }\n\n    if (normalSamples[8].a != vID && normalSamples[8].a != 0.0) {\n        float depthAtSample = texture2D(d, uvSamples[8]).r + depthBias;\n        if (gl_FragCoord.z > depthAtSample) {\n           return 0.0;\n        }\n    }\n\n    vec3 sobel_edge_h = normalSamples[2].rgb + (2.0*normalSamples[5].rgb) + normalSamples[8].rgb - (normalSamples[0].rgb + (2.0*normalSamples[3].rgb) + normalSamples[6].rgb);\n  \tvec3 sobel_edge_v = normalSamples[0].rgb + (2.0*normalSamples[1].rgb) + normalSamples[2].rgb - (normalSamples[6].rgb + (2.0*normalSamples[7].rgb) + normalSamples[8].rgb);\n\n    float edgeNormal = sqrt(dot(sobel_edge_h, sobel_edge_h) + dot(sobel_edge_v, sobel_edge_v));\n    return edgeNormal;\n}\n");return{outline:new mN("vec3 outline(vec3 outlineColor, vec3 contourColor, float outlineWidth, float contourWidth, float outlineThreshold, float contourThreshold, float outlineSmoothing, float contourFrequency, vec3 contourDirection, bool positionalLines, vec2 resolution, sampler2D normalMap, sampler2D depthMap, float pixelRatio, bool compensation, float mask, float alpha, out float calpha) {\n                vec3 result = outlineColor;\n                float resultAlpha = 0.0;\n\n                vec3 N = normalize(vWNormal);\n                vec2 nuv = (gl_FragCoord.xy / resolution);\n                float sobelSample = compensation ? sobelSample(normalMap, depthMap, nuv, resolution, outlineWidth / 2., pixelRatio) : sobelSample(normalMap, depthMap, nuv, resolution, outlineWidth, pixelRatio);\n                resultAlpha = smoothstep(outlineThreshold - outlineSmoothing, outlineThreshold + outlineSmoothing, sobelSample);\n\n                //resultAlpha = 1.0;\n                //result = vec3(sobelSample);\n\n                float t = 1.0 - contourThreshold;\n                if(positionalLines) {\n                    vec3 NDir = position * contourDirection;\n                    float NT = NDir.x + NDir.y + NDir.z;\n                    float f  = fract(NT * contourFrequency * 0.01);\n                    float df = fwidth(NT * contourFrequency);\n\n                    float g = smoothstep(df * (contourWidth * 0.01), df * (contourWidth * 0.01 * 2.0), f);\n                    if (g < 1.0 && resultAlpha == 0.0) {\n                        result = contourColor;\n                        resultAlpha = 1.0;\n                    }\n                 }\n                 else {\n                    vec3 NDir = N * contourDirection;\n                    float NT = NDir.x + NDir.y + NDir.z;\n                    float df = fwidth(NT * contourThreshold);\n                    float f = sin(NT * 1.0 * contourFrequency);\n                    float g = smoothstep(0.0, df * contourWidth, 1.0 - f);\n\n                    if (df > (t * 0.5) && g < 1.0 && resultAlpha == 0.0) {\n                        result = contourColor;\n                        resultAlpha = 1.0 - g;\n                    }\n                 }\n\n                 float lalpha = alpha * resultAlpha * mask;\n                 calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );\n                 accumAlpha += ( 1.0 - accumAlpha ) * lalpha;\n\t\t\t\t \n                 return result;\n             }",[E])}}();var JU=class extends QF{constructor(E,O,R,z,V,j,Y,ee,se,he,ce,ue,fe,ve,we,Se,_e,Ae){super("v3");this.nodeType="Pattern";this.style=E,this.projection=O,this.axis=R,this.blending=z,this.offset=V,this.colorA=j,this.colorB=Y,this.frequency=ee,this.size=se,this.variation=he,this.smoothness=ce,this.zigzag=ue,this.rotation=fe,this.vertical=ve,this.horizontal=we,this.sides=Se,this.isMask=Ae,this.alpha=_e,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(E,O){if(E.isShader("fragment")){E.require("position"),E.require("uv"),E.requires.uv=[!0],E.require("normal"),E.requires.normal=!0,E.addFragmentVariable(this.calpha,"float");let R;switch(this.style.value){case 0:R="circle";break;case 1:R="ring";break;case 2:R="polygon";break;case 3:R="xcross";break;case 4:R="diamond";break;case 5:R="checkerboard";break;case 6:R="line";break;case 7:R="wave";break;default:R="circle";break}let z=`g${this.uuid.toString().replace(/-/g,"")}`,V=new mN("float hashwithoutsine12(vec2 p)\n\t\t\t\t{\n\t\t\t\t\tvec3 p3 = fract(vec3(p.xyx) * .1031);\n\t\t\t\t\tp3 += dot(p3, p3.yzx + 33.33);\n\t\t\t\t\treturn fract((p3.x + p3.y) * p3.z);\n\t\t\t\t}"),j=new mN("vec2 rotate_uv(in vec2 uv, float a, bool repeat) \n\t\t\t\t{\n\t\t\t\t\tconst float mid = 0.5;\n\t\t\t\t\tfloat radians = a * (PI / 180.0);\n\t\t\t\t\tvec2 rotated = vec2(\n\t\t\t\t\t\tcos(radians) * (uv.x - mid) + sin(radians) * (uv.y - mid) + mid,\n\t\t\t\t\t\tcos(radians) * (uv.y - mid) - sin(radians) * (uv.x - mid) + mid\n\t\t\t\t\t);\n\t\t\t\t\treturn repeat ? fract(rotated): rotated;\n\t\t\t\t}"),Y="";if(this.projection.value===4){let E=this.style.value===2?`${R}(uv0, frequency, size, variation, smoothness_remapped, zigzag, rotation, sides)`:`${R}(uv0, frequency, size, variation, smoothness_remapped, zigzag, rotation)`,O=this.style.value===2?`${R}(uv1, frequency, size, variation, smoothness_remapped, zigzag, rotation, sides)`:`${R}(uv1, frequency, size, variation, smoothness_remapped, zigzag, rotation)`,z=this.style.value===2?`${R}(uv2, frequency, size, variation, smoothness_remapped, zigzag, rotation, sides)`:`${R}(uv2, frequency, size, variation, smoothness_remapped, zigzag, rotation)`;Y=`\n\t\t\t\tvec3 p = position;\n\t\t\t\tfloat factor = 0.0125;\n\t\t\t\tvec2 uv0 = fract(p.xy * factor);\n\t\t\t\tvec2 uv1 = fract(p.zy * factor);\n\t\t\t\tvec2 uv2 = fract(p.xz * factor);\n\t\t\t\t\n\t\t\t\tuv0 = rotate_uv(uv0 + offset, rotation, true);\n\t\t\t\tuv1 = rotate_uv(uv1 + offset, rotation, true);\n\t\t\t\tuv2 = rotate_uv(uv2 + offset, rotation, true);\n\t\n\t\t\t\tfloat d0 = ${E};\n\t\t\t\tfloat d1 = ${O};\n\t\t\t\tfloat d2 = ${z};\n\t\t\t\t\n\t\t\t\t// Range from 3 to 128 seems to be good\n\t\t\t\tfloat exponent = (1.0 - blending) * 125.0 + 3.0;\n\n\t\t\t\tvec3 n = vObjectNormal;\n\t\t\t\tvec3 weights = abs(normalize(n));\n\t\t\t\tweights = pow(weights, vec3(exponent));\n\t\t\t\tweights /= dot(weights, vec3(1.0));\n\t\t\t\td0 *= weights.z;\n\t\t\t\td1 *= weights.x;\n\t\t\t\td2 *= weights.y;\n\t\t\t\tfloat draw = d0 + d1 + d2;\n\t\n\t\t\t\tvec2 custom_uv = uv0 * weights.z + uv1 * weights.x + uv2 * weights.y;\n\t\t\t\t`}else{let E=this.style.value===2?`${R}(custom_uv, frequency, size, variation, smoothness_remapped, zigzag, rotation, sides)`:`${R}(custom_uv, frequency, size, variation, smoothness_remapped, zigzag, rotation)`,O="";this.axis.value===0?O="float radius = length(p);\n\t\t\t\t\tfloat theta = atan(p.y, p.z);\n\t\t\t\t\tfloat phi = acos(p.x / radius);":this.axis.value===1?O="float radius = length(p);\n\t\t\t\t\tfloat theta = atan(p.x, p.z);\n\t\t\t\t\tfloat phi = acos(p.y / radius);":(this.axis.value,O="float radius = length(p);\n\t\t\t\t\tfloat theta = atan(p.y, p.x);\n\t\t\t\t\tfloat phi = acos(p.z / radius);");let z="";switch(this.projection.value){case 0:z="custom_uv = vUv.st;";break;case 1:break;case 2:z=`\n\t\t\t\t\t\t\tvec3 p = position;\n\t\t\t\t\t\t\t${O}\n\t\t\t\t\t\t\tcustom_uv = vec2(theta, phi);\n\t\t\t\t\t\t\tcustom_uv /= PI;\n\t\t\t\t\t\t\t`;break;case 3:break;default:break}Y=`\n\t\t\t\tvec2 custom_uv;\n\t\t\t\t${z}\n\t\n\t\t\t\tcustom_uv += offset;\n\t\t\t\tcustom_uv = fract(custom_uv);\n\t\t\t\tcustom_uv = rotate_uv(custom_uv, rotation, true);\n\t\n\t\t\t\tfloat draw = ${E};\n\t\t\t\t`}let ee=new mN(`vec3 ${z}_pattern(vec3 normal, float blending, int style, vec2 offset, vec4 colorA, vec4 colorB, vec2 frequency, float size, float variation, float smoothness, float zigzag, float rotation, vec2 vertical, vec2 horizontal, int sides, bool isMask, float mask, float alpha, out float calpha) {\n\t\t\t\t\tconst float TWO_PI = PI * 2.0;\n\t\t\t\t\tfloat smoothness_remapped = pow(smoothness, 5.0);\t\n\n\t\t\t\t\t${Y}\n\n\t\t\t\t\t// Construct final output color\n\t\t\t\t\tvec4 color = mix(colorA, colorB, draw);\n\t\t\t\t\tcolor.a = clamp(color.a, 0.0, 1.0);\n\n\t\t\t\t\t// Apply cuts\n\t\t\t\t\tcolor.a *= \n\t\t\t\t\t\tstep(vertical.x, custom_uv.y) * \n\t\t\t\t\t\tstep(custom_uv.y, vertical.y);\n\t\t\t\t\tcolor.a *= \n\t\t\t\t\t\tstep(horizontal.x, abs(custom_uv.x)) * \n\t\t\t\t\t\tstep(abs(custom_uv.x), horizontal.y);\n\n\t\t\t\t\t// Accumulate alpha \n\t\t\t\t\tfloat lalpha = alpha * clamp(color.a, 0.0, 1.0) * mask;\n\t\t\t\t\tcalpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));\n\t\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\n\t\t\t\t\treturn clamp(color, 0.0, 1.0).rgb;\n\t\t\t\t}`,[j,V,JU.DrawFunctions.circle,JU.DrawFunctions.ring,JU.DrawFunctions.polygon,JU.DrawFunctions.cross,JU.DrawFunctions.diamond,JU.DrawFunctions.checkerboard,JU.DrawFunctions.line,JU.DrawFunctions.wave]),se=E.include(ee),he=[];return he.push("normal"),he.push(this.blending.build(E,"f")),he.push(this.style.build(E,"i")),he.push(this.offset.build(E,"v2")),he.push(this.colorA.build(E,"v4")),he.push(this.colorB.build(E,"v4")),he.push(this.frequency.build(E,"v2")),he.push(this.size.build(E,"f")),he.push(this.variation.build(E,"f")),he.push(this.smoothness.build(E,"f")),he.push(this.zigzag.build(E,"f")),he.push(this.rotation.build(E,"f")),he.push(this.vertical.build(E,"v2")),he.push(this.horizontal.build(E,"v2")),he.push(this.sides.build(E,"i")),he.push(this.isMask.build(E,"b")),he.push(this.mask?`luminance(${this.mask.flow(E,"v3").result})`:"1.0"),he.push(this.alpha.build(E,"f")),he.push(this.calpha),E.format(se+"("+he.join(",")+")",this.getType(E),O)}return console.warn("PatterNode is not compatible with "+E.shader+" shader."),E.format("vec3(0.0)",this.getType(E),O)}},$U=JU;$U.DrawFunctions=function(){let E=new mN("float hashwithoutsine12(vec2 p) {\n\t\t\t\tvec3 p3 = fract(vec3(p.xyx) * 0.1031);\n\t\t\t\tp3 += dot(p3, p3.yzx + 33.33);\n\t\t\t\treturn fract((p3.x + p3.y) * p3.z);\n\t\t\t}"),O=new mN("vec2 tile_and_center(in vec2 uv, in vec2 frequency, in float variation, in float zigzag, in float rotation) {\n                // Create tiles in UV-space\n                uv *= frequency;\n\n                // Integer coords\n                vec2 i = floor(uv);\n\n                // Offset every other row based on zigzag param, then compute fractional coords\n                float row_offset = mod(i.y, 2.0);\n                uv.x += row_offset * zigzag;\n                vec2 f = fract(uv);\n\n\t\t\t\t// Rotate the tile itself:\n\t\t\t\t// const float mid = 0.5;\n\t\t\t\t// f = vec2(\n\t\t\t\t// \tcos(rotation) * (f.x - mid) + sin(rotation) * (f.y - mid) + mid,\n\t\t\t\t// \tcos(rotation) * (f.y - mid) - sin(rotation) * (f.x - mid) + mid\n\t\t\t\t// );\n\t\t\t\t// f = fract(f);\n\n                f = f * 2.0 - 1.0;\n\n\t\t\t\t// Recompute integer coords after shifting - then, random value per tile \n\t\t\t\ti = floor(uv);\n\t\t\t\tfloat rand = (hashwithoutsine12(i) * 5.0 + 1.0);\n\t\t\t\tfloat jitter = mix(1.0, rand, variation);\n\t\t\t\tf *= jitter;\n\n                return f;\n            }",[E]),R=new mN("float circle(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {\n                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);\n                return smoothstep(\n                    -smoothness, \n                     smoothness, \n                     length(f) - size\n                );\n            }",[O]),z=new mN("float ring(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {\n                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);\n\n\t\t\t\tfloat d = length(f);\n                const float inner_width = 0.5;\n\n                float outer = smoothstep(-smoothness, smoothness, d - size);\n                float inner = smoothstep(-smoothness, smoothness, d - size * inner_width);\n\t\t\t\treturn outer + (1.0 - inner);   \n            }",[O]),V=new mN("float sdf_ngon(in vec2 p, in float r, in int n) {\n                float an = (PI * 2.0) / float(n);\n                float he = r * tan(0.5 * an);\n                \n                // Rotate to first sector\n                p = -p.yx; \n                float bn = an * floor((atan(p.y, p.x) + 0.5 * an) / an);\n                vec2  cs = vec2(cos(bn), sin(bn));\n                p = mat2(cs.x, -cs.y, cs.y, cs.x)*p;\n            \n                // Side of polygon\n                return length(p - vec2(r, clamp(p.y, -he, he))) * sign(p.x - r);\n            }\n            \n            float polygon(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation, in int sides) {\n                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);\n                return smoothstep(-smoothness, smoothness, sdf_ngon(f, size, sides));\n            }",[O]),j=new mN("float sdf_cross(in vec2 p, in vec2 b, float r ) {\n                p = abs(p); \n\t\t\t\tp = (p.y > p.x) ? p.yx : p.xy;\n                vec2  q = p - b;\n                float k = max(q.y, q.x);\n                vec2  w = (k > 0.0) ? q : vec2(b.y - p.x, -k);\n                return sign(k) * length(max(w, 0.0)) + r;\n            }\n            \n            // Avoid namespace conflicts \n            float xcross(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {\n                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);\n                return smoothstep(-smoothness, smoothness, sdf_cross(f, vec2(size, size * 0.25), smoothness));\n            }",[O]),Y=new mN("float ndot(vec2 a, vec2 b) { \n                return a.x*b.x - a.y*b.y; \n            }\n            \n            float sdf_diamond(in vec2 p, in vec2 b) {\n                p = abs(p);\n                float h = clamp(ndot(b - 2.0 * p, b) / dot(b, b), -1.0, 1.0);\n                float d = length(p - 0.5 * b * vec2(1.0 - h, 1.0 + h));\n                return d * sign(p.x * b.y + p.y * b.x - b.x * b.y);\n            }\n\n            float diamond(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {\n                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);\n\t            return smoothstep(-smoothness, smoothness, sdf_diamond(f, vec2(size)));\n            }",[O]),ee=new mN("float checkerboard(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {\n                uv *= frequency;\n                vec2 i = floor(uv);\n\n                float offset = mod(i.y, 2.0);\n\n                uv.x += offset + zigzag * offset;\n                float x = floor(uv.x);\n                \n                return mod(x, 2.0);\n            }"),se=new mN("float line(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {\n                vec2 f = tile_and_center(uv, frequency, 0.0, zigzag, rotation);\n\t\t\t\t\n\t\t\t\t// Different approach for variation param here\n\t\t\t\tfloat row = floor(uv * frequency).y;\n\t\t\t\tfloat rand = hashwithoutsine12(vec2(row));\n\t\t\t\tfloat s = mix(size, size * rand, variation);\n\n\t\t\t\treturn smoothstep(\n\t\t\t\t\ts - smoothness, \n\t\t\t\t\ts + smoothness, \n\t\t\t\t\tabs(f.y)\n\t\t\t\t);\n            }",[O]),he=new mN("// Uses bisection \n            float udf_cos(in vec2 p, in float a, in float b, in float c, in float d) {\n                // Convert all data to a primitive cosine wave\n                p = c * (p - vec2(d, a));\n                \n                const float TWO_PI = PI * 2.0;\n\n                // Reduce to principal half cycle\n                p.x = mod(p.x, TWO_PI); \n                if (p.x > PI) {\n                    p.x = TWO_PI - p.x;\n                }\n            \n                // Find zero of derivative (minimize distance)\n                float xa = 0.0;\n                float xb = TWO_PI;\n\n                // 24 bit precision\n                for (int i = 0; i < 24; i++) {\n                    float x = 0.5 * (xa + xb);\n                    float y = x - p.x + b * c * sin(x) * (p.y - b * c * cos(x));\n                    if (y < 0.0) xa = x; \n                    else xb = x;\n                }\n                float x = 0.5 * (xa + xb);\n                \n                // Compute distance    \n                vec2 q = vec2(x, b * c * cos(x));\n                return length(p - q) / c;\n            }\n\n            float wave(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {\n                float repeat = frequency.x;\n                uv *= repeat;\n                vec2 i = floor(uv);\n                float row_offset = mod(i.y, 2.0);\n                uv.x += row_offset * zigzag;\n                vec2 f = vec2(uv.x, fract(uv.y));\n\n                // Generalized cosine: y(x) = a + b * cos(cx + d)\n                const float amplitude = 0.125;\n                float wave_frequency = frequency.y * 0.1;\n                float distance_estimate = udf_cos(f, 0.50, amplitude, wave_frequency * (2.0 * PI), 0.0);\n\n\t\t\t\t// Different approach for variation param here\n\t\t\t\tfloat rand = hashwithoutsine12(vec2(i.y));\n\t\t\t\tfloat s = mix(size, size * rand, variation);\n\n                return smoothstep(-smoothness, smoothness, distance_estimate - s * 0.5);\n            }");return{tileAndCenter:O,circle:R,ring:z,polygon:V,cross:j,diamond:Y,checkerboard:ee,line:se,wave:he}}();var ek=class extends QF{constructor(E,O,R,z,V,j,Y,ee){super("v3");this.nodeType="Rainbow";this.filmThickness=E,this.movement=O,this.wavelengths=R,this.noiseStrength=z,this.noiseScale=V,this.offset=j,this.isMask=ee,this.alpha=Y,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(E,O){if(E.require("vWorldViewDir"),E.require("worldNormal"),E.isShader("fragment")){E.require("uv"),E.requires.uv=[!0],E.addFragmentVariable(this.calpha,"float");let R=E.include(ek.Nodes.rainbow),z=[];return z.push(this.filmThickness.build(E,"f")),z.push(this.movement.build(E,"f")),z.push(this.wavelengths.build(E,"v3")),z.push(this.noiseStrength.build(E,"f")),z.push(this.noiseScale.build(E,"f")),z.push(this.offset.build(E,"v3")),z.push(this.isMask.build(E,"b")),z.push(this.mask?`luminance(${this.mask.flow(E,"v3").result})`:"1.0"),z.push(this.alpha.build(E,"f")),z.push(this.calpha),E.format(R+"("+z.join(",")+")",this.getType(E),O)}return console.warn("RainbowNode is not compatible with "+E.shader+" shader."),E.format("vec3( 0.0 )",this.getType(E),O)}},tk=ek;tk.Nodes=function(){let E=new mN("vec3 attenuation(vec3 wavelengths, float filmThickness, float movement, float noiseStrength, float noiseScale, vec3 offset) {\n\t\t\t\tfloat f = 0.0;\n\t\t\t\t\n\t\t\t\tif (noiseStrength != 0.0) {\n\t\t\t\t\tvec3 st = position / noiseScale;\n\t\t\t\t\tfloat noise = simplexFast(1.6 * st + vec3(1.8, 1.5, 1.9) * simplexFast(st) + vec3(1.7, 9.2, 1.0));\n\t\t\t\t\tf = noise * noiseStrength;\n\t\t\t\t}\n\n\t\t\t\tvec3 waves = wavelengths * vec3(1.0, 0.8, 0.6) + 1.0;\n\t\t\t\tfloat angle = dot(normalize(vWorldViewDir + (offset * -0.001)), normalize(vWNormal));\n\n\t\t\t\tmediump vec3 color = cos((((filmThickness + f) / waves) * angle) + movement);\n\t\t\t\treturn .5 + .5 * color;\n\t\t\t }",[YU.simplexFast]);return{rainbow:new mN("vec3 rainbow(float filmThickness, float movement, vec3 wavelengths, float noiseStrength, float noiseScale, vec3 offset, bool isMask, float mask, float alpha, out float calpha) {\n\t\t\t\tmediump vec3 res = clamp(attenuation(wavelengths, filmThickness, movement, noiseStrength, noiseScale, offset), 0.0, 2.0);\n\n\t\t\t\tfloat rainbowContribution = clamp(res.r + res.g + res.b, 0.0, 1.0);\n\n\t\t\t\tfloat lalpha = alpha * rainbowContribution * mask;\n\t\t\t\tcalpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));\n\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\n\t\t\t\treturn res;\n\t\t\t }",[E])}}();var ik=class extends QF{constructor(E,O,R,z,V,j,Y,ee,se,he){super("v3");this.nodeType="Toon";this.positioning=E,this.colors=O,this.steps=R,this.source=z,this.isWorldSpace=V,this.noiseStrength=j,this.noiseScale=Y,this.shadowColor=ee,this.offset=se,this.alpha=he,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(E,O){if(E.require("worldNormal"),E.require("worldPosition"),E.isShader("fragment")){E.define("COLORS_MAX",10),E.addFragmentVariable(this.calpha,"float");let R=E.include(ik.Nodes.toon),z=[];return z.push(this.positioning.build(E,"i")),z.push(this.colors.build(E,"v4[]")),z.push(this.steps.build(E,"f[]")),z.push(this.source.build(E,"v3")),z.push(this.isWorldSpace.build(E,"b")),z.push(this.noiseStrength.build(E,"f")),z.push(this.noiseScale.build(E,"f")),z.push(this.shadowColor.build(E,"v4")),z.push(this.offset.build(E,"v3")),z.push(this.mask?`luminance(${this.mask.flow(E,"v3").result})`:"1.0"),z.push(this.alpha.build(E,"f")),z.push(this.calpha),E.format(R+"("+z.join(",")+")",this.getType(E),O)}return console.warn("ToonNode is not compatible with "+E.shader+" shader."),E.format("vec3( 0.0 )",this.getType(E),O)}},rk=ik;rk.Nodes=function(){let E=new mN("float rand(float n) {\n\t\t\t\treturn fract(sin(n) * 43758.5453123);\n\t\t\t}"),O=new mN("float hash1(float p) { \n\t\t\t\tp = fract(p * 0.011); \n\t\t\t\tp *= p + 7.5; \n\t\t\t\tp *= p + p; \n\t\t\t\treturn fract(p); \n\t\t\t}"),R=new mN("float valueNoise(vec3 x) {\n\t\t\t\tconst vec3 step = vec3(110, 241, 171);\n\t\t\t\n\t\t\t\tvec3 i = floor(x);\n\t\t\t\tvec3 f = fract(x);\n\t\t\t \n\t\t\t\t// For performance, compute the base input to a 1D hash from the integer part of the argument and the \n\t\t\t\t// incremental change to the 1D based on the 3D -> 1D wrapping\n\t\t\t\tfloat n = dot(i, step);\n\t\t\t\n\t\t\t\tvec3 u = f * f * (3.0 - 2.0 * f);\n\t\t\t\treturn mix(mix(mix( hash1(n + dot(step, vec3(0, 0, 0))), hash1(n + dot(step, vec3(1, 0, 0))), u.x),\n\t\t\t\t\t\t\t   mix( hash1(n + dot(step, vec3(0, 1, 0))), hash1(n + dot(step, vec3(1, 1, 0))), u.x), u.y),\n\t\t\t\t\t\t   mix(mix( hash1(n + dot(step, vec3(0, 0, 1))), hash1(n + dot(step, vec3(1, 0, 1))), u.x),\n\t\t\t\t\t\t\t   mix( hash1(n + dot(step, vec3(0, 1, 1))), hash1(n + dot(step, vec3(1, 1, 1))), u.x), u.y), u.z);\n\t\t\t}",[O]),z=new mN("vec3 hash3(vec3 x) {\n\t\t\t\tx = vec3(dot(x,vec3(127.1, 311.7, 74.7)),\n\t\t\t\t\t\t dot(x,vec3(269.5, 183.3, 246.1)),\n\t\t\t\t\t\t dot(x,vec3(113.5, 271.9, 124.6)));\n\t\t\t\n\t\t\t\treturn fract(sin(x)*43758.5453123);\n\t\t\t}"),V=new mN('vec3 voronoiNoise(in vec3 x)\n\t\t\t{\n\t\t\t\tvec3 p = floor(x);\n\t\t\t\tvec3 f = fract(x);\n\n\t\t\t\tfloat id = 0.0;\n\t\t\t\tvec2 res = vec2(100.0);\n\n\t\t\t\tfor(int k=-1; k<=1; k++)\n\t\t\t\tfor(int j=-1; j<=1; j++)\n\t\t\t\tfor(int i=-1; i<=1; i++)\n\t\t\t\t{\n\t\t\t\t\tvec3 b = vec3(float(i), float(j), float(k));\n\n\t\t\t\t\t// Comment out the "+ hash(p + b);" part below to get "square" cells\n\t\t\t\t\tvec3 r = vec3(b) - f + hash3(p + b);\n\t\t\t\t\tfloat d = dot(r, r);\n\n\t\t\t\t\tif (d < res.x)\n\t\t\t\t\t{\n\t\t\t\t\t\tid = dot(p + b, vec3(1.0, 57.0, 113.0));\n\t\t\t\t\t\tres = vec2(d, res.x);\t\t\t\n\t\t\t\t\t}\n\t\t\t\t\telse if (d < res.y)\n\t\t\t\t\t{\n\t\t\t\t\t\tres.y = d;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn vec3(sqrt(res), abs(id));\n\t\t\t}\n\t\t\t',[z]);return{toon:new mN('vec3 toon(int positioning, vec4 colors[COLORS_MAX], float steps[COLORS_MAX], vec3 source, bool isWorldSpace, float noiseStrength, float noiseScale, vec4 shadowColor, vec3 offset, float mask, float alpha, out float calpha) {\n\t\t\t\tfloat t = 0.0;\n\t\t\t\tfloat shadow = 1.0;\n\n\t\t\t\tif (positioning == 0) {\n\n\t\t\t\t\t// Can\'t do this mode if lighting is "none"\n\t\t\t\t\t#if (defined(PHONG) || defined(LAMBERT) || defined(STANDARD))\n\n\t\t\t\t\t\t// Algorithm from Chapter 10 of Graphics Shaders\n\t\t\t\t\t\tconst vec3 weights = vec3(0.2125, 0.7154, 0.0721);\n\t\t\t\t\t\tvec3 lpos;\n\t\t\t\t\t\tvec3 l;\n\t\t\t\t\t\tfloat dproduct;\n\n\t\t\t\t\t\t#if (NUM_POINT_LIGHTS > 0)\n\n\t\t\t\t\t\t\t#if defined(USE_SHADOWMAP) && (NUM_POINT_LIGHT_SHADOWS > 0)\n\t\t\t\t\t\t\t\tPointLightShadow pointLightShadow;\n\t\t\t\t\t\t\t#endif \n\n\t\t\t\t\t\t\t#pragma unroll_loop_start\n\t\t\t\t\t\t\tfor (int i = 0; i < NUM_POINT_LIGHTS; i++) {\n\t\t\t\t\t\t\t\t// Light positions are in view-space for some reason?\n\t\t\t\t\t\t\t\tlpos = (inverse(viewMatrix) * vec4(pointLights[UNROLLED_LOOP_INDEX].position, 1.0)).xyz;\n\t\t\t\t\t\t\t\tl = normalize(lpos - worldPosition);\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tdproduct = dot(l, normalize(worldNormal)) * 0.5 + 0.5;\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t// TODO: we want to use "intensity" but it isn\'t available in the shader code\n\t\t\t\t\t\t\t\t//dproduct += dot(pointLights[UNROLLED_LOOP_INDEX].color, weights);\n\n\t\t\t\t\t\t\t\tt = max(t, dproduct);\n\n\t\t\t\t\t\t\t\t// Accumulate shadow contribution\n\t\t\t\t\t\t\t\t#if defined(USE_SHADOWMAP) && (UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS)\n\t\t\t\t\t\t\t\t\tpointLightShadow = pointLightShadows[UNROLLED_LOOP_INDEX];\n\t\t\t\t\t\t\t\t\tshadow *= getPointShadow( \n\t\t\t\t\t\t\t\t\t\t\tpointShadowMap[UNROLLED_LOOP_INDEX], \n\t\t\t\t\t\t\t\t\t\t\tpointLightShadow.shadowMapSize, \n\t\t\t\t\t\t\t\t\t\t\tpointLightShadow.shadowBias, \n\t\t\t\t\t\t\t\t\t\t\tpointLightShadow.shadowRadius,\n\t\t\t\t\t\t\t\t\t\t\tvPointShadowCoord[UNROLLED_LOOP_INDEX], \n\t\t\t\t\t\t\t\t\t\t\tpointLightShadow.shadowCameraNear, \n\t\t\t\t\t\t\t\t\t\t\tpointLightShadow.shadowCameraFar);\n\t\t\t\t\t\t\t\t#endif\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t#pragma unroll_loop_end\n\n\t\t\t\t\t\t#endif\n\n\t\t\t\t\t\t#if NUM_DIR_LIGHTS > 0 \n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t#if defined(USE_SHADOWMAP) && (NUM_DIR_LIGHT_SHADOWS > 0)\n\t\t\t\t\t\t\t\tDirectionalLightShadow directionalLightShadow;\n\t\t\t\t\t\t\t#endif \n\n\t\t\t\t\t\t\t#pragma unroll_loop_start\n\t\t\t\t\t\t\tfor (int i = 0; i < NUM_DIR_LIGHTS; i++) {\n\t\t\t\t\t\t\t\t// Use the direction vector for directional lights instead\n\t\t\t\t\t\t\t\tl = (inverse(viewMatrix) * vec4(directionalLights[UNROLLED_LOOP_INDEX].direction, 0.0)).xyz;\n\t\t\n\t\t\t\t\t\t\t\tdproduct = dot(l, normalize(worldNormal)) * 0.5 + 0.5;\n\t\t\t\t\t\t\t\tt = max(t, dproduct);\n\n\t\t\t\t\t\t\t\t// Accumulate shadow contribution\n\t\t\t\t\t\t\t\t#if defined(USE_SHADOWMAP) && (UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS)\n\t\t\t\t\t\t\t\t\tdirectionalLightShadow = directionalLightShadows[UNROLLED_LOOP_INDEX];\n\t\t\t\t\t\t\t\t\tshadow *= getShadow( \n\t\t\t\t\t\t\t\t\t\tUNROLLED_LOOP_INDEX,\n\t\t\t\t\t\t\t\t\t\tdirectionalShadowMap[UNROLLED_LOOP_INDEX], \n\t\t\t\t\t\t\t\t\t\tdirectionalLightShadow.shadowMapSize, \n\t\t\t\t\t\t\t\t\t\tdirectionalLightShadow.shadowBias, \n\t\t\t\t\t\t\t\t\t\tdirectionalLightShadow.shadowRadius, \n\t\t\t\t\t\t\t\t\t\tvDirectionalShadowCoord[UNROLLED_LOOP_INDEX]);\n\t\t\t\t\t\t\t\t#endif\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t#pragma unroll_loop_end\n\n\t\t\t\t\t\t#endif\n\n\t\t\t\t\t\t#if NUM_SPOT_LIGHTS > 0 \n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t#if defined(USE_SHADOWMAP) && (NUM_SPOT_LIGHT_SHADOWS > 0)\n\t\t\t\t\t\t\t\tSpotLightShadow spotLightShadow;\n\t\t\t\t\t\t\t#endif \n\n\t\t\t\t\t\t\t#pragma unroll_loop_start\n\t\t\t\t\t\t\tfor (int i = 0; i < NUM_SPOT_LIGHTS; i++) {\n\t\t\t\t\t\t\t\tlpos = (inverse(viewMatrix) * vec4(spotLights[UNROLLED_LOOP_INDEX].position, 1.0)).xyz;\n\t\t\t\t\t\t\t\tl = normalize(lpos - worldPosition);\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tdproduct = dot(l, normalize(worldNormal)) * 0.5 + 0.5;\n\t\t\t\t\t\t\t\tt = max(t, dproduct);\n\n\t\t\t\t\t\t\t\t// Accumulate shadow contribution\n\t\t\t\t\t\t\t\t#if defined(USE_SHADOWMAP) && (UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS)\n\t\t\t\t\t\t\t\t\tspotLightShadow = spotLightShadows[UNROLLED_LOOP_INDEX];\n\t\t\t\t\t\t\t\t\tshadow *= getShadow(\n\t\t\t\t\t\t\t\t\t\tUNROLLED_LOOP_INDEX,\n\t\t\t\t\t\t\t\t\t\tspotShadowMap[UNROLLED_LOOP_INDEX], \n\t\t\t\t\t\t\t\t\t\tspotLightShadow.shadowMapSize, \n\t\t\t\t\t\t\t\t\t\tspotLightShadow.shadowBias, \n\t\t\t\t\t\t\t\t\t\tspotLightShadow.shadowRadius, \n\t\t\t\t\t\t\t\t\t\tvSpotLightCoord[UNROLLED_LOOP_INDEX]);\n\t\t\t\t\t\t\t\t#endif\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t#pragma unroll_loop_end\n\n\t\t\t\t\t\t#endif\n\n\t\t\t\t\t\tt = clamp(t, 0.0, 1.0);\n\t\t\t\t\n\t\t\t\t\t#endif\n\n\t\t\t\t} else if (positioning == 1) {\n\t\t\t\t\t\n\t\t\t\t\tvec3 origin = mix(position, worldPosition, float(isWorldSpace));\n\t\t\t\t\tvec3 direction = normalize(source - origin);\n\t\t\t\t\tt = dot(direction, normalize(worldNormal)) * 0.5 + 0.5;\t\n\n\t\t\t\t} else {\n\n\t\t\t\t\tvec3 origin = worldPosition;\n\t\t\t\t\tvec3 source = cameraPosition - offset;\n\t\t\t\t\tvec3 direction = normalize(source - origin);\n\t\t\t\t\tt = dot(direction, normalize(worldNormal)) * 0.5 + 0.5;\t\n\t\t\t\t\t\n\t\t\t\t}\n\n\t\t\t\tif (noiseStrength > 0.0) {\n\t\t\t\t\t// Distort with noise\n\t\t\t\t\tvec3 st = position / noiseScale;\n\t\t\t\t\t\n\t\t\t\t\t// Voronoi "smooth" noise\n\t\t\t\t\tfloat noise = 1.0 - voronoiNoise(st).x;\n\n\t\t\t\t\t// Voronoi cellular noise\n\t\t\t\t\t//float noise = 1.0 - rand(voronoiNoise(st).z);\n\n\t\t\t\t\t// Position warp noise\n\t\t\t\t\t// vec3 offset = vec3(\n\t\t\t\t\t// \tsimplexFast(st),\n\t\t\t\t\t// \tsimplexFast(st + vec3(111.1, 143.89, 217.19)),\n\t\t\t\t\t// \tsimplexFast(st + vec3(171.1, 247.89, 117.23))\n\t\t\t\t\t// );\n\t\t\t\t\t// st += offset;\n\t\t\t\t\t// float noise = valueNoise(st);\n\n\t\t\t\t\tt += noise * noiseStrength;\n\t\t\t\t}\n\n\t\t\t\tt = clamp(t, 0.0, 1.0);\n\n\t\t\t\t// Compute ramp color\n\t\t\t\tfloat p;\n\t\t\t\tvec4 color = colors[0];\n\t\t\t\tfor (int i = 1; i < COLORS_MAX; i++) {\n\t\t\t\t\tp = clamp((t - steps[i-1]) / (steps[i] - steps[i-1]), 0.0, 1.0);\n\t\t\t\t\tcolor = mix(color, colors[i], smoothstep(0.0, 1.0, p));\n\t\t\t\t}\n\n\t\t\t\t// Incorporate custom shadow color\n\t\t\t\tif (positioning == 0) {\n\n\t\t\t\t\tvec3 blendedShadow = mix(color.rgb, shadowColor.rgb, shadowColor.a);\n\t\t\t\t\tcolor.rgb = mix(blendedShadow, color.rgb, shadow);\n\t\t\t\t\n\t\t\t\t}\n\n\t\t\t\t// Accumulate alpha as usual\n\t\t\t\tfloat lalpha = alpha * color.a * mask;\n\t\t\t\tcalpha =  lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0);\n\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha;\n\n\t\t\t\treturn color.xyz;\n\n            }',[YU.simplexFast,E,R,V])}}();var nk=function(){return{textureBicubic:new mN("float w0( float a ) {\n            return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );\n        }\n    \n        float w1( float a ) {\n            return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );\n        }\n    \n        float w2( float a ){\n            return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );\n        }\n    \n        float w3( float a ) {\n            return ( 1.0 / 6.0 ) * ( a * a * a );\n        }\n    \n        // g0 and g1 are the two amplitude functions\n        float g0( float a ) {\n            return w0( a ) + w1( a );\n        }\n    \n        float g1( float a ) {\n            return w2( a ) + w3( a );\n        }\n    \n        // h0 and h1 are the two offset functions\n        float h0( float a ) {\n            return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );\n        }\n    \n        float h1( float a ) {\n            return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );\n        }\n    \n        vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {\n            uv = uv * texelSize.zw + 0.5;\n    \n            vec2 iuv = floor( uv );\n            vec2 fuv = fract( uv );\n    \n            float g0x = g0( fuv.x );\n            float g1x = g1( fuv.x );\n            float h0x = h0( fuv.x );\n            float h1x = h1( fuv.x );\n            float h0y = h0( fuv.y );\n            float h1y = h1( fuv.y );\n    \n            vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n            vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n            vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n            vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n    \n            return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) + \n                   g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );\n        }\n\n        vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {\n            vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );\n            vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );\n            vec2 fLodSizeInv = 1.0 / fLodSize;\n            vec2 cLodSizeInv = 1.0 / cLodSize;\n            vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );\n            vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );\n            return mix( fSample, cSample, fract( lod ) );\n        }")}}();function BR(E,O){return E>=O?new bn(O/E,1):new bn(1,E/O)}var sk=class extends QF{constructor(E,O,R,z,V,j,Y,ee){super("v3");this.nodeType="Transmission";this.thickness=E,this.ior=O,this.roughness=R,this.transmissionSamplerSize=z,this.transmissionSamplerMap=V,this.transmissionDepthMap=j,this.aspectRatio=Y,this.alpha=ee,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(E,O){if(E.extensions.shaderTextureLOD=!0,E.extensions.derivatives=!0,E.isShader("fragment")){E.define("NUM_SAMPLES",6),E.define("BLUR_SLOD",Math.pow(2,ck.transmissionLod.value)),E.require("worldPosition"),E.requires.worldNormal=!0,E.requires.modelMatrix=!0,E.requires.projectionMatrix=!0,E.addFragmentVariable(this.calpha,"float");let R=E.include(sk.Nodes.transmission),z=[];return z.push(this.thickness.build(E,"f")),z.push(this.ior.build(E,"f")),z.push(this.roughness.build(E,"f")),z.push(this.transmissionSamplerSize.build(E,"v2")),z.push(this.transmissionSamplerMap.getTexture(E,"t")),z.push(this.transmissionDepthMap.getTexture(E,"t")),z.push(this.aspectRatio.build(E,"v2")),z.push("normal"),z.push(this.mask?`luminance(${this.mask.flow(E,"v3").result})`:"1.0"),z.push(this.alpha.build(E,"f")),z.push(this.calpha),E.format(R+"("+z.join(",")+")",this.getType(E),O)}return console.warn("TransmissionNode is not compatible with "+E.shader+" shader."),E.format("vec3( 0.0 )",this.getType(E),O)}},ak=sk;ak.Nodes=function(){let E=new mN("vec3 blur(sampler2D sp, vec2 U, vec2 scale, float lod, sampler2D dm, vec2 unrefractedU, vec2 aspectRatio) {\n                // Slightly modified version of this:\n                // https://www.shadertoy.com/view/ltScRG\n\n\t\t\t\t// Special case for blur == 0.0\n\t\t\t\tif (lod == 0.0) {\n\t\t\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\t\treturn texture2DLodEXT( sp, U, 0.0).rgb;\n\t\t\t\t\t#else\n\t\t\t\t\treturn textureLod( sp, U, 0.0).rgb;\n\t\t\t\t\t#endif\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tvec2 texelSize = vec2(1.0) / resolution;\n                vec2 halton = haltonSequence[frameIndex];\n                float temporalOffset = getNoiseInterleavedGradient(gl_FragCoord.xy + halton);\n                float temporalAngle  = temporalOffset * PI2;\n\t\t\t\tvec3 res = vec3(0.0);\n                vec2 uv = vec2(0.0);\n                vec2 offset = vec2(0.0);\n                vec2 vogelSample = vec2(0.0);\n                for (int i = 0; i < NUM_SAMPLES; i++) {\n                    vogelSample =  vogelDiskSample(i, NUM_SAMPLES, temporalAngle) * texelSize;\n                    offset = vogelSample * scale * (lod * 10.0); // TODO: used to be hardcoded to 20\n                    uv = U + offset;\n                    float opaqueDepth = unpackRGBAToDepth(textureLod(dm, uv, lod));\n                    if (opaqueDepth != 0.0 && opaqueDepth < gl_FragCoord.z) {\n                        uv = unrefractedU;\n                        lod = lod > 4.0 ? lod : lod / 2.0;\n                    }\n                    res += textureLod(sp, uv, lod).rgb;\n                }\n                return res / float(NUM_SAMPLES);\n            }"),O=new mN("vec3 getVolumeTransmissionRay( vec3 n, vec3 v, float thickness, float ior, mat4 modelMatrix ) {\n\t\t        // Direction of refracted light.\n\t\t        vec3 refractionVector = refract( -v,  n, 1.0 / ior );\n\t\t        \n\t\t\t\t// Compute rotation-independant scaling of the model matrix.\n\t\t        vec3 modelScale;\n\t\t        modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\t        modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\t        modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\n\t\t        // The thickness is specified in local space\n\t\t        return normalize( refractionVector ) * thickness * modelScale;\n\t        }"),R=new mN("float applyIorToRoughness( float roughness, float ior ) {\n\t\t\t\t// Scale roughness with IOR so that an IOR of 1.0 results in no microfacet refraction and\n\t\t\t\t// an IOR of 1.5 results in the default amount of microfacet refraction.\n\t\t\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t\t\t}"),z=new mN('vec3 getTransmissionSample( vec2 fragCoord, float roughness, float ior, vec2 transmissionSamplerSize, sampler2D transmissionSamplerMap, sampler2D transmissionDepthMap, vec2 unrefractedCoords, vec2 aspectRatio) {\n\t\t\t\t// Threejs exports do not pass a depth map to this shader, so we have to fallback to the "Threejs method of blurring" - see\n\t\t\t\t// also the code in convertTransmission.ts, which runs during export\n\t\t\t\t#ifdef IS_THREEJS_EXPORT\n\t\t\t\t\tfloat lod = log2(transmissionSamplerSize.x) * applyIorToRoughness(roughness / 5.0, ior);\n\t\t\t\t\treturn textureBicubic(transmissionSamplerMap, fragCoord.xy, lod).rgb;\n\t\t\t\t#else\n\t\t\t\t\tfloat framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\t\t\t\tfloat lod = applyIorToRoughness(roughness, ior);\n\t\t\t\t\treturn blur(transmissionSamplerMap, fragCoord, vec2(lod), min(framebufferLod / 5.5, 8.5), transmissionDepthMap, unrefractedCoords, aspectRatio);\n\t\t\t\t#endif\n\t\t\t}',[nk.textureBicubic,R,E]),V=new mN("vec3 getIBLVolumeRefraction( vec3 n, vec3 v, float roughness, vec3 position, mat4 modelMatrix, mat4 viewMatrix, mat4 projMatrix, float ior, float thickness, vec2 transmissionSamplerSize, sampler2D transmissionSamplerMap, sampler2D transmissionDepthMap, vec2 aspectRatio ) {\n\t\t\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\t\t\tvec3 refractedRayExit = position + transmissionRay;\n\n\t\t\t\t// Project refracted vector on the framebuffer, while mapping to normalized device coordinates.\n\t\t\t\tvec4 ndcPos = projMatrix * viewMatrix *  vec4( refractedRayExit, 1.0 );\n\t\t\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\t\t\trefractionCoords += 1.0;\n\t\t\t\trefractionCoords /= 2.0;\n\n\t\t\t\tvec4 ndcPosUnrefracted = projMatrix * viewMatrix * vec4(position, 1.0 );\n\t\t\t\tvec2 unrefractedCoords = ndcPosUnrefracted.xy / ndcPosUnrefracted.w;\n\t\t\t\tunrefractedCoords += 1.0;\n\t\t\t\tunrefractedCoords /= 2.0;\n\n\t\t\t\t// Sample framebuffer to get pixel the refracted ray hits.\n\t\t\t\treturn getTransmissionSample( refractionCoords, roughness, ior, transmissionSamplerSize, transmissionSamplerMap, transmissionDepthMap, unrefractedCoords, aspectRatio );\n    \t\t}",[z,O]);return{transmission:new mN("vec3 transmission(float thickness, float ior, float roughness, vec2 transmissionSamplerSize, sampler2D transmissionSamplerMap, sampler2D transmissionDepthMap, vec2 aspectRatio, vec3 normal, float mask, float alpha, out float calpha) {\n                vec3 v = vec3(0.);\n                if (isOrthographic) {\n                    v = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n                } else {\n                    v = normalize(vWPosition - cameraPosition);\n                }\n                vec3 transmission = getIBLVolumeRefraction(vWNormal, -v, roughness,  vWPosition, modelMatrix, viewMatrix, projectionMatrix, ior, thickness, transmissionSamplerSize, transmissionSamplerMap, transmissionDepthMap, aspectRatio );\n                \n\t\t\t\tfloat lalpha = alpha * mask;\n\t\t\t\tcalpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );\n\t\t\t\taccumAlpha += ( 1.0 - accumAlpha ) * alpha;\n\n\t\t\t\treturn transmission;\n            }",[V])}}();var ok=(E=>(E.NOISE="noise",E.MAP="map",E))(ok||{}),lk=class extends QF{constructor(E,O,R,z,V,j,Y,ee,se,he,ce){super("v3");this.displacementTypeIndex=new AU(0);this.nodeType="VertexDisplacement";this.intensity=E,this.movementOrTexture=O,Object.values(ok)[this.displacementTypeIndex.value]==="map"&&(this.mat=new DU(this.movementOrTexture.value.matrix)),this.cropOrOffset=R,this.scale=he,this.noiseFunctionIndex=ce,this.voronoiStyle=z,this.smoothness=V,this.seed=j,this.highCut=Y,this.lowCut=ee,this.quality=se}generate(E,O){if(E.isShader("vertex")){E.define("USE_LAYER_DISPLACE");let R,z=[];switch(z.push("displaced_position"),z.push("displaced_normal"),Object.values(ok)[this.displacementTypeIndex.value]){case"map":R=E.include(lk.Nodes.map),z.push(this.movementOrTexture.getTexture(E,"t")),z.push("uv"),z.push(this.cropOrOffset.build(E,"f")),this.mat&&z.push(this.mat.build(E,"mat3"));break;case"noise":{let O=["simplexPrecise","simplexFractal","simplexAshima","fbm","perlin","voronoi"][this.noiseFunctionIndex.value],V=new mN("vec3 orthogonal(vec3 v) {\n\t\t\t\t\t\t\treturn normalize(abs(v.x) > abs(v.z) ? vec3(-v.y, v.x, 0.0) : vec3(0.0, -v.z, v.y));\n\t\t\t\t\t\t}"),j=O=="voronoi"?`\n\t\t\t\t\tfloat v = ${O}((p + offset) * scale * 0.001 + neighbour_offset + (movement * 0.1), voronoiStyle, smoothness, seed, quality);\n\t\t\t\t\tv = remap(v, lowCut, highCut, 0.0, 1.0);\n\t\t\t\t\tv = smax(v, 0.0, smoothness * 0.25);\n\t\t\t\t\tv = smin(v, 1.0, smoothness * 0.25);\n\n\t\t\t\t\treturn p + n * v * intensity;\n\t\t\t\t\t`:`\n\t\t\t\t\treturn p + n * ${O}((p + offset) * scale * 0.001 + neighbour_offset + (movement * 0.1)) * intensity;\n\t\t\t\t\t`,Y=new mN(`vec3 distorted(vec3 p, vec3 n, float scale, float intensity, vec3 offset, float neighbour_offset, float movement, int voronoiStyle, float smoothness, float seed, float highCut, float lowCut, int quality) {\n\t\t\t\t\t\t\t${j}\n\t\t\t\t\t\t}`,[YU.simplexPrecise,YU.simplexFractal,YU.simplexAshima,YU.fbm,YU.perlin,YU.voronoi]),ee=new mN("vec3 vertexDisplacementNoise(vec3 position, vec3 normal, float scale, vec3 offset, float movement, int voronoiStyle, float smoothness, float seed, float highCut, float lowCut, int quality, float intensity, out vec3 displaced_normal) {\n\t\t\t\t\t\t\tvec3 displaced_position = distorted(position, normal, scale, intensity, offset, neighbor_offset, movement, voronoiStyle, smoothness, seed, highCut, lowCut, quality);\n\t\t\t\t\t\t\tvec3 tangent1 = orthogonal(normal);\n\t\t\t\t\t\t\tvec3 tangent2 = normalize(cross(normal, tangent1));\n\n                            // TODO(Max): The distance to the neighbors was originally scaled by 0.1.\n                            // This caused some small oval/circular visual artifacts in the lighting.\n                            // For now, simply using neighbors further away betters the problem,\n                            // but we should figure out the underlying cause when we have some time.\n                            // Maybe its related to how we calculate the tangent and bitangent?\n\t\t\t\t\t\t\tvec3 nearby1 = position + tangent1;\n\t\t\t\t\t\t\tvec3 nearby2 = position + tangent2;\n\t\t\t\t\t\t\tvec3 distorted1 = distorted(nearby1, normal, scale, intensity, offset, neighbor_offset, movement, voronoiStyle, smoothness, seed, highCut, lowCut, quality);\n\t\t\t\t\t\t\tvec3 distorted2 = distorted(nearby2, normal, scale, intensity, offset, neighbor_offset, movement, voronoiStyle, smoothness, seed, highCut, lowCut, quality);\n\t\t\t\t\t\t\tdisplaced_normal = normalize(cross(distorted1 - displaced_position, distorted2 - displaced_position));\n\t\t\t\t\t\t\treturn displaced_position;\n\t\t\t\t\t\t}",[Y,V]);R=E.include(ee),z.push(this.scale.build(E,"f")),z.push(this.cropOrOffset.build(E,"v3")),z.push(this.movementOrTexture.build(E,"f")),z.push(this.voronoiStyle.build(E,"i")),z.push(this.smoothness.build(E,"f")),z.push(this.seed.build(E,"f")),z.push(this.highCut.build(E,"f")),z.push(this.lowCut.build(E,"f")),z.push(this.quality.build(E,"i"));break}}return z.push(this.intensity.build(E,"f")),z.push("displaced_normal"),E.format(R+"("+z.join(",")+")",this.getType(E),O)}return console.warn("VertexDisplacementNode is not compatible with "+E.shader+" shader."),E.format("vec3( 0.0 )",this.getType(E),O)}},hk=lk;hk.Nodes=function(){let E=new mN("vec3 orthogonal(vec3 v) {\n\t\t\t\treturn normalize(abs(v.x) > abs(v.z) ? vec3(-v.y, v.x, 0.0) : vec3(0.0, -v.z, v.y));\n\t\t\t}"),O=new mN("float displacementMapTexture(sampler2D tex, float crop, vec2 uv, mat3 mat, vec2 offset) {\n\t\t\t\tvec2 uvs = (mat * vec3(uv * 2.0 - 1.0, 1.0) / 2.0 + 0.5).xy + offset;\n\t\t\t\tvec4 tmp = texture2D(tex, uvs);\n\t\t\t\tvec3 col = tmp.rgb;\n\t\t\t\tif (crop > 0.5) {\n\t\t\t\t\tif ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {\n\t\t\t\t\t\treturn 0.0;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn col.r;\n\t\t\t}");return{map:new mN("vec3 vertexDisplacementMap(vec3 position, vec3 normal, sampler2D tex, vec2 uv, float crop, mat3 mat, float intensity, out vec3 displaced_normal) {\n\t\t\t\tvec3 displaced_position = position + normal * displacementMapTexture(tex, crop, uv, mat, vec2(0.0)) * intensity;\n\t\t\t\tvec3 tangent1 = normalize(orthogonal(normal));\n\t\t\t\tvec3 tangent2 = normalize(cross(normal, tangent1));\n\t\t\t\tvec3 nearby1 = position + tangent1 * 0.1;\n\t\t\t\tvec3 nearby2 = position + tangent2 * 0.1;\n\t\t\t\tvec3 distorted1 = nearby1 + normal * displacementMapTexture(tex, crop, uv, mat, vec2(neighbor_offset)) * intensity;\n\t\t\t\tvec3 distorted2 = nearby2 + normal * displacementMapTexture(tex, crop, uv, mat, vec2(neighbor_offset)) * intensity;\n\t\t\t\tdisplaced_normal = normalize(cross(distorted1 - displaced_position, distorted2 - displaced_position));\n\t\t\t\treturn displaced_position;\n\t\t\t}",[E,O])}}();var ck={normalRenderTarget:new jN,normalRenderTargetDepth:new jN,transmissionRenderTarget:new jN,aspectRatio:new KF,transmissionSize:new KF(2048,2048),transmissionRenderTargetDepth:new jN,aoRenderTarget:new jN,aoEnabled:new MU,pixelRatioNode:new GN(1),resolution:new KF,penumbraSize:new EU(5,.5),frameIndex:new AU(0),transmissionLod:new AU(2)};for(let E of Object.values(ck))E.isRenderGlobal=!0;var dk={skiaWasmUrl:"https://unpkg.com/@splinetool/ui-wasm@1.9.76/build/ui.wasm"};var uk=class extends WF{constructor(){super("basic");this.nodeType="Basic";this.color=new _U(yT),this.shadingAlpha=new GN(1),this.shadingBlend=new AU(0),this.previousModelViewMatrix=new IU,this.previouseProjectionMatrix=new IU}get category(){return"phong"}generate(E){let O;if(E.isShader("vertex")){let R=this.position?this.position.analyzeAndFlow(E,"v3",{cache:"position"}):void 0;E.mergeUniform({frameIndex:ck.frameIndex}),E.mergeUniform({resolution:ck.resolution}),E.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),E.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),E.mergeUniform(ro.merge([Fc.fog])),E.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <skinning_pars_vertex>","#include <normal_pars_vertex>","#include <morphtarget_pars_vertex>"].join("\n"));let z=["#include <beginnormal_vertex>","#include <morphnormal_vertex>","\n\t\t\t\t#include <skinbase_vertex>\n\t\t\t\t#include <skinnormal_vertex>\n\t\t\t\t#if !defined( USE_LAYER_DISPLACE )\n\t\t\t\t\t#include <defaultnormal_vertex>\n\t\t\t\t#endif\n\n\t\t\t\tvec3 displaced_position = position;\n\t\t\t\tvec3 displaced_normal = normal;\n\n\t\t\t\t#if defined( USE_LAYER_DISPLACE )\n\t\t\t\t\tvec3 transformed;\n\t\t\t\t\tvec3 transformedNormal;\n\t\t\t\t#endif\n\t\t\t\t","#include <normal_vertex>","\n\t\t\t\t#if !defined( USE_LAYER_DISPLACE )\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t#endif /* !USE_LAYER_DISPLACE */\n\t\t\t\t"];R&&z.push(R.code,R.result?"displaced_position = "+R.result+";":""),z.push("transformed = displaced_position;","#include <morphtarget_vertex>","#include <skinning_vertex>","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","\tvNormal = transformedNormal;","#endif"),z.push("#include <project_vertex>","#include <fog_vertex>","#include <clipping_planes_vertex>","\tvViewPosition = - mvPosition.xyz;","#include <worldpos_vertex>"),z.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),O=z.join("\n")}else{this.color===void 0&&(this.color=new _U(yT)),this.color.analyze(E,{slot:"color"}),this.alpha&&this.alpha.analyze(E),this.afterColor&&this.afterColor.analyze(E,{slot:"afterColor"});let R=this.color.flow(E,"c",{slot:"color"}),z=this.alpha?this.alpha.flow(E,"f"):void 0,V=this.alphaOverride?this.alphaOverride.flow(E,"f"):void 0,j=this.afterColor?this.afterColor.flow(E,"c",{slot:"afterColor"}):void 0;E.requires.transparent=z!==void 0,E.addParsCode(["varying vec3 vWPosition;","#include <fog_pars_fragment>","#include <dithering_pars_fragment>","varying vec3 vViewPosition;","#include <normal_pars_fragment>"].join("\n"));let Y=["#include <normal_fragment_begin>",R.code];z&&Y.push(z.code,"#ifdef ALPHATEST"," if ( "+z.result+" <= ALPHATEST ) discard;","#endif"),j?Y.push(j.code,`vec3 outgoingLight = ${R.result};`,`vec3 finalColor = spe_blend(outgoingLight, ${j.result}, 1.0, SPE_BLENDING_NORMAL);`):Y.push(`vec3 finalColor = ${R.result};`);let ee="1.0";this.mask&&(this.mask.analyze(E),ee=`luminance(${this.mask.flow(E,"v3").result})`),z?Y.push(`gl_FragColor = vec4( finalColor, accumAlpha * ${z.result} * ${ee} );`):Y.push("gl_FragColor = vec4("+R.result+", 1.0 );"),V&&Y.push(`gl_FragColor.a *= ${V.result};`),Y.push("#include <fog_fragment>","#include <dithering_fragment>"),O=Y.join("\n")}return O}};var pk=class extends WF{constructor(){super("lambert");this.nodeType="Lambert";this.color=new _U(yT),this.emissive=new _U(0),this.emissiveIntensity=new GN(1),this.previousModelViewMatrix=new IU,this.previouseProjectionMatrix=new IU,this.shadingAlpha=new GN(1),this.shadingBlend=new AU(0),this.occlusion=new MU(!0)}get category(){return"lambert"}build(E){let O;if(E.define("LAMBERT"),E.requires.lights=!0,E.extensions.derivatives=!0,E.isShader("vertex")){let R=this.position?this.position.analyzeAndFlow(E,"v3",{cache:"position"}):void 0;E.mergeUniform({frameIndex:ck.frameIndex}),E.mergeUniform({resolution:ck.resolution}),E.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),E.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),E.mergeUniform(ro.merge([Fc.fog,Fc.lights])),E.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","varying vec3 vLightFront;","varying vec3 vIndirectFront;","#ifndef DOUBLE_SIDED","   #define DOUBLE_SIDED","#endif","#ifdef DOUBLE_SIDED","\tvarying vec3 vLightBack;","\tvarying vec3 vIndirectBack;","#endif","#include <bsdfs>","#include <lights_pars_begin>","#include <color_pars_vertex>","#include <fog_pars_vertex>","#include <skinning_pars_vertex>","#include <normal_pars_vertex>","#include <morphtarget_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join("\n"));let z=["#include <beginnormal_vertex>","#include <morphnormal_vertex>","\n\t\t\t\t#include <skinbase_vertex>\n\t\t\t\t#include <skinnormal_vertex>\n\t\t\t\t#ifndef USE_LAYER_DISPLACE\n\t\t\t\t\t#include <defaultnormal_vertex>\n\t\t\t\t#endif\n\n\t\t\t\tvec3 displaced_position = position;\n\t\t\t\tvec3 displaced_normal = objectNormal;\n\n\t\t\t\t#ifdef USE_LAYER_DISPLACE\n\t\t\t\t\tvec3 transformed;\n\t\t\t\t\tvec3 transformedNormal;\n\t\t\t\t#endif\n\t\t\t\t","#include <normal_vertex>","\n\t\t\t\t#ifndef USE_LAYER_DISPLACE\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t#endif\n\t\t\t\t"];R&&z.push(R.code,R.result?"displaced_position = "+R.result+";":""),z.push("transformed = displaced_position;","#include <morphtarget_vertex>","#include <skinning_vertex>","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),z.push("\t#include <project_vertex>","\t#include <clipping_planes_vertex>","\tvViewPosition = - mvPosition.xyz;","\t#include <worldpos_vertex>","\n\t\t\t\t\tvec3 diffuse = vec3( 1.0 );\n\t\t\t\t\tGeometricContext geometry;\n\t\t\t\t\tgeometry.position = mvPosition.xyz;\n\t\t\t\t\tgeometry.normal = normalize( transformedNormal );\n\t\t\t\t\tgeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\n\t\t\t\t"),z.push("\n\t\t\t\t\tGeometricContext backGeometry;\n\t\t\t\t\tbackGeometry.position = geometry.position;\n\t\t\t\t\tbackGeometry.normal = -geometry.normal;\n\t\t\t\t\tbackGeometry.viewDir = geometry.viewDir;\n\t\t\t\t\tvLightFront = vec3( 0.0 );\n\t\t\t\t\tvIndirectFront = vec3( 0.0 );\n\t\t\t\t\t#ifdef DOUBLE_SIDED\n\t\t\t\t\t\tvLightBack = vec3( 0.0 );\n\t\t\t\t\t\tvIndirectBack = vec3( 0.0 );\n\t\t\t\t\t#endif\n\t\t\t\t\tIncidentLight directLight;\n\t\t\t\t\tfloat dotNL;\n\t\t\t\t\tvec3 directLightColor_Diffuse;\n\t\t\t\t\tvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\n\t\t\t\t\tvIndirectFront += getLightProbeIrradiance( lightProbe, geometry.normal );\n\t\t\t\t\t#ifdef DOUBLE_SIDED\n\t\t\t\t\t\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\n\t\t\t\t\t\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry.normal );\n\t\t\t\t\t#endif\n\t\t\t\t\t#if NUM_POINT_LIGHTS > 0\n\t\t\t\t\t\t#pragma unroll_loop_start\n\t\t\t\t\t\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\t\t\t\t\t\tgetPointLightInfo( pointLights[ i ], geometry, directLight );\n\t\t\t\t\t\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\t\t\t\t\t\tdirectLightColor_Diffuse = directLight.color;\n\t\t\t\t\t\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t\t\t\t\t\t#ifdef DOUBLE_SIDED\n\t\t\t\t\t\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t\t\t\t\t\t#endif\n\t\t\t\t\t\t}\n\t\t\t\t\t\t#pragma unroll_loop_end\n\t\t\t\t\t#endif\n\t\t\t\t\t#if NUM_SPOT_LIGHTS > 0\n\t\t\t\t\t\t#pragma unroll_loop_start\n\t\t\t\t\t\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\t\t\t\t\t\tgetSpotLightInfo( spotLights[ i ], geometry, directLight );\n\t\t\t\t\t\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\t\t\t\t\t\tdirectLightColor_Diffuse = directLight.color;\n\t\t\t\t\t\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t\t\t\t\t\t#ifdef DOUBLE_SIDED\n\t\t\t\t\t\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t\t\t\t\t\t#endif\n\t\t\t\t\t\t}\n\t\t\t\t\t\t#pragma unroll_loop_end\n\t\t\t\t\t#endif\n\t\t\t\t\t#if NUM_DIR_LIGHTS > 0\n\t\t\t\t\t\t#pragma unroll_loop_start\n\t\t\t\t\t\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\t\t\t\t\t\tgetDirectionalLightInfo( directionalLights[ i ], geometry, directLight );\n\t\t\t\t\t\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\t\t\t\t\t\tdirectLightColor_Diffuse = directLight.color;\n\t\t\t\t\t\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t\t\t\t\t\t#ifdef DOUBLE_SIDED\n\t\t\t\t\t\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t\t\t\t\t\t#endif\n\t\t\t\t\t\t}\n\t\t\t\t\t\t#pragma unroll_loop_end\n\t\t\t\t\t#endif\n\t\t\t\t\t#if NUM_HEMI_LIGHTS > 0\n\t\t\t\t\t\t#pragma unroll_loop_start\n\t\t\t\t\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\t\t\t\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t\t\t\t\t\t#ifdef DOUBLE_SIDED\n\t\t\t\t\t\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry.normal );\n\t\t\t\t\t\t\t#endif\n\t\t\t\t\t\t}\n\t\t\t\t\t\t#pragma unroll_loop_end\n\t\t\t\t\t#endif\n\t\t\t\t","\t#include <shadowmap_vertex>","\t#include <fog_vertex>"),z.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),O=z.join("\n")}else{E.mergeUniform({penumbraSize:ck.penumbraSize}),E.mergeUniform({frameIndex:ck.frameIndex}),E.mergeUniform({aoMap:ck.aoRenderTarget}),E.mergeUniform({aoEnabled:ck.aoEnabled}),this.color===void 0&&(this.color=new _U(yT)),this.color.analyze(E,{slot:"color"}),this.shadingAlpha.analyze(E),this.shadingBlend.analyze(E),this.afterColor&&this.afterColor.analyze(E,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(E);let R=this.color.flow(E,"c",{slot:"color"}),z=this.emissive.flow(E,"c",{slot:"emissive"}),V=this.emissiveIntensity.flow(E,"f",{slot:"emissive"}),j=this.occlusion.flow(E,"b",{slot:"occlusion"}),Y=this.shadingAlpha.flow(E,"f"),ee=this.shadingBlend.flow(E,"i"),se=this.afterColor?this.afterColor.flow(E,"c",{slot:"afterColor"}):void 0,he=this.alpha?this.alpha.flow(E,"f"):void 0,ce=this.alphaOverride?this.alphaOverride.flow(E,"f"):void 0;E.requires.transparent=he!==void 0,E.addParsCode(["uniform float penumbraSize[5];","uniform sampler2D aoMap;","uniform bool aoEnabled;","varying vec3 vViewPosition;","varying vec3 vWPosition;","varying vec3 vLightFront;","varying vec3 vIndirectFront;","#ifndef DOUBLE_SIDED","   #define DOUBLE_SIDED","#endif","#include <normal_pars_fragment>","#ifdef DOUBLE_SIDED","\tvarying vec3 vLightBack;","\tvarying vec3 vIndirectBack;","#endif","#include <bsdfs>","#include <lights_pars_begin>","#include <fog_pars_fragment>","#include <shadowmap_pars_fragment>","#include <shadowmask_pars_fragment>","#include <clipping_planes_pars_fragment>","#include <dithering_pars_fragment>"].join("\n"));let ue=["#include <normal_fragment_begin>","\n\t\t\t\t// NOTE: gl_FrontFacing alternative using face normal estimation.\n\t\t\t\tvec3 viewdx = dFdx(vViewPosition);\n\t\t\t\tvec3 viewdy = dFdy(vViewPosition);\n\t\t\t\tvec3 faceNormal = normalize(cross(viewdx, viewdy));\n\t\t\t\tbool isFrontFacing = (dot(normal, faceNormal) >= 0.0);\n\t\t\t\t","#include <clipping_planes_fragment>"];ue.push(R.code,"vec3 diffuseColor = "+R.result+";","ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );"),he&&ue.push(he.code,"#ifdef ALPHATEST","if ( "+he.result+" <= ALPHATEST ) discard;","#endif"),ue.push("#ifdef DOUBLE_SIDED","\treflectedLight.indirectDiffuse += ( isFrontFacing ) ? vIndirectFront : vIndirectBack;","#else","\treflectedLight.indirectDiffuse += vIndirectFront;","#endif","#include <lightmap_fragment>","reflectedLight.indirectDiffuse *= BRDF_Lambert( diffuseColor.rgb );","#ifdef DOUBLE_SIDED","\treflectedLight.directDiffuse = ( isFrontFacing ) ? vLightFront : vLightBack;","#else","\treflectedLight.directDiffuse = vLightFront;","#endif","reflectedLight.directDiffuse *= BRDF_Lambert( diffuseColor.rgb ) * getShadowMask();"),z&&ue.push(z.code,"reflectedLight.directDiffuse += "+z.result+" * "+V.result+";"),ue.push("vec3 ao = aoEnabled && "+j.result+" ? tex2D(aoMap, gl_FragCoord.xy / resolution).rgb : vec3(1.0);","vec3 outgoingLight = (reflectedLight.directDiffuse + reflectedLight.indirectDiffuse) ;");let fe="1.0";this.mask&&(this.mask.analyze(E),fe=`luminance(${this.mask.flow(E,"v3").result})`),ue.push(`\n\t\t\t\tif (outgoingLight != diffuseColor) {\n\t\t\t\t\tfloat lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );\n\t\t\t\t\taccumAlpha += ( 1.0 - accumAlpha ) * ${Y.result} * ${fe} * lightAccu;\n\t\t\t\t\toutgoingLight = spe_blend( diffuseColor, outgoingLight, ${Y.result} * ${fe}, ${ee.result} );\n\n\t\t\t\t\toutgoingLight *= ao;\n\t\t\t\t}\n\t\t\t\t`),se&&ue.push(se.code,`outgoingLight = spe_blend(outgoingLight, ${se.result}, 1.0, SPE_BLENDING_NORMAL);`),he?ue.push(`gl_FragColor = vec4( outgoingLight, accumAlpha * ${he.result} );`):ue.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),ce&&ue.push(`gl_FragColor.a *= ${ce.result};`),ue.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),O=ue.join("\n")}return O}};var fk=function(){let E=new mN("vec2 dHdxy(sampler2D bumpMap, vec2 bumpMapUv, float bumpScale) {\n\n            // Gradient of UVs w.r.t. X coordinate (in screen-space)\n            vec2 dSTdx = dFdx(bumpMapUv);\n\n            // Gradient of UVs w.r.t. Y coordinate (in screen-space)\n            vec2 dSTdy = dFdy(bumpMapUv);\n            \n            // Forward differencing\n            float Hll = bumpScale * luminance(texture(bumpMap, bumpMapUv).rgb);\n            float dBx = bumpScale * luminance(texture(bumpMap, bumpMapUv + dSTdx).rgb) - Hll;\n            float dBy = bumpScale * luminance(texture(bumpMap, bumpMapUv + dSTdy).rgb) - Hll;\n            \n            return vec2( dBx, dBy );\n        }"),O=new mN("vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n            vec3 vSigmaX = dFdx( surf_pos.xyz );\n            vec3 vSigmaY = dFdy( surf_pos.xyz );\n            vec3 vN = surf_norm; // normalized\n            \n            vN = normalize(vN);\n\n            vec3 R1 = cross( vSigmaY, vN );\n            vec3 R2 = cross( vN, vSigmaX );\n\n            R1 = normalize(R1);\n            R2 = normalize(R2);\n    \n            float fDet = dot( vSigmaX, R1 ) * faceDirection;\n    \n            vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n            return normalize( abs( fDet ) * vN - vGrad );\n        }");return{dHdxy:E,perturbNormalArb:O}}();var mk=class extends WF{constructor(){super("phong");this.nodeType="Phong";this.color=new _U(yT),this.specular=new _U(1118481),this.shininess=new GN(30),this.previousModelViewMatrix=new IU,this.previouseProjectionMatrix=new IU,this.shadingAlpha=new GN(1),this.shadingBlend=new AU(0),this.occlusion=new MU(!0)}get category(){return"phong"}build(E){let O;if(E.define("PHONG"),E.requires.lights=!0,E.extensions.derivatives=!0,E.isShader("vertex")){let R=this.position?this.position.analyzeAndFlow(E,"v3",{cache:"position"}):void 0;E.mergeUniform({frameIndex:ck.frameIndex}),E.mergeUniform({resolution:ck.resolution}),E.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),E.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),E.mergeUniform(ro.merge([Fc.fog,Fc.lights])),E.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <skinning_pars_vertex>","#include <normal_pars_vertex>","#include <morphtarget_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join("\n"));let z=["#include <beginnormal_vertex>","#include <morphnormal_vertex>","\n\t\t\t\t#include <skinbase_vertex>\n\t\t\t\t#include <skinnormal_vertex>\n\t\t\t\t#ifndef USE_LAYER_DISPLACE\n\t\t\t\t\t#include <defaultnormal_vertex>\n\t\t\t\t#endif\n\n\t\t\t\tvec3 displaced_position = position;\n\t\t\t\tvec3 displaced_normal = objectNormal;\n\n\t\t\t\t#ifdef USE_LAYER_DISPLACE\n\t\t\t\t\tvec3 transformed;\n\t\t\t\t\tvec3 transformedNormal;\n\t\t\t\t#endif\n\t\t\t\t","#include <normal_vertex>","\n\t\t\t\t#ifndef USE_LAYER_DISPLACE\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t#endif\n\t\t\t\t"];R&&z.push(R.code,R.result?"displaced_position = "+R.result+";":""),z.push("transformed = displaced_position;","#include <morphtarget_vertex>","#include <skinning_vertex>","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),z.push("\t#include <project_vertex>","\t#include <clipping_planes_vertex>","\tvViewPosition = - mvPosition.xyz;","\t#include <worldpos_vertex>","\t#include <shadowmap_vertex>","\t#include <fog_vertex>"),z.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),O=z.join("\n")}else{E.mergeUniform({penumbraSize:ck.penumbraSize}),E.mergeUniform({frameIndex:ck.frameIndex}),E.mergeUniform({aoMap:ck.aoRenderTarget}),E.mergeUniform({aoEnabled:ck.aoEnabled}),this.color===void 0&&(this.color=new _U(yT)),this.color.analyze(E,{slot:"color"}),this.specular.analyze(E),this.shininess.analyze(E);let R=this.occlusion.flow(E,"b",{slot:"occlusion"});this.shadingAlpha.analyze(E),this.shadingBlend.analyze(E),this.afterColor&&this.afterColor.analyze(E,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(E);let z=this.color.flow(E,"c",{slot:"color"}),V=this.specular.flow(E,"c"),j=this.shininess.flow(E,"f"),Y=this.shadingAlpha.flow(E,"f"),ee=this.shadingBlend.flow(E,"i"),se=this.afterColor?this.afterColor.flow(E,"c",{slot:"afterColor"}):void 0,he=this.alpha?this.alpha.flow(E,"f"):void 0,ce=this.alphaOverride?this.alphaOverride.flow(E,"f"):void 0;E.requires.transparent=he!==void 0,E.addParsCode(["varying vec3 vWPosition;","uniform vec3 emissive;","uniform float penumbraSize[5];","uniform sampler2D aoMap;","uniform bool aoEnabled;","#include <normal_pars_fragment>","#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <lights_phong_pars_fragment>","#include <shadowmap_pars_fragment>","#include <dithering_pars_fragment>"].join("\n"));let ue=["#include <normal_fragment_begin>","\n\t\t\t\t// NOTE: gl_FrontFacing alternative using face normal estimation.\n\t\t\t\tvec3 viewdx = dFdx(vViewPosition);\n\t\t\t\tvec3 viewdy = dFdy(vViewPosition);\n\t\t\t\tvec3 faceNormal = normalize(cross(viewdx,viewdy));\n\t\t\t\tif (dot(normal, faceNormal) < 0.0) {\n\t\t\t\t\tnormal *= -1.0;\n\t\t\t\t}\n\t\t\t\t","\tBlinnPhongMaterial material;"];if(this.bumpMap){E.include(fk.dHdxy),E.include(fk.perturbNormalArb);let O=this.bumpMap.texture.flow(E,"t"),R=this.bumpMap.flow(E,"v3"),z=this.bumpMapIntensity?this.bumpMapIntensity.flow(E,"f").result:"1.0",V="";V=this.bumpMap.projection.value===4?`\n\t\t\t\t\tvec3 bumpNormal = vec3(0.0);\n\t\t\t\t\t{\n\t\t\t\t\t\tvec2 uv0 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs0;\n\t\t\t\t\t\tvec2 uv1 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs1;\n\t\t\t\t\t\tvec2 uv2 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs2;\n\t\t\t\t\t\tvec3 weights = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_triplanarWeights;\n\n\t\t\t\t\t\tvec2 grad0 = dHdxy(${O.result}, uv0, ${z});\n\t\t\t\t\t\tvec3 n0 = perturbNormalArb(-vViewPosition, normal, grad0, faceDirection);\n\n\t\t\t\t\t\tvec2 grad1 = dHdxy(${O.result}, uv1, ${z});\n\t\t\t\t\t\tvec3 n1 = perturbNormalArb(-vViewPosition, normal, grad1, faceDirection);\n\n\t\t\t\t\t\tvec2 grad2 = dHdxy(${O.result}, uv2, ${z});\n\t\t\t\t\t\tvec3 n2 = perturbNormalArb(-vViewPosition, normal, grad2, faceDirection);\n\t\t\t\t\t\t\n\t\t\t\t\t\tbumpNormal = n0 * weights.z + n1 * weights.x + n2 * weights.y;\n\t\t\t\t\t\tbumpNormal = normalize(bumpNormal);\n\t\t\t\t\t}\n\n\t\t\t\t\tnormal = bumpNormal;\n\t\t\t\t\t`:`\n\t\t\t\t\tvec2 bumpMapCachedUv = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs;\n\t\t\t\t\tvec2 grad = dHdxy(${O.result}, bumpMapCachedUv, ${z});\n\t\t\t\t\tnormal = perturbNormalArb( - vViewPosition, normal, grad, faceDirection );\n\t\t\t\t\t`,ue.push(`// Call the Texture Layer's function once here so that it writes out its procedural UV coordinates\n\t\t\t\t\t${R.result};\n\t\t\t\t\t${V}\n\t\t\t\t\t`)}ue.push(z.code,"\tvec3 diffuseColor = "+z.result+";","\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );","\tvec3 totalEmissiveRadiance = emissive;",V.code,"\tvec3 specular = "+V.result+";",j.code,"\tfloat shininess = max( 0.0001, "+j.result+" );","\tfloat specularStrength = 1.0;"),he&&ue.push(he.code,"#ifdef ALPHATEST","if ( "+he.result+" <= ALPHATEST ) discard;","#endif"),ue.push("material.diffuseColor = diffuseColor;"),ue.push("material.specularColor = specular;","material.specularShininess = shininess;","material.specularStrength = specularStrength;","#include <lights_fragment_begin>","#include <lights_fragment_end>"),ue.push("vec3 ao = aoEnabled && "+R.result+" ? tex2D(aoMap, gl_FragCoord.xy / resolution).rgb : vec3(1.0);","vec3 outgoingLight = ((reflectedLight.directDiffuse + reflectedLight.indirectDiffuse)) + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;");let fe="1.0";this.mask&&(this.mask.analyze(E),fe=`luminance(${this.mask.flow(E,"v3").result})`),ue.push(`\n\t\t\t\tif (outgoingLight != diffuseColor) {\n\t\t\t\t\tfloat lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );\n\t\t\t\t\taccumAlpha += ( 1.0 - accumAlpha ) * ${Y.result} * ${fe} * lightAccu;\n\t\t\t\t\toutgoingLight = spe_blend( diffuseColor, outgoingLight, ${Y.result} * ${fe}, ${ee.result} );\n\t\t\t\t\t\n\t\t\t\t\toutgoingLight *= ao;\n\t\t\t\t}\n\t\t\t\t`),se&&ue.push(se.code,`outgoingLight = spe_blend(outgoingLight, ${se.result}, 1.0, SPE_BLENDING_NORMAL);`),he?ue.push(`gl_FragColor = vec4( outgoingLight, accumAlpha * ${he.result});`):ue.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),ce&&ue.push(`gl_FragColor.a *= ${ce.result};`),ue.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),O=ue.join("\n")}return O}};var gk=class extends WF{constructor(){super("standard");this.nodeType="Standard";this.color=new _U(yT),this.roughness=new GN(.3),this.metalness=new GN(0),this.reflectivity=new GN(.5),this.previousModelViewMatrix=new IU,this.previouseProjectionMatrix=new IU,this.shadingAlpha=new GN(1),this.shadingBlend=new AU(0),this.occlusion=new MU(!0)}get category(){return"physical"}build(E){let O;if(E.define("STANDARD"),E.requires.lights=!0,E.extensions.derivatives=!0,E.extensions.shaderTextureLOD=!0,E.isShader("vertex")){let R=this.position?this.position.analyzeAndFlow(E,"v3",{cache:"position"}):void 0;E.mergeUniform({frameIndex:ck.frameIndex}),E.mergeUniform({resolution:ck.resolution}),E.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),E.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),E.mergeUniform(ro.merge([Fc.fog,Fc.lights])),Fc.LTC_1&&(E.uniforms.ltc_1={value:void 0},E.uniforms.ltc_2={value:void 0}),E.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <skinning_pars_vertex>","#include <normal_pars_vertex>","#include <morphtarget_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join("\n"));let z=["#include <beginnormal_vertex>","#include <morphnormal_vertex>","\n\t\t\t\t#include <skinbase_vertex>\n\t\t\t\t#include <skinnormal_vertex>\n\t\t\t\t#if !defined( USE_LAYER_DISPLACE )\n\t\t\t\t\t#include <defaultnormal_vertex>\n\t\t\t\t#endif\n\n\t\t\t\tvec3 displaced_position = position;\n\t\t\t\tvec3 displaced_normal = objectNormal;\n\n\t\t\t\t#if defined( USE_LAYER_DISPLACE )\n\t\t\t\t\tvec3 transformed;\n\t\t\t\t\tvec3 transformedNormal;\n\t\t\t\t#endif\n\t\t\t\t","#include <normal_vertex>","\n\t\t\t\t#if !defined( USE_LAYER_DISPLACE )\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t#endif /* !USE_LAYER_DISPLACE */\n\t\t\t\t"];R&&z.push(R.code,R.result?"displaced_position = "+R.result+";":""),z.push("transformed = displaced_position;","#include <morphtarget_vertex>","#include <skinning_vertex>","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),z.push("#include <project_vertex>","#include <fog_vertex>","#include <clipping_planes_vertex>","\tvViewPosition = - mvPosition.xyz;","#include <worldpos_vertex>","#include <shadowmap_vertex>"),z.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),O=z.join("\n")}else{E.mergeUniform({penumbraSize:ck.penumbraSize}),E.mergeUniform({frameIndex:ck.frameIndex}),E.mergeUniform({aoMap:ck.aoRenderTarget}),E.mergeUniform({aoEnabled:ck.aoEnabled});let R={gamma:!0};this.color===void 0&&(this.color=new _U(yT)),this.color.analyze(E,{slot:"color",context:R}),this.roughness.analyze(E),this.metalness.analyze(E);let z=this.occlusion.flow(E,"b",{slot:"occlusion"});this.shadingAlpha.analyze(E),this.shadingBlend.analyze(E),this.afterColor&&this.afterColor.analyze(E,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(E),this.reflectivity&&this.reflectivity.analyze(E);let V=this.color.flow(E,"c",{slot:"color",context:R}),j=this.roughness.flow(E,"f"),Y=this.metalness.flow(E,"f"),ee=this.shadingAlpha.flow(E,"f"),se=this.shadingBlend.flow(E,"i"),he=this.afterColor?this.afterColor.flow(E,"c",{slot:"afterColor"}):void 0,ce=this.alpha?this.alpha.flow(E,"f"):void 0,ue=this.alphaOverride?this.alphaOverride.flow(E,"f"):void 0,fe=this.reflectivity?this.reflectivity.flow(E,"f"):void 0;E.requires.transparent=ce!==void 0,E.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","uniform float penumbraSize[5];","uniform sampler2D aoMap;","uniform bool aoEnabled;","#include <normal_pars_fragment>","#include <dithering_pars_fragment>","#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <lights_physical_pars_fragment>","#include <shadowmap_pars_fragment>"].join("\n"));let ve=["#include <clipping_planes_fragment>","\t#include <normal_fragment_begin>","\n\t\t\t\t// NOTE: gl_FrontFacing alternative using face normal estimation.\n\t\t\t\tvec3 viewdx = dFdx(vViewPosition);\n\t\t\t\tvec3 viewdy = dFdy(vViewPosition);\n\t\t\t\tvec3 faceNormal = normalize(cross(viewdx,viewdy));\n\t\t\t\tif (dot(normal, faceNormal) < 0.0) {\n\t\t\t\t\tnormal *= -1.0;\n\t\t\t\t}\n\t\t\t\t","\tPhysicalMaterial material;","\tmaterial.diffuseColor = vec3( 1.0 );"];if(this.bumpMap){E.include(fk.dHdxy),E.include(fk.perturbNormalArb);let O=this.bumpMap.texture.flow(E,"t"),R=this.bumpMap.flow(E,"v3"),z=this.bumpMapIntensity?this.bumpMapIntensity.flow(E,"f").result:"1.0",V="";V=this.bumpMap.projection.value===4?`\n\t\t\t\t\tvec3 bumpNormal = vec3(0.0);\n\t\t\t\t\t{\n\t\t\t\t\t\tvec2 uv0 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs0;\n\t\t\t\t\t\tvec2 uv1 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs1;\n\t\t\t\t\t\tvec2 uv2 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs2;\n\t\t\t\t\t\tvec3 weights = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_triplanarWeights;\n\n\t\t\t\t\t\tvec2 grad0 = dHdxy(${O.result}, uv0, ${z});\n\t\t\t\t\t\tvec3 n0 = perturbNormalArb(-vViewPosition, normal, grad0, faceDirection);\n\n\t\t\t\t\t\tvec2 grad1 = dHdxy(${O.result}, uv1, ${z});\n\t\t\t\t\t\tvec3 n1 = perturbNormalArb(-vViewPosition, normal, grad1, faceDirection);\n\n\t\t\t\t\t\tvec2 grad2 = dHdxy(${O.result}, uv2, ${z});\n\t\t\t\t\t\tvec3 n2 = perturbNormalArb(-vViewPosition, normal, grad2, faceDirection);\n\t\t\t\t\t\t\n\t\t\t\t\t\tbumpNormal = n0 * weights.z + n1 * weights.x + n2 * weights.y;\n\t\t\t\t\t\tbumpNormal = normalize(bumpNormal);\n\t\t\t\t\t}\n\n\t\t\t\t\tnormal = bumpNormal;\n\t\t\t\t\t`:`\n\t\t\t\t\tvec2 bumpMapCachedUv = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs;\n\t\t\t\t\tvec2 grad = dHdxy(${O.result}, bumpMapCachedUv, ${z});\n\t\t\t\t\tnormal = perturbNormalArb( - vViewPosition, normal, grad, faceDirection );\n\t\t\t\t\t`,ve.push(`// Call the Texture Layer's function once here so that it writes out its procedural UV coordinates\n\t\t\t\t\t${R.result};\n\t\t\t\t\t${V}\n\t\t\t\t\t`)}if(ve.push(V.code,"\tvec3 diffuseColor = "+V.result+";","\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );",Y.code,"\tfloat metalnessFactor = "+Y.result+";"),this.roughnessMap){let O=this.roughnessMap.texture.flow(E,"t"),R=this.roughnessMap.flow(E,"v3"),z="";z=this.roughnessMap.projection.value===4?`\n\t\t\t\t\tfloat roughnessChange = 1.0;\n\t\t\t\t\t{\n\t\t\t\t\t\tvec2 uv0 = g${this.roughnessMap.uuid.toString().replace(/-/g,"")}_writeUvs0;\n\t\t\t\t\t\tvec2 uv1 = g${this.roughnessMap.uuid.toString().replace(/-/g,"")}_writeUvs1;\n\t\t\t\t\t\tvec2 uv2 = g${this.roughnessMap.uuid.toString().replace(/-/g,"")}_writeUvs2;\n\t\t\t\t\t\tvec3 weights = g${this.roughnessMap.uuid.toString().replace(/-/g,"")}_triplanarWeights;\n\n\t\t\t\t\t\tfloat r0 = luminance(texture(${O.result}, uv0).rgb) * roughnessScale;\n\t\t\t\t\t\tfloat r1 = luminance(texture(${O.result}, uv1).rgb) * roughnessScale;\n\t\t\t\t\t\tfloat r2 = luminance(texture(${O.result}, uv2).rgb) * roughnessScale;\n\n\t\t\t\t\t\troughnessChange = (r0 * weights.z + r1 * weights.x + r2 * weights.y);\n\t\t\t\t\t}\n\t\t\t\t\tfloat roughnessFactor = roughnessChange * ${j.result};\n\t\t\t\t\t`:`\n\t\t\t\t\tvec2 roughnessMapCachedUv = g${this.roughnessMap.uuid.toString().replace(/-/g,"")}_writeUvs;\n\n\t\t\t\t\tvec4 vals = texture(${O.result},  roughnessMapCachedUv);\n\t\t\t\t\tfloat roughnessFactor = luminance(vals.rgb) * ${j.result};\n\t\t\t\t\t`,ve.push(`// Call the Texture Layer's function once here so that it writes out its procedural UV coordinates\n\t\t\t\t\t${R.result};\n\n\t\t\t\t\tconst float roughnessScale = 1.0;\n\n\t\t\t\t\t${z}\n\t\t\t\t`)}else ve.push(j.code,"\tfloat roughnessFactor = "+j.result+";");ce&&ve.push(ce.code,"#ifdef ALPHATEST","\tif ( "+ce.result+" <= ALPHATEST ) discard;","#endif"),ve.push("vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );"),ve.push("material.diffuseColor = diffuseColor * ( 1.0 - metalnessFactor );","material.roughness = max( roughnessFactor, 0.0525 );","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.roughness = clamp( roughnessFactor, 0.04, 1.0 );"),fe?ve.push(fe.code,"material.specularColor = mix( vec3( 0.16 * pow2( "+fe.result+" ) ), diffuseColor, metalnessFactor );"):ve.push("material.specularColor = mix( vec3( 0.04 ), diffuseColor, metalnessFactor );"),ve.push("#include <lights_fragment_begin>"),ve.push("#include <lights_fragment_end>"),ve.push("vec3 ao = aoEnabled && "+z.result+" ? tex2D(aoMap, gl_FragCoord.xy / resolution).rgb : vec3(1.0);","vec3 outgoingLight = ((reflectedLight.directDiffuse + reflectedLight.indirectDiffuse)) + reflectedLight.directSpecular + reflectedLight.indirectSpecular;");let we="1.0";this.mask&&(this.mask.analyze(E),we=`luminance(${this.mask.flow(E,"v3").result})`),ve.push(`\n\t\t\t\tif (outgoingLight != diffuseColor) {\n\t\t\t\t\tfloat lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );\n\t\t\t\t\taccumAlpha += ( 1.0 - accumAlpha ) * ${ee.result} * ${we} * lightAccu;\n\t\t\t\t\toutgoingLight = spe_blend( diffuseColor, outgoingLight, ${ee.result} * ${we}, ${se.result} );\n\t\t\t\t\t\n\t\t\t\t\toutgoingLight *= ao;\n\t\t\t\t}\n\t\t\t\t`),he&&ve.push(he.code,`outgoingLight = spe_blend(outgoingLight, ${he.result}, 1.0, SPE_BLENDING_NORMAL);`),ce?ve.push(`gl_FragColor = vec4( outgoingLight, accumAlpha * ${ce.result} );`):ve.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),ue&&ve.push(`gl_FragColor.a *= ${ue.result};`),ve.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),O=ve.join("\n")}return O}};var vk=class extends WF{constructor(){super("toon");this.nodeType="Toon";this.color=new _U(yT),this.specular=new _U(1118481),this.shininess=new GN(30),this.previousModelViewMatrix=new IU,this.previouseProjectionMatrix=new IU,this.shadingAlpha=new GN(1),this.shadingBlend=new AU(0)}get category(){return"toon"}build(E){let O;if(E.define("TOON"),E.requires.lights=!0,E.extensions.derivatives=!0,E.isShader("vertex")){let R=this.position?this.position.analyzeAndFlow(E,"v3",{cache:"position"}):void 0;E.mergeUniform({frameIndex:ck.frameIndex}),E.mergeUniform({resolution:ck.resolution}),E.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),E.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),E.mergeUniform(ro.merge([Fc.fog,Fc.lights])),E.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <skinning_pars_vertex>","#include <normal_pars_vertex>","#include <morphtarget_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join("\n"));let z=["#include <beginnormal_vertex>","#include <morphnormal_vertex>","\n\t\t\t\t#include <skinbase_vertex>\n\t\t\t\t#include <skinnormal_vertex>\n\t\t\t\t#ifndef USE_LAYER_DISPLACE\n\t\t\t\t\t#include <defaultnormal_vertex>\n\t\t\t\t#endif\n\n\t\t\t\tvec3 displaced_position = position;\n\t\t\t\tvec3 displaced_normal = objectNormal;\n\n\t\t\t\t#ifdef USE_LAYER_DISPLACE\n\t\t\t\t\tvec3 transformed;\n\t\t\t\t\tvec3 transformedNormal;\n\t\t\t\t#endif\n\t\t\t\t","#include <normal_vertex>","\n\t\t\t\t#ifndef USE_LAYER_DISPLACE\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t#endif\n\t\t\t\t"];R&&z.push(R.code,R.result?"displaced_position = "+R.result+";":""),z.push("transformed = displaced_position;","#include <morphtarget_vertex>","#include <skinning_vertex>","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),z.push("\t#include <project_vertex>","\t#include <fog_vertex>","\t#include <clipping_planes_vertex>","\tvViewPosition = - mvPosition.xyz;","\t#include <worldpos_vertex>","\t#include <shadowmap_vertex>","\t#include <fog_vertex>"),z.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),O=z.join("\n")}else{E.mergeUniform({penumbraSize:ck.penumbraSize}),E.mergeUniform({frameIndex:ck.frameIndex}),E.mergeUniform({aoMap:ck.aoRenderTarget}),E.mergeUniform({aoEnabled:ck.aoEnabled}),this.color===void 0&&(this.color=new _U(yT)),this.color.analyze(E,{slot:"color"}),this.specular.analyze(E),this.shininess.analyze(E),this.shadingAlpha.analyze(E),this.shadingBlend.analyze(E),this.afterColor&&this.afterColor.analyze(E,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(E);let R=this.color.flow(E,"c",{slot:"color"}),z=this.specular.flow(E,"c"),V=this.shininess.flow(E,"f"),j=this.shadingAlpha.flow(E,"f"),Y=this.shadingBlend.flow(E,"i"),ee=this.afterColor?this.afterColor.flow(E,"c",{slot:"afterColor"}):void 0,se=this.alpha?this.alpha.flow(E,"f"):void 0,he=this.alphaOverride?this.alphaOverride.flow(E,"f"):void 0;E.requires.transparent=se!==void 0,E.addParsCode(["uniform float penumbraSize[5];","uniform sampler2D aoMap;","uniform bool aoEnabled;","varying vec3 vWPosition;","#include <normal_pars_fragment>","#include <gradientmap_pars_fragment>","#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <dithering_pars_fragment>","\n\t\t\t\t\tvarying vec3 vViewPosition;\n\t\t\t\t\tstruct ToonMaterial {\n\t\t\t\t\t\tvec3\tdiffuseColor;\n\t\t\t\t\t\tvec3\tspecularColor;\n\t\t\t\t\t\tfloat\tspecularShininess;\n\t\t\t\t\t\tfloat\tspecularStrength;\n\t\t\t\t\t};\n\t\t\t\t\tvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\t\t\t\t\t\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t\t\t\n\t\t\t\t\t\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\t\t\t\t\t\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;\n\t\t\t\t\t}\n\t\t\t\t\tvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\t\t\t\t\t\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\t\t\t\t\t}\n\t\t\t\t\t#define RE_Direct\t\t\t\tRE_Direct_Toon\n\t\t\t\t\t#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n\t\t\t\t\t#define Material_LightProbeLOD( material )\t(0)\n\t\t\t\t\t","#include <shadowmap_pars_fragment>","#include <bumpmap_pars_fragment>","#include <normalmap_pars_fragment>"].join("\n"));let ce=["#include <normal_fragment_begin>","\n\t\t\t\t// NOTE: gl_FrontFacing alternative using face normal estimation.\n\t\t\t\tvec3 viewdx = dFdx(vViewPosition);\n\t\t\t\tvec3 viewdy = dFdy(vViewPosition);\n\t\t\t\tvec3 faceNormal = normalize(cross(viewdx,viewdy));\n\t\t\t\tif (dot(normal, faceNormal) < 0.0) {\n\t\t\t\t\tnormal *= -1.0;\n\t\t\t\t}\n\t\t\t\t","\tToonMaterial material;"];if(this.bumpMap){E.include(fk.dHdxy),E.include(fk.perturbNormalArb);let O=this.bumpMap.texture.flow(E,"t"),R=this.bumpMap.flow(E,"v3"),z=this.bumpMapIntensity?this.bumpMapIntensity.flow(E,"f").result:"1.0",V="";V=this.bumpMap.projection.value===4?`\n\t\t\t\t\tvec3 bumpNormal = vec3(0.0);\n\t\t\t\t\t{\n\t\t\t\t\t\tvec2 uv0 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs0;\n\t\t\t\t\t\tvec2 uv1 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs1;\n\t\t\t\t\t\tvec2 uv2 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs2;\n\t\t\t\t\t\tvec3 weights = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_triplanarWeights;\n\n\t\t\t\t\t\tvec2 grad0 = dHdxy(${O.result}, uv0, ${z});\n\t\t\t\t\t\tvec3 n0 = perturbNormalArb(-vViewPosition, normal, grad0, faceDirection);\n\n\t\t\t\t\t\tvec2 grad1 = dHdxy(${O.result}, uv1, ${z});\n\t\t\t\t\t\tvec3 n1 = perturbNormalArb(-vViewPosition, normal, grad1, faceDirection);\n\n\t\t\t\t\t\tvec2 grad2 = dHdxy(${O.result}, uv2, ${z});\n\t\t\t\t\t\tvec3 n2 = perturbNormalArb(-vViewPosition, normal, grad2, faceDirection);\n\t\t\t\t\t\t\n\t\t\t\t\t\tbumpNormal = n0 * weights.z + n1 * weights.x + n2 * weights.y;\n\t\t\t\t\t\tbumpNormal = normalize(bumpNormal);\n\t\t\t\t\t}\n\n\t\t\t\t\tnormal = bumpNormal;\n\t\t\t\t\t`:`\n\t\t\t\t\tvec2 bumpMapCachedUv = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs;\n\t\t\t\t\tvec2 grad = dHdxy(${O.result}, bumpMapCachedUv, ${z});\n\t\t\t\t\tnormal = perturbNormalArb( - vViewPosition, normal, grad, faceDirection );\n\t\t\t\t\t`,ce.push(`// Call the Texture Layer's function once here so that it writes out its procedural UV coordinates\n\t\t\t\t\t${R.result};\n\t\t\t\t\t${V}\n\t\t\t\t\t`)}ce.push(R.code,"\tvec3 diffuseColor = "+R.result+";","\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );",z.code,"\tvec3 specular = "+z.result+";",V.code,"\tfloat shininess = max( 0.0001, "+V.result+" );","\tfloat specularStrength = 1.0;"),se&&ce.push(se.code,"#ifdef ALPHATEST","if ( "+se.result+" <= ALPHATEST ) discard;","#endif"),ce.push("material.diffuseColor = diffuseColor;"),ce.push("material.specularColor = specular;","material.specularShininess = shininess;","material.specularStrength = specularStrength;","#include <lights_fragment_begin>","#include <lights_fragment_end>"),ce.push("vec3 ao = aoEnabled ? tex2D(aoMap, gl_FragCoord.xy / resolution).rgb : vec3(1.0);","vec3 outgoingLight = ((reflectedLight.directDiffuse + reflectedLight.indirectDiffuse) * ao) + reflectedLight.directSpecular;");let ue="1.0";this.mask&&(this.mask.analyze(E),ue=`luminance(${this.mask.flow(E,"v3").result})`),ce.push(`\n\t\t\t\tif (outgoingLight != diffuseColor) {\n\t\t\t\t\tfloat lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );\n\t\t\t\t\taccumAlpha += ( 1.0 - accumAlpha ) * ${j.result} * ${ue} * lightAccu;\n\t\t\t\t\toutgoingLight = spe_blend( diffuseColor, outgoingLight, ${j.result} * ${ue}, ${Y.result} );\n\t\t\t\t}\n\t\t\t\t`),ee&&ce.push(ee.code,`outgoingLight = spe_blend(outgoingLight, ${ee.result}, 1.0, SPE_BLENDING_NORMAL);`),se?ce.push(`gl_FragColor = vec4( outgoingLight, accumAlpha * ${se.result} );`):ce.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),he&&ce.push(`gl_FragColor.a *= ${he.result};`),ce.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),O=ce.join("\n")}return O}};var yk=class{constructor(E=1e4){this.timeout=E;this.cache=new Map;this.head={data:null,time:0,src:null,next:null,prev:null};this.tail={data:null,time:1/0,src:null,next:null,prev:null};this.hasClean=!1;this.head.next=this.tail,this.tail.prev=this.head}log(...E){}remove(E){let O=this.cache.get(E);O&&(this.dispose(E,O.data),this.cache.delete(E),O.prev.next=O.next,O.next.prev=O.prev)}scheduleCleanup(){this.hasClean||(this.log("scheduled cleanup"),this.hasClean=!0,setTimeout((()=>{this.hasClean=!1,this.log("cleaning");let E=Date.now(),O=this.head.next;for(;O.time<E-this.timeout;)this.dispose(O.src,O.data),this.cache.delete(O.src),O=O.next,O.prev=this.head,this.head.next=O;this.head.next!==this.tail?this.scheduleCleanup():this.log("no more cleanup")}),this.timeout+1e3))}has(E){return this.cache.get(E)?.data}load(E){let O=Date.now(),R=this.cache.get(E);return R===void 0?(R={data:this.create(E),src:E,time:O,next:null,prev:null},this.cache.set(E,R)):(R.time=O,R.prev.next=R.next,R.next.prev=R.prev),R.prev=this.tail.prev,R.next=this.tail,this.tail.prev.next=R,this.tail.prev=R,this.scheduleCleanup(),R.data}};var xk,bk=class extends yk{create(E){return URL.createObjectURL(new Blob([E]))}dispose(E,O){URL.revokeObjectURL(O)}};function NR(E){return typeof E=="string"?E:(xk||(xk=new bk),xk.load(E))}var wk=class{constructor(E,O){this.data=E;this.cache=O;this.refCount=0}deref(){if(this.refCount===0&&!1)throw new Error("ref count -1?");this.refCount-=1,this.refCount===0&&(this.cache.remove(this),this.dispose())}dispose(){if(this.refCount!==0&&!1)throw new Error("ref count is not 0")}},Sk=class{constructor(){this.cache=new Map}remove(E){if(this.cache.delete(E.data)===!1&&!1)throw new Error("ref count remove non-exists")}load(E){let O=this.cache.get(E);return O===void 0&&(O=this.create(E),this.cache.set(E,O)),O.refCount+=1,O}};var _k=class extends wk{constructor(E,O){super(E,O.imageHolderCache);this.data=E;this.shared=O;this.loaded=!1;this.isVideo=!1;this.isBuffer=!1;this._cache={1e3:{},1001:{},1002:{}};this.isVideo=E.type==="video",this.isBuffer=E.isWebGLRenderTarget===!0,this.loadPromise=this.updateSrc(this.isBuffer?E:E.data)}async updateSrc(E){if(typeof document>"u")return;this.disposeTextures(),this.loaded=!1;let r=()=>{this.loaded=!0;for(let E of Object.values(this._cache))for(let O of Object.values(E))for(let E of Object.values(O))E&&(E.image=this.img,E.needsUpdate=!0);this.shared.requestRender()};if(this.isBuffer)this.img=E,this.loaded=!0;else if(this.isVideo){if(this.img=document.createElement("video"),this.img.preload="auto",this.img.playsInline=!0,this.img.currentTime=.01,typeof E!="string"){var O=new FileReader;O.readAsDataURL(new Blob([E],{type:"video/mp4"}));let R;await new Promise((E=>{O.onloadend=O=>{R=O.target?.result,E(null)}})),this.img.src=R}else this.img.src=E;this.img.onloadeddata=()=>{r()}}else this.img=new Image,this.img.src=NR(E),this.img.onload=r,await new Promise((E=>{this.img.onload=()=>{r(),E(null)}}))}getTexture(E,O=1008,R=1006){let z=this._cache[E]?.[O]?.[R];if(z)return z;{let z;return z=this.isBuffer?this.img.texture:this.isVideo?new Su(this.img,void 0,E,E):new Fn(this.img,void 0,E,E,R,O),this.loaded&&(z.needsUpdate=!0),this._cache[E]===void 0&&(this._cache[E]={}),this._cache[E][O]===void 0&&(this._cache[E][O]={}),this._cache[E][O][R]=z,z}}setNeedsUpdate(E){for(let O of Object.values(this._cache))for(let R of Object.values(O))for(let O of Object.values(R))O&&(O.needsUpdate=E)}disposeTextures(){for(let[E,O]of Object.entries(this._cache))for(let[R,z]of Object.entries(O))for(let[O,V]of Object.entries(z))V?.dispose(),this._cache[E]!==void 0&&this._cache[E][R]!==void 0&&(this._cache[E][R][O]=void 0)}dispose(){super.dispose(),this.disposeTextures()}};var Ak=class extends _k{};function EE(E,O){var R=dY(O);return R.formatToParts?uY(R,E):hY(R,E)}var Mk={year:0,month:1,day:2,hour:3,minute:4,second:5};function uY(E,O){try{for(var R=E.formatToParts(O),z=[],V=0;V<R.length;V++){var j=Mk[R[V].type];j>=0&&(z[j]=parseInt(R[V].value,10))}return z}catch(E){if(E instanceof RangeError)return[NaN];throw E}}function hY(E,O){var R=E.format(O).replace(/\u200E/g,""),z=/(\d+)\/(\d+)\/(\d+),? (\d+):(\d+):(\d+)/.exec(R);return[z[3],z[1],z[2],z[4],z[5],z[6]]}var Ek={};function dY(E){if(!Ek[E]){var O=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:"America/New_York",year:"numeric",month:"numeric",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}).format(new Date("2014-06-25T04:00:00.123Z")),R=O==="06/25/2014, 00:00:00"||O==="06/25/2014 00:00:00";Ek[E]=R?new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:E,year:"numeric",month:"numeric",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}):new Intl.DateTimeFormat("en-US",{hourCycle:"h23",timeZone:E,year:"numeric",month:"numeric",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})}return Ek[E]}function nx(E,O,R,z,V,j,Y){var ee=new Date(0);return ee.setUTCFullYear(E,O,R),ee.setUTCHours(z,V,j,Y),ee}var Ck=36e5,Tk=6e4,Pk={timezone:/([Z+-].*)$/,timezoneZ:/^(Z)$/,timezoneHH:/^([+-]\d{2})$/,timezoneHHMM:/^([+-]\d{2}):?(\d{2})$/};function Dm(E,O,R){var z,V;if(!E||(z=Pk.timezoneZ.exec(E),z))return 0;var j;if(z=Pk.timezoneHH.exec(E),z)return j=parseInt(z[1],10),VR(j)?-j*Ck:NaN;if(z=Pk.timezoneHHMM.exec(E),z){j=parseInt(z[1],10);var Y=parseInt(z[2],10);return VR(j,Y)?(V=Math.abs(j)*Ck+Y*Tk,j>0?-V:V):NaN}if(gY(E)){O=new Date(O||Date.now());var ee=R?O:pY(O),se=ME(ee,E),he=R?se:mY(O,se,E);return-he}return NaN}function pY(E){return nx(E.getFullYear(),E.getMonth(),E.getDate(),E.getHours(),E.getMinutes(),E.getSeconds(),E.getMilliseconds())}function ME(E,O){var R=EE(E,O),z=nx(R[0],R[1]-1,R[2],R[3]%24,R[4],R[5],0).getTime(),V=E.getTime(),j=V%1e3;return V-=j>=0?j:1e3+j,z-V}function mY(E,O,R){var z=E.getTime(),V=z-O,j=ME(new Date(V),R);if(O===j)return O;V-=j-O;var Y=ME(new Date(V),R);return j===Y?j:Math.max(j,Y)}function VR(E,O){return-23<=E&&E<=23&&(O==null||0<=O&&O<=59)}var Dk={};function gY(E){if(Dk[E])return!0;try{return new Intl.DateTimeFormat(void 0,{timeZone:E}),Dk[E]=!0,!0}catch{return!1}}var Ik=Za(se(),1),Ok=Za(he(),1);var Rk=/(Z|[+-]\d{2}(?::?\d{2})?| UTC| [a-zA-Z]+\/[a-zA-Z_]+(?:\/[a-zA-Z_]+)?)$/,Lk=Rk;var Bk=36e5,Fk=6e4,Nk=2,Uk={dateTimePattern:/^([0-9W+-]+)(T| )(.*)/,datePattern:/^([0-9W+-]+)(.*)/,plainTime:/:/,YY:/^(\d{2})$/,YYY:[/^([+-]\d{2})$/,/^([+-]\d{3})$/,/^([+-]\d{4})$/],YYYY:/^(\d{4})/,YYYYY:[/^([+-]\d{4})/,/^([+-]\d{5})/,/^([+-]\d{6})/],MM:/^-(\d{2})$/,DDD:/^-?(\d{3})$/,MMDD:/^-?(\d{2})-?(\d{2})$/,Www:/^-?W(\d{2})$/,WwwD:/^-?W(\d{2})-?(\d{1})$/,HH:/^(\d{2}([.,]\d*)?)$/,HHMM:/^(\d{2}):?(\d{2}([.,]\d*)?)$/,HHMMSS:/^(\d{2}):?(\d{2}):?(\d{2}([.,]\d*)?)$/,timeZone:Lk};function IE(E,O){if(arguments.length<1)throw new TypeError("1 argument required, but only "+arguments.length+" present");if(E===null)return new Date(NaN);var R=O||{},z=R.additionalDigits==null?Nk:(0,Ik.default)(R.additionalDigits);if(z!==2&&z!==1&&z!==0)throw new RangeError("additionalDigits must be 0, 1 or 2");if(E instanceof Date||typeof E=="object"&&Object.prototype.toString.call(E)==="[object Date]")return new Date(E.getTime());if(typeof E=="number"||Object.prototype.toString.call(E)==="[object Number]")return new Date(E);if(!(typeof E=="string"||Object.prototype.toString.call(E)==="[object String]"))return new Date(NaN);var V=SY(E),j=wY(V.date,z),Y=j.year,ee=j.restDateString,se=AY(ee,Y);if(isNaN(se))return new Date(NaN);if(se){var he,ce=se.getTime(),ue=0;if(V.time&&(ue=EY(V.time),isNaN(ue)))return new Date(NaN);if(V.timeZone||R.timeZone){if(he=Dm(V.timeZone||R.timeZone,new Date(ce+ue)),isNaN(he))return new Date(NaN)}else he=(0,Ok.default)(new Date(ce+ue)),he=(0,Ok.default)(new Date(ce+ue+he));return new Date(ce+ue+he)}return new Date(NaN)}function SY(E){var O,R={},z=Uk.dateTimePattern.exec(E);if(z?(R.date=z[1],O=z[3]):(z=Uk.datePattern.exec(E),z?(R.date=z[1],O=z[2]):(R.date=null,O=E)),O){var V=Uk.timeZone.exec(O);V?(R.time=O.replace(V[1],""),R.timeZone=V[1].trim()):R.time=O}return R}function wY(E,O){var R,z=Uk.YYY[O],V=Uk.YYYYY[O];if(R=Uk.YYYY.exec(E)||V.exec(E),R){var j=R[1];return{year:parseInt(j,10),restDateString:E.slice(j.length)}}if(R=Uk.YY.exec(E)||z.exec(E),R){var Y=R[1];return{year:parseInt(Y,10)*100,restDateString:E.slice(Y.length)}}return{year:null}}function AY(E,O){if(O===null)return null;var R,z,V,j;if(E.length===0)return z=new Date(0),z.setUTCFullYear(O),z;if(R=Uk.MM.exec(E),R)return z=new Date(0),V=parseInt(R[1],10)-1,XR(O,V)?(z.setUTCFullYear(O,V),z):new Date(NaN);if(R=Uk.DDD.exec(E),R){z=new Date(0);var Y=parseInt(R[1],10);return CY(O,Y)?(z.setUTCFullYear(O,0,Y),z):new Date(NaN)}if(R=Uk.MMDD.exec(E),R){z=new Date(0),V=parseInt(R[1],10)-1;var ee=parseInt(R[2],10);return XR(O,V,ee)?(z.setUTCFullYear(O,V,ee),z):new Date(NaN)}if(R=Uk.Www.exec(E),R)return j=parseInt(R[1],10)-1,YR(O,j)?qR(O,j):new Date(NaN);if(R=Uk.WwwD.exec(E),R){j=parseInt(R[1],10)-1;var se=parseInt(R[2],10)-1;return YR(O,j,se)?qR(O,j,se):new Date(NaN)}return null}function EY(E){var O,R,z;if(O=Uk.HH.exec(E),O)return R=parseFloat(O[1].replace(",",".")),PE(R)?R%24*Bk:NaN;if(O=Uk.HHMM.exec(E),O)return R=parseInt(O[1],10),z=parseFloat(O[2].replace(",",".")),PE(R,z)?R%24*Bk+z*Fk:NaN;if(O=Uk.HHMMSS.exec(E),O){R=parseInt(O[1],10),z=parseInt(O[2],10);var V=parseFloat(O[3].replace(",","."));return PE(R,z,V)?R%24*Bk+z*Fk+V*1e3:NaN}return null}function qR(E,O,R){O=O||0,R=R||0;var z=new Date(0);z.setUTCFullYear(E,0,4);var V=z.getUTCDay()||7,j=O*7+R+1-V;return z.setUTCDate(z.getUTCDate()+j),z}var Vk=[31,28,31,30,31,30,31,31,30,31,30,31],eV=[31,29,31,30,31,30,31,31,30,31,30,31];function QR(E){return E%400===0||E%4===0&&E%100!==0}function XR(E,O,R){if(O<0||O>11)return!1;if(R!=null){if(R<1)return!1;var z=QR(E);if(z&&R>eV[O]||!z&&R>Vk[O])return!1}return!0}function CY(E,O){if(O<1)return!1;var R=QR(E);return!(R&&O>366||!R&&O>365)}function YR(E,O,R){return!(O<0||O>52||R!=null&&(R<0||R>6))}function PE(E,O,R){return!(E!=null&&(E<0||E>=25)||O!=null&&(O<0||O>=60)||R!=null&&(R<0||R>=60))}function ax(E,O,R){var z=IE(E,R),V=Dm(O,z,!0),j=new Date(z.getTime()-V),Y=new Date(0);return Y.setFullYear(j.getUTCFullYear(),j.getUTCMonth(),j.getUTCDate()),Y.setHours(j.getUTCHours(),j.getUTCMinutes(),j.getUTCSeconds(),j.getUTCMilliseconds()),Y}function Zi(E,O){return O.color(E)}function DE(E=new Date,O){let R=O.format,z=E.getSeconds(),V=E;O&&O.timeZone!==null&&(V=ax(new Date,O.timeZone));let j,Y=V.getHours(),ee=V.getMinutes();O.format12h24h==="12ampm"&&(j=Y>=12?"PM":"AM");let se=Y;O.format12h24h!=="24"&&(se=Y%12,se===0&&(se=12));let he,ce;switch(R){case"HH:mm:ss":he=[se,ee,z];break;case"HH:mm":he=[se,ee];break;case"HH":he=[se],j=void 0;break;case"mm":he=[ee],j=void 0;break;case"ss":he=[z],j=void 0;break;case"year":ce=V.getFullYear();break;case"month":ce=V.getMonth()+1;break;case"dayOfYear":ce=Math.floor((V.getTime()-new Date(V.getFullYear(),0,0).getTime())/864e5);break;case"dayOfMonth":ce=V.getDate();break;case"secondOfDay":ce=Y*60*60+ee*60+z;break;default:console.error("Unknown time format",R),ce=0;break}return he!==void 0?{textValue:he,suffix:j}:ce}function ZR(E,O){switch(E.type){case"fresnel":return IY(E,O);case"gradient":return DY(E,O);case"depth":return OY(E,O);case"normal":return RY(E,O);case"noise":return LY(E,O);case"rainbow":return BY(E,O);case"toon":return NY(E,O);case"outline":return FY(E,O);case"transmission":return VY(E,O);case"color":return _Y(E,O);case"pattern":return UY(E,O)}}function PY(E){return{type:E.type}}function Zs(E,O){let{alpha:R,mode:z,isMask:V}=E,j=typeof R=="string"?(Number(O.getVariable(R))??100)/100:R;return{...PY(E),alpha:j,mode:z,isMask:V}}function _Y(E,O){return{...Zs(E,O),color:Zi(E.color,O)}}function IY(E,O){let{bias:R,scale:z,intensity:V,factor:j,color:Y}=E;return{...Zs(E,O),color:Zi(Y,O),bias:R,scale:z,intensity:V,factor:j}}function DY(E,O){let{gradientType:R,smooth:z,colors:V,steps:j,angle:Y,offset:ee,morph:se}=E;return{...Zs(E,O),gradientType:R,smooth:z,colors:V.map((E=>new Nn(E[0],E[1],E[2],E[3]))),num:V.length,steps:j,offset:new bn(...ee),morph:new bn(...se),angle:Y}}function OY(E,O){let{gradientType:R,near:z,far:V,isVector:j,isWorldSpace:Y,origin:ee,direction:se,colors:he,steps:ce,smooth:ue}=E;return{...Zs(E,O),gradientType:R,near:z,far:V,isVector:j,isWorldSpace:Y,origin:new Wn(...ee),direction:se?new Wn(...se):new Wn(1,0,0),colors:he.map((E=>E!==void 0?new Nn(E[0],E[1],E[2],E[3]):new Nn(0,0,0,0))),steps:ce.slice(0,he.length),smooth:ue}}function RY(E,O){let{cnormal:R}=E;return{...Zs(E,O),cnormal:new Wn(R[0],R[1],R[2])}}function LY(E,O){return{...Zs(E,O),scale:E.scale,move:E.move,fA:new bn(...E.fA),fB:new bn(...E.fB),size:new Wn(...E.size),distortion:new bn(...E.distortion),colorA:Zi(E.colorA,O),colorB:Zi(E.colorB,O),colorC:Zi(E.colorC,O),colorD:Zi(E.colorD,O),noiseType:E.noiseType,voronoiStyle:E.voronoiStyle,highCut:E.highCut,lowCut:E.lowCut,smoothness:E.smoothness,seed:E.seed,quality:E.quality}}function BY(E,O){return{...Zs(E,O),filmThickness:E.filmThickness,movement:E.movement,wavelengths:new Wn(...E.wavelengths),noiseStrength:E.noiseStrength,noiseScale:E.noiseScale,offset:new Wn(...E.offset)}}function NY(E,O){return{...Zs(E,O),positioning:E.positioning,colors:E.colors.map((E=>new Nn(E[0],E[1],E[2],E[3]))),num:E.colors.length,steps:E.steps,source:new Wn(...E.source),isWorldSpace:E.isWorldSpace,noiseStrength:E.noiseStrength,noiseScale:E.noiseScale,shadowColor:Zi(E.shadowColor,O),offset:new Wn(...E.offset)}}function FY(E,O){return{...Zs(E,O),outlineColor:Zi(E.outlineColor,O),contourColor:Zi(E.contourColor,O),outlineWidth:E.outlineWidth,contourWidth:E.contourWidth,outlineThreshold:E.outlineThreshold,contourThreshold:E.contourThreshold,outlineSmoothing:E.outlineSmoothing,contourFrequency:E.contourFrequency,contourDirection:new Wn(...E.contourDirection),positionalLines:E.positionalLines,compensation:E.compensation}}function VY(E,O){return{...Zs(E,O),thickness:E.thickness,ior:E.ior,roughness:E.roughness}}function UY(E,O){return{...Zs(E,O),style:E.style,projection:E.projection,axis:E.axis,blending:E.blending,offset:new bn(...E.offset),colorA:Zi(E.colorA,O),colorB:Zi(E.colorB,O),frequency:new bn(...E.frequency),size:E.size,variation:E.variation,smoothness:E.smoothness,zigzag:E.zigzag,rotation:E.rotation,vertical:new bn(...E.vertical),horizontal:new bn(...E.horizontal),sides:E.sides}}var tV=class extends $F{};var iV={noise:["noiseType"],texture:["projection","axis","side"],video:["projection","axis","side"],displace:["noiseType"],light:["roughnessMap","bumpMap"],depth:["smooth","isWorldSpace","gradientType","isVector"],pattern:["style","projection","axis"]},rV={depth:["colors"]};function GY(E,O,R){if(O==="isMask")return!0;let z=iV[E.type],V=rV[E.type];if(V!==void 0){let z=E.color;if(V.includes(O)){let E=z[O]?.value?.length;if(E!==void 0&&E!==R.length)return!0}}return z!==void 0&&z.includes(O)}function OE(E,O,R){let z=R.uniforms[`f${R.id}_texture`];if(!z)return!1;let V=!1,j=E;if("image"in j){let E=j.image,R=O.image(E),V=z;V.image instanceof Ak||V.image.deref(),V.image=R}if("video"in j){let E=j.video,R=O.video(E),V=z;V.image instanceof Ak||V.image.deref(),V.image=R}if("wrapping"in j){let E=z;E.wrap=j.wrapping}if("minFilter"in j){let E=z;E.minFilter=j.minFilter}if("magFilter"in j){let E=z;E.magFilter=j.magFilter}if("rotation"in j&&R.uniforms[`f${R.id}_rotation`])return R.uniforms[`f${R.id}_rotation`].value=(j.rotation??0)*xn.DEG2RAD,V;if("repeat"in j||"offset"in j||"rotation"in j){let E="mat",O=R.uniforms[`f${R.id}_${E}`];"repeat"in j&&(O.repeat=j.repeat),"offset"in j&&(O.offset=j.offset),"rotation"in j&&(O.rotation=j.rotation??0),O.updateMatrix()}return V}function JR(E,O,R,z){let V=!1;for(let[j,Y]of Object.entries(E)){if(j==="bumpMap"||j==="roughnessMap"){V=!0;continue}if(!j||Y===void 0)continue;if(RE(j,R,z,O)){j==="visible"&&R.type==="light"&&(V=!0);continue}R.visible=z.visible;let E=R.uniforms[`f${R.id}_${j}`];if(!!E&&!(E instanceof CU))switch(V=V||GY(R,j,Y),E.constructor){case _U:if(typeof Y=="string"){let R=O.getColor(Y);R&&(E.value=R);break}{let O=Y;E.value instanceof tV?E.value=new $F(O.r,O.g,O.b,O.a):E.setRGBA(O);break}case tN:if(typeof Y=="string"){let R=O.getColor(Y);R&&(E.value=R);break}{let O=Y;E.value instanceof tV?E.value=new $F(O.r,O.g,O.b,O.a):E.value.setRGBA(O.r,O.g,O.b,O.a);break}case KF:{let O=Y;E.value.setX(O[0]),E.value.setY(O[1]);break}case JF:{let O=Y;E.value.setX(O[0]),E.value.setY(O[1]),E.value.setZ(O[2]);break}case jN:OE(Y,O,R);break;case RU:E.value=Y.map((E=>new Nn(...E)));break;default:E.value=Y;break}}return V}var Xl=(E,O,R)=>Math.max(0,Math.min(1,Number(O.getVariable(typeof E=="number"?E*100:E,R)??100)/100))??1,nV=class{constructor(E,O,R,z,V){this.id=E;this.uuid=O;this.data=R;this.uniforms={};for(let E in z)this.uniforms[`f${this.id}_${E}`]=z[E];for(let E in R)RE(E,this,R,V)}get type(){return this.data.type}static create(E,O,R,z){if(R.type==="light")return oV.createLightLayer(E,O,R,z);if(R.type==="texture"||R.type==="video"){let V=R.type==="texture"?z.uiBuffer(R.texture.image)??z.image(R.texture.image):z.video(R.texture.video),j=new PU(V,R.texture.wrapping,R.texture.minFilter??1008,R.texture.magFilter??1006),Y=new TU(V),ee=new OU(R.texture.repeat,R.texture.offset,R.texture.rotation??0),se=new GN(R.crop?1:0),he=new AU(R.projection??0),ce=new AU(["x","y","z"].indexOf(R.axis)??0),ue=new AU(R.side??0),fe=new KF(R.size?new bn(R.size[0],R.size[1]):new bn(100,100)),ve=new GN(R.blending??0),we=new GN(Xl(R.alpha,z)),Se=new AU(R.mode??0),_e=new MU(R.isMask??!1),Ae=new kU(j,Y,se,he,ce,ue,fe,ve,ee,we,Se,_e),Ce=new kN(Ae.calpha,"f");return new sV(E,O,R,{texture:j,textureSize:Y,crop:se,projection:he,axis:ce,side:ue,size:fe,blending:ve,mat:ee,alpha:we,mode:Se,isMask:_e},Ae,Se,Ce,_e,z)}if(R.type==="matcap"){let V=z.image(R.texture.image),j=new PU(V,R.texture.wrapping,R.texture.minFilter??1008,R.texture.magFilter??1006),Y=new GN(Xl(R.alpha,z)),ee=new AU(R.mode??0),se=new MU(R.isMask??!1),he=new GN((R.texture.rotation??0)*xn.DEG2RAD),ce=new XU(j,Y,ee,se,he),ue=new kN(ce.calpha,"f");return new sV(E,O,R,{texture:j,alpha:Y,mode:ee,isMask:se,rotation:he},ce,ee,ue,se,z)}if(R.type==="displace"){if(R.displacementType==="noise"){let V=new JF(new Wn(...R.offset)),j=new GN(R.scale??10),Y=new GN(R.intensity??8),ee=new GN(R.movement??1),se=new AU(R.noiseType??0),he=new AU(R.voronoiStyle??0),ce=new GN(R.smoothness??.5),ue=new GN(R.seed??0),fe=new GN(R.highCut??1),ve=new GN(R.lowCut??0),we=new AU(R.quality??1),Se=new hk(Y,ee,V,he,ce,ue,fe,ve,we,j,se);return new aV(E,O,R,{offset:V,scale:j,intensity:Y,movement:ee,noiseType:se,voronoiStyle:he,smoothness:ce,seed:ue,highCut:fe,lowCut:ve,quality:we},Se,z)}throw new Error}return WY(E,O,R,z)}updateByOp(E,O,R){let z=E;if(z.path[0]===void 0){if(z.type===0)return"type"in z.props||"category"in z.props||"visible"in z.props||"noiseType"in z.props?(R.scene.markNeedsUpdateRendererDirty(),!0):JR(z.props,R.shared,this,O)}else if(z.path[0]==="texture")return!("texture"in O)&&!("video"in O)||OE(z.props,R.shared,this);return!1}dispose(){if(jY(this)){let E=this.uniforms[`f${this.id}_texture`];if(!E)return!1;let O=E;O.image instanceof Ak||O.image.deref()}}hasValueByKey(E){return this.uniforms[E]!==void 0}hasValue(E){return this.hasValueByKey(`f${this.id}_${E}`)}setValue(E,O){let R=`f${this.id}_${E}`;this.hasValueByKey(R)&&O!==void 0&&(this.uniforms[R].value=O)}getNode(E){let O=`f${this.id}_${E}`;if(this.hasValueByKey(O))return this.uniforms[O]}getValue(E){let O=`f${this.id}_${E}`;if(this.hasValueByKey(O))return this.uniforms[O].value}getName(E){let O=/f\d+_(.*)/.exec(E);if(O&&O.length>1)return O[1];console.log(`Layer.getName: error ${E}`)}getNames(){let E=[];for(let O in this.uniforms){let R=this.getName(O);R&&E.push(R)}return E}},sV=class extends nV{constructor(E,O,R,z,V,j,Y,ee,se){super(E,O,R,z,se);this.params=z;this.color=V;this.mode=j;this.alpha=Y;this.isMask=ee}},aV=class extends nV{constructor(E,O,R,z,V,j){super(E,O,R,z,j);this.position=V}},oV=class extends nV{constructor(E,O,R,z,V,j){super(E,O,R,V,j);this.node=z}static createLightLayer(E,O,R,z){let V,j,Y=new GN(Xl(R.alpha,z)),ee=new AU(R.mode),se=new GN(R.bumpMapIntensity),he=new GN(Xl(R.alphaOverride,z));if(R.visible)if(R.category==="lambert"){V=new pk;let E=new _U(z.color(R.emissive)??0),O=new MU(R.occlusion??!0);j={emissive:E,occlusion:O},V.emissive=E,V.occlusion=O}else if(R.category==="toon"){V=new vk;let E=new GN(R.shininess??30),O=new _U(z.color(R.specular)??1118481);j={shininess:E,specular:O},V.shininess=E,V.specular=O}else if(R.category==="physical"){V=new gk;let E=new GN(R.roughness??.3),O=new GN(R.metalness??0),z=new GN(R.reflectivity??.5),Y=new MU(R.occlusion??!0);j={roughness:E,metalness:O,reflectivity:z,occlusion:Y},V.roughness=E,V.metalness=O,V.reflectivity=z,V.occlusion=Y}else{V=new mk;let E=new GN(R.shininess??30),O=new _U(R.specular!==void 0?z.color(R.specular)??1118481:1118481),Y=new MU(R.occlusion??!0);j={shininess:E,specular:O,occlusion:Y},V.shininess=E,V.specular=O,V.occlusion=Y}else V=new uk,j={};return V.alpha=new GN(1),V.shadingAlpha=Y,V.shadingBlend=ee,V.bumpMapIntensity=se,V.alphaOverride=he,j.alpha=V.shadingAlpha,j.mode=V.shadingBlend,j.bumpMapIntensity=V.bumpMapIntensity,j.alphaOverride=V.alphaOverride,new oV(E,O,R,V,j,z)}get category(){return this.node.category}};function jY(E){let O=E instanceof nV?E.type:E;return O==="texture"||O==="video"||O==="displace_map"||O==="matcap"}function vs(E){return{alpha:new GN(E.alpha??1),mode:new AU(E.mode??0),isMask:new MU(E.isMask??!1)}}function HY(E,O,R,z,V){switch(E.type){case"color":{let j=new _U(z.color??yT),Y=vs(z),ee=new zU(j,Y.alpha),se=new kN(ee.calpha,"f");return new sV(O,R,E,{color:j,...Y},ee,Y.mode,se,Y.isMask,V)}case"fresnel":{let j=new _U(z.color??16777215),Y=new GN(z.bias??.1),ee=new GN(z.scale??1),se=new GN(z.intensity??2),he=new GN(z.factor??1),ce=vs(z),ue=new GU(j,Y,ee,se,he,ce.alpha,ce.mode,ce.isMask),fe=new kN(ue.calpha,"f");return new sV(O,R,E,{color:j,bias:Y,scale:ee,intensity:se,factor:he,...ce},ue,ce.mode,fe,ce.isMask,V)}case"rainbow":{let j=new GN(z.filmThickness??30),Y=new GN(z.movement??0),ee=new JF(z.wavelengths??new Wn(0,0,0)),se=new GN(z.noiseStrength??0),he=new GN(z.noiseScale??1),ce=new JF(z.offset??new Wn(0,0,0)),ue=vs(z),fe=new tk(j,Y,ee,se,he,ce,ue.alpha,ue.isMask),ve=new kN(fe.calpha,"f");return new sV(O,R,E,{filmThickness:j,movement:Y,wavelengths:ee,noiseStrength:se,noiseScale:he,offset:ce,...ue},fe,ue.mode,ve,ue.isMask,V)}case"transmission":{let j=new GN(z.thickness??10),Y=new GN(z.ior??1.5),ee=new GN(z.roughness??.5),se=ck.transmissionSize,he=ck.transmissionRenderTarget,ce=ck.transmissionRenderTargetDepth,ue=window.innerWidth,fe=window.innerHeight,ve=ue>=fe?new KF(fe/ue,1):new KF(1,ue/fe),we=vs(z),Se=new ak(j,Y,ee,se,he,ce,ve,we.alpha),_e=new kN(Se.calpha,"f");return new sV(O,R,E,{thickness:j,ior:Y,roughness:ee,aspectRatio:ve,...we},Se,we.mode,_e,we.isMask,V)}case"toon":{let j,Y=new AU(z.positioning??0);z.colors?j=new RU(z.colors.length,z.colors):(j=new RU(10,new Nn(0,0,0,1)),j.value[1]=new Nn(1,1,1,1));let ee;z.steps?ee=new EU(z.steps.length,z.steps):(ee=new EU(10,1),ee.value[0]=0);let se=new JF(z.source??new Wn(0,0,0)),he=new MU(z.isWorldSpace??!0),ce=new GN(z.noiseStrength??0),ue=new GN(z.noiseScale??1),fe=new tN(z.shadowColor),ve=new JF(z.offset??new Wn(0,0,0)),we=vs(z),Se=new rk(Y,j,ee,se,he,ce,ue,fe,ve,we.alpha),_e=new kN(Se.calpha,"f");return new sV(O,R,E,{positioning:Y,colors:j,steps:ee,source:se,isWorldSpace:he,noiseStrength:ce,noiseScale:ue,shadowColor:fe,offset:ve,...we},Se,we.mode,_e,we.isMask,V)}case"outline":{let j=new _U(z.outlineColor??16777215),Y=new _U(z.contourColor??16777215),ee=new GN(z.outlineWidth??.1),se=new GN(z.contourWidth??.1),he=new GN(z.outlineThreshold??.1),ce=new GN(z.contourThreshold??.1),ue=new GN(z.outlineSmoothing??.1),fe=new GN(z.contourFrequency??.1),ve=new JF(z.contourDirection??new Wn(0,1,0)),we=new MU(z.positionalLines??!1),Se=new MU(z.compensation??!0),_e=ck.normalRenderTarget,Ae=ck.normalRenderTargetDepth,Ce=ck.pixelRatioNode,Te=ck.resolution,Ie=vs(z),Fe=new KU(j,Y,ee,se,he,ce,ue,fe,ve,we,Se,Te,_e,Ae,Ce,Ie.alpha),Ue=new kN(Fe.calpha,"f");return new sV(O,R,E,{outlineColor:j,contourColor:Y,outlineWidth:ee,contourWidth:se,outlineThreshold:he,contourThreshold:ce,outlineSmoothing:ue,contourFrequency:fe,contourDirection:ve,positionalLines:we,compensation:Se,...Ie},Fe,Ie.mode,Ue,Ie.isMask,V)}case"depth":{let j,Y=new AU(z.gradientType??0),ee=new MU(z.smooth??!1),se=new GN(z.near??50),he=new GN(z.far??200),ce=new GN(z.isVector??1),ue=new GN(z.isWorldSpace??0),fe=new JF(z.origin??new Wn),ve=new JF(z.direction??new Wn);z.colors?j=new RU(z.colors.length,z.colors):(j=new RU(2,new Nn(0,0,0,1)),j.value[1]=new Nn(1,1,1,1));let we;z.steps?we=new EU(z.steps.length,z.steps):(we=new EU(2,1),we.value[0]=0);let Se=vs(z),_e=new jU(Y,ee,se,he,ce,ue,fe,ve,j,we,Se.alpha,Se.isMask),Ae=new kN(_e.calpha,"f");return new sV(O,R,E,{gradientType:Y,smooth:ee,near:se,far:he,isVector:ce,isWorldSpace:ue,origin:fe,direction:ve,colors:j,steps:we,...Se},_e,Se.mode,Ae,Se.isMask,V)}case"noise":{let j=new GN(z.scale??1),Y=new JF(z.size??new Wn(100,100,100)),ee=new GN(z.move??1),se=new KF(z.fA??new bn(1.7,9.2)),he=new KF(z.fB??new bn(8.3,2.8)),ce=new KF(z.distortion??new bn(1,1)),ue=new tN(z.colorA),fe=new tN(z.colorB),ve=new tN(z.colorC),we=new tN(z.colorD),Se=new AU(z.noiseType??0),_e=new AU(z.voronoiStyle??0),Ae=new GN(z.highCut??1),Ce=new GN(z.lowCut??0),Te=new GN(z.smoothness??.5),Ie=new GN(z.seed??.5),Fe=new AU(z.quality??1),Ue=vs(z),Ge=new QU(j,Y,ee,se,he,ce,ue,fe,ve,we,Ue.alpha,Se,Ue.isMask,_e,Ae,Ce,Te,Ie,Fe),qe=new kN(Ge.calpha,"f");return new sV(O,R,E,{scale:j,size:Y,move:ee,fA:se,fB:he,distortion:ce,colorA:ue,colorB:fe,colorC:ve,colorD:we,noiseType:Se,...Ue,voronoiStyle:_e,highCut:Ae,lowCut:Ce,smoothness:Te,seed:Ie,quality:Fe},Ge,Ue.mode,qe,Ue.isMask,V)}case"normal":{let j=new JF(z.cnormal??new Wn(1,1,1)),Y=vs(z),ee=new NU(j,Y.alpha),se=new kN(ee.calpha,"f");return new sV(O,R,E,{cnormal:j,...Y},ee,Y.mode,se,Y.isMask,V)}case"gradient":{let j,Y=new AU(z.gradientType??0),ee=new MU(z.smooth??!1);z.colors?j=new RU(z.colors.length,z.colors):(j=new RU(10,new Nn(0,0,0,1)),j.value[1]=new Nn(1,1,1,1));let se;z.steps?se=new EU(z.steps.length,z.steps):(se=new EU(10,1),se.value[0]=0);let he=new KF(z.offset??new bn(0,0)),ce=new KF(z.morph??new bn(0,0)),ue=new GN(z.angle??0),fe=vs(z),ve=new WU(Y,ee,j,se,he,ce,ue,fe.alpha,fe.isMask),we=new kN(ve.calpha,"f");return new sV(O,R,E,{gradientType:Y,smooth:ee,colors:j,steps:se,offset:he,morph:ce,angle:ue,...fe},ve,fe.mode,we,fe.isMask,V)}case"pattern":{let j=new AU(z.style??0),Y=new AU(z.projection??0),ee=new AU(["x","y","z"].indexOf(z.axis)??0),se=new GN(z.blending??0),he=new KF(z.offset??new bn(0,0)),ce=new tN(z.colorA),ue=new tN(z.colorB),fe=new KF(z.frequency??new bn(10,10)),ve=new GN(z.size??.5),we=new GN(z.variation??0),Se=new GN(z.smoothness??.5),_e=new GN(z.zigzag??0),Ae=new GN(z.rotation??0),Ce=new KF(z.vertical??new bn(0,1)),Te=new KF(z.horizontal??new bn(0,1)),Ie=new AU(z.sides??6),Fe=vs(z),Ue=new $U(j,Y,ee,se,he,ce,ue,fe,ve,we,Se,_e,Ae,Ce,Te,Ie,Fe.alpha,Fe.isMask),Ge=new kN(Ue.calpha,"f");return new sV(O,R,E,{style:j,projection:Y,axis:ee,blending:se,offset:he,colorA:ce,colorB:ue,frequency:fe,size:ve,variation:we,smoothness:Se,zigzag:_e,rotation:Ae,vertical:Ce,horizontal:Te,sides:Ie,...Fe},Ue,Fe.mode,Ge,Fe.isMask,V)}default:{let j=new _U(1,0,0,1),Y=vs(z),ee=new zU(j,Y.alpha),se=new kN(ee.calpha,"f");return new sV(O,R,E,{color:j,...Y},ee,Y.mode,se,Y.isMask,V)}}}function WY(E,O,R,z){let V=ZR(R,z);return HY(R,E,O,V,z)}function RE(E,O,R,z){if(R.type==="displace"&&(E==="intensity"||E==="visible")){let E=O.uniforms[`f${O.id}_intensity`];return E?(E.value=R.intensity*(R.visible?1:0),E):void 0}if(R.type!=="displace"&&(E==="alpha"||E==="visible")){let V=O.uniforms[`f${O.id}_alpha`];if(!V)return;if(V.value=Xl(R.alpha,z)*(R.visible?1:0),R.type==="outline"&&E==="visible"){let E=O.uniforms[`f${O.id}_compensation`];E&&(E.value=R.compensation&&R.visible)}return V}}function tu(E,O){let R=0,z=E.layers.find((E=>E.data.type==="light"));if(z){let E=z.data,R=Number(O.getVariable(E.alphaOverride));if((typeof E.alphaOverride=="string"?R/100:E.alphaOverride)<1)return!0}for(let z of E.layers){if(z.data.type!=="displace"&&z.data.isMask)return!0;if(z.data.type!=="displace"&&"alpha"in z.data&&z.data.type!=="light"&&z.data.type!=="fresnel"&&z.data.type!=="texture"&&z.data.type!=="matcap"&&z.data.type!=="rainbow"&&z.data.type!=="outline"&&z.data.type!=="pattern"){let E=z.data.visible?z.data.alpha:0;if(typeof E=="string"&&(E=Math.max(0,Math.min(1,Number(O.getVariable(E)??100)/100))),E===1&&z.data.type==="depth"||z.data.type==="gradient"){for(let O of z.data.colors)if(O[3]<1){E=O[3];break}}else if(E===1&&z.data.type==="noise"){let R=O.color(z.data.colorA).a,V=O.color(z.data.colorB).a,j=O.color(z.data.colorC).a,Y=O.color(z.data.colorD).a,ee=Math.min(R,Math.min(V,Math.min(j,Y)));ee<1&&(E=ee)}R+=(1-R)*E}}return R<1}var lV=class extends lo{constructor(){super(void 0);this.flatShading=!1;this.needsJitter=!0;this.shadersPatchedForShapeBlend=!1;this.nodeContextUuid=0;this.fog=!0,this.dithering=!0,this.vertexColors=!0,this.transparent=!0}customProgramCacheKey(){return""}},hV=class extends lV{constructor(E,O,R,z){super();this.flatShading=E;this.side=O;this.wireframe=R;this.root=z}updateAfterBuild(){let E=this.root;this.lights=E.lights,this.vertexShader=E.vertexShader,this.fragmentShader=E.fragmentShader,Object.assign(this.defines,E.defines),Object.assign(this.uniforms,E.uniforms),this.extensions=E.extensions,this.transparent=E.transparent,this.cacheKey=E.customProgramCacheKey()+"flat"+this.flatShading+this.side}onBeforeCompile(E,O){this.root.onBeforeCompile(E)}get data(){return this.root.data}get category(){return this.root.category}get hasAO(){return this.root.hasAO}getFlavor(E,O,R,z){return this.root.getFlavor(E,O,R,z)}get layers(){return this.root.layers}get fragment(){return this.root.fragment}getLayersOfType(E){return this.root.getLayersOfType(E)}getLayerByUuid(E){return this.root.getLayerByUuid(E)}updateByOp(E,O,R){this.root.updateByOp(E,O,R)}nodeMaterialDispose(){this.root.nodeMaterialDispose()}},cV=class extends lV{constructor(E,O,R=!0){super();this.data=E;this.allowVariableSaves=R;this.layerIdGen=0;this.flavors=[];this.masks={};this.type="NodeMaterial";this.updaters=[],this.needsJitter=O.shared.needsJitter,WF.startContext(this),this.reset0(E,O),WF.endContext(this)}get nodeMaterial(){return this}getFlavor(E,O,R,z){let V=R?6:(E?3:0)+O;if(V+=7*((z?.resolutionLevel??0)-(z?.useChildrenColors?4:0)),V===0)return this;this.flavors===void 0&&(this.flavors=[]),V-=1;let j=this.flavors[V];return j===void 0&&(j=new hV(E,O,R,this),j.needsJitter=this.needsJitter,this.flavors[V]=j,j.flatShading=E,j.side=O,j.updateAfterBuild(),z&&(j.defines.SHAPEBLEND=z.resolutionLevel,j.defines.SHAPEBLEND_C=z.useChildrenColors?1:0)),j}get fragment(){return this.lightLayer.node}get category(){return this.lightLayer.category}get hasAO(){return this.lightLayer.getNode("occlusion")?.value??!1}reset(E,O,R=!1){WF.startContext(this),(this.data!==E||R)&&this.reset0(E,O),WF.endContext(this)}reset0(E,O){this.data=E;let R=E.layers??FP.defaultTwoLayerData("phong").layers;try{this.layers=R.map((E=>nV.create(this.layerIdGen++,E.id,E.data,O.shared)))}catch{this.layers=[]}this.layers.reverse(),this.name=E.name??"Untitled Material",this.onUpdate(O.shared),this.transparent=tu(E,O.shared),this.saveVariableLocations(O)}onVariableUpdate(E,O,R){if(E[0]==="alphaOverride")this.transparent=tu(this.data,R.shared),this.lightLayer.setValue("alphaOverride",Math.max(0,Math.min(Number(O)/100,1)));else if(E[0]==="layer"){let z=E[1],V=E[2];if(z&&V){let E=this.layers.find((E=>E.uuid===z));E?.hasValue(V)&&(V==="alpha"?(this.transparent=tu(this.data,R.shared),E.setValue(V,Math.max(0,Math.min(Number(O)/100,1)))):E.setValue(V,O))}}}saveVariableLocations(E){if(!this.allowVariableSaves)return;let O=this.data.layers.find((E=>E.data.type==="light"));O&&E.shared.getVariable(O.data.alphaOverride,["material",this.uuid,"alphaOverride"]),this.data.layers.forEach((O=>{"alpha"in O.data&&typeof O.data.alpha=="string"&&E.shared.getVariable(O.data.alpha,["material",this.uuid,"layer",O.id,"alpha"])}))}getLayersOfType(E){return this.layers.filter((O=>O.type===E))}getLayerByUuid(E){return this.layers.find((O=>O.uuid===E))}onUpdate(E){this.lightLayer=this.layers.find((E=>E instanceof oV)),this.lightLayer===void 0&&(this.lightLayer=new oV(0,"",{...LP.defaultData("light","phong"),visible:!1},new uk,{},E)),this.dispose();for(let E of this.flavors)E&&E.dispose();this.applyTextureMaps(),this.applyMasks(),this.blendColors(),this.blendAfterColors(),this.blendPositions(),this.build(),this.nodeContextUuid=0}applyTextureMaps(){let E=this.layers.find((E=>E instanceof oV));if(!E)return;let O=E.data,R=O.bumpMap,z=O.roughnessMap;E.node.bumpMap=void 0,E.node.roughnessMap=void 0;for(let O=0;O<this.layers.length;++O){let V=this.layers[O];V instanceof sV&&V.color instanceof kU&&(V.uuid===R&&(E.node.bumpMap=V.color),V.uuid===z&&(E.node.roughnessMap=V.color))}}updateByOp(E,O,R){if(WF.startContext(this),O!==void 0?this.data=O:O=this.data,this.transparent=tu(O,R.shared),E.path[0]==="layers"){let z=R.shared,V=E.path[1];if(V===void 0)R.scene.markNeedsUpdateRendererDirty(),this.reset0(O,R);else{E.type===0&&E.props.occlusion!==void 0&&R.scene.markNeedsUpdateRendererDirty();let j=this.layers.find((E=>E.uuid===V));if(j){let Y,ee=O.layers.data(V);E.type===0&&("alpha"in E.props||"alphaOverride"in E.props)&&(Y="alpha"in E.props?{...E.props,alpha:Xl(E.props.alpha,z,["material",this.uuid,"layer",V,"alpha"])}:{...E.props,alphaOverride:Xl(E.props.alphaOverride,z,["material",this.uuid,"alphaOverride"])}),j.updateByOp({...E,...Y?{props:Y}:{},path:E.path.slice(2)},ee,R)&&this.reset0(O,R)}}}else this.reset0(O,R);WF.endContext(this)}applyMasks(){for(let E=0;E<this.layers.length;++E){let O=this.layers[E];O instanceof sV?O.color.mask=void 0:O instanceof oV&&(O.node.mask=void 0)}for(let E=0;E<this.layers.length;++E){let O=this.layers[E];if(O instanceof sV&&O.isMask.value&&O.data.visible&&E>0){let R=E-1,z=this.layers[R];z instanceof oV?z.node.mask=new qN(O.color,O.alpha,qN.MUL):z instanceof sV&&(z.isMask.value||(z.color.mask=new qN(O.color,O.alpha,qN.MUL)))}}}blendColors(){let E=this.layers.findIndex((E=>E instanceof sV)),O=this.layers.findIndex((E=>E instanceof oV));if(E!==-1&&E<O){let R=this.layers[E].color;for(let z=E+1;z<O;++z){let E=this.layers[z];if(E instanceof sV){if(E.isMask.value)continue;R=new LU(R,E.color,E.alpha,E.mode)}}this.fragment.color=R}else this.fragment.color=void 0}blendAfterColors(){let E=new kN("outgoingLight","f"),O=this.layers.findIndex((E=>E instanceof oV));if(this.layers.length>O+1){for(let R=O+1;R<this.layers.length;++R){let O=this.layers[R];if(O instanceof sV){if(O.isMask.value)continue;E=new LU(E,O.color,O.alpha,O.mode)}}this.fragment.afterColor=E}else this.fragment.afterColor=void 0}blendPositions(){let E=this.layers.filter((E=>E instanceof aV));if(E.length>0){let O=E[0].position;for(let R=1;R<E.length;++R)E[R]&&(O=new qN(O,E[R].position,qN.ADD),O=new qN(O,new GN(.5).setReadonly(!0),qN.MUL));this.fragment.position=O}else this.fragment.position=void 0}getDefines(){return this.defines}getUniforms(){return this.uniforms}getVertexShader(){return this.vertexShader}getFragmentShader(){return this.fragmentShader}onBeforeCompile(E){this.shapeBlendhack&&this.shapeBlendhack(this),E.uniforms=this.uniforms,E.vertexShader=this.vertexShader,E.fragmentShader=this.fragmentShader,E.extensionDerivatives=this.extensions.derivatives===!0,E.extensionFragDepth=this.extensions.fragDepth===!0,E.extensionDrawBuffers=this.extensions.drawBuffers===!0,E.extensionShaderTextureLOD=this.extensions.shaderTextureLOD===!0}clampUniformsForPreview(E,O){let i=(E,O,R)=>Math.min(Math.max(E,O),R);for(let R of this.layers)if(R.type==="displace"){let z=i(R.uniforms[`f${R.id}_intensity`].value,E,O);R.uniforms[`f${R.id}_intensity`].value=z}}updateFrame(E){for(let O=0;O<this.updaters.length;++O)E.updateNode(this.updaters[O])}build(){let E=new SU;E.needsJitter=this.needsJitter,this.lights=this.lightLayer.data.visible,E.build(this.fragment,this.fragment),this.vertexShader=E.getCode("vertex"),this.fragmentShader=E.getCode("fragment"),this.defines=E.defines,this.uniforms=E.uniforms,this.extensions=E.extensions,this.updaters=E.updaters;for(let E of this.flavors)E&&E.updateAfterBuild();return this.shadersPatchedForShapeBlend=!1,this}nodeMaterialDispose(){this.layers.forEach((E=>E.dispose())),super.dispose();for(let E of this.flavors)E&&E.dispose()}assetsLoaded(){for(let E of this.layers)if(E instanceof sV){let O=E.params.texture;if(O instanceof PU&&!O.image.loaded)return!1}return!0}};Object.defineProperties(lV.prototype,{properties:{get:function(){return this.fragment.properties}}});var dV=class extends cV{constructor(E,O,R){super(E,O,!1),this.uuid=R,this.allowVariableSaves=!0,this.saveVariableLocations(O)}};var uV=new Map;function e3(E){if(typeof E=="string")return E;let O=uV.get(E);return O||(O={url:URL.createObjectURL(new Blob([E]))},uV.set(E,O)),O.url}var pV,fV=new Promise((E=>{pV=E})),mV=!1;var gV;function n3(){if(!mV)return gV||(gV=n(),gV);async function n(){await import("../_/BgGgfe_u.js"),pV(window!==void 0?window:global),mV=!0}}var vV;fV.then((E=>vV=E));function o3(E){let O=!1;return E.scene.objects.traverse(((E,R)=>{if(R.events===void 0||Array.isArray(R.events)===!1)return!0;let z=[];R.events.forEach((E=>{"dragDropActions"in E.data?(z.push(...E.data.dragDropActions.drag),z.push(...E.data.dragDropActions.drop)):"inActions"in E.data?(z.push(...E.data.inActions),z.push(...E.data.outActions)):"gameActions"in E.data?(z.push(...E.data.gameActions.idle),z.push(...E.data.gameActions.move),z.push(...E.data.gameActions.jump),z.push(...E.data.gameActions.run)):"breakpoints"in E.data?E.data.breakpoints.forEach((E=>{z.push(...E.data.actions)})):"actions"in E.data&&z.push(...E.data.actions),O=O||z.some((E=>E.data.type==="Audio"))}))})),O}var yV=class{constructor({src:E,volume:O,delay:R,loop:z}){this._volume=1;this.delay=0;this._loop=1;this.loopsRemaining=0;this._status="stopped";this.onEnd=()=>{this.loopsRemaining===1/0?this.replay():this.loopsRemaining>1?(this.replay(),this.loopsRemaining--):(this._status="stopped",this.loopsRemaining=this._loop)};let V;V=typeof E=="string"?{src:E}:{src:e3(E),format:"wav"},this.sound=new vV.Howl(V),this.sound.on("end",this.onEnd),this.src=E,O!==void 0&&(this.volume=O),R!==void 0&&(this.delay=R),z!==void 0&&(this.loop=z)}get status(){return this._status}get volume(){return this._volume}set volume(E){this._volume=E,this.sound.volume(E)}get loop(){return this._loop}set loop(E){this._loop=E,this.loopsRemaining=E}replay(){this.clearDelay(),this.delayTimerId=window.setTimeout((()=>{this.sound.play(),this.clearDelay()}),this.delay)}fade(E,O=1e3){E?(this.sound.volume(this._volume),this.clearFade(),this.fadeTimerId=window.setTimeout((()=>{this.sound.fade(this._volume,0,O),this.clearFade()}),E)):this.sound.fade(this._volume,0,O)}on(E,O,R){this.sound.on(E,O,R)}off(E,O,R){this.sound.off(E,O,R)}play(){this._status==="playing"||this.sound.playing()||(this._status==="paused"?(this.sound.seek()===0?this.replay():this.sound.play(),this._status="playing"):this._status==="stopped"&&(this.replay(),this._status="playing"))}pause(){this._status==="playing"&&(this.sound.pause(),this.clearFade(),this.clearDelay(),this._status="paused")}stop(){this.sound.stop(),this.loopsRemaining=this._loop,this.clearFade(),this.clearDelay(),this._status="stopped"}clearFade(){this.fadeTimerId&&(clearTimeout(this.fadeTimerId),delete this.fadeTimerId)}clearDelay(){this.delayTimerId&&(clearTimeout(this.delayTimerId),delete this.delayTimerId)}dispose(E=!1){this.off(),this.stop(),this.clearFade(),this.clearDelay()}};var xV=class{constructor(){this.type="ShapePath";this.color=new On;this.subPaths=[];this.currentPath=null}moveTo(E,O){return this.currentPath=new ju,this.subPaths.push(this.currentPath),this.currentPath.moveTo(E,O),this}lineTo(E,O){return this.currentPath?.lineTo(E,O),this}quadraticCurveTo(E,O,R,z){return this.currentPath?.quadraticCurveTo(E,O,R,z),this}bezierCurveTo(E,O,R,z,V,j){return this.currentPath?.bezierCurveTo(E,O,R,z,V,j),this}splineThru(E){return this.currentPath?.splineThru(E),this}toShapes(){let E={ORIGIN:0,DESTINATION:1,BETWEEN:2,LEFT:3,RIGHT:4,BEHIND:5,BEYOND:6},O={loc:E.ORIGIN,t:0};function i(R,z,V,j){let Y=R.x,ee=z.x,se=V.x,he=j.x,ce=R.y,ue=z.y,fe=V.y,ve=j.y,we=(he-se)*(ce-fe)-(ve-fe)*(Y-se),Se=(ee-Y)*(ce-fe)-(ue-ce)*(Y-se),_e=(ve-fe)*(ee-Y)-(he-se)*(ue-ce),Ae=we/_e,Ce=Se/_e;if(_e===0&&we!==0||Ae<=0||Ae>=1||Ce<0||Ce>1)return null;if(we===0&&_e===0){for(let se=0;se<2;se++){if(s(se===0?V:j,R,z),O.loc===E.ORIGIN){let E=se===0?V:j;return{x:E.x,y:E.y,t:O.t}}if(O.loc===E.BETWEEN){let E=+(Y+O.t*(ee-Y)).toPrecision(10),R=+(ce+O.t*(ue-ce)).toPrecision(10);return{x:E,y:R,t:O.t}}}return null}{for(let Y=0;Y<2;Y++)if(s(Y===0?V:j,R,z),O.loc===E.ORIGIN){let E=Y===0?V:j;return{x:E.x,y:E.y,t:O.t}}let se=+(Y+Ae*(ee-Y)).toPrecision(10),he=+(ce+Ae*(ue-ce)).toPrecision(10);return{x:se,y:he,t:Ae}}}function s(R,z,V){let j=V.x-z.x,Y=V.y-z.y,ee=R.x-z.x,se=R.y-z.y,he=j*se-ee*Y;if(R.x===z.x&&R.y===z.y){O.loc=E.ORIGIN,O.t=0;return}if(R.x===V.x&&R.y===V.y){O.loc=E.DESTINATION,O.t=1;return}if(he<-Number.EPSILON){O.loc=E.LEFT;return}if(he>Number.EPSILON){O.loc=E.RIGHT;return}if(j*ee<0||Y*se<0){O.loc=E.BEHIND;return}if(Math.sqrt(j*j+Y*Y)<Math.sqrt(ee*ee+se*se)){O.loc=E.BEYOND;return}let ce;ce=j!==0?ee/j:se/Y,O.loc=E.BETWEEN,O.t=ce}function o(E,O){let R=[],z=[];for(let V=1;V<E.length;V++){let j=E[V-1],Y=E[V];for(let E=1;E<O.length;E++){let V=O[E-1],ee=O[E],se=i(j,Y,V,ee);se!==null&&R.find((E=>E.t<=se.t+Number.EPSILON&&E.t>=se.t-Number.EPSILON))===void 0&&(R.push(se),z.push(new bn(se.x,se.y)))}}return z}function a(E,O,R){let z=new bn;O.getCenter(z);let V=[];return R.forEach((O=>{O.boundingBox.containsPoint(z)&&o(E,O.points).forEach((E=>{V.push({identifier:O.identifier,isCW:O.isCW,point:E})}))})),V.sort(((E,O)=>E.point.x-O.point.x)),V}function l(E,O,R,z,V){(V==null||V==="")&&(V="nonzero");let j=new bn;E.boundingBox.getCenter(j);let Y=[new bn(R,j.y),new bn(z,j.y)],ee=a(Y,E.boundingBox,O);ee.sort(((E,O)=>E.point.x-O.point.x));let se=[],he=[];ee.forEach((O=>{O.identifier===E.identifier?se.push(O):he.push(O)}));let ce=se[0].point.x,ue=[],fe=0;for(;fe<he.length&&he[fe].point.x<ce;)ue.length>0&&ue[ue.length-1]===he[fe].identifier?ue.pop():ue.push(he[fe].identifier),fe++;if(ue.push(E.identifier),V==="evenodd"){let O=ue.length%2===0,R=ue[ue.length-2];return{identifier:E.identifier,isHole:O,for:R}}if(V==="nonzero"){let R=!0,z=null,V=null;for(let E=0;E<ue.length;E++){let j=ue[E];O[j]&&(R?(V=O[j].isCW,R=!1,z=j):V!==O[j].isCW&&(V=O[j].isCW,R=!0))}return{identifier:E.identifier,isHole:R,for:z}}console.warn('fill-rule: "'+V+'" is currently not implemented.')}let R=0,z=999999999,V=-999999999,j=[];this.subPaths.forEach((E=>{let O=E.getPoints(),Y=-999999999,ee=999999999,se=-999999999,he=999999999;for(let E=0;E<O.length;E++){let R=O[E];R.y>Y&&(Y=R.y),R.y<ee&&(ee=R.y),R.x>se&&(se=R.x),R.x<he&&(he=R.x)}V<=se&&(V=se+1),z>=he&&(z=he-1),O.length&&j.push({curves:E.curves,points:O,isCW:Ku.isClockWise(O),identifier:R++,boundingBox:new Cf(new bn(he,ee),new bn(se,Y))})}));let Y=j.map((E=>l(E,j,z,V,this.userData?.style.fillRule))),ee=[];return j.forEach((E=>{let O=Y[E.identifier];if(O&&!O.isHole){let O=new Qu;O.curves=E.curves,Y.filter((O=>O?.isHole&&O.for===E.identifier)).forEach((E=>{if(E){let R=j[E.identifier],z=new ju;z.curves=R.curves,O.holes.push(z)}})),ee.push(O)}})),ee}};var bV,wV=!1,SV=new Promise((E=>{bV=E})),_V=!1;var AV;function c3(){if(wV=!0,!_V)return AV||(AV=n(),AV);async function n(){let E=await import("../_/V14zjZbb.js");bV(E),_V=!0}}var MV=class{async load(E,O,R=()=>{}){let{load:z}=await SV;z(E,((E,z)=>{E||!z?R(E??"Something went wrong"):O(z)}))}async parse(E){let{parse:O,Bidi:R}=await SV;try{let z=O(E),V=new R,o=E=>z.charToGlyphIndex(E.char);return V.registerModifier("glyphIndex",null,o),V.applyFeatures(z,z.defaultRenderOptions.features),{font:z,bidi:V}}catch(E){console.error(E)}}};async function qY(E){return await(await fetch(E)).arrayBuffer()}var EV=new MV;async function NE(E){let O,R,z=!1;if(E.url?(O=await qY(E.url),R=E.url,z=E.url.startsWith("/")):E.data&&(O=E.data.buffer.slice(E.data.byteOffset,E.data.byteOffset+E.data.byteLength)),O){if(!wV)return{font:void 0,url:R,intercepted:z,arr:O,bidi:null};{let E=await EV.parse(O);if(E)return{font:E.font,url:R,intercepted:z,arr:O,bidi:E.bidi}}}}function YY(E,O){return O.state.glyphIndex===E||O.state.fina===E||O.state.medi===E||O.state.init===E}var CV=class{constructor(E){this._arrayBuffer=new ArrayBuffer(1);this._isLoaded=!1;this._intercepted=!1;this._isUserFont=E.isUserFont??!1,this._loadingPromise=NE(E).then((E=>{E&&(this._arrayBuffer=E.arr,this._url=E.url,this.font=E.font,this._intercepted=E.intercepted,this._isLoaded=!0,this._bidi=E.bidi)}))}update(E){this._isLoaded=!1,this._isUserFont=E.isUserFont??!1,this._loadingPromise=NE(E).then((E=>{E&&(this._arrayBuffer=E.arr,this._url=E.url,this.font=E.font,this._intercepted=E.intercepted,this._isLoaded=!0,this._bidi=E.bidi)}))}get url(){return this._url}get intercepted(){return this._intercepted}get isLoaded(){return this._isLoaded}get loadingPromise(){return this._loadingPromise}reverseLigaturesTable(E,O,R){if(!this._bidi)return[];let z=this._bidi;z.getTextGlyphs(O);let V=z.tokenizer.tokens,j=[],Y=0,ee=R.length===V.length;for(let z=0;z<R.length;z++){let se=R[z].index,he=String.fromCharCode(R[z].unicode),ce=V[Y];if(YY(se,ce)||ee)j.push({char:he,index:se,replacements:[ce.state.glyphIndex],replacementChars:[ce.char]}),Y++;else{let R=ce.char,z="",V=[ce.state.glyphIndex],ee=[],ue=!1;for(;!ue;)Y++,z=O.charAt(Y),R+=z,V.push(E.charToGlyphIndex(z)),ee=E.stringToGlyphs(R),ee.length===1&&ee[0].index===se&&(ue=!0),Y>O.length&&(ue=!0);j.push({char:he,index:se,replacements:V,replacementChars:Array.from(R)}),Y++}}return j}generateShapes(E,O){if(!this._isLoaded)return;let R,z=this.font,V=O.fontSize/this.unitsPerEm,j=O.fontSize*O.lineHeight,Y=E.map((E=>this.getTextWidth(E,O))),ee=O.width,se=this.getCharWidth("\n",O),he=O.horizontalAlign===1?se:0,ce=this.computeSpaceWidthForLine(E,0,O),ue=this.getLineInitialOffsetX(Y[0],ee,O.horizontalAlign,E[0],se),fe=this.getLineInitialOffsetY(j,E.length,O.height,V,O.verticalAlign),ve=[],we=E.map((E=>[])),Se=E.map((E=>[]));for(let _e=0;_e<E.length;_e++){let Ae=E[_e],Ce={features:{liga:!0}},Te=[];try{Te=z.stringToGlyphs(Ae,Ce)}catch(E){console.warn(E)}ue=this.getLineInitialOffsetX(Y[_e],ee,O.horizontalAlign,Ae,se);let Ie=[];try{Ie=this.reverseLigaturesTable(z,Ae,Te)}catch(E){console.warn(E)}ce=this.computeSpaceWidthForLine(E,_e,O);for(let E=0;E<Te.length;E++){let j=Te[E],Y=j.index===0?"\n":j.unicode?String.fromCharCode(j.unicode):void 0,ee=Ie[E],se=0,Ae=0;E===0&&O.horizontalAlign===2&&j.leftSideBearing!==void 0&&(Ae=-j.leftSideBearing*V),R&&(se=z.getKerningValue(j,R)*V),ue+=Ae+se;let Ce=0;if(Y==="\n")Ce=he;else if(Y===" ")Ce=ce;else{let E=this.createPath(j,V,ue,fe,O);E&&(Ce=E.offsetX-(se+Ae),ve.push(E.path))}if(ee.replacements.length===1)Se[_e].push([ue,fe]),we[_e].push(Ce);else{let E=ee.replacements.map((E=>(z.glyphs.get(E).advanceWidth??0)*V)),O=E.reduce(((E,O)=>E+O),0),R=E.map((E=>E/O)),j=ue;for(let E=0;E<R.length;E++){let O=Ce*R[E];Se[_e].push([j,fe]),we[_e].push(O),j+=O}}ue+=Ce,R=j}fe-=j}let _e=[];for(let E=0,O=ve.length;E<O;E++)_e.push(...ve[E].toShapes());return{shapes:_e,charWidths:we,lineWidths:Y,charCoords:Se}}get isUserFont(){return this._isUserFont}get arrayBuffer(){return this._arrayBuffer}get ascender(){return this.font?.ascender??0}get descender(){return this.font?.descender??0}get familyName(){return this.font?.names.fontFamily??""}get subfamilyName(){return this.font?.names.fontSubfamily??""}get unitsPerEm(){return this.font?.unitsPerEm??1}getLineInitialOffsetX(E,O,R,z,V){return(R===3||R===2)&&z.indexOf("\n")>=0&&(E-=V),R===3?O*.5-E*.5:R===2?O-E:0}getLineInitialOffsetY(E,O,R,z,V){let j=O*E,Y=Math.abs(this.ascender-this.descender)*z,ee=E-Y,se=-this.ascender*z-ee/2;return V===3?-(R-j-se):V===2?-(R*.5-j*.5-se):se}createPath(E,O,R,z,V){let j=E.getPath(R,-z,V.fontSize,{kerning:!1,letterSpacing:V.letterSpacing});if(!j){console.error('THREE.Font: character "'+E+'" does not exists in font family '+this.familyName+".");return}let Y=new xV,ee=(E.advanceWidth??1)*O;if(E)for(let E of j.commands){let O=Y.currentPath?.currentPoint;if(!(O&&E.type!=="Z"&&O.x===E.x&&-O.y===E.y))switch(E.type){case"M":Y.moveTo(E.x,-E.y);break;case"L":Y.lineTo(E.x,-E.y);break;case"Q":Y.quadraticCurveTo(E.x1,-E.y1,E.x,-E.y);break;case"C":Y.bezierCurveTo(E.x1,-E.y1,E.x2,-E.y2,E.x,-E.y);break}}return Y.subPaths.forEach((E=>{let O=KY(E.curves);O!==void 0&&E.currentPoint.distanceTo(O)>0&&E.lineTo(O.x,O.y)})),{offsetX:ee+V.fontSize*V.letterSpacing,path:Y}}getCharWidth(E,O){return this.font?.getAdvanceWidth(E,O.fontSize,{kerning:!0,letterSpacing:O.letterSpacing})??0}getTextWidth(E,O){return this.font?.getAdvanceWidth(E,O.fontSize,{kerning:!0,letterSpacing:O.letterSpacing})??0}computeSpaceWidthForLine(E,O,R){let z=this.getCharWidth(" ",R),V=E[O];if(V){let j=this.countSpaces(V.trimEnd());if(R.horizontalAlign===4&&O<E.length-1&&j){let E=R.width,O=this.getTextWidth(V,R);return(E-(O-j*z))/j}}return z}countSpaces(E){return(E.match(/ /g)||[]).length}};function KY(E){if(E.length){let O=E[0];if(O instanceof Lu)return O.v1;if(O instanceof Ou||O instanceof zu)return O.v0}}var TV=class{constructor(){this.objects=new Map;this.unreachable=new Set}getCached(E){return this.objects.get(E)}get size(){return this.objects.size}get(E,O,R){let z=this.objects.get(E);return z===void 0?(z=this.createObject(E,O,R),this.objects.set(E,z)):z.isShared=!0,z}forceDelete(E){let O=this.objects.get(E);O&&(this.disposeObject(O),this.objects.delete(E))}mutateIfUnique(E,O){let R=this.objects.get(E);if(R&&R.isShared!==!0)return this.objects.delete(E),this.objects.set(O,R),R}startGc(){this.unreachable=new Set(this.objects.keys())}markAsReachable(E,O){let R=this.objects.get(E);O===R&&this.unreachable.delete(E)}endGc(){this.unreachable.forEach((E=>{this.disposeObject(this.objects.get(E)),this.objects.delete(E)})),this.unreachable.clear()}dispose(){this.objects.forEach((E=>{this.disposeObject(E)})),this.objects.clear()}},PV=class extends TV{constructor(E){super();this.flatShading=E}disposeObject(E){E.dispose()}createObject(E,O,R){let z=Ba(E,O,this.flatShading,R);return z.computeBoundingSphere(),z}};var jV={markNeedsUpdateRendererDirty:()=>{}};var WV=1e3,qV=512*WV;function QY(E,O){let R=typeof E;return!!((O==="string"||O==="number")&&R===O||O==="boolean"&&(E==="true"||E==="false"||E===!0||E===!1)||O==="image"&&R==="string"&&E.startsWith("http"))}var XV="https://hooks.spline.design",YV=`${XV}/events?hashFile=`,QV=class{constructor(E,O){this.id=E;this.userWebhook=O;this.result=void 0;this._connected=!1;this.emitter=La();this.reconnectWaitFor=WV;this._onError=E=>{this.eventSource?.removeEventListener("message",this._onMessage),this.eventSource?.removeEventListener("error",this._onError),this.eventSource?.removeEventListener("open",this._onConnected),this._scheduleReconnect()};this._onConnected=E=>{clearTimeout(this.scheduledReconnectHandle),this.reconnectWaitFor=WV,this._connected=!0};this._onDisconnected=()=>{clearTimeout(this.scheduledReconnectHandle),this.reconnectWaitFor=WV,this._connected=!1};this._onMessage=E=>{let O,R=E.data;try{O=JSON.parse(R)}catch(E){console.error("Error parsing webhook message",E)}if(O){let E=!1;this.userWebhook.parametersSchemas.forEach((({data:R})=>{O[R.name]!==void 0&&QY(O[R.name],R.type)&&(this.result===void 0&&(this.result={}),this.result[R.name]=O[R.name],E=!0)})),E&&this.emitter.emit("message",{userWebhookId:this.id})}}}connect(){clearTimeout(this.scheduledReconnectHandle),this.userWebhook.url&&(this.eventSource=new EventSource(YV+this.userWebhook.url),this.eventSource.addEventListener("message",this._onMessage),this.eventSource.addEventListener("error",this._onError),this.eventSource.addEventListener("open",this._onConnected))}disconnect(){this.eventSource?.removeEventListener("message",this._onMessage),this.eventSource?.removeEventListener("error",this._onError),this.eventSource?.removeEventListener("open",this._onConnected),this.eventSource?.close(),this._onDisconnected(),clearTimeout(this.scheduledReconnectHandle)}_scheduleReconnect(){this.reconnectWaitFor*=2,this.reconnectWaitFor>qV&&(this.reconnectWaitFor=qV),clearTimeout(this.scheduledReconnectHandle),this.scheduledReconnectHandle=setTimeout((()=>{this.scheduledReconnectHandle=void 0,this.connect()}),this.reconnectWaitFor)}update(E){this.userWebhook=E}dispose(){this._connected&&this.disconnect()}get connected(){return this._connected}on(E,O){this.emitter.on(E,O)}off(E,O){this.emitter.off(E,O)}getParametersKeys(){return this.userWebhook.parametersSchemas.map((E=>E.data.name))}getParameterValue(E){if(this.getParametersKeys().includes(E)){if(this.result)return this.result?.[E];for(let O of this.userWebhook.parametersSchemas)if(O.data.name===E)return TD.defaultParameterValueByType(O.data.type)}}};var ZV=[4186.01,4434.92,4698.63,4978.03,5274.04,5587.65,5919.91,6271.93,6644.88,7040,7458.62,7902.13],KV=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],JV=[],$V=[];for(let E=1;E<=8;E++)for(let O=0;O<ZV.length;O++){let R=ZV[O];JV.push(R/Math.pow(2,8-E)),$V.push(KV[O]+E)}var ej=[32,2e3],tj=JV.filter(((E,O)=>JV[O]>ej[0]&&JV[O]<ej[1])),ij=$V.filter(((E,O)=>JV[O]>ej[0]&&JV[O]<ej[1]));var sj=class{static getFrequencies(E,O,R,z="frequency",V=-100,j=-30){R||(R=new Float32Array(E.frequencyBinCount),E.getFloatFrequencyData(R));let Y,ee,se,he=O/2,ce=1/R.length*he;if(z==="music"||z==="voice"){let E=z==="voice"?tj:JV,O=Array(E.length).fill(V);for(let z=0;z<R.length;z++){let V=z*ce,j=R[z];for(let R=E.length-1;R>=0;R--)if(V>E[R]){O[R]=Math.max(O[R],j);break}}Y=O,ee=z==="voice"?tj:JV,se=z==="voice"?ij:$V}else Y=Array.from(R),ee=Y.map(((E,O)=>ce*O)),se=ee.map((E=>`${E.toFixed(2)} Hz`));let ue=Y.map((E=>Math.max(0,Math.min((E-V)/(j-V),1))));return{values:new Float32Array(ue),frequencies:ee,labels:se}}};var oj="gpt-4o-realtime-preview-2024-12-17",eK=()=>"https://relayserver.spline.design/";async function tK(E){try{return(await(await fetch(eK()+"session?uuidfile="+E)).json()).token}catch(E){console.error("Token generation error:",E)}}var lj=class{constructor(E){this.value=0;this.frequencies=new Float32Array(0);let O=new AudioContext;this.source=O.createMediaStreamSource(E),this.analyser=O.createAnalyser(),this.source.connect(this.analyser),this.analyser.fftSize=8192,this.analyser.smoothingTimeConstant=.1}getFrequencies(E=-100,O=-30){if(!this.analyser)throw new Error("Not connected, please call .connect() first");return sj.getFrequencies(this.analyser,44100,void 0,"voice",E,O)}update(){let E=this.getFrequencies(),O=E.values.reduce(((E,O)=>E+O),0)/E.values.length;this.value=O,this.frequencies=E.values}disconnect(){this.source.disconnect(),this.analyser.disconnect()}},hj=class{constructor(E,O,R){this.data=E;this.id=O;this.shared=R;this.emitter=La();this.rafId=0;this.voice=0;this.frequencies=new Float32Array([0]);this.events=[];this.isConnected=!1;this.isToolsAdded=!1;this.tools=[];this.onMessage=E=>{let O=JSON.parse(E.data);if(this.appendEvent(O),O.type==="session.created"&&this.onSessionCreated(),O.type==="response.done"&&O.response?.output)for(let E of O.response.output)if(E.type==="function_call")for(let[O,R]of this.tools)E.name===O.name&&(R(JSON.parse(E.arguments)),setTimeout((()=>{this.sendClientEvent({type:"response.create",response:{instructions:"notice the user about what you just did"}})})))};this.onSessionCreated=()=>{this.isToolsAdded||this.registerTools()};this.onOpen=()=>{this.events=[],this.isConnected=!0,this.sendClientEvent({type:"response.create",response:{instructions:"Say hi"}})};this.animate=()=>{if(this.rafId=requestAnimationFrame(this.animate),this.isConnected&&this.analyser){this.analyser.update();let E=this.analyser.value,O=this.analyser.frequencies;this.voice=E,this.frequencies=O,this.emitter.emit("voice",{value:E,frequencies:O})}}}update(E){this.data=E}setColorByName(E,O){let R=this.shared.getColorByName(E);if(R){let{id:E}=R,{r:z,g:V,b:j}=Lz.hexStringToRgb(O)??{r:0,g:0,b:0};this.shared.updateColor(E,{r:z/255,g:V/255,b:j/255})}}async connect(){if(this.isConnected)return;let E=await tK(this.data.integration.hash);this.pc=new RTCPeerConnection,this.audioElement=document.createElement("audio"),this.audioElement.autoplay=!0,this.pc.ontrack=E=>{let O=E.streams[0];this.audioElement.srcObject=O,this.analyser=new lj(O)};let O=await navigator.mediaDevices.getUserMedia({audio:!0});this.pc.addTrack(O.getTracks()[0]),this.dc=this.pc.createDataChannel("oai-events"),this.dc.addEventListener("message",this.onMessage),this.dc.addEventListener("open",this.onOpen);let R=await this.pc.createOffer();await this.pc.setLocalDescription(R);let z={type:"answer",sdp:await(await fetch(`https://api.openai.com/v1/realtime?model=${oj}`,{method:"POST",body:R.sdp,headers:{Authorization:`Bearer ${E}`,"Content-Type":"application/sdp"}})).text()};await this.pc.setRemoteDescription(z),this.animate()}appendEvent(E){this.events=[E,...this.events]}sendClientEvent(E){this.dc?(E.event_id=E.event_id||crypto.randomUUID(),this.dc.send(JSON.stringify(E)),this.appendEvent(E)):console.error("Failed to send message - no data channel available",E)}registerTools(){this.isToolsAdded=!0,this.registerTool({type:"function",name:"set_personality_color",description:"returns a color based on the voice personality of the ai assistant. This should be called by the voice assistant each time it is asks to speak differently. If a color cannot be associated to the personality, the color should be a neutral color.",parameters:{type:"object",properties:{color:{type:"string",description:"css hex color string, reflecting the personality"},personality:{type:"string",description:"the personality of the voice assistant"}},required:["color","personality"]}},(({color:E})=>{this.setColorByName("Voice Assistant Color",E)}));let E=this.shared.getVariablesNames().join(", ");this.registerTool({type:"function",name:"set_variable",description:"Sets a Spline variable value when asked by the user.",parameters:{type:"object",properties:{name:{type:"string",description:`The name of the variable that needs to be set. Here's a list of available variables: ${E}. It the variable does not exist, don't call the function and warn the user about it.`},value:{type:"string",description:"The new value for this variable, should always be a string even for number and boolean variables, assume that the value will be cast to the proper type afterwards."}},required:["name","value","type"]}},(({name:E,value:O})=>{let R=this.shared.getVariableByName(E);if(R){let E,z=this.shared.getVariable(R.id);E=typeof z=="number"?parseFloat(O):typeof z=="boolean"?O.toLowerCase()==="true":{textValue:O},this.shared.updateVariable(R.id,E)}}));let O=this.shared.getColorNames().join(", ");this.registerTool({type:"function",name:"set_color",description:"Sets a Spline color asset value when asked by the user.",parameters:{type:"object",properties:{name:{type:"string",description:`The name of the color asset that needs to be set. Here's a list of available color assets: ${O}. It the color asset does not exist, don't call the function and warn the user about it.`},value:{type:"string",description:"css hex color string"}},required:["name","value"]}},(({name:E,value:O})=>{this.setColorByName(E,O)}));let R=this.shared.scene,z=[];R.traverseEntity((E=>{E.data.events.forEach((E=>{if(E.data.type==="AIAssistantTrigger"){let{description:O}=E.data;z.push(O)}}))})),this.registerTool({type:"function",name:"trigger_event",description:"Trigger an event by name, here are the available events, please match what the user is asking for to one of these if it applies, otherwise don't call the function and warn the user.",parameters:{type:"object",properties:{description:{type:"string",description:`The name of the event that needs to be triggered. Here's a list of available events: ${JSON.stringify(z)}.`},direction:{type:"string",description:"default is forward, but can be forward or backward. Always set to forward unless the user ask to reverse or cancel the event, then set to backward."}},required:["description","direction"]}},(({description:E,direction:O})=>{this.emitter.emit("trigger_event",{description:E,direction:O})})),this.sendClientEvent({type:"session.update",session:{tools:this.tools.map((([E])=>E))}})}registerTool(E,O){this.tools.push([E,O])}disconnect(){cancelAnimationFrame(this.rafId),this.analyser?.disconnect(),this.voice=0,this.isConnected=!1,this.isToolsAdded=!1,this.dc?.removeEventListener("message",this.onMessage),this.dc?.removeEventListener("open",this.onOpen),this.dc?.close(),this.pc?.getSenders().forEach((E=>{E.track&&E.track.stop()})),this.pc?.close(),this.pc=void 0}computeAnalysisForListenerEvent(E){if(E.analysis==="range"){let O=this.frequencies.slice(...E.analysisRange);return O.reduce(((E,O)=>E+O),0)/O.length}return E.analysis==="single"?this.frequencies[E.analysisSingle]:this.voice}on(E,O){this.emitter.on(E,O)}off(E,O){this.emitter.off(E,O)}};function vx(E){return"variable_"+E}var cj=class extends Sk{constructor(E){super();this.shared=E}create(E){return new _k(E,this.shared)}},dj=class{constructor(E,O={},R=!0,z=!1){this.data=E;this.needsJitter=R;this.enableLocalStorageForPersistentVariables=z;this.geometryCache=new PV(!0);this.geometryCache2=new PV(!1);this.imageHolderCache=new cj(this);this.thisContext={scene:jV,shared:this};this.deletedMaterial=new dV(FP.defaultTwoLayerData("phong"),this.thisContext,"");this.deletedImage=new Ak(rI.emptyImage,this);this.deletedVideo=new Ak(EP.defaultVideo,this);this.materials={};this.images={};this.uiBuffers={};this.videos={};this.colors={};this.audios={};this.particles={};this.fonts={};this.variables={};this.userAPIs={};this.userWebhooks={};this.mouseProperty=null;this.raycastProperty=null;this.requestRender=()=>{this._requestRender&&this._requestRender()};if(O.images)for(let[E,R]of Object.entries(O.images))this.addImage(E,R);if(O.videos)for(let[E,R]of Object.entries(O.videos))this.addVideo(E,R);if(O.audios)for(let[E,R]of Object.entries(O.audios))this.addAudio(E,R);if(O.particles)for(let[E,R]of Object.entries(O.particles))this.addParticle(E,R);this.reset(E)}setRequestRender(E){this._requestRender=E}getImageLoadPromises(){return Object.values(this.images).map((E=>E.loadPromise))}setEntityOpContext(E){this.entityOpContext=E}reset(E,O=!1){this.data=E,this.resetLib(E.lib);for(let{id:R,data:z}of E.variables)this.addVariableHolder(R,z),O&&this.updateVariableHolder(R,z);for(let[O,R]of Object.entries(E.userAPIs))this.addUserAPI(O,R);for(let[O,R]of Object.entries(E.userWebhooks))this.addUserWebhook(O,R);for(let[O,R]of Object.entries(E.images))this.addImage(O,R);for(let[O,R]of Object.entries(E.videos))this.addVideo(O,R);for(let[O,R]of Object.entries(E.colors))this.addColor(O,R);for(let[O,R]of Object.entries(E.materials))this.addMaterial(O,R);for(let[O,R]of Object.entries(E.audios))this.addAudio(O,R);for(let[O,R]of Object.entries(E.particles))this.addParticle(O,R);for(let[O,R]of Object.entries(E.fonts))this.addFont(O,R)}addMaterial(E,O){if(this.materials[E]){let R=this.materials[E];R.reset(O,this.thisContext),R.dispose()}else{let R=new dV(O,this.thisContext,E);this.materials[E]=R}}deleteMaterial(E){this.materials[E]&&(this.materials[E].nodeMaterialDispose(),delete this.materials[E])}getMaterial(E){let O=this.materials[E];return O}getMaterialOrDeletedPlaceholder(E){return this.materials[E]??this.deletedMaterial}material(E){return typeof E=="string"?this.getMaterialOrDeletedPlaceholder(E):E==null?(console.error("material is undefined or null"),this.deletedMaterial):new cV(E,this.thisContext)}getMaterials(){return this.materials}addImage(E,O){return this.images[E]?(this.onColorOrImageUpdate&&this.onColorOrImageUpdate(),this.images[E].updateSrc(O.data),!0):(this.images[E]=new Ak(O,this),!1)}deleteImage(E){let O=this.images[E];O&&(O.dispose(),delete this.images[E])}getDefaultImage(){return this.images.image_0}getImage(E){return this.images[E]??this.deletedImage}image(E){return typeof E=="string"?this.getImage(E):this.imageHolderCache.load(E)}addUIBuffer(E,O){return this.uiBuffers[E]?(this.onColorOrImageUpdate&&this.onColorOrImageUpdate(),this.uiBuffers[E].updateSrc(O),!0):(this.uiBuffers[E]=new Ak(O,this),!1)}uiBuffer(E){return this.uiBuffers[E]}addVideo(E,O){return this.videos[E]?(this.videos[E].updateSrc(O.data),!0):(this.videos[E]=new Ak(O,this),!1)}deleteVideo(E){let O=this.videos[E];O&&(O.dispose(),delete this.videos[E])}getVideo(E){return this.videos[E]??this.deletedVideo}video(E){return typeof E=="string"?this.getVideo(E):this.imageHolderCache.load(E)}addColor(E,O){return this.colors[E]?(this.onColorOrImageUpdate&&this.onColorOrImageUpdate(),"a"in O?this.colors[E].setRGBA(O.r,O.g,O.b,O.a):this.colors[E].setRGBA(O.r,O.g,O.b,1),!0):(this.colors[E]=new tV(O.r,O.g,O.b,"a"in O?O.a:1),!1)}updateColor(E,O){if(this.colors[E]){this.onColorOrImageUpdate&&this.onColorOrImageUpdate();let R=this.colors[E];return this.colors[E].r=O.r??R.r,this.colors[E].g=O.g??R.g,this.colors[E].b=O.b??R.b,this.colors[E].a=O.a??R.a,!0}return!1}deleteColor(E){this.colors[E]&&delete this.colors[E]}getColor(E){return this.colors[E]}getColorNames(){return Object.values(this.data.colors).map((E=>E.name))}getColorByName(E){for(let O in this.data.colors)if(this.data.colors[O].name===E)return{color:this.colors[O],id:O}}color(E){let O;if(typeof E!="string")return new $F(E.r,E.g,E.b,"a"in E?E.a:1);{let R=this.getColor(E);R?O=R:(console.warn("Tried to create color layer params with a color key that does not exist in the assets manager"),O=new $F(0,0,0,0))}return O}addAudio(E,O){this.audios[E]=O}getAudio(E){let O=this.audios[E];if(O instanceof yV)return O;{let R=new yV({src:O.data});return this.audios[E]=R,R}}addParticle(E,O){this.particles[E]=O}getParticle(E){return this.particles[E]}deleteParticle(E){this.particles[E]&&delete this.particles[E]}deleteAudio(E){let O=this.audios[E];O&&(O instanceof yV&&O.dispose(),delete this.audios[E])}addFont(E,O){this.fonts[E]=new CV(O),this.fonts[E].loadingPromise.then((()=>this.requestRender()))}getFont(E){return this.fonts[E]}deleteFont(E){this.fonts[E]&&delete this.fonts[E]}dispose(){Object.keys(this.materials).forEach((E=>this.deleteMaterial(E))),this._requestRender=void 0,Object.values(this.audios).forEach((E=>{E instanceof yV&&E.dispose()})),this.audios={},this.particles={},this.geometryCache.dispose(),this.geometryCache2.dispose()}addVariableHolder(E,O){if(this.variables[E]===void 0){let R=O.value;if(this.enableLocalStorageForPersistentVariables&&O.persistent){let z=localStorage.getItem(vx(E));R=z!==null?JSON.parse(z):O.value}return this.variables[E]={value:R,locations:[],persistent:O.persistent},"dynamicVariableType"in O&&(this.variables[E].dynamicVariablePlayState="Playing",this.variables[E].dynamicVariableToggleIsForward=void 0),!0}return this.variables[E].value=O.value,!1}resetDynamicVariablePlayState(){for(let E in this.variables)this.variables[E].dynamicVariablePlayState!==void 0&&(this.variables[E].dynamicVariablePlayState="Playing",this.variables[E].dynamicVariableToggleIsForward=void 0)}updateVariableHolder(E,O){this.updateVariable(E,O.value)}updateVariable(E,O){if(this.variables[E]===void 0)return!1;this.variables[E].value=O,this.enableLocalStorageForPersistentVariables&&this.variables[E].persistent&&localStorage.setItem(vx(E),JSON.stringify(O));let R=O;for(;typeof R=="string";)R=this.variables[R].value;let z=this.entityOpContext.scene;for(let O=this.variables[E].locations.length-1;O>=0;O--){let V=this.variables[E].locations[O];if(V[0]==="material"){let E=V[1],O=R,j={scene:z,shared:this},Y=V.slice(2);z.traverseMaterial((R=>{let z=R.root??R;z.uuid===E&&z.onVariableUpdate(Y,O,j)}));let ee=this.materials[E];ee&&ee.onVariableUpdate(Y,O,j)}else{let j=z.find(V[0]);if(j===void 0){this.variables[E].locations.splice(O,1);continue}if(V[1]!=="geometry"&&V[1]!=="particles"){for(let E=1;E<V.length-1;E++)j=j[V[E]];V[1]==="rotation"?j[V[V.length-1]]=R*xn.DEG2RAD:j[V[V.length-1]]=R}if(j=z.find(V[0]),j.type==="ParticleEmitter"&&j.updateVariableState(R,V),oL.is(j))if(V[1]==="position"||V[1]==="rotation"||V[1]==="scale")j.onVariableUpdate();else if(V[1]==="geometry"){let E=j;j.component&&(E=j.component);let O=E.dataPatched;E.chooseGeoemtryCache(this).forceDelete(O.geometry),E.createGeometryDelayed(this.entityOpContext),E.onVariableUpdate(!0),E.invalidateDownstreamBooleanData(),E.instances.forEach((E=>{let O=E.dataPatched;E.chooseGeoemtryCache(this).forceDelete(O.geometry),E.createGeometryDelayed(this.entityOpContext),E.onVariableUpdate(!0),E.invalidateDownstreamBooleanData()}))}else V[1]==="morphTargetInfluences"&&j.updateMorphInfluences(V[2],R)}}return this.requestRender(),!0}deleteVariable(E){this.variables[E]&&delete this.variables[E]}getVariable(E,O){if(Array.isArray(E)){if(E[0]==="mouse")return this.mouseProperty?.[E[1]]??0;if(E[0]==="raycast")return this.raycastProperty?.[E[1]]??0;let O=this.entityOpContext.scene.find(E[0]);if(E[1]==="width"||E[1]==="height"||E[1]==="depth")return O.geometry.userData.parameters[E[1]];for(let R=1;R<E.length;R++)O=O[E[R]];return E[1]==="rotation"&&(O*=xn.RAD2DEG),O}for(let E in this.variables){if(O===void 0)break;let R=this.variables[E],z=R.locations?.findIndex((E=>lE.equal(E,O)));z!==void 0&&z!==-1&&R.locations.splice(z,1)}if(typeof E=="string"){let R=E,z=E;do{if(z=R,this.variables[R]===void 0)break;let E=this.variables[R].value;O&&this.variables[z]!==void 0&&this.variables[z].locations.push(O),R=E}while(typeof R=="string");return R}return E}getVariables(){return this.variables}getVariablesNames(){return this.data.variables.map((E=>E.data.name))}getVariableByName(E){for(let O of this.data.variables)if(O.data.name===E)return{variable:O.data,id:O.id}}getDynamicVariablePlayState(E){return this.variables[E]?.dynamicVariablePlayState}setDynamicVariablePlayState(E,O){this.variables[E]!==void 0&&(this.variables[E].dynamicVariablePlayState=O)}getDynamicVariableToggleIsForward(E){return this.variables[E]?.dynamicVariableToggleIsForward}setDynamicVariableToggleIsForward(E,O){this.variables[E]!==void 0&&(this.variables[E].dynamicVariableToggleIsForward=O)}resetLib(E){for(let[O,R]of Object.entries(E.images))this.addImage(O,R.asset);for(let[O,R]of Object.entries(E.audios))this.addAudio(O,R.asset);for(let[O,R]of Object.entries(E.particles))this.addParticle(O,R.asset);for(let[O,R]of Object.entries(E.colors))this.addColor(O,R.asset);for(let[O,R]of Object.entries(E.fonts))this.addFont(O,R.asset);for(let[O,R]of Object.entries(E.materials))this.addMaterial(O,R.asset);for(let[O,R]of Object.entries(E.videos))this.addVideo(O,R.asset);for(let[O,R]of Object.entries(E.variables))this.addVariableHolder(O,R.asset)}updateLibByOp(E,O){E.path[0]==="images"?E.path.length===1&&E.type===1?this.addImage(E.id,E.data.asset):E.path.length===1&&E.type===2&&this.deleteImage(E.id):E.path[0]==="videos"?E.path.length===1&&E.type===1?this.addVideo(E.id,E.data.asset):E.path.length===1&&E.type===2&&this.deleteVideo(E.id):E.path[0]==="audios"?E.path.length===1&&E.type===1?this.addAudio(E.id,E.data.asset):E.path.length===1&&E.type===2&&this.deleteAudio(E.id):E.path[0]==="particles"?E.path.length===1&&E.type===1?this.addParticle(E.id,E.data.asset):E.path.length===1&&E.type===2&&this.deleteParticle(E.id):E.path[0]==="colors"?E.path.length===1&&E.type===1?this.addColor(E.id,E.data.asset):E.path.length===1&&E.type===2&&this.deleteColor(E.id):E.path[0]==="materials"?E.path.length===1&&E.type===1?this.addMaterial(E.id,E.data.asset):E.path.length===1&&E.type===2&&this.deleteMaterial(E.id):E.path[0]==="fonts"?E.path.length===1&&E.type===1?this.addFont(E.id,E.data.asset):E.path.length===1&&E.type===2&&this.deleteFont(E.id):E.path[0]==="variables"?E.path.length===1&&E.type===1?this.addVariableHolder(E.id,E.data.asset):E.path.length===1&&E.type===2&&this.deleteVariable(E.id):E.path[0]==="components"&&O.updateByLibOp(E,this)}updateByOp(E,O,R){if(this.data=O,E.path[0]==="images")E.path.length===2&&E.type===0?E.props.data&&this.getImage(E.path[1]).updateSrc(E.props.data):E.path.length===1&&E.type===1?this.addImage(E.id,E.data):E.path.length===1&&E.type===2&&this.deleteImage(E.id);else if(E.path[0]==="videos")E.path.length===2&&E.type===0?E.props.data&&this.getVideo(E.path[1]).updateSrc(E.props.data):E.path.length===1&&E.type===1?this.addVideo(E.id,E.data):E.path.length===1&&E.type===2&&this.deleteVideo(E.id);else if(E.path[0]==="audios")E.path.length===2&&E.type===0?E.props.data&&this.addAudio(E.path[1],O.audios[E.path[1]]):E.path.length===1&&E.type===1?this.addAudio(E.id,E.data):E.path.length===1&&E.type===2&&this.deleteAudio(E.id);else if(E.path[0]==="particles")E.path.length===2&&E.type===0?E.props.data&&this.addParticle(E.path[1],O.particles[E.path[1]]):E.path.length===1&&E.type===1?this.addParticle(E.id,E.data):E.path.length===1&&E.type===2&&this.deleteParticle(E.id);else if(E.path[0]==="colors")E.path.length===2&&E.type===0?this.updateColor(E.path[1],E.props):E.path.length===1&&E.type===1?this.addColor(E.id,E.data):E.path.length===1&&E.type===2&&this.deleteColor(E.id);else if(E.path[0]==="materials")E.path.length===1&&E.type===1?this.addMaterial(E.id,E.data):E.path.length===1&&E.type===2?this.deleteMaterial(E.id):E.path.length>1&&this.getMaterial(E.path[1]).updateByOp(qM.drop(E,2),O.materials[E.path[1]],{shared:this,scene:R});else if(E.path[0]==="fonts")E.path.length===2&&E.type===0?this.updateFont(E.path[1],E,R):E.path.length===1&&E.type===1?this.addFont(E.id,E.data):E.path.length===1&&E.type===2&&this.deleteFont(E.id);else if(E.path[0]==="variables")E.path.length===2&&E.type===0?"value"in E.props?this.updateVariable(E.path[1],E.props.value):"persistent"in E.props&&(this.variables[E.path[1]].persistent=E.props.persistent):E.path.length===1&&E.type===4?this.addVariableHolder(E.id,E.data):E.path.length===1&&E.type===5&&this.deleteVariable(E.id);else if(E.path[0]==="userAPIs"){if(E.path.length===1&&E.type===1)this.addUserAPI(E.id,E.data);else if(E.path.length===1&&E.type===2)this.deleteUserAPI(E.id);else if(typeof E.path[1]=="string"){let R=O.userAPIs[E.path[1]];if(R){let O=E.type===0&&E.props.debounce===void 0,z=this.getUserAPI(E.path[1]);z instanceof hj?z.update(R):z?.update(R,this,O)}}}else if(E.path[0]==="userWebhooks"){if(E.path.length===1&&E.type===1)this.addUserWebhook(E.id,E.data);else if(E.path.length===1&&E.type===2)this.deleteUserWebhook(E.id);else if(typeof E.path[1]=="string"){let R=O.userWebhooks[E.path[1]];R&&this.getUserWebhook(E.path[1])?.update(R)}}else E.path[0]==="lib"&&this.updateLibByOp(qM.drop(E,1),R)}updateFont(E,O,R){if(O.props.url){let z=this.getFont(E),V={...this.data.fonts[E],url:O.props.url};z.update(V),z.loadingPromise.then((()=>this.requestRender())),R.updateFont(E,this)}}addUserAPI(E,O){return this.userAPIs[E]?(this.userAPIs[E].update(O,this),!0):this.openAIRealtime?.id===E?(this.openAIRealtime.update(O),!0):O.integration?.type==="VoiceAssistant"?(this.openAIRealtime=new hj(O,E,this),!1):(this.userAPIs[E]=new jz(E,O,this),!1)}getUserAPI(E){return this.openAIRealtime?.id===E?this.openAIRealtime:this.userAPIs[E]}getUserAPIs(){return this.userAPIs}deleteUserAPI(E){let O=this.userAPIs[E];O&&(O.dispose(),delete this.userAPIs[E])}addUserWebhook(E,O){return this.userWebhooks[E]?(this.userWebhooks[E].update(O),!0):(this.userWebhooks[E]=new QV(E,O),!1)}getUserWebhook(E){return this.userWebhooks[E]}getUserWebhooks(){return this.userWebhooks}deleteUserWebhook(E){let O=this.userWebhooks[E];O&&(O.dispose(),delete this.userWebhooks[E])}get scene(){return this.entityOpContext.scene}};new dj(ZD.emptyData());var uj=class extends GF{updateByPatchedOp(E,O,R){if(super.updateByPatchedOp(E,O,R),RI(E.path,["materials"])!==null&&E.type===0&&Array.isArray(this.material))for(let[O,z]of Object.entries(E.props)){let E=R.shared.material(z);this.material[Number(O)]=E}else if(Vt(E.path,["material"])&&this.material instanceof lV)"material"in O&&typeof O.material!="string"&&this.material.updateByOp(qM.drop(E,1),O.material,R);else if(Vt(E.path,["materials","*"])&&Array.isArray(this.material)){let z=E.path[1];if("materials"in O&&z<this.material.length){let V=O.materials[z];typeof V!="string"&&this.material[z].updateByOp(qM.drop(E,2),V,R)}}}get needsAO(){return this.material!==void 0&&(Array.isArray(this.material)?this.material[0]:this.material).hasAO}updateState(E,O){super.updateState(E,O),E.castShadow!==void 0&&(this.castShadow=E.castShadow),E.receiveShadow!==void 0&&(this.receiveShadow=E.receiveShadow);let R=this.dataPatched;this.dataPatched.type==="Mesh"&&!!this.dataPatched.geometry.shapeBlendNode&&this.layers.set(9);let z;if(this.dataPatched.type==="Mesh"&&this.dataPatched.geometry.type==="ShapeBlendGeometry"&&(z={resolutionLevel:this.dataPatched.geometry.resolutionLevel,useChildrenColors:this.dataPatched.geometry.useChildrenColors}),E.geometry?.type!=="NonParametricGeometry"&&"material"in E&&E.material!==void 0&&(this.disposeMaterial(),this.material=O.shared.material(E.material).getFlavor(R.flatShading,R.side,R.wireframe,z),O.scene.markNeedsUpdateRendererDirty()),(E.geometry?.type==="NonParametricGeometry"||"materials"in E)&&("materials"in E&&E.materials!==void 0?(this.disposeMaterial(),this.material=E.materials.map((E=>O.shared.material(E).getFlavor(R.flatShading,R.side,R.wireframe))),O.scene.markNeedsUpdateRendererDirty()):"material"in E&&E.material!==void 0&&(this.disposeMaterial(),this.material=[O.shared.material(E.material).getFlavor(R.flatShading,R.side,R.wireframe)],O.scene.markNeedsUpdateRendererDirty())),E.flatShading!==void 0||E.wireframe!==void 0||E.side!==void 0)if(Array.isArray(this.material))for(let E=0;E<this.material.length;E++)this.material[E]=this.material[E].getFlavor(R.flatShading,R.side,R.wireframe);else this.material=this.material.getFlavor(R.flatShading,R.side,R.wireframe,z)}disposeMaterial(){this.material&&gv(this.material).forEach((E=>{E instanceof lV&&(E instanceof dV||E.nodeMaterialDispose())}))}dispose(){this.disposeMaterial(),super.dispose()}};var pj=new Wn,fj=new Nn,vj=new Nn,xj=new Wn,wj=new Es,_j=class extends uj{constructor(E,O,R){super(E,O);this.data=O;this.isSkinnedMesh=!1;this.localGeometry=void 0,O.bindMode&&O.bindMatrix&&(this.bindMode=O.bindMode,this.bindMatrix=(new Es).fromArray(O.bindMatrix),this.bindMatrixInverse=new Es)}chooseGeoemtryCache(E){return E.geometryCache}markGeometryAsReachable(E){this.geometryCreateDeleyed instanceof Na&&this.chooseGeoemtryCache(E).markAsReachable(this.dataPatched.geometry,this.geometryCreateDeleyed)}get geometry(){if(this.localGeometry!==void 0)return this.localGeometry;if(this.geometryCreateDeleyed instanceof dj){let E=this.geometryCreateDeleyed,O=this.chooseGeoemtryCache(E);this.geometryCreateDeleyed=O.get(this.dataPatched.geometry,E,this)}return this.geometryCreateDeleyed}set geometry(E){this.localGeometry=E}get is2DAndNoDepth(){let E=this.dataPatched.geometry;return WP.is2DParametricMesh(E.type)&&E.depth===0}get is2DType(){return WP.is2DParametricMesh(this.geometry.userData.type)}get isNonParametric(){return this.geometry.userData.type==="NonParametricGeometry"}updateByPatchedOp(E,O,R){super.updateByPatchedOp(E,O,R),Vt(E.path,["geometry"])&&this.updateByPatchedOpGeometry(qM.drop(E,1),O.geometry,R)}removeInteractionGeometry(E){this.localGeometry?.dispose(),this.localGeometry=void 0}updateGeometryInteractions(E,O){this.invalidateDownstreamBooleanData();let R=this.data.geometry.type;if(R==="NonParametricGeometry"||R==="SubdivGeometry"){let R=E;if(this.localGeometry===void 0){let E={...this.data.geometry,...R};this.localGeometry=Ba(E,O,this.data.flatShading,this)}let z,V,j;R.scaleBaked?[z,V,j]=R.scaleBaked:({width:z,height:V,depth:j}=R);let Y=this.localGeometry.userData;Y.sxPrev!==void 0&&wm(this.localGeometry.attributes,z/Y.sxPrev,V/Y.syPrev,j/Y.szPrev),Y.sxPrev=z,Y.syPrev=V,Y.szPrev=j}else{let R={...this.data.geometry,...E};this.localGeometry?.dispose(),this.localGeometry=Ba(R,O,this.data.flatShading,this)}}refreshAttachedClonersInteractions(){for(let E of this.attachedSurfaceCloners)E.update()}refreshAttachedCloners(E){for(let O of this.attachedSurfaceCloners)E.scene.addPendingUpdateCloner(O.object)}refreshAttachedPaths(E){for(let O of this.attachedPaths)E.scene.addPendingCommand((()=>O.updateShape()))}createGeometryDelayed(E){this.geometryCreateDeleyed=E.shared,this.refreshAttachedCloners(E),this.refreshAttachedPaths(E)}updateByPatchedOpGeometry(E,O,R){let z=!1;E.type===0&&E.path.length===0&&Object.keys(E.props).includes("scaleBaked")&&this.geometryCreateDeleyed instanceof bF&&this.chooseGeoemtryCache(R.shared).mutateIfUnique(this.geometryCreateDeleyed.data,O)===this.geometryCreateDeleyed&&(z=!0,this.geometryCreateDeleyed.mutateDirectlyScaleBaked(O,E.props.scaleBaked),this.refreshAttachedCloners(R),this.refreshAttachedPaths(R)),z||(R.scene?.markGeometryCacheDirty(),this.createGeometryDelayed(R)),this.resetBBoxNeedsUpdate(),this.invalidateDownstreamBooleanData()}updateGeometryOnStateUpdate(E,O){this.createGeometryDelayed(O)}updateState(E,O){E.geometry!==void 0&&this.updateGeometryOnStateUpdate(E.geometry,O);let R=E.morphTargetInfluences;if(R){this.updateMorphTargets(),this.geometry.morphTargetsRelative=!0;for(let{data:{name:E,value:z}}of R)this.updateMorphInfluences(E,O.shared.getVariable(z,[this.uuid,"morphTargetInfluences",E]))}super.updateState(E,O)}updateMorphInfluences(E,O){if(this.morphTargetDictionary===void 0)return;let R=this.morphTargetDictionary[E];R!==void 0&&(this.morphTargetInfluences[R]=O)}updateGeometryGroupsIfNeeded(){Array.isArray(this.material)&&this.geometry.groups.length===0&&this.geometry.addGroup(0,Math.max(this.geometry.getIndex()?.count??0,this.geometry.getAttribute("position").count),0)}updateEntityBoxSize(E,O){let R=this.geometry.userData.parameters;this.is2DType?E.set(0,0,R.depth*.5):this.isNonParametric?(E.setScalar(0),this.geometry.boundingSphere&&E.copy(this.geometry.boundingSphere.center),O.set(R.width,R.height,R.depth??0).multiplyScalar(.5)):R.centerOffset?E.fromArray(R.centerOffset):E.setScalar(0),O.set(R.width,R.height,R.depth??0).multiplyScalar(.5)}updateMatrixWorld(E){super.updateMatrixWorld(E),this.bindMode==="attached"?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode==="detached"&&this.bindMatrixInverse.copy(this.bindMatrix).invert()}bind(E,O){this.skeleton=E,this.isSkinnedMesh=!0,O===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),O=this.matrixWorld),this.bindMatrix.copy(O),this.bindMatrixInverse.copy(O).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(E){let O=new Nn,R=this.geometry.attributes.skinWeight;for(let E=0,z=R.count;E<z;E++){O.fromBufferAttribute(R,E);let z=1/O.manhattanLength();z!==1/0?O.multiplyScalar(z):O.set(1,0,0,0),R.setXYZW(E,O.x,O.y,O.z,O.w)}}boneTransform(E,O){let R=this.skeleton;if(R===void 0)return;let z=this.geometry;fj.fromBufferAttribute(z.attributes.skinIndex,E),vj.fromBufferAttribute(z.attributes.skinWeight,E),pj.copy(O).applyMatrix4(this.bindMatrix),O.set(0,0,0);for(let E=0;E<4;E++){let z=vj.getComponent(E);if(z!==0){let V=fj.getComponent(E);wj.multiplyMatrices(R.bones[V].matrixWorld,R.boneInverses[V]),O.addScaledVector(xj.copy(pj).applyMatrix4(wj),z)}}return O.applyMatrix4(this.bindMatrixInverse)}};function nK(E){if(E.geometry.attributes.extrudeNormal||!E.geometry.attributes.position||!E.geometry.attributes.normal)return;let O=new Map,R=E.geometry.attributes,z=R.position.array,V=R.normal.array,j=new Float32Array(z.length);for(let E=0;E<z.length;E+=3){let R=`${z[E]}_${z[E+1]}_${z[E+2]}`,j=new Wn(V[E],V[E+1],V[E+2]);O.has(R)?O.get(R)?.normals.push(j):O.set(R,{normals:[j],result:new Wn})}O.forEach(((E,O)=>{for(let O of E.normals)E.result.add(O);E.result.divideScalar(E.normals.length)}));for(let E=0;E<z.length;E+=3){let R=`${z[E]}_${z[E+1]}_${z[E+2]}`,V=O.get(R)?.result;V&&(j[E]=V.x,j[E+1]=V.y,j[E+2]=V.z)}E.geometry.setAttribute("extrudeNormal",new Ma(j,3))}function sK(E){if(E.geometry.attributes.extrudeNormals||!E.geometry.attributes.position)return;let O=E.geometry.attributes.position.array,R=new Float32Array(O.length),z=new Wn;for(let E=0;E<O.length;E+=3)z.set(O[E],O[E+1],O[E+2]).normalize(),R[E]=z.x,R[E+1]=z.y,R[E+2]=z.z;E.geometry.setAttribute("extrudeNormal",new Ma(R,3))}function lf(E){if(Array.isArray(E.material)){for(let O of E.material)if(O.getLayersOfType("outline").length===0)return}else if(!(E.material instanceof lV)||E.material.getLayersOfType("outline").length===0)return;E instanceof _j&&E.is2DAndNoDepth?sK(E):nK(E)}function cf(E){if(!E.geometry.attributes.position)return;let O=E.geometry.attributes.position.array,R=new Float32Array(O.length),z=parseInt(E.uuid.replace(/\D/g,"")),V=[xn.seededRandom(z),xn.seededRandom(z+1e4),xn.seededRandom(z+2e4)];for(let E=0;E<O.length;E++)R[E]=V[E%3];E.geometry.setAttribute("randomColor",new Sa(R,3))}var Aj=new Yn,Ej=new Wn;function x3(E){let O=!1;return E.scene.objects.traverse(((E,R)=>{R.type==="Mesh"&&R.geometry.type==="SubdivGeometry"&&(O=!0)})),O}var Cj=class extends _j{constructor(E,O,R){super(E,O,R);this.data=O;this.hiddenMatrixOld=new Es;this.smoothShading=!0;this.skipReactionUpdate=!1}chooseGeoemtryCache(E){return this.dataPatched.flatShading?E.geometryCache:E.geometryCache2}get subdivPointerNew(){return this.localGeometry!==void 0?this.subdivPointer:this.geometry.ensureSubdivPointer()}get originalGeometryNew(){return this.localGeometry!==void 0?this.originalGeometry:this.geometry.originalGeometry}get phongAngle(){return this.data.geometry.phongAngle??45}updateEntityBoxSize(E,O){let R=this.geometry.userData.parameters;E.copy(this.originalGeometryNew.boundingSphere.center),O.set(R.width,R.height,R.depth??0).multiplyScalar(.5)}createGeometryByControls(E){if(this.skipReactionUpdate===!0)return;let O=this.localGeometry?.uuid,{originalGeometry:R,subdividedGeometry:z,subdivPointer:V}=bF.build(E,this.subdivPointer,this.smoothShading,this.hasNonUniformScale?this.shearScale:void 0);this.subdivPointer=V,R!==void 0&&(this.originalGeometry?.dispose(),this.originalGeometry=R),z!==void 0&&(this.subdividedGeometry?.dispose(),this.subdividedGeometry=z??void 0),this.localGeometry=this.subdividedGeometry??this.originalGeometry,lf(this),cf(this),this.calcBoundingBox(),O&&(this.localGeometry.uuid=O)}updateState(E,O){if(super.updateState(E,O),E.flatShading!==void 0){let R=this.material;this.material=Array.isArray(R)?R.map((E=>E.getFlavor(!1,E.side,E.wireframe))):R.getFlavor(!1,R.side,R.wireframe),this.smoothShading=!E.flatShading,this.createGeometryDelayed(O)}}updateMesh(E=!1){bF.buildLevel(this.subdivPointer,!0,this.smoothShading?this.phongAngle:-1,this.originalGeometry,E&&this.hasNonUniformScale?this.shearScaleInv:void 0),this.subdividedGeometry&&bF.buildLevel(this.subdivPointer,!1,this.smoothShading?this.phongAngle:-1,this.subdividedGeometry,E&&this.hasNonUniformScale?this.shearScaleInv:void 0)}updateTopology(){this.originalGeometry.dispose(),this.originalGeometry=bF.buildLevel(this.subdivPointer,!0,this.smoothShading?this.phongAngle:-1),this.subdividedGeometry&&(this.subdividedGeometry.dispose(),this.subdividedGeometry=bF.buildLevel(this.subdivPointer,!1,this.smoothShading?this.phongAngle:-1)),this.localGeometry=this.subdividedGeometry??this.originalGeometry}raycast(E,O){let R=this.localGeometry;this.localGeometry=this.originalGeometryNew,GF.prototype.raycast.call(this,E,O),this.localGeometry=R}activateSVDCompensation(){!this.hasNonUniformScale||(this.matrix.copy(this.matrixWorldRigid),this.hiddenMatrixOld.copy(this.hiddenMatrix),this.hiddenMatrix.copy(this.parent.matrixWorld).invert())}deactivateSVDCompensation(){!this.hasNonUniformScale||(this.updateMatrix(),this.hasNonUniformScale=void 0,this.hiddenMatrix.copy(this.hiddenMatrixOld))}calcBoundingBox(){let E=this.originalGeometry;E.boundingSphere===null&&(E.boundingSphere=new ps,this.subdividedGeometry&&(this.subdividedGeometry.boundingSphere=E.boundingSphere));let O=E.attributes.position,R=E.boundingSphere.center;Aj.setFromBufferAttribute(O),Aj.getCenter(R),E.boundingSphere.radius=R.distanceTo(Aj.max),isNaN(E.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this),Aj.getSize(Ej),this.hasNonUniformScale&&Ej.divide(this.scale);let z={width:Ej.x,height:Ej.y,depth:Ej.z};return this.geometry.userData.parameters=z,z}updateBoundingSphere(E){let O=this.originalGeometry;Aj.min.set(E[0],E[2],E[4]),Aj.max.set(E[1],E[3],E[5]),this.hasNonUniformScale&&(Aj.min.applyMatrix4(this.shearScaleInv),Aj.max.applyMatrix4(this.shearScaleInv)),O.boundingSphere===null&&(O.boundingSphere=new ps);let R=O.boundingSphere.center;Aj.getCenter(R),O.boundingSphere.radius=R.distanceTo(Aj.max)}freeSubdivPointer(){this.subdivPointer&&(bF.freeSubdivPointer(this.subdivPointer),this.subdivPointer=0),this.localGeometry=void 0,this.originalGeometry?.dispose(),this.subdividedGeometry?.dispose()}dispose(){super.dispose(),this.freeSubdivPointer()}updateByPatchedOpGeometry(E,O,R){super.updateByPatchedOpGeometry(E,O,R),this.localGeometry&&this.createGeometryByControls(O)}};var Pj=-1,Dj=1,Oj={x:[1,0,0],"-x":[-1,0,0],y:[0,1,0],"-y":[0,-1,0],z:[0,0,1],"-z":[0,0,-1]},Fj={polygon_center:0,edge:1,vertex:2},Fm=(E,O)=>(R,z)=>O&&R!==0&&E!==0?E*z/100:0,xt=(E,O)=>{let R=Math.abs(O),z=R*-1;return(E-Pj)*(R-z)/(Dj-Pj)+z},Nj=new Wn,kj=new Wn,Hj=new Wn,Xj=new Wn;function uf(E,O){let R=Hj.fromArray(E),z=Xj.fromArray(O);kj.copy(z).sub(R);let V=kj.length();return kj.normalize().multiplyScalar(V*.5),Nj.copy(R).add(kj).toArray()}var Qj=new ga,Zj=new Wn,Kj=new Wn,$j=new Wn;function A3(E){let O=[];for(let R=0;R<=E.index.count;R++)if(Zj.fromArray(E.index.array,R*3),Qj.setFromAttributeAndIndices(E.attributes.position,Zj.x,Zj.y,Zj.z),Qj.getNormal(Kj),Qj.getMidpoint($j),!(isNaN($j.x)||isNaN($j.y)||isNaN($j.z))){let{a:E,b:R,c:z}=Qj,V=E.toArray(),j=R.toArray(),Y=z.toArray(),ee=E.distanceTo(R),se=R.distanceTo(z),he=z.distanceTo(E),ce=uf(V,j),ue=uf(j,Y),fe=uf(Y,V),ve=[ee,se,he],we=Math.max(...ve),Se=ve.filter((E=>Math.round(E)===Math.round(we))).length>1,_e=[],Ae=Qj.getMidpoint($j).toArray();we===ee&&!Se&&(_e=[ue,fe,fe],Ae=ce),we===se&&!Se&&(_e=[ce,fe,fe],Ae=ue),we===he&&!Se&&(_e=[ce,ue,ue],Ae=fe),Se&&(_e=[ce,ue,fe]),O.push({vertices:[V,j,Y],faceCenters:_e,midpoint:Ae,norm:Qj.getNormal(Kj).toArray()})}return O}function E3(E){let O=[],{position:R}=E.attributes;for(let E=0;E<R.count;E++){Qj.setFromAttributeAndIndices(R,E*3,E*3+1,E*3+2),Qj.getNormal(Kj),Qj.getMidpoint($j);let z=Qj.a.toArray(),V=Qj.b.toArray(),j=Qj.c.toArray();O.push({vertices:[z,V,j],faceCenters:[uf(z,V),uf(V,j),uf(j,z)],midpoint:$j.toArray(),norm:Kj.toArray()})}return O}var HG=4,JG=.5,kE=E=>.5*(1-Math.cos(E*Math.PI)),eH=class{constructor(){this.perlin=new Array(4096)}noise(E,O=0,R=0){if(this.perlin==null){this.perlin=new Array(4096);for(let E=0;E<4096;E++)this.perlin[E]=Math.random()}E<0&&(E=-E),O<0&&(O=-O),R<0&&(R=-R);let z,V,j,Y,ee,se=Math.floor(E),he=Math.floor(O),ce=Math.floor(R),ue=E-se,fe=O-he,ve=R-ce,we=0,Se=.5;for(let E=0;E<HG;E++){let E=se+(he<<4)+(ce<<8);z=kE(ue),V=kE(fe),j=this.perlin[E&4095],j+=z*(this.perlin[E+1&4095]-j),Y=this.perlin[E+16&4095],Y+=z*(this.perlin[E+16+1&4095]-Y),j+=V*(Y-j),E+=256,Y=this.perlin[E&4095],Y+=z*(this.perlin[E+1&4095]-Y),ee=this.perlin[E+16&4095],ee+=z*(this.perlin[E+16+1&4095]-ee),Y+=V*(ee-Y),j+=kE(ve)*(Y-j),we+=j*Se,Se*=JG,se<<=1,ue*=2,he<<=1,fe*=2,ce<<=1,ve*=2,ue>=1&&(se++,ue--),fe>=1&&(he++,fe--),ve>=1&&(ce++,ve--)}return we}noiseSeed(E){let O=(()=>{let E,O;return{setSeed(R){O=E=(R??Math.random()*4294967296)>>>0},getSeed(){return E},rand(){return O=(1664525*O+1013904223)%4294967296,O/4294967296}}})();O.setSeed(E),this.perlin=new Array(4096);for(let E=0;E<4096;E++)this.perlin[E]=O.rand()}},tH=eH;var iH=new Wn,rH=new Es,nH=new Ms;function jE(E){let O=!1;return E.scene.objects.traverse(((E,R)=>{R.type==="Mesh"&&(R.geometry.type==="TextGeometry"||R.geometry.type==="InputGeometry")&&(O=!0)})),O}var sH=class extends _j{constructor(E,O,R){super(E,O,R);this.data=O}get textGeometry(){return this.geometry}get charWidths(){return this.textGeometry.charWidths}get charCoords(){return this.textGeometry.charCoords}get wrappedText(){return this.textGeometry.wrappedText}get font(){return this.textGeometry.font}get initialOffsetY(){let E=this.dataPatched;return this.font?.getLineInitialOffsetY(this.lineHeight,this.wrappedText.length,E.geometry.height,this.fontScale,E.geometry.verticalAlign)??0}get fontScale(){let E=this.dataPatched;return this.font?E.geometry.fontSize/this.font.unitsPerEm:1}get AD(){return Math.abs(this.ascender-this.descender)}get ascender(){return(this.font?.ascender??1)*this.fontScale}get descender(){return(this.font?.descender??1)*this.fontScale}get lineHeight(){let E=this.dataPatched;return E.geometry.fontSize*E.geometry.lineHeight}raycast(E,O){let{matrixWorld:R}=this;if(!(isNaN(E.ray.origin.x)||this.scale.x===0||this.scale.y===0||this.scale.z===0)&&(rH.copy(R).invert(),nH.copy(E.ray).applyMatrix4(rH),nH.intersectBox(this.singleBBox,iH))){let z=iH.applyMatrix4(R),V=E.ray.origin.distanceTo(z);O.push({distance:V,point:z.clone(),object:this})}}};var aH,oH,lH,hH,cH=1e-4,dH=new Wn,uH=new Wn;tF.then((E=>{aH=E,oH=[aH.get_face_center,aH.get_edge_midpoint,aH.get_vertex_position],lH=[aH.get_face_normal,aH.get_edge_normal,aH.get_vertex_normal],hH=[aH.face_count,aH.edge_count,aH.vertex_count]}));var pH=new Es,fH=new Es,mH=new Wn,gH=new Wn,vH=new Wn,yH=new Wn,xH=new Wn,bH=new Wn;var wH=class{constructor(E,O){this.data=E;this.is3D=O;this.perlin=new tH;E.noiseType==="perlin"?(this.perlin.noiseSeed(E.seed),this.noise=O?(E,O,R)=>this.perlin.noise(E,O,R):E=>this.perlin.noise(E)):this.noise=O?fO((0,SR.default)(E.seed)):dO((0,SR.default)(E.seed))}},SH=class extends(Sd(ra)){constructor(E,O){super();this.parameters=O;this.objectForSample=void 0;this._pendingMediaLoad=!1;this.random=null;this.object=E}resetOnMove(){this.removeFromParent(),this.parent=null}expandClones(E){if(this.parent===null)this.updateState(this.parameters,E);else for(let E of this.children)E instanceof HR&&E.expand()}invalidateTransform(E){this.matrixWorldNeedsUpdate=!0,this.traverse((O=>{O instanceof HR&&O.object===E&&(O.matrixWorldNeedsUpdate=!0)}))}onObjUpdateMatrix(){this.parameters.type!=="toObject"&&(this.matrixWorldNeedsUpdate=!0)}update(){switch(this._updateCount(),this.parameters.type){case"radial":this._updateRadial(this.parameters);break;case"linear":this._updateLinear(this.parameters);break;case"grid":this._updateGrid(this.parameters);break;case"toObject":this._updateToObject(this.parameters)}for(let E of this.children)E.updateMatrix(),E.hasNonUniformScale&&(E.updateMatrixWorld(),E.updateMatrixWorldSVD())}_updateCount(E){let O;if(O=E!==void 0?E:this.parameters.type==="grid"?Math.round(this.parameters.grid.count[0])*Math.round(this.parameters.grid.count[1])*Math.round(this.parameters.grid.count[2]):this.parameters.count,this.parameters.type==="toObject")if(this.parameters.toObject.object){if(E===void 0&&this.parameters.toObject.spreadType!=="random")return}else O=0;if(this.parameters.type==="toObject"&&this.objectForSample){let E=this.children;if(E.length===O)return;if(E.length<O)for(let R=0,z=O-E.length;R<z;++R){let E=new HR(this.object);E.expand(),this.add(E)}else for(let R=0,z=E.length-O;R<z;++R)this.remove(E[R])}else{if(this.children.length===O)return;if(this.children.length<O)for(let E=0,R=O-this.children.length;E<R;++E){let E=new HR(this.object);E.expand(),this.add(E)}else for(let E=0,R=this.children.length-O;E<R;++E)this.remove(this.children[E])}}getRandom(E,O=!1){return(this.random===null||this.random.data.seed!==E.seed||this.random.is3D!==O)&&(this.random=new wH(E,O)),this.random}_updateRadial(E){let O,R=E.radial,z=R.start*xn.DEG2RAD,V=R.end*xn.DEG2RAD,j=z-V,Y=new zs(R.rotation[0],R.rotation[1],R.rotation[2]);switch(R.axis){case"z":O=new Wn(0,0,1);break;case"y":O=new Wn(0,1,0);break;default:case"x":O=new Wn(1,0,0);break}let ee=E.randomnessObject??rP.defaultData([1,1,1]).randomnessObject,se=this.getRandom(ee),he=Fm(ee.strength,this.parameters.randomness);for(let[V,ce]of this.children.entries()){let ue=V*(ee.freqScale/10)+ee.movement,fe=se.noise(ue,ue,ue),ve=V+1;ce.scale.x=R.scale[0]+he(ve,xt(fe,ee.scale[0]))||cH,ce.scale.y=R.scale[1]+he(ve,xt(fe,ee.scale[1]))||cH,ce.scale.z=R.scale[2]+he(ve,xt(fe,ee.scale[2]))||cH,ce.position.setScalar(0);let we=j/E.count*V-z;switch(R.axis){case"x":ce.rotation.set(0,we,0);break;case"y":ce.rotation.set(0,0,we);break;case"z":ce.rotation.set(we,0,0);break}ce.translateOnAxis(O,R.radius),ce.position.x+=R.position[0]+he(ve,xt(fe,ee.position[0])),ce.position.y+=R.position[1]+he(ve,xt(fe,ee.position[1])),ce.position.z+=R.position[2]+he(ve,xt(fe,ee.position[2]));let Se=he(ve,xt(fe,ee.rotation[0])),_e=he(ve,xt(fe,ee.rotation[1])),Ae=he(ve,xt(fe,ee.rotation[2]));R.alignment===!0?(ce.rotation.x+=Y.x+Se,ce.rotation.y+=Y.y+_e,ce.rotation.z+=Y.z+Ae):ce.rotation.set(Y.x+Se,Y.y+_e,Y.z+Ae)}}_updateLinear(E){if(E.type!=="linear")throw new Error;let O=E.linear,R=new zs(O.rotation[0],O.rotation[1],O.rotation[2]),z=E.randomnessObject??rP.defaultData([1,1,1]).randomnessObject,V=this.getRandom(z),j=Fm(z.strength,this.parameters.randomness);for(let[E,Y]of this.children.entries()){let ee=E*(z.freqScale/10)+z.movement,se=V.noise(ee,ee,ee),he=E+1,ce=j(he,xt(se,z.rotation[0])),ue=j(he,xt(se,z.rotation[1])),fe=j(he,xt(se,z.rotation[2]));Y.scale.x=1+(O.scale[0]-1)*E+j(he,xt(se,z.scale[0]))||cH,Y.scale.y=1+(O.scale[1]-1)*E+j(he,xt(se,z.scale[1]))||cH,Y.scale.z=1+(O.scale[2]-1)*E+j(he,xt(se,z.scale[2]))||cH,Y.rotation.x=R.x*E+ce,Y.rotation.y=R.y*E+ue,Y.rotation.z=R.z*E+fe,Y.position.x=O.position[0]*E+j(he,xt(se,z.position[0])),Y.position.y=O.position[1]*E+j(he,xt(se,z.position[1])),Y.position.z=O.position[2]*E+j(he,xt(se,z.position[2]))}}_updateGrid(E){let O=0,R=E.grid,z=E.randomnessObject??rP.defaultData([1,1,1]).randomnessObject,V=this.getRandom(z,!0),j=Fm(z.strength,this.parameters.randomness);if(R.useCenter===!0){let E={x:R.count[0]%2===0?2:1,y:R.count[1]%2===0?2:1,z:R.count[2]%2===0?2:1},Y=new Wn(R.size[0]*(R.count[0]-E.x)*.5,R.size[1]*(R.count[1]-E.y)*.5,R.size[2]*(R.count[2]-E.z)*.5);for(let E=0;E<R.count[0];E++)for(let ee=0;ee<R.count[1];ee++)for(let se=0;se<R.count[2];se++){let he=V.noise((E+1)*(z.freqScale/10)+z.movement,(ee+1)*(z.freqScale/10)+z.movement,(se+1)*(z.freqScale/10)+z.movement),ce=this.children[O++];ce.scale.x=1+j(O,xt(he,z.scale[0]))||cH,ce.scale.y=1+j(O,xt(he,z.scale[1]))||cH,ce.scale.z=1+j(O,xt(he,z.scale[2]))||cH;let ue=j(O,xt(he,z.rotation[0])),fe=j(O,xt(he,z.rotation[1])),ve=j(O,xt(he,z.rotation[2]));ce.rotation.set(ue,fe,ve),ce.position.x=R.size[0]*E-Y.x+j(O,xt(he,z.position[0])),ce.position.y=R.size[1]*ee-Y.y+j(O,xt(he,z.position[1])),ce.position.z=R.size[2]*se-Y.z+j(O,xt(he,z.position[2]))}}else for(let E=0;E<R.count[0];E++)for(let Y=0;Y<R.count[1];Y++)for(let ee=0;ee<R.count[2];ee++){let se=V.noise((E+1)*(z.freqScale/10)+z.movement,(Y+1)*(z.freqScale/10)+z.movement,(ee+1)*(z.freqScale/10)+z.movement),he=this.children[O++];he.scale.x=1+j(O,xt(se,z.scale[0]))||cH,he.scale.y=1+j(O,xt(se,z.scale[1]))||cH,he.scale.z=1+j(O,xt(se,z.scale[2]))||cH;let ce=j(O,xt(se,z.rotation[0])),ue=j(O,xt(se,z.rotation[1])),fe=j(O,xt(se,z.rotation[2]));he.rotation.set(ce,ue,fe),he.position.x=R.size[0]*E+j(O,xt(se,z.position[0])),he.position.y=-R.size[1]*Y+j(O,xt(se,z.position[1])),he.position.z=-R.size[2]*ee+j(O,xt(se,z.position[2]))}}_updateToObject(E){if(E.type!=="toObject")throw new Error;let{toObject:O}=E,R=new zs(O.rotation[0],O.rotation[1],O.rotation[2]),z=E.randomnessObject??rP.defaultData([1,1,1]).randomnessObject,V=this.getRandom(z),j=Fm(z.strength,this.parameters.randomness);if(!O.object){for(let[,E]of this.children.entries())E.position.set(0,0,0),E.scale.setScalar(1),E.rotation.set(0,0,0);this.objectForSample=void 0;return}if(!this.objectForSample)return;if(this.objectForSample instanceof sH){if(!this.objectForSample.font?.isLoaded||this.objectForSample.geometry.attributes.position===void 0){this._pendingMediaLoad=!0;return}this._pendingMediaLoad=!1}if(this.objectForSample.geometry===void 0&&this.objectForSample.isAncestorOf(this.object.uuid)){console.warn(`Oh no! The object "${this.object.name}" (${this.object.uuid}) seem to be a child/descendant of the object it's being cloned to. Please re-parent it so that they are siblings instead.`);return}let Y=this.getSubdivData();if(Y.length>0){let E=Math.round(Y.length*O.count/100);this._updateCount(E)}else{let E=this.objectForSample.geometry.getAttribute("position");if(!E||isNaN(E.count)||E.count===0){console.warn(`Oh no! The object "${this.object.name}" (${this.object.uuid}) cannot be cloned on the surface of "${this.objectForSample.name}" (${this.objectForSample.uuid}) because the latter does not have a valid geometry.`);return}}this.objectForSample.updateMatrixWorld();let ee=new LR(this.objectForSample).build(),se=Oj[O.axis],he=this.children;ee.setRandomGenerator((0,SR.default)(this.object.uuid+O.seed));for(let[E,ce]of he.entries()){let he=E*(z.freqScale/10)+z.movement,ue=V.noise(he,he,he),fe=E+1,ve=j(fe,xt(ue,z.rotation[0])),we=j(fe,xt(ue,z.rotation[1])),Se=j(fe,xt(ue,z.rotation[2]));O.spreadType==="random"?ee.sample(vH,yH):(Y.length&&(vH.fromArray(Y[E].pos),yH.fromArray(Y[E].norm)),this.objectForSample instanceof Cj&&vH.applyMatrix4(pH.copy(this.objectForSample.matrixWorld).invert())),vH.applyMatrix4(this.object.hiddenMatrix.clone().invert()),ce.position.copy(vH),mH.fromArray(se);let _e=O.align==="normal"?yH:this.object.getWorldDirection(bH),Ae=gH.fromArray(O.position);gH.x+=j(fe,xt(ue,z.position[0])),gH.y+=j(fe,xt(ue,z.position[1])),gH.z+=j(fe,xt(ue,z.position[2]));let Ce=Math.acos(_e.dot(mH)),Te=xH.crossVectors(mH,_e).normalize(),Ie=fH.makeRotationAxis(Te,Ce),Fe=_e.clone().cross(this.object.up).normalize(),Ue=Fe.clone().cross(_e).normalize(),Ge=(new Es).makeBasis(Fe,_e,Ue),qe=new Wn(mH.y,mH.z,mH.x).normalize(),Xe=qe.clone().cross(mH).normalize(),Qe=(new Es).makeBasis(qe,mH,Xe).invert(),Ze=(new Es).multiplyMatrices(Ge,Qe);ce.rotation.setFromRotationMatrix(Ze),Ae.applyMatrix4(Ie),ce.position.add(Ae),ce.rotation.x=ce.rotation.x+R.x+ve,ce.rotation.y=ce.rotation.y+R.y+we,ce.rotation.z=ce.rotation.z+R.z+Se,ce.scale.setScalar(1),ce.scale.x=ce.scale.x+O.scale[0]+j(fe,xt(ue,z.scale[0]))||cH,ce.scale.y=ce.scale.y+O.scale[1]+j(fe,xt(ue,z.scale[1]))||cH,ce.scale.z=ce.scale.z+O.scale[2]+j(fe,xt(ue,z.scale[2]))||cH,ce.scale.multiply(this.object.scale),ce.hiddenMatrix=this.object.hiddenMatrix}}getSubdivData(){if(!this.objectForSample)return[];let E=this.parameters.toObject.spreadType,O=new Map,i=(E,R)=>{let z=Math.round(E[0]*1e4)+"_"+Math.round(E[1]*1e4)+"_"+Math.round(E[2]*1e4),V=O.get(z);V?(V.pos[0]+=E[0],V.pos[1]+=E[1],V.pos[2]+=E[2],V.norm[0]+=R[0],V.norm[1]+=R[1],V.norm[2]+=R[2],V.count+=1):O.set(z,{pos:[...E],norm:[...R],count:1})};if(E==="random")return[];if(this.objectForSample instanceof Cj){let O=this.objectForSample,R=Fj[E],z=hH[R],V=oH[R],j=lH[R],Y=z(O.subdivPointerNew);for(let E=0;E<=Y-1;E++){let R=V(O.subdivPointerNew,E),z=j(O.subdivPointerNew,E);dH.fromArray(R).applyMatrix4(O.matrixWorld),uH.fromArray(z),i(dH.toArray(),uH.toArray())}}else(this.objectForSample.geometry.index?A3(this.objectForSample.geometry):E3(this.objectForSample.geometry)).forEach(((O,R)=>{E==="polygon_center"&&i(O.midpoint,O.norm),E==="vertex"&&(i(O.vertices[0],O.norm),i(O.vertices[1],O.norm),i(O.vertices[2],O.norm)),E==="edge"&&(i(O.faceCenters[0],O.norm),i(O.faceCenters[1],O.norm),i(O.faceCenters[2],O.norm))}));let R=Array.from(O.values());for(let E of R)E.pos[0]/=E.count,E.pos[1]/=E.count,E.pos[2]/=E.count,E.norm[0]/=E.count,E.norm[1]/=E.count,E.norm[2]/=E.count;return R}updateState(E,O){if(this.parameters=z_(E),this.parameters.type!=="toObject")(this.parent===null||this.parent!==this.object)&&(this.removeFromParent(),this.object.parent?.add(this),this.matrix=this.object.matrix,this.hiddenMatrix=this.object.hiddenMatrix,this.matrixWorldNeedsUpdate=!0,this.matrixAutoUpdate=!1);else if(this.parent===null||this.parent.uuid!==this.parameters.toObject.object){this.removeFromParent();let E=O.find(this.parameters.toObject.object);this.objectForSample=E instanceof GF?E:void 0,this.matrix=new Es,this.hiddenMatrix=new Es,this.matrixWorldNeedsUpdate=!0,this.matrixAutoUpdate=!1,E&&E.add(this)}this.update()}get pendingMediaLoad(){return this._pendingMediaLoad}};var Go=E=>{var O;return O=class extends E{},O.geometryHelper=new to(30,30,30),O};var _H=new Ms,AH=new ps,EH=new Es,jo=(E,O,R,z,V=!1,j=E)=>{let Y=O,ee=j.matrixWorld;if(Y.boundingSphere===null&&Y.computeBoundingSphere(),AH.copy(Y.boundingSphere),AH.applyMatrix4(ee),R.ray.intersectsSphere(AH)===!1||(EH.copy(ee).invert(),_H.copy(R.ray).applyMatrix4(EH),Y.boundingBox!==null&&_H.intersectsBox(Y.boundingBox)===!1))return;let se,he,ce,ue,fe,ve,we=Y.index,Se=Y.attributes.position,_e=Y.drawRange;if(V===!1){let O=Math.max(0,_e.start),V=Math.min(we.count,_e.start+_e.count);for(fe=O,ve=V;fe<ve;fe+=3)if(he=we.getX(fe),ce=we.getX(fe+1),ue=we.getX(fe+2),se=y(E,R,_H,Se,he,ce,ue),se){se.faceIndex=Math.floor(fe/3),z.push(se);return}}else{let O=Y.attributes.position,V=new Wn,ee=new Wn,se=new Wn,he=new Wn,ce=2,ue=1/((j.scale.x+j.scale.y+j.scale.z)/3),fe=ue*ue,ve=Math.max(0,_e.start),we=Math.min(O.count,_e.start+_e.count);for(let Y=ve,ue=we-1;Y<ue;Y+=ce){if(V.fromBufferAttribute(O,Y),ee.fromBufferAttribute(O,Y+1),_H.distanceSqToSegment(V,ee,he,se)>fe)continue;he.applyMatrix4(j.matrixWorld);let ce=R.ray.origin.distanceTo(he);ce<R.near||ce>R.far||z.push({distance:ce,point:se.clone().applyMatrix4(j.matrixWorld),object:E})}}function y(E,O,R,z,V,j,Y){let ee=new Wn,se=new Wn,he=new Wn,ce=new Wn,ue=new Wn;if(ee.fromBufferAttribute(z,V),se.fromBufferAttribute(z,j),he.fromBufferAttribute(z,Y),R.intersectTriangle(ee,se,he,!1,ce)===null)return null;ue.copy(ce),ue.applyMatrix4(E.matrixWorld);let fe=O.ray.origin.distanceTo(ue);return fe<O.near||fe>O.far?null:{faceIndex:1,distance:fe,point:ue.clone(),object:E}}};var TH=new Wn,PH=new co,DH=class extends wu{constructor(E){let O=new Na,R=new cu({color:16777215,vertexColors:!0,toneMapped:!1}),z=[],V=[],j={},Y=new On(15711266),ee=new On(15711266),se=new On(2857471);h("n1","n2",Y),h("n2","n4",Y),h("n4","n3",Y),h("n3","n1",Y),h("f1","f2",Y),h("f2","f4",Y),h("f4","f3",Y),h("f3","f1",Y),h("n1","f1",Y),h("n2","f2",Y),h("n3","f3",Y),h("n4","f4",Y),h("p","n1",ee),h("p","n2",ee),h("p","n3",ee),h("p","n4",ee),h("u1","u2",se),h("u2","u3",se),h("u3","u1",se);function h(E,O,R){d(E,R),d(O,R)}function d(E,O){z.push(0,0,0),V.push(O.r,O.g,O.b),j[E]===void 0&&(j[E]=[]),j[E].push(z.length/3-1)}O.setAttribute("position",new Ma(z,3)),O.setAttribute("color",new Ma(V,3));super(O,R);this.type="CameraHelper",this.camera=E,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=E.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=j,this.update()}update(){let E=this.geometry,O=this.pointMap,R=!0;PH.projectionMatrixInverse.elements=[.5112609807824982,-0,-0,-0,-0,.41421356237309503,-0,-0,-0,-0,-0,-.099999,-0,-0,-1.0000000000000002,.100001];let z=1,V=1,j=R?.8:1e-4;$s("n1",O,E,PH,-z,-V,j),$s("n2",O,E,PH,z,-V,j),$s("n3",O,E,PH,-z,V,j),$s("n4",O,E,PH,z,V,j);let Y=j;$s("f1",O,E,PH,-z,-V,Y),$s("f2",O,E,PH,z,-V,Y),$s("f3",O,E,PH,-z,V,Y),$s("f4",O,E,PH,z,V,Y);let ee=Y,se=.5;$s("u1",O,E,PH,z*.7*se,V*1.1,ee),$s("u2",O,E,PH,.7*-z*se,V*1.1,ee),$s("u3",O,E,PH,0,V*(1.1+.9*se),ee),E.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}};function $s(E,O,R,z,V,j,Y){TH.set(V,j,Y).unproject(z);let ee=O[E];if(ee!==void 0){let E=R.getAttribute("position");for(let O=0,R=ee.length;O<R;O++)E.setXYZ(ee[O],TH.x,TH.y,TH.z)}}var IH=class extends(Go(DH)){constructor(E){super(E);this.object=E;this.object=E,this.name=`CombinedCameraHelper: ${E.uuid}`}updateMatrixWorld(E){super.updateMatrixWorld(E),this.updateTarget()}updateTarget(){let E=this.object.getTarget();this.updateWorldMatrix(!0,!1),this.worldToLocal(E)}raycast(E,O){jo(this.object,this.geometry,E,O,!0)}};var OH;(E=>E.is=E=>"objectHelper"in E)(OH||(OH={}));var ws=(E,O)=>class extends(Ad(E)){constructor(){super(...arguments);this.objectHelper=new O(this);this.gizmos={}}get geometryHelper(){return O.geometryHelper}raycast(E,O){this.objectHelper.raycast(E,O)}showGizmos(){for(let E in this.gizmos){let O=this.gizmos[E];O instanceof qf&&(O.visible=!0)}}updateEntityBoxSize(E,O){this.objectHelper.visible&&this.geometryHelper instanceof to?(E.setScalar(0),O.set(this.geometryHelper.parameters.width,this.geometryHelper.parameters.height,this.geometryHelper.parameters.height).multiplyScalar(.5)):super.updateEntityBoxSize(E,O)}hideGizmos(){for(let E in this.gizmos){let O=this.gizmos[E];O instanceof qf&&(O.visible=!1)}}};var BH=790,FH=new Wn,NH=new Wn,kH=new Hn,GH=new Wn,WH=new Wn,qH=new Wn,YH=class extends(ws(co,IH)){constructor(E="",O={...uD.defaultData,name:""}){super();this._cameraType="OrthographicCamera";this.targetOffset=iP.DefaultTargetOffset;this.isUpVectorFlipped=!1;this.angleOffsetFromUp=0;this.wasMovedByUser=!1;this.wasMovedBySwitchCameraAction=!1;this.super_Entity(E,O),this.previousProjectionMatrix=new Es,this.matrixAutoUpdate=!0,this.width=window.innerWidth,this.height=window.innerHeight;let R=this.width,z=this.height;this.orthoCamera=new Vc(R*-.5,R*.5,z*.5,z*-.5,-5e4,1e4),this.perspCamera=new po(45,R/z,50,1e4),this.left=this.orthoCamera.left,this.right=this.orthoCamera.right,this.top=this.orthoCamera.top,this.bottom=this.orthoCamera.bottom,this.far=this.orthoCamera.far,this.view=this.orthoCamera.view,this.aspect=this.perspCamera.aspect,this.focus=this.perspCamera.focus,this.filmGauge=this.perspCamera.filmGauge,this.filmOffset=this.perspCamera.filmOffset,this.objectHelper.update()}get isPerspectiveCamera(){return this.cameraType==="PerspectiveCamera"}get isOrthographicCamera(){return!this.isPerspectiveCamera}get cameraType(){return this._cameraType}set fov(E){this.perspCamera.fov=E}get fov(){return this.perspCamera.fov}setNear(E,O){E==="PerspectiveCamera"?this.perspCamera.near=O:this.orthoCamera.near=O}setZoom(E,O){O>=0&&(E==="PerspectiveCamera"?this.perspCamera.zoom=O:this.orthoCamera.zoom=O)}set cameraType(E){E==="PerspectiveCamera"?this.toPerspective():E==="OrthographicCamera"&&this.toOrthographic()}get near(){return this._cameraType==="PerspectiveCamera"?this.perspCamera.near:this.orthoCamera.near}set near(E){this._cameraType==="PerspectiveCamera"?this.perspCamera.near=E:this.orthoCamera.near=E}get zoom(){return this._cameraType==="PerspectiveCamera"?this.perspCamera.zoom:this.orthoCamera.zoom}set zoom(E){E>=0&&(this._cameraType==="PerspectiveCamera"?this.perspCamera.zoom=E:this.orthoCamera.zoom=E)}lookAt(E,O,R){typeof E=="number"&&(E=new Wn(E,O,R)),super.lookAt(E),this.getWorldPosition(FH),this.targetOffset=FH.distanceTo(E)}getTarget(E=new Wn){return this.getWorldDirection(NH),this.getWorldPosition(FH),NH.multiplyScalar(this.targetOffset),E.copy(FH).add(NH),E}getDistanceToTarget(){let E=this.getTarget();return this.getWorldPosition(FH),FH.distanceTo(E)}updateUp(){this.getWorldQuaternion(kH),GH.set(0,0,1).applyQuaternion(kH),WH.copy(ra.DEFAULT_UP),this.isUpVectorFlipped&&WH.negate(),WH.applyQuaternion(kH),qH.copy(ra.DEFAULT_UP).projectOnPlane(GH),this.angleOffsetFromUp=qH.angleTo(WH),this.angleOffsetFromUp*=qH.cross(WH).dot(GH)>=0?1:-1}updateTransformState(E,O){let R=super.updateTransformState(E,O);return E.isUpVectorFlipped!==void 0&&(this.isUpVectorFlipped=E.isUpVectorFlipped),this.updateUp(),R}getViewFrontToObject(E){let O=E.getWorldPosition(new Wn),R=E.getWorldDirection(new Wn).multiplyScalar(this.targetOffset);return{position:O.clone().add(R),target:O}}getViewToTarget(E){let O=this.getWorldDirection(new Wn).multiplyScalar(this.targetOffset);return{position:E.clone().sub(O),target:E}}getViewToObject(E){let O=new Wn;E.getWorldPosition(O);return this.getViewToTarget(O)}setViewplaneSize(E,O,R=!1){if(this.aspect=E/O,R){let R=E>O?this.aspect:1,z=E>O?1:this.aspect;this.left=.5*-BH*R,this.right=BH*.5*R,this.top=BH*.5*(1/z),this.bottom=.5*-BH*(1/z)}else this.left=.5*-E,this.right=E*.5,this.top=O*.5,this.bottom=.5*-O;this.updateProjectionMatrix()}copyViewPlaneSize(E){this.aspect=E.aspect,this.left=E.left,this.right=E.right,this.top=E.top,this.bottom=E.bottom,this.updateProjectionMatrix()}toOrthographic(){this.orthoCamera.left=this.left,this.orthoCamera.right=this.right,this.orthoCamera.top=this.top,this.orthoCamera.bottom=this.bottom,this.orthoCamera.view=this.view,this.orthoCamera.far=this.far,this.orthoCamera.updateProjectionMatrix(),this.projectionMatrix=this.orthoCamera.projectionMatrix,this.projectionMatrixInverse=this.orthoCamera.projectionMatrixInverse,this._cameraType="OrthographicCamera",this.objectHelper&&this.objectHelper.update()}toPerspective(){this.perspCamera.aspect=this.aspect,this.perspCamera.fov=this.fov,this.perspCamera.view=this.view,this.perspCamera.far=this.far,this.perspCamera.updateProjectionMatrix(),this.projectionMatrix=this.perspCamera.projectionMatrix,this.projectionMatrixInverse=this.perspCamera.projectionMatrixInverse,this._cameraType="PerspectiveCamera",this.objectHelper&&this.objectHelper.update()}setFocalLength(E){this.perspCamera.setFocalLength(E),this.toPerspective()}getFocalLength(){return this.perspCamera.getFocalLength()}getEffectiveFOV(){return this.perspCamera.getEffectiveFOV()}getFilmWidth(){return this.perspCamera.getFilmWidth()}getFilmHeight(){return this.perspCamera.getFilmHeight()}setViewOffset(E,O,R,z,V,j){this._cameraType==="PerspectiveCamera"?this.perspCamera.setViewOffset(E,O,R,z,V,j):this.orthoCamera.setViewOffset(E,O,R,z,V,j)}clearViewOffset(){this._cameraType==="PerspectiveCamera"?(this.perspCamera.clearViewOffset(),this.toPerspective()):(this.orthoCamera.clearViewOffset(),this.toOrthographic())}copyHistory(){this.previousProjectionMatrix&&this.previousProjectionMatrix.copy(this.projectionMatrix)}updateProjectionMatrix(){this._cameraType==="PerspectiveCamera"?this.toPerspective():this._cameraType==="OrthographicCamera"&&this.toOrthographic()}updateMatrixWorld(E){super.updateMatrixWorld(E),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(E,O){super.updateWorldMatrix(E,O),this.matrixWorldInverse.copy(this.matrixWorld).invert()}copy(E,O){return super.copy(E,O),this.parent=E.parent,this.orthoCamera.copy(E.orthoCamera),this.perspCamera.copy(E.perspCamera),this.left=E.left,this.right=E.right,this.top=E.top,this.bottom=E.bottom,this.far=E.far,this.view=E.view===null?null:Object.assign({},E.view),this._cameraType=E._cameraType,this.aspect=E.aspect,this.fov=E.fov,this.focus=E.focus,this.filmGauge=E.filmGauge,this.filmOffset=E.filmOffset,this.targetOffset=E.targetOffset,this.updateProjectionMatrix(),this}toCameraState(E=[]){let O={type:this.cameraType,far:this.far,orthographic:{near:this.orthoCamera.near,zoom:this.orthoCamera.zoom},perspective:{near:this.perspCamera.near,fov:this.perspCamera.fov,zoom:this.perspCamera.zoom},up:this.up.toArray(),targetOffset:this.targetOffset,isUpVectorFlipped:this.isUpVectorFlipped};return uM(O,E)}updateCameraSubtype(E,O){let R=E==="perspective"?"PerspectiveCamera":"OrthographicCamera";O.zoom!==void 0&&this.setZoom(R,O.zoom),O.near!==void 0&&this.setNear(R,O.near),O.fov!==void 0&&R==="PerspectiveCamera"&&(this.fov=O.fov)}updateState(E,O){this.updateCameraState(E,O)}updateCameraState(E,O){this.updateState_Entity(E,O),E.far!==void 0&&(this.far=E.far),E.orthographic!==void 0&&this.updateCameraSubtype("orthographic",E.orthographic),E.perspective!==void 0&&this.updateCameraSubtype("perspective",E.perspective),E.type!==void 0&&(this.cameraType=E.type),E.up!==void 0&&this.up.fromArray(E.up),E.targetOffset!==void 0&&(this.targetOffset=E.targetOffset),E.isUpVectorFlipped!==void 0&&(this.isUpVectorFlipped=E.isUpVectorFlipped),this.updateProjectionMatrix()}updateByPatchedOp(E,O,R){super.updateByPatchedOp(E,O,R),E.path.length===1&&E.type===0&&this.updateCameraSubtype(E.path[0],E.props)}toState(E){return{...super.toState(E),...this.toCameraState(E),type:this.cameraType}}};var ZH=new Es,JH=new Es;function JE(E){let O=!1;return E.scene.objects.traverse(((E,R)=>{R.geometry?.type==="BooleanGeometry"&&(O=!0)})),O}var $H=class extends uj{constructor(E,O,R){super(E,O);this.data=O;this.meshSetAddresses=[];this.needsTransformForDownstream=!1;this.geometry=new Na;this.onAfterRender=(E,O,R,z,V,j)=>{super.onAfterRender(E,O,R,z,V,j),this.recomputeBoolean()};this.geometry.userData.parameters={width:0,height:0,depth:0}}get booleanOp(){return this.data.geometry.operation}get phongAngle(){return this.data.geometry.phongAngle??45}get isLOD(){return this.recomputeBoolean(),!1}updateByPatchedOp(E,O,R){super.updateByPatchedOp(E,O,R),E.path.length===1&&E.path[0]==="geometry"&&E.type===0&&E.props.operation!==void 0&&(this.freeBooleanPointer(),this.resetBBoxNeedsUpdate())}freeBooleanPointer(){super.freeBooleanPointer(),this.geometry.dispose()}recomputeBoolean(E,O=!0){if(this.booleanMeshSetAddress!==-1&&!E)return;for(let R=0;R<this.children.length;R++){let z=this.children[R];z instanceof $H&&z.dataPatched.visible===!0&&z.recomputeBoolean(E===!0,O)}this.meshSetAddresses=[];for(let R=0;R<this.children.length;R++){let z=this.children[R];if(z instanceof GF&&z.dataPatched.visible===!0&&z.geometry.attributes.position?.count>0&&z.geometry.drawRange.count>0&&z.booleanMeshSetAddress!==0){ZH.multiplyMatrices(z.hiddenMatrix,z.matrix);try{if(z.booleanMeshSetAddress===-1){if((z.geometry.index??z.geometry.getAttribute("position")).count/3<15e5&&(z.booleanMeshSetAddress=PF.getMeshSet(z.geometry,E===!0,O)),z.booleanMeshSetAddress===-1)return;PF.transformMeshSet(z.booleanMeshSetAddress,ZH),z.booleanMatrixInvOld.copy(ZH).invert(),z.booleanWasTransformed=!1}else z instanceof $H&&z.needsTransformForDownstream===!0?(PF.transformMeshSet(z.booleanMeshSetAddress,ZH),z.needsTransformForDownstream=!1):z.booleanWasTransformed===!0&&(PF.transformMeshSet(z.booleanMeshSetAddress,JH.multiplyMatrices(ZH,z.booleanMatrixInvOld)),z.booleanMatrixInvOld.copy(ZH).invert(),z.booleanWasTransformed=!1)}catch(E){console.error(E),z.booleanMeshSetAddress=0,z.geometry.userData.booleanOperationDidFail=!0;continue}PF.hasOpenEdges(z.booleanMeshSetAddress)===!1||R===this.children.length-1&&this.booleanOp===2?(this.meshSetAddresses.push(z.booleanMeshSetAddress),z.geometry.userData.booleanOperationDidFail=!1):z.geometry.userData.booleanOperationDidFail="openEdges"}}if(this.meshSetAddresses.length===0){this.geometry.setAttribute("position",new Ma([],0)),this.geometry.setDrawRange(0,0);return}if(E===!0)return PF.calcBooleanTopological(this.meshSetAddresses,this.booleanOp);let R=this.geometry;R.dispose(),this.geometry=new Na,this.geometry.userData=R.userData,this.geometry.boundingSphere=R.boundingSphere;try{this.booleanMeshSetAddress=PF.calcBoolean(this.meshSetAddresses,this.booleanOp,this.geometry,this.phongAngle)}catch(E){this.booleanMeshSetAddress=0,this.geometry.userData.booleanOperationDidFail=!0,console.error(E)}this.booleanMatrixInvOld.copy(this.matrix).invert(),this.needsTransformForDownstream=!0,lf(this),cf(this)}dispose(){super.dispose(),this.geometry.dispose()}};var tW;(E=>{function n(E){return oL.is(E)&&E instanceof Rp}E.is=n})(tW||(tW={}));var ff=(E,O)=>class extends(ws(E,O)){updateState_Light(E,O){this.updateState_Entity(E,O),E.color!==void 0&&(this.color=O.shared.color(E.color)),E.intensity!==void 0&&(this.intensity=E.intensity),E.depth!==void 0&&(this.shadow.camera.far=E.depth,this.shadow.needsUpdate=!0),E.shadows!==void 0&&(this.castShadow=E.shadows)}};var un=E=>E instanceof GF,Mn=E=>E!==null&&E instanceof $H,B3=E=>E instanceof YH,N3=E=>tW.is(E),zm=E=>OH.is(E);var rW=new Wn(1,1,1),nW=new Wn,lW=new Wn,cW=new Hn,pW=class extends(Go(Xf)){constructor(E,O=15){super(O);this.object=E;this.dummy=new Fd;this.object.updateMatrixWorld(),this.name=`EmptyObjectHelper: ${E.uuid}`,this.matrix=this.dummy.matrixWorld,this.matrixAutoUpdate=!1,this.object.isBone&&(this.visible=!1)}raycast(E,O){jo(this.object,pW.geometryHelper,E,O,!1,this.dummy)}update(){}updateMatrix(){}updateMatrixWorld(E){this.object.matrixWorld.decompose(nW,cW,lW),this.matrix.compose(nW,cW,rW),super.updateMatrixWorld(E)}updateWorldMatrix(E,O){}};var wW=class extends(ws(Fd,pW)){constructor(E,O){super(),this.super_Entity(E,O),this.objectHelper.update()}updateState(E,O){this.updateState_Entity(E,O),"buffer"in E&&Object.keys(E).length===1&&O.scene.reloadSplats()}};var AW=class extends(ws(Fd,pW)){constructor(E,O,R){super();this.super_Entity(E,O),this.context=R,this.objectHelper.update()}updateState(E,O){this.updateState_Entity(E,O)}};var MW={RED:0,GREEN:1,BLUE:2,ALPHA:3};var CW="varying vec2 vUv;void main(){vUv=position.xy*0.5+0.5;gl_Position=vec4(position.xy,1.0,1.0);}";var TW="#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D inputBuffer;\n#else\nuniform lowp sampler2D inputBuffer;\n#endif\nuniform lowp sampler2D cocBuffer;uniform vec2 texelSize;uniform float scale;uniform vec4 kernel64[32];varying vec2 vUv;void main(){\n#ifdef FOREGROUND\nvec2 CoCNearFar=texture2D(cocBuffer,vUv).rg;float CoC=CoCNearFar.r*scale;\n#else\nfloat CoC=texture2D(cocBuffer,vUv).g*scale;\n#endif\nif(CoC==0.0){gl_FragColor=texture2D(inputBuffer,vUv);}else{\n#ifdef FOREGROUND\nvec2 step=texelSize*max(CoC,CoCNearFar.g*scale);\n#else\nvec2 step=texelSize*CoC;\n#endif\nvec4 acc=vec4(0.0);for(int i=0;i<32;++i){vec4 kernel=kernel64[i];vec2 uv=step*kernel.xy+vUv;acc+=texture2D(inputBuffer,uv);uv=step*kernel.zw+vUv;acc+=texture2D(inputBuffer,uv);}gl_FragColor=acc/64.0;}}",IW=class extends lo{constructor(E=!1,O=!1){super({name:"BokehMaterial",defines:{PASS:E?"2":"1"},uniforms:{kernel64:new _f(null),kernel16:new _f(null),inputBuffer:new _f(null),cocBuffer:new _f(null),texelSize:new _f(new bn),scale:new _f(1)},blending:qe,depthWrite:!1,depthTest:!1,fragmentShader:TW,vertexShader:CW}),this.toneMapped=!1,O&&(this.defines.FOREGROUND="1"),this.generateKernel()}set inputBuffer(E){this.uniforms.inputBuffer.value=E}setInputBuffer(E){this.uniforms.inputBuffer.value=E}set cocBuffer(E){this.uniforms.cocBuffer.value=E}setCoCBuffer(E){this.uniforms.cocBuffer.value=E}get scale(){return this.uniforms.scale.value}set scale(E){this.uniforms.scale.value=E}getScale(E){return this.uniforms.scale.value=E}setScale(E){this.uniforms.scale.value=E}generateKernel(){let E=2.39996323,O=new Float32Array(128),R=new Float32Array(32),z=0,V=0;for(let j=0;j<80;++j){let Y=j*E,ee=Math.sqrt(j)/Math.sqrt(80),se=ee*Math.cos(Y),he=ee*Math.sin(Y);j%5===0?(R[V++]=se,R[V++]=he):(O[z++]=se,O[z++]=he)}let j=[],Y=[];for(let E=0;E<128;)j.push(new Nn(O[E++],O[E++],O[E++],O[E++]));for(let E=0;E<32;)Y.push(new Nn(R[E++],R[E++],R[E++],R[E++]));this.uniforms.kernel64.value=j,this.uniforms.kernel16.value=Y}setTexelSize(E,O){this.uniforms.texelSize.value.set(E,O)}setSize(E,O){this.uniforms.texelSize.value.set(1/E,1/O)}};function U3(E,O,R){return E*(O-R)-O}function iT(E,O,R){return Math.min(Math.max((E+O)/(O-R),0),1)}var zW="#include <common>\n#include <packing>\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nuniform highp sampler2D depthBuffer;\n#else\nuniform mediump sampler2D depthBuffer;\n#endif\nuniform float focusDistance;uniform float focusRange;uniform float cameraNear;uniform float cameraFar;varying vec2 vUv;float readDepth(const in vec2 uv){\n#if DEPTH_PACKING == 3201\nreturn unpackRGBAToDepth(texture2D(depthBuffer,uv));\n#else\nreturn texture2D(depthBuffer,uv).r;\n#endif\n}void main(){float depth=readDepth(vUv);\n#ifdef PERSPECTIVE_CAMERA\nfloat viewZ=perspectiveDepthToViewZ(depth,cameraNear,cameraFar);float linearDepth=viewZToOrthographicDepth(viewZ,cameraNear,cameraFar);\n#else\nfloat linearDepth=depth;\n#endif\nfloat signedDistance=linearDepth-focusDistance;float magnitude=smoothstep(0.0,focusRange,abs(signedDistance));gl_FragColor.rg=magnitude*vec2(step(signedDistance,0.0),step(0.0,signedDistance));}",FW=class extends lo{constructor(E){super({name:"CircleOfConfusionMaterial",defines:{DEPTH_PACKING:"0"},uniforms:{depthBuffer:new _f(null),focusDistance:new _f(0),focusRange:new _f(0),cameraNear:new _f(.3),cameraFar:new _f(1e3)},blending:qe,depthWrite:!1,depthTest:!1,fragmentShader:zW,vertexShader:CW}),this.toneMapped=!1,this.uniforms.focalLength=this.uniforms.focusRange,this.adoptCameraSettings(E)}get near(){return this.uniforms.cameraNear.value}get far(){return this.uniforms.cameraFar.value}set depthBuffer(E){this.uniforms.depthBuffer.value=E}set depthPacking(E){this.defines.DEPTH_PACKING=E.toFixed(0),this.needsUpdate=!0}setDepthBuffer(E,O=Qr){this.depthBuffer=E,this.depthPacking=O}get focusDistance(){return this.uniforms.focusDistance.value}set focusDistance(E){this.uniforms.focusDistance.value=E}get worldFocusDistance(){return-U3(this.focusDistance,this.near,this.far)}set worldFocusDistance(E){this.focusDistance=iT(-E,this.near,this.far)}getFocusDistance(E){this.uniforms.focusDistance.value=E}setFocusDistance(E){this.uniforms.focusDistance.value=E}get focalLength(){return this.focusRange}set focalLength(E){this.focusRange=E}get focusRange(){return this.uniforms.focusRange.value}set focusRange(E){this.uniforms.focusRange.value=E}get worldFocusRange(){return-U3(this.focusRange,this.near,this.far)}set worldFocusRange(E){this.focusRange=iT(-E,this.near,this.far)}getFocalLength(E){return this.focusRange}setFocalLength(E){this.focusRange=E}adoptCameraSettings(E){E&&(this.uniforms.cameraNear.value=E.near,this.uniforms.cameraFar.value=E.far,E instanceof po?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}},UW="#include <common>\n#include <dithering_pars_fragment>\n#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D inputBuffer;\n#else\nuniform lowp sampler2D inputBuffer;\n#endif\nvarying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec4 sum=texture2D(inputBuffer,vUv0);sum+=texture2D(inputBuffer,vUv1);sum+=texture2D(inputBuffer,vUv2);sum+=texture2D(inputBuffer,vUv3);gl_FragColor=sum*0.25;\n#include <encodings_fragment>\n#include <dithering_fragment>\n}",kW="uniform vec2 texelSize;uniform vec2 halfTexelSize;uniform float kernel;uniform float scale;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 uv=position.xy*0.5+0.5;vec2 dUv=(texelSize*vec2(kernel)+halfTexelSize)*scale;vUv0=vec2(uv.x-dUv.x,uv.y+dUv.y);vUv1=vec2(uv.x+dUv.x,uv.y+dUv.y);vUv2=vec2(uv.x+dUv.x,uv.y-dUv.y);vUv3=vec2(uv.x-dUv.x,uv.y-dUv.y);gl_Position=vec4(position.xy,1.0,1.0);}",VW=class extends lo{constructor(E=new bn){super({name:"KawaseBlurMaterial",uniforms:{inputBuffer:new _f(null),texelSize:new _f(new bn),halfTexelSize:new _f(new bn),kernel:new _f(0),scale:new _f(1)},blending:qe,depthWrite:!1,depthTest:!1,fragmentShader:UW,vertexShader:kW}),this.toneMapped=!1,this.setTexelSize(E.x,E.y)}set inputBuffer(E){this.uniforms.inputBuffer.value=E}setInputBuffer(E){this.inputBuffer=E}get scale(){return this.uniforms.scale.value}set scale(E){this.uniforms.scale.value=E}getScale(){return this.uniforms.scale.value}setScale(E){this.uniforms.scale.value=E}getKernel(){return null}get kernel(){return this.uniforms.kernel.value}set kernel(E){this.uniforms.kernel.value=E}setKernel(E){this.kernel=E}setTexelSize(E,O){this.uniforms.texelSize.value.set(E,O),this.uniforms.halfTexelSize.value.set(E,O).multiplyScalar(.5)}setSize(E,O){let R=this.uniforms;R.texelSize.value.set(1/E,1/O),R.halfTexelSize.value.copy(R.texelSize.value).multiplyScalar(.5)}},GW="#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D inputBuffer;\n#else\nuniform lowp sampler2D inputBuffer;\n#endif\nuniform float opacity;varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);gl_FragColor=opacity*texel;\n#include <encodings_fragment>\n}",KW=class extends lo{constructor(){super({name:"CopyMaterial",uniforms:{inputBuffer:new _f(null),opacity:new _f(1)},blending:qe,depthWrite:!1,depthTest:!1,fragmentShader:GW,vertexShader:CW}),this.toneMapped=!1}set inputBuffer(E){this.uniforms.inputBuffer.value=E}setInputBuffer(E){this.uniforms.inputBuffer.value=E}getOpacity(E){return this.uniforms.opacity.value}setOpacity(E){this.uniforms.opacity.value=E}};var $W="varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;\n#if THREE_REVISION < 143\n#define luminance(v) linearToRelativeLuminance(v)\n#endif\n#if EDGE_DETECTION_MODE != 0\nvarying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;\n#endif\n#if EDGE_DETECTION_MODE == 1\n#include <common>\n#endif\n#if EDGE_DETECTION_MODE == 0 || PREDICATION_MODE == 1\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nuniform highp sampler2D depthBuffer;\n#else\nuniform mediump sampler2D depthBuffer;\n#endif\nfloat readDepth(const in vec2 uv){\n#if DEPTH_PACKING == 3201\nreturn unpackRGBAToDepth(texture2D(depthBuffer,uv));\n#else\nreturn texture2D(depthBuffer,uv).r;\n#endif\n}vec3 gatherNeighbors(){float p=readDepth(vUv);float pLeft=readDepth(vUv0);float pTop=readDepth(vUv1);return vec3(p,pLeft,pTop);}\n#elif PREDICATION_MODE == 2\nuniform sampler2D predicationBuffer;vec3 gatherNeighbors(){float p=texture2D(predicationBuffer,vUv).r;float pLeft=texture2D(predicationBuffer,vUv0).r;float pTop=texture2D(predicationBuffer,vUv1).r;return vec3(p,pLeft,pTop);}\n#endif\n#if PREDICATION_MODE != 0\nvec2 calculatePredicatedThreshold(){vec3 neighbours=gatherNeighbors();vec2 delta=abs(neighbours.xx-neighbours.yz);vec2 edges=step(PREDICATION_THRESHOLD,delta);return PREDICATION_SCALE*EDGE_THRESHOLD*(1.0-PREDICATION_STRENGTH*edges);}\n#endif\n#if EDGE_DETECTION_MODE != 0\nuniform sampler2D inputBuffer;\n#endif\nvoid main(){\n#if EDGE_DETECTION_MODE == 0\nconst vec2 threshold=vec2(DEPTH_THRESHOLD);\n#elif PREDICATION_MODE != 0\nvec2 threshold=calculatePredicatedThreshold();\n#else\nconst vec2 threshold=vec2(EDGE_THRESHOLD);\n#endif\n#if EDGE_DETECTION_MODE == 0\nvec3 neighbors=gatherNeighbors();vec2 delta=abs(neighbors.xx-vec2(neighbors.y,neighbors.z));vec2 edges=step(threshold,delta);if(dot(edges,vec2(1.0))==0.0){discard;}gl_FragColor=vec4(edges,0.0,1.0);\n#elif EDGE_DETECTION_MODE == 1\nfloat l=luminance(texture2D(inputBuffer,vUv).rgb);float lLeft=luminance(texture2D(inputBuffer,vUv0).rgb);float lTop=luminance(texture2D(inputBuffer,vUv1).rgb);vec4 delta;delta.xy=abs(l-vec2(lLeft,lTop));vec2 edges=step(threshold,delta.xy);if(dot(edges,vec2(1.0))==0.0){discard;}float lRight=luminance(texture2D(inputBuffer,vUv2).rgb);float lBottom=luminance(texture2D(inputBuffer,vUv3).rgb);delta.zw=abs(l-vec2(lRight,lBottom));vec2 maxDelta=max(delta.xy,delta.zw);float lLeftLeft=luminance(texture2D(inputBuffer,vUv4).rgb);float lTopTop=luminance(texture2D(inputBuffer,vUv5).rgb);delta.zw=abs(vec2(lLeft,lTop)-vec2(lLeftLeft,lTopTop));maxDelta=max(maxDelta.xy,delta.zw);float finalDelta=max(maxDelta.x,maxDelta.y);edges.xy*=step(finalDelta,LOCAL_CONTRAST_ADAPTATION_FACTOR*delta.xy);gl_FragColor=vec4(edges,0.0,1.0);\n#elif EDGE_DETECTION_MODE == 2\nvec4 delta;vec3 c=texture2D(inputBuffer,vUv).rgb;vec3 cLeft=texture2D(inputBuffer,vUv0).rgb;vec3 t=abs(c-cLeft);delta.x=max(max(t.r,t.g),t.b);vec3 cTop=texture2D(inputBuffer,vUv1).rgb;t=abs(c-cTop);delta.y=max(max(t.r,t.g),t.b);vec2 edges=step(threshold,delta.xy);if(dot(edges,vec2(1.0))==0.0){discard;}vec3 cRight=texture2D(inputBuffer,vUv2).rgb;t=abs(c-cRight);delta.z=max(max(t.r,t.g),t.b);vec3 cBottom=texture2D(inputBuffer,vUv3).rgb;t=abs(c-cBottom);delta.w=max(max(t.r,t.g),t.b);vec2 maxDelta=max(delta.xy,delta.zw);vec3 cLeftLeft=texture2D(inputBuffer,vUv4).rgb;t=abs(c-cLeftLeft);delta.z=max(max(t.r,t.g),t.b);vec3 cTopTop=texture2D(inputBuffer,vUv5).rgb;t=abs(c-cTopTop);delta.w=max(max(t.r,t.g),t.b);maxDelta=max(maxDelta.xy,delta.zw);float finalDelta=max(maxDelta.x,maxDelta.y);edges*=step(finalDelta,LOCAL_CONTRAST_ADAPTATION_FACTOR*delta.xy);gl_FragColor=vec4(edges,0.0,1.0);\n#endif\n}",eq="uniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;\n#if EDGE_DETECTION_MODE != 0\nvarying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;\n#endif\nvoid main(){vUv=position.xy*0.5+0.5;vUv0=vUv+texelSize*vec2(-1.0,0.0);vUv1=vUv+texelSize*vec2(0.0,-1.0);\n#if EDGE_DETECTION_MODE != 0\nvUv2=vUv+texelSize*vec2(1.0,0.0);vUv3=vUv+texelSize*vec2(0.0,1.0);vUv4=vUv+texelSize*vec2(-2.0,0.0);vUv5=vUv+texelSize*vec2(0.0,-2.0);\n#endif\ngl_Position=vec4(position.xy,1.0,1.0);}",tq={DEPTH:0,LUMA:1,COLOR:2},iq={DISABLED:0,DEPTH:1,CUSTOM:2},rq=class extends lo{constructor(E=new bn,O=tq.COLOR){super({name:"EdgeDetectionMaterial",defines:{THREE_REVISION:ve.replace(/\D+/g,""),LOCAL_CONTRAST_ADAPTATION_FACTOR:"2.0",EDGE_THRESHOLD:"0.1",DEPTH_THRESHOLD:"0.01",PREDICATION_MODE:"0",PREDICATION_THRESHOLD:"0.01",PREDICATION_SCALE:"2.0",PREDICATION_STRENGTH:"1.0",DEPTH_PACKING:"0"},uniforms:{inputBuffer:new _f(null),depthBuffer:new _f(null),predicationBuffer:new _f(null),texelSize:new _f(E)},blending:qe,depthWrite:!1,depthTest:!1,fragmentShader:$W,vertexShader:eq}),this.toneMapped=!1,this.edgeDetectionMode=O}set depthBuffer(E){this.uniforms.depthBuffer.value=E}set depthPacking(E){this.defines.DEPTH_PACKING=E.toFixed(0),this.needsUpdate=!0}setDepthBuffer(E,O=Qr){this.depthBuffer=E,this.depthPacking=O}get edgeDetectionMode(){return Number(this.defines.EDGE_DETECTION_MODE)}set edgeDetectionMode(E){this.defines.EDGE_DETECTION_MODE=E.toFixed(0),this.needsUpdate=!0}getEdgeDetectionMode(){return this.edgeDetectionMode}setEdgeDetectionMode(E){this.edgeDetectionMode=E}get localContrastAdaptationFactor(){return Number(this.defines.LOCAL_CONTRAST_ADAPTATION_FACTOR)}set localContrastAdaptationFactor(E){this.defines.LOCAL_CONTRAST_ADAPTATION_FACTOR=E.toFixed("6"),this.needsUpdate=!0}getLocalContrastAdaptationFactor(){return this.localContrastAdaptationFactor}setLocalContrastAdaptationFactor(E){this.localContrastAdaptationFactor=E}get edgeDetectionThreshold(){return Number(this.defines.EDGE_THRESHOLD)}set edgeDetectionThreshold(E){this.defines.EDGE_THRESHOLD=E.toFixed("6"),this.defines.DEPTH_THRESHOLD=(E*.1).toFixed("6"),this.needsUpdate=!0}getEdgeDetectionThreshold(){return this.edgeDetectionThreshold}setEdgeDetectionThreshold(E){this.edgeDetectionThreshold=E}get predicationMode(){return Number(this.defines.PREDICATION_MODE)}set predicationMode(E){this.defines.PREDICATION_MODE=E.toFixed(0),this.needsUpdate=!0}getPredicationMode(){return this.predicationMode}setPredicationMode(E){this.predicationMode=E}set predicationBuffer(E){this.uniforms.predicationBuffer.value=E}setPredicationBuffer(E){this.uniforms.predicationBuffer.value=E}get predicationThreshold(){return Number(this.defines.PREDICATION_THRESHOLD)}set predicationThreshold(E){this.defines.PREDICATION_THRESHOLD=E.toFixed("6"),this.needsUpdate=!0}getPredicationThreshold(){return this.predicationThreshold}setPredicationThreshold(E){this.predicationThreshold=E}get predicationScale(){return Number(this.defines.PREDICATION_SCALE)}set predicationScale(E){this.defines.PREDICATION_SCALE=E.toFixed("6"),this.needsUpdate=!0}getPredicationScale(){return this.predicationScale}setPredicationScale(E){this.predicationScale=E}get predicationStrength(){return Number(this.defines.PREDICATION_STRENGTH)}set predicationStrength(E){this.defines.PREDICATION_STRENGTH=E.toFixed("6"),this.needsUpdate=!0}getPredicationStrength(){return this.predicationStrength}setPredicationStrength(E){this.predicationStrength=E}setSize(E,O){this.uniforms.texelSize.value.set(1/E,1/O)}},nq="#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#define packFloatToRGBA(v) packDepthToRGBA(v)\n#define unpackRGBAToFloat(v) unpackRGBAToDepth(v)\n#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D inputBuffer;\n#else\nuniform lowp sampler2D inputBuffer;\n#endif\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nuniform highp sampler2D depthBuffer;\n#else\nuniform mediump sampler2D depthBuffer;\n#endif\nuniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;\n#if THREE_REVISION < 143\n#define luminance(v) linearToRelativeLuminance(v)\n#endif\n#if THREE_REVISION >= 137\nvec4 sRGBToLinear(const in vec4 value){return vec4(mix(pow(value.rgb*0.9478672986+vec3(0.0521327014),vec3(2.4)),value.rgb*0.0773993808,vec3(lessThanEqual(value.rgb,vec3(0.04045)))),value.a);}\n#endif\nfloat readDepth(const in vec2 uv){\n#if DEPTH_PACKING == 3201\nreturn unpackRGBAToDepth(texture2D(depthBuffer,uv));\n#else\nreturn texture2D(depthBuffer,uv).r;\n#endif\n}float getViewZ(const in float depth){\n#ifdef PERSPECTIVE_CAMERA\nreturn perspectiveDepthToViewZ(depth,cameraNear,cameraFar);\n#else\nreturn orthographicDepthToViewZ(depth,cameraNear,cameraFar);\n#endif\n}FRAGMENT_HEADvoid main(){FRAGMENT_MAIN_UVvec4 color0=texture2D(inputBuffer,UV);vec4 color1=vec4(0.0);FRAGMENT_MAIN_IMAGEgl_FragColor=color0;\n#ifdef ENCODE_OUTPUT\n#include <encodings_fragment>\n#endif\n#include <dithering_fragment>\n}",sq="uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;VERTEX_HEADvoid main(){vUv=position.xy*0.5+0.5;VERTEX_MAIN_SUPPORTgl_Position=vec4(position.xy,1.0,1.0);}",lq={FRAGMENT_HEAD:"FRAGMENT_HEAD",FRAGMENT_MAIN_UV:"FRAGMENT_MAIN_UV",FRAGMENT_MAIN_IMAGE:"FRAGMENT_MAIN_IMAGE",VERTEX_HEAD:"VERTEX_HEAD",VERTEX_MAIN_SUPPORT:"VERTEX_MAIN_SUPPORT"},hq=class extends lo{constructor(E,O,R,z,V=!1){super({name:"EffectMaterial",defines:{THREE_REVISION:ve.replace(/\D+/g,""),DEPTH_PACKING:"0",ENCODE_OUTPUT:"1"},uniforms:{inputBuffer:new _f(null),depthBuffer:new _f(null),resolution:new _f(new bn),texelSize:new _f(new bn),cameraNear:new _f(.3),cameraFar:new _f(1e3),aspect:new _f(1),time:new _f(0)},blending:qe,depthWrite:!1,depthTest:!1,dithering:V}),this.toneMapped=!1,E&&this.setShaderParts(E),O&&this.setDefines(O),R&&this.setUniforms(R),this.adoptCameraSettings(z)}set inputBuffer(E){this.uniforms.inputBuffer.value=E}setInputBuffer(E){this.uniforms.inputBuffer.value=E}get depthBuffer(){return this.uniforms.depthBuffer.value}set depthBuffer(E){this.uniforms.depthBuffer.value=E}get depthPacking(){return Number(this.defines.DEPTH_PACKING)}set depthPacking(E){this.defines.DEPTH_PACKING=E.toFixed(0),this.needsUpdate=!0}setDepthBuffer(E,O=Qr){this.depthBuffer=E,this.depthPacking=O}setShaderParts(E){return this.fragmentShader=nq.replace(lq.FRAGMENT_HEAD,E.get(lq.FRAGMENT_HEAD)).replace(lq.FRAGMENT_MAIN_UV,E.get(lq.FRAGMENT_MAIN_UV)).replace(lq.FRAGMENT_MAIN_IMAGE,E.get(lq.FRAGMENT_MAIN_IMAGE)),this.vertexShader=sq.replace(lq.VERTEX_HEAD,E.get(lq.VERTEX_HEAD)).replace(lq.VERTEX_MAIN_SUPPORT,E.get(lq.VERTEX_MAIN_SUPPORT)),this.needsUpdate=!0,this}setDefines(E){for(let O of E.entries())this.defines[O[0]]=O[1];return this.needsUpdate=!0,this}setUniforms(E){for(let O of E.entries())this.uniforms[O[0]]=O[1];return this}setExtensions(E){this.extensions={};for(let O of E)this.extensions[O]=!0;return this}get encodeOutput(){return this.defines.ENCODE_OUTPUT!==void 0}set encodeOutput(E){this.encodeOutput!==E&&(E?this.defines.ENCODE_OUTPUT="1":delete this.defines.ENCODE_OUTPUT,this.needsUpdate=!0)}isOutputEncodingEnabled(E){return this.encodeOutput}setOutputEncodingEnabled(E){this.encodeOutput=E}get time(){return this.uniforms.time.value}set time(E){this.uniforms.time.value=E}setDeltaTime(E){this.uniforms.time.value+=E}adoptCameraSettings(E){E&&(this.uniforms.cameraNear.value=E.near,this.uniforms.cameraFar.value=E.far,E instanceof po?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}setSize(E,O){let R=this.uniforms;R.resolution.value.set(E,O),R.texelSize.value.set(1/E,1/O),R.aspect.value=E/O}static get Section(){return lq}};var cq="#include <common>\n#if THREE_REVISION < 143\n#define luminance(v) linearToRelativeLuminance(v)\n#endif\n#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D inputBuffer;\n#else\nuniform lowp sampler2D inputBuffer;\n#endif\n#ifdef RANGE\nuniform vec2 range;\n#elif defined(THRESHOLD)\nuniform float threshold;uniform float smoothing;\n#endif\nvarying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);float l=luminance(texel.rgb);\n#ifdef RANGE\nfloat low=step(range.x,l);float high=step(l,range.y);l*=low*high;\n#elif defined(THRESHOLD)\nl=smoothstep(threshold,threshold+smoothing,l);\n#endif\n#ifdef COLOR\ngl_FragColor=vec4(texel.rgb*l,l);\n#else\ngl_FragColor=vec4(l);\n#endif\n}",dq=class extends lo{constructor(E=!1,O=null){super({name:"LuminanceMaterial",defines:{THREE_REVISION:ve.replace(/\D+/g,"")},uniforms:{inputBuffer:new _f(null),threshold:new _f(0),smoothing:new _f(1),range:new _f(null)},blending:qe,depthWrite:!1,depthTest:!1,fragmentShader:cq,vertexShader:CW}),this.toneMapped=!1,this.colorOutput=E,this.luminanceRange=O}set inputBuffer(E){this.uniforms.inputBuffer.value=E}setInputBuffer(E){this.uniforms.inputBuffer.value=E}get threshold(){return this.uniforms.threshold.value}set threshold(E){this.smoothing>0||E>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.threshold.value=E}getThreshold(){return this.threshold}setThreshold(E){this.threshold=E}get smoothing(){return this.uniforms.smoothing.value}set smoothing(E){this.threshold>0||E>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.smoothing.value=E}getSmoothingFactor(){return this.smoothing}setSmoothingFactor(E){this.smoothing=E}get useThreshold(){return this.threshold>0||this.smoothing>0}set useThreshold(E){}get colorOutput(){return this.defines.COLOR!==void 0}set colorOutput(E){E?this.defines.COLOR="1":delete this.defines.COLOR,this.needsUpdate=!0}isColorOutputEnabled(E){return this.colorOutput}setColorOutputEnabled(E){this.colorOutput=E}get useRange(){return this.luminanceRange!==null}set useRange(E){this.luminanceRange=null}get luminanceRange(){return this.uniforms.range.value}set luminanceRange(E){E!==null?this.defines.RANGE="1":delete this.defines.RANGE,this.uniforms.range.value=E,this.needsUpdate=!0}getLuminanceRange(){return this.luminanceRange}setLuminanceRange(E){this.luminanceRange=E}},uq="#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D inputBuffer;\n#else\nuniform lowp sampler2D inputBuffer;\n#endif\n#ifdef MASK_PRECISION_HIGH\nuniform mediump sampler2D maskTexture;\n#else\nuniform lowp sampler2D maskTexture;\n#endif\n#if MASK_FUNCTION != 0\nuniform float strength;\n#endif\nvarying vec2 vUv;void main(){\n#if COLOR_CHANNEL == 0\nfloat mask=texture2D(maskTexture,vUv).r;\n#elif COLOR_CHANNEL == 1\nfloat mask=texture2D(maskTexture,vUv).g;\n#elif COLOR_CHANNEL == 2\nfloat mask=texture2D(maskTexture,vUv).b;\n#else\nfloat mask=texture2D(maskTexture,vUv).a;\n#endif\n#if MASK_FUNCTION == 0\n#ifdef INVERTED\nmask=step(mask,0.0);\n#else\nmask=1.0-step(mask,0.0);\n#endif\n#else\nmask=clamp(mask*strength,0.0,1.0);\n#ifdef INVERTED\nmask=1.0-mask;\n#endif\n#endif\n#if MASK_FUNCTION == 2\ngl_FragColor=vec4(mask*texture2D(inputBuffer,vUv).rgb,mask);\n#else\ngl_FragColor=mask*texture2D(inputBuffer,vUv);\n#endif\n}",pq={DISCARD:0,MULTIPLY:1,MULTIPLY_RGB_SET_ALPHA:2},fq=class extends lo{constructor(E=null){super({name:"MaskMaterial",uniforms:{maskTexture:new _f(E),inputBuffer:new _f(null),strength:new _f(1)},blending:qe,depthWrite:!1,depthTest:!1,fragmentShader:uq,vertexShader:CW}),this.toneMapped=!1,this.setColorChannel(MW.RED),this.setMaskFunction(pq.DISCARD)}set inputBuffer(E){this.uniforms.inputBuffer.value=E}setInputBuffer(E){this.uniforms.inputBuffer.value=E}set maskTexture(E){this.uniforms.maskTexture.value=E,delete this.defines.MASK_PRECISION_HIGH,E.type!==wi&&(this.defines.MASK_PRECISION_HIGH="1"),this.needsUpdate=!0}setMaskTexture(E){this.maskTexture=E}set colorChannel(E){this.defines.COLOR_CHANNEL=E.toFixed(0),this.needsUpdate=!0}setColorChannel(E){this.colorChannel=E}set maskFunction(E){this.defines.MASK_FUNCTION=E.toFixed(0),this.needsUpdate=!0}setMaskFunction(E){this.maskFunction=E}get inverted(){return this.defines.INVERTED!==void 0}set inverted(E){this.inverted&&!E?delete this.defines.INVERTED:E&&(this.defines.INVERTED="1"),this.needsUpdate=!0}isInverted(){return this.inverted}setInverted(E){this.inverted=E}get strength(){return this.uniforms.strength.value}set strength(E){this.uniforms.strength.value=E}getStrength(){return this.strength}setStrength(E){this.strength=E}};var gq="#define sampleLevelZeroOffset(t, coord, offset) texture2D(t, coord + offset * texelSize)\n#if __VERSION__ < 300\n#define round(v) floor(v + 0.5)\n#endif\n#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D inputBuffer;\n#else\nuniform lowp sampler2D inputBuffer;\n#endif\nuniform lowp sampler2D areaTexture;uniform lowp sampler2D searchTexture;uniform vec2 texelSize;uniform vec2 resolution;varying vec2 vUv;varying vec4 vOffset[3];varying vec2 vPixCoord;void movec(const in bvec2 c,inout vec2 variable,const in vec2 value){if(c.x){variable.x=value.x;}if(c.y){variable.y=value.y;}}void movec(const in bvec4 c,inout vec4 variable,const in vec4 value){movec(c.xy,variable.xy,value.xy);movec(c.zw,variable.zw,value.zw);}vec2 decodeDiagBilinearAccess(in vec2 e){e.r=e.r*abs(5.0*e.r-5.0*0.75);return round(e);}vec4 decodeDiagBilinearAccess(in vec4 e){e.rb=e.rb*abs(5.0*e.rb-5.0*0.75);return round(e);}vec2 searchDiag1(const in vec2 texCoord,const in vec2 dir,out vec2 e){vec4 coord=vec4(texCoord,-1.0,1.0);vec3 t=vec3(texelSize,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(coord.z<float(MAX_SEARCH_STEPS_DIAG_INT-1)&&coord.w>0.9)){break;}coord.xyz=t*vec3(dir,1.0)+coord.xyz;e=texture2D(inputBuffer,coord.xy).rg;coord.w=dot(e,vec2(0.5));}return coord.zw;}vec2 searchDiag2(const in vec2 texCoord,const in vec2 dir,out vec2 e){vec4 coord=vec4(texCoord,-1.0,1.0);coord.x+=0.25*texelSize.x;vec3 t=vec3(texelSize,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(coord.z<float(MAX_SEARCH_STEPS_DIAG_INT-1)&&coord.w>0.9)){break;}coord.xyz=t*vec3(dir,1.0)+coord.xyz;e=texture2D(inputBuffer,coord.xy).rg;e=decodeDiagBilinearAccess(e);coord.w=dot(e,vec2(0.5));}return coord.zw;}vec2 areaDiag(const in vec2 dist,const in vec2 e,const in float offset){vec2 texCoord=vec2(AREATEX_MAX_DISTANCE_DIAG,AREATEX_MAX_DISTANCE_DIAG)*e+dist;texCoord=AREATEX_PIXEL_SIZE*texCoord+0.5*AREATEX_PIXEL_SIZE;texCoord.x+=0.5;texCoord.y+=AREATEX_SUBTEX_SIZE*offset;return texture2D(areaTexture,texCoord).rg;}vec2 calculateDiagWeights(const in vec2 texCoord,const in vec2 e,const in vec4 subsampleIndices){vec2 weights=vec2(0.0);vec4 d;vec2 end;if(e.r>0.0){d.xz=searchDiag1(texCoord,vec2(-1.0,1.0),end);d.x+=float(end.y>0.9);}else{d.xz=vec2(0.0);}d.yw=searchDiag1(texCoord,vec2(1.0,-1.0),end);if(d.x+d.y>2.0){vec4 coords=vec4(-d.x+0.25,d.x,d.y,-d.y-0.25)*texelSize.xyxy+texCoord.xyxy;vec4 c;c.xy=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(-1,0)).rg;c.zw=sampleLevelZeroOffset(inputBuffer,coords.zw,vec2(1,0)).rg;c.yxwz=decodeDiagBilinearAccess(c.xyzw);vec2 cc=vec2(2.0)*c.xz+c.yw;movec(bvec2(step(0.9,d.zw)),cc,vec2(0.0));weights+=areaDiag(d.xy,cc,subsampleIndices.z);}d.xz=searchDiag2(texCoord,vec2(-1.0,-1.0),end);if(sampleLevelZeroOffset(inputBuffer,texCoord,vec2(1,0)).r>0.0){d.yw=searchDiag2(texCoord,vec2(1.0),end);d.y+=float(end.y>0.9);}else{d.yw=vec2(0.0);}if(d.x+d.y>2.0){vec4 coords=vec4(-d.x,-d.x,d.y,d.y)*texelSize.xyxy+texCoord.xyxy;vec4 c;c.x=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(-1,0)).g;c.y=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(0,-1)).r;c.zw=sampleLevelZeroOffset(inputBuffer,coords.zw,vec2(1,0)).gr;vec2 cc=vec2(2.0)*c.xz+c.yw;movec(bvec2(step(0.9,d.zw)),cc,vec2(0.0));weights+=areaDiag(d.xy,cc,subsampleIndices.w).gr;}return weights;}float searchLength(const in vec2 e,const in float offset){vec2 scale=SEARCHTEX_SIZE*vec2(0.5,-1.0);vec2 bias=SEARCHTEX_SIZE*vec2(offset,1.0);scale+=vec2(-1.0,1.0);bias+=vec2(0.5,-0.5);scale*=1.0/SEARCHTEX_PACKED_SIZE;bias*=1.0/SEARCHTEX_PACKED_SIZE;return texture2D(searchTexture,scale*e+bias).r;}float searchXLeft(in vec2 texCoord,const in float end){vec2 e=vec2(0.0,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.x>end&&e.g>0.8281&&e.r==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(-2.0,0.0)*texelSize+texCoord;}float offset=-(255.0/127.0)*searchLength(e,0.0)+3.25;return texelSize.x*offset+texCoord.x;}float searchXRight(vec2 texCoord,const in float end){vec2 e=vec2(0.0,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.x<end&&e.g>0.8281&&e.r==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(2.0,0.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e,0.5)+3.25;return-texelSize.x*offset+texCoord.x;}float searchYUp(vec2 texCoord,const in float end){vec2 e=vec2(1.0,0.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.y>end&&e.r>0.8281&&e.g==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=-vec2(0.0,2.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e.gr,0.0)+3.25;return texelSize.y*offset+texCoord.y;}float searchYDown(vec2 texCoord,const in float end){vec2 e=vec2(1.0,0.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;i++){if(!(texCoord.y<end&&e.r>0.8281&&e.g==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(0.0,2.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e.gr,0.5)+3.25;return-texelSize.y*offset+texCoord.y;}vec2 area(const in vec2 dist,const in float e1,const in float e2,const in float offset){vec2 texCoord=vec2(AREATEX_MAX_DISTANCE)*round(4.0*vec2(e1,e2))+dist;texCoord=AREATEX_PIXEL_SIZE*texCoord+0.5*AREATEX_PIXEL_SIZE;texCoord.y=AREATEX_SUBTEX_SIZE*offset+texCoord.y;return texture2D(areaTexture,texCoord).rg;}void detectHorizontalCornerPattern(inout vec2 weights,const in vec4 texCoord,const in vec2 d){\n#if !defined(DISABLE_CORNER_DETECTION)\nvec2 leftRight=step(d.xy,d.yx);vec2 rounding=(1.0-CORNER_ROUNDING_NORM)*leftRight;rounding/=leftRight.x+leftRight.y;vec2 factor=vec2(1.0);factor.x-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(0,1)).r;factor.x-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,1)).r;factor.y-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(0,-2)).r;factor.y-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,-2)).r;weights*=clamp(factor,0.0,1.0);\n#endif\n}void detectVerticalCornerPattern(inout vec2 weights,const in vec4 texCoord,const in vec2 d){\n#if !defined(DISABLE_CORNER_DETECTION)\nvec2 leftRight=step(d.xy,d.yx);vec2 rounding=(1.0-CORNER_ROUNDING_NORM)*leftRight;rounding/=leftRight.x+leftRight.y;vec2 factor=vec2(1.0);factor.x-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(1,0)).g;factor.x-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,1)).g;factor.y-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(-2,0)).g;factor.y-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(-2,1)).g;weights*=clamp(factor,0.0,1.0);\n#endif\n}void main(){vec4 weights=vec4(0.0);vec4 subsampleIndices=vec4(0.0);vec2 e=texture2D(inputBuffer,vUv).rg;if(e.g>0.0){\n#if !defined(DISABLE_DIAG_DETECTION)\nweights.rg=calculateDiagWeights(vUv,e,subsampleIndices);if(weights.r==-weights.g){\n#endif\nvec2 d;vec3 coords;coords.x=searchXLeft(vOffset[0].xy,vOffset[2].x);coords.y=vOffset[1].y;d.x=coords.x;float e1=texture2D(inputBuffer,coords.xy).r;coords.z=searchXRight(vOffset[0].zw,vOffset[2].y);d.y=coords.z;d=round(resolution.xx*d+-vPixCoord.xx);vec2 sqrtD=sqrt(abs(d));float e2=sampleLevelZeroOffset(inputBuffer,coords.zy,vec2(1,0)).r;weights.rg=area(sqrtD,e1,e2,subsampleIndices.y);coords.y=vUv.y;detectHorizontalCornerPattern(weights.rg,coords.xyzy,d);\n#if !defined(DISABLE_DIAG_DETECTION)\n}else{e.r=0.0;}\n#endif\n}if(e.r>0.0){vec2 d;vec3 coords;coords.y=searchYUp(vOffset[1].xy,vOffset[2].z);coords.x=vOffset[0].x;d.x=coords.y;float e1=texture2D(inputBuffer,coords.xy).g;coords.z=searchYDown(vOffset[1].zw,vOffset[2].w);d.y=coords.z;d=round(resolution.yy*d-vPixCoord.yy);vec2 sqrtD=sqrt(abs(d));float e2=sampleLevelZeroOffset(inputBuffer,coords.xz,vec2(0,1)).g;weights.ba=area(sqrtD,e1,e2,subsampleIndices.x);coords.x=vUv.x;detectVerticalCornerPattern(weights.ba,coords.xyxz,d);}gl_FragColor=weights;}",eX="uniform vec2 texelSize;uniform vec2 resolution;varying vec2 vUv;varying vec4 vOffset[3];varying vec2 vPixCoord;void main(){vUv=position.xy*0.5+0.5;vPixCoord=vUv*resolution;vOffset[0]=vUv.xyxy+texelSize.xyxy*vec4(-0.25,-0.125,1.25,-0.125);vOffset[1]=vUv.xyxy+texelSize.xyxy*vec4(-0.125,-0.25,-0.125,1.25);vOffset[2]=vec4(vOffset[0].xz,vOffset[1].yw)+vec4(-2.0,2.0,-2.0,2.0)*texelSize.xxyy*MAX_SEARCH_STEPS_FLOAT;gl_Position=vec4(position.xy,1.0,1.0);}",tX=class extends lo{constructor(E=new bn,O=new bn){super({name:"SMAAWeightsMaterial",defines:{MAX_SEARCH_STEPS_INT:"16",MAX_SEARCH_STEPS_FLOAT:"16.0",MAX_SEARCH_STEPS_DIAG_INT:"8",MAX_SEARCH_STEPS_DIAG_FLOAT:"8.0",CORNER_ROUNDING:"25",CORNER_ROUNDING_NORM:"0.25",AREATEX_MAX_DISTANCE:"16.0",AREATEX_MAX_DISTANCE_DIAG:"20.0",AREATEX_PIXEL_SIZE:"(1.0 / vec2(160.0, 560.0))",AREATEX_SUBTEX_SIZE:"(1.0 / 7.0)",SEARCHTEX_SIZE:"vec2(66.0, 33.0)",SEARCHTEX_PACKED_SIZE:"vec2(64.0, 16.0)"},uniforms:{inputBuffer:new _f(null),searchTexture:new _f(null),areaTexture:new _f(null),resolution:new _f(O),texelSize:new _f(E)},blending:qe,depthWrite:!1,depthTest:!1,fragmentShader:gq,vertexShader:eX}),this.toneMapped=!1}set inputBuffer(E){this.uniforms.inputBuffer.value=E}setInputBuffer(E){this.uniforms.inputBuffer.value=E}get searchTexture(){return this.uniforms.searchTexture.value}set searchTexture(E){this.uniforms.searchTexture.value=E}get areaTexture(){return this.uniforms.areaTexture.value}set areaTexture(E){this.uniforms.areaTexture.value=E}setLookupTextures(E,O){this.searchTexture=E,this.areaTexture=O}get orthogonalSearchSteps(){return Number(this.defines.MAX_SEARCH_STEPS_INT)}set orthogonalSearchSteps(E){let O=Math.min(Math.max(E,0),112);this.defines.MAX_SEARCH_STEPS_INT=O.toFixed("0"),this.defines.MAX_SEARCH_STEPS_FLOAT=O.toFixed("1"),this.needsUpdate=!0}setOrthogonalSearchSteps(E){this.orthogonalSearchSteps=E}get diagonalSearchSteps(){return Number(this.defines.MAX_SEARCH_STEPS_DIAG_INT)}set diagonalSearchSteps(E){let O=Math.min(Math.max(E,0),20);this.defines.MAX_SEARCH_STEPS_DIAG_INT=O.toFixed("0"),this.defines.MAX_SEARCH_STEPS_DIAG_FLOAT=O.toFixed("1"),this.needsUpdate=!0}setDiagonalSearchSteps(E){this.diagonalSearchSteps=E}get diagonalDetection(){return this.defines.DISABLE_DIAG_DETECTION===void 0}set diagonalDetection(E){E?delete this.defines.DISABLE_DIAG_DETECTION:this.defines.DISABLE_DIAG_DETECTION="1",this.needsUpdate=!0}isDiagonalDetectionEnabled(){return this.diagonalDetection}setDiagonalDetectionEnabled(E){this.diagonalDetection=E}get cornerRounding(){return Number(this.defines.CORNER_ROUNDING)}set cornerRounding(E){let O=Math.min(Math.max(E,0),100);this.defines.CORNER_ROUNDING=O.toFixed("4"),this.defines.CORNER_ROUNDING_NORM=(O/100).toFixed("4"),this.needsUpdate=!0}setCornerRounding(E){this.cornerRounding=E}get cornerDetection(){return this.defines.DISABLE_CORNER_DETECTION===void 0}set cornerDetection(E){E?delete this.defines.DISABLE_CORNER_DETECTION:this.defines.DISABLE_CORNER_DETECTION="1",this.needsUpdate=!0}isCornerRoundingEnabled(){return this.cornerDetection}setCornerRoundingEnabled(E){this.cornerDetection=E}setSize(E,O){let R=this.uniforms;R.texelSize.value.set(1/E,1/O),R.resolution.value.set(E,O)}};var rX=new co,uX=null;function GK(){if(uX===null){let E=new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),O=new Float32Array([0,0,2,0,0,2]);uX=new Na,uX.setAttribute!==void 0?(uX.setAttribute("position",new Sa(E,3)),uX.setAttribute("uv",new Sa(O,2))):(uX.addAttribute("position",new Sa(E,3)),uX.addAttribute("uv",new Sa(O,2)))}return uX}var wX=class{constructor(E="Pass",O=new Wd,R=rX){this.name=E,this.renderer=null,this.scene=O,this.camera=R,this.screen=null,this.rtt=!0,this.needsSwap=!0,this.needsDepthTexture=!1,this.enabled=!0}get renderToScreen(){return!this.rtt}set renderToScreen(E){if(this.rtt===E){let O=this.getFullscreenMaterial();O!==null&&(O.needsUpdate=!0),this.rtt=!E}}setRenderer(E){this.renderer=E}isEnabled(){return this.enabled}setEnabled(E){this.enabled=E}get fullscreenMaterial(){return this.screen!==null?this.screen.material:null}set fullscreenMaterial(E){let O=this.screen;O!==null?O.material=E:(O=new eo(GK(),E),O.frustumCulled=!1,this.scene===null&&(this.scene=new Wd),this.scene.add(O),this.screen=O)}getFullscreenMaterial(){return this.fullscreenMaterial}setFullscreenMaterial(E){this.fullscreenMaterial=E}getDepthTexture(){return null}setDepthTexture(E,O=Qr){}render(E,O,R,z,V){throw new Error("Render method not implemented!")}setSize(E,O){}initialize(E,O,R){}dispose(){for(let E of Object.keys(this)){let O=this[E];if(O!==null&&typeof O=="object"&&typeof O.dispose=="function"){if(O instanceof Wd||O===this.renderer)continue;this[E].dispose()}}}},AX=class extends wX{constructor(E,O=!0){super("CopyPass"),this.fullscreenMaterial=new KW,this.needsSwap=!1,this.renderTarget=E,E===void 0&&(this.renderTarget=new Un(1,1,{minFilter:yi,magFilter:yi,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="CopyPass.Target"),this.autoResize=O}get resize(){return this.autoResize}set resize(E){this.autoResize=E}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}setAutoResizeEnabled(E){this.autoResize=E}render(E,O,R,z,V){this.fullscreenMaterial.inputBuffer=O.texture,E.setRenderTarget(this.renderToScreen?null:this.renderTarget),E.render(this.scene,this.camera)}setSize(E,O){this.autoResize&&this.renderTarget.setSize(E,O)}initialize(E,O,R){R!==void 0&&(this.renderTarget.texture.type=R,R!==wi?this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1":E.outputEncoding===Yr&&(this.renderTarget.texture.encoding=Yr))}};var EX=class extends wX{constructor(){super("ClearMaskPass",null,null),this.needsSwap=!1}render(E,O,R,z,V){let j=E.state.buffers.stencil;j.setLocked(!1),j.setTest(!1)}},TX=new On,DX=class extends wX{constructor(E=!0,O=!0,R=!1){super("ClearPass",null,null),this.needsSwap=!1,this.color=E,this.depth=O,this.stencil=R,this.overrideClearColor=null,this.overrideClearAlpha=-1}setClearFlags(E,O,R){this.color=E,this.depth=O,this.stencil=R}getOverrideClearColor(){return this.overrideClearColor}setOverrideClearColor(E){this.overrideClearColor=E}getOverrideClearAlpha(){return this.overrideClearAlpha}setOverrideClearAlpha(E){this.overrideClearAlpha=E}render(E,O,R,z,V){let j=this.overrideClearColor,Y=this.overrideClearAlpha,ee=E.getClearAlpha(),se=j!==null,he=Y>=0;se?(TX.copy(E.getClearColor(TX)),E.setClearColor(j,he?Y:ee)):he&&E.setClearAlpha(Y),E.setRenderTarget(this.renderToScreen?null:O),E.clear(this.color,this.depth,this.stencil),se?E.setClearColor(TX,ee):he&&E.setClearAlpha(ee)}},OX=-1,RX=class extends pn{constructor(E,O=OX,R=OX,z=1){super(),this.resizable=E,this.base=new bn(1,1),this.preferred=new bn(O,R),this.target=this.preferred,this.s=z}get width(){let E,{base:O,preferred:R,scale:z}=this;return E=R.width!==OX?R.width:R.height!==OX?Math.round(R.height*(O.width/Math.max(O.height,1))):Math.round(O.width*z),E}set width(E){this.preferredWidth=E}get height(){let E,{base:O,preferred:R,scale:z}=this;return E=R.height!==OX?R.height:R.width!==OX?Math.round(R.width/Math.max(O.width/Math.max(O.height,1),1)):Math.round(O.height*z),E}set height(E){this.preferredHeight=E}getWidth(){return this.width}getHeight(){return this.height}get scale(){return this.s}set scale(E){this.s!==E&&(this.s=E,this.preferred.setScalar(OX),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getScale(){return this.scale}setScale(E){this.scale=E}get baseWidth(){return this.base.width}set baseWidth(E){this.base.width!==E&&(this.base.width=E,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getBaseWidth(){return this.base.width}setBaseWidth(E){this.base.width!==E&&(this.base.width=E,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}get baseHeight(){return this.base.height}set baseHeight(E){this.base.height!==E&&(this.base.height=E,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getBaseHeight(){return this.baseHeight}setBaseHeight(E){this.baseHeight=E}setBaseSize(E,O){(this.base.width!==E||this.base.height!==O)&&(this.base.set(E,O),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}get preferredWidth(){return this.preferred.width}set preferredWidth(E){this.preferred.width!==E&&(this.preferred.width=E,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getPreferredWidth(){return this.preferredWidth}setPreferredWidth(E){this.preferredWidth=E}get preferredHeight(){return this.preferred.height}set preferredHeight(E){this.preferred.height!==E&&(this.preferred.height=E,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getPreferredHeight(){return this.preferredHeight}setPreferredHeight(E){this.preferredHeight=E}setPreferredSize(E,O){(this.preferred.width!==E||this.preferred.height!==O)&&(this.preferred.set(E,O),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}copy(E){this.base.set(E.getBaseWidth(),E.getBaseHeight()),this.preferred.set(E.getPreferredWidth(),E.getPreferredHeight()),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height)}static get AUTO_SIZE(){return OX}},BX=!1,zX=class{constructor(E=null){this.originalMaterials=new Map,this.material=null,this.materials=null,this.materialsBackSide=null,this.materialsDoubleSide=null,this.materialsFlatShaded=null,this.materialsFlatShadedBackSide=null,this.materialsFlatShadedDoubleSide=null,this.setMaterial(E),this.meshCount=0,this.replaceMaterial=E=>{if(E.isMesh){let O;if(E.material.flatShading)switch(E.material.side){case Ge:O=this.materialsFlatShadedDoubleSide;break;case Ue:O=this.materialsFlatShadedBackSide;break;default:O=this.materialsFlatShaded;break}else switch(E.material.side){case Ge:O=this.materialsDoubleSide;break;case Ue:O=this.materialsBackSide;break;default:O=this.materials;break}this.originalMaterials.set(E,E.material),E.isSkinnedMesh?E.material=O[2]:E.isInstancedMesh?E.material=O[1]:E.material=O[0],++this.meshCount}}}setMaterial(E){if(this.disposeMaterials(),this.material=E,E!==null){let O=this.materials=[E.clone(),E.clone(),E.clone()];for(let R of O)R.uniforms=Object.assign({},E.uniforms),R.side=Fe;O[2].skinning=!0,this.materialsBackSide=O.map((O=>{let R=O.clone();return R.uniforms=Object.assign({},E.uniforms),R.side=Ue,R})),this.materialsDoubleSide=O.map((O=>{let R=O.clone();return R.uniforms=Object.assign({},E.uniforms),R.side=Ge,R})),this.materialsFlatShaded=O.map((O=>{let R=O.clone();return R.uniforms=Object.assign({},E.uniforms),R.flatShading=!0,R})),this.materialsFlatShadedBackSide=O.map((O=>{let R=O.clone();return R.uniforms=Object.assign({},E.uniforms),R.flatShading=!0,R.side=Ue,R})),this.materialsFlatShadedDoubleSide=O.map((O=>{let R=O.clone();return R.uniforms=Object.assign({},E.uniforms),R.flatShading=!0,R.side=Ge,R}))}}render(E,O,R){let z=E.shadowMap.enabled;if(E.shadowMap.enabled=!1,BX){let z=this.originalMaterials;this.meshCount=0,O.traverse(this.replaceMaterial),E.render(O,R);for(let E of z)E[0].material=E[1];this.meshCount!==z.size&&z.clear()}else{let z=O.overrideMaterial;O.overrideMaterial=this.material,E.render(O,R),O.overrideMaterial=z}E.shadowMap.enabled=z}disposeMaterials(){if(this.material!==null){let E=this.materials.concat(this.materialsBackSide).concat(this.materialsDoubleSide).concat(this.materialsFlatShaded).concat(this.materialsFlatShadedBackSide).concat(this.materialsFlatShadedDoubleSide);for(let O of E)O.dispose()}}dispose(){this.originalMaterials.clear(),this.disposeMaterials()}static get workaroundEnabled(){return BX}static set workaroundEnabled(E){BX=E}},NX=class extends wX{constructor(E,O,R=null){super("RenderPass",E,O),this.needsSwap=!1,this.clearPass=new DX,this.overrideMaterialManager=R===null?null:new zX(R),this.ignoreBackground=!1,this.skipShadowMapUpdate=!1,this.selection=null}get renderToScreen(){return super.renderToScreen}set renderToScreen(E){super.renderToScreen=E,this.clearPass.renderToScreen=E}get overrideMaterial(){let E=this.overrideMaterialManager;return E!==null?E.material:null}set overrideMaterial(E){let O=this.overrideMaterialManager;E!==null?O!==null?O.setMaterial(E):this.overrideMaterialManager=new zX(E):O!==null&&(O.dispose(),this.overrideMaterialManager=null)}getOverrideMaterial(){return this.overrideMaterial}setOverrideMaterial(E){this.overrideMaterial=E}get clear(){return this.clearPass.enabled}set clear(E){this.clearPass.enabled=E}getSelection(){return this.selection}setSelection(E){this.selection=E}isBackgroundDisabled(){return this.ignoreBackground}setBackgroundDisabled(E){this.ignoreBackground=E}isShadowMapDisabled(){return this.skipShadowMapUpdate}setShadowMapDisabled(E){this.skipShadowMapUpdate=E}getClearPass(){return this.clearPass}render(E,O,R,z,V){let j=this.scene,Y=this.camera,ee=this.selection,se=Y.layers.mask,he=j.background,ce=E.shadowMap.autoUpdate,ue=this.renderToScreen?null:O;ee!==null&&Y.layers.set(ee.getLayer()),this.skipShadowMapUpdate&&(E.shadowMap.autoUpdate=!1),(this.ignoreBackground||this.clearPass.overrideClearColor!==null)&&(j.background=null),this.clearPass.enabled&&this.clearPass.render(E,O),E.setRenderTarget(ue),this.overrideMaterialManager!==null?this.overrideMaterialManager.render(E,j,Y):E.render(j,Y),Y.layers.mask=se,j.background=he,E.shadowMap.autoUpdate=ce}},UX=class extends wX{constructor(E,O,{resolutionScale:R=1,width:z=RX.AUTO_SIZE,height:V=RX.AUTO_SIZE,renderTarget:j}={}){super("DepthPass"),this.needsSwap=!1,this.renderPass=new NX(E,O,new Dd({depthPacking:Kr}));let Y=this.renderPass;Y.skipShadowMapUpdate=!0,Y.ignoreBackground=!0;let ee=Y.getClearPass();ee.overrideClearColor=new On(16777215),ee.overrideClearAlpha=1,this.renderTarget=j,this.renderTarget===void 0&&(this.renderTarget=new Un(1,1,{minFilter:mi,magFilter:mi,stencilBuffer:!1}),this.renderTarget.texture.name="DepthPass.Target");let se=this.resolution=new RX(this,z,V,R);se.addEventListener("change",(E=>this.setSize(se.baseWidth,se.baseHeight)))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}getResolutionScale(){return this.resolution.scale}setResolutionScale(E){this.resolution.scale=E}render(E,O,R,z,V){let j=this.renderToScreen?null:this.renderTarget;this.renderPass.render(E,j)}setSize(E,O){let R=this.resolution;R.setBaseSize(E,O),this.renderTarget.setSize(R.width,R.height)}};new Float32Array([255/256/256**3,255/256/65536,255/256/256,255/256]);var kX={SKIP:0,ADD:1,ALPHA:2,AVERAGE:3,COLOR_BURN:4,COLOR_DODGE:5,DARKEN:6,DIFFERENCE:7,EXCLUSION:8,LIGHTEN:9,MULTIPLY:10,DIVIDE:11,NEGATION:12,NORMAL:13,OVERLAY:14,REFLECT:15,SCREEN:16,SOFT_LIGHT:17,SUBTRACT:18},VX="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return min(x+y,1.0)*opacity+x*(1.0-opacity);}",jX="vec3 blend(const in vec3 x,const in vec3 y,const in float opacity){return y*opacity+x*(1.0-opacity);}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){float a=min(y.a,opacity);return vec4(blend(x.rgb,y.rgb,a),max(x.a,a));}",HX="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return(x+y)*0.5*opacity+x*(1.0-opacity);}",JX="float blend(const in float x,const in float y){return(y==0.0)?y:max(1.0-(1.0-x)/y,0.0);}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",$X="float blend(const in float x,const in float y){return(y==1.0)?y:min(x/(1.0-y),1.0);}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",eY="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return min(x,y)*opacity+x*(1.0-opacity);}",tY="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return abs(x-y)*opacity+x*(1.0-opacity);}",iY="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return(x+y-2.0*x*y)*opacity+x*(1.0-opacity);}",rY="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return max(x,y)*opacity+x*(1.0-opacity);}",nY="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return x*y*opacity+x*(1.0-opacity);}",sY="float blend(const in float x,const in float y){return(y>0.0)?min(x/y,1.0):1.0;}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",aY="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return(1.0-abs(1.0-x-y))*opacity+x*(1.0-opacity);}",oY="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return y*opacity+x*(1.0-opacity);}",lY="float blend(const in float x,const in float y){return(x<0.5)?(2.0*x*y):(1.0-2.0*(1.0-x)*(1.0-y));}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",cY="float blend(const in float x,const in float y){return(y==1.0)?y:min(x*x/(1.0-y),1.0);}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",fY="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return(1.0-(1.0-x)*(1.0-y))*opacity+x*(1.0-opacity);}",xY="float blend(const in float x,const in float y){return(y<0.5)?(2.0*x*y+x*x*(1.0-2.0*y)):(sqrt(x)*(2.0*y-1.0)+2.0*x*(1.0-y));}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",bY="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return max(x+y-1.0,0.0)*opacity+x*(1.0-opacity);}",MY=new Map([[kX.SKIP,null],[kX.ADD,VX],[kX.ALPHA,jX],[kX.AVERAGE,HX],[kX.COLOR_BURN,JX],[kX.COLOR_DODGE,$X],[kX.DARKEN,eY],[kX.DIFFERENCE,tY],[kX.EXCLUSION,iY],[kX.LIGHTEN,rY],[kX.MULTIPLY,nY],[kX.DIVIDE,sY],[kX.NEGATION,aY],[kX.NORMAL,oY],[kX.OVERLAY,lY],[kX.REFLECT,cY],[kX.SCREEN,fY],[kX.SOFT_LIGHT,xY],[kX.SUBTRACT,bY]]),TY=class extends pn{constructor(E,O=1){super(),this.f=E,this.opacity=new _f(O)}getOpacity(){return this.opacity.value}setOpacity(E){this.opacity.value=E}get blendFunction(){return this.f}set blendFunction(E){this.f=E,this.dispatchEvent({type:"change"})}getBlendFunction(){return this.blendFunction}setBlendFunction(E){this.blendFunction=E}getShaderCode(){return MY.get(this.blendFunction)}},zY={NONE:0,DEPTH:1,CONVOLUTION:2};var kY=class extends pn{constructor(E,O,{attributes:R=zY.NONE,blendFunction:z=kX.SCREEN,defines:V=new Map,uniforms:j=new Map,extensions:Y=null,vertexShader:ee=null}={}){super(),this.name=E,this.renderer=null,this.attributes=R,this.fragmentShader=O,this.vertexShader=ee,this.defines=V,this.uniforms=j,this.extensions=Y,this.blendMode=new TY(z),this.blendMode.addEventListener("change",(E=>this.setChanged()))}getName(){return this.name}setRenderer(E){this.renderer=E}getDefines(){return this.defines}getUniforms(){return this.uniforms}getExtensions(){return this.extensions}getBlendMode(){return this.blendMode}getAttributes(){return this.attributes}setAttributes(E){this.attributes=E,this.setChanged()}getFragmentShader(){return this.fragmentShader}setFragmentShader(E){this.fragmentShader=E,this.setChanged()}getVertexShader(){return this.vertexShader}setVertexShader(E){this.vertexShader=E,this.setChanged()}setChanged(){this.dispatchEvent({type:"change"})}setDepthTexture(E,O=Qr){}update(E,O,R){}setSize(E,O){}initialize(E,O,R){}dispose(){for(let E of Object.keys(this)){let O=this[E];if(O!==null&&typeof O=="object"&&typeof O.dispose=="function"){if(O instanceof Wd||O===this.renderer)continue;this[E].dispose()}}}};function G3(E,O,R){for(let z of O){let O="$1"+E+z.charAt(0).toUpperCase()+z.slice(1),V=new RegExp("([^\\.])(\\b"+z+"\\b)","g");for(let E of R.entries())E[1]!==null&&R.set(E[0],E[1].replace(V,O))}}function uQ(E,O,R,z,V,j,Y){let ee=new Map([["fragment",O.getFragmentShader()],["vertex",O.getVertexShader()]]),se=ee.get("fragment")!==void 0&&/mainImage/.test(ee.get("fragment")),he=ee.get("fragment")!==void 0&&/mainUv/.test(ee.get("fragment")),ce=[],ue=[],fe=!1,ve=!1;if(ee.get("fragment")===void 0)console.error("Missing fragment shader",O);else if(he&&(Y&zY.CONVOLUTION)!==0)console.error("Effects that transform UV coordinates are incompatible with convolution effects",O);else if(se||he){let we=/(?:\w+\s+(\w+)\([\w\s,]*\)\s*{[^}]+})/g,Se=hq.Section;if(he){let O=`\t${E}MainUv(UV);\n`;R.set(Se.FRAGMENT_MAIN_UV,R.get(Se.FRAGMENT_MAIN_UV)+O),fe=!0}if(ee.get("vertex")!==null&&/mainSupport/.test(ee.get("vertex"))){let O=`\t${E}MainSupport(`;O+=/mainSupport *\([\w\s]*?uv\s*?\)/.test(ee.get("vertex"))?"vUv);\n":");\n",R.set(Se.VERTEX_MAIN_SUPPORT,R.get(Se.VERTEX_MAIN_SUPPORT)+O),ce=ce.concat([...ee.get("vertex").matchAll(/(?:varying\s+\w+\s+(\w*))/g)].map((E=>E[1]))),ue=ue.concat(ce).concat([...ee.get("vertex").matchAll(we)].map((E=>E[1])))}ue=ue.concat([...ee.get("fragment").matchAll(we)].map((E=>E[1]))),ue=ue.concat([...O.defines.keys()].map((E=>E.replace(/\([\w\s,]*\)/g,"")))),ue=ue.concat([...O.uniforms.keys()]),O.uniforms.forEach(((O,R)=>j.set(E+R.charAt(0).toUpperCase()+R.slice(1),O))),O.defines.forEach(((O,R)=>V.set(E+R.charAt(0).toUpperCase()+R.slice(1),O))),G3(E,ue,V),G3(E,ue,ee);let _e=O.blendMode;if(z.set(_e.blendFunction,_e),se){let O=/MainImage *\([\w\s,]*?depth[\w\s,]*?\)/,z=`${E}MainImage(color0, UV, `;(Y&zY.DEPTH)!==0&&O.test(ee.get("fragment"))&&(z+="depth, ",ve=!0),z+="color1);\n\t";let V=E+"BlendOpacity";j.set(V,_e.opacity),z+=`color0 = blend${_e.blendFunction}(color0, color1, ${V});\n\n\t`,R.set(Se.FRAGMENT_MAIN_IMAGE,R.get(Se.FRAGMENT_MAIN_IMAGE)+z),z=`uniform float ${V};\n\n`,R.set(Se.FRAGMENT_HEAD,R.get(Se.FRAGMENT_HEAD)+z)}R.set(Se.FRAGMENT_HEAD,R.get(Se.FRAGMENT_HEAD)+ee.get("fragment")+"\n"),ee.get("vertex")!==null&&R.set(Se.VERTEX_HEAD,R.get(Se.VERTEX_HEAD)+ee.get("vertex")+"\n")}else console.error("The fragment shader contains neither a mainImage nor a mainUv function",O);return{varyings:ce,transformedUv:fe,readDepth:ve}}var XY=class extends wX{constructor(E,...O){super("EffectPass"),this.fullscreenMaterial=new hq(null,null,null,E),this.effects=O.sort(((E,O)=>O.attributes-E.attributes)),this.skipRendering=!1,this.uniformCount=0,this.varyingCount=0,this.minTime=1,this.maxTime=Number.POSITIVE_INFINITY}get encodeOutput(){return this.fullscreenMaterial.encodeOutput}set encodeOutput(E){this.fullscreenMaterial.encodeOutput=E}get dithering(){return this.fullscreenMaterial.dithering}set dithering(E){let O=this.fullscreenMaterial;O.dithering=E,O.needsUpdate=!0}verifyResources(){let E=this.renderer.capabilities,O=Math.min(E.maxFragmentUniforms,E.maxVertexUniforms);this.uniformCount>O&&console.warn("The current rendering context doesn't support more than "+O+" uniforms, but "+this.uniformCount+" were defined"),O=E.maxVaryings,this.varyingCount>O&&console.warn("The current rendering context doesn't support more than "+O+" varyings, but "+this.varyingCount+" were defined")}updateMaterial(){let E=hq.Section,O=new Map([[E.FRAGMENT_HEAD,""],[E.FRAGMENT_MAIN_UV,""],[E.FRAGMENT_MAIN_IMAGE,""],[E.VERTEX_HEAD,""],[E.VERTEX_MAIN_SUPPORT,""]]),R=new Map,z=new Map,V=new Map,j=new Set,Y=0,ee=0,se=0,he=!1,ce=!1;for(let E of this.effects)if(E.blendMode.blendFunction===kX.SKIP)se|=E.getAttributes()&zY.DEPTH;else if((se&E.getAttributes()&zY.CONVOLUTION)!==0)console.error("Convolution effects cannot be merged",E);else{se|=E.getAttributes();let ue="e"+Y++,fe=uQ(ue,E,O,R,z,V,se);if(ee+=fe.varyings.length,he=he||fe.transformedUv,ce=ce||fe.readDepth,E.extensions!==null)for(let O of E.extensions)j.add(O)}let ue=/\bblend\b/g;for(let z of R.values()){let R=z.getShaderCode().replace(ue,`blend${z.blendFunction}`);O.set(E.FRAGMENT_HEAD,O.get(E.FRAGMENT_HEAD)+R+"\n")}if((se&zY.DEPTH)!==0){if(ce){let R="float depth = readDepth(UV);\n\n\t";O.set(E.FRAGMENT_MAIN_IMAGE,R+O.get(E.FRAGMENT_MAIN_IMAGE))}this.needsDepthTexture=this.getDepthTexture()===null}else this.needsDepthTexture=!1;if(he){let R="vec2 transformedUv = vUv;\n";O.set(E.FRAGMENT_MAIN_UV,R+O.get(E.FRAGMENT_MAIN_UV)),z.set("UV","transformedUv")}else z.set("UV","vUv");O.forEach(((E,O,R)=>R.set(O,E.trim().replace(/^#/,"\n#")))),this.uniformCount=V.size,this.varyingCount=ee,this.skipRendering=Y===0,this.needsSwap=!this.skipRendering,this.fullscreenMaterial.setShaderParts(O).setExtensions(j).setUniforms(V).setDefines(z)}recompile(){this.updateMaterial(),this.verifyResources()}getDepthTexture(){return this.fullscreenMaterial.depthBuffer}setDepthTexture(E,O=Qr){this.fullscreenMaterial.depthBuffer=E,this.fullscreenMaterial.depthPacking=O;for(let R of this.effects)R.setDepthTexture(E,O)}render(E,O,R,z,V){for(let R of this.effects)R.update(E,O,z);if(!this.skipRendering||this.renderToScreen){let V=this.fullscreenMaterial;V.inputBuffer=O.texture,V.time+=z,E.setRenderTarget(this.renderToScreen?null:R),E.render(this.scene,this.camera)}}setSize(E,O){this.fullscreenMaterial.setSize(E,O);for(let R of this.effects)R.setSize(E,O)}initialize(E,O,R){this.renderer=E;for(let z of this.effects)z.initialize(E,O,R),z.addEventListener("change",(E=>this.handleEvent(E)));this.updateMaterial(),this.verifyResources(),R!==void 0&&R!==wi&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}dispose(){super.dispose();for(let E of this.effects)E.dispose()}handleEvent(E){switch(E.type){case"change":this.recompile();break}}},ZY=[new Float32Array([0,0]),new Float32Array([0,1,1]),new Float32Array([0,1,1,2]),new Float32Array([0,1,2,2,3]),new Float32Array([0,1,2,3,4,4,5]),new Float32Array([0,1,2,3,4,5,7,8,9,10])],JY=class extends wX{constructor({resolutionScale:E=.5,width:O=RX.AUTO_SIZE,height:R=RX.AUTO_SIZE,kernelSize:z=sQ.LARGE}={}){super("KawaseBlurPass"),this.renderTargetA=new Un(1,1,{minFilter:yi,magFilter:yi,stencilBuffer:!1,depthBuffer:!1}),this.renderTargetA.texture.name="Blur.Target.A",this.renderTargetB=this.renderTargetA.clone(),this.renderTargetB.texture.name="Blur.Target.B";let V=this.resolution=new RX(this,O,R,E);V.addEventListener("change",(E=>this.setSize(V.baseWidth,V.baseHeight))),this.blurMaterial=new VW,this.ditheredBlurMaterial=new VW,this.ditheredBlurMaterial.uniforms.scale=this.blurMaterial.uniforms.scale,this.ditheredBlurMaterial.dithering=!0,this.dithering=!1,this.kernelSize=z}getResolution(){return this.resolution}get width(){return this.resolution.width}set width(E){this.resolution.preferredWidth=E}get height(){return this.resolution.height}set height(E){this.resolution.preferredHeight=E}get scale(){return this.blurMaterial.scale}set scale(E){this.blurMaterial.scale=E}getScale(){return this.blurMaterial.scale}setScale(E){this.blurMaterial.scale=E}getKernelSize(){return this.kernelSize}setKernelSize(E){this.kernelSize=E}getResolutionScale(){return this.resolution.scale}setResolutionScale(E){this.resolution.scale=E}render(E,O,R,z,V){let j,Y,ee=this.scene,se=this.camera,he=this.renderTargetA,ce=this.renderTargetB,ue=ZY[this.kernelSize],fe=this.blurMaterial,ve=O;for(this.fullscreenMaterial=fe,j=0,Y=ue.length-1;j<Y;++j){let O=(j&1)===0?he:ce;fe.kernel=ue[j],fe.inputBuffer=ve.texture,E.setRenderTarget(O),E.render(ee,se),ve=O}this.dithering&&(fe=this.ditheredBlurMaterial,this.fullscreenMaterial=fe),fe.kernel=ue[j],fe.inputBuffer=ve.texture,E.setRenderTarget(this.renderToScreen?null:R),E.render(ee,se)}setSize(E,O){let R=this.resolution;R.setBaseSize(E,O);let z=R.width,V=R.height;this.renderTargetA.setSize(z,V),this.renderTargetB.setSize(z,V),this.blurMaterial.setSize(z,V),this.ditheredBlurMaterial.setSize(z,V)}initialize(E,O,R){R!==void 0&&(this.renderTargetA.texture.type=R,this.renderTargetB.texture.type=R,R!==wi?(this.blurMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1",this.ditheredBlurMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1"):E.outputEncoding===Yr&&(this.renderTargetA.texture.encoding=Yr,this.renderTargetB.texture.encoding=Yr))}static get AUTO_SIZE(){return RX.AUTO_SIZE}};var $Y=class extends wX{constructor({width:E=RX.AUTO_SIZE,height:O=RX.AUTO_SIZE,renderTarget:R,luminanceRange:z,colorOutput:V}={}){super("LuminancePass"),this.fullscreenMaterial=new dq(V,z),this.needsSwap=!1,this.renderTarget=R,this.renderTarget===void 0&&(this.renderTarget=new Un(1,1,{minFilter:yi,magFilter:yi,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="LuminancePass.Target",this.renderTarget.texture.generateMipmaps=!1);let j=this.resolution=new RX(this,E,O);j.addEventListener("change",(E=>this.setSize(j.baseWidth,j.baseHeight)))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}render(E,O,R,z,V){let j=this.fullscreenMaterial;j.inputBuffer=O.texture,E.setRenderTarget(this.renderToScreen?null:this.renderTarget),E.render(this.scene,this.camera)}setSize(E,O){let R=this.resolution;R.setBaseSize(E,O),this.renderTarget.setSize(R.width,R.height)}initialize(E,O,R){R!==void 0&&R!==wi&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}},eQ=class extends wX{constructor(E,O){super("MaskPass",E,O),this.needsSwap=!1,this.clearPass=new DX(!1,!1,!0),this.inverse=!1}get inverted(){return this.inverse}set inverted(E){this.inverse=E}get clear(){return this.clearPass.enabled}set clear(E){this.clearPass.enabled=E}getClearPass(){return this.clearPass}isInverted(){return this.inverted}setInverted(E){this.inverted=E}render(E,O,R,z,V){let j=E.getContext(),Y=E.state.buffers,ee=this.scene,se=this.camera,he=this.clearPass,ce=this.inverted?0:1,ue=1-ce;Y.color.setMask(!1),Y.depth.setMask(!1),Y.color.setLocked(!0),Y.depth.setLocked(!0),Y.stencil.setTest(!0),Y.stencil.setOp(j.REPLACE,j.REPLACE,j.REPLACE),Y.stencil.setFunc(j.ALWAYS,ce,4294967295),Y.stencil.setClear(ue),Y.stencil.setLocked(!0),this.clearPass.enabled&&(this.renderToScreen?he.render(E,null):(he.render(E,O),he.render(E,R))),this.renderToScreen?(E.setRenderTarget(null),E.render(ee,se)):(E.setRenderTarget(O),E.render(ee,se),E.setRenderTarget(R),E.render(ee,se)),Y.color.setLocked(!1),Y.depth.setLocked(!1),Y.stencil.setLocked(!1),Y.stencil.setFunc(j.EQUAL,1,4294967295),Y.stencil.setOp(j.KEEP,j.KEEP,j.KEEP),Y.stencil.setLocked(!0)}};var tQ=class extends wX{constructor(E,O="inputBuffer"){super("ShaderPass"),this.fullscreenMaterial=E,this.inputBufferUniform=null,this.setInput(O)}setInput(E){if(this.inputBufferUniform=null,this.fullscreenMaterial!==null){let O=this.fullscreenMaterial.uniforms;O!==void 0&&O[E]!==void 0&&(this.inputBufferUniform=O[E])}}render(E,O,R,z,V){this.inputBufferUniform!==null&&O!==null&&(this.inputBufferUniform.value=O.texture),E.setRenderTarget(this.renderToScreen?null:R),E.render(this.scene,this.camera)}initialize(E,O,R){R!==void 0&&R!==wi&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}},iQ=.001,rQ=1e3,nQ=class{constructor(){this.previousTime=0,this.currentTime=0,this.delta=0,this.fixedDelta=1e3/60,this.elapsed=0,this.timescale=1,this.fixedDeltaEnabled=!1,this.autoReset=!1}setFixedDeltaEnabled(E){return this.fixedDeltaEnabled=E,this}isAutoResetEnabled(E){return this.autoReset}setAutoResetEnabled(E){return typeof document<"u"&&document.hidden!==void 0&&(E?document.addEventListener("visibilitychange",this):document.removeEventListener("visibilitychange",this),this.autoReset=E),this}getDelta(){return this.delta*iQ}getFixedDelta(){return this.fixedDelta*iQ}setFixedDelta(E){return this.fixedDelta=E*rQ,this}getElapsed(){return this.elapsed*iQ}getTimescale(){return this.timescale}setTimescale(E){return this.timescale=E,this}update(E){return this.fixedDeltaEnabled?this.delta=this.fixedDelta:(this.previousTime=this.currentTime,this.currentTime=E!==void 0?E:performance.now(),this.delta=this.currentTime-this.previousTime),this.delta*=this.timescale,this.elapsed+=this.delta,this}reset(){return this.delta=0,this.elapsed=0,this.currentTime=performance.now(),this}handleEvent(E){document.hidden||(this.currentTime=performance.now())}dispose(){this.setAutoResetEnabled(!1)}};var sQ={VERY_SMALL:0,SMALL:1,MEDIUM:2,LARGE:3,VERY_LARGE:4,HUGE:5};var aQ="#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D map;\n#else\nuniform lowp sampler2D map;\n#endif\nuniform float intensity;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){outputColor=clamp(texture2D(map,uv)*intensity,0.0,1.0);}",oQ=class extends kY{constructor({blendFunction:E=kX.SCREEN,luminanceThreshold:O=.9,luminanceSmoothing:R=.025,resolutionScale:z=.5,intensity:V=1,width:j=RX.AUTO_SIZE,height:Y=RX.AUTO_SIZE,kernelSize:ee=sQ.LARGE}={}){super("BloomEffect",aQ,{blendFunction:E,uniforms:new Map([["map",new _f(null)],["intensity",new _f(V)]])}),this.renderTarget=new Un(1,1,{minFilter:yi,magFilter:yi,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="Bloom.Target",this.renderTarget.texture.generateMipmaps=!1,this.uniforms.get("map").value=this.renderTarget.texture,this.luminancePass=new $Y({renderTarget:this.renderTarget,colorOutput:!0}),this.luminanceMaterial.threshold=O,this.luminanceMaterial.smoothingFactor=R,this.blurPass=new JY({resolutionScale:z,width:j,height:Y,kernelSize:ee});let se=this.blurPass.getResolution();se.addEventListener("change",(E=>this.setSize(se.baseWidth,se.baseHeight)))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}get resolution(){return this.blurPass.resolution}getResolution(){return this.blurPass.resolution}getBlurPass(){return this.blurPass}getLuminancePass(){return this.luminancePass}get luminanceMaterial(){return this.luminancePass.fullscreenMaterial}getLuminanceMaterial(){return this.luminancePass.fullscreenMaterial}get width(){return this.resolution.width}set width(E){this.resolution.preferredWidth=E}get height(){return this.resolution.height}set height(E){this.resolution.preferredHeight=E}get dithering(){return this.blurPass.dithering}set dithering(E){this.blurPass.dithering=E}get kernelSize(){return this.blurPass.kernelSize}set kernelSize(E){this.blurPass.kernelSize=E}get distinction(){return console.warn(this.name,"distinction was removed"),1}set distinction(E){console.warn(this.name,"distinction was removed")}get intensity(){return this.uniforms.get("intensity").value}set intensity(E){this.uniforms.get("intensity").value=E}getIntensity(){return this.intensity}setIntensity(E){this.intensity=E}getResolutionScale(){return this.resolution.scale}setResolutionScale(E){this.resolution.scale=E}update(E,O,R){let z=this.renderTarget;this.luminancePass.enabled?(this.luminancePass.render(E,O,z),this.blurPass.render(E,z,z)):this.blurPass.render(E,O,z)}setSize(E,O){let R=this.resolution;R.setBaseSize(E,O),this.renderTarget.setSize(R.width,R.height),this.luminancePass.resolution.copy(R)}initialize(E,O,R){this.blurPass.initialize(E,O,R),R!==void 0&&(this.renderTarget.texture.type=R,E.outputEncoding===Yr&&(this.renderTarget.texture.encoding=Yr))}};var lQ="uniform float brightness;uniform float contrast;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 color=inputColor.rgb+vec3(brightness-0.5);if(contrast>0.0){color/=vec3(1.0-contrast);}else{color*=vec3(1.0+contrast);}outputColor=vec4(min(color+vec3(0.5),1.0),inputColor.a);}",hQ=class extends kY{constructor({blendFunction:E=kX.NORMAL,brightness:O=0,contrast:R=0}={}){super("BrightnessContrastEffect",lQ,{blendFunction:E,uniforms:new Map([["brightness",new _f(O)],["contrast",new _f(R)]])})}get brightness(){return this.uniforms.get("brightness").value}set brightness(E){this.uniforms.get("brightness").value=E}getBrightness(E){return this.brightness}setBrightness(E){this.brightness=E}get contrast(){return this.uniforms.get("contrast").value}set contrast(E){this.uniforms.get("contrast").value=E}getContrast(E){return this.contrast}setContrast(E){this.contrast=E}},cQ="void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){outputColor=vec4(vec3(average(inputColor.rgb)),inputColor.a);}",dQ=class extends kY{constructor(E=kX.NORMAL){super("ColorAverageEffect",cQ,{blendFunction:E})}};var pQ="varying vec2 vUvR;varying vec2 vUvB;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec2 ra=texture2D(inputBuffer,vUvR).ra;vec2 ba=texture2D(inputBuffer,vUvB).ba;outputColor=vec4(ra.x,inputColor.g,ba.x,max(max(ra.y,ba.y),inputColor.a));}",fQ="uniform vec2 offset;varying vec2 vUvR;varying vec2 vUvB;void mainSupport(const in vec2 uv){vec2 shift=offset*vec2(1.0,aspect);vUvR=uv+shift;vUvB=uv-shift;}",mQ=class extends kY{constructor({blendFunction:E=kX.NORMAL,offset:O=new bn(.001,5e-4)}={}){super("ChromaticAberrationEffect",pQ,{vertexShader:fQ,blendFunction:E,attributes:zY.CONVOLUTION,uniforms:new Map([["offset",new _f(O)]])})}get offset(){return this.uniforms.get("offset").value}set offset(E){this.uniforms.get("offset").value=E}getOffset(){return this.offset}setOffset(E){this.offset=E}};var gQ="#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D nearColorBuffer;uniform mediump sampler2D farColorBuffer;\n#else\nuniform lowp sampler2D nearColorBuffer;uniform lowp sampler2D farColorBuffer;\n#endif\nuniform lowp sampler2D nearCoCBuffer;uniform float scale;void mainImage(const in vec4 inputColor,const in vec2 uv,const in float depth,out vec4 outputColor){vec4 colorNear=texture2D(nearColorBuffer,uv);vec4 colorFar=texture2D(farColorBuffer,uv);float CoCNear=texture2D(nearCoCBuffer,uv).r;CoCNear=min(CoCNear*scale,1.0);vec4 result=inputColor*(1.0-colorFar.a)+colorFar;result=mix(result,colorNear,CoCNear);outputColor=result;}",vQ=class extends kY{constructor(E,{blendFunction:O=kX.NORMAL,worldFocusDistance:R,worldFocusRange:z,focusDistance:V=0,focalLength:j=.1,focusRange:Y=j,bokehScale:ee=1,width:se=RX.AUTO_SIZE,height:he=RX.AUTO_SIZE}={}){super("DepthOfFieldEffect",gQ,{blendFunction:O,attributes:zY.DEPTH,uniforms:new Map([["nearColorBuffer",new _f(null)],["farColorBuffer",new _f(null)],["nearCoCBuffer",new _f(null)],["scale",new _f(1)]])}),this.camera=E,this.renderTarget=new Un(1,1,{minFilter:yi,magFilter:yi,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="DoF.Intermediate",this.renderTarget.texture.generateMipmaps=!1,this.renderTargetMasked=this.renderTarget.clone(),this.renderTargetMasked.texture.name="DoF.Masked.Far",this.renderTargetNear=this.renderTarget.clone(),this.renderTargetNear.texture.name="DoF.Bokeh.Near",this.uniforms.get("nearColorBuffer").value=this.renderTargetNear.texture,this.renderTargetFar=this.renderTarget.clone(),this.renderTargetFar.texture.name="DoF.Bokeh.Far",this.uniforms.get("farColorBuffer").value=this.renderTargetFar.texture,this.renderTargetCoC=this.renderTarget.clone(),this.renderTargetCoC.texture.name="DoF.CoC",this.renderTargetCoCBlurred=this.renderTargetCoC.clone(),this.renderTargetCoCBlurred.texture.name="DoF.CoC.Blurred",this.uniforms.get("nearCoCBuffer").value=this.renderTargetCoCBlurred.texture,this.cocPass=new tQ(new FW(E));let ce=this.cocMaterial;ce.focusDistance=V,ce.focusRange=Y,R!==void 0&&(ce.worldFocusDistance=R),z!==void 0&&(ce.worldFocusRange=z),this.blurPass=new JY({kernelSize:sQ.MEDIUM,width:se,height:he});let ue=this.blurPass.getResolution();ue.addEventListener("change",(E=>this.setSize(ue.getBaseWidth(),ue.getBaseHeight()))),this.maskPass=new tQ(new fq(this.renderTargetCoC.texture));let fe=this.maskPass.fullscreenMaterial;fe.maskFunction=pq.MULTIPLY,fe.colorChannel=MW.GREEN,this.bokehNearBasePass=new tQ(new IW(!1,!0)),this.bokehNearBasePass.fullscreenMaterial.cocBuffer=this.renderTargetCoCBlurred.texture,this.bokehNearFillPass=new tQ(new IW(!0,!0)),this.bokehNearFillPass.fullscreenMaterial.cocBuffer=this.renderTargetCoCBlurred.texture,this.bokehFarBasePass=new tQ(new IW(!1,!1)),this.bokehFarBasePass.fullscreenMaterial.cocBuffer=this.renderTargetCoC.texture,this.bokehFarFillPass=new tQ(new IW(!0,!1)),this.bokehFarFillPass.fullscreenMaterial.cocBuffer=this.renderTargetCoC.texture,this.target=null,this.bokehScale=ee}get cocTexture(){return this.renderTargetCoC.texture}get cocMaterial(){return this.cocPass.fullscreenMaterial}get circleOfConfusionMaterial(){return this.cocMaterial}getCircleOfConfusionMaterial(){return this.circleOfConfusionMaterial}getBlurPass(){return this.blurPass}get resolution(){return this.blurPass.getResolution()}getResolution(){return this.blurPass.getResolution()}get bokehScale(){return this.uniforms.get("scale").value}set bokehScale(E){let O=[this.bokehNearBasePass,this.bokehNearFillPass,this.bokehFarBasePass,this.bokehFarFillPass];for(let R of O)R.fullscreenMaterial.setScale(E);this.maskPass.fullscreenMaterial.setStrength(E),this.uniforms.get("scale").value=E}getBokehScale(){return this.bokehScale}setBokehScale(E){this.bokehScale=E}getTarget(){return this.target}setTarget(E){this.target=E}calculateFocusDistance(E){let O=this.camera,R=O.position.distanceTo(E);return iT(-R,O.near,O.far)}setDepthTexture(E,O=Qr){this.circleOfConfusionMaterial.depthBuffer=E,this.circleOfConfusionMaterial.depthPacking=O}update(E,O,R){let z=this.renderTarget,V=this.renderTargetCoC,j=this.renderTargetCoCBlurred,Y=this.renderTargetMasked;if(this.target!==null){let E=this.calculateFocusDistance(this.target);this.circleOfConfusionMaterial.focusDistance=E}this.cocPass.render(E,null,V),this.blurPass.render(E,V,j),this.maskPass.render(E,O,Y),this.bokehFarBasePass.render(E,Y,z),this.bokehFarFillPass.render(E,z,this.renderTargetFar),this.bokehNearBasePass.render(E,O,z),this.bokehNearFillPass.render(E,z,this.renderTargetNear)}setSize(E,O){let R=this.resolution;R.setBaseSize(E,O);let z=R.width,V=R.height,j=[this.cocPass,this.blurPass,this.maskPass,this.bokehNearBasePass,this.bokehNearFillPass,this.bokehFarBasePass,this.bokehFarFillPass];j.push(this.renderTargetCoC,this.renderTargetMasked),j.forEach((R=>R.setSize(E,O))),j=[this.renderTarget,this.renderTargetNear,this.renderTargetFar,this.renderTargetCoCBlurred],j.forEach((E=>E.setSize(z,V))),[this.bokehNearBasePass,this.bokehNearFillPass,this.bokehFarBasePass,this.bokehFarFillPass].forEach((E=>E.fullscreenMaterial.setSize(z,V)))}initialize(E,O,R){[this.cocPass,this.maskPass,this.bokehNearBasePass,this.bokehNearFillPass,this.bokehFarBasePass,this.bokehFarFillPass].forEach((z=>z.initialize(E,O,R))),this.blurPass.initialize(E,O,wi),R!==void 0&&(this.renderTarget.texture.type=R,this.renderTargetNear.texture.type=R,this.renderTargetFar.texture.type=R,this.renderTargetMasked.texture.type=R,E.outputEncoding===Yr&&(this.renderTarget.texture.encoding=Yr,this.renderTargetNear.texture.encoding=Yr,this.renderTargetFar.texture.encoding=Yr,this.renderTargetMasked.texture.encoding=Yr))}};new Wn,new Es;var yQ="uniform vec3 hue;uniform float saturation;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 color=vec3(dot(inputColor.rgb,hue.xyz),dot(inputColor.rgb,hue.zxy),dot(inputColor.rgb,hue.yzx));float average=(color.r+color.g+color.b)/3.0;vec3 diff=average-color;if(saturation>0.0){color+=diff*(1.0-1.0/(1.001-saturation));}else{color+=diff*-saturation;}outputColor=vec4(min(color,1.0),inputColor.a);}",xQ=class extends kY{constructor({blendFunction:E=kX.NORMAL,hue:O=0,saturation:R=0}={}){super("HueSaturationEffect",yQ,{blendFunction:E,uniforms:new Map([["hue",new _f(new Wn)],["saturation",new _f(R)]])}),this.hue=O}get saturation(){return this.uniforms.get("saturation").value}set saturation(E){this.uniforms.get("saturation").value=E}getSaturation(){return this.saturation}setSaturation(E){this.saturation=E}get hue(){let E=this.uniforms.get("hue").value;return Math.acos((E.x*3-1)/2)}set hue(E){let O=Math.sin(E),R=Math.cos(E);this.uniforms.get("hue").value.set((2*R+1)/3,(-Math.sqrt(3)*O-R+1)/3,(Math.sqrt(3)*O-R+1)/3)}getHue(){return this.hue}setHue(E){this.hue=E}};new On;var bQ="void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 noise=vec3(rand(uv*time));\n#ifdef PREMULTIPLY\noutputColor=vec4(min(inputColor.rgb*noise,vec3(1.0)),inputColor.a);\n#else\noutputColor=vec4(noise,inputColor.a);\n#endif\n}",wQ=class extends kY{constructor({blendFunction:E=kX.SCREEN,premultiply:O=!1}={}){super("NoiseEffect",bQ,{blendFunction:E}),this.premultiply=O}get premultiply(){return this.defines.has("PREMULTIPLY")}set premultiply(E){this.premultiply!==E&&(E?this.defines.set("PREMULTIPLY","1"):this.defines.delete("PREMULTIPLY"),this.setChanged())}isPremultiplied(){return this.premultiply}setPremultiplied(E){this.premultiply=E}};var SQ="uniform bool active;uniform vec2 d;void mainUv(inout vec2 uv){if(active){uv=vec2(d.x*(floor(uv.x/d.x)+0.5),d.y*(floor(uv.y/d.y)+0.5));}}",_Q=class extends kY{constructor(E=30){super("PixelationEffect",SQ,{uniforms:new Map([["active",new _f(!1)],["d",new _f(new bn)]])}),this.resolution=new bn,this.d=0,this.granularity=E}get granularity(){return this.d}set granularity(E){let O=Math.floor(E);O%2>0&&(O+=1),this.d=O,this.uniforms.get("active").value=O>0,this.setSize(this.resolution.width,this.resolution.height)}getGranularity(){return this.granularity}setGranularity(E){this.granularity=E}setSize(E,O){this.resolution.set(E,O),this.uniforms.get("d").value.setScalar(this.d).divide(this.resolution)}};Math.PI,new Wn,new Wn;var AQ="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAAQCAYAAACm53kpAAAAeElEQVRYR+2XSwqAMAxEJ168ePEqwRSKhIIiuHjJqiU0gWE+1CQdApcVAMUAuARaMGCX1MIL/Ow13++9lW2s3mW9MWvsnWc/2fvGygwPAN4E8QzAA4CXAB6AHjG4JTHYI1ey3pcx6FHnEfhLDOIBKAmUBK6/ANUDTlROXAHd9EC1AAAAAElFTkSuQmCC",MQ="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAKAAAAIwCAYAAAABNmBHAAAgAElEQVR4Xuy9CbhlV1ktOvbpq09DkiIkUBI6kxASIH0DlAQiIK1wRfSJTx+i4JX7vKIigs8HXpXvqVcvrcC9agQ7IDTSSWgqCQQliDRBJKkkhDSkqVPNqVOnP+8b//rH3P+eZ+199tlznVTlvVrft7+1T7OaueZY42/m37QALKNk2wHg1pITlB17mC+Pp11W3X/LHyT32vhg48/5SOv+PnwpsHA70JoGlueB1iKApeqzvOzn44GatTB76Xzhd7suBR7+WWADgDEAwwCG/L54b/poDLrHuvvm70Z2Avhsc+PVcxscBU8F8C8ADg5+ipIjD/PlGwfgju8B924E5seARUfLsiNmqQW0IjL8+7L2NYD/7COBzfcCm+aB8SVgdAkYIRCXKyDax4EdAanL5PuNPllNvXDlAHwFgP8AcC2AhRIoDXbsYb48dl5WkVFTE3LGDcC9m4CZCWBuFFgeAZaGAYJQQCRqDHT+McJrVb8zwATUXH02MHYfMHEIGFsAxgjApQqACYQORjtd/B7Axt/z79sC0+cMPgjjlwPwVwHcA+DfAHzTxcVgWBroqMN8+cYBeM71wH0TwKExYHYUWCIAHYRLTlkCYgcIBcAgU/n3qy8GRu4HRgnAOWBkERhddPAJhGJDBxkvw7cqimr+zFM/ZLnZF64cgL8BYD+AWwB8x/dlWuWagHiYL984AJ/0RWBy1AE4AizyM1yxYAcTigW55xMbAkxEiwEdkJ/ZCQxPAiOHgBECcKEC4TBZcKkSv+mTieNcNPNC26mLNsj45QD8LQDTAO4GcJt/7iw2bfoG4WG+vAGwm9ExiEg69zpg/wgwPQLMjgALzn4E4aIzoJjQ9g4024uygkj+pyuAoX0VAIfngOH5NgCHMhAm8Sv2y3XDZeBhNIp8OzJE8OsBzAKYBHAXgDt8/4O+MVT0j4f58o0D8Pxrgf3DwMwIMEPQEYRkNwfgsuuDZLskip0No0gWMD/9HGDoADAkAC4Aw/wsAgZAgs2Z0ABI0GU6IVmKv+f28KDnHxkA/G0A8y6G73N9kOCjXnh/Ebb6OvgwX75xAF5wLTA1VIHPADgMLDj4yIA5AAm6aCUnv4oz46eeDwxNAUMzwJAz4BABSNDFTwSfg7DDKHE23MG5PqIY8A1u/dINs9dBdy8AgnGPM2NfUBrsnw7z5RsH4IXXAAcJviFgluAbygBINnSLWOAjGxJ4pgOKDV0v/OSLKp8iGXBovhLBBOCQM2ACoTOhnYrAdItYbCij5JFzRyIAqRccAnDAQUjg6UNQ7hsMXP0cRQAexss3DsCLCECCLwCQzMcPwUi2MwAScAKbfnY/YRLFQ8DHX+IAJAMSfDkAF13kLvleIjhjQQHxUVS3jjgGpKeeNzYVQEjgUS8k+PghONdhIwAP4+XXBYCHKIJbwJyDTgaIAdCBJx3Q2M8tYAHP9m4df/ylQOsQ0JqtRLCx30K1wtLBggScQOgsKBGcWHAJeOwRC0BSM1mQIKRbhh+Bj98JQP6t4U0APEyXXxcAEnxkQAFwoVUxID9kvQg+c1C7vidRbIDkc24B//hTQGumDcCWA5DgMxASdNIFBUI5pCML8v8API5zfEQx4BudgqiczviSnJhQwCP4BMCGl+wO8+U7AJi/W4O4YS6+pmK/2ciADsAOBhTIIiAJnPB7AvNjP+0AnANaYkAHX2JBAc+tYaJXOqBZv24Vc386XW5dtkHGW+4HFAJonpOe+YYQZAShgKjv3PNvPQaxVoI8zJdfFwASfPzMUwS3Kt1v0UFIlos6oDFdAGFcliMAP/ryAEAGNwQRnDOgLbdlIEwrIs6AZ/QgkMMHQF6ZAKQcJAsSYPwIeAIk9wJgoPK1gi7+PwF4GC/fOAAvIQPSs0URTPBJ/Pp3GSEGRHfBCIQ0xowBtUbcAj7ys5X4Jfu1HIAGQrIgQRXEsAFQIORDFhiDY/rMHmrU4QUgR08AkgUjCAW6CD6CkwBsAIQC4GG6fPMA3OXiNzCg2I9gNCMksmAAoemDzoimFwL48M85AKkiuQVMAAp8CYRRDAt8GQiJ67N6GJODAXAHlsGguscA2AJg1IPGYmxOpBxFWkRN9LsATgIwXnNs/v/5z/9XCf8BO3YAtxbc/46/KDt+5+ea1Yku2VUxHz/z0v24FwMGK1gWsK2OUUxHHdCBeRUB6OxHABr4ZICIBd0QWSF+XRdMTAjgCdTrG9cBNwE4F8CpDkICyYLGsuhFt6zs+gISwUen8zEAjgMw4cfx2H6O/90yAFo84Cbg4ID3/9TfLTt+5+ebnRABkODjx0SwPi5ec/FrYpmqSAxM8Dn60CsqAFI6GfhqAMiDE/gokmvEr0C4PgDkBQm40wE8zMFEUDKEVoxIMLl/KS73mE7H9d+vcKHQQcjwW0Yu9nP8m8sAmOIBuWY6wP2/4s0ezjjg8TuvaR6ABJ70vxUApGrm7EbGE+i472BAB+WHfqHS/eoAaEwY2E9+wLSXTqhI7CXgnB6LCoOJ4BiST+hTnG0HcCwAglCx3ARoZEVFXnBPp/O/A/hXACc7CPs9/i1lAOyIB+RDX+P9/+pbQjjjAMfv/PL6AFDs1wFAgs/9fgKfgdE/ZEpuiQlbwAde6QAMBgiRmsSwA9BY0JfjovGRDBMH4TlcXGhcBOc6HkF0gjPhZgchxTLZMAci/04W/B6Ab3t09EPXcPyflgFwRTwgJ2MN9/8bf5qFM67x+B/aW4XQz42FeL0YrRyikztUFw0704mf9kXgxhOAqc3AAsPyRxxQCs/PdXOFY0W1KHy3QIUGtx+6vdnx1vsB+dsTncm2AogglFgVEAlUWrOMB2RyEmMCGQ/Y7/HvKns6tfGAnJQ+r/9b76oJZ1zD8WdyQjYBh8aBhVEHjELouQ8ukQ7VRSCJAALwkr+sALhnGzDD3JAJYJHg9uhoi4bx8ytkWUtvHT/7+Zc4dw1uZ3612fH2dkQf7yxIEEockwkJQn4IQoq8unhAhmPRKKFx0uv4K8ueTs94wD7u//VX9ghn7OP4c+4G7h8HpseB+dF2AKlFLwuAIZ8jD6NPrOhAffmfA9/ZBuzZCkyRWSeqBCWyoYGQ5yQrBpDbum/ME1HoPo0XEkSD2zlfbna8q6+EUJcTCxKEtHL5EQjP6BEPyIgYAZBvYt3xHyx7OqvGA65y/7/9wVXCGVc5/sl7qxD66dEqiYgRzAqhN1A4CBNAAlDyAFI+iZ9/N3DLJuC+jcDUBmCWyUnOrmTYCMIOkNclLg0B8/RsNLg9+UvNjnd1APLmmQpFHyEBROuWACQT8nN+H/GAvY7/VNnT6SsesMf13/CpahGnZzhjj+PPmwX2MYdDIfQexWyBAwEUOQDrRDN/98p3A7dvAO6fAA5sqHJDBEAyoUVGkwEd6HR12XU4kwzfl6fCXTZzjy57vvnR513X7Hj7AyDvggAUi9EyFgiZqNxPQF6345nOWbD1HQ/Y5fpvuLa/2+82/vNHgAPDFQDnhoF5j2C2qBWCI8bw1eRw5CL5l94L3DEOTI4DB8Y9OWmsEu/zBJ3rgsaybqBob/7A4C7jtWcooRrczr+u2fH2D0AOQgAUCxKEP7aGgLy64+m6KdjWFA9Yc/03/Osa4glrjr+AupqHz1sEs0cxG0BC9HIePLoit9eNkVf9L+DuUWByDJgaq4ybGYLPAWgiXmLedUE7dwC7saL7CqfPKXi4NYdaykCD410bAHlDEsNiwZ9wAPYbkJcfz6T2gm3N8YDZ9d/wHxUA+739fPwXPrSKYGb+BuP3jAFDElFH9HIWwbzCIGkBr/or4J4RYO8oMOW6ZVcAuvi1Cgoha04BCwT5gfMKHm7NoRde2+x41w5A3hQZkADk5+cGiAeMx3+/7AENFA8Yrv/G71cAXFM4Yzj+otOAaQLQA0gZxaIIZtMDFTigKJV8H9Iq6aZ59ZXAvSPAvpEKgBTtBODcSCWCZeRYtpzrmLyeGNCAyFl1v+Hei8qeb370Rdc2O97BAMi7EgB/2QG41nhAHU9LuWAbOB7Qr//GPRUA13r7Gv9FZwIMoVcEswEwfDoimEP0shKKtIphaZQAXv1+YM+wA3DEdcvRKkGJADQQEsQuhi1Tjt95vBsh5nx2IO59SsHDrTmUOStNjndwAAqEry0IyCMICkOyiuIBNwBvPFQQT7gBuPjc9oRYAIHyOEL4vIFEYVNaOou5vCGE/tV/A0wOVcnpzI47NOri3QFIBpSeaSDUdYLOSWvYImSGgftpJDa4MWJbAGxivGUA5MAOc0Be6eVLj7/4Mk+hzCOYPYpZDBiNkLh+G/M3yFyv/ltgL3W3YQfgcFUhgRY2PwY+Z7/EhAR1SFyXCOb57r28QfQBsJQBMn5D4y0HYLPje9Cd7RIC0PM3EiMofF4gVCBp1P840ix/gyz56r+vAMjk9Gl375iB4+CzveuZdLkkEPJ8ZEfX/6R73vOjzT5Si9hucLxHAVg4PwJgRwh9CKOXK8YA4ZEqKZXSQWh5P+5AftXfA/uGKvYjCKn72cctbFrZNECka5L5CPwIPtMH3TVz17MLB5gdLgA2Nd6jACycHwLQxFEUSR5ASvARDB0h9AQb9bXIgCGk6lUfAPYTgEPAITKgg1BObk58srTJgG58WMkWMaAbQQT1nc8rHGANAJsc71EAFs4PAagQestgC1lsBJ4BMCSOK6dDUcwqqaFiQr/0QeAAAdjy+jBiQQeeMSBZT3nCPUDIa9z+/MIB1gCwyfEeBWDh/BCAeQSzgkjFfGLBBD5nxQ4DxN0wv3hVxX5TBGDwL5obxvVA5YqYL5BeMLd66YYxJpRB0gK+96LCAdYAsMnxHgVg4fwIgMrhUPKQ2C+Bz0PmBTqBMQehAbDlIjj4F80KJguSVZ0FuXpjoCOgXawLjALhbT9eOMAuAGxqvEcBWDg/l1IE05Ed0ygZnyHdz0VwCqEPIfNyx0QQvvLDFQCp+8nfZk5und8tXwIgWcHSNX0N2CJmnAl3v6RwgNnhl17T7HiPArBwfghAS7mV/hey2JS9FvM3BLpUUi1YwDRMXvkRYJoAlAh2l0dcZ04s6JUTDIjyBcrl4yDc/dLCAdYAsMnxHgVg4fxwKVwJgGEJNmWtxpQMpX9on2eRhVA+O56AjMfnP+e3Xvf3NwG4xIPTleiY55bpGh6UbafNU0l0z0p+5Jh5HqYJ6b51nP6XP8cx12XNHQVgIQB/bFPVg2OC7Q+WgVFWng/FvtWLI06uWh5oguKEcXVS/9sEAF//VGD7t4ETDgJbF4CNi8CGZWBs2fPL/H6Vwp2KEtVk4fJ+v/EIYPN9wKa5qu+IncfPwXHVZe/aOL3EbwS7xv8A1rQvnO0j8PArTgTGZ4BxFv9mIxhOCGsv+0OPYDRghcLfkWkEuq0+G00x4OtfDGz+d2DbHmDLjL8si8AYP/7CGIAiEEMTG92zXqSbH+d9R2aA0XnvO+JjthiIrOVDHHPOkBrzUQAWAPsZp3oPDpa/Xag6EVkLBK+5rAnJC3/nYk/APD704WiEAV8OTHwX2LQH2DgFbJgFNrBhjd8r79deGoEwsllgNBOzy8CdjweG9wBj08AIAci2D6HafmyAk4/Z7SJ72hGYRwFYAMDLTwOGp4FRFgD3HhzqRGQiyeurqOdG6r0Rm8IEZjzRlkiqCWoEgK8Axm4BJu4HJhyAbFhDxmbDGnZO4j0SgLGDkpibgEq66TJw/1nA0F5gdLpq+zDqFfd5LMeWqu5HNST0uJOIllg+qgMWgI+HPv0xwLA3gWHpW2sC441gCECbmKziaGrnUdMO4aHeh6MxAP4SMHI7ML4HGD8AjHvHJGNAgpDgY/ck3stipRemvVhc+uASMPUEYGh/9dIRgGx8Y+MNbR/00uVtH0wEx94j/v0oAxaA8Ed+GBieAYZZg5kADC0QWGOFzGJlcGPzl1BxNLXD8sk4xftwNAbA/wwM3wGMUmxOOQBnHXzetIYvibonmSiuYTNjriVg7glAiwBk0fNZH6+PmX9P6kfNmCXGpftJ7TgKwBIAnln14BAAYxMYm5C6RjCyCoOyr0qkD/c+HI0B8DXA8N3AyCQwesD1VQKH7EcASm1Q+y4CkN9pUKiVF5nLvy+fBbTUd8QBaH1HvNBROiZvfsNnrF4kcvPwpdsBLBeU18Nf7AB23Dp4ecHC8oBgUlJJecLS+7+WOpE3gbE+HKw+yoevCYkMGKqPJrdEKARutaFYRs1fiEZ0wP8CDN8LDO8FRqYq3W10pgKgfYLaYCzootgA6KXaTA90y374TKB1sBozy77xHFZ536utRgAmEaw6g5kUSFZwSXnA330qsOlfgHMPDlZesLA8IOjoLypPWHj/11EnCiVwkz7kAExtsGraYUWdSDX5TmsagL8KDBGA7Bd30JsW0oWivnEOQNP7yGTSBR101AlZSUtGyfgZDkCWY1HnJdcBVe6325hTvelg2CQjZNDygG/2An0j1wKnL6y9vGBheUC8prQ8YeH9X39OVQSc7Mc6fCaKvAeHdCIVf4yMYCynTpX+nb97NJmlSQb8r8DQHm9YOFUZTKOzoXGhs6AxF0HIexcLBvWBuiHN8s2ne98R3qc6L4Vyb2oBVjfm9MIFHbjDCh6kPOBbQoG+oW8CO5bWVl6wsDwgfr20PGHh/X/1iaEIuDcCTIW/1Q4rFv8OnYiW3c+W2iKwUjKbyjQNwL1uuR6sAEgDgq1brXOmV81PxhNB6DUDBSYzQJwFtz623XcktX1Q1VWKaTF/zZhVazBVYA1tX5MazsGvobwe/jQr0Ne6BTh5uf/ygoXlAfG60vKEhff/rSe1i4DnTWDUACY1guFTDqLYdCBvf6DJYSMYATBfOx1kLfj1v1axH10nQ3Sd0GUkBnTfpemtBJgseIKQAHLQcVxa2TnuMW0Aqui5es8xBIegVdVVE8VhzHnLh65WMB9An+X18K6aAn2tO4ETl6vqbKuVFywsDwhevqg8YeH93/Rk70JE90nowxZbIJjvS3WYNSGUwGHJTpPxwwcbBuBrgRYBeKACn7VtpdUu/c0NJxO9BIxcKu4TTODzbkonPLoaL0vyUQRb2y8HsL1ckfWzMeuFi40Qezqi+yiPhyt7FOjr6/gCFwgP7Xb5vssTFt7/nQRg6MGRWmDRoeyTlpgw68GRTwgZgo1gGmXAX6/8dtaylSKY/koyID9BhzML3q1gAos2AcOrZYSoq/pJp1VtODRm9Z3LS/7WjVkvXOzEtOpKyGrlAT+4SoG+VY8vBGCvy/dVnrDw/vee65NBJiAjBIVcAJQjOm+DkCZEeiGAMw6sAwDZsJrAdhFM9rPGhd4904Co5oVuCZPV6kD40Ec6+9W8dBTBsfdc3nkpvnB82fp2RPcs79dHgb51LA9ofsDV6vut5/3PnxcAmLVBiDqgevDaJLkYrpuQxzcNwN8AWgIgRbB8loEBzXDwl4cGiDGft58SCOWGedgjvOJ+bPvgRkiuA+ZjzhnQQOiFNVbloa7l/fos0LdO5QENgEXlCfs8Qbf7HyMA3QVjYihYhLENgjX9y/qwxQmRU/asfd0ZcLU2CHVGyusJQLKfVi98CS12T5f7iECkHpsMkAhCF8+nshWH2I/jXsOYO144GV/9ApAIrS3vt4YCfetQHtAA2G+/4PW4/2PPbzMgmUMi2NoeSCRxIt2/FvuxWURIWCXg357gfTjEDNIHnTRXRCpH5ugKwGl3HpMBXQc0v6WLYVm/5limj04rG762K2uYY9jBkr9+rI03NL5ZbczS/dJ+LQyoga4o77fGAn0NlwdMAOy3vl/T938KAcj121z8Bn+Y9eWQJRz8Y6kNagDh2ey5EvxjxQD8TWdAuneCCO4An1vw5vdzQMmdktwq7pLZQR+dM34+ZumAxvY1Y04uqOAJ6FsExzeto7zfAAX6GiwPaLWR1lrfr8n7f/Rl3QGzmsis+/uO71V9OFgP2gpPhgr7TGRqRUT6dyvr4aIs/pm/2zVUNbBSv6G8e5pEv0Cvec7Po7+bTtjlBRlkvAMBkDeQyvsNWKCvofKACYBrre/X1P0/oWEAnnFD1YdjhtXxR73mX10FfCHHE9pVWcGAI/S0gKsfA2y+twrFZw6Hxf/F0Pk8Ri/kpGSnMuDx5T0iACgQHioo0NdAecBUHW6QdsV2/cL7v/Cyqr5gnc42CCOcfX1VIZ/V8We9IDmTzVXwPDJiXuKXPxtDBma8+lzP4WAgKkPxCUAPE4v5GzEuMX0PYJPLhB6FJsc7MAMmkVxaYC/K9gG+F1++8AQ7Gwbgk78I7GFpXgIwFiRXOwaJZPUbiR0yCUDRk+cHf+YpwMj9HgfI8ClGPyvsSiH0WSKRuYlitLb/zHM/JOSs5C/YIC9cMQDZr/dwxgOW9gtGYUBi0wA8l304vDQvAchilFbpIBQhZ7Ejq6ZQ0/Yhil8y4j89Axie9DAsD6FX9HOK3QtROTFkviN83kG4felIY8DCeLrSeMDSfsEovAECUFsTjHD+tcB+tkFgcXKvBRir7qtFl9owmO4Xy/1G3bAFfPrZHorFNWBFwHjQAFctIghj2kBarw06If/+MM9ZqTN6DgsDojCerjQesLRfMApvoGkAWh8Ob/tgAPSKWCp8ngNQtadjmTdltvNvn3peFYhgQQgh+iUmEaUAUoXM1yRLmWuFLaE9Z+XIAWBhPF1pPGBpv2AU3kDTALzwmqo6qtVh9kJErAudABia38TC5wJgS2xIhAwBn3yhByL4EhzXfRXxYsDTJ4IvrNN2JFMxZcBzVo4cABbG05XGA5b2C0bhDTQNQLZBYH1AVsQSAAU+imI1obHyblnjG/kJk3U8BHz8xVUQAhnQIl5CyNgKAGp5LKSSCoAySh5Jj79vTagcxUaIBeRNe79g9gq+DXig4wGzy+PONfT7RWFA4noAkGXZVAhcBckJQgNgrLiaNb3paIDo1vHHX+oA9LQBi4DxJcOUPJUnTgU2NJUyROs8irGARxQAC+PpCtsFd40H/AEf0gMQkLgeACT41PiGoLOKqyrJq3K/Ya9mNyr5FusN/uPLPIeDa8Bc+w3rtyl4VFHaMZc3i9RWBM9jjzgAFsbTFbYLRmm/YBTeQNMAtD4cBKDXBTQGdAB2MGBo8SCLmEuS1AFVAJ3A/NhPt0PoCcA8bSDG76XI7aySg6JYuGfKwJHFgH0E5B3ueMCe/Y4L+xVHAOZ+9EHcEgQgwbeiEYx6jwTdz4qfu7EhEJqxGqruf/RnHIAEnxgwBM0aC8aUAYWNBRCmoIll4HTqO122QcZbrgMWxtMVtgvuOx6wa7/jwhtoGoDWh4MBJ16WN4lfr8AqI0TVV1O1fa9BbQzovkAy4Ed+NgCQUSxZCFWvCOaOFREXyUwZOPIA2GdA3uGOB6wPaOz+QPv5S+MA3OXiN9aclghW+d3IgupBF2pPqxcxGenDPxfSRh2ASiKKiVP2PaZScvAKoA0VDc6cOlIB2GdA3uGOB1zR77iwX/F6AFB9ONSOQW0frA50sILVcckWJyIDSgwPAVcJgFbYuZ3FJvAlEHbJ3IsgJLGedeBIA+AAAXmHOx6wo99xYb/i9QKg2iAIfDJEJHqj4SExbEty0gkdhB/6P9oZbBZIGiKYVb9GKaN50lRHBLOvhDxh/5EKwDUG5B3ueMB2QGM/grb7/6wHAPNGMAY+GSGUjC52VX2f2CD4+HO0gqkZfegXKgBaHkcWtS0AWii9xG1ImrLlN5XR8L8fmQD05BVrmEENmpYSP9QX+KHiqj2/82+HqqDWwnbBRfGATdzAegGwru2DpRq7Mzq2fpAf0Nq0Rl2wBXzglZ4yUAPAmDSVWDBPHQjLcgTqOZ6zUvdKHh4ruDCerox/Dnu7YqwXAC1NI/QcEQuK6WK/kdgCTGC0PYAP/KIDMBgglq+hIkrOfsaCviLSofcJgJ5AdM7kkSaCj/HqQKVIGvD4swF8bcBjmzjsaQ2H5D/6acBd9wALB4DFWWB5AVherMp4GKIYEOp7+26UF0aSfT/xYuDG7wDjrIpAERytXf2vajj7ueryQXSFl10K/ON3gIWDwCLvjfGB8Z54O+Ee4ve6513uB2R1yzsqC+twbC8HcNVhfAeaBuDP/TvwtS3A/ePAIfYFVlPq2HHTuyulZCTlhbjhETF5yxTQGgPGhoHhIWC4VSXGD3n0tLkMHXHxu+YyB+MlPwDuZs5K6FlsbCzdVO9DuKfkHM8AEkP7B8fOkwDcD+B7np42+JkGOvKdAL4E4K8P0zvQdET0b14D3DgB3D0B7B8HZka9WzrD88N6sFm+YcUjrn7E1ZDvMtF9DBgeAYaHgSGB0PNHCD4BLwLRsByAyX/ij0/dDUxuqlIG5hix7eFhvLcOVUAtyPSydAFmOQNe6EYGV/9ZESiKgIEgtbaD/gHALQC4ovY5r5KwtjOU/XfTAHzzLuCmIeDuMWDvKHBwpMoN0WQzNtAaYSs0K4ZlOSAjGG9kPjCBRwZ0ABKEBJexYAZEAU3A7Oi1BeDym4EDnjQ1TwCGWMW8MXcKks0YOyZNlQOQjcgYIUHllEzYQ0ktm+r6oz8G4F4AXwXwRd8/kO9A0wB8y65KmPxgGJgcqYJTKYpTv2CCzyddQJRDOjKivn+Deh8BF8BnwBtaCUA+YYEyAU8h+c6Az9gNHHRmrgOgmDA3jHQ+iWupCeUAvNSrA9HNwqx+muk9nJVNg/CTfrmbAPwbgK8D+PcHkIibjob5o13A3XypWsAkG1cPA9PDFQDZM1id0i1KxsWfOrKnAFXlifCFFMMRcASigOcs2MGAIfE9iWXplS6On7UbmPaUUTXQrgsVMzcRj5Folg2V5ayUA5BWYKwOxKUafnosWjcJwk+7W5F2EKvlE3xcXaNYfiCYsGkA/smuqug6hcleAnAImPbO6YwRpMgjCAVAm/yQmKTv5hNsAf/i7SyNBSl2a8Qv/4/M1yF+BZSYlNQCnnVrpbC+mToAACAASURBVJcaI7sOSEY2NpaDXLqpR+vE/OVksDgImgGgghHoYJbTWc7oJtFWc65/cg2AYvh2ALsB3AzgVv95nS/f4QdsIkT9T3cBrGtITWZfC5hqtQHInsEGQn3UDDvEDEY/ICf7SxMOrAg8T+c00JGkvHGd2DABUYZIAONzCUDppCFhSukCBsLQrFtZe/IixYQpSyEoJoqnuPWrVRAubQh83HNlZB23z7j1ywmj6CIIqUPxw2Xeu9bx2jx10wz4Z7sqTYZaDD8EIDuoE3hMVEphWg66JIp90k0sBxBcy+iPIIaT1RtEsHS/yIAqw+VSNPWQfe5tlVEk8auXgVa5BUsEJuT5uoliAbE5AGotmIAjCPnR9xDG3TQernYAUupTdBGEFMf83OkApHG+XlvTAPwfuyrgSZOhas3u6cwTsUBVn2gTwyFMi8wjHZAA1M9fYGHDULJD1m8Cpa8fRxDad+l+Ykf/3XNvd11U+qiL39SxXevSsshdDFvgbI1O2AwAtRZMZzTBRuDFjxe1Xg8QEIB8yyj5yYIUxfQIkfkIRnmHCM712JoG4FsdgHHp3ACoMH2G6jM4lWzoQarSvwQ6MSB/vporVaFkh+mCLlpVR8Z+dqDZLoDOpHSiQeAFDkBjPrlgCHgCUaFifg67H/9uYjn4Ai1vpTERTAASBaoQJBAKeNqHlL6mwPDZYAOROag/EYRkPX34MwHIvzW9rQcA+TLpI22G7EcQKlJGsYIJhC6ClUMiXfBTbFUQAej6nPS/OuAl9pOOqIc2BLzg++3VmWgIEUz82cRuCAtLIHQQm0gO52uOAb22sC3JEWgRfPpZf2sQBQIgLydPEIFGwPEj8MlF2bSbsulghLftqsCXq9HGgHysznrGgi5qzTUTFH8FLhAUn3hIJwCN0HLncw37qaF2zoYvuKNivmQIuUNc7GvWt6sHNs26twA6vhyq8NEMAHlyntFrDCcQehyaPTl+FwAbXDcmAKMRThakEk8Q8kPg8SPL0qzLBl+A9QCgR6uZGs3vfHz8TtBZvkgGQrEPBVAUg2Sij50QAOjiVKI3saADJRm7dSLYWfSFDkCem/dhZeMy9pPY5QvSDYQyUJoDIK8qMezh3wY6fSL49PcGgCAA8pScJLIgAUYQEmz8RPA17StvGoBv39W24eREiBoNQSgWNI1HBkdgxJSw1AI+dFIbgOYmkjimQ1r6XXC3rAbCHycAgytohf8vsB/r2KRaRq7zpZ+D37HMX0s3DDcCUGLYaw53MJ4YUODzusqlGCQAOQCejuxA8UULUkxIwAmMAp8Wa3qkN/R9W+sBwOhIEPjk5SLr8HeKFbTQfb77csPIMHGl/4MPbReslPhNe4+MiTpi9AFGV4nI7MfvagNQLh/pfrYnDAS8aJQ42A2w4em2cAyWQUuJVQTGWLs1uL7DG9J1RjhA+jvYk4t3KXeMqijpzrud4At9z3XtP16yGfjKZmCGooYh1tZzvv8xXPFl4PoJYC97k9FlwZWD+Azi/deMZWeP13eQCGEyoERudChIjbb3mJYwH7V0QIKuCwj/gfMj0asn2I0FXRSHXfL/iRkNgLyeVj8ccMY//J1fyxzTAXT2+xoQViKYD/1hDqLxPiYxTgSvQrphphG97tz4Slqafnj7uk1kIQDZrvWTw8B3jwEW+RLxPgSiCERdPwPR7+wCPg/gulFgfruDkOMQkFc5x84e708JAMmCuRNBXi4TIg5CGRzGiBGE/D4E/C2r2vcAYJoify62i0aJSMhB+2IHoNwu0fkcjQ85pu3ack5nIBREqneYFyWLkAXIJHESe00Cyx5QyeL6F/tyEcDcrOW2n7fX8df0mME+/vQ/PQjhoy3gzo3AISYf80MQaQx1peH9wb7v2mrtmCBkIMMejp3jIJD1MsaxaMZ8v5N/67INAsB3BAYU4JL4DSo1J15AFPAEwuQHZJzkKfUAtOHLJSOQRWndBYQvCQA01cfnNopfsaCJaD2baBn79QjSTiOEP1EcawIpkq2kegBTNgHWEpOKF8Uwq2NRFPM4AqCf46/rA2U9/uVDvurB01zvAJpiiwOl3fEeciCGF+Ij11f+QkbSfMPfIzqw57mEFZ9Dl3Ps5HXWAYByHJAJKV7N+s0cCQQhwSlfm4lGZ0KB8C/rABgZUS6ZHITBSEhCowUYAAksF7cStWREyxRwtuPpOlgw+5s9sq6OaIJIIlUgEhA1edoTgHxa9HVw5jibZNF+j/9yGQA/7pbujZ4bwv2+cWB6tFo0NzYnkxFA+cvEAo43VBoEo2e+48EMXEOmD9F6xhCE8RwZEJ80VblKvDlmzwicfqy93/o+8K8TwB2jVSgW138FrJQTXBNlnJgmrjZwanow9CBP/rL9wF0jwAGWDtFyoN9PHutnIHT05mPXz93dMGQAPniJsjiBXiTbxDZFMF9NLUPQxKR5qezz1Y6/YZDH0D6GkdAkYJIvRalAdHAMmPZoYhb6NhDWvEyf/ma737CXN7R1ZC7hUbPgcFgqt/ZZjADnM1xqEVhYBpb4CUk5UsL7jQvj///5buDrLeCOEeD+YQchYwG9VIfyg1NaZszFiCH6DkRGLze5/dgk8IMWcMCjdCiCzR8od1B8OTwvJM8JEShFut1fzMhi+eRJr6LI7hYP2M/xVLwKNoZjUTwRMAQQmYyhWGQxsSADOflZ4kukj7PhZ75bETjBpkAGahMkcrGgwhsXeCyBHBj1wmOBQwvAwqKzoFeRV8ZaerjKYAuirmPY/o9X7q5Cyr7fAvYMAftCPGAEoYlBiVtFwLjtp2U4irj7yOANbi+crHyrfCbTquJV44O0F1FrwQGIMZFqdQDyP/gGSZ8TC0ZRRsOlVzzgasd/u+zpMByLehAfCgMQCDyGZJHFCCgLZ2f8mgI5qauEcVx9e5vACTgCTwEMWr5TdIpWKJb5MvrnoocDswvAPAG4VLGg6UKeqmi4iuDz4er30oX0FP7u5moMvIf7W8B+jwlUNAzFnlZCIhvGFRCeWzrgXSSIBreXTFZSgVLHAp4UHOFuociEEsn2PJwl/XEk0dzfSojeerFg1IOo5BKAveIBex1P67lgUzgWQaJwLAKRH04i14ItgDKEtGsRnWx49b2Vkk9wUefTGrKCF7R0JxZMqxN8cmPAxWcAcxGABKEAKPA5u9lEaAbCmKMI+sDN1X3z+ro24wEZFc0VEE64ABgT180PF9ZdBcDb6JpqcPtPk+1ACbmKjJnllwyuILunEAWjZHkBsrsRUnfD0qEiC5IJfyisgMhzWhcP2O14Ro4WbASgAMQJ48SJwchmBCDFa8qpyBbSP7OvU4PQ0p2W7+LSnSJUFOrI4V7w5IoBTQQTfJ6oTSYk2mQcpGRyH2syGjIF6EM3V/fM++C1CfwUExhCsmzCaQT43lZC3e1hBpEHh36XEqrB7Scmq5dV0XZxmV8WuDFzAF9iwhow9seAGoBcGtKjqAc+1l9rLb/1igesO55ysmCrC8ei6IxRMAKTWNBi6Xw98xNTFUi0jEcmpYgRAPhddpVi9OIEPP5cYD4CcLkCooHPwaW9kV+iwWrQHT8uA1fd3F7DFvgUHUP2k8jTiogAqLoxFpDgbMj9jXSuN7i9dLIdaxzBp5XVBMIMgFEnFAPKT9qPd6A9BIGI7MfPmf4U+40HzI8nWgq2PBxL4FEkjKJixGRRFyQQPzzd1iAUzCAQas1YOmAEoFjwkecDC/PAwhKw6CxIkCXwOdVJLxTobMjBdyIgfvimNvNJ7Evf4jWtdnRYD1YNGVuG93VWuWs4Jf+mlZCCZxwP/cnJ6mXVKk2+tK8lQQVHRTGc64SDAZB3Ey3JcxyACkToJx4wHl+YwqloGDICmYmTFgMQFBET8yyYzyAG/AfWX8mCGQg0BTRoHwt9KVaPE/HQ890AIfgWK+CRAaMRYnVdxHbhdY8Wslw1V93UDsmPIj9GxgiAioRRMIJNvoti+SW/Ikd0gwAU8+XxJcbGITJPDvI6XdCFREFSknTB83xka40H1PGF9dnycCxFwygkK0bASJQSVAbAYeD98xUAe5U3jKIwBosSgNsuABYogl3/IwgFPrOIg1Xc4ZrpAsSrvruykl2ucykapkMMh4CExD5DwJfWAYAxwk4MKPAJgOIjGSEGwuCakRhemw6Yv0UUwRf7L00L9pnsNx6Qx4feY4O8pDEcixOjsoTKKpMYjSFYYjOC8Eq3Wnnr0YYS+0Tmi2HysrPGLqwASNYzBnT2Mz2QD91laxLB0gs12GAh81cf/o/OcHyJ+qj0S/zxnhUZbSyYWaL8+Rq2S29wowiWkJPan4MvgrDDGAlRe7KIywDIgR3meEDWg9HbJgApNTkXo8o0i7oVgxnEgFr8F7jEdnU5GvqfJQKQKyEOPlsNIQvyvupAGHS/Okv4qv9oh+PHxMLk8ggBCRxvAmEN+AiEzz2iQfQBeNmkh4K52hJBKOaNe/FSLobLRXCz43rQnu2yi9oMSMDxs2jo8303ERz1wsCGZECF4kd3DwEYYwJjhoNlQrgIjlYodbBPrwMAZfEmyzcIv27gs6XDzC/IR1DOgA9a6DRz4wZAsZ+LYXvQYsHoD4ziOFklna6YD3+nnU6dZ7bGDAcBUImIAmEUw/zbJ1i/scGNDJiLXmle3RhQ+l/aq57gUQCWzwwBKPeLsZ/LFrGg/ShRXAe64Ajkv30kALAjF8R11Dy3K7KRwJcsUTaqWScARou3w/INVnCH+A36n8RvM3nB5XP4oD6DATBYwGb5ajlOLOh6X8JaBKRG77+7ygGYp1bn+V25/01AzBnwQ1ypanD7KWfA1QDYC3zJIj7KgOUzc9nFbetX/r+O5biwNhyX5uSEDr5o0xsJwLp8/m4A7GaJUv/j3/5+HQFYJ3oFPPkho/hNeqBcMkcB2BAA6XrxmMBkfFAci/m0JpwzXw0TXvXtzrz+PKc/Ml/ugzM9MDqCAbz/keVjjGcQA/YLvjoguo1mRslRI6RwfsiA5nqhL5D6nscF8gfTdfxpS+/hLzvWfzMQCoB1Fq/8b3VWaPIDZqsRV64DALsZHVHs1gEvsqFAeBSApQC8pHK90Oql4UEAyvCwNeGcBXNLOPMLftgZsI75ouUr9ousp2TEyIJ/sU4AzC1e+WIFshyAHPZREVwItrrD3wGAhibTYBhxVpe/xePyrNBuWaoNp3DgFwC81O+RAepK/a5Lfe51jxr7JwA83nPXYgq1asl0yX5N48+f4VEGLATlK1vAo5YB1gBSRmsM+NFE57lcfPD5pPFWCJImtyvGgGfOAacBYO59zFglgHgPefZsXV6/gPXBYeC0RVgyJNOGYuJjPka9eHWgjL9bWzhWk0/n/wPn+k8bgFNmgYcsVflZnBRmIShtJM/m7JGibGBoOIIez9wKPP4AcNpylfbNlGfdI+9NjBjz8JVzppckZuJ+dBw4aQ44drk6j1LIY9JkPD7P4s2lwVEGLHwJnncscNIh4Nh5YMsSsHm5ndOu1BGFThJ8/K6JrZtoslST2+XHA6ftB05ZAE5crgAups5TfaL6EF+UyIif3gAcOwtsXep82eIYY9JkXpMgMp/AeZQBC2b8OduBYw8C2+aALQvARgJwGZhY7swEzbNa88IRvAVO1qkF91J36DNOBE7eD2yfB45fqphLnevzdGeBKBfL8UX5/CZgyyyweRHYsFwxYHzRNK6oetSBMDLjUQAWTPqPngpsnQK2zgKbCMAlYMMSME4ALrcnR6JYQIwsoUnjpDRstOLy7cBJB4CHUGwuAtuW2nUDVH1EFUhycSwWjGD64mZg0xywcaECoI0z5P3X5P6nWlHdgHgUgAUAfOYOYMtBYNMssHEe2LgITBCADkIzSJZXpCOnIg25uPrhgnupO/TyhwLHHwSOmwW2LVSik2pCrDsQskzNIBGIpBdGI+VfNgMb5oENCxX4yPRjPj4xaJ0+WGeEHRXBDUz2Mx4FbDoIbJypADixUAFwzAFI8KUJChMV2SUaAGc1cE/xFJef3FYRti64nkqWDrqqEhbrsm5zvZCdPCd8nHzJOLZuABRz9hTHZwPL7LnLnoNMIY2VyaKcjtZLHOAbNgNPngKe4BacfGF1pnydD+hphQ/8XV5UiEueLGnDN1tWXj/3/4cTwAUzwGPcRcFJiDpPt3FLmf5vjwE2HAQ2zPrEzDv7OQg5OSM+ScYQy5Xbo8465u/ZfLTJ7fKHAdumKxVh8wKwealSE6inEoSy2MWCdbUHIghv3AqMzwHji9VLZuDzD8cXxxWZs5c7apmW0fMBnIHKn5X7d6I5npvRz94O7LgXuGIReJSb+Xl1tzqflybwRwqf9i97BQRWomWJQ7oZVFtJoqDX/b/oGODsvcBTATB9gsfGqmzdjtVz+G+PAyamgYmZCoDjFE2anCVg1CeJwOMnTRB/DmUINVkkgia3y08BtkwDW+YqAFJFMD1VAAw6XG61R31O9/fdrcDYPDDmY0zjc1UjivBuAMx1QdMB+WAYXU8dhEU16dOSkppbcHFSrng8MHwnsGMPcN5ypURHp2xMIa7zDz2z8Gn/kVe0YomO0wEwBYKujL7v/zHA6C3AxfOVh58g5AsZxx4fZM7sf3h6BcDxWWeGBZ+cMEFiwGEHHRnDzun7ONHs/djkRgBunql0VDOSHIDU3cxSD4aEajhFXS4H4S1bgVGN0V8we7E0Fh9jVDG6Obr1LJMRwn+kOCaTEYT0dsfqZHXl/p7PrLi9wIY7gO0H2yAgCAWCWCowKrYE8nMLn/a7PQn9X7zIJPPkCcK+758y7x7guNsB6l98gZjLLYet3Ay5n0sv4R+fCYxPA2MOwLEAQLIDPyP8uBg2cRYmzFweAYilKkn+OC8/Fdh0CNhEA4nGA40kd6FES13WLO8v1qHKAfh9B+DoYjU2Ak/js/8NAIwg7OUb7LCC+WAfB4CpBJoIiTRNRmS1l13kqWh3Adv2A8cdqqp1MB+aIOSxWv6pq5D2kkIAvt8rF7BLJksN/jMqfa7v+7/Ak4B3A6ceqpasKMq5akAmlLWY37t8ZW97PDB2qALg2BxgAFwANEGcnI5JcrDZRPlkaXL4u1KJUAfAjbTQ59x6dSvdLPXAgGYshZWR6JIRaXB/NwFI8C1WwLMXzMeSwLfcXuKrA2G+wrLCDcN/IIg4ERRn0qvyySAQX6mG1XuA4fuAbTOVwktRRr2MLCoQyvEZ/UY/WwjAj3jtFJZkU79g1ghkgEBf98+0Umb/3A2M3lkBl/fOcdMok2EjkZyv8773LAfgHDDKjwNwxEUw9yailpwdxBAEYhBbAuGzG3aKkQEJwAkCkOCjlb7Y6SYyf2UwlAS+vKYnAXjfNmDEX7DEfA5CjUcsnzvbu1nDtUMmCDkRZEEyGdlAk6G6lQTSa6m0MP6HuY73AxNTlcJLZ6WOJYC5/CNxLpHMgdKIKNl69Qvu6/75AjHOiTU87gKOOViJb748BKCWrnK/maTA+58AjM0Ao7PA6Lx/xBAupoYDC9okBRAmPdBZ47lNA/DhwMRsxX7mPgl+SrmK5EaRNRslXFQ9CKB9DkADn79cZtkHFkysJ103eBbqlh97DpmTQTYgk9VNxu+xYbXKU3lhFoJPOgdFGY+lPkgQxokkgF9Xgj4AvfoFs84eX4Ke9x9fIC+tRfDxvvniif358sSir2LCj5wNjBKAc8CIi2AxxLCzIAGY9L7AhGIKgpATw4l8wToB0JjPrfTkp+SLQbHrOqm5jNyajS6VCMIpApDAWwQ4LrGgXqzIfnq5cv0vN0ZXHTInME5GBNLb1DGdOYQsI7AfGKFjlgqve8wJwG4T+fuFAFytXzCLb+VgWnH/fIGYfc46Hs7iHC8ZkPcdXx4VfVXJw8+cA4wIgM6AHSLKWZCTESfLfg7WsIyRF3ckiRQ+HACXkwHptyP4KHrpJvKVGnOhRF9eBF9wE0mUEogz2wC+WGI/vVxiQQIxAs9+rmHA6E1YFYB8DJwQMZl0OrLZ++i7sfT8zroYHLS9df4RACWKxSZvLXzG/fQLZqk2gqn2/vUCUQ9UZaM9wDaPeSPrC4A5C1KV+NITKwCS/SiCR/jRBDlLmP7nHynsxno1IPwJSyRpbiMADXzuPDYfZfBTEoAmcuVQdiaW0zwXwQsCYDYmMaDA1wG8TBSvaoR0G77EcGSET6hjOvVApfRPAUN0zjr45JzVcSqiTxD+VeGzXku/4Nr7JwDJOkxFIwt6j6+RqUrlkO4bXzp1gCAAv04AzgLDDsBhKugLFUvQUhTwCEKbnKCw14HwJ9cDgGQ9WegRgDI8XEcVEDvAl7lVlglAgi+I4CR+Zf1mLGgMmDFhBGFfDCicRJFERviSABjLS7FC0MFKMU+07wOPE0kGvaoQgGvtF9z1/iODkwn3VWoEXxres5ib9xx1wZufBAwLgAQexbAD0JiQwJOuJBA68/H3Zhk6+3CifqqwWNMKN8wjKgbk6gWJgC+FMaBb5vJVmsUbV2vCqo3cRWZcCIACoax53+ulkqNd7iqOcU1WcC9cxEm5kQBUdZ+sTnSL/jEtTWngi21jhJNJBivZBukXvOL+yYBkcOqxKjJ4AGgxzMrBVwdAMmHrZOAYF2l6y/mwV6xD17zmWo6MbRyeWtOHwxJ91IIhr6rqZS70DPPLXDVUrfBwzHKr1EUp6/h0T/6L/GcCqslt4IhoTcwdAqDSs7I60WQH6R329pHuFyuXDJmEjuOSbdB+wSvuP5bGUjmsA5XoUvcvBXKKAQnApUdXwah0b8jXR2YzJTsC0ZHB33FL+2yiX3h/1YeD1fFZGT81g/H6yqkVa9YEpqMhTADle8erHA6t7Mh6j4ZBXdBGjFyO4CSIm9wGBiBvgqxwIAJQlXIyEJLyI/i0SkAG/FbhaEr6BXfcv+5dLKhCg4z1C1HEBJ8+BODQGZXfk/quAZC6ketAZEQCTWAU8PIJt0fgwHzZvVWNaKqi7JLOmtDWFy42g1FxH/XfqGkII0C+a0tnDkfsGxQjn3VPsk7tXmuy+Xp0JhtoJosAaFcUAJUYKiYJxcqHqKAH9rPlG2cMrmCUbMX9guMLpGTcCMKDlZGhMK8IPnPIn1X5PA2AwegwEEYmDGBMjOI5whGQP3NPBT7VJlRNaKvF4t2IWHbDErtDlSk1p4lJ7/zd246tglGZryIfrFhQ7pU8WCAX0ZENG+57U14Z4YrCeLrSxXdev6TfLwrbxT7znMrfKQXfHLQCnyvmRIv0Q3430ezMmL98P393G3wqz6am1NYzzoGn+svqRmTAU2citctqAX/2EI8F9ACEmLHXLZGoFxtSl2xyK2bAYwrj6Xr12+1noL/jUTCD9vvFrn6u0v1/nvGkaoVBAQi0eummMAuXQHMWJAA7gCixG8U0gFfcXdlBKk4Z6zELgAJfZEKrxpC1xOIl/+Sk7jkcdYlSco90y9+gK6vJrRiADD0piad7RuFo3udNCgft94vCdrGXn+tujgV3QAcHLcFnroelivHkchEL8ue0uQ74S3eubAITS3IQhKkMRjBMokgWG3L//2z3VSnP4VDgQWxUEEUxAZFHL0eR3HDfm3IRbDHkBfF0zy4EIKNhSvr9goGEBdvTz/MIYQLQdVsTwRTFDj5jQmdArRDYJQNDSs961R3tPhx5NXoVgoxleHnarjohgLec3D2HI492yQNvIwvqO9fJm9zKGbAwnu6FhaP5pFuMg/b7tTbpBdvTz68cz/zI8azVj8iAHTqgmFHXDUB89R2dtaC7tUGw4kDOgFb0R2wYRDGZ8g9O8aU4XwPOczhiwGlMjqqLWiFYGu570wADFsbTvaxg8nkow7E8nM/atfKzln6/1mS4YHv6BQ4+Z0BbqHcd0NwwYbVD3+1yWhXJxPBrbq8AqE/XApSqAxiBV2MZ/54DMOZwKE00rnDUWcR5KiV/brjtSAMALIyn+/mCyeehjIYp6fdrvVELth8RAClyHXxmhPi6r1m8FM0ucgk8+y4RHC1kAK/5XgW+2hZYofafWcPq1B5AqDqEYsQ3nepR2gqhV2yiol1COkD0C+aOaoGx4aL7DQCwMJ7uVwomn4fm7VrX2u/XAlELth+5sHPtN+l/Ap6sX2dCsZ/phZkIJgv9l++1wbcq+2WFv2NXIjNKAPzuw7MUAV8DTuynFIEsQy83RgTAhiv+NgBABaQOGE/3mwWTLwAqHnaQfr9GnwUbARgDNBUlkpzQboyYCyYDYdILdf0l4NduW9kGoa4geNdazLElKoA3Prx7DofiETtC6XvE7hGEzJlpcis3Qgrj6d5UOJoYDcMglrX2+y0NPtl5UZUjkfx/Hqbecoe0OZzdF1gHQrln9Bhee4s3f3Zxm4MvAk9VSFdUIw0i+Q2PaBtISiBSSFgCYMjMW00MP7pwvvLDmwFgQTzdHxcOSGvBg/b7ZRZByWYAlOERluKM3Ra9CKWc0q73dTBhMFT4ZwIw9l5Lrpes+HjeBiGCUOKXeuBvPcKTiEIOR0f+RhDBMYi0Lhea4GTaa5NbOQAVDzhgPB1La5RssV3rIP1+7yy5OAADoAchEHBkFbKfGRpiweAPtMs5IFNokyOGk/7rAYC9OhBFwNXVY1at5tftCBHaWVS2AJdEcEinrDNC+Lumiyc1B8AB4+muLARAXTDCWvr93lR4/Z0Xt6ODFQkj8WtumEwHTKDLQejAfN3uds/dfjoQdatGLxb8jQBAYz6/boxiFgAVudzNIc2/s3xLk1szAORoB4yn+2DhaATAGJCtbpkCYq9+v4V+aBgAQ4i66XtaC85YkDog/zdZvzUgfN1N7a633Xqv6fe9msDIHfNaB6Ay2JRE1AHAEDIfI5nzZCLeN4Nbm9yaA+CA8XSsul6yqV0rJ2WQfr+splCyCYBR/HJyKX4phs0PKBZ0lqOYTpvniAiUAmAd+HKjo1cvDjHgr+3wPJQsVCymUZrPMuRsRBDG4AQCsunyJtFGHwAAIABJREFUcc0BUJlxQoH62q8ST8cggpKNAFRGwCD9fkuvbwAkyGgJE3C+Nz1P1q9/T3F1EZBxvZh50s6AEYC5yyUHXt5/Q8zI5/KrAmAIkkipkyGPYwXz1aRT8v5ZO6jJrRyAvKOvNXlLazsXs9bo/ztc29Pohgotp5J49Rcj/pzfIwGS//3OM4CNd1dpntQpFUmjEH4LYIgnyn/OLjL8FeDGhwJbNgFjI8DIEDA8BAy1PFK7FSKf43cNKrvHx+8C/vmxwMgmYHgEaA35J0StpvvzL/nP8RbLAfhyT207TChgDRiu/ZL9DsfWNABvYzbhCDBKoBAk/pEobGWTqp819hzQ1/0k0PoaMDEJbJjxVZFgDad0SaUO5LksWVj+XScDmw5UEUDJ6U4d0nVbC91S3ovfVHp5al64cgC+k7mZAP768KCA0WD3A/ieLz090CDceVmlAuhBljLgrfcAw6PAyDAwPFwBkCAbItM4a/FiNtERjBl76W9ffD2AbwJDdwFj+6syImRXrd5Y2FjIYcnzWPLEqnsfC0zsr6qBMQmfIDR/pyJ6xMhKyMrSDiKD2xja6TADTt0/AGAs1KcAUCFrOLF6tbtiRVFavT/wuMCa7MfVTlH098YBeBcwNAIMEYAUlS4uBULOmK3LCnwOPANlEIOSoF9+C4DvVoWXhvdWZVOYqWgi3vOXDUQhgieB0EElViMYJ08HxqeqnG8D4IIDkAzo51DKQQJvBKUmKACzbM4+5hUivwrgiwC4LzvjmgCh6nBcgiMTcv9Abo0D8E6g5eCjfpUA6AxoQIzgi8ALmWwC4z//DxcPPwBak8DQFDB8yJPpPZHeGCyC0KN5DFCByfh9/+OAsekKgEzCTwD047X0SCPM1IYQjCv2E/MJoGVwUUQoPboq0MdqkWVn7RtDDMahB4g+P6qhXFpjVtkDtRGA2nKjos7IyOyHFUbIrXe0FXsTuzIYfNb4O2M3ATGIYQOmPn6hG6gi3eUkQQAeAIYOAUOzALMVh2pAlESqGFBAXAYOMQVjxll03iO/yYKRAT0FQXkwZkjp1pz51LO2XAT3KtD3AIAwj4Wg05kfiuUHYlsXAJLVnP0INLM0OYFx78AzcRySeTsw2AJueI+Dj2Fne4EWKz5MA0MzDkCCkAByUWqsJzarEanzj2zXwjEGFHuGY+pYsMojzZL1G9EBexXou339IRBrC3lJGmNDuSHX+w7WC4Cm6wWxm8DngLTImgC8pBcGBuTXf/1fXnyTugnFwxTQOgi0CECyIFlsvvJfEnh0mhsYI/s5uxFYi1xZof7oOqSAawwYjRGBzYGXbtWXaCIrlvHUagX6SP/ruMVYCEbEqECXAMjfree2HgA0ESur1/0vtnNwGSsG0RsZME20/+/XWH6Mugk/yngPAGy5GDYALjiIHIgRUIrsZjM7Ax+BSx1S4pfffQVIep8dL7dMDsTGjJB+CvQxTHmdtrw4l0CovFruC2NOe975egDQsCXRK/eK634JhBK90q2C7I1i+Gt0jxF40k1cPJAB7UP2m3MGJAAFQrGei9iUTH9yBUDTHfU3B5+BOIKQ43BWtNtPcWIOzEZE8FoK9K0DCGNxLi3FqaKA9gTgeoFwPQAoI0OulWT11oEwiFz7cwbErzNxWtEYBB+VY76Vh4DWrH8IOoGQ7Ocg1CqMRLPltmxvs1/SHaP4dcAJePYyyUCRIzrTB8tE8FoL9DUMwl61kQQ87Rmy2PS2rgB0a1ci18RudEJH57OsY02y/+83/sZdBKr4FXQTApBvprGgQCg9UEAM+h9F6ugJDkC3gJPBEvRGrYoYCBX9IxEcS5K4i6cZAHIw8oXQ4mLBb35YH5d7OekadtTV1UZSjaEIPH4nQzYNwgjAHNwDuWGYpZc7lzPfX1cQur5oBorfzDf+zi0yVTuSkuxBI2Q+PhQDIUEnMLo1TBCZLufGw/ixbQa0KB8CTODjPohdY78IQmfDjmW7Yo/doAX6GqIiAtDHaYswSmeMubV81kp11L6hy2PdAcgblfslOKC1IiKRmyRxZgV/8++DS8BFrxXi5Hd/U6MeSKdqEsEKhpBRsgRMbAtuG4KU/+9ry5brzP/lPVMv1EPOQegharrVcgZUhVHFxNPcp9VFtlOWkL437C0WABWypFRGsV0sb5Hn2zYBwvUGoKl10v1knDgo0y7XA8Pfv0UACnjaK33Co9gJQAOe64FkNvtZAHQdjz9v2Nz2GSa3jYej2W3KGuZ9ixGdIVSoKT13B2s5AHkGheST6qn0erHv5AIgAAU+LVfw/wq3CEAV7clBKDDGZG9/5oVXx/oyYARczcqH5GyH8eFplTawFvAtrtXLGpNrQDGbejupB3omlIHQGc/ErzOcGSRs8zrhAbbuL1Tco/JfbLlNwHOmi2kIcs3owbdwNpYtynDQhsFcgvuG9/YapGFvYX22zZcAU0/GwA2LJ/4AmGF9mwEbBu98Y3cMF+uAGQCj2HVp3BbPuo3IlqxAy5wHAq4OfARmEBXGfNIBa0BIsG0ecwC67merHgRpZLwocrWaovuTxew/V0txJQ2DWeae3WAGbdhb2DB4+wRw7w5g8Qpv88liyGtoWHzMi4C9fAEHbBi8kwUKu2xNAdBxaGBLbJdZux1LwAGECYAEm6wyfpelJrEgFnRDxESwgyUxIUsVMwjVy5AYO0bG89Auu1/5BF38KqjBHlUAYXsteNCGwTeWNuwtk4JMkrlzGNizA1hm69g1Nix+zDOBW0aBeRZZGqBh8M4emfWNADDT+zqMjQyESdQFHfDbZECCLRgdHeCTe8CBaKJY1rDnBRCIAuGW4TYAZeFG8ZuMkGiQ1IEwGCJtHZBmy1obBsvVMnDD3jIAerti3LEBOMjGcOpa3WfD4ic9t6oveDtLfw7QMHjnH6wPAybW6yaG4+8D4HIQfvtDIVtLejpBFsVvUI7NIBHw3DUjRzL3rDVtsYPOkAScuX3coNDynT2VYJCkn+PjqvUD8hVbS8NgjphGxcANe8sAGNoVY/824BCBtIaGxRe8pLKZdpMkTvXiJ2toGHzSNHDPScAyq3er4qPyGaNc7JCRXWLT2TjwGmCOeQashq6+qSpZmp8vojQpheF58ncdZVjLnjWPHr4VWKTKxrHGUqq97qXu3jp0wPy+eEC/DYNZsZAO6IEb9pY9lNCuGPcNV830ZmkM9dmw+OKfbdcXvJMPdY0Ng0/7GnDXKcDMccBS7MwdKz8KCAKQIgY0MWGCtr4TOHAasMwOkTqf6unyuLykfd254nkb7qsw/iVg7jhgmSX31Vpd9yRHeLx+zRhjEGRbB6wDYT8NdymyubzDzCCGfpMJWfSRYfr9HP/aMgBm7YoxNQHMbQHm+ID6aFh8yS93tAvGQb7da2gYfPoXgbtPAqaPA+a3AEubgGU1RM6B060fgkRoCzj+TcD+04CFE4BldZdRc4/YxlxgjJMewSiwN1zWfsOngdljq3EmY08vm5i/7j5yIMqpvupKyGoNg9lngYosl9wY/0dZdrMzYl8Ne8sAWNOu2MA3zw/F2CoNiy99XbvftrcLriz6PhsGn3U9cM9xMODObQYWCMANwPJ49UliuW6SaqqBn/gGYP8pwPyJwNIxwDK76ahDeN6uXYCuYyABkEza4LbpY5WEWdSLxjF26/dQB0SJ6r4ByAN6NQxmkWcqrnQ00x1DEDJFjR8CcNWGvWVPp6ZdMQ6OVOCb3wAscPJ6NCy+7PerkP5Q3tBY1PrT9tEw+JwbgPu2AlNbgVkCcCOwtAFYcgAuiwWlM/XqDjMEbP9t4MB2YO54YJFMo/5gHIcALV1TRZ17FXOhPtvgtvkqf9H4kvHDlyKK4l6VzvVSBF22uwjOb7pbw+CfcwBSkyeFEHAUx/yw9JTyEbo27C17Ol3aFWNuAlgIn9QxO2tYfNlbK6MvaxeMRYquvL9rTcPgJ30TuH8LcHAzMOugX3QALo21WXBZLEHwRF1OgHS2eOgbgIPHA7PHAezNu7QFWFZ7JnXJ5rnqxHEulvlzwyVNN3+wern5Yovl7SXLGwvn4riLWO4fgMRJXcPd/+pmOymELEhRzBxJAo9gVL4kwVnbsLccgHEpWi3epocCAMeBRU5eTcPiy/6qtl0wpvhA+2gYfO7NwOQm4OBGYGaDs+5ExYDGgqP+ccAkINaVpB8GTv4d4OBxwNw2YGFrxYCmV0YxLNYheCXau7EhV3ga3Lb8g4+R45uoGLADgHWqhsBXA8K1AZADyRvuvtkBSArh+i9DsQhCOtf0UUgW/7aiYW/Z0+nRrhizoxXwFhyAi5y4rGHxU66qAFhT3rDSIVdpGHzencDejcDBDcDsBDBP1uX1CMJRwFiQIBzxieL3KIY1YW5MPOxNwLRb8gs0aghAss1GZ1O+SFHsdRPt0i/PLHu++dFb/x4mXfhcbWxhfCtYMFr/uWvKxfDaAcg7ipPCvFOVpuo3HrCjYW/ZA+rRrti6TS6MVQ+L4NPH2nx698GnXF0BsKa8Iab4dFZpGHz+JLBvApieqAA4J8CPOQuOBBAOV0CUYbIskRkAecrvAdNbXc/aDCxSpyT4CEIyTgRgneiLIp3nP6fs+a4A4N8B8/48CUC+ZGJA29fpuLmxJW+5h5kNFg2jiWHSi0r0Uv4pCoZsxw8DUfnhd4Vk0XGdGvaWPaBV2hVjdjgA0BlpkQ/K9bmn/HOVqtClvKEBqlfD4AtmgP3jDsBxB6DA7tdbcvYzJvQJkii2n4NOeMpbgJktbYPGACiF3wFoEx1ZMNe/4jnPLXu+KwD4t/5SO/iMBcXuesHylyACMBPDgzGg7opM8mEHIGdwrfGA1rC37AH10a64Yr4APvvOSdwEPOVbKxu+K2pdKRTmdI3dqkPPVgbSTBGAY8AsATjWniBdx0QxJylOFCcr6HBiw1P/CDgU3EgEIMW52M8YkLolQRddIN1AyKWiBretf9MJQN6HsaCPxe4rvgDdHOcOxDIAcmDFDXvLnk4f7Yqt63gEIB/Yoj+4p9xaAbBHeUPM8qF2aRh84QQwNQYcGgdmx4C50WqCFngNsgSvQ+Dxu4MuiawhwIAXVk1O+e/A7CZgThY1dcno1nHL2oDIyZULpBsAFTBZ9pjT0QQgn2V6ufRicS8QRgbs5ZYpEsENDejBfpoLrwAOjgIzZMBRZ0AHoUC+SOA56xJwNlEyTFw5FxBPeWvlzpnbANCdQ1eSGTRybMuydgMggVBsKmtYoC6Mt8znZxsZMLzAxoAOvsh+ydDqtXx4FIDl8L/omQ7A0QqA82S/ERdTI22mNfaTuBIIxR4BhKe+y61punQC+MytI/Zz/c9EuvyBeetLAfGZ5WOMZ9j2/gqABB1fMLsHAVBqhfTcyH5d9MByEdzs+B50Z7voGZX+NzNSsd8cwUcG5ASRKYbdHRNYwhhDIHRgGmO0gFP+HJh15jOXjnyKblVT5Cbfoq+yJOszF8P8+VnNPlICkMAzds/YLxlYznrJwIpO6egTPMqA5ZNDAB6iCCYAyYBcBqTRQ0e4630SxZyQJQIvMJ8mSeLrYe+p/GzGfnTpEIBy6US/out+K1wg+brs88rHmDOgAVCMnrEfxxMte1Mt6j7u9zzKgIXzczEBOJIB0BnCJoqgIfDEhM58SWzJEPGJe9hfVH42un/Mfxl9bgSiBySIBWnAJBDGEDAB8QWFA8wO3/a+wH4+rg4RLPYLul8tCI8CsJmJMQAOuwFC9qMI9g9Z0CxhZz65K0wfFBPqu7PEyVdWAOTHVlTcpxhXHZLz1w0ZA6EDLhkCskRf0sw4dRYC0PQ/vVSRAYPo7QCdj7GqVOSMeBSAzUzMxZcDMwLgcKX/zbv45SQlHXDIgagJc+bjZBqAWhUoH/Y+B2D0J7rFa6LYDRmzomsAaOeKqxEvbWacHQB08JkRIteSXiSBLYJOLB+X4xrzAzY7vgfd2S4RAKkDDgPzNEAIxMASSWF38WsgkuXLyXTRSRCe/DduSZMBMwe6ObTd8JBj24Aot07uDObPP9XsIzUGFPs5+JJ/M6oT4buxHv9X7BeY8KgOWDg/Z58GTC9Xq5FxTXOw9c3Cm6k5fPcjgbHbgAlvVG2tH1T3Oavoq6BlniZ+12n5u/2sDbOvasqoFg8x2Lnbcd1GdhSAhXN+7qMrAC4sA8sORJ6yHwD28z+Ft4fdv8UyqUDrDmCEBcpZ39kLS6aq9l4D2rLb/KYsFTPWdfbvh86vQu2s1K/K+zIjTsXIVQ9a59Egs4Y6sZfIA/EcSp/jEXv8BWcAhxaA+SVgSQAkGAMICcwVlNLlqTc9Gbv/HAA7MrL4+f1VlXwrUq7SvCoyGcrrWpGhuur2fNGYwM8YT67hT3s1LaZvqn5MLM0bzmHMmIFSgdFNj/mIBct63NhFZwEzDsBFgpDPeanNgATfCtGsX9TIKwNrg9tuVkhlng7TI/YArX1VkXKrEe1l2SynN1RCsFJsqnQv3UIMxhwIRjU5AGN9QUteVz3BUAvahuNgjC3HxLAND7nBp/cgONXF5wCz8xUDGgCjKPbvevlzcKUHH2ag6cnYzepYBB9Zi2FxDJdjoXJv1WDFiLJ6MKqKZUzoQFTfj2HmwTKcTpVWvcxHKm6kKgoORAEvVclPD6NdzLXpMT8IYNPcLV7yJGB2AVhYrAC4SNA5AxKM9ryDPE5fs6eeVKWGZ2M3S3MQfEyJUKV8L1ZpJXpVJ9pLilmlAxWkVJHKwIhjjD9TtVXVm1HdOy/pJiaMFRWM+bo0rWl4yM1N7oPhTJecC8wRgAttBjQWdBBGESwgSiV0Pb9DRgu0TY19N+M1mRKh8niqFx3rRDsLqjgl9yaGXT80vcL1wnE252PAZCzAHQCoiqoW3yYWFIt664fUpKaREr1NPakH6XkuOQ+YDwy4FMSwgU8GSRSz0UJx3Vx/5vFNbrs/EiLRY+v4ACITww6iJEodQKwBIyBRv9vwhKzUW6z66TUGEwhDS3ezqusAyNxnJn8xa1KRPSFts9YfFB/QDZcAm78CnDBT5U8rCqjfc3yh8Gn/hGd/MsKf1+QzYJ4891Jye13iy1cAE9cDJ+6FpYrEkidxDN3OtXR+FwBGMezoMmxJLOumAuD4J4rxJrfdH/XCoLGFVKiUbw+LAPQqWWaMMLrd6/+JycSIm85w9lOpt1j1MwAwFTiqAWEUxeYH5ENn/jInUVHeMXQ/f/jRePvCa4DhTwLHfBc4frGqqaNJzLPw6iZxV+HTplFGvZrXZT45N39+HW3TujlZv8D6fp8HRq8Dts9XIOR5YtakgBgdrrrt5Qsq8Ssd0BhQ4HMwmVitAWHAY/LbLDQNQDaTVJ8Q6W4qVB51OOqDZDPVB3TLOBepW5jmqaLbec3jGgBGMSxvvemDYkQ9GoKF1ShUCSKCqBeQrvmfVZPC1keBjXcCmw911tTJ8q5XgOLaQgA+x/OdWA2EGZ98gbjleTHdQHQN+2iwls3nK3/Zhj3VeQhovYzdxmArSwQgDRA3QiSCJUrTnjfl4KozRCSCCeYmt90EoJJbVCk/1+FiCwFZxLk4dRfLFia6x8LbYkD9v9cXtLG6+O4AYQRfrgPygVIcqyhTXcWFOJH8fh3rz7EKwnUArq8mcGwK2MCC1i7WY7Zenh56feHT/jE3yliE4TZncd636gPFCKWavGhcRx2J+cvs9MlSw0Ty3cCm+c7n0G0MExdW4BMIbTXE9UCynvyCCX+Ovm4gbByA/xisVgJPpXrzLj4EoRJjJIZrWHArS9iprK+KcefgiyB0XVKGjOmCmW9xhRVMUSyRFnNeFGEdI2q+/HFXclkp9WsAbgTG9wGj08CI64WxRk/OTDcUAvBHXSLQxcVCDMQSWbzv+1e7WVbz+k5w2tJtsbcCYV6WJY7hmAsDA7r1Sz3OgOgoM+KTOJbcjSI5yGIaNE1uuwlAAU/MF+tF5/0sIghVLdVdM2S0bSzHx2Mi+FTxXf8X925NC4BycK8QwfmgVX1LlcFiykEMcL2BndJJ7aQfijKfxLGDwAhByM7aC5U4qwPzNwufNnNuOH4VZaCPlPo2AahqFqoPVFc14ga2m+WEEL0cAz9kdPrOmMu8r1o/rTsXz7f9oswFs+jO6LAqkvC3Ggg5Fg6mwW03CUI6X12h8lyfcz3QHqr3DIl64DbqaQKc9mI87QXACD6vpJqY0EVxz2CEyCI5eMSGX2e7VtI5J4yTRyZhscrvt1nQuivOAaNLlYESwcySgiVbr37Bfd0/u31yEgg2FVaiPCeVOguqAfGov0iR0R9JABJ0bnwk9nMxw+fOh55EbgRhzozrBUA1polN9CLwok5HEEUQBjFMQB7D+j656PW+IrJ8O/bBCo4sGFdGejqiyYCx3mKe9/JtTiBvmI5OFiTisg9LtJFF7gZGDrUbHKs79+hyu5hSaUvh1foFr3r/6vZJCiXgCDwVVFJ7MVmRLsrGltuFCc68yFdACMDAflwR4QM3HPoKgIExt4gz42SuaQb8hBOE2oZmlu+KFlKR3QSssMJxDPWbbjpfLoJrxG8CYT8MKGZSVTCxYFTIb84nkCxCIPLDiby30gXFghaF4c2ReR466Uu2fvoFr3r/fKAEFxvpqMcd9yonIrkuK5LLV7MVCM+/uDJCyIC2J8a0z1iwqyESgMl15Sa33QKgmtPEBnp11mwuXgO70Ud4DHWzfgDYC3zBEOk7HlA6XKyHQzb8HgGoCSQLqsxorIy1Bxie7Wx0rFaf+wr9Xv32C+56/7HbJ5VHtRYT+GJrsehHcya57PyKAQk6+vBkBZPpjPEExlwU59awg3C24W6KBsC6tqHR+MidyVG3i3rdAnAsH2T093XT+zLr197MTA80h3SfsZP2UqpCrPQ46oF317VrpeiKXTJ9MhMLkgGdCacKG/mupV9w1/vnwyGgCDCKWzJe3lqsyzLWZWe6/kc/oKzgKH4jC7oolhdC4jiuzM0WPo+cPQ2AsX1obFCTO5Jzn566PwbReiwnfTWjI4KvDoh1juh+aT+WKSYD3i8Aql2rJk+VsVQly5kkddv2FvHT61icqO7Fr71/IkLNXOi0FQjV0046oBy6wZ922Q95ICqDEaL4XWw3COcf9Mw73DFB9AqE6wZAAS8XuzGQIDKf+oVkqxt00ttAc+YT0PJ9qRFSB8xoye5Xu1ZVeCSgCLbYLVNswoncHxoeLwCzBGjBNki/4BX3z9lXgUCyIIGmhova83cRgO5Te9yLgP3MfmsBS8xs8/U67ePQOqy9umBUruDchqo8sHSd3PMfT5ifo+ack8eFHI6QEcnT5GvdOnVdXof+ptJ+BVPWceiaRHA8Us/nkACo8mzqlqmWrbFDppT5A5UIZm7CPA2Vgm3QfsEd909kKIqB1qJAKCBG8ZstZz3xHOAAiwmpDIdng1maZQAkZzsHZ537YfQrwNyxoQ+HakrnS0h1mUA1C96TdJTmORyhC3oeqdwROi+GDhkFI6bYNrcNDEDeAkXwQizPRpmnIs3OdqZPSaRFUcbchHlgie6agq2kX7Dd/+d8lUJVXuUzk8ERmS+2vfd4uvN2VOV5rSwb0y3JhgIh9wJeN3YMQCIgR78Q+nDEVYBYZUrUpbXFnM7COSdf7N4IPvtDnT2BY/h8Chh10MXQeYGS+7GGjaQiABpuNIFiECnzdWJMIUHcazLptC7YivsF8/7FgLFMqpiQL5TuNbKfA/DC46rqqAbAwIKWK+timRUBEiNGsOQsyQm+Gpjd4n046hbT84KPuYjOmHHyp92gcgDS2OoIuVIeh/xyUkaVwyEWdLrewHE3uBUDcKIwnq40HpDXL+n3CzbaKdguel5VnFJl2awaghLQBTzteZ0cjLq2A2n0M6EPh2pC57Wg41poLzZsAZNso0Hw6eVR/J8bF9YjWGmVCpGKwQLBRCcrbiSxNLgVAxCF8XSl8YDHHFPW7xeFBRwv/rGqOKUBkODzqgdWPYAM53vTASMQu4Bx9J+69OHIF+N71F1O1gUB+AsBfFqKC+4Wi4BWX+CYgOTAU36wdMVNVKka3MoBWBhPxyiuko3xkSX9fvGMkqsDlzzHC1N6SQ4DoINOe7KelWWTheziObeKCdARApD1AdVnRH048gKUAmAEYi6Oh4DJV4VoGDWqjq4XLbO5o1jBoimEPhPJmwu9FvnTLgdgYTwd2wyXbMyRKen3i2eXXB245FlVYUpVxUpGiLtmGBlrTEhVUwV8dEkVKAq3MHJ1uzRbRx+OOgDWFX6MsXJU/36lJoEoA2AKvw8+uwTEDIBbStdOs8ddDsDCeDom7ZdszBIs6fcL9ror2C75US9IxJJsEsHdGFBil4yYuUwknofJgF4XcEUfjrz+X7fKo4EJJ//PkMORO6FrVjQMeL5kJhZMMXzLwNZCt1nzDFgYT8cQwpLt4hDON0i/X7ys5OrAJVe0S/ISgFY7j9ZvnQ7I3+lyqpYaL98CWp/N+nDkZdhi6bW8An1kP3fRTLKVWlwF6RZCH2L4zDDR0k1IqeTNb2OQSYNbOQMWxtMxeqtkY6I+ny9VEz6btfb7xc+XXB249AoXv85+tIBVgJJ6n4lf6oV+mfjdDJNMH0wAVFX90GMk1f5TxlS3Fggh92DyN0IORy5665KIfCktsl+K3VsGtpVOWOMiuDCerlSnjQ2rB+n3C+pIBdulz8wqonrNPLKgwKaC5B3s53qhXVq6oDNg6sOhqvqhEr3V2VNLBjmnSSNdrOLJ1zkAu6VPRjFcFz4fXDJ8i45hG94Gt3IGjOFYA8TTlQZ/qGH1oP1+8ZtlT1MAtHK8mQg25zOZUSCLIliWcbw8wfW5Ln04ssqnHX04euiCk6/3de66MPpuAQVZAEFkw2MKFw6a1wEL4+lSBvmAOMhD8vkOkFX77feLNw14YT/ssmc4A6oOdHBEkwXlgjH2k4Nal6wB4fIuX9LzZjAmorNeHMo5Tc0OewHwDTUh9HXxfGJsYkAbAAAgAElEQVS/uvCpoAcew6zBBrdyBlQwwoDxdLZWXLDFkHyF8xGE/fb7xR8XXByAAVC1oB18HQYIT+8uGfP75SCUs1o64he8v4j6cIQ+IqkPhxrBCHjdjBH6AblQkAeY1ondukSiELmsUPpjbyp7XuvDgAXxdNZVvWCLIfmKg6Bbhrjup98v3lVwcQLw8gqA5v9zC9jErutltg8gMxDWWMBaMVkmANWFyEV6R0uH2I1IzW7ypbkQOTP5f2ch9KsFkwp0kQlDAOmxzHpscGuGAQvi6VD4RgmAg/b7xZVlT5MATNXwqQc6KGwf2U2uGV2uzg3D4ua7fDnPwZcKgIdq9GaIBPZb0YdD7hgyIFWMXiH0eQ5vXS5HcMkc++9lz2t9GLAgns7KxxZsCkgdtN8vWD+vYDMAUpcja7lOR9eLVcIP4tcuob/3AOHCdW02VTX62ApB4Mv1v24gnPy9HiH03fJ366KYHYTHsgBBg1s5AxbG0+HLZaOp65i+ln6/YM5EwdYBwGj1cmUkE7+8THLNdAHhwrUOXtcrO/pwhF4cct2oN68BMDCfmsJM/n6PEPoYPp8bH3kCkbtjji2tJJA962YAWBBPZ0WBCrbYsFoOf9pDAiENk179fkuvf9nTXewKcBSjsn7ldonWbgQpx+26otaLIwAlfi2QQSJY3Yjy5i9dmsFM/oEDMM/Z7Uf0RiYUA7J+ToNbOQC3e0WBBm9qLad6HICG1ZK1XB5PoxnuOOIcxSXe/Of8xHV/P+FpwN47gKUpYHmuSve0pKZgCKSq5wqniWE1WZz/xouBm74KTMwBI17lVBXwtWSs+8/vL45Ff3vhpcAnvwos8d48DZX3M2hx9XIAnu0IIO0chu35AOgLL0yuG/jOmwbg028G/mNz1YWdETbm4I5BrFlov+EtD2wIo7l+Atg8D2xY7iw3V5diEqO54mnj6XdMAYcU+6gon7A3NSO2qFjlyZYDkAX6uD5Iam44YaUfVNDNxaJcLIPXcGGpfi6PnZdVD1wPspQBX/wl4OaNwN6Jqg+xwrxslcVFuYJblehkcYYZGPS3L20BxueBcS8nwg5H5kZkx6TQSbXFZcCQKadx5Cz5mPurAFxrRaa17pAR2PFC+ElSHKQ/0QjQcgCyGyM9v3SnsDBRJgL6msWCf6IfWeUJac8UFlpY8500DcCfvgb43hiwZwyYVhd2D/VSrKGAmIDnBkiafEcN9cprHgKMzgNjS1V7rRjRlceyrqif6KAkMgXIM+6tAnDl+zSL36O9+U8p9jGHQo285/2XA/AnXeNnKAorDXH/AILwbSvLEz6Ql2+cAf/3XcCdw8DkKHBwpOpFbE2wadzIdyh3jjNQirYWEwYq+/zJwMh8pf+xKNSwM6DZMmzNRRbM2K+2Ii6TlFrAWfd5V3i/F7IgT2LBF5LbIdkqxLPWvtzlAGQ3RpU3Y7AiixMxLOUB2t7pKQ8M0qCTnp8HkojJgNqaMEJesQv4AR3Iw8DB4QqAs+6SWRiqgJgY0HVDAdBA4Ba4xN7ndlSFAAjAYX4IPO5dBDMAdS2i+Jx7XTf1eEdTDfgAQnR34p/wQkRmjNAoByDT/ugFphXAmjAEn8qaPQAgZCs0lSckCNmVigEbFMsPBBE3DcBX7gLuawH7hoAD7EM8DMw48AhATrjtQwiXoqkTEwWd7LOneXNCbz6Tiq/TInb2M8ZzIFrTQbGiy92oGz7pXl/7jvdAJnb2470IbB3T77Sai+hyAP5voTqW6sKwFAc/TAdc5+3dvcsTrvPVYSK4SQb8xV3+6IaAqSHg0FDVh3iOIFTIFxtit9orL5Z/LD1Q4s+B8OnHVuXwhhdd5DoLGsgCCJ04q66X/Ju/vSaeAxDPvbdtmdtKDV90gVEPIl/xySkviOhmAEjrlzSkwj40SlQZYZ39I+8JBMx8mZryhOsKwqYB+KpdVSDFvhYwPVR9BD7uyX4SwRS59nNI+bRck/DzJ05v12M0nY8fAk8iWL5BB5qASPGRCi8EVjzv3mqpkC9ACrrwhKukB67GhpqRRowQMqCiYbj8oOoHeUWpdYIBAUj8c8WjrjyhNIJ1unzjDPjqXdUjJAAP8TMEzLYq9uOHICQALe/EwWe+QgddAqCzzD8+vgIgg0qp+5nYjaDzCgjmnCYone0klqP4JSgvvK+6LoFPoFMlkPGh+0rPWta4RHTNJJQz4M8EAGoNTPVU8opS64CC9zoAWTFChcq7lCdch6s3L4J/2QFIEBKA1P9mHIBmhPh3Ai354RyAAmWsR/PRs6vOR8Z8FMPS97yxtIlYgVB/I7jC0rIKSfLXF1EEB+BFFjQ3jCLA49OWsRTTEPzvzQEwry7VrZ5KwzAQAPssT9jw1dcHgCrORQCS/bgn+1HsCYQSveaHkzvGv1scgU/6R55Y1YIxhvOm1EZekQWl8wVDxJgwc88QiJc6AKX/meHDawX9z16M/Em7bO8Q08GBP/jEkAEVjMBoAFWXUjRA3KtNwOBXW3EkAZhrALktpC6lKtTV4OU7RHB+3kHWgv/zrnYZl2kCkF4uF8MGQGc+MqEYUCA0n1tkwxbw4ScHAHr71Q7W4++c8czwcBAmHVB/c7Bcek9b3FuwbdD/kjGWgzJjQ3thGmVA3jhfOyU+RxB6FamOFp8NrhsTgLy8Cpzm5QlVptAU+6CiNgXCaIQ0BcDYV8b0P4pi30vfIxD5+w72C9aliegW8MHzqrmh/meuFhYi0pKbs6D9fsh/n1XFMrYMbPgUByCZz6J+uEknDA9AornWFRb01WZEsACoHhOqyC7wdetT0QAK2KqOb5MCUvPyhLE0oQxzqaYNXL5xBvyVXe12vByLADjXAvgxBvSPGFGMIjCmJbEW8HfntxtQmxT0cmxp9UPAdKAZ1upA6EB7qgDo6oCUxXRtPVSpAwJpnUhuxAqWCCYK1MBExZljY5S8SYr+pxAFAuBayhNG26jw8usCQLX0SAAkwwcAEngyQizaXoziIli+Oe7/9kJvNk1LmBMe9ECO3XRB7aPeF0EYHNVPdT8gj016YBcWtBfBVYJuz7mF7VgGY/pO8f5WdQ1/7U67nIKNS7j0wIbDPFZsyNHHY7od/xdlEHj8CcC3TgCWHgGAPSxiSdt4312u/8SPAl8/Dlh4pDeZW2PD4J1c9+uyDaIDkgEJQKnTfG/N8nUAmu5HUnMW5ARbPfEuIHy/ACjRK7FL5pOR4RaxgTHofKl8r/S1ZWBnAGDKefbn3AFIPRPXB7sFiVQimKVgGdl5ooNwLQ1/1U+DQGSXQ9r5Evy1q9rZbP1lGQDZsPpzI8APHgXgod7qUx11YtBbFzC+/C+BL7SAWwhgdoLkONSLqy5oLogYft3ZI1F7EAC+phsAnekokhP4HIzml/PvthQWmPB9LJ7jxkcSr14jWj4/0wFlgJD5eoDw6fe4DzAYPHokWhHJZ3TFSkn4h7YOSOBwEtiMTv1aY0uktFYTmI2/43EMQmCuAJmUE0gmVD8EFdPpdnxhVhqzDr8F4NMtYM9Jfg98EVTeNu9Q2OFZBX7vr9vtgm/lcezczZ61ZNN8DCvilYCdPXqNDQpAlfGTKm0M6AA0PTAyoMSx64cRfPQHXsniOTI+fEWDFGp+Qb9BeySRBV2kpl0QxxGAlHDmkI56X6z+EP7UDYSdRgh/IouwIZ36lHabBE0GJ0r10Rgb/xA/tt/j/6aMAf+7R4CxzuBXWRGULwBfIrY6UNfpvLae7n0I+LO/reoLMqiVMbW38oUhkNkQIzZO7tIweGePcmWlAFTjAYHPVGwXxWoLYblEDkLuTT8MDPhXLJ4jALpaJB+ggU6xfgJknT7IKXIQXh4Y0FZCog+wxiUTwSkXUbSMV1rB/A31OXWuFpPUda/mRHKi1e6U+hA7Zq7l+A+UAfDtHg/LrptkQpZ727cRWOL9542Pa3rOvuOqagUltgtmJM08j4/PILbIDKz6w5PAHsbraTnMGdZWIwIzxIfeK0rn578J3LAVuH8CODRahV/FFQ/1IumIvXP1QudNfyNT8oVqcHviPcBd48A0g2RDuoDqHdb2SalZAdG9dnfDkAE0gXnH5ijWCDbKCq5/MRiV0QD8HgHQ63jG0hdsLGxA3x9Bw1Asli7hO3BwApgng/Gjvq01IHrXJ7q3Cz7E++YziF2rs1ZLZ+8H9jJsSoECWXj6igmR87aLgfbGq4GvbgLu2gjsHwdmCEIPSI1h+SkCRjpfUC3iNWcpoRrcnrYbuGsUOMBo7QBCxSTG/igxVcBIVGPWM1h1JYQPnyKNExGZMDIJ9b66eEBGxPDY1Y5nv+GCjfGAxD+DDpiawphABWZPjwNzNLAEIH4XCH0M7/5c93bBfI8Yk2cgVAdvdT10ifDkBWC/r9lGH51NhIsnsWHOfPmEUKT94WeAG8eAO8aAfWPAwVEHISNQlKQUglJjJExqC+H6Nq93kOpUg9szbwLuHa66QzFWkaFieXxi6hgVHOMCYGRuJ+5V4jYJIDKI9KlsAvFDq8QDrnb8NWVPh9EwdFkQ79TlSMIsN0Mi5s9MoOGno4U6f3YAvefL7Y7rvdoFLxOANSA8f7xSgWmd0kCQbmZ6mTLEnJ0UqWLhUkxlrBn6n3wWuGkYuGukCsufGq2iojnRFpafsU7MDxErJuZhYCsJosHtWTcBe1oeq+hxigJgXBrMmTBPnJKLrr+VED54ibHYvZos8sO+DNcrHrDX8YVVyglAKud0LtMjFPtNMz6QLDY7VomLJd671AEH4Xu+3g7nWq28ISvX58/hguOBg8vtFQvV/hEzxfqOevuTfpjri8vAWz8L3NYCfjBc6ZYHmBcitnFd06pxyb8W4gPlgonBqffTtdTg9pybqiVNBssyUsdUD7eGO9amnf3sXtxQipl7Wg/sD4A8AwHIyZMYky50Tp/xgN2OL8y051qw2hXzwRCEdT2nmck1RxHG+w5jeO9NFQBpR6ldMIMXlFWgVndqF2dVFsJzuOgRwMElB6DcI6rznemD0RnbwQiSRS3g7Z+tVIl7PC9kahiYZm6IizuLigliT/VoUog+p8P9l3wJ7qGEanB77k3VczroUToWLCsABud4ypaLCUoxf9i/9w9ADiICULrQRWuIB6w7nuZrwaZwLBGwClSqSyz3AhHbaRGEFGOmC44D72UVgjW2C2Z4lIF4ArjodODQcqUGqAxfcpG4mJVuVqcL5tbs2z/veV0tYK/nhTAqesYNHdO5PCJZos+WuzxHJIViuXFyJxupNLg976ZK2lizUKodilGUgzyGhokF8yw5Mf+qRkjdjfuDtwkkm7DTkNaBaQ2ox1q3eMD8+B6O3H6em8Kx1Ccx9ptWl9iYIUAAWrI3I3nHgPdOtsO5eOuxXXBdj0V1vOL/so3Cxef60tlSpYwveKf0pAu6ohfdJ8k4CUqgvr5jV6VGTBKALeCAh+VbZLTnh5gu6D44A6H8cVlkNK95O1WkBrfn31R5HSy+JCwPplAxRegE/2T+AloGncNmbQyogUQx/KwB4gHj8YWNTwRAOW0FIIIndoqNkTAxz/bd09XDGLBdMM6/pLKi5whAX60gCK2ujxzEAqGL2pQ1Jis5AJEAFHvTujYAKjRf+SEugm1d2COQLU/DAwQ44caEw8AtZzSIPgAvuKkdrWMM6M7xCMBoiBn4YpCE2NCfxWAA5MEuwvCCEICwlnhAHV+YORfDsWJGgPpMKwg1b9QpFnzHbD2BK2JGul9s8KkYW17vLALQRTCBpzXZpS4gtCXXMAkduuAy8E7PijPWprXJ5CR38ygw1fJDohh2BlRAgq2OeN7uTWc1D0AFNtmL54ESBsCaJcLkDajxj5ZXRiCIGA0waDwgjy8sk5+HY+X9ppUbJSCp6TnFCMXwny1WAFQ8rUAc2wUrRL6mXTAefWnFfnz3FpbagQKLAqAzoZjAKkkpXkNO5GCEvOMLFXOnnC4xIKOjnQGNdWSM+GqHQGd7JSsxUf+JzQLwhTdV4je1nQvr1MkPGtlf9yP2Dy+gAqZ6rQytfvdHSDxgLwBF8AmAYjHWluEDiKGMiqOVvtejXTBOuRSYJwDJAARgZAGWL9Nk+IM3SzgTydE4eec1nZHbtDaNAf1Dpd/SMx2END6kD0oXtFhBXmcY+OY6AFChnKnzl7NfdMR3qCAae2B+VVMYXASvDs3/X/zHJZcB84vuiqABEo0QPnhnwqQLyRURmZBPytnwHde0M1vN2lR6picoKULaxHDIEdHkW2iWg4/7b5zb7DSQAVd0/griV2JYojfpwRGEYsGBrOBmx/OgP5sAKANkcbFzNWTRnX/GSGImMYH/LYlk+gGvdT+bW+SWH+Ig1GqL5QeTtR2EYj5LVHfjw/ZDwL8yJ6TB7UU3VVoTjTYxYDK+Ivv7dzNAZIxpZSiU8jjKgIWTcykZkBawDBBnQdMr5QeTKI5iWCB09AmEb7+ucnOQ/aTPWn6wuzyS4u+R0Ob6CUGqJpIDA97AdqINbgRgBJ69CG4Jp6q/ckjXqB/RKla4WpkO2ODgHoynigA0JiLwaNiEt95YQKJ4FRC+7brKzRH9jZbN6iJYuSHm9I5iOAOhHNJfZkh+gxsBKPbLu3+JgaWDdojhMO5kkDWSlNTg4B6MpyIAjf3IggJgMD4MCARjFMU9QCgAykhSKnUCYHB9JB0wy5aTRUxmup4h+Q1uAmDs+hpXgFLnB6ULONOn5xACNJqxghsc3IPxVBGAiQG9aLeilWUJW1FvVXEN0TKp1C6At19TMSCBpz1dHtT/JH7N9yaxp6QkF73KBxYIr10nAMproB44qQGTj6sjUrtOFPtLeFQHLES9AdDFrq1E6M13MaxVCTNAXNFThIylLcor40zxtgDAPKuVwDMrOKw+SBTbtR2MND7sZwC7Qvm4wqHa4T/uIrhb+7n0EgbQdTijoyg+agWXT8llDsAFWr/B8qP1K7bT0pvtVwHhW6+t2C/m8svvZlawi2CKe37nhFtapkDnILRqBQA+v04AjMyn79EIkXO/DnzyCBwVweX4wxs9B4rRZgyPVFqykgDd+5JSpBU5r0vHyHz+jsc3ub0KABsZMCyQgeExKyFPVIz3lmcM6OfPAGCADYPE67Jfs6h7G0o+xvi7oyK4cLZfOgpsXwC2Lq9MwuuVERonKn4nSJrcXnQKcM7dwMMXgYcsVxkSebJgzOWPqdB1ad2f3gpsnwK2LXWeR9m3danUIV1lBSCPArBwtp+7DThuBti6UDWDmWA/DvXk8LRptfPtNUlihYZTOPCi04GH3wFsnwGOW6iAs5n3GeJJ+KLoE+9VDClQ8R6vOQHYegDYwuY3S6H/iJ8jb11ck0q9Qhoc9QMWgPBZJwFbpoFN88DGRWBiqQIgWyJY3lPozaGJ1KTEPh36zpTkJrcXPRE44S7g+Cng2DlgyyKwaclfFoIwvCwx9Zn3Q1DmIPx/2/sSaMuusszvjfXq1ZRUElJkKsBEGQyYhJCBSkUqAW1tsBdpuxEVaBzowXZqe1g90G2LotjQdmMjKqtBxQERdAWUAkUlZNBGkQRNyIAEMAkxpFKpqjfUG3t9//m/c/+737njPq9uVeqcte66b7jnnn32/s6///3v//++Tz0dmD0KzC4DM6vAFpd/0L3Gh6yTDgnvLwKzAWDGiH/ThcC2OWDrErB1pRgQisIQhAa+AED+HEEY6uNLyrRnZLSl6tSbrgLOeBQ44yiw8ziwfaV4UGbdegmA5QMTLFlqsfn7XecDW+eAmePAltXiXnkuZSBkRcm4UGXtU2uo3xsAZgz6y54JzMwDWzkgBOAqMMVBCSAUObh8QuN/CiTgcWAuyWhL1amvvBbY+VgxbW477paa7gIBqCnUrbUBiQuhAKDUot13IbBlDtiyBEyvtO5VDxvvVfxW/JkWNFrCeK8NAGsY7BsvKQC4hQCkJNaKy2LRIsg6SJ3IQSe1onKKC2CsOYMeN+0Dtj0ObDsGbFsEZmWp5S74g2Ir2uA22BScAJGA+dJFwPQ8ML0ETAUAkgDTPq9zdK/+sMWpPF19NxYwA4g3PtsHxAE4SQC6FdSgmGWRRIJLZJll8EGKjHiX1jwaN10HzD4BbD0GzC4WrsKMW2pNobZoCu6CLCDfCTqzgg6sr+wFphaAKQfgZHKvpRSYg7HN5XCL2AbAZwPrZGaj6ippXhgn0kqmU1woxnHedg5AATuWHig2FE1uVRwoxoX+Wcbg89S3AqCKPONcCi8oPtVP+9++G3j+oSK2xRBFDElUxbTS+3nvc4FpDsjxllXQoJg8FgdCQoGJJTTicLcQ6vPL6wbg9cDM4cJv27oAzFA5ky9/UOSvmg8oP86n0dICBn25JwjARWDSAUgBHN6vfdbv10AbARh8X91vDM2ss+NvAECKPVLCsHoyUgRqrlbnRwB933OBc+4DXrIC0IEmiLnE75di8HsyAcjzWUVGUi6uICMpVwwJVMXdeOk3XAxc+Hng+vV2esAYw+sWoP31r3eLcLwQBeQUrEHh4Jo2h4vDmJPuAyMLGAeEn7uqbgB+I7DlSWBGCwe31Gb9aL20kGDb/EGRxY6WTz8f2wtM8l4pgL1SgM8esHCvsuylME4nn9cfQLtldg6TZ0kUKorAfij23vAPCmqp3fcCl60XFINid1PlZrf41/dnApB6wSQjutUfIDJR8CGIQOwWEH7DywpKrWc8CFzqRLHkVYrB2jS2FQH5vkuBycXCAlIUUAAkCM2iRBA6+ARCe7DjYmQduLYTleiQ/XTTS4DpI+6nLhZW2nzVCEBaMLd+soIGqjD1ampdugiYWCpeBKA9bBJC9ActAk8LES26SqsftInLZ44dQif4Igdhym5WLrPDyuYH/7HTCNwDnPko8LXrBccjQaioe6BiKad3+QY/MGTH6rS3OBvCnQDuAIyqhiDkQ9RX+29yE3on8IwjxQPI8zkTiApGU3oVkD/4fGDieAuAdMw5MFQjEgg1DYsUku+a3uI0TGBfV7PotwHwaOEmbHEATvuDIutni6UAQoFRIFRYhfe/dhEw7tbe9Of0Si1g8HkrwRcevDajz07gIJ7n05rYyWIpb4ya/7vv8PRdFpj/LXDmkQLAnA4jCCOlTBRN/rFMAJKgkkVHpGUjySSBSFeg7/azqk8EgbSEq8UDRACLKDXSyaQ7Br//DcA4LSCtwnKhTEkQcmAIQhtM+Uaajl0uS9NatITXWzpzfcdNB4DpY+6nBgDaCtanYLN6fCj4u1ay0QIqtML/EYC61wSA9tAJeP6eWsAoDysFpg1eB0HIQRCIIkVeCqQf/05P3WCB+UPA+CPAzvmCaFWDKEuYcl1yMN+Y2dckqGTeHPEvvWDSNhOAfbefX0A6rS8CUw8X9066bFIfdqMHJID++DJgLACQumyc3gyAEYRRKFCLD1eu5ODLF6QvXedx0w3A1BwwxdAJLTXjd8seQnGrZ9bPFxLyA7WIKON63tYtCQBN/sv9QPm6BkLp0vl9t/m6ietR6fbyBA4gnXtORwRRpNnTtPpW6gWLH83lKqcOFTEnDiKtoHwy8RNFhrefyeztbnrBfbWfgttsP+kIyO32ELD1cHHvInrlvWs6TsnB7qAUlg/suFtAWkE55zYQ0QpqcALoNCXTEt7A3KoaDwGQfqoAOEUBa7fUbKctltwCajVbxvSiyvoasM0BaBKwwdKb9fN7NfcqBWGiSWykWXER0umeacUEonQgCKRfIgDFjya5yq8Wfsfs8dYgiuMxgpAg/vnMzu6mF0z6Zj5APdvPQec0TEosnvQosGOhaLuIYvnwEYSithE52F1XFAA0p5yigD4otCqygFKnpHUpLYP0OcKURYv6Mj4MNR433QhM0gL6QongawOg+6rl9CswKoSkEIxPyTsuAPigCYBmAXVfYcVf+n0SRYw6dP1YwNgHsgSajiJP429RrpWOM6cxDiJB6NINM4w7LbUGMQUwB/M9mZ3dSy+YVG0EoBiDBST5ddZ+PkCsAiIlQZDa3LVatJ0WXG2PbL98AB+4omB3oP/HgTUhmGgBfRqWf2TTrUSjExDSP/qWzQDgfAFAWyzR8rkFtDAKX75jo6nUguZxZ8NByHbvvqBQ36T1swcsBaBAGGRg40Ir+rt9WUDhQ5ZAU7Es2e9LLzglqHRxNkbeuW+oQRRls5jaMjnK0a9ecNf2R4LAwO829kQB3LTtEYQPUwzQAWgW0AGo8AQH0ljp/V17pm0KRcEifGuNOnocO1rACQbKPXhs8TtNwVr5uh+n6Zf3wDgu29g2FdMtOc8B6PdpFj08ZFrplw+ZA5FTvAQQ0/BT36FPDkRqBT9Jag7xYlQItY0f88j78sZzCcKPZlrAQfSCK9uvB4h577SCotUiEJ8opq8IQFl/PUBPEoBLxbRE62LSqG4dFB8r5bHcOtiOQSqT5T7RKzYDgJx+BUCCTxZQCwhaQc9oKcEnEBKknj5FsJ1LAPo9xoWWPWDy+6IIoqbeaO0VA+zHB0zxIQDKkn1GgtXiRxMIAx0Vn0Db+lkuFjLRCt5WEwD71Qvu2H5OfekD5FaciQay/GIbFgBXriwAyGmJADR1ck3DwTE3TQ4B0LetzBJErTYAr2BBSI3HTS8tLKBZPo/fWQDZp197Z3scjGb5BDp/L3+njMweB6B83Gj9wj3atOsPWin9WgXCFlVO/3ctf4iD8XkBkH5USlAZlNPZAQqARr5vxu1yjmH0givbX0UQKI63o0Wun/xHuR8E4VnPK5JQLd4VNttTBvK2uoiKOUf/f+GjwMNBh0NMV6J0c0NpcRv7mrYv3kh8/uHxYp+bVpwLp3R7sts2YzouSq3KGa+q7+x7Co4nazAerRKsVlV1QitF59dyyFZaYY0HMu9mWL3gtvZXMbymBIFMZ1ov2h0B+LTLisxgW+Eq5uU92iZ72ud9vvR+4JFp4NjkRh2ONi0OB1/UBCkvEYRhfuNs4OmhhiPKnFQlx6aAjMnSXJUAACAASURBVPjmz1w41nnwO4cCIBvBwZgTAOUHRq3gyDExD4zRGVYEnpm5LqmQc0M5esFt7acFl0SlHiBxuTkYxxdaihUC4QVXFu5FCUD5QtJl85sjGA0ziQxqeu/fem+hw0F2fLLQGxFlYMRvo7v1WmIVtpt1DFkXvOR7LwJ2HSkyoZmEypoVVe8p7b6qEMnidGG/Vl/L2aPOIwuA1pAIQE3DAmFa4j9f7CPaFpCHKujr5xzZesGdHqAqKz5X+FLRAl58le+jui+kTBALMcgZ73CDBkpN2/7+bfcWOhwUyCEAjQTcAVhKdjkPc2RajewKyu/n1//qJcA2uhBMRGXQOcn9U6JIOjXHQqSYOsVoQp1HNgAvz8yny80H5PVz9H6RqVd849WtXQ/zA0Ow2ayGLJ474L0G79vvbulwkJi8BGCg4S01SKqofoNvSIC+5zkhFUupV8rUTpJN06KpaBkFQm5M1HlkA3AyM5/u9Zl38zrk6f0iU6/4hmscgK5ISUtCTowyDqb7UxwsqFJW3fo/vbuIBJEZ1YRgyHwQKNi0KEl1OKTCZJdxtPDn//v8ooaDaVgqFyiTD2IKfcjZS4Fo+7g+HXOPv84jG4DIzKfLzQf8KVfI/FNKrQ6h94tfz+vOA9cGAAbrpylY2SDlVTTt+uCnV3/V3a7DQQAysJAwobZJgUXi78Qayhd812WeiOAZzEyUiAkHMeu5BF5FwZQAWLPwknkLQy9CrPMy8+lIHZFzvN3T+YbV+8X7c64OHHix74V6zIxB+RJ0wQ+UU992tYoFy3fcXcTDxQkoPsCUhFIczKVCegSg5B8A/PILN9ZwxBSxtiKiUAOi7JW0dLTustF8AGbm0/1o3vjjnSGdj+lYlGwdRO8XN+c1wABIoHk6k61yuSCJITq3jDY9Vx0BqK++uwAfX6JkI/hME0SC1EGguiQ+isqcQRLrF6/0jO2w+6FMnZhyZYsQ1W50qOHgPX1NXndtODsfgMwHzMin+0+ZN0S9YOllMzWfLwKQSS396P3iY3kNOLDPM1y065H4gOW3p4uTDkB8zWdb7FgbdDhEgJkCUDRvogTmd/vPv3BVAUBuvylNzAAYi4hisVQnEHoIqWblrxqm4Mx8ujfljT+YjsWBYgIOc0oJPsq1slCpH71fKybJOEoAuuVTRSCnYlmU6P/Z4iSJEcbLv+Yu9/1EAh7JKEXDKxq4ChUiKymRbwjgHdcUWTARgLYXHSr2LOU+BV7MVwzxwOfkOWybYAGZD5iRT0edjpxD6VhcOQ6j94tP51wdOHBdMeXa9OqWRcmWXA1XLUIUH6zyCwlAs3z+YBkfs1u+VIejJEF3ckrjI9T0y/aMA2+/tgAg08VURKT8vbKMUgAMIGzzAcOi5HknHQAz8+l+MW/829KxhtH7tTz+jIMAJPCYMULAWd6fvi+EY9ouoZBM/Kx/4LUBgFLgNC5o16FrE8JJVJgkiFhaQQBv3+dVbMrWVsC8UxFRkjjaVsW2DtRdOJ/vAyohVYK7A+bTvTdj8HlqTMcaRu/XxHkzjgNkIOWuDr8jnYYDKDutgpUhra0uAlAyCCUAK8BXcjBXgLCk/h0D/hcByDxFAdAzoFUqUBYRJTUcMWdPP7ONL6i5bLQeALJRQ+bT/W7G4AuAOXq/lsGdcRgAY+glLkYclJVTsa6ptCX3uQjAKINQstFrAZKIwWxQIhIJuovB/Nx+r2LzFCwlj8Y0evl/MYk0kieVtcvrwGUnHQCVjjVkPl3mItQsIPuElx9G79dOzDgMgGkAWlNyBJn8xKprBRC+zgEo4LWRgcdVcOCjjlNvmx84DrzNAahaFZWLygKWxUNibIhTcPD9BMLLa65bzreAMSGVoXvJ/Cgh1WUfO+XTZS5CDYDs9GH1fnOrIDcAkABTTDCCLYK0Cwi/586WcKJUiEpC8CCBYDsiiSplqUIUmOjf+o2tIiKVUJbgU5uSWl4DWwX4+PcXnrQATBNS+8yny1yEopdcay+930y5YhgAg+9n2OoUeI5TdQer+32fdhmGoOBZanBo+g1yEKU4dYgFSvqB//vZBIBt9RshkTbW8ZZZ2hUgvDL3iU3uux4LSBM0ZD7dPRnTH08VAIfV+2XAOucQAMuVcKfFSD/+IAABsEoGwYAoHZIKEEYxRIHwLS8pUuhjFVs6/ZZhIVWyxVKBBIRXnbQATBNS+8ynI4tBzkEACv+chlUVIKE/5cRGsWmlKfIzudc3APLQSlg3E2OCyVRc1kpU3DgBmKoQsWtlBcswjPu+nfTYtBL+GQdgOf16GCZW6pXlBCqWSgqJypoOAFfXXDifbwFJLvi5HAjlnUsiIe6AjOp4iQNQHRlT2PlgJCUbbc2s+v/hFwFb/q7gm6HlYpBbmTV2sscQyy/qFBj2v0/cAdz/HGD7NDA1AUyOOU+1CwWOewNjKj6/O03F1/WuugW4/XJgfBoYmwDGdH7IxB5kLPIB+I8AfNwZgga5ck2fJbEm8V9zNWPfrasbgMuPAcuseJ8Exsb9FdBhA+7gaQNKB6TfcgCYug+YJT+g89aoBDMmIMScP12uTKj13uDv8zsKig/uJ1uQOsnojm3qB5P5ACRBH3OhPuzzRN9DV88HqQLEWPJnvTy5nm/t/1s4BcuSpRZtGAu4fi+wtBVYEyccrYwn6hF8/FkJp9bKxAKVFsn/d8urgbHPA9NPOEOWl4+2cfoFHhfVrJTZPKHSj5daOtup6JyCpPx8rHWRVQ7WOlrYCMx8AHIzlxkALPD9c0VB+x/A3E/+E2fUYHXdF7KTGwdvTd0AHP9r4PgWYG0KWBdfsBdsMPfPrKKsoL9XAVLAvO2fFylCE4cKliyrDVZNcGS1CqEYhWFiAZV+XntaURdTLmpCEbpchTYLqi6NrkMCzLzt5Xc4HwyJmmkJ+Z73jQOh4NWeDUZiK1K08f0EXt7CMHVawIk7gaVpYJUA9LI1Ao8bzKX1cytoFtFfpdCIWz7rgzHgth8u0oPGDwETc8CEMySUzFaikgtlpW1Ta8JqNba7lVljSRgW+Q6ZP/57WQvj6fydBjXfAjKbgEvMLwWCvhNoipgNpnQshlS4IGFWzIk6ylWwAz93ETLxGWB5ClidLABoIOS7pmGfG+33YAG5mND0G8F4678vkiPJczNOAC4UyQm2N8w94kirFlfIAl7i402d6dbPWWAtrsjOFiuCvAJZOQE0pHTFsckHYDeCvhNgipQNxoAz8/8IPr5nbvH2jd+6AThJAE4AqwTdZKEBLDoDgU4+YVkPHIBoPwareOt/BkDexsMFAFnbzNJYm0IDnVwbt4uyur1kwL7Tp+iZM/08WT9Rc7DHUmuYTr/x+6o4ovvu9fjBbgR9JyA+omwwxvZI5ULg6ZW7y9FPf9QNwKm/CgCcKABovh8ByVy/UCtJq2f+X1yYJPGU27lIZLbuEWDsWBHesZeDz4iURLUWa1TE47LqK12fZmd3OXidFctqm92KatVs1jAEsNv6sdymaa2g8+xUL4I+Pn2beCgbLGWHI/h8G3oTr45iK86POlbBU9yKI/AcfLR+ouQwH9BfmmbLlTHboOnZ/T9+5vaf8FUaAThXsFOQ45mUcgZCWTAxe0UQ+urYMO1/37GtxQmoLCBtRSp30LrDp2SFdzYMgk/R+VNwvwR9mwQDsaspGSfJgYDYNTbp8psCQFJxEIBkQjDrxt8dXCUIY+COH5MVFPi8SOn2n/QYLZ9Gp0cxANIP5IvAkzVzxivRydnKNzBa8fddM84b6AFyAriMF2pajk9kYIeoClXmA3AQgr5NQEHMBqMVFMNaIOayNRL/vhlH3RZwmhbQQUcAasrVVGz4EtjCu/3dfb/ID3PbT7uKAZ/MhcIC0vqRTo4W0IBIEAmEtFwCYqjW03bcmdwBYeoWgetUbrR8snrloiR2drpACf+rD4D9EvTVjIJu7HBV+781X752Czj9lwUZkTEgcPoNPp5Nv4oBRhCG6dd+1DkMz1JIhR1BAHJ7zwqO3fIRRM5tmDK5CoQKsSgOeBYBKFZULTqcB9r6Ni5KYmd3WKDUA0BlhNLM8EbT1QBXBU72aI5ZjUcVOxz7WLkQ8d37vsart/uA6RcPsxNSAtAXHDYNC1AEpf9s01kKwuBwGU7HgVt/1jtD1e60fgQigSe/j5bQp+KYpGB+H62jT7P8/ZypBIC8Dhcx8eY9wF015abhmnoAyJ5WSrKeNgKO9SHxnT/LSasJBim5lRjWBEIVeROInKL1qunybRawLgASdEy74qjaNNzJCgqEEYzBGvK0297mAFSHEIB6ebKDgc8J1ksmV8t29f1en6L5v6cxIK5iK6Xne/5jCTiFcTqVn/r/tWDPWwXnEPTVgIKUHU7ljASawKefIwDpMdRxRB+wFgD+RREDJABpwSzz2c0LfxczVjkVKwaYgtBBezu3SvX08d39P5uO3QKahXMQciourZRAGKZWar/YZ1xXRPe8wQr2AUK7TvbOVTZBXx4MBECRnConUBSFEXT6mf/TK+/qmzAF/0UBOPqBZYF52HrTFCw2LH5G8UCzJEko5nZqmRnPh/uCXmpnVpDTsIPPwKApOaSA2QLDLSHf97iPx0tpISLfz7bl4iFfsUsnj+HZWEeOYDCDnDmCvZkEgedcCjxGseIhBYt3vx049HwMLRh8gA9gh2MoH9ABqKJzxf0McO7XlSAU4HzhYYFq+5D7hwBu/98OQLlIBCKnW39SlXNY+nqeiq2dkQg+gnGPb9/ZpT0lq6MV5D96gLCwgDmCwbdnCvZmCgY/dxy47xxg5SWuUjigYPHFbwA+fyGwfr2rXrMvPB+vp3L3GHCgi9JOHQCkRVPppeUBigXLFymyejYTB4YsgfA20ofRAlYB0FfAlvQqP0/TsX5PLOB5DNu471cmIwiBaRww/F01J+mz2pqChxUMZvpJlmBv3iTocsW4dzewfhkGFix+2febXDAeJO/YEILBB7pU1g8LQFo98QASVGYNQ6DZfEG3fnEqrgLhbf/HV15anbkFNCvohWSl9XPQ2XTM/2s3I4DwPIZwBEDfgitH0Ek6N6x+u/iD7T4g/YdBBYPpWHEaHlqwNw+AQa4Yj54JrJO+aQDB4pt+oCAyYvOPEIQDCgYfeF/9U3AbAMX7ItAlVtAspKZdz5SOlvA2pstxjES3wJ+92NgAGK2gwi78QoVfEhBeQACqNNP1RdoA18kKdgDhxkUI/zKIYDCnqyzB3jwAJnLFOEIW7QEEi1/1Y21ywVglCAcQDD5/Efj7M4CVrZ5AKlkhxeQUaxBI4nvFzxf8IfCVC4HV7cC6ZEX5nen3VX1vAGLZq8ysrvHY+QBwbGfI2E6JpLvdX+ksthpUvQrmX/sVDGZVUJZgb17vJHLFeGQcmCdVb5+Cxd/5xjZ6QzzMLOQBBIOfTV2Ps4HFHQ7CLQUQmUrV0rgKJMsCjsxGAqTn/hzw0EXA4tnAyg5gbTYBorKkUyLnkB9YVhTxu+kT13iccwtwdBewPAus+b2ar9xJAafqfgMQO4dh+J9+BHe5gqZZZzYok1JJUcpaR6bp93P+W/N6p0KuGIemgEWKgPQhWPxdP7NBLhiHKYHUp2DwpZ8rLOD8tmJQVplOLxAqmbRKC6EDYC7/CeCRPcCx3cDSrsISrs04CPm9ArZk55UvKAspYLqPaPdR4/H0g8DRHcDyVr/X6VabLHk2PhjpPVZY7d5xwF6CwS9y/4LbbVyQsEKIufGiKe0p2JvXOx3kinF0GjhOQY+oNRtljji9TQPf/fOV9IZY4Gq4D8Hgy/4W+Oo2YG5bUUy04vUcLCqSJVRWszJbNgxSmMau+q/Ao2cBR88EjtOqbgNWWaTkIFz3YiWrF4nAjtN0nBZrJnU+/8PA3CxwfMYB6LUra3oglL0tps6wlVha5rLiqd9AdDfB4Je6U0s/0BXTDYh80Sr2FOzNA2AXuWIszABL1JaKWq1R+nwGeM17OsoFY5XTVw/B4Cv+Djg0C8xvLYqJCECzgsxmZlq9T8e0XGUyaUizavPtxoFr/zvw2BnA0Z3A8e2FVV3x6c4sqwObckeyhiXAowUSADhD1XhceDMwx37lvU4XxVN2n3rJIocygkr/Vbs7fe+EdBLcfaXXQ3IPWIrpBB6XlnwpR76jYG9e7/SQKzarxM7qJFj8mg8UarMV9IZ4gvNDD8HgKx8HDs8A8zMFAFnPYQPDl0Co2g4fpDZLqKCxT0/7fhJ4fCdwbFvhRiwRgJruCOwUgCpeCvUjZmEFxhfk9W969kW/B8xvKQqnVgg+B6CB0MsI7P70AHgmd2n1NQ0rv7FvALIlVYK73MnQCDLThSGZoDpuP7uCeuX5n8zroB5yxThGnQ0CgyBMxY63Aq/5aBHG6EBviDlOLV0Eg1+0AByZLgbl+HRxnZXJoqqttA4ODovlJZVuSjTQFtq+NwNPbHMAzramdVpVs6wEoPtdNg37wJfvsYiJP9NFqvHY+7vAwjSwxAeNxVO8T6aNVRRRlT6hHrJ0Ovaw0WDJCKng7g86APvNB9wg2JvXO33IFWOBgn8EIf2nRLD4tbe1+AU7yAWbZeskGHwVdd2mgAUCcNKnJgLQrZ/V9/Jnn5JUYmnAE3hCmv3+t8AWQfSzyPK/POOgJgDdsgqA5nfJAvLdLV+bz0kK4RqPZ3wQWJxyAPqDVhZQyQr7gyaXI9axWCFVAGLvRUhV46PgLnUWBs0HbBPszeudPuWKsTRZAJDTo8l8ui/42juL5veQC7ZpsEow+OrZQlqVVuH4FLA8WVyDAOTAmHUQCAWQkOlsQAwDt/9/AE8SgPQpNa07+AhAA6HLXbb5Xr4IaAMfv/eGvP5NzyYA7UGjBWTWjh40v9fSyscHLtaxhJWxFVsNNAXH1khw983+DYPmA5aCvXkdNIBccemfceooAfhAAcA+6A2xLuAGucxrzgKOMexDfV9OwbS2BB/BEoqLSrBoYGgJ3E8qLcIEsP/ngCPuUy7S13L3wb6PU56/m/Xj4Ps0TKCXQA6AXuNeZY3HMz5QANAeND1kwcKXlj6wOZQ+b7R+Pi0PD0DeFAfk590CKg8qncfoFzIRVWVqfFfBhgn25vXOAHLFWCDbvPstBsJZ4LUPt+jdesgFg+qVptWq11bg2gtgfuLiRAAgQeg+oEmsOujsXb5SsAoCIN/3vx04OlNM6Yv0tdx1MKvK7/TFjVmeCD4HQQQhf159eV7/pmc/kwCcKABoeYvR0oept7SEoZQ0Tr1lPuPQFlAtO0nyAcWhpzw/FSjFzGjLx+RGvxzoSeC1hwsA9klvaFN5FAy+9mJgnhaQ0qqagglADo4c9AhCDpJPl5ZommQ8738HcGw6AJBW1VecZv0cePwOY0/wl1lAD/WUCx0mMlDLr8bjmb+Dwp3x4nkDYbD0thIO5aNtfmDi/xGEeRawxhs7Vb/q2huABQJwAlhyy2cC0xoggjAAUCWWAkksOiIY978TmOOqeqqwqAx3WGhHK06n7TDwOcAV/iipPAKjwgrZm2o8nkUA0gKmAHTrp+o9MTrEYvq44o9pZIOtgmu8mafCV72YAKT/RwAy5OPOuVlAAk9Oule6xQRTWUKlWtkU/IvAHAHti5oIwDK841ZPFtCmdr0U8PaC9hVultd4CIC8P2Ztt/m5/qC11TJXlJDGGpfGAmYODgFoCxACkLpuWh3KCgqE8gNVZK4KtxgjJAB/2X1Krao1rfN7CWZf3LSBT4uAEIyWBVpipL7GgwA0AW25GbGENBTRx3rm1M2w39mmrFVwjTd1Kn+VAZALEE5LtIDyMWUBvbLNLGHgd5H/V07BDp7r3uU+Jadgn3ptxekA5MBri0/Wp4wzBjDbCnkMWMqVpE8GJwLQqvfc0pqbkVj5aNk7gbCxgJno30cAjntowtXNaZ1suvSKNhsYTcVKmw9F5xGE+94dfEoP+JYhD/8OC8eIPUsUHokVVKB78XszbzAF4Pvd//PCKVGIpOAr78mn4DZOm8YC1jco+w6EFTDDPJqeCEBZBa5GffVbhmQ8DtZW5TYOvPhXip0GTuu22lTMLSw+aAVl9QhEWjurI/aQiLJkTMLsX9R3r/ymZ73fp1+37OU9hunXSkdl7T3QrhKCtlCM59k2i5CMMSIAGdqxEIwrmptzTsCEut5yilKoJLAcxCq3fe8tLCDBFwO+tKjyuxSCMdYEXoeDrHcHvu0tTwLzmwHA4N/Gh6zNCqqeOSxC2lb8tQSiMwbuqXIqAcjFh2JjBKGJyShQG6ygVbfJegULWBYcMR3rvb6oCRaQwFPgl1M5rR7/JtBZOIZWx/0+s4QeY5z/1/X2tFnAxPpFELaVkdLN8MWGVr4pCBsfMHN8bmTKfCjZ0Ncp456/x58zLzfw6Qf3ABd8pUgEYmqk5bGyek06IQl1bkXScnlN/u8L24Gdx1qVq91KQvrpgwaAAw9p+wnXPw1YjyWMGtDo2ASOFGMU7SIEUzdYD34vMPmXwLbHgdkFYAtlGiim6DpxJtvq9LtlVr/aWKEB8pUXAOOPAFPzwBTZ9r04vdQ9Ts4pAZ3cd+yHxgfMAOH+vcA69/9Uxijmz/AerYpdar1lNSMYzV+vWY/34I8DY58Gph8Bpo8A04vAFEFIknIHohGVR62QhFRSYjQE6qFri2z3iaPAhHNNlxKwArI0Q1IAxwfReacbC5gBPp66/5ICgLKCtqnsrKKlrFZUFPKOr7osMTtdsxzqQRZ93Q1MPARMPllohUxRqkEK6gShOP0S+dY2hlRv99y+ovRi7IiTnTvLqmg6xDPYpqAUgRgsoR7MxgJmgHD/c4E1FXu7FRRbvEgd7evXWlbPpp9EgUjiJpwe6zwOMlvpAWCMVusJYPIYMOlSDZRpoGiNxKzbdIQlXONMWJbGtw4svdgz3El47nzTRvPrrKptAJT6ZrzfintvAJgx4vsvdQvIXK5VYF3sUZxmJUvgA1FOvwF8spKyBtM1y6EepI4LqVMedbEaTp0EIKdPKh5FqYYqSxgo2jgFr13j6XXHnOiSZOeBVSvyC8qC2r05FVvVw9cAMAOA178AWPMp2LJaaekiCPXExwHw660n1oB/niGQazwOkkSepbJ/72I1x4CJ+cJ6lYI1riccrVicUuVSmIW82pkwnHHVOKbFsOozQGkFkwewnBES37ABYMaAX39ZAUCCb82nIlo+40p2gNnvsoKunxH1xGwA/LOzdQOQJPIuHzV2GBg7Cow7AI0l33XfjOsv6oVodes6ISbBsAZMX+kJxU56KY7pkmFVhOciuvTzSt05v0+ryuT/9gDrZNe4wPMsI7VJP3GcP7gUOOdvgL1rRYJ0ZI5IV3hV4/wrGYPPU3/AiRhYusy2K7mU999P+z90ObD7LuBZK0Xdkeq9NSX2+o4HLwfWlopFCC0fgciBMtAFC8CGrYXVoVjnU2G7rTXrzh4kfRzLY1kyGwBoeiGcPiXb5eAzdXWnazPCSScb4j3xfmav8Cx2p50lAMW0VXINitCogl2r9H2dcctWwQxQsn6ZTBbMNtcgdKIbiZj51VcBk38CXPxoQcfCUg8pjcYgZScw/momACnXyr4leBhs5QaBTHpf7X8dMPYJYO8XgAv9e8QJlAZZq8D4xSuANYKPJQn0AR2AHKy1MACKe9nfFI6IEqduEWoHIJ9wlsVKLekoMCa9EAegSTYQeM4TXco2SEMkAHEbBZoj4bbYtdyCVrFqGXgTSxgXYTZeHLi9AMjEQRCVUXP/n4KUaaT8vVTi+Rtg7GPAuYcAWlMCgUVkQfJ2Q12yBvPXMwHImhDWwf81imsTiLSEvHZkr+jY/p9CQRD4p8DOBwteItai05qn31FFdfLlFxYWgCDUIkRkj/TxbCEi/89jfPZ3X2VqYSJQbmUNQY3HQT7hbv2sLoerVwKQHNEEoCsm8R4MhPRjXUGzVEIKIoY7yaEYuY4dgGb5RXruoSgtSCLLarkICQ9f6QNykGjFdjsIBaI4kGlt8W+Rg5g0HJ8qAp47nihAzFpuWtPIMBZJlASILvR6fQ0DCVbJCkJOJCqnk4pGpb99tZ8MopyiKDX7WWDiwYKXiEQOehCrgKh+eJQ+EQHo1Lby/zRlyf8TIbf9XS5ftIb8I92YugH4ay2pLusorl7dAoonWtMwQSTdOFuQSLTGHyIC8kxSIQuA4hwU2WUAoO4/grBcDbsfWElSzg+JCoYDoEGM1ixSkHzgF/wG7y8sIa3J7JPAGWuFJSQIaU01iJHUiYP4e33BrPOHmG/JMaOfTZVYRhwGav87vWKPJ9/rSH4IOGO5sITqg/ggxXs4TOaBAECbeoOsgfl+DrQShFqcEIhyyt0MbMusEkx76iAZXKM8BvXiZAGlF+KaIbaadYpem4aDgpJZQz6YJABV5VcHAJZ0v4FxX6KG5UpYs0KnqjhRuagEVgPglYAl9ciHf8mdUrJh0Qx9vkDBzBywfbkYQIGwahA/kglATsHsDzKA0BATiPyZ4NEDwIeoa/uFYKKXL2f24nQoIgd9R3yQCMTFqwIAfdBWI7+yB5ZLECYLETd85YJl+2YAUNosLIel/xYlu4Jsl6bhNhD6it4WJCvA2Zc4Gxo73RcgJeOqFmGR6rcChLYACyGojmEYdj59KnZ+tIQRhH9IvWA2hiREjDeRI9Cly7fMF3EtWRFawhQIf5IJwE56wdTIYdt7tp9ys1K8JnoJvod9Wn682PNkP4hUy1ndWgstAtBDMLYN5/6PAc5DGNoF4SrZfN+4+IhT8jqwg2Cp8ThIJ5vfSWBXAVCrWN9SMxDK+skaOvhoAc8me654pmUB3f0wyt+E8FyRAGmPlOEoiSD2qgvmAKoOm52fAuiTDHSyIRxx+lI0QxxADubfF5vffMmSajrWlP7nmZ3dSy+4r/ZzAUEHnQ8R70HsXlK+PgJsW68G4XYGZj0EY2EYATCAT6tAhmE0DXcC4faapcwMgAIfLb0kuzT9Qmw5uwAAIABJREFUSi+EfeALkSrpBovbrQDnkm8wAo8/E3i+CCsZ98NCpAp8cUekZyBavI4ET/TnaAk/RQCyAXy6uNSPA0i+wMeB6ePA5HFgZq2wpNGK3FUDAHmv3fSCe7afX8CB4UNEEOolVi/3obastNwJ9cO5BOBKEQMsAcifHWzRAigWWAlCn5K2bQYAOe1KMjTIR2kRUhKVS7IrLia0v+3xwHMZMCbYNP0KfG79zAqK5DxOvyEuWu6VD5KSHy2YAEQAfpaRdl5UkuUctIpBnCIIl4psD03FtIIP1ADAlBuJM47EqqUX3LX9kSBQcuuyftK78xUkHyQ+RLqHZ3Fv1KcgLj5kAQ1s0Qo6IA1nHhNLQzA8ZxvBXuNx8DcS5UYpNnoYxsCnUIqvZo0F3wPTMa7Hv53HOJVbS/l+5bumX7d+5WLE44hxIRJB2NMCqj9ixwuE90svWCaIA6bAp959EKeWChAyA0PTOV2unGMQveCO7bfqHbcS4rJR7Ewqnw5AWhLuImg2uFQAXAVs8RGmntW4+g2hB3P79L/EJ9zGvqrxOPibiVihAOgrWQOf/EBfBcsPNBBqW9Hv6zzGqFzmoXz3B9AePgXiq6bgiv4YOB9QHS8AfpkAFMMjrWAcQA0iO9XJiQyAnos2vV7ESHOOQfWCO7Zf7F40mZFQScRKAYBaSU6vAVcTgN7xXHiUFpDTMK2dFh56912BTiDcvpkATIXzCL4g3WXTZ4jpGfjoF/oihL+fx+0yWUABLwIwtYKKIabgCzHQvi2ggBKn0McEQDaKT5cGkIOo6SuyYzEfjQB0EM5nZgAPoxe8of3sgSqCQM3jkdFLvpRvR13+7UVRuhUFSavNO6otwp88ZZ3+t4M6HLtch6OT9AG/q9cmtf//gV1JDYcnQ2zY6/YakfSrU+Pg1M45NqPt3IEtoM7WFHokyrWKkooglCMWLYjiUXMtK3g8Uzd1WL3gDe3vRRCoUEYCwGtYFxxqgA2E/jI20F5hhmQod98BHNnlxOTig1aGiDanO21yV4DygWuB8YeB6fnC9WEtiKVVKeE0ZGiXWczeJoWMIig5a9V5DA1ANoKDeDylZ9NSXxyAsiKawrQqmCv2HVf5e8aRoxfc1n7xs+khItAUvojvyWryxVcWJZksVSyZoQRA3dcAoHzax4Gj2wtu6FVKM7gMgti02jbV476oUJJs1j/AbA1mQ3Pm8eTRsoZDtR+xZKCiEKmMXTIeXHPGdhYArX8FwG4DGMEnAHIK4yvT58nWC2b73cexaZgWWaEKgU1gjNbPP7PvOYGsUSBkv3hBtmRWNzxjTk9RWktvxp6POj0vARjY9sWkFel8RWxegjIF4RjwAOnZWMPBTGjqvHmszxJOBUD3xyznL2bqROvoP3N3q84jG4C7M/PpcvMBef0cvV9k6hXv+2Yno5QfGArRbaCC0mWv2YtF3ecerNDhkNZIIsXQRv5dlTtGADJSz2gEE1EJQM//026HdIEZLC8B6A0tk0g1Ja8DuzJdphS82QBEZj5dbj7gxZN5er/IZI+67pscgE7QaDOUMyC0Wb8+gXjuR4F5J6YsaXnFhBoAGEVvUhb60jISgCQnoh/OLBgvIrL8v7DdFkEYM5dtNg97tvz5zJqzdfIBmJlPl5sP+DJP5xtW7xffnzeh7H+Z+3+RpkyWT1YxuURJYVtx6T0fCTocouQV85VkHRIGegEuEv/YKpkA/JceVmL8kv6t5/9pu62tfiPWcFQVEa0DZ9WcLJEPwMx8uvfnjT9IgZyj94t/ldeA/S9tMaGa9SNdmsIxbvVscVJ1GScoMt4UPwhAsmMZ0aXzQBsvdGRBjQz0FUpEJRAJQOq4KAnBdz+sfiPJ3bOYn8fsykyVWMfiN3BOzckS+QDMzKe7OW/88aqQzsfE5kH1fvGjeQ0wADodmVGwOeiMsUqHrGOnS4UFy9P/wAEojkEnI+IqOIJQNLgpCXhcmLAtD/D+kgQE235L93tj+YBqgTX9BiCeW/NedT4AmQ+YkU/3sbzxBymQuZhm8g1T+QbV+wWFdjKO/Te2mEFNlCb6gPF708VJ1TXHgKd91GnZpDfi1k/gM2vqU3DUnCuBmNQe3P9vw6pe229KOvB0K1k+ZS+rnrfM2AlA3JMZtah/EZKZT3drxuDz1O/yxAwu9JgJxr3lQfR+8aa8Buy/wdWQZAVl+ZzCrG3q9c/YrkmHy3IRYryAAqAkEBIlopJxNNUbER+fA/H+/+AAdP9PmS9dazicJybm7mlB8nR2dI1HvgVkOlZGPt2nM29GCamcGZjAwlQ+vvrV+8X/zGsAAUiLVPp/wd+zaTMFWw+/kAA0GQQnpCw5mDsAMIrcRB5mC/+MAffTwgfwKY2KfmCZ6ZIkUShrxXxBX4yYaV8Hzmcn13jUA8CMfDqWYeQcSkhVOl8U6uxH7xekrsg49h8oiCENgC5TUG5vKxxT8f2aRtOtcAKQ1s8soPuOVUIwpchNlEEIOyNSIrrvv3hwnckWIZPZsnbcDyzTpvg3lU8mpZQqozyfK74aj3wAKh1LgrsD5tMxiz/nkGD1sHq/YNFOxkEAcuW7oqmXlisuQOT7VV2jwi/kTgj1RkoZhBje8Z83SCAEEJZW0C3gff8tADCt4VASaWIBK0HI9q8BF5yUAMzIp8tNx5Jg9bB6v/jdDPSRns0BWIZeUitIo9IhHmhXTvzCPQddccnZ76U1V/IvC4SBCFyg26DFNg7c++Mhhb6qiCikT7WVUmr6lYn2nRKyrdZ51GMBlZIc07GUBdMjny6XCiUmpA6j94vMZbgBMFo552pu27PXAqXTyAUQcitOQjAm9xX0N9pIwIPmSCmH5QuPqER0L4kDYgp9zOUL6fYxkbZcFceyAreAF3GlV+NRDwAz8uksnT3jiILVSmpWNlhMze+k94vMZfgGAPJeHDjpCrgM01Tdry9OzvmYAzAqLVWIwEShwzbRwwSEn+MqP6bQK5tZlWyhjCCCsC19Xv7gOnBRbgp7cu/5AOyVjqVMmA75dJZ9nHF0yohWNlhMxKnS+0XmMtwAmFq4imnYbrEqNJPc+9kfd62RKh0On8qV9hXZ9askEPgAfI56ziocUgVbzGT28lEtRMoKtg7lBHtznfZNA+CQ+XQWM8k4uglWK/NLYKzS+8U9GReXD0g/Tyvh4Ne17Yb4Zbr6g6y7/aNWcoPpjKRTsJIags5IJwkEAv6en05S6GUBfRWsUExZyVZVQCQwrgN7Wfdd41GPBczIp8ODeXfTSbBa6YYxlY8/p3q/udc3C+jTbtvqt2oadnB2m4oNgMn0W0p+hYWHWbwg9yU/0Kb9EIy+5y2hiCit4UgKyTeAkN8Valk4Le/ldlONRz4AWWBRM6fdIPfHstw/G+SE5rMnVQ/kA5AkLHS0ak7V7reXfhgACaBqDtD3e/nmc5k9kA/A80JReq+U38zGVp3ObJo/BvAOD3dtwiWar9zEHsgHIGlFubqSx7+Jja36anLLcDvvgwA+NDpDfILv+qlzuXwAXuSjrkKemlO2e3U1uWUYnL8dwB/5e2apca9LNv+vsQfyAUheX4VguB+mzIsaG9ntqxhF4Xbe3QD+n7/uHLAW9wQ1tblMRQ/UA0CaHC7plXEh+q4T0OWcfhleYTSHBK0EH/mi+fcRuKQn4I6fWpeoB4AevCz3HOOm9yb3F5mBlZBNclYCj1aRfyfrbgPCTR6AzK+vD4CyglX7jpmN7HY66d1E0ctdIrEEE4wEIMlam+Pk7YF6AMj7EwAVbU82vTerCwhAXopJN9zVI+AYrOeULLZgErY2x8nZA/kAJGWr0naUWdFpy2cT+oCWjpdjLFxE5UzYIBBpEUX5nLnlvAktb76SPVAfAOUHpiAMm96bsVtCAMaKALICMyxDq6cXfycA+b/mOLl6oF4AiqBRIEzBp7/X2Af0+fi1XIioMIlAI+AIPIGPmeROWV3j1Zuvyu2B+gHoFfZiDS2lC0LiY52WUADkQoTTMH1BFSYRdHoRfKSu5v9qrizMHYPT+vx6ARhSuDcAzzmDo5ZGHT1PAKYMwQxME2jiSo/gEwBrrq+u41ZOy++oD4BaCcsXTPiSI3ey8s4KGoG8QwCMFM+0ggQhLR0BF19SXuD/ayakz7uR0/TsMcxg3SjfqWNA0hsrga/ojaq/8WPcC+YIk4Ke4CMSuB2XVht1Oj8zIfXlU8BtU8DhmYRXWdfrdF1fgr3+S8At48CD04DVjXQSDO70PTUnaJ5uOCwsIIFHSSFy1pKPWCDsZxCpw8UVgKSPxLXM937OzxxAljzcPAbcswU4Qh4V3UN8mKoeKm/bu78IfKJQa8VD48CylHQiL3O3/qg5Rf30BKACMtJXjXKQcfBSK8Dfqc3KVCwuN2VFGRnm/yKZtq4Re5ifyQQgM2A+BeB3GHaZBo5MAIue0l7Kt3cC4xhw+5eL7TuCkJk1jBtyerbUfYG5ExjZ/pqrxE5fAOrOq5SmowVIrRp1IyT2R6+fg0bgVYG4CsyZe2UsaiOGKXr4Sfp9k8CxCYAFSKyvXeY1o1BxQux91yMtfsHPutgnnyUuUvhc0ZsgUXib+nVkq6+ZKaABIHsgVZnuwD9sVo66rrR4ImdhLGSQ8zPL/JgBQxeU1ouWkO9PTgDzbgmXxrzMkatl3keivfG5x4r4IRcz5BfkO5vEZ0kgpIfBZ8yKjlL17syy0tMNcOn9dl4Fy6dLFabj1Mpvow9Ify+I4Nlo9Xt+ZqU9VdJpqZh4QDDyxUyYOYJwHDg+DhgI/WUVZl7aSEt93+GO9Ia2iuZKOfA7lhp9JpvAVy61w2mOwO5hmCgMHC1H9O24gu6UD9jP+ZmbtLRaSsei9SL4XDPbAEh/kGQ/pSUcc0lbApFWb67lQUhpVnLBsoKqqZclFMmUtrxPcwxl3X7vOCAtYLSCcugFQmqhdssH7HU+RznjiOlYXA8wqkOfkItTAom+oKygca4ES8jY+N3z7fSG4hfUtp3ihUHruVSsFy1iRvNP+1N7A5BdJACmVpAgZPhGOyCigEjlPLudn7kvFtOxuB4g6OjD8UWLRkCZFRwrLCEXJQQhp2K+37lQeBCRX1A7KPQto1prFEmSYn2mB9EAsO+kYfk8KQhZF8yjVz5gp/MztyOUjiW9bCUhEBhKRCCgSis45uQ/PhX/xfFWMgOnWu2gxB0TF/o0kEZ/kCDM1Ts+3RHYnwVUL6XhDFrAswfIB6w6P1MrTulY0sum1VICglKwCEACqvQFCUK3gHcsFQCM/ILayqP1k9JshVqrncMalOYYvgcGAyCvIwuod8YBJQmZpmGJeyRwkGw4n8jJOJQNw3idLFhMRNB0SgASTJyKoy/4ieXCeFfJBUeV2SoAclFyR0bbm1OHTUiN0/DTAwD7zQeM52dqj8VsGEkVE2jKetG7AEhQ0frJAv6RC0trC1skl+IWlNinGLbSaZg7Mc0xfA8MbgF1LQV1z08A2G8+oM7PVF9Ms2GUE0gQyp+Lwu2yagLgR9ZaYpkSypQ6a6Q2DCqzpkvietXIFdoZfuieGmcOD0DeP0HEbBhNwYPmA/L8zJQsATAKnguEqS+XTqkE4YfWWwCUFZTksYAYwZfIBeN9Tw0cjOwu8gDIZqsoSSvhEeQDiiGYFoyWiSDRypWgi69UP5sc5fIcquSCNeXqe2X9ZAHfM7Khe2pcOB+AT41+aO5iRD3QAHBEHd9ctuiBBoANEkbaAw0AR9r9zcUbADYYGGkPNAAcafc3F28A2GBgpD3QAHCk3d9cvAFgg4GR9kADwJF2f3PxBoANBkbaAw0AR9r9zcUbADYYGGkPNAAcafc3F28A2GBgpD3QAHCk3d9cfOxqYJ2au9RdPtdp/khoEOlglDYT39V1PzQFXLsMXAlgt9PCxJKPbufyf8/KHIPfBPAZABf79Xc5XQ0ZQ1Q7360NbxoHrlsDvs5ZRsgo0une06by6X1mZvtP99PNAp4F4LsBXA5gjw8EGTeqaGF4QhzQF80CX7cAvGIdeDYAfhdZ2sTKUcVrpE7nd31N5gj8e2dIo2osk7NZpMdK0Z19tv+bJ4F9K8D1ACj8yfNSikHeg+5Z969m57Y/8/ZP+dPLKZhP/rcA+AYAF7g1oRUhEMUzFMt6eSJfX78b2DkPfM0i8GIAX+uWlAMppreUUErn8p2gzTl+2flg/sDbTkvIOik+CP20//mzwAXzwDcCuNTPJeFXpEpM6QEjIHm/zTF8D7T5gATYNQCe69aAloRTGulfBESBSYNyxR5g/Bhw7hKwZwl4vk9LnM5JmsBzUyDGAX3B8G23Mz/g9BuUa/0IiutfMkj7zwKmngAuXSvOpUvAWYBtF4BTnspIj/O8zPaf7qdvWITw6eZA0JLQEhKEGgxZhUj/dz3NzSKwbR44exnYvVKcy+mM5Km0JhxInUtrGkmzCPicg3W5LMGkQiZZTm9xS9Z3+4m2o8C5c4X15pTKW2Lb+fCx7WLtjYxzqiql29Icw/dA5SqYf6RTTilg+lYCIXmICKQ4IK9wxfSJY8AZK8CuFWDnanEua9ZTAMsaCog3Dt92O/MvnRGBtGwkqKRmMEkqCaa+2k+0LQDTh4rP88UHj74kF1WaATo9QHQ7mmP4HugYhtEKj4PB6ZQ+FS0hQahpldPya1kXTOqNY8DscgG+HavAttUCvBxInitrkgL4lcO33c7spBdM3kAuSnq2nx9gQfAh4JyVwvrxwel2z3p4aMlzH6DM2z/lT+8aB+Q/OT4EEqckWQSBkGD6EQKQnDCLwBSnYgcf32fXioGUFawC4esyu7CXXnDP9tOCsyD4KLB1rmgvX7zfbu2WG/Jtme0/3U/vKxBNAMoi0KcjkATCN3HOEr3UAjDrwOP71rXixYEkeKMFlSX8ocwR6KUXTJ7AaNE2tF8WfA4Ye7Kw1mwvX/yZn+eKnvcrfzC6IK/ObP/pfnpfAGQnySoISBqUXyAASS1AK0JfagWYcRDOrAF66TxZQU7jBOEbM0egH71gcgXSFZAV54NQtj9YcNIpbONCyh8Ygi8CVospApDuB63g92W2/3Q/vW8AsqM4gLIKBBIH8bcJwMCNMX68BTqBb8s6sGWtsIA6jwDk662ZI9CvXjA5A6NVa2t/IAicnC/aGV+8T74IQPm/AmGuBc+8/VP+9IEAyLslAKMV/LgAyIUInfnjwPQqMOOgI/DstQ5Mr7UAqMF8V2YXDqoXXNl+EQQ6N9v29aKdesUpWJZbAPyPme0/3U8fGIDssDid/pUASCvCaXgJmFguAEfgEXT27gDkuwaUg/nbmSMwjF7whvbLhSDL5TwwvdRqo9oqHzACkCB8U2b7T/fThwIgO01T1IMCoAZxGRhbKoAXQUcQTjkI+a4B5e5FzjGsXvCG9gdqrLGFYrpVG/UuHzBOw2/LaXxzbh43DKeoJwlAHqLndSs4udoCoIBHQE45EPk3DuitmYOQoxdctp8+rFwIWsGFYiFFoLGNchcEQC6e+OJC5J2Z7T/dTx/aApYdJ37AyJK/DIwvFxYvWr0IwEn/H1Opco5sveDUhSAAF4HJpQJkWixp6k2n4IYfMGf0amDHev2I8+l4/UbvNw8Eozw72wJePOJ8und7EkKj9ztKGA1/7WwATo44n45pWI3e7/AAGPWZ2QBkYHCU+XTMfGGQmYIxjd7vqOE0+PXzATjifDrKtTZ6v4MP/MlyRj4AR5xPF+VaqZLJF1UzKdPV6P2eLDDr3I58AI44n07ZMARbo/d78gMubWE+AEecT8e9YOn2Uheu0fs9tUCYD8AR59MpG6bR+z21gKfW1gNAz4geRT5dTEZo9H5PPRDmAzBmRM8BJzqfLiYjSKKr0fs9dYBYDwBHmE9XtRfMsIz04aQZ1+j9npygrA+Akqs8wfl0BCCTWRq935MTYL1aVQ8Ao1zlAnAi8+kEQGZTNXq/vYb75Pt/fQAcUT5dBGCj93vyAaxXi+oDoFLyT3A+3Rcavd9eY3xS/z8fgCQX/LPR3SOzkon55jg1eyAfgD8M4NcAPD6aDmBtB1e4NMDNcer1QD4AbwbwxwDe4UvRE9wHZG1gNSXDLlwLNcep1QP5APxzzwj9IIAPnXhT5ORc5EYCA9HNcWr1QD4AmRH6FQBMTSZZH98ZmD5Bh5g1FopiNns1x6nTA/kAvAfAEwDudnI+EvQxPfkEzYfaCXRSBluQMB7YHKdGD+QDsBNBH/9+AkAobqTADGK7Inw1x8nfA/kA7EXQt8kgrGAGMfBxZ5Cv5ji5eyAfgL0I+r68uR0QmUFoBQU8vfNvzXHy9kA9AORoMw7CdGQCjoUZDwL4kv/+8OZ1gJhBIjGDgMh3vTavBc035/RAPgD7JegjODfhiMwgoqeJwNPPTaB6Ezq/hq+sB4AcXeXEP+ZhGVo9vRimIQD5v5oPAZCupgDI9wg8/qz/1Xz55usyeyAfgMMQ9GU2Op4eAchpOIJQQEz/VuPlm6/K7IH6AMjgGzdl6QtyX5jWjpQFevF3lq3xf6yhrOlIAUgQCojR8gmE+l9Nl2++JrMH6gEgR5UA5KYsc+AZmCbQCDi+IvgEQMob1XBEAHIajgBMLV+0kCdws6aGu3zqfkV9AGTwjftg3JRVVRAtHQEXX/wbAcoXP5d5CID8GoJKvqDAloKOoIz/y7x8c3pmD4zhaqwjRzCYyQg5gr2ZgsFTLweWr8XQgsXjbwLWrnNtMlKgNoLBmZAa7PTCAuYIBlMvlWQswwr2UlUw45jdDSx8HbD+Ctd+HVCwePKbgJV9aASDM8Yg59TWFDysYPBtmYK91IbNOHaPA/M7gUXKXA4hWDz79cA8+W0aweCMURj+1HYfcBjBYO54MMY3tGDv8I3nmWSHOzYOLJ0LLPGXAQWLz3oB8MQUsEa16kYwOG8whjh74yJkUMFgbsNlCfYO0epwissVY34bsHw2sEIRkAEEi/dcU0SP5qhF1ggG5w3GEGdXr4L5134Fg4kAjuDQgr1DtDqcUmZETwArZwAru4BVqsv0KVh8/o3F4v0QXZBGMDhvMIY4u3MYhv95Zh+Cu1xBcxuOU/HfeDIq5cv7FuwdotXhlCBXjOXZAnyrO4BV6in0IVh8wStLuWCsUAyvEQzOG5ABz+4eB+R/ewnu/kOP/3G/l4kJTERlljQtIot2e53/IwO2OPl4FLtcnCqAp9cahT56CBZf+LpSLhhz1N5qBIPzBmTAs/sLRHcTDKbiNHdBGGymOC/3hglEvgjAnoK9A7Y4+XgiV4zVWYDAs/etxaubYPFFP1QkLtCIP8neaASD8wZkwLP7AyC/tJNg8L/xLNBu+YBdBXsHbHEFAINcMVamgdWZAoRrfPdXm8KitLdmgYveWAq+2y7iMqfuRjA4b1AGOLt/APJLqwSD3+y5T1yI0AoSbAxMMzGV1o8/My2ro2DvAK2t+GgiV4zj4+3AIwDXtwBrVJeuECze+9aW4Dut4PxkIhYsdetGMDhvoDqcPRgA+SWp4O4veQ5Uv/mAGwR78+6rQq4Yq9PAOi2fA4/vBkKudKVU7VZw77uKvWFuZbtcMNb5v0YwOG9g+jx7cADyi6Pg7gccgIxlcA5TKhaD01yYKBmVFpBZMfx/m2Bvny3t8LGqoqTliZbVI+gMgHwnMAnCIFi897cLAAZ6QyzFzzSCwXkD1OPs4QDIL5XgLmk5JHk/SD5gKdibd38VcsVYGmuBTaAzEHLHgyCcaokB7/1IkUET5IKxwF5pBIPzBqbPs4cHIC/AaeqvPL9pmHxAE+zts6VdLCD/lcgVY3UyWD0Bj1ZwqgCggXA7sPfWAoAJvaEtZBrB4Lyx6efsPADyCtmCvf00s/NnOsgVY3m8BTRZPZuGBUACdArY+5lWDqGmYbIrLHEx0ggG5w1OH2fnA7CPizQfaXqgUw80AGywMdIeaAA40u5vLt4AsMHASHugAeBIu7+5eAPABgMj7YEGgCPt/ubiDQAbDIy0BxoAjrT7m4s3AGwwMNIeaAA40u5vLt4AsMHASHugAeBIu7+5eAPABgMj7YEGgCPt/ubiDQAbDIy0B8ZYNMbkX+ZekpuIiOQrPar+xs889HJg6jZg5jAwvVZ8B+ll9PlO5/Fc/o+ECjnHfi8zYfkvM5ulmp4qJXVqx5deD4zfAkw/CGxdAZgoHfuh131QkaI5hu8Bs4Ds8B0AWLnIRGCBsFfn87JffDMwdjOw5R5g8giwZa34jnQQUwDo99wBfJ4TM7COiNdlaj2rA/jeV/vfDeATAP4UGH8I2Lrc6gc+SHqY4oMZ74VSKM0xfA+UUzB/oBUUCKMl6zSQ/PsXqZD5KQC/A0w/DEwcAcYXgYnVwppwADuBkefnCim90FmBWXwnK87Uen53BI8sbuwqaz9p5UgnQhBS+ZN1zE8Ak0utviCwq8DI8/nx5hi+Bzb4gJzKZE1SEFZZgS9/2pWR/gTAJ4HJQ8DEMWB8ARhfBsaWCwDquwQKvvNgHXvOcYVbPFJPkw+dDxC/W1Y4tWDpw/Rlgo4lo1T4/KxTihDNpJwj3/UiMLXemprjffC7eWpzDN8DlYsQDiKtVxzEqoHkyX9HRizW+nIgaQnvAiaeBCbmC0s4tgSMu2rMePAR9X252jXklaTFU108K0MHav/nvJ6ZxVVk9OI7GR2IZoGQNc/HgbHgIwqILIVujuF7oOMqWFawCoRxkfEIB5CWgkREBCNf9wMTc8A4QciBWyoGz16rwNgaML5eWKpctYZL3N+TWLX0gvtuP0HHk2n16JDyxXmVhfU0qywbJbr5GSuXKxA/sV5Y9UYWdnjwyS3qKKgarWA69Wg6fjQOIK0HadnIjPVFB+AiME4AuiUkCFnESyCSkmAuU7Cjm15wX+2X2ifBRn9A8mKcW2UFjULVQcgVDl80u40SYh763FfvquhLCxitoBYUsoJfjXKttByMq9CKcHn4sPuCbgXNJwyWkECcz5Q376UX3LNncZyQAAADEklEQVT9fFgIJs6lBBwtn3Tt6FpIz4RWnuQxPh2XIGzm4CwQ9hWIFgBTK0gQHiIAJddKq0ELQh+KL1qUR4MvSEsoENIKrgALHNiMox+94K7tl9qnnMio8MSf6SNwGpYVjCDk/Ju7isq496fCqX0BkDeqlWwKwic1gAQSpzGREnFgREz01eALLvvq2Kfi45m6cf3qBXdsfxRbJMho8dimqOhEK8cXQRr9QVpvPoDNMXQP9A3ACELFxPh+jACkP0fLIKFCCRRqKuPUdqjlC9o07JZwKVNHeBC94DQcZO0XAAkmgotAk9QYrR9f/BvByYfMSATDVMzwTXMM3QMDAVAgVHCZ7/MaQK4QZUHiNCbBQlqUw74YCb7gcmYkelC9YFlwvVv7RRAorTuBkECU9asCID9/x9B935zYzyKkqpfiNHxcA0gLQgvBAaPVkCqm3h2AtC5m/RyEqzw/4xhGL3hD++MmslgqCbgUfLKAcRrmTlBzDN0DA1tAXUlWcDm1IOIIJAjlT/Fd05lbFQFwjdtgGcewesFt7Rc/Gx8iWjUCjGCT1YvWT1MwgUqrf3NG45tTbcu0aximWx9xENcEQHGbcYAEwtSXSqY0gnCdgeuMI0cvuGx/FUGgFhwEYrR80QckWN+X0fjm1DwAWv8RgJFilJZBznz0pQg+AZAAlVWh1GvGka0XzB0cCQi30aSGVa9AF62fLOB7MhrfnJoPwPER59Px+o3e76mL5Kwp2G57xPl0kxc3er+nLvyKtLmhfUC78RHn081ONnq/pzcAR5xPR9mRRu/31IVgvgUccT4dNaobvd/TGYAjzqejumqj93s6A3DE+XRUg2VSCjdaGr3fUw+I+VPwiPPpqJjO8J1Nw43e7ymHwHoAKMFd7QErAeEE5NNJMb3R+z3lsGcNzgfgiPPpomJ6o/d76oGwPgCOKJ8uKqY3er+nKwBHmE+noqRG7/fUA199U/AI8+kEwEbv93QHoEhZTnA+nYqSGr3fBoAtaiqBUImdm5hPJwA2er+nKwBHnE+X1gUzSbnR+z11wPj/AeCpPDD3t7rvAAAAAElFTkSuQmCC",EQ="uniform sampler2D weightMap;varying vec2 vOffset0;varying vec2 vOffset1;void movec(const in bvec2 c,inout vec2 variable,const in vec2 value){if(c.x){variable.x=value.x;}if(c.y){variable.y=value.y;}}void movec(const in bvec4 c,inout vec4 variable,const in vec4 value){movec(c.xy,variable.xy,value.xy);movec(c.zw,variable.zw,value.zw);}void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec4 a;a.x=texture2D(weightMap,vOffset0).a;a.y=texture2D(weightMap,vOffset1).g;a.wz=texture2D(weightMap,uv).rb;vec4 color=inputColor;if(dot(a,vec4(1.0))>=1e-5){bool h=max(a.x,a.z)>max(a.y,a.w);vec4 blendingOffset=vec4(0.0,a.y,0.0,a.w);vec2 blendingWeight=a.yw;movec(bvec4(h),blendingOffset,vec4(a.x,0.0,a.z,0.0));movec(bvec2(h),blendingWeight,a.xz);blendingWeight/=dot(blendingWeight,vec2(1.0));vec4 blendingCoord=blendingOffset*vec4(texelSize,-texelSize)+uv.xyxy;color=blendingWeight.x*texture2D(inputBuffer,blendingCoord.xy);color+=blendingWeight.y*texture2D(inputBuffer,blendingCoord.zw);}outputColor=color;}",CQ="varying vec2 vOffset0;varying vec2 vOffset1;void mainSupport(const in vec2 uv){vOffset0=uv+texelSize*vec2(1.0,0.0);vOffset1=uv+texelSize*vec2(0.0,1.0);}",TQ={LOW:0,MEDIUM:1,HIGH:2,ULTRA:3},PQ=class extends kY{constructor({preset:E=TQ.MEDIUM,edgeDetectionMode:O=tq.COLOR,predicationMode:R=iq.DISABLED}={}){super("SMAAEffect",EQ,{vertexShader:CQ,blendFunction:kX.NORMAL,attributes:zY.CONVOLUTION|zY.DEPTH,uniforms:new Map([["weightMap",new _f(null)]])});let z,V;arguments.length>1&&(z=arguments[0],V=arguments[1],arguments.length>2&&(E=arguments[2]),arguments.length>3&&(O=arguments[3])),this.renderTargetEdges=new Un(1,1,{minFilter:yi,stencilBuffer:!1,depthBuffer:!1}),this.renderTargetEdges.texture.name="SMAA.Edges",this.renderTargetWeights=this.renderTargetEdges.clone(),this.renderTargetWeights.texture.name="SMAA.Weights",this.uniforms.get("weightMap").value=this.renderTargetWeights.texture,this.clearPass=new DX(!0,!1,!1),this.clearPass.overrideClearColor=new On(0),this.clearPass.overrideClearAlpha=1,this.edgeDetectionPass=new tQ(new rq),this.edgeDetectionMaterial.edgeDetectionMode=O,this.edgeDetectionMaterial.predicationMode=R,this.weightsPass=new tQ(new tX);let j=new Sp;j.onLoad=()=>{let E=new Fn(z);E.name="SMAA.Search",E.magFilter=mi,E.minFilter=mi,E.generateMipmaps=!1,E.needsUpdate=!0,E.flipY=!0,this.weightsMaterial.searchTexture=E;let O=new Fn(V);O.name="SMAA.Area",O.magFilter=yi,O.minFilter=yi,O.generateMipmaps=!1,O.needsUpdate=!0,O.flipY=!1,this.weightsMaterial.areaTexture=O,this.dispatchEvent({type:"load"})},j.itemStart("search"),j.itemStart("area"),z!==void 0&&V!==void 0?(j.itemEnd("search"),j.itemEnd("area")):typeof Image<"u"&&(z=new Image,V=new Image,z.addEventListener("load",(()=>j.itemEnd("search"))),V.addEventListener("load",(()=>j.itemEnd("area"))),z.src=AQ,V.src=MQ),this.applyPreset(E)}get edgesTexture(){return this.renderTargetEdges.texture}getEdgesTexture(){return this.edgesTexture}get weightsTexture(){return this.renderTargetWeights.texture}getWeightsTexture(){return this.weightsTexture}get edgeDetectionMaterial(){return this.edgeDetectionPass.fullscreenMaterial}get colorEdgesMaterial(){return this.edgeDetectionMaterial}getEdgeDetectionMaterial(){return this.edgeDetectionMaterial}get weightsMaterial(){return this.weightsPass.fullscreenMaterial}getWeightsMaterial(){return this.weightsMaterial}setEdgeDetectionThreshold(E){this.edgeDetectionMaterial.edgeDetectionThreshold=E}setOrthogonalSearchSteps(E){this.weightsMaterial.orthogonalSearchSteps=E}applyPreset(E){let O=this.edgeDetectionMaterial,R=this.weightsMaterial;switch(E){case TQ.LOW:O.edgeDetectionThreshold=.15,R.orthogonalSearchSteps=4,R.diagonalDetection=!1,R.cornerDetection=!1;break;case TQ.MEDIUM:O.edgeDetectionThreshold=.1,R.orthogonalSearchSteps=8,R.diagonalDetection=!1,R.cornerDetection=!1;break;case TQ.HIGH:O.edgeDetectionThreshold=.1,R.orthogonalSearchSteps=16,R.diagonalSearchSteps=8,R.cornerRounding=25,R.diagonalDetection=!0,R.cornerDetection=!0;break;case TQ.ULTRA:O.edgeDetectionThreshold=.05,R.orthogonalSearchSteps=32,R.diagonalSearchSteps=16,R.cornerRounding=25,R.diagonalDetection=!0,R.cornerDetection=!0;break}}setDepthTexture(E,O=Qr){this.edgeDetectionMaterial.depthBuffer=E,this.edgeDetectionMaterial.depthPacking=O}update(E,O,R){this.clearPass.render(E,this.renderTargetEdges),this.edgeDetectionPass.render(E,O,this.renderTargetEdges),this.weightsPass.render(E,this.renderTargetEdges,this.renderTargetWeights)}setSize(E,O){this.edgeDetectionMaterial.setSize(E,O),this.weightsMaterial.setSize(E,O),this.renderTargetEdges.setSize(E,O),this.renderTargetWeights.setSize(E,O)}dispose(){let{searchTexture:E,areaTexture:O}=this.weightsMaterial;E!==null&&O!==null&&(E.dispose(),O.dispose()),super.dispose()}static get searchImageDataURL(){return AQ}static get areaImageDataURL(){return MQ}};var DQ="uniform float offset;uniform float darkness;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){const vec2 center=vec2(0.5);vec3 color=inputColor.rgb;\n#if VIGNETTE_TECHNIQUE == 0\nfloat d=distance(uv,center);color*=smoothstep(0.8,offset*0.799,d*(darkness+offset));\n#else\nvec2 coord=(uv-center)*vec2(offset);color=mix(color,vec3(1.0-darkness),dot(coord,coord));\n#endif\noutputColor=vec4(color,inputColor.a);}",IQ={DEFAULT:0,ESKIL:1},OQ=class extends kY{constructor({blendFunction:E=kX.NORMAL,technique:O=IQ.DEFAULT,eskil:R=!1,offset:z=.5,darkness:V=.5}={}){super("VignetteEffect",DQ,{blendFunction:E,defines:new Map([["VIGNETTE_TECHNIQUE",O.toFixed(0)]]),uniforms:new Map([["offset",new _f(z)],["darkness",new _f(V)]])})}get technique(){return Number(this.defines.get("VIGNETTE_TECHNIQUE"))}set technique(E){this.technique!==E&&(this.defines.set("VIGNETTE_TECHNIQUE",E.toFixed(0)),this.setChanged())}get eskil(){return this.technique===IQ.ESKIL}set eskil(E){this.technique=E?IQ.ESKIL:IQ.DEFAULT}getTechnique(){return this.technique}setTechnique(E){this.technique=E}get offset(){return this.uniforms.get("offset").value}set offset(E){this.uniforms.get("offset").value=E}getOffset(){return this.offset}setOffset(E){this.offset=E}get darkness(){return this.uniforms.get("darkness").value}set darkness(E){this.uniforms.get("darkness").value=E}getDarkness(){return this.darkness}setDarkness(E){this.darkness=E}};new Float32Array(3),new Float32Array(3),new Float32Array(3),new Float32Array(3),new Float32Array(3),new Float32Array(3),new Float32Array([0,0,0]),new Float32Array([1,0,0]),new Float32Array([1,1,0]),new Float32Array([1,1,1]),new Float32Array([0,0,0]),new Float32Array([1,0,0]),new Float32Array([1,0,1]),new Float32Array([1,1,1]),new Float32Array([0,0,0]),new Float32Array([0,0,1]),new Float32Array([1,0,1]),new Float32Array([1,1,1]),new Float32Array([0,0,0]),new Float32Array([0,1,0]),new Float32Array([1,1,0]),new Float32Array([1,1,1]),new Float32Array([0,0,0]),new Float32Array([0,1,0]),new Float32Array([0,1,1]),new Float32Array([1,1,1]),new Float32Array([0,0,0]),new Float32Array([0,0,1]),new Float32Array([0,1,1]),new Float32Array([1,1,1]);new Float32Array(2),new Float32Array(2);new Float32Array([0,-.25,.25,-.125,.125,-.375,.375]),new Float32Array([0,0]),new Float32Array([.25,-.25]),new Float32Array([-.25,.25]),new Float32Array([.125,-.125]),new Float32Array([-.125,.125]),new Uint8Array([0,0]),new Uint8Array([3,0]),new Uint8Array([0,3]),new Uint8Array([3,3]),new Uint8Array([1,0]),new Uint8Array([4,0]),new Uint8Array([1,3]),new Uint8Array([4,3]),new Uint8Array([0,1]),new Uint8Array([3,1]),new Uint8Array([0,4]),new Uint8Array([3,4]),new Uint8Array([1,1]),new Uint8Array([4,1]),new Uint8Array([1,4]),new Uint8Array([4,4]),new Uint8Array([0,0]),new Uint8Array([1,0]),new Uint8Array([0,2]),new Uint8Array([1,2]),new Uint8Array([2,0]),new Uint8Array([3,0]),new Uint8Array([2,2]),new Uint8Array([3,2]),new Uint8Array([0,1]),new Uint8Array([1,1]),new Uint8Array([0,3]),new Uint8Array([1,3]),new Uint8Array([2,1]),new Uint8Array([3,1]),new Uint8Array([2,3]),new Uint8Array([3,3]);new Map([[hn(0,0,0,0),new Float32Array([0,0,0,0])],[hn(0,0,0,1),new Float32Array([0,0,0,1])],[hn(0,0,1,0),new Float32Array([0,0,1,0])],[hn(0,0,1,1),new Float32Array([0,0,1,1])],[hn(0,1,0,0),new Float32Array([0,1,0,0])],[hn(0,1,0,1),new Float32Array([0,1,0,1])],[hn(0,1,1,0),new Float32Array([0,1,1,0])],[hn(0,1,1,1),new Float32Array([0,1,1,1])],[hn(1,0,0,0),new Float32Array([1,0,0,0])],[hn(1,0,0,1),new Float32Array([1,0,0,1])],[hn(1,0,1,0),new Float32Array([1,0,1,0])],[hn(1,0,1,1),new Float32Array([1,0,1,1])],[hn(1,1,0,0),new Float32Array([1,1,0,0])],[hn(1,1,0,1),new Float32Array([1,1,0,1])],[hn(1,1,1,0),new Float32Array([1,1,1,0])],[hn(1,1,1,1),new Float32Array([1,1,1,1])]]);function rT(E,O,R){return E+(O-E)*R}function hn(E,O,R,z){let V=rT(E,O,.75),j=rT(R,z,.75);return rT(V,j,.875)}var RQ=class{constructor(E,O){this.enabled=!1;this.effect=new E(O),Object.defineProperty(this,"opacity",{enumerable:!0,set(E){this.effect.blendMode.opacity.value=E},get(){return this.effect.blendMode.opacity.value}}),Object.defineProperty(this,"blendFunction",{enumerable:!0,set(E){this.effect.blendMode.setBlendFunction(Number(E))},get(){return this.effect.blendMode.blendFunction}}),this.blendFunction=kX.NORMAL}};var LQ=class extends RQ{constructor(){super(oQ),this.blendFunction=kX.SCREEN}set intensity(E){this.effect.intensity=E}get intensity(){return this.effect.intensity}set luminanceThreshold(E){this.effect.luminanceMaterial.threshold=E}get luminanceThreshold(){return this.effect.luminanceMaterial.threshold}set luminanceSmoothing(E){this.effect.luminanceMaterial.smoothing=E}get luminanceSmoothing(){return this.effect.luminanceMaterial.smoothing}set blurScale(E){this.effect.blurPass.scale=E}get blurScale(){return this.effect.blurPass.scale}set kernelSize(E){this.effect.blurPass.kernelSize=E}get kernelSize(){return this.effect.blurPass.kernelSize}};var BQ=class extends RQ{constructor(){super(hQ)}set contrast(E){this.effect.uniforms.get("contrast").value=E}get contrast(){return this.effect.uniforms.get("contrast").value}set brightness(E){this.effect.uniforms.get("brightness").value=E}get brightness(){return this.effect.uniforms.get("brightness").value}};var zQ=class extends RQ{constructor(){super(mQ),this.effect.offset=new bn(.01,.01)}set offset(E){this.effect.offset.set(E[0]/1e3,E[1]/1e3)}get offset(){return[this.effect.offset.x*1e3,this.effect.offset.y*1e3]}};var FQ=class extends RQ{constructor(){super(dQ)}};var NQ=class extends RQ{constructor(){super(xQ);this._hue=0}set hue(E){this._hue=E,this.effect.setHue(E)}get hue(){return this._hue}set saturation(E){this.effect.uniforms.get("saturation").value=E}get saturation(){return this.effect.uniforms.get("saturation").value}};var UQ=class extends RQ{constructor(){super(wQ),this.blendFunction=kX.OVERLAY}};var kQ=class extends RQ{constructor(){super(OQ)}get eskil(){return this.effect.eskil}set eskil(E){this.effect.eskil=E}get darkness(){return this.effect.uniforms.get("darkness").value}set darkness(E){this.effect.uniforms.get("darkness").value=E}get offset(){return this.effect.uniforms.get("offset").value}set offset(E){this.effect.uniforms.get("offset").value=E}};var VQ=class extends RQ{constructor(E){super(vQ)}set focalLength(E){this.effect.circleOfConfusionMaterial.uniforms.focalLength.value=E/2e3}get focalLength(){return this.effect.circleOfConfusionMaterial.uniforms.focalLength.value}set focusDistance(E){this.effect.circleOfConfusionMaterial.uniforms.focusDistance.value=this.isPerspectiveCamera?E/2e3:(E+992)/2e3}get focusDistance(){return this.effect.circleOfConfusionMaterial.uniforms.focusDistance.value}get bokehScale(){return this.effect.bokehScale}set bokehScale(E){this.effect.bokehScale=E}setCamera(E){let O=!1;(E.isPerspectiveCamera&&this.isPerspectiveCamera===!1||!E.isPerspectiveCamera&&this.isPerspectiveCamera===!0)&&(O=!0),E.isPerspectiveCamera?(this.effect.circleOfConfusionMaterial.adoptCameraSettings(E.perspCamera),this.isPerspectiveCamera=!0):(this.effect.circleOfConfusionMaterial.adoptCameraSettings(E),this.isPerspectiveCamera=!1),O&&this.effect.setChanged()}};var jQ=class extends RQ{constructor(){super(_Q)}get granularity(){return this.effect.getGranularity()}set granularity(E){this.effect.setGranularity(E)}};var GQ="#define GLSLIFY 1\nvarying vec2 vUv;varying vec2 vTexCoords[9];uniform vec2 resolution;void main(){vUv=position.xy*0.5+0.5;vec2 texelSize=vec2(1.0)/resolution;vTexCoords[0]=vUv+vec2(-texelSize.x,-texelSize.y);vTexCoords[1]=vUv+vec2(0.0,-texelSize.y);vTexCoords[2]=vUv+vec2(texelSize.x,-texelSize.y);vTexCoords[3]=vUv+vec2(-texelSize.x,0.0);vTexCoords[4]=vUv+vec2(0.0,0.0);vTexCoords[5]=vUv+vec2(texelSize.x,0.0);vTexCoords[6]=vUv+vec2(-texelSize.x,texelSize.y);vTexCoords[7]=vUv+vec2(0.0,texelSize.y);vTexCoords[8]=vUv+vec2(texelSize.x,texelSize.y);gl_Position=vec4(position.xy,1.0,1.0);}";var HQ="#define GLSLIFY 1\n#include <common>\nvarying vec2 vUv;varying vec2 vTexCoords[9];uniform sampler2D inputBuffer;uniform sampler2D historyBuffer;uniform sampler2D velocityBuffer;uniform sampler2D depthBuffer;uniform vec2 resolution;\n#define USE_YCOCG\n#define USE_CATMULL_ROM\nconst float feedback_min=0.5;const float feedback_max=0.95;vec3 RGB_YCoCg(vec3 c){return vec3(c.x/4.0+c.y/2.0+c.z/4.0,c.x/2.0-c.z/2.0,-c.x/4.0+c.y/2.0-c.z/4.0);}vec3 YCoCg_RGB(vec3 c){return clamp(vec3(c.x+c.y-c.z,c.x+c.z,c.x-c.y-c.z),vec3(0.0),vec3(1.0));}vec4 sample_color(sampler2D tex,vec2 uv){\n#ifdef USE_YCOCG\nvec4 c=texture(tex,uv);return vec4(RGB_YCoCg(c.rgb),c.a);\n#else\nreturn texture(tex,uv);\n#endif\n}vec4 sample_catmull_rom(sampler2D tex,vec2 uv,vec2 texSize){vec2 samplePos=uv*texSize;vec2 texPos1=floor(samplePos-0.5)+0.5;vec2 f=samplePos-texPos1;vec2 w0=f*(-0.5+f*(1.0-0.5*f));vec2 w1=1.0+f*f*(-2.5+1.5*f);vec2 w2=f*(0.5+f*(2.0-1.5*f));vec2 w3=f*f*(-0.5+0.5*f);vec2 w12=w1+w2;vec2 offset12=w2/(w1+w2);vec2 texPos0=texPos1-1.0;vec2 texPos3=texPos1+2.0;vec2 texPos12=texPos1+offset12;texPos0/=texSize;texPos3/=texSize;texPos12/=texSize;vec4 result=vec4(0.0);result+=texture2D(tex,vec2(texPos12.x,texPos0.y))*w12.x*w0.y;result+=texture2D(tex,vec2(texPos0.x,texPos12.y))*w0.x*w12.y;result+=texture2D(tex,vec2(texPos12.x,texPos12.y))*w12.x*w12.y;result+=texture2D(tex,vec2(texPos3.x,texPos12.y))*w3.x*w12.y;result+=texture2D(tex,vec2(texPos12.x,texPos3.y))*w12.x*w3.y;return result;}vec3 choose_motion_vector(){\n#ifdef CHOOSE_LONGEST_MOTION_VECTOR\nfloat longest=-1.0;vec3 v_choose=vec3(-1.0);for(int i=0;i<9;i++){vec3 v=texture2D(velocityBuffer,vTexCoords[i]).rgb;float l=length(v.xy);if(l>longest){longest=l;v_choose=v;}}return v_choose;\n#else\nfloat closest_depth=1000.0;vec2 closest_uv_offset=vec2(0.0);for(int i=0;i<9;i++){float neighbor_depth=texture2D(depthBuffer,vTexCoords[i]).r;if(neighbor_depth<closest_depth){closest_uv_offset=vTexCoords[i];closest_depth=neighbor_depth;}}return texture2D(velocityBuffer,closest_uv_offset).rgb;\n#endif\n}vec4 clipAabb(vec3 aabb_min,vec3 aabb_max,vec4 avg,vec4 input_texel){const float FLT_EPS=0.00000001;vec3 p_clip=0.5*(aabb_max+aabb_min);vec3 e_clip=0.5*(aabb_max-aabb_min)+FLT_EPS;vec4 v_clip=input_texel-vec4(p_clip,avg.w);vec3 v_unit=v_clip.xyz/e_clip;vec3 a_unit=abs(v_unit);float ma_unit=max(a_unit.x,max(a_unit.y,a_unit.z));if(ma_unit>1.0){return vec4(p_clip,avg.w)+v_clip/ma_unit;}else{return input_texel;}}vec3 clip_aabb_variance(in vec3 cOld,in vec3 cNew,in vec3 centre,in vec3 halfSize){if(all(lessThanEqual(abs(cOld-centre),halfSize))){return cOld;}vec3 dir=(cNew-cOld);vec3 near=centre-sign(dir)*halfSize;vec3 tAll=(near-cOld)/dir;float t=0.0001;for(int i=0;i<3;i++){if(tAll[i]>=0.0&&tAll[i]<t){t=tAll[i];}}if(t>=0.0001){return cOld;}return cOld+dir*t;}void main(){vec3 v=choose_motion_vector();vec2 velocity=v.rg;vec2 previousPixelPos=vUv-velocity;vec4 currentColor=sample_color(inputBuffer,vUv);\n#ifdef USE_CATMULL_ROM\nvec4 previousColor=sample_catmull_rom(historyBuffer,previousPixelPos,resolution);\n#else\nvec4 previousColor=sample_color(historyBuffer,previousPixelPos);\n#endif\n#ifdef USE_YCOCG\npreviousColor=vec4(RGB_YCoCg(previousColor.rgb),previousColor.a);\n#endif\nvec4 ctl=sample_color(inputBuffer,vTexCoords[0]);vec4 ctc=sample_color(inputBuffer,vTexCoords[1]);vec4 ctr=sample_color(inputBuffer,vTexCoords[2]);vec4 cml=sample_color(inputBuffer,vTexCoords[3]);vec4 cmc=sample_color(inputBuffer,vTexCoords[4]);vec4 cmr=sample_color(inputBuffer,vTexCoords[5]);vec4 cbl=sample_color(inputBuffer,vTexCoords[6]);vec4 cbc=sample_color(inputBuffer,vTexCoords[7]);vec4 cbr=sample_color(inputBuffer,vTexCoords[8]);vec4 cmin=min(ctl,min(ctc,min(ctr,min(cml,min(cmc,min(cmr,min(cbl,min(cbc,cbr))))))));vec4 cmax=max(ctl,max(ctc,max(ctr,max(cml,max(cmc,max(cmr,max(cbl,max(cbc,cbr))))))));vec4 cavg=(ctl+ctc+ctr+cml+cmc+cmr+cbl+cbc+cbr)/9.0;vec4 cmin5=min(ctc,min(cml,min(cmc,min(cmr,cbc))));vec4 cmax5=max(ctc,max(cml,max(cmc,max(cmr,cbc))));vec4 cavg5=(ctc+cml+cmc+cmr+cbc)/5.0;cmin=0.5*(cmin+cmin5);cmax=0.5*(cmax+cmax5);cavg=0.5*(cavg+cavg5);\n#ifdef USE_YCOCG\nvec2 chroma_extent=vec2(0.25*0.5*(cmax.r-cmin.r));vec2 chroma_center=currentColor.gb;cmin.yz=chroma_center-chroma_extent;cmax.yz=chroma_center+chroma_extent;cavg.yz=chroma_center;\n#endif\nvec4 previousColorClipped=clamp(previousColor,cmin,cmax);\n#ifdef LUMINANCE_DIFFERENCES\n#ifdef USE_YCOCG\nfloat lum0=currentColor.r;float lum1=previousColorClipped.r;\n#else\nfloat lum0=luminance(currentColor.rgb);float lum1=luminance(previousColorClipped.rgb);\n#endif\nfloat unbiased_diff=abs(lum0-lum1)/max(lum0,max(lum1,0.2));float unbiased_weight=1.0-unbiased_diff;float unbiased_weight_sqr=unbiased_weight*unbiased_weight;float k_feedback=mix(feedback_min,feedback_max,unbiased_weight_sqr);vec4 result=mix(currentColor,previousColorClipped,vec4(k_feedback));\n#else\nconst float alpha=0.1;vec4 result=mix(currentColor,previousColorClipped,1.0-alpha);\n#endif\n#ifdef USE_YCOCG\ngl_FragColor=vec4(YCoCg_RGB(result.rgb).rgb,result.a);\n#else\ngl_FragColor=result;\n#endif\n}";var WQ="#define GLSLIFY 1\nvarying vec2 vUv;void main(){gl_Position=vec4(position.xy,1.0,1.0);vUv=position.xy*0.5+0.5;}";var qQ="#define GLSLIFY 1\nlayout(location=1)out vec4 gVelocity;varying vec2 vUv;uniform sampler2D inputBuffer;void main(){gl_FragColor=texture2D(inputBuffer,vUv);gVelocity=vec4(0.0);}";var XQ=class extends lo{constructor(){super({name:"PassthroughMaterial",uniforms:{inputBuffer:new _f(null)},blending:qe,depthWrite:!1,depthTest:!1,vertexShader:WQ,fragmentShader:qQ})}set inputBuffer(E){this.uniforms.inputBuffer.value=E}},YQ=class extends wX{constructor(){super("TAAResolvePass");this.MRTCompatible=!0;this.needsSwap=!1,this.passThroughMaterial=new XQ,this.resolutionVector=new bn,this.resolveMaterial=new lo({name:"TAAResolveMaterial",uniforms:{inputBuffer:new _f(null),historyBuffer:new _f(null),velocityBuffer:new _f(null),depthBuffer:new _f(null),resolution:new _f(new bn)},blending:qe,depthWrite:!1,depthTest:!1,vertexShader:GQ,fragmentShader:HQ}),this.historyRenderTarget=new Un(1024,1024,{minFilter:yi,stencilBuffer:!1,depthBuffer:!1}),this.historyRenderTarget.texture.name="TAA.History",this.resultRenderTarget=new Un(1024,1024,{minFilter:yi,stencilBuffer:!1,depthBuffer:!1}),this.resultRenderTarget.texture.name="TAA.Output"}setSize(E,O){this.historyRenderTarget.setSize(E,O),this.resultRenderTarget.setSize(E,O)}render(E,O){this.fullscreenMaterial=this.resolveMaterial,this.resolveMaterial.uniforms.inputBuffer.value=O.texture[0],this.resolveMaterial.uniforms.velocityBuffer.value=O.texture[1],this.resolveMaterial.uniforms.depthBuffer.value=O.depthTexture,this.resolveMaterial.uniforms.historyBuffer.value=this.historyRenderTarget.texture,this.resolveMaterial.uniforms.resolution.value.set(O.width,O.height),E.setRenderTarget(this.resultRenderTarget),E.render(this.scene,this.camera),this.fullscreenMaterial=this.passThroughMaterial,this.passThroughMaterial.inputBuffer=this.resultRenderTarget.texture,E.setRenderTarget(this.historyRenderTarget),E.render(this.scene,this.camera);let R=this.renderToScreen?null:O;this.fullscreenMaterial=this.passThroughMaterial,this.passThroughMaterial.inputBuffer=this.resultRenderTarget.texture,E.setRenderTarget(R),E.render(this.scene,this.camera)}dispose(){this.resultRenderTarget.dispose(),this.historyRenderTarget.dispose(),this.resolveMaterial.dispose(),this.passThroughMaterial.dispose()}};var ZQ=class extends wX{constructor(E,O,R){super("TransmissionPass",void 0,O);this.MRTCompatible=!0;this.depthPass=new UX(E,O,{renderTarget:R.transmissionDepthTarget}),this.passThroughMaterial=new XQ,this.splineScene=E,this.needsSwap=!1}updatePasses(E){this.passThroughMaterial=new XQ,this.depthPass=new UX(this.splineScene,this.camera,{renderTarget:E.transmissionDepthTarget})}setCamera(E){this.camera=E}setScene(E){this.splineScene=E}render(E,O,R){let z=this.camera.layers.mask,V=E;V.setRenderTarget(V.transmissionRenderTarget),this.fullscreenMaterial=this.passThroughMaterial,this.passThroughMaterial.inputBuffer=O.texture[0],V.clear(),V.render(this.scene,this.camera),this.camera.layers.disable(3),this.depthPass.render(E,O,R),V.shadowMap.needsUpdate=!1,V.shadowMap.autoUpdate=!1;let j=this.renderToScreen?null:O;this.camera.layers.set(3),E.setRenderTarget(j),E.render(this.splineScene,this.camera),this.camera.layers.mask=z}};var JQ=new Wd,eZ=new lo({transparent:!0,vertexShader:"\n        void main() {\n            gl_Position = vec4(0.0);\n        }\n    ",fragmentShader:"\n        layout(location = 1) out vec4 gVelocity;\n\n        void main() {\n            gl_FragColor = vec4(0.0);\n\t\t\tgVelocity = vec4(0.0);\n        }\n    "}),tZ=class extends wX{constructor(E,O,R){super("OpaquePass",O??JQ,R);this.MRTCompatible=!0;this.originalMaterials=[];this.hasTransmissionPass=!1;this.clear=!0;this.clearColorOnly=!1;this.clearDepth=!1;this.needsSwap=!1,this.MRTCompatible=E}setCamera(E){this.camera=E}setScene(E){this.scene=E??JQ}getScene(){return this.scene}render(E,O){this.camera.layers.enable(3),this.hasTransmissionPass&&(this.originalMaterials.length=0,this.scene.traverse((E=>{E.layers.isEnabled(3)&&E instanceof GF&&(this.originalMaterials.push([E,E.material]),E.material=eZ)})),E.shadowMap.needsUpdate=!0,E.shadowMap.autoUpdate=!0),this.camera.layers.enable(8);let R=this.renderToScreen?null:O;E.setRenderTarget(R),this.clearColorOnly&&E.clear(!0,!1,!0),this.clear&&E.clear(),E.render(this.scene,this.camera),this.clearDepth&&E.clear(!1,!0,!1),this.hasTransmissionPass&&this.originalMaterials.forEach((E=>{E[0].material=E[1]}))}};var iZ=class{constructor(E,{depthBuffer:O=!0,stencilBuffer:R=!1,multisampling:z=0,frameBufferType:V=0}={}){this.renderer=E;this.helperStartIndex=0;this.copyPass=new AX;this.depthTexture=null;this.timer=new nQ;this._width=1;this._height=1;this.passes=[];this.helperPasses=[];this.autoRenderToScreen=!0;this.inputBuffer=this.createBuffer(O,R,V,z,!0,"input buffer mrt"),this.inputBufferSingle=this.createBuffer(O,R,V,z,!1," input buffer single"),this.inputBufferSingle.texture.dispose(),this.inputBufferSingle.depthTexture.dispose(),this.inputBufferSingle.texture=this.inputBuffer.texture[0],this.inputBufferSingle.depthTexture=this.inputBuffer.depthTexture,this.outputBuffer=this.inputBuffer.clone(),this.outputBuffer.name="output buffer mrt",this.outputBufferSingle=this.createBuffer(O,R,V,z,!1,"output buffer single"),this.outputBufferSingle.texture.dispose(),this.outputBufferSingle.depthTexture.dispose(),this.outputBufferSingle.texture=this.outputBuffer.texture[0],this.outputBufferSingle.depthTexture=this.outputBuffer.depthTexture,this.setRenderer(E)}get multisampling(){return this.inputBuffer.samples||0}set multisampling(E){let O=this.inputBuffer,R=this.multisampling;R>0&&E>0?(this.inputBuffer.samples=E,this.outputBuffer.samples=E,this.inputBuffer.dispose(),this.outputBuffer.dispose()):R!==E&&(this.inputBuffer.dispose(),this.outputBuffer.dispose(),console.log("creating new input buffer"),this.inputBuffer=this.createBuffer(O.depthBuffer,O.stencilBuffer,O.texture.type,E,!0,"new input buffer"),this.inputBuffer.depthTexture=this.depthTexture,this.outputBuffer=this.inputBuffer.clone())}getTimer(){return this.timer}getRenderer(){return this.renderer}setRenderer(E){if(this.renderer=E,E!==null){let O=E.getSize(new bn),R=E.getContext().getContextAttributes()?.alpha??!1,z=this.inputBuffer.texture[0].type;z===wi&&E.outputEncoding===Yr&&(this.inputBuffer.texture[0].encoding=Yr,this.outputBuffer.texture[0].encoding=Yr,this.inputBuffer.dispose(),this.outputBuffer.dispose(),console.log("doing some kinda dispose??")),E.autoClear=!1,this.setSize(O.width,O.height,!1);for(let O of this.passes)O.initialize(E,R,z)}}replaceRenderer(E,O=!0){let R=this.renderer,z=R.domElement.parentNode;return this.setRenderer(E),O&&z!==null&&(z.removeChild(R.domElement),z.appendChild(E.domElement)),R}createDepthTexture(){let E=this.depthTexture=new kd(this._width,this._height);return this.inputBuffer.depthTexture=E,this.inputBuffer.stencilBuffer?(E.format=ji,E.type=zi):E.type=Di,E}deleteDepthTexture(){if(this.depthTexture!==null){this.depthTexture.dispose(),this.depthTexture=null,this.inputBuffer.depthTexture=null,this.inputBuffer.dispose();for(let E of this.passes)E.setDepthTexture(null)}}createBuffer(E,O,R,z,V,j){let Y,ee=this.renderer,se=ee===null?new bn:ee.getDrawingBufferSize(new bn),he={minFilter:yi,magFilter:yi,wrapS:ui,wrapT:ui,stencilBuffer:O,depthBuffer:E};return z>0?(Y=new Un(se.width,se.height,he),Y.samples=z):(V?(Y=new Gn(se.width,se.height,2,he),Y.texture[1].type=Oi):Y=new Un(se.width,se.height,he),Y.depthTexture=new kd(2048,2048),Y.depthTexture.type=Ii),R===wi&&ee!==null&&ee.outputEncoding===Yr&&(Array.isArray(Y.texture)?Y.texture.forEach((E=>E.encoding=Yr)):Y.texture.encoding=Yr),Array.isArray(Y.texture)?Y.texture.forEach(((E,O)=>{E.name=`EffectComposer.Buffer ${V} ${O}`,E.generateMipmaps=!1})):(Y.texture.name=`EffectComposer.Buffer ${V}`,Y.texture.generateMipmaps=!1),Y.name=j,Y}addPass(E,O){let R,z=this.passes,V=this.renderer,j=V.getDrawingBufferSize(new bn),Y=V.getContext().getContextAttributes()?.alpha??!1;if(E.MRTCompatible&&(R=this.inputBuffer.texture[0].type),E.MRTCompatible||(R=this.inputBuffer.texture.type),E.setRenderer(V),E.setSize(j.width,j.height),E.initialize(V,Y,R),this.autoRenderToScreen&&(z.length>0&&(z[z.length-1].renderToScreen=!1),E.renderToScreen&&(this.autoRenderToScreen=!1)),O!==void 0?z.splice(O,0,E):z.push(E),this.autoRenderToScreen&&(z[z.length-1].renderToScreen=!0),E.needsDepthTexture||this.depthTexture!==null)if(this.depthTexture===null){let O=this.createDepthTexture();for(E of z)E.setDepthTexture(O)}else E.setDepthTexture(this.depthTexture)}setHelperStartIndex(E){this.helperStartIndex=E}removePass(E){let O=this.passes,R=O.indexOf(E);if(R!==-1&&O.splice(R,1).length>0){if(this.depthTexture!==null){let o=(E,O)=>E||O.needsDepthTexture;O.reduce(o,!1)||E.getDepthTexture()===this.depthTexture&&E.setDepthTexture(null)}this.autoRenderToScreen&&R===O.length&&(E.renderToScreen=!1,O.length>0&&(O[O.length-1].renderToScreen=!0))}}removeAllPasses(){let E=this.passes;E.length>0&&(this.autoRenderToScreen&&(E[E.length-1].renderToScreen=!1),this.passes=[])}render(E){let O,R,z,V,j=this.renderer,Y=this.copyPass,ee=this.inputBuffer,se=this.outputBuffer,he=this.inputBufferSingle,ce=this.outputBufferSingle,ue=!1;E===void 0&&(E=this.timer.update().getDelta());for(let fe of this.passes)fe.enabled&&(fe.MRTCompatible?fe.render(j,ee,se,E,ue):fe.render(j,he,ce,E,ue),fe.needsSwap&&(ue&&(Y.renderToScreen=fe.renderToScreen,O=j.getContext(),R=j.state.buffers.stencil,R.setFunc(O.NOTEQUAL,1,4294967295),Y.render(j,ee,se,E,ue),R.setFunc(O.EQUAL,1,4294967295)),z=ee,V=he,ee=se,he=ce,se=z,ce=V),fe instanceof eQ?ue=!0:fe instanceof EX&&(ue=!1))}setSize(E,O,R){let z=this.renderer;if(this._width=E,this._height=O,E===void 0||O===void 0){let R=z.getSize(new bn);E=R.width,O=R.height}z.setSize(E,O,R);let V=z.getDrawingBufferSize(new bn);this.inputBuffer.setSize(V.width,V.height),this.outputBuffer.setSize(V.width,V.height),this.inputBufferSingle.setSize(V.width,V.height),this.outputBufferSingle.setSize(V.width,V.height);for(let E of this.passes)E.setSize(V.width,V.height)}reset(){let E=this.timer.isAutoResetEnabled();this.dispose(),this.autoRenderToScreen=!0,this.timer.setAutoResetEnabled(E)}dispose(){for(let E of this.passes)E.dispose();this.passes=[],this.inputBuffer!==null&&this.inputBuffer.dispose(),this.outputBuffer!==null&&this.outputBuffer.dispose(),this.inputBufferSingle!==null&&this.inputBufferSingle.dispose(),this.outputBufferSingle!==null&&this.outputBufferSingle.dispose(),this.deleteDepthTexture(),this.copyPass.dispose(),this.timer.dispose()}};var rZ=new lo({name:"CombineMaterial",uniforms:{inputBufferA:new _f(null),inputBufferB:new _f(null)},blending:qe,depthWrite:!1,depthTest:!1,vertexShader:"\nvarying vec2 vUv;\nvoid main() {\n    gl_Position = vec4(position.xy, 1.0, 1.0);\n    vUv = position.xy * 0.5 + 0.5;\n}\n",fragmentShader:"\n    varying vec2 vUv;\n    uniform sampler2D inputBufferA;\n    uniform sampler2D inputBufferB;\n\n    // TODO: Why do we need these when postpro of framemode is enabled???\n    layout(location = 1) out vec4 gVelocity;\n\n    void main() {\n\tvec4 resA = texture2D(inputBufferA, vUv);\n\tvec4 resB = texture2D(inputBufferB, vUv);\n    float a = resA.a + resB.a * ( 1.0 - resA.a );\n\n\tvec4 res;\n\tres.rgb =  resA.rgb + (resB.rgb * (1.0 - resA.a));\n\tres.a = resA.a + resB.a * (1.0 - resA.a);\n\tgl_FragColor = res;\n    gVelocity = vec4(0.0);\n    }\n"}),cZ=class extends wX{constructor(E){super("HelperPass",void 0,E);this.MRTCompatible=!1;this.fullscreenMaterial=rZ,this.helperPass=new tZ(!1,void 0,this.camera),this.helperPass.hasTransmissionPass=!1,this.helperPass.clear=!1,this.helperPass.renderToScreen=!1,this.helperPassOnTop=new tZ(!1,void 0,this.camera),this.helperPassOnTop.hasTransmissionPass=!1,this.helperPassOnTop.clear=!1,this.helperPassOnTop.renderToScreen=!1;let O=new PQ({preset:TQ.LOW,edgeDetectionMode:tq.COLOR});this.effectPass=new XY(this.camera,O),this.rt=new Un(10,10,{minFilter:yi,magFilter:yi,wrapS:ui,wrapT:ui,depthBuffer:!0})}setSize(E,O){this.rt.setSize(E,O),this.effectPass.setSize(E,O)}set sceneHelpers(E){this.helperPass.setScene(E)}get sceneHelpers(){return this.helperPass.getScene()}set sceneHelpersOnTop(E){this.helperPassOnTop.setScene(E)}get sceneHelpersOnTop(){return this.helperPassOnTop.getScene()}setCamera(E){this.helperPass.setCamera(E),this.helperPassOnTop.setCamera(E)}initialize(E,O,R){super.initialize(E,O,R),this.effectPass.initialize(E,O,R)}dispose(){super.dispose(),this.rt.dispose(),this.effectPass.dispose()}render(E,O,R){this.rt.depthTexture=O.depthTexture;let z=E.getClearAlpha();E.setClearAlpha(0),this.helperPass.clearDepth=!0,this.helperPass.clearColorOnly=!0,this.helperPass.render(E,this.rt),this.helperPassOnTop.render(E,this.rt),this.effectPass.renderToScreen=!1,this.effectPass.render(E,this.rt,R),this.fullscreenMaterial.uniforms.inputBufferA.value=R.texture,this.fullscreenMaterial.uniforms.inputBufferB.value=O.texture,E.setClearAlpha(z),E.setRenderTarget(null),E.clear(),E.render(this.scene,this.camera)}};var mZ="#define GLSLIFY 1\n#include <skinning_pars_vertex>\n#include <morphtarget_pars_vertex>\nout vec3 n;void main(){\n#include <beginnormal_vertex>\n#include <morphnormal_vertex>\n#include <skinbase_vertex>\n#include <skinnormal_vertex>\n#include <defaultnormal_vertex>\n#include <begin_vertex>\n#include <morphtarget_vertex>\n#include <skinning_vertex>\nvec4 view_space=viewMatrix*modelMatrix*vec4(transformed,1.0);gl_Position=projectionMatrix*view_space;n=normalize(transformedNormal);}";var gZ="#define GLSLIFY 1\nin vec3 n;void main(){gl_FragColor=vec4(n,1.0);}";var vZ="#define GLSLIFY 1\nout vec2 v_uv;void main(){v_uv=uv;gl_Position=vec4(position.xy,1.0,1.0);}";var yZ="#define GLSLIFY 1\nin vec2 v_uv;const float pi=3.14159265;const float num_steps=4.0;const float num_directions=4.0;uniform float near;uniform float far;uniform float fov;uniform vec4 proj_info;uniform bool is_ortho;uniform vec2 resolution;uniform float radius_of_influence;uniform float radius_in_screen_space;uniform float exponent;uniform vec3 ao_color;uniform float bias;uniform sampler2D texture_depth;uniform sampler2D texture_normals;uniform sampler2D texture_blue_noise;uniform sampler2D texture_blue_noise_in_disk;uniform sampler2D texture_color_pass;uniform int frame_index;uniform bool fog_enabled;uniform float fog_near;uniform float fog_far;vec3 uv_to_view_space(vec2 uv,float eye_z){return vec3((uv*proj_info.xy+proj_info.zw)*(is_ortho ? 1.0 : eye_z),eye_z);}float linearize_depth(float depth_sampled){float z=is_ortho ? depth_sampled : depth_sampled*2.0-1.0;return mix((2.0*near*far)/(far+near-z*(far-near)),near+z*(far-near),float(is_ortho));}vec3 get_view_position(vec2 uv_coords){float linear_depth=linearize_depth(texture(texture_depth,uv_coords).x);return uv_to_view_space(uv_coords,linear_depth);}vec3 min_difference(vec3 p,vec3 right,vec3 left){vec3 v1=right-p;vec3 v2=p-left;return(dot(v1,v1)<dot(v2,v2))? v1 : v2;}vec3 rebuild_normal(in vec2 uv,in vec3 p){vec2 one_over_resolution=1.0/resolution;vec3 r=get_view_position(uv+vec2(one_over_resolution.x,0));vec3 l=get_view_position(uv+vec2(-one_over_resolution.x,0));vec3 t=get_view_position(uv+vec2(0,one_over_resolution.y));vec3 b=get_view_position(uv+vec2(0,-one_over_resolution.y));return normalize(cross(min_difference(p,r,l),min_difference(p,t,b)));}float falloff(float distance_squared){float neg_inv_r2=-1.0/(radius_of_influence*radius_of_influence);return distance_squared*neg_inv_r2+1.0;}float ao_contribution(vec3 P,vec3 N,vec3 S){vec3 to_sample=S-P;float norm_squared=dot(to_sample,to_sample);float norm=sqrt(norm_squared);float cos_theta=dot(N,to_sample)/norm;return clamp(cos_theta-bias,0.0,1.0)*clamp(falloff(norm_squared),0.0,1.0);}float compute_ambient_occlusion(vec2 uv,float radius_in_screen_space,vec3 pc,vec3 view_space_n){vec2 one_over_resolution=1.0/resolution;ivec2 noise_uv=ivec2(int(mod(gl_FragCoord.x,128.0)),int(mod(gl_FragCoord.y,128.0)));float noise=texelFetch(texture_blue_noise,noise_uv,0).r;noise=fract(noise+0.61803398875*float(frame_index));float theta=noise*2.0*3.1415;float ct=cos(theta);float st=sin(theta);float step_size=radius_in_screen_space/(num_steps+1.0);const float angle_step=2.0*pi/num_directions;float contribution=0.0;for(int i=0;i<int(num_directions);++i){float current_pixel=step_size+1.0;for(int j=0;j<int(num_steps);++j){int index=i*int(num_steps)+j;vec2 blue_noise_sample=texelFetch(texture_blue_noise_in_disk,ivec2(index,0),0).rg;vec2 disk_point;disk_point.x=blue_noise_sample.x*ct-blue_noise_sample.y*st;disk_point.y=blue_noise_sample.x*st+blue_noise_sample.y*ct;vec2 sample_direction=disk_point;vec2 snapped_uv=round(current_pixel*sample_direction)*one_over_resolution+uv;vec3 ps=get_view_position(snapped_uv);current_pixel+=step_size;contribution+=ao_contribution(pc,view_space_n,ps);}}float mult=1.0/(1.0-bias);contribution*=mult/(num_directions*num_steps);return clamp(1.0-contribution*2.0,0.0,1.0);}\n#define USE_GBUFFER_NORMALS\nvoid main(){vec3 view_space_p=get_view_position(v_uv);\n#ifdef USE_GBUFFER_NORMALS\nvec3 view_space_n=texture(texture_normals,v_uv).rgb;view_space_n.z*=-1.0;\n#else\nvec3 view_space_n=-rebuild_normal(v_uv,view_space_p);\n#endif\nfloat radius_ss=radius_in_screen_space/(is_ortho ? 1.0 : view_space_p.z);float ao=compute_ambient_occlusion(v_uv,radius_ss,view_space_p,view_space_n);float final=pow(ao,exponent);if(view_space_p.z>=far){final=1.0;}vec3 color=mix(ao_color,vec3(1.0),final);if(fog_enabled){float fog_factor=smoothstep(fog_near,fog_far,view_space_p.z);color=mix(color,vec3(1.0),fog_factor);}gl_FragColor=vec4(color,1.0);}";var xZ="#define GLSLIFY 1\nout vec2 v_uv;void main(){gl_Position=vec4(position.xy,1.0,1.0);v_uv=uv;}";var bZ="#define GLSLIFY 1\nin vec2 v_uv;uniform sampler2D texture_ao_lrez;uniform sampler2D texture_depth_lrez;uniform sampler2D texture_depth_hrez;uniform float near;uniform float far;float linearize_depth(float depth_sampled){float z=depth_sampled*2.0-1.0;return(2.0*near*far)/(far+near-z*(far-near));}vec2 nearest_depth_filter(in vec2 uv){vec2 resolution=vec2(textureSize(texture_depth_lrez,0));vec2 texel_size=1.0/resolution;vec2 offset=uv-0.5*texel_size;float d_hrez=texture(texture_depth_hrez,uv).r;float a=abs(d_hrez-texture(texture_depth_lrez,offset).r);float b=abs(d_hrez-texture(texture_depth_lrez,offset+vec2(texel_size.x,0.0)).r);float c=abs(d_hrez-texture(texture_depth_lrez,offset+vec2(0.0,texel_size.y)).r);float d=abs(d_hrez-texture(texture_depth_lrez,offset+vec2(texel_size.x,texel_size.y)).r);float min_diff=min(a,min(b,min(c,d)));if(min_diff==a)return offset;if(min_diff==b)return offset+vec2(texel_size.x,0.0);if(min_diff==c)return offset+vec2(0.0,texel_size.y);if(min_diff==d)return offset+vec2(texel_size.x,texel_size.y);}void main(){\n#ifdef DEBUG\nfloat d_lrez=texture(texture_depth_lrez,v_uv).r;float d_hrez=texture(texture_depth_hrez,v_uv).r;float output_d=mix(linearize_depth(d_lrez)/far,linearize_depth(d_hrez)/far,step(0.5,v_uv.x));gl_FragColor=vec4(vec3(output_d),1.0);\n#else\nvec2 filtered_uv=nearest_depth_filter(v_uv);vec4 ao=texture(texture_ao_lrez,filtered_uv);gl_FragColor=vec4(ao.rgb,1.0);gl_FragColor=ao;\n#endif\n}";var SZ=[[.478712,.875764],[-.337956,-.793959],[-.955259,-.028164],[.864527,.325689],[.209342,-.395657],[-.106779,.672585],[.156213,.235113],[-.413644,-.082856],[-.415667,.323909],[.141896,-.93998],[.954932,-.182516],[-.766184,.410799],[-.434912,-.458845],[.415242,-.078724],[.728335,-.491777],[-.058086,-.066401],[.20299,.686837],[-.808362,-.556402],[.507386,-.640839],[-.723494,-.22924],[.48974,.317826],[-.622663,.765301],[-.01064,.929347],[.663146,.647618],[-.096674,-.413835],[.525945,-.321063],[-.122533,.366019],[.195235,-.687983],[-.563203,.098748],[.418563,.561335],[-.378595,.800367],[.826922,.001024],[-.085372,-.766651],[-.92192,.183673],[-.590008,-.721799],[.167751,-.164393],[.032961,-.56253],[.6329,-.107059],[-.46408,.569669],[-.173676,-.958758],[-.242648,-.234303],[-.275362,.157163],[.382295,-.795131],[.562955,.115562],[.190586,.470121],[.770764,-.297576],[.237281,.93105],[-.666642,-.455871],[-.905649,-.298379],[.33952,.157829],[.701438,-.7041],[-.062758,.160346],[-.220674,.957141],[.642692,.432706],[-.77339,-.015272],[-.671467,.24688],[.158051,.062859],[.806009,.527232],[-.05762,-.247071],[.333436,-.51671],[-.550658,-.315773],[-.652078,.589846],[.008818,.530556],[-.210004,.519896]];var EZ=new lo({vertexShader:mZ,fragmentShader:gZ}),DZ=new lo({vertexShader:xZ,fragmentShader:bZ,uniforms:{texture_ao_lrez:new _f(null),texture_depth_lrez:new _f(null),texture_depth_hrez:new _f(null),near:new _f(null),far:new _f(null)}}),OZ=class extends wX{constructor(E,O){super("AmbientOcclusionPass",void 0,O);this.fogEnabled=!1;this.fogNear=1;this.fogFar=1e3;this.frameIndex=0;this._runHalfRes=!0;this._width=1;this._height=1;let R=1024,z=1024;this.gBuffer=new Un(R,z,{type:_M?Oi:Ii,depthTexture:new kd(R,z),minFilter:yi,magFilter:yi}),this.depthBufferHighRes=new Un(R,z,{depthTexture:new kd(R,z)}),this.aoBuffer=new Un(R,z,{minFilter:yi,magFilter:yi}),this.splineScene=E,this.splineCamera=O;let V=new Float32Array(SZ.length*2);for(let E=0;E<SZ.length;E++){let O=E*2;V[O+0]=SZ[E][0],V[O+1]=SZ[E][1]}this.blueNoiseInDiskTexture=new Zd(V,SZ.length,1,qi,Ii),this.blueNoiseInDiskTexture.wrapS=oi,this.blueNoiseInDiskTexture.wrapT=oi,this.blueNoiseInDiskTexture.needsUpdate=!0,this.hbaoMaterial=new lo({vertexShader:vZ,fragmentShader:yZ,uniforms:{near:new _f(null),far:new _f(null),fov:new _f(null),proj_info:new _f(new Nn),is_ortho:new _f(!1),resolution:new _f(new bn),radius_of_influence:new _f(8),radius_in_screen_space:new _f(1),exponent:new _f(1),ao_color:new _f(new Wn),bias:new _f(.5),texture_depth:new _f(null),texture_normals:new _f(null),texture_blue_noise:new _f(null),texture_blue_noise_in_disk:new _f(this.blueNoiseInDiskTexture),frame_index:new _f(0),fog_enabled:new _f(!1),fog_near:new _f(1),fog_far:new _f(1e3)}}),this.radius=128,this.aoColor={r:0,g:0,b:0},this.bias=.5,this.hbaoMaterial.uniforms.texture_depth.value=this.gBuffer.depthTexture,this.hbaoMaterial.uniforms.texture_normals.value=this.gBuffer.texture,this.needsSwap=!0,this.aaBuffer=new Un(R,z,{minFilter:yi,magFilter:yi,wrapS:ui,wrapT:ui,depthBuffer:!1,type:Ii});let j=new PQ({preset:TQ.ULTRA,edgeDetectionMode:tq.COLOR});this.effectPass=new XY(this.camera,j)}initialize(E,O,R){super.initialize(E,O,R),this.effectPass.initialize(E,O,R)}setBlueNoiseTexture(E){this.hbaoMaterial.uniforms.texture_blue_noise.value=E}setSize(E,O){this._width=E,this._height=O,this.depthBufferHighRes.setSize(E,O);let R=this._runHalfRes?.5:1,z=E*R,V=O*R;this.gBuffer.setSize(z,V),this.aoBuffer.setSize(z,V),this.hbaoMaterial.uniforms.resolution.value.set(z,V),this.aaBuffer.setSize(z,V),this.effectPass.setSize(z,V)}get runHalfRes(){return this._runHalfRes}set runHalfRes(E){this._runHalfRes=E,this.setSize(this._width,this._height)}setCamera(E){this.splineCamera=E}setScene(E){this.splineScene=E}setDepthTexture(E){this.depthBufferHighRes.depthTexture=E,DZ.uniforms.texture_depth_hrez.value=E,DZ.needsUpdate=!0}render(E,O,R){this.splineScene.overrideMaterial=EZ;let z=this.splineCamera.layers.mask;if(this.splineCamera.layers.set(5),E.setRenderTarget(this.gBuffer),E.clear(),E.render(this.splineScene,this.splineCamera),E.setRenderTarget(this.depthBufferHighRes),E.clear(),E.render(this.splineScene,this.splineCamera),this.splineScene.overrideMaterial=null,this.splineCamera.layers.mask=z,this.hbaoMaterial.uniforms.radius_of_influence.value=this.radius,this.hbaoMaterial.uniforms.ao_color.value.set(this.aoColor.r,this.aoColor.g,this.aoColor.b),this.hbaoMaterial.uniforms.bias.value=this.bias,this.hbaoMaterial.uniforms.fog_enabled.value=this.fogEnabled,this.hbaoMaterial.uniforms.fog_near.value=this.fogNear,this.hbaoMaterial.uniforms.fog_far.value=this.fogFar,this.hbaoMaterial.uniforms.frame_index.value=this.frameIndex,this.frameIndex++,this.splineCamera.isPerspectiveCamera){this.hbaoMaterial.uniforms.near.value=this.splineCamera.perspCamera.near,this.hbaoMaterial.uniforms.far.value=this.splineCamera.perspCamera.far;let E=this.splineCamera.perspCamera.projectionMatrix.elements,O=2/E[0],R=2/E[5],z=-(1-E[8])/E[0],V=-(1+E[9])/E[5];this.hbaoMaterial.uniforms.proj_info.value.set(O,R,z,V);let j=this.splineCamera.perspCamera.fov*(Math.PI/180),Y=this.hbaoMaterial.uniforms.resolution.value.y/(Math.tan(j*.5)*2),ee=this.hbaoMaterial.uniforms.radius_of_influence.value*.5*Y;this.hbaoMaterial.uniforms.radius_in_screen_space.value=ee,this.hbaoMaterial.uniforms.is_ortho.value=!1}else{this.hbaoMaterial.uniforms.near.value=this.splineCamera.orthoCamera.near,this.hbaoMaterial.uniforms.far.value=this.splineCamera.orthoCamera.far;let E=this.splineCamera.orthoCamera.projectionMatrix.elements,O=2/E[0],R=2/E[5],z=-(1+E[12])/E[0],V=-(1-E[13])/E[5];this.hbaoMaterial.uniforms.proj_info.value.set(O,R,z,V);let j=this.hbaoMaterial.uniforms.resolution.value.y/R*.5,Y=this.hbaoMaterial.uniforms.radius_of_influence.value*j;this.hbaoMaterial.uniforms.radius_in_screen_space.value=Y,this.hbaoMaterial.uniforms.is_ortho.value=!0}this.runHalfRes?(this.fullscreenMaterial=this.hbaoMaterial,E.setRenderTarget(this.aoBuffer),E.clear(),E.render(this.scene,this.camera),this.fullscreenMaterial=DZ,DZ.uniforms.texture_ao_lrez.value=this.aoBuffer.texture,DZ.uniforms.texture_depth_lrez.value=this.gBuffer.depthTexture,DZ.uniforms.texture_depth_hrez.value=this.depthBufferHighRes.depthTexture,E.setRenderTarget(E.aoRenderTarget),E.clear(),E.render(this.scene,this.camera)):(this.fullscreenMaterial=this.hbaoMaterial,E.setRenderTarget(this.aaBuffer),E.clear(),E.render(this.scene,this.camera),this.effectPass.renderToScreen=!1,this.effectPass.render(E,this.aaBuffer,E.aoRenderTarget))}dispose(){this.gBuffer.dispose(),this.depthBufferHighRes.dispose(),this.aoBuffer.dispose()}};var RZ="\nvarying vec2 vUv;\nvoid main() {\n    vUv = uv;\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",FZ="\nuniform sampler2D tInput;\nuniform sampler2D tMap;\nuniform vec2 resolution;\nvarying vec2 vUv;\n\nuniform vec2 uResolution;\nuniform vec2 uCoords;\n\n// Draws a rectangle at center <st> with size <size>\nfloat rectangle(vec2 st, vec2 size) {\n    size = vec2(0.5) - size * 0.5;\n    vec2 uv = vec2(step(size.x, st.x), step(size.y, st.y));\n    uv *= vec2(step(size.x, 1.0 - st.x), step(size.y, 1.0 - st.y));\n\n    return uv.x * uv.y;\n}\n\nuniform vec2 uSize;\nuniform float uScale;\nuniform float uDPR;\nuniform float uCurrent;\nuniform vec3 uSceneColor;\n\nvoid main() {\n    vec2 screenUv = gl_FragCoord.xy / uResolution.xy;\n    screenUv *= 1.0 / uDPR;\n\n    vec2 center = vec2(0.5, -0.5);\n    vec2 outsideUv = screenUv;\n    outsideUv += center;\n    outsideUv -= uCoords.xy / uResolution.xy;\n    outsideUv = (outsideUv - 0.5) + 0.5;\n    outsideUv -= center;\n    vec2 s = (uSize / uResolution) * uScale;\n    float isOutside = 1.0 - rectangle(outsideUv, s);\n    \n    vec2 mid = vec2(0.5);\n    vec2 insideUv = (screenUv - mid + s * mid) / s;\n    vec4 background = texture2D(tInput, screenUv);\n    vec4 image = texture2D(tMap, insideUv);\n    gl_FragColor = mix(image, background, isOutside);\n}\n",NZ=class extends tQ{constructor(){super(new lo({vertexShader:RZ,fragmentShader:FZ,uniforms:{tInput:new _f(null),tMap:new _f(null),uResolution:new _f(new bn),uSize:new _f(new bn),uCoords:new _f(new bn),uScale:new _f(1),uSceneColor:new _f(new On(16711680)),uDPR:new _f(1),uCurrent:new _f(0)}}),"tInput"),this.needsSwap=!0}get uniforms(){return this.fullscreenMaterial.uniforms}get texture(){return this.uniforms.tMap.value}set texture(E){this.uniforms.tMap.value=E}};var kZ="\nvoid main() {\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",VZ="\nuniform sampler2D toScene;\nuniform sampler2D fromScene;\nuniform vec2 resolution;\n\nuniform vec2 uResolution;\nuniform float uDPR;\n\nuniform float mixRatio;\nuniform sampler2D tMixTexture;\nuniform int useTexture;\nuniform float threshold;\n\nvoid main() {\n\tvec2 screenUv = gl_FragCoord.xy / uResolution.xy;\n\tscreenUv *= 1.0 / uDPR;\n\n\tvec4 texel1 = texture2D( fromScene, screenUv );\n\tvec4 texel2 = texture2D( toScene, screenUv );\n\n\tif (useTexture==1) {\n\t\t\n\t\tvec4 transitionTexel = texture2D( tMixTexture, screenUv );\n\t\tfloat r = mixRatio * (1.0 + threshold * 2.0) - threshold;\n\t\tfloat mixf=clamp((transitionTexel.r - r)*(1.0/threshold), 0.0, 1.0);\n\t\t\n\t\tgl_FragColor = mix( texel1, texel2, mixf );\n\t} else {\n\t\t\n\t\tgl_FragColor = mix( texel1, texel2, mixRatio );\n\t\t\n\t}\n}\n",GZ=[],HZ=class extends tQ{constructor(){super(new lo({vertexShader:kZ,fragmentShader:VZ,uniforms:{toScene:new _f(null),fromScene:new _f(null),uResolution:new _f(new bn),uDPR:new _f(1),mixRatio:new _f(0),threshold:new _f(.1),useTexture:new _f(0),tMixTexture:{value:GZ[0]}}}),"toScene"),this.needsSwap=!0}get uniforms(){return this.fullscreenMaterial.uniforms}get texture(){return this.uniforms.fromScene.value}set texture(E){this.uniforms.fromScene.value=E}};var qZ="\nvoid main() {\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",iK="\nuniform sampler2D inputBuffer;\nuniform sampler2D blurredInputBuffer;\nuniform sampler2D overlay;\nuniform float blurIntensity;\n\nuniform vec2 uResolution;\nuniform float uDPR;\n\nvoid main() {\n\tvec2 screenUv = gl_FragCoord.xy / uResolution.xy;\n\tscreenUv *= 1.0 / uDPR;\n\n\tvec4 texel1 = texture2D( overlay, screenUv );\n\tvec4 texel2 = texture2D( inputBuffer, screenUv );\n\tvec4 texel3 = texture2D( blurredInputBuffer, screenUv );\n\n\tfloat blurMask2 = max(sign(texel1.a), 0.0) * blurIntensity;\n    gl_FragColor = mix( mix(texel2, texel3, blurMask2), texel1, texel1.a );\n}\n",rK=class extends tQ{constructor(){super(new lo({vertexShader:qZ,fragmentShader:iK,uniforms:{inputBuffer:new _f(null),blurredInputBuffer:new _f(null),overlay:new _f(null),uResolution:new _f(new bn),uDPR:new _f(1),blurIntensity:new _f(0)}}));this._blurEnabled=!1;this.blurTarget=new Un(1,1,{minFilter:yi,magFilter:yi,wrapS:ui,wrapT:ui}),this.blurPass=new JY({width:window.innerWidth,height:window.innerHeight,kernelSize:sQ.HUGE,resolutionScale:.25}),this.blurPass.renderToScreen=!1,this.uniforms.blurredInputBuffer.value=this.blurTarget.texture}get uniforms(){return this.fullscreenMaterial.uniforms}get texture(){return this.uniforms.overlay.value}set texture(E){this.uniforms.overlay.value=E}setResolution(E,O,R=1){this.uniforms.uResolution.value.set(E,O),this.uniforms.uDPR.value=R,this.blurPass.setSize(E,O),this.blurTarget.setSize(E,O),this.blurPass.setSize(E,O)}get uiCanvas(){return this._uiCanvas}set uiCanvas(E){this._uiCanvas=E,E.texture&&(this.uniforms.overlay.value=E.texture);let O=E.frame;if(O){let E=O.data.backgroundBlur,R=E.radius;this._blurEnabled=E.enabled,this.uniforms.blurIntensity.value=this._blurEnabled?1:0,this.blurPass.scale=R/3}}render(E,O,R,z,V){this._blurEnabled&&(this.blurPass.setDepthTexture(this.getDepthTexture()),this.blurPass.render(E,O,this.blurTarget,z,V)),super.render(E,O,R,z,V)}};var aK="\nvarying vec2 vUv;\nvoid main() {\n    vUv = uv;\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",oK="\nuniform sampler2D tInput;\nuniform sampler2D tOverlayImage;\nvarying vec2 vUv;\nuniform vec2 uResolution;\nuniform vec2 uRightBottom;\nuniform vec2 uImageSize;\nuniform float uScale;\nuniform float uDPR;\n\nvec3 blendNormal(vec3 base, vec3 blend) {\n\treturn blend;\n}\n\nvec3 blendNormal(vec3 base, vec3 blend, float opacity) {\n\treturn (blendNormal(base, blend) * opacity + base * (1.0 - opacity));\n}\n\nvec4 drawFixedSizeImage(sampler2D image, vec2 screenUV, vec2 imageSize, vec2 imageCoords, vec2 screenSize, float dpr) {\n\tvec2 uv = (screenUV * screenSize * dpr - imageCoords) / (imageSize * dpr);\n\tif (uv.x < 0.0 || uv.x > 1.0 || uv.y < 0.0 || uv.y > 1.0) {\n\t\treturn vec4(0.0);\n\t}\n\treturn texture2D(image, uv);\n}\n\nvoid main() {\n    vec2 screenUV = gl_FragCoord.xy / (uResolution.xy * uDPR);\n\tvec2 imageCoords = vec2(uResolution.x * uDPR - uImageSize.x * uScale * uDPR - uRightBottom.x * uDPR, uRightBottom.y * uDPR);\n    vec4 background = texture2D(tInput, screenUV);\n    vec4 image = drawFixedSizeImage(tOverlayImage, screenUV, uImageSize * uScale, imageCoords, uResolution, uDPR);\n    gl_FragColor = vec4(blendNormal(background.rgb, image.rgb, image.a), max(background.a, image.a));\n}\n",lK=class extends tQ{constructor(){super(new lo({vertexShader:aK,fragmentShader:oK,uniforms:{tInput:new _f(null),tOverlayImage:new _f(null),uResolution:new _f(new bn),uImageSize:new _f(new bn),uRightBottom:new _f(new bn(20,20)),uScale:new _f(.25),uDPR:new _f(1)}}),"tInput")}get uniforms(){return this.fullscreenMaterial.uniforms}get texture(){return this.uniforms.tOverlayImage.value}set texture(E){this.uniforms.tOverlayImage.value=E,this.uniforms.uImageSize.value.set(E.image.width,E.image.height)}};function yL(E,O){return O&&O.enabled&&E.push(O.effect),E}var KQ=E=>Object.values(kX).includes(E)?E:kX.NORMAL,hK=class extends pn{constructor(E,O){super();this._needsDOFResize=O;this.postprocessingState=ZP.defaultData;this._scene=new Wd;this._camera=new YH;this.effects=new Map;this.blueNoiseTexture=new Zd;this._renderToScreen=!0;this._isUIOverlayEnabled=!1;this.clock=new tf,this.renderer=E,this.debug=!1,this.effects.set("bloom",new LQ),this.effects.set("chromaticAberration",new zQ),this.effects.set("vignette",new kQ),this.effects.set("noise",new UQ),this.effects.set("colorAverage",new FQ),this.effects.set("hueSaturation",new NQ),this.effects.set("brightnessContrast",new BQ),this.effects.set("depthOfField",new VQ),this.effects.set("pixelation",new jQ),this.effectComposer=new iZ(this.renderer),this.effectComposer.autoRenderToScreen=!1,this.opaquePass=new tZ(!0,this.scene,this.camera),this.opaquePass.clear=!0,this.transmissionPass=new ZQ(this.scene,this.camera,this.renderer),this.aoPass=new OZ(this.scene,this.camera),this.taaPass=new YQ,this.taaPass.renderToScreen=!1,this.helperPass=new cZ(this.camera),this.helperPass.renderToScreen=!1,this.stylesOverlayPass=new NZ,this.stylesOverlayPass.enabled=!1,this.uiOverlayPass=new rK,this.uiOverlayPass.enabled=!1,this.logoOverlayPass=new lK,this.logoOverlayPass.enabled=!1,this.sceneTransitionPass=new HZ,this.sceneTransitionPass.enabled=!1,this._initCopyPass(),this._initPasses()}set overlayTexture(E){E!==void 0?(this.stylesOverlayPass.texture=E,this.stylesOverlayPass.enabled=!0):this.stylesOverlayPass.enabled=!1}get overlayTexture(){return this.stylesOverlayPass.texture}set sceneHelpers(E){this.helperPass.sceneHelpers=E}get sceneHelpers(){return this.helperPass.sceneHelpers}set sceneHelpersOnTop(E){this.helperPass.sceneHelpersOnTop=E}get sceneHelpersOnTop(){return this.helperPass.sceneHelpersOnTop}get scene(){return this._scene}set scene(E){this._scene=E,this.opaquePass.setScene(E),this.transmissionPass.setScene(E),this.aoPass.setScene(E)}get camera(){return this._camera}set camera(E){let O=this._camera!==E;this._camera=E,this.opaquePass.setCamera(E),this.transmissionPass.setCamera(E),O&&this.transmissionPass.updatePasses(this.renderer),this.aoPass.setCamera(E),this.helperPass.setCamera(E),this.effects.get("depthOfField").setCamera(E)}updateRenderToScreen(){let E=!1;for(let O=this.effectComposer.passes.length-1;O>=0;O--){let R=this.effectComposer.passes[O];R.enabled!==!0||E||!this._renderToScreen?R.renderToScreen=!1:(R.renderToScreen=!0,E=!0)}}get isUIOverlayEnabled(){return this._isUIOverlayEnabled}disableUIOverlay(){this._isUIOverlayEnabled=!1}enableUIOverlay(){this._isUIOverlayEnabled=!0}disableHelpers(){this.helperPass.enabled=!1,this.updateRenderToScreen()}enableHelpers(){this.helperPass.enabled=!0,this.updateRenderToScreen()}updateBlueNoiseTexture(E){this.blueNoiseTexture=new Zd(E,128,128),this.blueNoiseTexture.wrapS=oi,this.blueNoiseTexture.wrapT=oi,this.blueNoiseTexture.minFilter=mi,this.blueNoiseTexture.magFilter=mi,this.blueNoiseTexture.needsUpdate=!0}setAmbientOcclusionParams(E,O,R,z,V,j,Y,ee){this.aoPass.enabled=E,this.aoPass.radius=O,this.aoPass.bias=R,this.aoPass.aoColor=z,this.aoPass.fogEnabled=V,this.aoPass.fogNear=j,this.aoPass.fogFar=Y,this.aoPass.runHalfRes!==!ee&&(this.aoPass.runHalfRes=!ee)}setTransmissionPassEnabled(E){this.transmissionPass.enabled=E,this.opaquePass.hasTransmissionPass=E}_initPasses(){if(this.uvEffectPass?.dispose(),this.effectPass?.dispose(),this.effectComposer.removeAllPasses(),this.transmissionPass.updatePasses(this.renderer),this.effectComposer.addPass(this.aoPass),this.effectComposer.addPass(this.opaquePass),this.effectComposer.addPass(this.transmissionPass),this.effectComposer.addPass(this.taaPass),this.postprocessingState.enabled){let E=[this.effects.get("pixelation")].reduce(yL,[]);E.length>0&&(this.uvEffectPass=new XY(this.camera,...E),this.uvEffectPass.renderToScreen=!1,this.effectComposer.addPass(this.uvEffectPass));let O=[this.effects.get("chromaticAberration"),this.effects.get("bloom"),this.effects.get("depthOfField"),this.effects.get("colorAverage"),this.effects.get("hueSaturation"),this.effects.get("brightnessContrast"),this.effects.get("vignette"),this.effects.get("noise")].reduce(yL,[]);if(O.length>0&&(this.effectPass=new XY(this.camera,...O),this.effectPass.renderToScreen=!1,this.effectComposer.addPass(this.effectPass),this._needsDOFResize&&this.effects.get("depthOfField")?.enabled&&window!==void 0)){let E=this.renderer.viewportWidth,O=this.renderer.viewportHeight;this.renderer.setSize(E-1,O-1),this.renderer.setSize(E,O)}}this.effectComposer.addPass(this.stylesOverlayPass),this.effectComposer.addPass(this.uiOverlayPass),this.effectComposer.addPass(this.sceneTransitionPass),this.effectComposer.addPass(this.helperPass),this.effectComposer.addPass(this.logoOverlayPass)}_initCopyPass(){if(this._savePass)return;let E=new bn;this.renderer.getDrawingBufferSize(E),this._rt=new Un(E.x,E.y,{depthBuffer:!1,stencilBuffer:!1,wrapS:oi,wrapT:oi}),this._rt.samples=0,this._savePass=new AX(this._rt,!1),this._savePass.renderToScreen=!1}setCopyPass(E){this._rt=E,this._savePass=new AX(this._rt,!1),this.renderToScreen=!1}get renderToScreen(){return this._renderToScreen}set renderToScreen(E){if(this._renderToScreen===E)return;let O=this.effectComposer;!O||(E===!0?O.removePass(this._savePass):O.addPass(this._savePass),this._renderToScreen=E,this.updateRenderToScreen())}set sceneTransitionFromTexture(E){E!==this.sceneTransitionPass.texture&&(E!==null?this.sceneTransitionPass.enabled=!0:(this.sceneTransitionPass.enabled=!1,this.updateRenderToScreen()),this.sceneTransitionPass.texture=E)}setWatermark(E){this.logoOverlayPass.enabled=E!==null,E&&(this.logoOverlayPass.texture=E)}get texture(){return this._rt&&this._rt.texture}get renderTarget(){return this._rt}updatePostprocessing(E){let{enabled:O,...R}=E,z=!1;O!==this.postprocessingState.enabled&&(z=!0);for(let E of Object.entries(R)){let O=E[1],R=this.effects.get(E[0]);if(R){R.enabled!==O.enabled&&(z=!0),R.enabled=O.enabled;for(let[E,z]of Object.entries(O))E==="blendFunction"?R.blendFunction=KQ(z):R[E]=z}}this.postprocessingState=E,z&&this._initPasses()}render(){this.effectComposer.render(this.clock.getDelta())}setScissor(E,O,R,z){E instanceof Nn?(this.effectComposer.inputBuffer.scissor.set(E.x,E.y,E.z,E.w),this.effectComposer.outputBuffer.scissor.set(E.x,E.y,E.z,E.w)):(this.effectComposer.inputBuffer.scissor.set(E,O,R,z),this.effectComposer.outputBuffer.scissor.set(E,O,R,z));let V=this.renderer.getPixelRatio();this.effectComposer.inputBuffer.scissor.multiplyScalar(V),this.effectComposer.outputBuffer.scissor.multiplyScalar(V),this.renderer.setScissor(E,O,R,z)}setScissorTest(E){this.effectComposer.inputBuffer.scissorTest=E,this.effectComposer.outputBuffer.scissorTest=E,this.renderer.setScissorTest(E)}setViewport(E,O,R,z){E instanceof Nn?(this.effectComposer.inputBuffer.viewport.copy(E),this.effectComposer.outputBuffer.viewport.copy(E)):(this.effectComposer.inputBuffer.viewport.set(E,O,R,z),this.effectComposer.outputBuffer.viewport.set(E,O,R,z))}resize(E,O,R){if(this.effectComposer.setSize(E,O,R),this._rt){let R=this.renderer.getPixelRatio();this._rt.setSize(E*R,O*R)}}dispose(){this.uvEffectPass?.dispose(),this.effectPass?.dispose(),this.effectComposer.dispose()}};var QQ=E=>`\n\n// PCSS implementation based on:\n// https://www.gamedev.net/articles/programming/graphics/contact-hardening-soft-shadows-made-fast-r4906/\n// NOTE: This number affects how big the shadow blur can\n// possibly get. Bigger number == bigger blur, but less precise results\n\nconst float  gPenumbraFilterSize = 80.0;\nconst int   gPenumbraSamples = ${E};\nconst int gShadowSamples = ${E};\nconst float gShadowSamplesRpc = 1.0f / float(gShadowSamples);\n\n#ifdef USE_SHADOWMAP\n    #if NUM_DIR_LIGHT_SHADOWS > 0\n\n        uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n        varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\n        struct DirectionalLightShadow {\n            float shadowBias;\n            float shadowNormalBias;\n            float shadowRadius;\n            vec2 shadowMapSize;\n        };\n\n        uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\n    #endif\n\n    #if NUM_SPOT_LIGHT_SHADOWS > 0\n\n        uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n        varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\n        struct SpotLightShadow {\n            float shadowBias;\n            float shadowNormalBias;\n            float shadowRadius;\n            vec2 shadowMapSize;\n        };\n\n        uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\n    #endif\n\n    #if NUM_POINT_LIGHT_SHADOWS > 0\n\n        uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n        varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\n        struct PointLightShadow {\n            float shadowBias;\n            float shadowNormalBias;\n            float shadowRadius;\n            vec2 shadowMapSize;\n            float shadowCameraNear;\n            float shadowCameraFar;\n        };\n\n        uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\n    #endif\n\n    /*\n    #if NUM_RECT_AREA_LIGHTS > 0\n\n        // TODO (abelnation): create uniforms for area light shadows\n\n    #endif\n    */\n\nfloat computePenumbra(int index, sampler2D shadowMap, float temporalAngle, float texelSize, vec2 uv, float compare, float texelScalar, float shadowRadius)\n{\n    float penumbra = 1.0;\n    float blockerDepthAvg = 0.0;\n    float blockerCount = 0.0;\n\n    #pragma unroll_loop_start\n    for(int i = 0; i < gPenumbraSamples; i ++)\n    {\n        vec2 offset = (vogelDiskSample(i, gShadowSamples, temporalAngle) * texelSize) * texelScalar;\n        float depth = unpackRGBAToDepth( texture2D( shadowMap, uv + offset ) );\n\n        if(depth < compare + 0.0001)\n        {\n            blockerDepthAvg += depth;\n            blockerCount++;\n        }\n    }\n    #pragma unroll_loop_end\n\n    if (blockerCount > 0.0)\n    {\n        blockerDepthAvg /= blockerCount;\n\n        // Compute penumbra\n        penumbra = (compare - blockerDepthAvg) / (blockerDepthAvg);\n        penumbra *= penumbra;\n        penumbra *= 200.0 * penumbraSize[min(index, 5 - 1)]; // Magic number that affects how quickly the penumbra grows\n\n        return clamp(penumbra, 0.00, 1.0);\n    }\n    return 0.0;\n}\n\nfloat vogelShadow(int index, sampler2D shadowMap, vec2 uv, float texelSize, float compare, float shadowRadius)\n{\n    float shadow         = 0.0f;\n\n    // NOTE: When using TAA, we should use screen space interleaved gradient noise\n    vec2 halton = haltonSequence[frameIndex];\n    float temporalOffset = getNoiseInterleavedGradient(gl_FragCoord.xy + halton);\n    float temporalAngle  = temporalOffset * PI2;\n\n    float texelScalar = (gPenumbraFilterSize) / (texelSize * 1024.);\n    float penumbra = computePenumbra(index, shadowMap, temporalAngle, texelSize, uv, compare, texelScalar, shadowRadius);\n    if (penumbra == -1.0) {\n        return 1.0;\n    }\n\n    #pragma unroll_loop_start\n    for (int i = 0; i < gShadowSamples; i++)\n    {\n        vec2 vogelSample =  vogelDiskSample(i, gShadowSamples, temporalAngle) * texelSize;\n        // Overall blurring offset\n        vec2 offset = vogelSample * (shadowRadius * 2.);\n\n        // Penumbra offset\n        offset += vogelSample * (penumbra * texelScalar);\n\n        shadow += step( compare, unpackRGBAToDepth( texture2D( shadowMap, uv + offset ) ) );\n    }\n    #pragma unroll_loop_end\n\n    return shadow * gShadowSamplesRpc;\n}\n\n\n    float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\n        return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\n    }\n\n    vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\n        return unpackRGBATo2Half( texture2D( shadow, uv ) );\n\n    }\n\n    float VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\n        float occlusion = 1.0;\n\n        vec2 distribution = texture2DDistribution( shadow, uv );\n\n        float hard_shadow = step( compare , distribution.x ); // Hard Shadow\n\n        if (hard_shadow != 1.0 ) {\n\n            float distance = compare - distribution.x ;\n            float variance = max( 0.00000, distribution.y * distribution.y );\n            float softness_probability = variance / (variance + distance * distance ); // Chebeyshevs inequality\n            softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 ); // 0.3 reduces light bleed\n            occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\n        }\n        return occlusion;\n\n    }\n\n    float getShadow( int i, sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\n        float shadow = 1.0;\n\n        shadowCoord.xyz /= shadowCoord.w;\n        shadowCoord.z += shadowBias;\n\n        // if ( something && something ) breaks ATI OpenGL shader compiler\n        // if ( all( something, something ) ) using this instead\n\n        bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n        bool inFrustum = all( inFrustumVec );\n\n        bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\n        bool frustumTest = all( frustumTestVec );\n\n        if ( frustumTest ) {\n\n        #if defined( SHADOWMAP_TYPE_PCF )\n\n            vec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n            return vogelShadow(i, shadowMap, shadowCoord.xy, texelSize.x, shadowCoord.z, shadowRadius );\n\n        #elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\n            vec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n            float dx = texelSize.x;\n            float dy = texelSize.y;\n\n            vec2 uv = shadowCoord.xy;\n            vec2 f = fract( uv * shadowMapSize + 0.5 );\n            uv -= f * texelSize;\n\n            shadow = (\n                texture2DCompare( shadowMap, uv, shadowCoord.z ) +\n                texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n                texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n                texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n                mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),\n                     texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n                     f.x ) +\n                mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),\n                     texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n                     f.x ) +\n                mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),\n                     texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n                     f.y ) +\n                mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),\n                     texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n                     f.y ) +\n                mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),\n                          texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n                          f.x ),\n                     mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),\n                          texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n                          f.x ),\n                     f.y )\n            ) * ( 1.0 / 9.0 );\n\n        #elif defined( SHADOWMAP_TYPE_VSM )\n\n            shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\n        #else // no percentage-closer filtering:\n\n            shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\n        #endif\n\n        }\n\n        return shadow;\n\n    }\n\n    // cubeToUV() maps a 3D direction vector suitable for cube texture mapping to a 2D\n    // vector suitable for 2D texture mapping. This code uses the following layout for the\n    // 2D texture:\n    //\n    // xzXZ\n    //  y Y\n    //\n    // Y - Positive y direction\n    // y - Negative y direction\n    // X - Positive x direction\n    // x - Negative x direction\n    // Z - Positive z direction\n    // z - Negative z direction\n    //\n    // Source and test bed:\n    // https://gist.github.com/tschw/da10c43c467ce8afd0c4\n\n    vec2 cubeToUV( vec3 v, float texelSizeY ) {\n\n        // Number of texels to avoid at the edge of each square\n\n        vec3 absV = abs( v );\n\n        // Intersect unit cube\n\n        float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n        absV *= scaleToCube;\n\n        // Apply scale to avoid seams\n\n        // two texels less per square (one texel will do for NEAREST)\n        v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\n        // Unwrap\n\n        // space: -1 ... 1 range for each square\n        //\n        // #X##         dim    := ( 4 , 2 )\n        //  # #         center := ( 1 , 1 )\n\n        vec2 planar = v.xy;\n\n        float almostATexel = 1.5 * texelSizeY;\n        float almostOne = 1.0 - almostATexel;\n\n        if ( absV.z >= almostOne ) {\n\n            if ( v.z > 0.0 )\n                planar.x = 4.0 - v.x;\n\n        } else if ( absV.x >= almostOne ) {\n\n            float signX = sign( v.x );\n            planar.x = v.z * signX + 2.0 * signX;\n\n        } else if ( absV.y >= almostOne ) {\n\n            float signY = sign( v.y );\n            planar.x = v.x + 2.0 * signY + 2.0;\n            planar.y = v.z * signY - 2.0;\n\n        }\n\n        // Transform to UV space\n\n        // scale := 0.5 / dim\n        // translate := ( center + 0.5 ) / dim\n        return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\n    }\n\n    float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\n        float shadow = 1.0;\n        vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\n        // for point lights, the uniform @vShadowCoord is re-purposed to hold\n        // the vector from the light to the world-space position of the fragment.\n        vec3 lightToPosition = shadowCoord.xyz;\n\n        // dp = normalized distance from light to fragment position\n        float compare = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear ); // need to clamp?\n        compare += shadowBias;\n\n        // bd3D = base direction 3D\n        vec3 bd3D = normalize( lightToPosition );\n\n        vec2 halton = haltonSequence[frameIndex];\n        float temporalOffset = getNoiseInterleavedGradient(gl_FragCoord.xy + halton);\n        float temporalAngle  = temporalOffset * PI2;\n\n        #if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_VSM )\n            for (int i = 0; i < gShadowSamples; i++) {\n                vec2 vogelSample = vogelDiskSample(i, gShadowSamples, temporalAngle) * texelSize;\n\n                // Overall blurring offset\n                vec3 offset = vec3(vogelSample.x, vogelSample.y, -vogelSample.x) * (shadowRadius + 5.);\n\n                // NOTE: Removed for now\n                // Penumbra offset\n                //offset += vec3(vogelSample.x, vogelSample.y, vogelSample.y)  * (penumbra * gPenumbraFilterSize);\n\n                shadow += texture2DCompare( shadowMap, cubeToUV( bd3D + offset, texelSize.y ), compare );\n\n            }\n            return shadow * gShadowSamplesRpc;\n\n        #elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n            for (int i = 0; i < 16; i++) {\n                vec2 vogelSample = vogelDiskSample(i, gShadowSamples, temporalAngle) * texelSize;\n\n                // Overall blurring offset\n                vec3 offset = vec3(vogelSample.x, vogelSample.y, -vogelSample.x) * (shadowRadius + 5.);\n\n                shadow += texture2DCompare( shadowMap, cubeToUV( bd3D + offset, texelSize.y ), compare );\n\n            }\n            return shadow * (1.0 / 16.0);\n        #else // no percentage-closer filtering\n\n            return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), compare );\n\n        #endif\n\n    }\n\n#endif\n`,cK=zc.lights_fragment_begin,dK=zc.shadowmask_pars_fragment,uK=null,$Q=E=>{switch(E){case"low":return 8;case"medium":return 16;case"high":return 32;default:return 16}},xL=(E="medium")=>{if(uK===E)return!1;uK=E;let O=$Q(E);zc.shadowmap_pars_fragment=QQ(O);let R=cK.slice();R=R.replace("getShadow( spotShadowMap[ i ]","getShadow( UNROLLED_LOOP_INDEX + 3, spotShadowMap[ i ]"),R=R.replace("getShadow( directionalShadowMap[ i ]","getShadow( UNROLLED_LOOP_INDEX, directionalShadowMap[ i ]"),zc.lights_fragment_begin=R;let z=dK.slice();return z=z.replaceAll("getShadow(","getShadow( UNROLLED_LOOP_INDEX, "),zc.shadowmask_pars_fragment=z,!0};var pK="\nattribute vec3 randomColor;\nvarying vec3 vNormal;\nflat out vec3 vColor;\n#include <skinning_pars_vertex>\n#include <morphtarget_pars_vertex>\n\t\nvoid main()\n{\n#include <beginnormal_vertex>\n#include <morphnormal_vertex>\n#include <skinbase_vertex>\n#include <skinnormal_vertex>\nvec3 transformed = vec3(position);\n#include <morphtarget_vertex>\n#include <skinning_vertex>\n\nvNormal = normal;\nvColor = randomColor;\ngl_Position = projectionMatrix * (modelViewMatrix * vec4(transformed, 1.0));\n}\n",fK="\nuniform float depthContrast;\nvarying vec3 vNormal;\nflat in vec3 vColor;\nvoid main()\n{\nvec3 normal = (normalize(vNormal)).rgb;\n\nfloat contrastDepth = (gl_FragCoord.z - 0.5) * depthContrast + 0.5;\n\nvec3 resultColor = mix(mix(vColor, normal, 0.2), vec3(contrastDepth), 0.4);\ngl_FragColor = vec4(resultColor, vColor.r);\ngl_FragColor = vec4(resultColor, vColor.r);\n}\n",mK=new lo({vertexShader:pK,fragmentShader:fK,uniforms:{depthContrast:{value:1}}});var gK=new Fn,vK=new bn,yK=class extends QS{constructor(E){super(E);this._pixelRatio=this.getPixelRatio();this.viewportWidth=1;this.viewportHeight=1;this.resolution=new bn;this.dummyCamera=new YH;this.sceneTransitionDuration=0;this.sceneTransitionTimeRemaining=-1;this.isXRCopyPassSet=!1;this.clear=(E=!0,O=!0,R=!0)=>{let z=this.getContext(),V=0;E&&(V|=z.COLOR_BUFFER_BIT),O&&(V|=z.DEPTH_BUFFER_BIT),R&&(V|=z.STENCIL_BUFFER_BIT),z.clear(V),z.clearBufferfv(z.COLOR,1,[0,0,0,1])};this.pipeline=new hK(this,E?.needsDOFResize??!1),this.autoClear=!1;let O=this.setPixelRatio.bind(this),R=this.setSize.bind(this);this.shadowMap.enabled=!0,this.shadowMap.type=Ce,this.dummyCamera.matrixAutoUpdate=!1,this.domElement.removeAttribute("data-engine");let z=this.getContext();if(z&&"drawingBufferColorSpace"in z)try{z.drawingBufferColorSpace="display-p3"}catch(E){console.warn(E)}this.setPixelRatio=E=>{this._pixelRatio!==E&&(this._pixelRatio=E,O(E))},this.setSize=(E,O,z=!0)=>{(this.viewportWidth!==E||this.viewportHeight!==O)&&(this.viewportWidth=E,this.viewportHeight=O,R(E,O,z),this.normalRenderTarget?.setSize(E*this._pixelRatio,O*this._pixelRatio),this._resizeTransmission(E,O),this.transmissionDepthTarget?.setSize(E*this._pixelRatio/2,O*this._pixelRatio/2),this.pipeline.resize(E,O,z))},this._superDispose=this.dispose,this.dispose=this._currentDispose}createAORenderTarget(){this.aoRenderTarget===void 0&&(this.aoRenderTarget=new Un(this.viewportWidth*this._pixelRatio,this.viewportHeight*this._pixelRatio,{generateMipmaps:!1,minFilter:yi,magFilter:yi,wrapS:ui,wrapT:ui,depthBuffer:!1}))}_resizeTransmission(E,O){this.transmissionRenderTarget?.setSize(E*this._pixelRatio/(this.hdTransmission?1:2),O*this._pixelRatio/(this.hdTransmission?1:2)),this.aoRenderTarget?.setSize(E*this._pixelRatio/1,O*this._pixelRatio/1)}get hdTransmission(){return ck.transmissionLod.value===1}set hdTransmission(E){ck.transmissionLod.value=E===!0?1:2,this._resizeTransmission(this.viewportWidth,this.viewportHeight)}createTransmissionRenderTarget(){this.transmissionRenderTarget===void 0&&(this.transmissionRenderTarget=new Un(this.viewportWidth*this._pixelRatio/(this.hdTransmission?1:2),this.viewportHeight*this._pixelRatio/(this.hdTransmission?1:2),{generateMipmaps:!0,minFilter:bi,magFilter:yi,wrapS:ui,wrapT:ui,depthBuffer:!1}),this.transmissionDepthTarget=new Un(this.viewportWidth*this._pixelRatio/2,this.viewportHeight*this._pixelRatio/2,{minFilter:mi,magFilter:mi,depthBuffer:!1}))}createNormalRenderTarget(){this.normalRenderTarget===void 0&&(this.normalRenderTarget=new Un(this.viewportWidth*this._pixelRatio,this.viewportHeight*this._pixelRatio,{generateMipmaps:!1,minFilter:mi,magFilter:mi,type:Ii,depthTexture:new kd(this.viewportWidth*this._pixelRatio,this.viewportHeight*this._pixelRatio)}))}renderNormal(E,O,R){this.normalRenderTarget&&(this.setClearColor(0),R.layers.enable(8),R.layers.disable(0),R.layers.disable(3),O.traverseEntity((E=>{E.layers.isEnabled(8)&&(E.copyPreviousMatrix=!1)})),this.setRenderTarget(this.normalRenderTarget),this.clear(),mK.uniforms.depthContrast.value=R instanceof YH?(R.far-R.near)/1e4:1,O.overrideMaterial=mK,this.render(O,R),this.setClearColor(O.bgColor,O.bgColor.a),this.setRenderTarget(null),O.overrideMaterial=E.wireframeState?k0:null,R.layers.enable(0),R.layers.enable(3),O.traverseEntity((E=>{E.layers.isEnabled(8)&&(E.copyPreviousMatrix=!0)})))}renderSplineSceneWithDummyCamera(E,O,R=1){this.dummyCamera.updateCameraState(O.dataPatched),this.dummyCamera.matrix.copy(O.matrixWorld);let z=O.height,V=O.width,j=this.viewportWidth/this.viewportHeight;V<z?V=z*j:z=V/j,this.dummyCamera.setViewplaneSize(V,z);for(let O=0;O<R;O++)this.renderSplineScene(E,this.dummyCamera)}renderSplineScene(E,O,{sceneHelpers:R=this.sceneHelpers,sceneHelpersOnTop:z=this.sceneHelpersOnTop,overrideTransmission:V,overrideNormal:j}={}){let Y=E instanceof H0?E.activePage:E,ee=Y.visible;Y.visible=!0;let se=Y.scene;this.xr.enabled&&(this.isXRCopyPassSet===!1&&this.getRenderTarget()!==null&&(this.pipeline.setCopyPass(this.getRenderTarget()),this.isXRCopyPassSet=!0),this.xr.updateCamera(O)),this.setClearColor(Y.bgColor,Y.bgColor.a),Y.penumbraSizeArray.forEach(((E,O)=>{ck.penumbraSize.value[O]=E})),ck.pixelRatioNode.value=this.getPixelRatio(),this.resolution.x!==0&&this.resolution.y!==0?ck.resolution.value.set(this.resolution.x,this.resolution.y):ck.resolution.value.set(this.viewportWidth*this._pixelRatio,this.viewportHeight*this._pixelRatio),j!==void 0?(ck.normalRenderTarget.value=j,ck.normalRenderTargetDepth.value=gK):se.needsNormal()&&(this.createNormalRenderTarget(),ck.normalRenderTarget.value=this.normalRenderTarget.texture,ck.normalRenderTargetDepth.value=this.normalRenderTarget.depthTexture,this.renderNormal(se,Y,O));let he=Y.data.ao,ce=he.occlusion;if(ce&&(this.createAORenderTarget(),ck.aoRenderTarget.value=this.aoRenderTarget.texture),ck.aoEnabled.value=ce,this.pipeline.setAmbientOcclusionParams(he.occlusion,he.radius,he.bias,Y.aoColor,Y.fog!==null,Y.backupFog.near,Y.backupFog.far,he.aoFullRes&&!_M),this.pipeline.aoPass.setBlueNoiseTexture(this.pipeline.blueNoiseTexture),this.pipeline.isUIOverlayEnabled&&Y.uiCanvas?.enabled&&Y.uiCanvas.texture&&Y.uiCanvas.texture.image.width>0){let E=this.getSize(vK),O=this.getPixelRatio();(Y.uiCanvas.width!==this.viewportWidth||Y.uiCanvas.height!==this.viewportHeight||Y.uiCanvas.dpr!==O)&&Y.uiCanvas.applySize({width:this.viewportWidth,height:this.viewportHeight},O),Y.uiCanvas.render(this),this.pipeline.uiOverlayPass.uiCanvas=Y.uiCanvas,this.pipeline.uiOverlayPass.enabled=!0,this.pipeline.uiOverlayPass.setResolution(E.x,E.y,O),this.pipeline.updateRenderToScreen()}else this.pipeline.uiOverlayPass.enabled=!1,this.pipeline.updateRenderToScreen();if(this.pipeline.logoOverlayPass.enabled){let E=this.getSize(vK),O=this.getPixelRatio();this.pipeline.logoOverlayPass.uniforms.uResolution.value.set(E.x,E.y),this.pipeline.logoOverlayPass.uniforms.uDPR.value=O}let ue=!1;if(V!==void 0)ck.transmissionRenderTarget.value=V,ck.transmissionRenderTargetDepth.value=gK,this.pipeline.setTransmissionPassEnabled(!1);else{let E=se.needsTransmission();E&&(this.transmissionRenderTarget===void 0&&(ue=!0),this.createTransmissionRenderTarget(),ck.transmissionRenderTarget.value=this.transmissionRenderTarget.texture,ck.aspectRatio.value=BR(this.viewportWidth,this.viewportHeight),ck.transmissionRenderTargetDepth.value=this.transmissionDepthTarget.texture),this.pipeline.setTransmissionPassEnabled(E)}O.layers.enable(3),O.layers.enable(8),this.pipeline.sceneHelpers=R,this.pipeline.sceneHelpersOnTop=z,this.pipeline.scene=Y,this.pipeline.camera=O,ue&&this.pipeline.transmissionPass.updatePasses(this),this.pipeline.postprocessingState!==Y.postprocessing&&(this.pipeline.updatePostprocessing(Y.postprocessing),!R&&!z&&this.pipeline.disableHelpers()),this.clearAlphaOverride!==void 0&&this.setClearAlpha(this.clearAlphaOverride),se.shapeBlendIntances.forEach((E=>{E.onBeforeShadowPass(this)})),Y.overrideMaterial=se.wireframeState?k0:null,this.pipeline.render(),ck.frameIndex.value=(ck.frameIndex.value+1)%16,O instanceof YH&&O.copyHistory(),Y.visible=ee}renderFromSceneForSceneTransitionPass(E,O,R){this.pipeline.renderToScreen=!1,this.pipeline.renderTarget,this.renderSplineScene(E,O),this.pipeline.sceneTransitionFromTexture=this.pipeline.renderTarget.texture,this.sceneTransitionDuration=R,this.sceneTransitionTimeRemaining=R,this.pipeline.renderToScreen=!0;let z=this.pipeline.sceneTransitionPass.uniforms;z.uDPR.value=window.devicePixelRatio,z.uResolution.value.set(this.domElement.width,this.domElement.height).divideScalar(window.devicePixelRatio)}_currentDispose(){this._superDispose(),this.pipeline.dispose(),this.aoRenderTarget?.dispose(),this.transmissionRenderTarget?.dispose(),this.transmissionDepthTarget?.dispose(),this.normalRenderTarget?.dispose(),this.normalRenderTarget?.depthTexture?.dispose()}};var xK=class extends(Go(Nf)){constructor(E,O=15,R=10066329){super(E,O,R);this.object=E;this.added=!1;this.name=`DirectionalLightHelper: ${E.uuid}`}raycast(E,O){jo(this.object,xK.geometryHelper,E,O)}};var bK=class extends(Go(Rf)){constructor(E,O=15,R=6710886){super(E,O,R);this.object=E;this.name=`PointLightHelper: ${E.uuid}`}raycast(E,O){jo(this.object,bK.geometryHelper,E,O)}};var wK=class extends(Go(Of)){constructor(E,O=6710886){super(E,O);this.object=E;this.name=`SpotLightHelper: ${E.uuid}`}raycast(E,O){jo(this.object,wK.geometryHelper,E,O)}update(){if(this.object!==void 0){let E=wK._vector,O=this.object.distance?this.object.distance:1e3,R=O*Math.tan(this.object.angle);this.cone.scale.set(R,R,O),E.setFromMatrixPosition(this.object.target.matrixWorld),this.cone.lookAt(E);let z=this.color!==void 0?this.color:this.light.color;if(this.cone.material instanceof Array)for(let E=0,O=this.cone.material.length;E<O;E++)this.cone.material[E].color.set(z);else this.cone.material.color.set(z)}}},SK=wK;SK._vector=new Wn;var _K=class extends Fd{constructor(){super();this.caretIndex=0;this._caretVisibleAlpha=1;this._selectionVisibleAlpha=.3;this.current={start:0,end:void 0};this.matrixAutoUpdate=!1,this.caretMesh=new eo(new Co(1,1),new xa({transparent:!0,opacity:0,side:Ge})),this.add(this.caretMesh),this.selectionMesh=new eo(new Co(1,1),new xa({color:2857471,transparent:!0,depthTest:!1,depthWrite:!1,opacity:0,side:Ge})),this.add(this.selectionMesh),this.hide()}get caretHeight(){return this.object?.AD??0}show(E){this.visible=!0,this.object=E,this.caretMesh.scale.set(1,this.caretHeight,1),this.caretMesh.position.y=.5*-this.caretHeight,this.setCaretPosition(this.caretIndex),this.update()}hide(){this.visible=!1}update(){if(this.object===void 0)return;this.updateHelperMatrix();let{depth:E}=this.object.geometry.userData.parameters;this.caretMesh.position.z=E,this.selectionMesh.position.z=E}updateHelperMatrix(){if(this.object===void 0)return;let E=this.object,O=E.parent;O!==null&&O.updateWorldMatrix(!0,!1),E.matrixAutoUpdate&&E.updateMatrix(),O!==null?(this.matrixWorld.multiplyMatrices(O.matrixWorld,E.hiddenMatrix),this.matrixWorld.multiplyMatrices(this.matrixWorld,E.matrix)):this.matrixWorld.multiplyMatrices(E.hiddenMatrix,E.matrix),this.matrix.copy(this.matrixWorld);for(let E of this.children)E.matrixWorld.copy(this.matrixWorld);E.updateWorldMatrix(!0,!0)}setCaretColor(E){let O=this.caretMesh.material;O.color.setRGB(E.r,E.g,E.b);let R=this._caretVisibleAlpha===O.opacity;this._caretVisibleAlpha=E.a,R&&(O.opacity=this._caretVisibleAlpha)}setSelectionColor(E){this.selectionMesh.material.color.setRGB(E.r,E.g,E.b)}setCaretPosition(E,O={}){if(this.object===void 0)return;this.caretIndex=E;let R=this.object.wrappedText,[z,V]=Yx(R,E),[j,Y]=E>0?Yx(R,E-1):[null,null];(E>0&&R.length?R[j].charAt(Y):null)==="\n"&&(z++,V=0),this.current.start=E,this.current.end=void 0;let[ee,se]=lT(this.object,z,V),{AD:he,descender:ce}=this.object,ue=ce+he*.5,{width:fe,height:ve,depth:we}=this.object.geometry.userData.parameters,Se=typeof fe=="string"?0:fe,_e=typeof ve=="string"?0:ve;this.caretMesh.scale.set(1,this.caretHeight,1),this.caretMesh.position.set(ee-Se*.5,se+ue+_e*.5,we),this.hideSelectionMesh(),this.showCaretMesh()}setSelection(E,O){if(this.object===void 0)return;let R=this.object.wrappedText;this.current.start=E,this.current.end=O;let z=[],V=[],j=nZ(R,E,O),{lineHeight:Y,AD:ee,descender:se}=this.object,he=se+ee*.5-Y*.5;for(let[E,O,R]of j)if(O!==R){let[j,ee]=lT(this.object,E,O),[se,ce]=lT(this.object,E,R);ee+=he,ce+=he,ce+=Y;let ue=z.length/3;z.push(j,ee,0),z.push(se,ee,0),z.push(se,ce,0),z.push(j,ce,0),V.push(ue+0,ue+1,ue+2),V.push(ue+2,ue+3,ue+0)}let ce=new Na;ce.setIndex(V),ce.setAttribute("position",new Ma(z,3));let{width:ue,height:fe,depth:ve}=this.object.geometry.userData.parameters,we=typeof ue=="string"?0:ue,Se=typeof fe=="string"?0:fe;this.selectionMesh.geometry.dispose(),this.selectionMesh.geometry=ce,this.selectionMesh.position.x=.5*-we,this.selectionMesh.position.y=Se*.5,this.selectionMesh.position.z=ve,this.showSelectionMesh(),this.hideCaretMesh()}getSelectionFromPosition(E,O,R="previous"){if(this.object===void 0||this.object.font===void 0)return;let z=this.object.wrappedText,V=z.length,j=this.object.lineHeight,Y=V*j,{height:ee,verticalAlign:se}=this.object.geometry.userData.parameters,he=typeof ee=="string"?0:ee,ce=0;se===3?ce=he-Y:se===2&&(ce=he*.5-Y*.5);let ue=Math.min(Math.floor(Math.max(Math.min(-O-ce,Y),0)/j),V-1),fe=this.object.charCoords[ue],ve=this.object.charWidths[ue],we=0,Se=!1;if(R==="previous"){for(let O=0;O<fe.length;O++)if(fe[O][0]+ve[O]*.5-E>0){we=O,Se=!0;break}}else if(R==="closest"){let O=1/0;for(let R=0;R<fe.length;R++){let z=fe[R][0]+ve[R]*.5,V=Math.abs(z-E);V<O&&(O=V,we=R,Se=!0)}}else for(let O=0;O<fe.length;O++){let R=fe[O][0],z=fe[O][0]+ve[O];if(E>=R&&E<z){we=O,Se=!0;break}}return Se||(we=fe.length),{index:this.getGlobalIndexFromLineAndCharIndexes(z,ue,we),lineIndex:ue,characterIndex:we}}getGlobalIndexFromLineAndCharIndexes(E,O,R){return E.slice(0,O).reduce(((E,O)=>E+O.length),0)+R}showSelectionMesh(){this.selectionMesh.material.opacity=this._selectionVisibleAlpha}hideSelectionMesh(){this.selectionMesh.material.opacity=0}showCaretMesh(){this.caretMesh.material.opacity=this._caretVisibleAlpha}hideCaretMesh(){this.caretMesh.material.opacity=0}};function lT(E,O,R){let{charCoords:z,charWidths:V,initialOffsetY:j,lineHeight:Y}=E;if(z[O]&&z[O].length===0||z.length===0){let R=0,{horizontalAlign:z}=E.data.geometry,V=E.wrappedText,{width:ee}=E.geometry.userData.parameters;return V.length===1&&V[0].length===0&&(z===3?R=ee*.5:z===2&&(R=ee)),[R,j-Y*O]}let ee=z[O];if(ee===void 0||ee.length===0)return[0,0];let[se,he]=ee[Math.min(R,ee.length-1)];return R>=ee.length&&(se+=V[O][R-1]),[se,he]}function Yx(E,O){let R=0;for(let z=0;z<E.length;z++){let V=E[z],j=O-R;if(j<=V.length)return[z,j];R+=V.length}return[Math.max(0,E.length-1),E[E.length-1]?.length??0]}function nZ(E,O,R){let[z,V]=Yx(E,O),[j,Y]=Yx(E,R),ee=[];V>=E[z].length&&(z++,V=0);for(let O=z;O<=j;O++){let R=E[O],se=O===z?V:0,he=O===j?Y:R.length;ee.push([O,se,he])}return ee}function wL(E,O){let R=TT.fromHex(3223857),z=.8;for(let V of E.layers){if(V.data.type==="light"||V.data.type==="displace"||V.data.type==="fresnel"||V.data.type==="matcap"||V.data.type==="texture"||V.data.type==="toon"||V.data.type==="outline"||V.data.type==="transmission"||V.data.type==="noise")continue;let E=typeof V.data.alpha=="string"?Number(O.getVariable(V.data.alpha)):V.data.alpha;if(V.data.type==="color"&&E>.3){R=sZ(V.data.color,O),z=E;break}if((V.data.type==="depth"||V.data.type==="gradient")&&E>.3){let E=oZ(V.data);R={r:E[0],g:E[1],b:E[2]},z=typeof V.data.alpha=="string"?1:V.data.alpha;break}}return{...R,a:z}}function sZ(E,O){return typeof E=="string"?O.data.colors[E]:E}function oZ(E){return E.colors[0]}function aZ(E,O){E.shadow.camera.right=O/2,E.shadow.camera.left=-O/2,E.shadow.camera.top=O/2,E.shadow.camera.bottom=-O/2,E.shadow.needsUpdate=!0}var AK=class extends(ff(Jp,xK)){constructor(E,O,R){super(),this.super_Entity(E,O),this.castShadow=!0,this.shadow.mapSize.width=2048,this.shadow.mapSize.height=2048,this.shadow.normalBias=1,this.layers.enable(3);let z=this.shadow.camera;z.top=1250,z.bottom=-1250,z.right=1250,z.left=-1250,z.near=-1e4,z.far=2500;let V=new jf(this.shadow.camera);V.visible=!1,this.gizmos.shadowmap=V}update(){this.shadow.camera.updateProjectionMatrix();for(let E in this.gizmos){let O=this.gizmos[E];O instanceof jf&&O.update()}}updateMatrixWorld(E){super.updateMatrixWorld(E),this.objectHelper&&this.objectHelper.update()}updateState(E,O){this.updateState_Light(E,O);let R=E.depth!==void 0&&E.depth!==this.shadow.camera.far||E.size!==void 0&&E.size/2!==this.shadow.camera.right;E.size!==void 0&&aZ(this,E.size),E.shadowRadius!==void 0&&(this.shadow.radius=E.shadowRadius),E.shadowResolution!==void 0&&(this.shadow.mapSize.set(E.shadowResolution,E.shadowResolution),this.shadow.map&&(this.shadow.map.dispose(),this.shadow.map=null)),E.penumbraSize!==void 0&&O.scene.markPenumbraSizeDirty(),R&&this.update()}};var MK=new Wn,EK=new Wn,CK=new Hn,TK=class extends(ff(Vp,SK)){constructor(E,O,R){super(),this.super_Entity(E,O),this.castShadow=!0,this.shadow.mapSize.width=1024,this.shadow.mapSize.height=1024,this.shadow.normalBias=1,this.layers.enable(3);let z=this.shadow.camera;z.fov=xn.RAD2DEG*2*this.angle,z.aspect=1,z.near=100,z.far=2500;let V=new jf(this.shadow.camera);V.visible=!1,this.gizmos.shadowmap=V,this.update()}update(){this.shadow.camera.updateProjectionMatrix();for(let E in this.gizmos){let O=this.gizmos[E];O instanceof jf&&O.update()}}updateMatrixWorld(E){super.updateMatrixWorld(E),EK.setFromMatrixPosition(this.matrixWorld),CK.setFromRotationMatrix(this.matrixWorld),MK.copy(this.up).applyQuaternion(CK).negate().multiplyScalar(this.distance),this.target.position.copy(EK).add(MK),this.target.updateMatrixWorld(),this.objectHelper&&this.objectHelper.update()}updateState(E,O){this.updateState_Light(E,O),E.distance!==void 0&&(this.distance=E.distance),E.decay!==void 0&&(this.decay=E.decay),E.angle!==void 0&&(this.angle=E.angle),E.penumbra!==void 0&&(this.penumbra=E.penumbra),E.shadowRadius!==void 0&&(this.shadow.radius=E.shadowRadius),E.penumbraSize!==void 0&&O.scene.markPenumbraSizeDirty(),E.shadowResolution!==void 0&&(this.shadow.mapSize.set(E.shadowResolution,E.shadowResolution),this.shadow.map&&(this.shadow.map.dispose(),this.shadow.map=null))}};function lZ(E){let O=(E[0][0]+E[1][1])/2,R=(E[0][0]-E[1][1])/2,z=(E[1][0]+E[0][1])/2,V=(E[1][0]-E[0][1])/2,j=Math.sqrt(O*O+V*V),Y=Math.sqrt(R*R+z*z),ee=j+Y,se=j-Y,he=Math.atan2(z,R),ce=Math.atan2(V,O),ue=(ce-he)/2,fe=(ce+he)/2,ve=[[Math.cos(fe),Math.sin(fe)],[-Math.sin(fe),Math.cos(fe)]],we=[[ee,0],[0,se]],Se=[[Math.cos(ue),Math.sin(ue)],[-Math.sin(ue),Math.cos(ue)]];return ve[0][0]*=-1,ve[0][1]*=-1,Se[0][0]*=-1,Se[1][0]*=-1,[ve,we,Se]}function Kx(E,O){return[[E[0][0]*O[0][0]+E[0][1]*O[1][0],E[0][0]*O[0][1]+E[0][1]*O[1][1]],[E[1][0]*O[0][0]+E[1][1]*O[1][0],E[1][0]*O[0][1]+E[1][1]*O[1][1]]]}function ML(E){return[[E[0][0],E[1][0]],[E[0][1],E[1][1]]]}function CL(E){let[O,R,z]=lZ(E),V=Kx(O,ML(z)),j=Kx(Kx(z,R),ML(z)),Y=Math.atan2(V[1][0],V[0][0]),ee=[j[0][0],j[1][1]],se=[j[0][1]/j[1][1],j[1][0]/j[0][0]];return{rotation:Y,scale:ee,shear:se}}function PL({rotation:E,scale:O,shear:R}){let z=Math.cos(E),V=Math.sin(E),j=[[z,-V],[V,z]],Y=[[O[0],R[0]*O[1]],[R[1]*O[0],O[1]]],ee=Kx(j,Y);return[ee[0][0],ee[1][0],ee[0][1],ee[1][1]]}var PK;(E=>{function n(){return[1,0,0,0,1,0,0,0,1]}E.identity=n;function t(O,R=E.identity()){for(let E=0,z=O.length;E<z;E++)R[E]=O[E];return R}E.copy=t;function e(O,R,z,V,j,Y){return E.setAbcdef(E.identity(),O,R,z,V,j,Y)}E.create=e;function r(E,O,R,z,V,j,Y){return E[0]=O,E[1]=z,E[2]=j,E[3]=R,E[4]=V,E[5]=Y,E}E.setAbcdef=r;function i(O,R){let[z,V,j,Y,ee,se]=o(O),[he,ce,ue,fe,ve,we]=o(R),Se=he*z+ce*j,_e=he*V+ce*Y,Ae=ue*z+fe*j,Ce=ue*V+fe*Y,Te=ve*z+we*j+ee,Ie=ve*V+we*Y+se;return E.create(Se,_e,Ae,Ce,Te,Ie)}E.append=i;function s(O,R){let[z,V,j,Y,ee,se]=o(O),[he,ce,ue,fe,ve,we]=o(R),Se=z,_e=V,Ae=j,Ce=Y;(he!==1||ce!==0||ue!==0||fe!==1)&&(Se=z*he+V*ue,_e=z*ce+V*fe,Ae=j*he+Y*ue,Ce=j*ce+Y*fe);let Te=ee*he+se*ue+ve,Ie=ee*ce+se*fe+we;return E.create(Se,_e,Ae,Ce,Te,Ie)}E.prepend=s;function o(E){return[E[0],E[3],E[1],E[4],E[2],E[5]]}E.getAbcdef=o;function a(O){let[R,z,V,j,Y,ee]=E.getAbcdef(O),se=R*j-z*V,he=j/se,ce=-z/se,ue=-V/se,fe=R/se,ve=(V*ee-j*Y)/se,we=-(R*ee-z*Y)/se;return E.create(he,ce,ue,fe,ve,we)}E.invert=a;function l([O,R],z){let[V,j,Y,ee,se,he]=E.getAbcdef(z);return[V*O+Y*R+se,j*O+ee*R+he]}E.apply=l;function c(O,R){let[z,V,j,Y,ee,se]=E.getAbcdef(R),he=1/(z*Y+j*-V),[ce,ue]=O;return[Y*he*ce+-j*he*ue+(se*j-ee*Y)*he,z*he*ue+-V*he*ce+(-se*z+ee*V)*he]}E.applyInverse=c;function u(O,R,z=R){let[V,j,Y,ee,se,he]=E.getAbcdef(O);return E.setAbcdef(O,V*R,j*z,Y*R,ee*z,se*R,he*z),O}E.scale=u;function h(O,R){let z=Math.cos(R),V=Math.sin(R),[j,Y,ee,se,he,ce]=E.getAbcdef(O);return E.setAbcdef(O,j*z-Y*V,j*V+Y*z,ee*z-se*V,ee*V+se*z,he*z-ce*V,he*V+ce*z),O}E.rotate=h;function d(O,R,z){let[V,j]=z,Y=E.translate(O,-V,-j);return Y=E.rotate(Y,R),Y=E.translate(Y,V,j),Y}E.rotateAround=d;function f(O,R,z){let[V,j,Y,ee,se,he]=E.getAbcdef(O);return E.setAbcdef(O,V,j,Y,ee,se+R,he+z),O}E.translate=f;function p(O,R,z){let[V,j,Y,ee]=E.getAbcdef(O);return E.setAbcdef(O,V,j,Y,ee,R,z),O}E.setTranslate=p;function m(O,R,z){let[V,j,Y,ee]=E.getAbcdef(O);return E.setAbcdef(O,V,j,Y,ee,R,z),O}E.setPosition=m;function g(O){let[R,z,V,j]=E.getAbcdef(O),Y=Math.sqrt(R*R+z*z),ee=Math.sqrt(V*V+j*j);return[Y,ee]}E.getScale=g;function y(O){let[,,,,R,z]=E.getAbcdef(O);return[R,z]}E.getPosition=y;function x(O,R){return E.decompose(O,R).rotation}E.getRotation=x;function v(O,R){let[z,V,j,Y,ee,se]=E.getAbcdef(O),{rotation:he,scale:ce,shear:ue}=CL([[z,j],[V,Y]]);return{position:[ee+(R[0]*z+R[1]*j)-R[0],se+(R[0]*V+R[1]*Y)-R[1]],scale:ce,rotation:he,shear:ue,pivot:R}}E.decompose=v;function S(O,R,z,V,j=[0,0]){let[Y,ee]=O,[se,he]=V,[ce,ue,fe,ve]=PL({rotation:z,scale:R,shear:j}),we=Y-(se*ce+he*fe)+se,Se=ee-(se*ue+he*ve)+he;return E.create(ce,ue,fe,ve,we,Se)}E.compose=S})(PK||(PK={}));var DK=Math.PI/180;Math.PI;function _L(E,O,R,z,V,j){let Y=E-R,ee=O-z;return Y*Y/(V*V)+ee*ee/(j*j)<=1}function IL(E){return E*DK}var IK=class{constructor(E,O,R){this.uuid=E;this.data=O;this.localMatrix=PK.identity();this.worldMatrix=PK.identity();this.ignoreCameraZoom=!1;this.visible=!0;this._singleBBox=new BK;this._recursiveBBox=new BK;this.singleBBoxNeedsUpdate=!0;this.recursiveBBoxNeedsUpdate=!0;this.stateSelection=null;this.prevState=null;this.currentState=null;this.reversibleToState=null;this.currentTransitionEvent=null;this.previousAction=null;this.name="";this.position=[0,0];this.scale=[1,1];this.rotation=0;this.shear=[0,0];this.emitter=La();this.dpr=R.dpr??1,this.dataPatched=O}project(E,O){let R=this.worldMatrix;return O&&(R=PK.append(O.worldMatrix,R)),PK.applyInverse(E,R)}intersects(E,O,R,z=!1){return this.visible&&!this.data.raycastLock&&this.intersectsInLocalSpace(...this.project([E,O],R),z)}intersectsInLocalSpace(E,O,R=!1){let{min:z,max:V}=R?this.recursiveBBox:this.singleBBox;return E>=z[0]&&E<=V[0]&&O>=z[1]&&O<=V[1]}applyTransforms(E){E.setTransform(this.worldMatrix,this.ignoreCameraZoom)}get singleBBox(){return this.singleBBoxNeedsUpdate&&(this.singleBBoxNeedsUpdate=!1,this._singleBBox.setFromObjectSize(this,!1),this._singleBBox.computeVertices(),this._singleBBox.computeEdges()),this._singleBBox}get recursiveBBox(){return this.recursiveBBoxNeedsUpdate&&(this.recursiveBBoxNeedsUpdate=!1,this._recursiveBBox.setFromObjectSize(this,!0),this._recursiveBBox.computeVertices(),this._recursiveBBox.computeEdges()),this._recursiveBBox}updateLocalMatrix(){this.localMatrix=PK.compose(this.position,this.scale,IL(this.rotation),kI.getPivot(this.dataPatched),this.shear)}updateWorldMatrix(E,O,R){let z=this.parent;O&&z!==null&&z!==void 0&&z.updateWorldMatrix(E,!0,!1),E&&this.updateLocalMatrix(),this.parent?this.worldMatrix=PK.append(this.parent.worldMatrix,this.localMatrix):this.worldMatrix=PK.copy(this.localMatrix),this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0}get pivot(){return kI.getPivot(this.data)}getCenter(){return[0,0]}getHalfSize(){return[0,0]}get id(){return this.uuid}resetBBoxNeedsUpdateSelf(){this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0}resetBBoxNeedsUpdate(){this.resetBBoxNeedsUpdateSelf(),this.traverseAncestors((E=>{E.resetBBoxNeedsUpdateSelf()}))}updateTransformState(E){let O=!1;E.position!==void 0&&(O=!0,this.position=E.position),E.rotation!==void 0&&(O=!0,this.rotation=E.rotation),E.scale!==void 0&&(O=!0,this.scale=E.scale),E.shear!==void 0&&(O=!0,this.shear=E.shear),O&&(this.updateWorldMatrix(!0,!1,!0),this.resetBBoxNeedsUpdate())}updateByOp(E,O,R){E.type===0&&E.props.visible!==void 0&&(this.visible=E.props.visible),this.data=O,this.data=O;let z=E,V=Vt(E.path,["states","*"]);if(V!==null){if(E.type===0){let[O]=V;if(this?.stateSelection===O){let O={...E.props};if(delete O.name,Object.values(E.props).some((E=>E===void 0))){let R=this.data;if(R!==void 0){let z=lE.zoom(R,E.path.slice(2));if(z)for(let R in E.props)E.props[R]===void 0&&R in z&&(O[R]=z[R])}}z={...E,props:O,path:E.path.slice(2)}}}}else if(E.type===0){let O=this.stateSelection?this.data.states.data(this.stateSelection):void 0;if(O!==void 0){if(E.props.name!==void 0&&O.name){let{name:E,...R}=O;O=R}let R=lE.removeOverridden(E.path,E.props,O);z={...E,props:R}}}this.updateByPatchedOpBase(z,hI.patch(this.data,this.stateSelection?this.data.states.data(this.stateSelection):void 0),R)}changeSelectedState(E,O,R=!1){if(!(this.data.states.length===0&&!R)){for(let E of this.data.states)hI.toOps(this.data,E.data).forEach((E=>{let R=WM.replaceProps(E,this.data);this.dataPatched=this.data,this.updateByPatchedOp(R,this.data,O)}));if(E!==null){let R=this.data.states.data(E);R&&(this.dataPatched=hI.patch(this.data,R),hI.toOps(this.data,R).forEach((E=>{this.updateByPatchedOp(E,this.dataPatched,O)})))}R&&this.updateTransformState(this.dataPatched),this.stateSelection=E}}updateState(E,O){E.name!==void 0&&(this.name=E.name),E.visible!==void 0&&(this.visible=E.visible),this.updateTransformState(E)}updateByPatchedOpBase(E,O,R){this.dataPatched=O,this.updateByPatchedOp(E,O,R)}updateByPatchedOp(E,O,R){E.path.length===0&&E.type===0&&this.updateState(E.props,R),this.requestRender()}traverseFrameAncestors(E){this.traverseAncestors((O=>{O.data.type==="frame2d"&&E(O)}))}traverseAncestors(E){let O=this.parent;for(;O;)E(O),O=O.parent}requestRender(){this.traverseFrameAncestors((E=>{E.requestRender()}))}clone(E){let O=new IK(this.uuid,this.data,E);return O.parent=void 0,O}addEventListener(E,O){this.emitter.on(E,O)}removeEventListener(E,O){this.emitter.off(E,O)}dispatchEvent(E){this.emitter.emit(E.type,{...E,target:E.target??this})}traverseSortNextHelper(){let E=this.parent;if(E){let O=E.children;if(O){let R=O.indexOf(this)+1;return O[R]?O[R]:E.traverseSortNextHelper()}}}sortNext(){let E=this.children;return E&&E.length>0&&E[0]?E[0]:this.traverseSortNextHelper()}isDescendantOf(E){E instanceof IK&&(E=E.uuid);let O=this;for(;O.parent;){if(O.parent.uuid===E)return!0;O=O.parent}return!1}};var OK=class extends IK{constructor(E,O,R){super(E,O,R);this.uuid=E;this.data=O;this.context=R;this.children=[]}add(E){E.parent&&E.parent instanceof OK&&E.parent.remove(E),this.children.push(E),E.parent=this}remove(E){let O=this.children.indexOf(E);O>=0&&(this.children.splice(O,1),E.parent=void 0)}traverse(E){let O=E(this);if(O!==!0)for(let R of this.children)R instanceof OK?R.traverse(E):O=E(R)}intersectsChildrenHelper(E,O,R,z,V){for(let j of this.children)if(j.intersects(E,O,R,!1)&&(V.push(j),z)||j instanceof OK&&j.intersectsChildrenHelper(E,O,R,z,V))return!0;return!1}intersectsChildren(E,O,R,z=!1,V=[],j=!1){return this.intersectsChildrenHelper(E,O,R,z,V),V}intersectsChildrenHelperReverse(E,O,R,z,V){for(let j of this.children)if(j instanceof OK&&j.intersectsChildrenHelperReverse(E,O,R,z,V)||j.intersects(E,O,R,!1)&&(V.push(j),z))return!0;return!1}intersectsChildrenReverse(E,O,R,z=!1,V=[],j=!1){return this.intersectsChildrenHelperReverse(E,O,R,z,V),V}updateWorldMatrix(E,O,R){if(super.updateWorldMatrix(E,O,R),R&&this.children)for(let O of this.children)O.updateWorldMatrix(E,!1,!0)}find(E){let O;return this.traverse((R=>{R.uuid===E&&(O=R)})),O}innerDrawChildren(E){for(let O=this.children.length-1;O>=0;O--)this.children[O].draw(E)}resetBBoxNeedsUpdate(){super.resetBBoxNeedsUpdate(),this.traverse((E=>{E.resetBBoxNeedsUpdateSelf()}))}clone(E){let O=new OK(this.uuid,this.data,E);O.parent=void 0;for(let R of this.children)O.add(R.clone(E));return O}},RK=class extends OK{constructor(E,O,R){super(E,O,R);this.uuid=E;this.data=O;this.updateState(O,R)}draw(E){!this.visible||(E.save(),this.applyTransforms(E),this.innerDrawChildren(E),E.restore())}clone(E){let O=new RK(this.uuid,this.data,E);O.parent=void 0;for(let R of this.children)O.add(R.clone(E));return O}};function uZ(E,O){let[[R,z],[V,j]]=E,[[Y,ee],[se,he]]=O,ce=(R-V)*(ee-he)-(z-j)*(Y-se);if(ce===0)return!1;let ue=((R-Y)*(ee-he)-(z-ee)*(Y-se))/ce,fe=-((R-V)*(z-ee)-(z-j)*(R-Y))/ce;return ue>=0&&ue<=1&&fe>=0&&fe<=1}var LK=[[-1,1],[-1,-1],[1,-1],[1,1]],DL=(E,O,R)=>{let z=E.getCenter(),V=E.getHalfSize(),j=PK.append(O,E.worldMatrix);V[0]===0&&V[1]===0?R.push(PK.apply(z,j)):LK.forEach((E=>{let O=[E[0]*V[0]+z[0],E[1]*V[1]+z[1]];R.push(PK.apply(O,j))}))},BK=class{constructor(){this.matrix=PK.identity();this.min=[1/0,1/0];this.max=[-1/0,-1/0];this.vertices=[];this.edges=[]}setFromObjectSize(E,O=!1){E.updateWorldMatrix(),this.makeEmpty(),PK.copy(E.worldMatrix,this.matrix);let R=PK.invert(E.worldMatrix);this.expandByObjectSize(E,R,O)}expandByObjectSize(E,O,R=!1){let z=[];R===!0&&E instanceof OK?E.traverse((E=>{E.visible&&DL(E,O,z)})):DL(E,O,z),this.setFromPoints(z)}setFromSize(E,O,R){this.makeEmpty(),PK.copy(R,this.matrix),this.expandBySize(E,O,R)}expandBySize(E,O,R){[PK.apply([0,0],R),PK.apply([0,O],R),PK.apply([E,O],R),PK.apply([E,0],R)].forEach((E=>this.expandByPoint(E)))}getCenter(){let[E,O]=this.min,[R,z]=this.getHalfSize();return PK.apply([E+R,O+z],this.matrix)}getSize(){return[this.max[0]-this.min[0],this.max[1]-this.min[1]]}getHalfSize(){return[.5*(this.max[0]-this.min[0]),.5*(this.max[1]-this.min[1])]}makeEmpty(){this.min=[1/0,1/0],this.max=[-1/0,-1/0]}setFromPoints(E){this.makeEmpty();for(let O of E)this.expandByPoint(O)}expandByPoint(E){this.min=[Math.min(this.min[0],E[0]),Math.min(this.min[1],E[1])],this.max=[Math.max(this.max[0],E[0]),Math.max(this.max[1],E[1])]}computeVertices(){let[E,O]=this.getHalfSize(),R=this.getCenter(),[z,V,j,Y]=PK.getAbcdef(this.matrix),ee=PK.create(z,V,j,Y,R[0],R[1]);this.vertices=LK.map((([R,z])=>PK.apply([R*E,z*O],ee)))}computeEdges(){this.edges=[];for(let E=0,O=this.vertices.length;E<O;++E)this.edges.push([this.vertices[E],this.vertices[(E+1)%O]])}project(E,O){let R=this.matrix;return O&&(R=PK.append(O.worldMatrix,R)),PK.applyInverse(E,R)}intersects(E,O,R){return this.intersectsInLocalSpace(...this.project([E,O],R))}intersectsInLocalSpace(E,O){let{min:R,max:z}=this;return E>=R[0]&&E<=z[0]&&O>=R[1]&&O<=z[1]}containsPoint(E){let[O,R]=E,[z,V]=this.min,[j,Y]=this.max;return O>=z&&O<=j&&R>=V&&R<=Y}intersectsBBox2D(E){for(let O=0,R=this.edges.length;O<R;O++){let R=this.edges[O];for(let O=0,z=E.edges.length;O<z;O++){let z=E.edges[O];if(uZ(R,z))return!0}}for(let O=0,R=E.vertices.length;O<R;O++){let R=E.vertices[O];if(this.containsPoint(R))return!0}return!1}ensureMinMax(){let E=this.min,O=this.max;this.min=[Math.min(E[0],O[0]),Math.min(E[1],O[1])],this.max=[Math.max(E[0],O[0]),Math.max(E[1],O[1])]}copy(E){this.min=[...E.min],this.max=[...E.max],PK.copy(E.matrix,this.matrix),this.computeVertices(),this.computeEdges()}clone(){let E=new BK;return E.copy(this),E}};var zK,FK=new Promise((E=>{zK=E})),NK=!1;var UK;function NL(){if(!NK)return UK||(UK=n(),UK);async function n(){let E=await import("../_/D-4YKl4z.js");zK(E.default??E),NK=!0}}function uT(E){let O=!1;return E.scene.objects.traverse(((E,R)=>{(R.type==="Mesh"&&R.geometry.type==="UIGeometry"||R.type==="Page"&&R.uiFrame!==void 0)&&(O=!0)})),O}var kK,VK;async function hZ(E){let O=await FK;kK||(VK||(VK=O({locateFile:()=>E})),kK=await VK)}var jK=PK.identity(),HK=class{constructor(E,O=1){this.canvas=E;this._dpr=O;this._width=0;this._height=0;this._strokeMode="inside";this._layerBlur=0;this._backgroundBlur=0;this._dropShadowBlur=0;this._dropShadowOffsetX=0;this._dropShadowOffsetY=0;this._dropShadowColor=PT.transparent;this._innerShadowBlur=0;this._innerShadowOffsetX=0;this._innerShadowOffsetY=0;this._innerShadowSpread=0;this._innerShadowColor=PT.transparent;this._fonts=new Map;this._isSizeDirty=!1;try{let R=E.getBoundingClientRect();E.width=R.width*O,E.height=R.height*O}catch{console.log(E.width,O)}this._currentM3Transform=jK,this._currentTransform=new Float32Array(jK)}get dpr(){return this._dpr}set dpr(E){this._dpr=E,this._isSizeDirty=!0}async init(){if(!this.wasmURL)throw Error("Your must set the wasm binary url with renderer.wasmURL = ... before you can call renderer.init");await hZ(this.wasmURL),this._surface=kK.MakeWebGLCanvasSurface(this.canvas),this.ctx=this._surface?.getCanvas(),this._paint=new kK.Paint,this._paint.setAntiAlias(!0),this._paintFill=this._paint.copy(),this._paintFill.setStyle(kK.PaintStyle.Fill),this._paintStroke=this._paint.copy(),this._paintStroke.setStyle(kK.PaintStyle.Stroke),this.ctx?.scale(this.dpr,this.dpr)}get currentTransform(){return this._currentM3Transform}get currentTransformBuffer(){return this._currentTransform}set currentTransform(E){this._currentM3Transform=E,this._currentTransform.set(E)}async loadFont(E,O){let R=await(await fetch(E)).arrayBuffer();this.registerFont(R,O)}registerFont(E,O){if(this._fonts.has(O))return;let R=kK.FontMgr.FromData(E);if(!R)throw new Error("Invalid font data for "+O);this._fonts.set(O,R)}get width(){return this._width}get height(){return this._height}set strokeColor(E){this._paintStroke&&this._paintStroke.setColor(Zx(E),kK.ColorSpace.DISPLAY_P3)}set fillColor(E){this._paintFill&&this._paintFill.setColor(Zx(E),kK.ColorSpace.DISPLAY_P3)}set lineWidth(E){this._paintStroke&&this._paintStroke.setStrokeWidth(this._strokeMode==="center"?E:E*2)}set strokeMode(E){this._strokeMode=E}set dropShadowBlur(E){this._dropShadowBlur=E}set dropShadowColor(E){this._dropShadowColor=E}set dropShadowOffsetX(E){this._dropShadowOffsetX=E}set dropShadowOffsetY(E){this._dropShadowOffsetY=E}set innerShadowBlur(E){this._innerShadowBlur=E}set innerShadowColor(E){this._innerShadowColor=E}set innerShadowOffsetX(E){this._innerShadowOffsetX=E}set innerShadowOffsetY(E){this._innerShadowOffsetY=E}set innerShadowSpread(E){this._innerShadowSpread=E}set layerBlur(E){this._layerBlur=E}set backgroundBlur(E){this._backgroundBlur=E}clear(){this.ctx?.clear(kK.TRANSPARENT)}save(){this.ctx?.save()}restore(){this.ctx?.restore()}beginPath(){this._currentPath?.delete(),this._currentPath=new kK.Path}closePath(){let E=this._currentPath;if(E){if(E.isEmpty())return;let O=E.getBounds();(O[3]-O[1]||O[2]-O[0])&&E.close()}}fill(){this._paintInner(this._paintFill,!0)}stroke(){this._paintInner(this._paintStroke,!1)}clipRect(E,O,R,z,V=0,j=0,Y=0,ee=0){let se=kK.XYWHRect(E,O,R,z);if(V===0&&j===0&&ee===0&&Y===0)this.ctx?.clipRect(se,kK.ClipOp.Intersect,!0);else{let E=kK.RRectXY(se,V,V);E[4]=E[5]=V,E[6]=E[7]=j,E[8]=E[9]=Y,E[10]=E[11]=ee,this.ctx?.clipRRect(E,kK.ClipOp.Intersect,!0)}}_applyShadowOffsetMatrix(){if(this.ctx){let E=PK.invert(this.currentTransform);this.ctx.concat(E);let O=PK.translate(PK.identity(),this._dropShadowOffsetX,this._dropShadowOffsetY);this.ctx.concat(O),this.ctx.concat(this._currentTransform)}}_applyEffectsToPaint(E,O,R=!0){if(this.ctx&&this._currentPath){let z,V=!1;if(R&&this._hasDropShadow()){let R=E.copy();R.setColor(Zx(this._dropShadowColor));let z;this._dropShadowBlur>0&&(z=kK.MaskFilter.MakeBlur(kK.BlurStyle.Normal,this._dropShadowBlur*this.dpr*(this.camera?.scale??1),!1),R.setMaskFilter(z)),this.ctx.save(),this.ctx.clipPath(this._currentPath,kK.ClipOp.Difference,!0),this._applyShadowOffsetMatrix(),O(R),this.ctx.restore(),R.delete(),z?.delete()}if(this._backgroundBlur>0&&R){this.ctx.save(),this.ctx.clipPath(this._currentPath,kK.ClipOp.Intersect,!0);let O=kK.ImageFilter.MakeBlur(this._backgroundBlur,this._backgroundBlur,kK.TileMode.Clamp,null),R=E.copy();R.setImageFilter(O),R.setAlphaf(1);let z=this._currentPath.computeTightBounds();this.ctx.saveLayer(R,z,null,kK.SaveLayerInitWithPrevious),this.ctx.drawColor(E.getColor()),this.ctx.restore(),this.ctx.restore(),R.delete(),O.delete(),V=!0}if(this._layerBlur>0){let R=E.copy();z=kK.MaskFilter.MakeBlur(kK.BlurStyle.Normal,this._layerBlur*this.dpr*(this.camera?.scale??1),!1),R.setMaskFilter(z),O(R),R.delete(),z.delete(),V=!0}if(V||O(E),R&&this._hasInnerShadow()){let E=new kK.Paint;E.setAntiAlias(!0),E.setStyle(kK.PaintStyle.Fill),E.setColor(Zx(this._innerShadowColor));let O;this._innerShadowBlur>0&&(O=kK.MaskFilter.MakeBlur(kK.BlurStyle.Normal,this._innerShadowBlur*this.dpr*(this.camera?.scale??1),!1),E.setMaskFilter(O));let R=this._currentPath.computeTightBounds(),[z,V,j,Y]=R,ee=j-z,se=Y-V;this.ctx.save(),this.ctx.clipPath(this._currentPath,kK.ClipOp.Intersect,!0),this.ctx.saveLayer(E,R,null,kK.SaveLayerInitWithPrevious),this.ctx?.translate(this._innerShadowOffsetX,this._innerShadowOffsetY),this.ctx.drawRect(kK.XYWHRect(-1e3-this._innerShadowOffsetX,-1e3-this._innerShadowOffsetY,2e3+ee+Math.abs(this._innerShadowOffsetX*2),2e3+se+Math.abs(this._innerShadowOffsetY*2)),E),E.setBlendMode(kK.BlendMode.Clear),this.ctx.drawPath(this._currentPath,E),this.ctx.restore(),this.ctx.restore(),E.delete(),O?.delete()}}}_paintInner(E,O=!0){if(this.ctx&&this._currentPath&&E){let R=this.ctx,z=this._currentPath;this._applyEffectsToPaint(E,(E=>{let V=!1;!O&&this._strokeMode!=="center"&&(R.save(),R.clipPath(z,this._strokeMode==="outside"?kK.ClipOp.Difference:kK.ClipOp.Intersect,!0),V=!0),R.drawPath(z,E),V&&R.restore()}),O)}}_hasDropShadow(){return this._dropShadowColor?.a>0}_hasInnerShadow(){return this._innerShadowColor?.a>0}path(E){this._currentPath?.addPath(kK.Path.MakeFromSVGString(E))}ellipse(E,O,R,z,V,j,Y,ee){if(!VL([E,O,R,z])||!this._currentPath)return;if(R<0||z<0)throw Error("radii cannot be negative");let se=kK.XYWHRect(E-R,O-z,R*2,z*2);this._currentPath?.addOval(se)}rect(E,O,R,z,V=0,j=0,Y=0,ee=0){let se=kK.XYWHRect(E,O,R,z);if(!!VL(se))if(V===0&&j===0&&ee===0&&Y===0)this._currentPath?.addRect(se);else{let E=kK.RRectXY(se,V,V);E[4]=E[5]=V,E[6]=E[7]=j,E[8]=E[9]=Y,E[10]=E[11]=ee,this._currentPath?.addRRect(E)}}getHorizontalAlign(E){switch(E){case 2:return kK.TextAlign.Right;case 3:return kK.TextAlign.Center;case 4:return kK.TextAlign.Justify;case 1:default:return kK.TextAlign.Left}}drawTextInner(E,O,R,[z,V,j,Y],ee,se,he=!0){let ce=0,{ctx:ue}=this;if(!ue)return ce;let fe=se.copy(),ve=se.copy();return ve.setAlphaf(0),this._applyEffectsToPaint(fe,(se=>{O.pushPaintStyle(R,se,ve),O.addText(E);let he=O.build();he.layout(j);let fe=V;ee===2?fe+=(Y-he.getHeight())/2:ee===3&&(fe+=Y-he.getHeight()),ue.drawParagraph(he,z,fe),ce=he.getHeight(),O.reset(),he.delete()}),he),fe.delete(),ve.delete(),ce}drawText(E,O){let R=0,z=this._fonts.get(O.font),{ctx:V,_paintFill:j,_paintStroke:Y}=this;if(z&&V){let V=new kK.TextStyle({fontFamilies:[O.font],fontSize:O.fontSize,heightMultiplier:O.lineHeight,letterSpacing:O.letterSpacing}),ee=new kK.ParagraphStyle({textStyle:V,textAlign:this.getHorizontalAlign(O.horizontalAlign)}),se=kK.XYWHRect(O.x,O.y,O.width,O.height),he=kK.ParagraphBuilder.Make(ee,z);j&&(R=this.drawTextInner(E,he,V,se,O.verticalAlign,j,!0)),Y&&(R=this.drawTextInner(E,he,V,se,O.verticalAlign,Y,!1)),he.delete()}return{height:R}}render(){this._surface?.flush()}moveTo(E,O){this._currentPath?.moveTo(E,O)}lineTo(E,O){this._currentPath?.lineTo(E,O)}bezierCurveTo(E,O,R,z,V,j){this._currentPath?.cubicTo(E,O,R,z,V,j)}quadraticCurveTo(E,O,R,z){this._currentPath?.quadTo(E,O,R,z)}setTransform(E,O=!1){if(!this.ctx)return;let R=this.ctx.getTotalMatrix(),z=PK.invert(R);if(z&&this.ctx.concat(z),this.ctx?.scale(this.dpr,this.dpr),this.camera?.enabled&&(this.ctx?.concat(this.camera.worldMatrix),O)){let E=PK.getScale(this.camera.worldMatrix);this.ctx?.scale(1/E[0],1/E[1])}this.ctx?.concat(E),this.currentTransform=E}transform(E){this.ctx?.concat(E)}setSize(E,O){!this._isSizeDirty&&E===this._width&&O===this._height||(this._isSizeDirty=!1,this._width=E,this._height=O,this.canvas.style.width=E+"px",this.canvas.style.height=O+"px",this.canvas.width=E*this.dpr,this.canvas.height=O*this.dpr,this._surface&&(this._surface=kK.MakeWebGLCanvasSurface(this.canvas),this.ctx=this._surface?.getCanvas()))}};function VL(E){for(let O=0;O<E.length;O++)if(E[O]!==void 0&&!Number.isFinite(E[O]))return!1;return!0}function Zx({r:E,g:O,b:R,a:z}){return kK.Color4f(E,O,R,z)}var WK=class{constructor(E,O,R){this.uuid=E;this.data=O;this.enabled=!1;this.color=PT.transparent;this.blurRadius=0;this.offset=[0,0];this.spread=0;this.update(O)}update(E){E.color!==void 0&&(this.color=E.color),E.enabled!==void 0&&(this.enabled=E.enabled),E.blurRadius!==void 0&&(this.blurRadius=E.blurRadius),E.offset!==void 0&&(this.offset=E.offset),E.spread!==void 0&&(this.spread=E.spread)}};var qK=class{constructor(E,O,R){this.uuid=E;this.data=O;this.enabled=!1;this.radius=0;this.update(O)}update(E){E.enabled!==void 0&&(this.enabled=E.enabled),E.radius!==void 0&&(this.radius=E.radius)}};var XK=class{constructor(E,O,R){this.uuid=E;this.data=O;this.enabled=!1;this.color=PT.transparent;this.update(O)}update(E){E.enabled!==void 0&&(this.enabled=E.enabled),E.color!==void 0&&(this.color=E.color)}};var YK=class{constructor(E,O,R){this.uuid=E;this.data=O;this.enabled=!1;this.color=PT.transparent;this.thickness=0;this.mode="inside";this.update(O)}update(E){E.enabled!==void 0&&(this.enabled=E.enabled),E.color!==void 0&&(this.color=E.color),E.thickness!==void 0&&(this.thickness=E.thickness),E.mode!==void 0&&(this.mode=E.mode)}};var QK=class extends IK{constructor(E,O,R){super(E,O,R);this.uuid=E;this.data=O;this.autoClose=!0;this.fill=new XK(E+"-fill",O.fill,R),this.stroke=new YK(E+"-stroke",O.stroke,R),this.dropShadow=new WK(E+"-dropShadow",O.dropShadow,R),this.innerShadow=new WK(E+"-innerShadow",O.innerShadow,R),this.backgroundBlur=new qK(E+"-backgroundBlur",O.backgroundBlur,R),this.layerBlur=new qK(E+"-layerBlur",O.layerBlur,R)}applyFillStroke(E){E.fillColor=this.fill.enabled?this.fill.color:PT.transparent,E.strokeColor=this.stroke.enabled&&this.stroke.thickness>0?this.stroke.color:PT.transparent,E.strokeMode=this.stroke.mode,E.lineWidth=this.stroke.thickness}applyFilters(E){this.layerBlur.enabled?E.layerBlur=this.layerBlur.radius*5:E.layerBlur=0,this.backgroundBlur.enabled?E.backgroundBlur=this.backgroundBlur.radius*5:E.backgroundBlur=0,this.dropShadow.enabled?(E.dropShadowBlur=this.dropShadow.blurRadius*5,E.dropShadowColor=this.dropShadow.color,E.dropShadowOffsetX=this.dropShadow.offset[0],E.dropShadowOffsetY=this.dropShadow.offset[1]):E.dropShadowColor=PT.transparent,this.innerShadow.enabled?(E.innerShadowSpread=this.innerShadow.spread,E.innerShadowBlur=this.innerShadow.blurRadius*5,E.innerShadowColor=this.innerShadow.color,E.innerShadowOffsetX=this.innerShadow.offset[0],E.innerShadowOffsetY=this.innerShadow.offset[1]):E.innerShadowColor=PT.transparent}innerDraw(E){}draw(E){!this.visible||(E.save(),this.applyTransforms(E),this.applyFilters(E),this.applyFillStroke(E),E.beginPath(),this.innerDraw(E),this.autoClose&&E.closePath(),this.fill.enabled&&E.fill(),this.stroke.enabled&&E.stroke(),E.restore())}updateByPatchedOp(E,O,R){super.updateByPatchedOp(E,O,R),E.type===0&&(Vt(E.path,["fill"])?this.fill.update(E.props):Vt(E.path,["stroke"])?this.stroke.update(E.props):Vt(E.path,["dropShadow"])?this.dropShadow.update(E.props):Vt(E.path,["innerShadow"])?this.innerShadow.update(E.props):Vt(E.path,["layerBlur"])?this.layerBlur.update(E.props):Vt(E.path,["backgroundBlur"])?this.backgroundBlur.update(E.props):this.resetBBoxNeedsUpdate())}updateState(E,O){super.updateState(E,O),E.fill!==void 0&&this.fill.update(E.fill),E.stroke!==void 0&&this.stroke.update(E.stroke),E.dropShadow!==void 0&&this.dropShadow.update(E.dropShadow),E.innerShadow!==void 0&&this.innerShadow.update(E.innerShadow),E.layerBlur!==void 0&&this.layerBlur.update(E.layerBlur),E.backgroundBlur!==void 0&&this.backgroundBlur.update(E.backgroundBlur)}clone(E){let O=new QK(this.uuid,this.data,E);return O.parent=void 0,O}};var ZK=class extends QK{constructor(E,O,R){super(E,O,R);this.uuid=E;this.data=O;this.width=0;this.height=0;this.updateState(O,R)}innerDraw(E){E.ellipse(this.width*.5,this.height*.5,this.width*.5,this.height*.5,0,0,Math.PI*2)}intersectsInLocalSpace(E,O){return _L(E,O,this.width*.5,this.height*.5,this.width*.5,this.height*.5)}getCenter(){return[this.width*.5,this.height*.5]}getHalfSize(){return[this.width*.5,this.height*.5]}updateSizeState(E){let O=!1;E.width!==void 0&&(this.width=typeof E.width=="number"?E.width:this.width,O=!0),E.height!==void 0&&(this.height=typeof E.height=="number"?E.height:this.height,O=!0),O&&this.updateWorldMatrix(!0,!1,!0)}updateState(E,O){super.updateState(E,O),this.updateSizeState(E)}clone(E){let O=new ZK(this.uuid,this.data,E);return O.parent=void 0,O}};var KK=class extends QK{constructor(E,O,R){super(E,O,R);this.uuid=E;this.data=O;this.width=0;this.height=0;this.cornerRadius=[0,0,0,0];this.updateState(O,R)}innerDraw(E){E.rect(0,0,this.width,this.height,...this.cornerRadius)}getCenter(){return[this.width*.5,this.height*.5]}getHalfSize(){return[this.width*.5,this.height*.5]}updateCornerState(E){E.cornerRadius!==void 0&&(this.cornerRadius=E.cornerRadius)}updateSizeState(E){let O=!1;E.width!==void 0&&(this.width=typeof E.width=="number"?E.width:this.width,O=!0),E.height!==void 0&&(this.height=typeof E.height=="number"?E.height:this.height,O=!0),O&&this.updateWorldMatrix(!0,!1,!0)}updateState(E,O){super.updateState(E,O),this.updateSizeState(E),this.updateCornerState(E)}clone(E){let O=new KK(this.uuid,this.data,E);return O.parent=void 0,O}};var JK=class extends QK{constructor(E,O,R){super(E,O,R);this.uuid=E;this.data=O;this._textHeight=0;this._textHeightDirty=!0;this.width=0;this.height=0;this.updateState(O,R)}get textHeight(){return this._textHeight}applyFillStroke(E){E.fillColor=this.fill.enabled?this.fill.color:PT.transparent,E.strokeColor=this.stroke.enabled&&this.stroke.thickness>0?this.stroke.color:PT.transparent,E.strokeMode="center",E.lineWidth=this.stroke.thickness}innerDraw(E){this._fontHolder?.arrayBuffer&&this._fontHolder.arrayBuffer.byteLength>1&&this.data.font&&E.registerFont(this._fontHolder.arrayBuffer,this.data.font);let O=this.data.textTransform,R=this.data.text.textValue.toString(),z=O===2?R.toUpperCase():O===3?R.toLowerCase():R,{height:V}=E.drawText(z,{x:0,y:0,width:this.width,height:this.height,fontSize:this.data.fontSize,lineHeight:this.data.lineHeight??1,letterSpacing:this.data.letterSpacing??0,horizontalAlign:this.data.horizontalAlign,verticalAlign:this.data.verticalAlign,font:this.data.font});this._textHeight=V}getCenter(){return[this.width*.5,this.height*.5]}getHalfSize(){return[this.width*.5,this.height*.5]}updateSizeState(E){let O=!1;E.width!==void 0&&(this.width=typeof E.width=="number"?E.width:this.width,O=!0),E.height!==void 0&&(this.height=typeof E.height=="number"?E.height:this.height,O=!0),O&&this.updateWorldMatrix(!0,!1,!0)}updateFontState(E,{shared:O}){E.font!==void 0&&(this._fontHolder=O.getFont(E.font),this._fontHolder&&!this._fontHolder.isLoaded&&this._fontHolder.loadingPromise.then((()=>{this.requestRender()})))}updateState(E,O){super.updateState(E,O),this.updateSizeState(E),this.updateFontState(E,O)}clone(E){let O=new JK(this.uuid,this.data,E);return O.parent=void 0,O}};var $K,mJ=class extends QK{constructor(E,O,R){super(E,O,R);this.uuid=E;this.data=O;this.curves=[];this.extremasBBox={min:[0,0],max:[0,0]};this.updateState(O,R)}computeExtremas(){this.curves.length===0&&this.computeCurves();let E=this.curves.map((E=>$K.extremas(E))),O=[1/0,1/0],R=[-1/0,-1/0];for(let z=0,V=E.length;z<V;z++){let V=E[z];V[0][0]<O[0]&&(O[0]=V[0][0]),V[0][1]<O[1]&&(O[1]=V[0][1]),V[1][0]>R[0]&&(R[0]=V[1][0]),V[1][1]>R[1]&&(R[1]=V[1][1])}return this.extremasBBox.min=[O[0],O[1]],this.extremasBBox.max=[R[0],R[1]],this.extremasBBox}computeCurves(){this.curves=[];for(let E=1,O=this.data.points.length;E<O;E++){let O=this.data.points[E].data,R=this.data.points[E-1].data,z={start:R.position,cp1:R.controlNext.position,cp2:O.controlPrevious.position,end:O.position};this.curves.push(z)}let E=this.data.points[0].data,O=this.data.points[this.data.points.length-1].data;if(this.data.isClosed){let R={start:O.position,cp1:O.controlNext.position,cp2:E.controlPrevious.position,end:E.position};this.curves.push(R)}}getCenter(){let[E,O]=this.extremasBBox.min,[R,z]=this.getHalfSize();return[E+R,O+z]}getHalfSize(){let{min:E,max:O}=this.extremasBBox;return[.5*(O[0]-E[0]),.5*(O[1]-E[1])]}innerDraw(E){for(let O=0,R=this.data.points.length;O<R;O++){let R=this.data.points[O].data;if(O===0){let[O,z]=R.position;E.moveTo(O,z)}else{let z=this.data.points[O-1].data,[V,j]=z.controlNext.position,[Y,ee]=R.controlPrevious.position,[se,he]=R.position,ce={start:z.position,cp1:z.controlNext.position,cp2:R.controlPrevious.position,end:R.position};$K.derive(ce),E.bezierCurveTo(V,j,Y,ee,se,he)}}let O=this.data.points[0].data,R=this.data.points[this.data.points.length-1].data;if(this.data.isClosed){let[z,V]=R.controlNext.position,[j,Y]=O.controlPrevious.position,[ee,se]=O.position;E.bezierCurveTo(z,V,j,Y,ee,se)}}updateState(E,O){super.updateState(E,O),this.computeExtremas()}clone(E){let O=new mJ(this.uuid,this.data,E);return O.parent=void 0,O}};(E=>{function n(E){let O=E.start,R=E.cp1,z=E.cp2,V=E.end,j=[3*(R[0]-O[0]),3*(R[1]-O[1])],Y=[3*(z[0]-R[0]),3*(z[1]-R[1])],ee=[3*(V[0]-z[0]),3*(V[1]-z[1])],se={start:j,cp:Y,end:ee};return E.derivative=se,se.derivative=jJ.derive(se),se}E.derive=n;function t(E,O,R,z=!1){let V=E-2*O+R;if(V!==0){let z=-Math.sqrt(Math.abs(O*O-E*R)),j=-E+O,Y=-(z+j)/V,ee=-(-z+j)/V;return[Y,ee]}return O!==R&&V===0?[(2*O-R)/(2*(O-R))]:[]}function e(O){let R=O.derivative??E.derive(O),z=R.start,V=R.cp,j=R.end;return[t(z[0],V[0],j[0]),t(z[1],V[1],j[1])]}E.droot=e;function r(O){let[R,z]=E.droot(O),V=[O.start[0],O.end[0]],j=[O.start[1],O.end[1]];for(let z of R)V.push(E.compute(O,Math.min(1,Math.max(0,z)))[0]);for(let R of z)j.push(E.compute(O,Math.min(1,Math.max(0,R)))[1]);return V.sort(((E,O)=>E-O)),j.sort(((E,O)=>E-O)),[[V[0],j[0]],[V[V.length-1],j[j.length-1]]]}E.extremas=r;function i(E,O){if(O===0)return[...E.start];if(O===1)return[...E.end];let R=1-O,z=R*R,V=O*O,j=z*R,Y=z*O*3,ee=R*V*3,se=O*V;return[j*E.start[0]+Y*E.cp1[0]+ee*E.cp2[0]+se*E.end[0],j*E.start[1]+Y*E.cp1[1]+ee*E.cp2[1]+se*E.end[1]]}E.compute=i})($K||($K={}));var jJ;(E=>{function n(E){let O=E.start,R=E.cp,z=E.end,V=[2*(R[0]-O[0]),2*(R[1]-O[1])],j=[2*(z[0]-R[0]),2*(z[1]-R[1])],Y={start:V,end:j};return Y.derivative=HJ.derive(Y),E.derivative=Y,Y}E.derive=n;function t(O){let R=O.derivative??E.derive(O),z=R.start,V=R.end;return[z[0]!==V[0]?z[0]/(z[0]-V[0]):0,z[1]!==V[1]?z[1]/(z[1]-V[1]):0]}E.droot=t;function e(E,O){if(O===0)return[...E.start];if(O===1)return[...E.end];let R=1-O,z=R*R,V=O*O,j=z,Y=R*O*2,ee=V;return[j*E.start[0]+Y*E.cp[0]+ee*E.end[0],j*E.start[1]+Y*E.cp[1]+ee*E.end[1]]}E.compute=e})(jJ||(jJ={}));var HJ;(E=>{function n(E){let O=E.start,R=E.end,z=[R[0]-O[0],R[1]-O[1]];return E.derivative=z,E.derivative}E.derive=n;function t(E,O){if(O===0)return[...E.start];if(O===1)return[...E.end];let R=E.start,z=E.end;return[R[0]+(z[0]-R[0])*O,R[1]+(z[1]-R[1])*O]}E.compute=t})(HJ||(HJ={}));var WJ=class extends OK{constructor(E,O,R){super(E,O,R);this.uuid=E;this.width=0;this.height=0;this.clipped=!0;this.background=new KK(E+"-background",wI.defaultData,R),this.background.parent=this,this.updateState(O,R)}get fill(){return this.background.fill}get stroke(){return this.background.stroke}get backgroundBlur(){return this.background.backgroundBlur}get layerBlur(){return this.background.layerBlur}get dropShadow(){return this.background.dropShadow}get innerShadow(){return this.background.innerShadow}get cornerRadius(){return this.background.cornerRadius}set cornerRadius(E){this.background.cornerRadius=E}updateLocalMatrix(){super.updateLocalMatrix(),this.background?.updateLocalMatrix()}updateWorldMatrix(E,O,R){super.updateWorldMatrix(E,O,R),this.background?.updateWorldMatrix(E,O,R)}draw(E){if(!this.visible)return;E.save();let O=this.width,R=this.height;this.applyTransforms(E),this.background.width=O,this.background.height=R,this.background.draw(E),this.clipped&&E.clipRect(0,0,O,R,...this.cornerRadius),this.innerDrawChildren(E),E.restore()}getCenter(){return[this.width*.5,this.height*.5]}getHalfSize(){return[this.width*.5,this.height*.5]}updateCornerState(E){E.cornerRadius!==void 0&&(this.cornerRadius=E.cornerRadius)}updateSizeState(E){let O=!1;E.width!==void 0&&(this.width=typeof E.width=="number"?E.width:this.width,O=!0),E.height!==void 0&&(this.height=typeof E.height=="number"?E.height:this.height,O=!0),O&&this.updateWorldMatrix(!0,!1,!0)}updateState(E,O){super.updateState(E,O),this.updateSizeState(E),this.updateCornerState(E),E.fill!==void 0&&this.fill.update(E.fill),E.stroke!==void 0&&this.stroke.update(E.stroke),E.dropShadow!==void 0&&this.dropShadow.update(E.dropShadow),E.innerShadow!==void 0&&this.innerShadow.update(E.innerShadow),E.layerBlur!==void 0&&this.layerBlur.update(E.layerBlur),E.backgroundBlur!==void 0&&this.backgroundBlur.update(E.backgroundBlur),E.clipped!==void 0&&(this.clipped=E.clipped)}requestRender(){super.requestRender(),this.dispatchEvent({type:"render"})}dispose(){this.removeEventListener("render")}updateByPatchedOp(E,O,R){super.updateByPatchedOp(E,O,R),E.type===0&&(Vt(E.path,["fill"])?this.fill.update(E.props):Vt(E.path,["stroke"])?this.stroke.update(E.props):Vt(E.path,["dropShadow"])?this.dropShadow.update(E.props):Vt(E.path,["innerShadow"])?this.innerShadow.update(E.props):Vt(E.path,["layerBlur"])?this.layerBlur.update(E.props):Vt(E.path,["backgroundBlur"])?this.backgroundBlur.update(E.props):this.resetBBoxNeedsUpdate())}clone(E){let O=new WJ(this.uuid,this.data,E);O.parent=void 0;for(let R of this.children)O.add(R.clone(E));return O}};var qJ=Za(ue(),1),XJ=class extends QK{constructor(E,O,R){super(E,O,R);this.uuid=E;this.data=O;this._pathBBox=new DOMRect;this.path="";this.updateState(O,R),this.autoClose=!1,this.computeSVGBBox()}computeSVGBBox(){let E=document.createElementNS("http://www.w3.org/2000/svg","svg"),O=document.createElementNS("http://www.w3.org/2000/svg","path");document.body.appendChild(E),O.setAttribute("d",this.path),E.appendChild(O),this._pathBBox=O.getBBox(),E.remove()}innerDraw(E){E.path(this.path)}intersectsInLocalSpace(E,O){return E>=this._pathBBox.x&&E<=this._pathBBox.x+this._pathBBox.width&&O>=this._pathBBox.y&&O<=this._pathBBox.y+this._pathBBox.height}getCenter(){return[(this._pathBBox.x+this._pathBBox.width)/2,(this._pathBBox.y+this._pathBBox.height)/2]}getHalfSize(){return[(this._pathBBox.x+this._pathBBox.width)/2,(this._pathBBox.y+this._pathBBox.height)/2]}updateState(E,O){super.updateState(E,O),E.path!==void 0&&(this.path=E.path,this.computeSVGBBox())}clone(E){let O=new XJ(this.uuid,this.data,E);return O.parent=void 0,O}};function jL(E,O=1,R=1){if(O<=0||R<=0)return E;let z=(0,qJ.parseSVG)(E).map((E=>{let z={...E};return"x"in z&&(z.x=z.x*O),"y"in z&&(z.y=z.y*R),"x1"in z&&(z.x1=z.x1*O),"x2"in z&&(z.x2=z.x2*O),"y1"in z&&(z.y1=z.y1*R),"y2"in z&&(z.y2=z.y2*R),"rx"in z&&(z.rx=z.rx*O),"ry"in z&&(z.ry=z.ry*R),z}));return HL(z)}function HL(E){let O,R=["rx","ry","xAxisRotation","largeArc","sweep","x1","y1","x2","y2","x","y"];return E.map((E=>{let z=[];R.forEach((O=>{if(O in E){let R=E[O]*1;z.length&&R>=0&&z.push(","),z.push(R)}}));let V=(O===E.code?z[0]<0?"":",":E.code)+z.join("");return O=E.code,V})).join("")}function WL(E,O,R){switch(O.type){case"ellipse2d":return new ZK(E,O,R);case"rectangle2d":return new KK(E,O,R);case"text2d":return new JK(E,O,R);case"vector2d":return new mJ(E,O,R);case"path2d":return new XJ(E,O,R);case"frame2d":return new WJ(E,O,R);case"group2d":default:return new RK(E,O,R)}}var YJ=class{constructor(E,O,R){this.uuid=E;this.data=O;this.group=new RK(YJ.GROUP_ID,{...LI.defaultData},R),this.createChildrenObjects(O.objects,this.group,R)}createObject(E,O,R,z,V,j){let Y=WL(E,O,j);Y&&(z.add(Y),z.children.splice(V,0,z.children.pop()),Y.updateWorldMatrix(),R.length>0&&(Y instanceof RK||Y instanceof WJ)&&this.createChildrenObjects(R,Y,j))}createChildrenObjects(E,O,R){let z=0;for(let V of E)this.createObject(V.id,V.data,V.children,O,z,R),z+=1}draw(E){this.group.draw(E)}updateEntityByOp(E,O,R,z){let V=this.find(E);if(V)try{V.updateByOp(O,R,{shared:z})}catch(E){console.error(E)}}updateTreeByOp(E,O){if(E.path.length===0&&E.type===7){let R=E.parent===null?this.group:this.find(E.parent);R!==void 0&&R instanceof OK&&(this.createObject(E.id,E.data,E.children,R,E.localIndex,O),R.requestRender())}else if(E.path.length===0&&E.type===8){let O=this.find(E.id);if(O!==void 0&&O.parent!==void 0&&O.parent instanceof OK){let E=O.parent;O.resetBBoxNeedsUpdate(),E?.remove(O),E?.requestRender()}}else if(E.path.length===0&&E.type===9){let O=this.find(E.id);if(O!==void 0){let R=O.parent,z=E.parent===null?this:this.find(E.parent);if(z===void 0&&!1,z instanceof OK||z===this){z.add(O);let V=E.localIndex;z.children.splice(V,0,z.children.pop()),O.updateWorldMatrix(!0,!1,!0),R?.requestRender(),O.requestRender()}O.resetBBoxNeedsUpdate()}}}add(E){this.group.add(E)}remove(E){this.group.remove(E)}traverse(E){this.group.traverse((O=>{O!==this.group&&E(O)}))}intersectsChildren(E,O,R,z=!1,V=[]){return this.group.intersectsChildren(E,O,R,z,V,!0)}intersectsChildrenReverse(E,O,R,z=!1,V=[]){return this.group.intersectsChildrenReverse(E,O,R,z,V,!0)}find(E){return this.group.find(E)}get children(){return this.group.children}project(E,O){return this.group.project(E,O)}getWithSortKey(E){let O=this.find(E);if(O===void 0)return;let R=[],z=O;for(;z!==this.group;){let E=z;z=z.parent;let O=z.children.indexOf(E);R.splice(0,0,O)}return{entity:O,sortKey:R}}getAllSorted(E){let O=[];for(let R of E){let E=this.getWithSortKey(R.id);E!==void 0&&O.push(E)}return O.sort(((E,O)=>yv(E.sortKey,O.sortKey))),O.map((E=>E.entity))}},QJ=YJ;QJ.GROUP_ID="scene2d";function mT({constraints:E,newParentWidth:O,newParentHeight:R,initialParentWidth:z,initialParentHeight:V,objectInitialWidth:j,objectInitialHeight:Y,objectInitialPosition:ee}){let{horizontalConstraint:se,verticalConstraint:he}=E,ce=O-z,ue=R-V,fe=j,ve=Y,we=ee[0],Se=ee[1];if(se!==0)if(se===1)we+=ce;else if(se===3)we+=ce/2;else if(se===2)fe=Math.max(1,fe+ce);else if(se===4){let E=O/z;fe*=E,we*=E}if(he!==0)if(he===1)Se+=ue;else if(he===3)Se+=ue/2;else if(he===2)ve=Math.max(1,ve+ue);else if(he===4){let E=R/V;ve*=E,Se*=E}return{width:fe,height:ve,position:[we,Se]}}Za(ue(),1);var ZJ="\n\tvarying vec2 vUv;\n\tvoid main() {\n\t\tvUv = uv;\n\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t}",KJ="\n\tuniform sampler2D tDiffuse;\n\tvarying vec2 vUv;\n\tvoid main() {\n\t\tvec4 texel = texture2D( tDiffuse, vUv );\n\t\tgl_FragColor = texel;\n\t}",JJ=new Vc(-1,1,1,-1,0,1),$J=class extends Na{constructor(){super(),this.setAttribute("position",new Ma([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new Ma([0,2,0,0,2,0],2))}},e$=new $J,t$=class{constructor(E){this._mesh=new eo(e$,E)}dispose(){this._mesh.geometry.dispose()}render(E){E.render(this._mesh,JJ)}get material(){return this._mesh.material}set material(E){this._mesh.material=E}},i$=new lo({defines:{},uniforms:{tDiffuse:new _f(null)},vertexShader:ZJ,fragmentShader:KJ}),r$=new t$(i$),n$=null,s$=null,wZ=()=>(n$===null&&(n$=document.createElement("canvas")),n$),AZ=E=>(s$===null&&(s$=new HK(E)),s$),o$=PK.identity(),h$=class{constructor(E,O,R,z){this.uuid=E;this.width=O;this.height=R;this.context=z;this.enabled=!0;this.isScreenSpace=!1;this.dpr=window.devicePixelRatio;this.isFrameDirty=!1;this.onRenderRequestedDownstream=()=>{this.isFrameDirty=!0,this.context.shared.requestRender()};this._innerApplySize=()=>{let E=this.width,O=this.height,R=this.dpr;this.renderer.dpr=this.isScreenSpace?R:Math.floor(2048/Math.max(E,O)),this.renderer.setSize(E,O)};this.onFrameOverrideObjectEvent=E=>{if(E.target?.uuid!==void 0){let O=this.frameRoot?.find(E.target.uuid);O&&O.dispatchEvent({...E,target:O})}};this.scene2d=new QJ(xn.generateUUID(),WI.defaultData,{dpr:window.devicePixelRatio,shared:z.shared}),this.canvas=wZ(),this.renderer=AZ(this.canvas),this.promise=this.init(),this.renderTarget=new Un(1,1,{type:Oi,stencilBuffer:!1,depthBuffer:!1}),z.shared.addUIBuffer(this.uuid,this.renderTarget),this.textureHolder=z.shared.uiBuffer(this.uuid)}get canvasTexture(){return this._canvasTexture||(this._canvasTexture=new _u(this.canvas)),this._canvasTexture}async init(){this.renderer instanceof HK&&(this.renderer.wasmURL=dk.skiaWasmUrl),await this.renderer.init()}render(E){if(this.isFrameDirty){this.isFrameDirty=!1,this._innerApplySize(),this.renderer.clear(),this.frameOverride?.draw(this.renderer),this.renderer.render(),i$.uniforms.tDiffuse.value=this.canvasTexture,this.canvasTexture.needsUpdate=!0;let O=E.getRenderTarget();E.setRenderTarget(this.renderTarget),E.clear(),r$.render(E),E.setRenderTarget(O),this.textureHolder?.setNeedsUpdate(!0)}}updateEntity2DByOp(E,O,R,z){this.scene2d.updateEntityByOp(E,O,R,z),this.applySize()}updateTreeByOp(E,O){this.scene2d.updateTreeByOp(E,O),this.applySize()}applyOverrides(E){if(this.frameOverride&&this.frameRoot){this.frameOverride.position=[0,0],this.frameOverride.rotation=0;let O=E?.width??this.width,R=E?.height??this.height;this.frameOverride.width=O,this.frameOverride.height=R,this.frameOverride.localMatrix=o$,this.isScreenSpace&&(this.frameOverride.fill.color=PT.from0to1([0,0,0,0])),this.frameOverride.data={...this.frameOverride.data,width:O,height:R},XL({objectOverride:this.frameOverride,objectRoot:this.frameRoot,newParentWidth:this.frameOverride.width,newParentHeight:this.frameOverride.height,initialParentWidth:this.frameRoot.width,initialParentHeight:this.frameRoot.height}),this.frameOverride.updateWorldMatrix(!0,!1,!0)}}applySize(E,O=window.devicePixelRatio){let R=Math.max(1,E?.width??this.width),z=Math.max(1,E?.height??this.height);this.dpr=O,this.width=R,this.height=z,this._innerApplySize();let V=1,j=512,Y=512;(R*O<j||z*O<Y)&&(V=Math.max(j/(R*O),Y/(z*O))),this.renderTarget.setSize(R*O*V,z*O*V),this._canvasTexture?.dispose(),this._canvasTexture=void 0,this.applyOverrides(E),this.frameOverride?.requestRender()}applyFrame(E){let O=this.context.scene.find2D(E);if(!(!O||!(O instanceof WJ)))return this.disposeFrameOverride(),this.frameRoot=O,this.frameOverride=O.clone({dpr:this.renderer.dpr,shared:this.context.shared}),this.scene2d.add(this.frameOverride),this.applySize(),this.frame?.addEventListener("render",this.onRenderRequestedDownstream),this.frameOverride.traverse((E=>{E.addEventListener("beginState",this.onFrameOverrideObjectEvent)})),this.frameOverride.traverse((E=>{E.addEventListener("completeState",this.onFrameOverrideObjectEvent)})),this.frame?.requestRender(),O}get frame(){return this.frameOverride}get frameId(){return this.frame?.uuid}find(E){return this.scene2d.find(E)}get texture(){return this.textureHolder?.getTexture(1001)}disposeFrameOverride(){this.frameOverride?.removeEventListener("render",this.onRenderRequestedDownstream),this.frameOverride?.traverse((E=>{E.removeEventListener("beginStateChange",this.onFrameOverrideObjectEvent)})),this.frameOverride?.traverse((E=>{E.removeEventListener("completeState",this.onFrameOverrideObjectEvent)})),this.frameOverride&&this.scene2d.remove(this.frameOverride)}};function XL({objectOverride:E,objectRoot:O,newParentWidth:R,newParentHeight:z,initialParentWidth:V,initialParentHeight:j}){if(E instanceof WJ&&O instanceof WJ||E instanceof RK&&O instanceof RK)for(let Y=0,ee=E.children.length;Y<ee;Y++){let ee=E.children[Y],se=O.children[Y];ee&&se&&ee.uuid===se.uuid&&MZ({objectOverride:ee,objectRoot:se,newParentWidth:R,newParentHeight:z,initialParentWidth:V,initialParentHeight:j})}}function TZ(E){if(bT(E))return[E.width,E.height];if(E instanceof XJ){let[O,R]=E.getHalfSize();return[O*2,R*2]}if(E instanceof RK){let[O,R]=E.recursiveBBox.getHalfSize();return[O*2,R*2]}return[0,0]}function MZ({objectOverride:E,objectRoot:O,newParentWidth:R,newParentHeight:z,initialParentWidth:V,initialParentHeight:j}){let[Y,ee]=TZ(O),{width:se,height:he,position:ce}=mT({constraints:E.data,newParentWidth:R,newParentHeight:z,initialParentWidth:V,initialParentHeight:j,objectInitialWidth:Y,objectInitialHeight:ee,objectInitialPosition:O.position});if(E.position=ce,E.data={...E.data,position:ce},E.states)for(let Y in E.states)CZ({stateId:Y,objectOverride:E,objectRoot:O,newParentWidth:R,newParentHeight:z,initialParentWidth:V,initialParentHeight:j});if(bT(E)||E instanceof RK)bT(E)&&(E.width=se,E.height=he,E.data={...E.data,width:se,height:he}),XL({objectOverride:E,objectRoot:O,newParentWidth:se,newParentHeight:he,initialParentWidth:Y,initialParentHeight:ee});else if(E instanceof XJ){let R=O,z=Y!==0?se/Y:1,V=ee!==0?he/ee:1;E.path=jL(R.path,z,V),E.data={...E.data,path:E.path}}}function CZ({stateId:E,objectOverride:O,objectRoot:R,newParentWidth:z,newParentHeight:V,initialParentWidth:j,initialParentHeight:Y}){let ee=O.states?.[E],se=R.states?.[E];if(ee&&se){let{width:R,height:he,position:ce}=mT({constraints:O.data,newParentWidth:z,newParentHeight:V,initialParentWidth:j,initialParentHeight:Y,objectInitialWidth:kI.isResizeable(se)?se.width:0,objectInitialHeight:kI.isResizeable(se)?se.height:0,objectInitialPosition:se.position});Object.assign(O.states[E],{position:ce}),kI.isResizeable(ee)&&Object.assign(O.states[E],{width:R,height:he})}}function bT(E){return E instanceof KK||E instanceof WJ||E instanceof ZK||E instanceof JK}var d$=class extends(Ad(Wd)){constructor(E,O,R){super();this.data=O;this.bgColor=new $F(1,1,1,1);this.fog=null;this.backupFog=new Hd(16777215,.1,2e3);this.fogUseBGColor=!1;this.isActive=!1;this.aoColor=new On;this.penumbraSizeArrayCache=null;this.super_Entity(E,O),this.personalCamera=new YH(fT,{...uD.defaultData,...O.camera,name:"Personal Camera"}),this.personalCamera.objectHelper.visible=!1,this.add(this.personalCamera),this.activeCamera=this.personalCamera,this.ambientLight=new Bp(13882323,8553090,.75),this.ambientLight.name="Default Ambient Light",this.ambientLight.layers.enable(3),this.ambientLight.removeFromParent(),this.add(this.ambientLight),O.uiScene?this.uiScene=new QJ((Array.isArray(E)?E[0]:E)+"-ui",O.uiScene,{dpr:window.devicePixelRatio,shared:R.shared}):O.uiFrame&&this.createUICanvas(O.uiFrame,R)}get scene(){return this.parent}get postprocessing(){return this.data.postprocessing}get frameId(){return this.data.uiFrame}get frame(){return this.uiCanvas?.frame}createUICanvas(E,O){this.uiCanvas=new h$(this.uuid+"-uiscreen",window.innerWidth,window.innerHeight,O),this.uiCanvas.isScreenSpace=!0,this.uiCanvas.promise.then((()=>{this.uiCanvas?.applyFrame(E),this.uiCanvas?.applySize()}))}updateVisible(){}setBackgroundColor(E){this.bgColor=E,this.fogUseBGColor===!0&&(this.backupFog.color=E)}entityChildrenCount(){return this.uiScene?this.uiScene.children.length:super.entityChildrenCount()}updateAmbientLight(E,O){E.color!==void 0&&(this.ambientLight.color=Zi(E.color,O)),E.intensity!==void 0&&(this.ambientLight.intensity=E.intensity),E.enabled!==void 0&&(E.enabled?this.add(this.ambientLight):this.remove(this.ambientLight))}onDeactive(){this.isActive=!1}onActive(E){this.isActive=!0,E.fog=this.fog,this.traverseEntity((E=>{E instanceof $H&&E.recomputeBoolean()})),this.updateShadow(this.data.shadow)}forceMaterialsUpdate(){this.traverseEntity((E=>{if(E instanceof uj)if(Array.isArray(E.material))for(let O of E.material)O.needsUpdate=!0;else E.material.needsUpdate=!0,E.material.dispose()}))}updateShadow(E){E.softShadowQuality!==void 0&&this.isActive&&xL(E.softShadowQuality)&&this.forceMaterialsUpdate()}updateFog(E,O){if(E.enabled?this.fog=this.backupFog:this.fog=null,this.isActive){let E=this.scene;E.fog=this.fog}this.fogUseBGColor=E.useBackgroundColor,E.useBackgroundColor?this.backupFog.color.set(this.bgColor):this.backupFog.color=Zi(E.color,O),this.backupFog.near=E.near,this.backupFog.far=E.far}updateAo(E,O){E.aoColor!==void 0&&(this.aoColor=Zi(E.aoColor,O))}updateByOp(E,O,R,z){let V=this.data.uiFrame;super.updateByOp(E,O,R,z);let j=O;Vt(E.path,["fog"])?this.updateFog(j.fog,R.shared):Vt(E.path,["ao"])?this.updateAo(j.ao,R.shared):Vt(E.path,["ambient"])?this.updateAmbientLight(j.ambient,R.shared):Vt(E.path,["shadow"])?this.updateShadow(j.shadow):E.type===0&&E.path.length===0&&(E.props.uiFrame!==void 0||V!==j.uiFrame)&&this.updateUIFrame(E.props.uiFrame,R)}updateUIFrame(E,O){E?(this.uiCanvas||this.createUICanvas(E,O),this.uiCanvas.enabled=!0,this.uiCanvas.applyFrame(E)):this.uiCanvas&&(this.uiCanvas.enabled=!1)}updateState(E,O){this.updateState_Entity(E,O),E.backgroundColor!==void 0&&this.setBackgroundColor(Zi(E.backgroundColor,O.shared)),E.fog!==void 0&&this.updateFog(E.fog,O.shared),E.ambient!==void 0&&this.updateAmbientLight(E.ambient,O.shared),E.ao!==void 0&&this.updateAo(E.ao,O.shared),E.shadow!==void 0&&this.updateShadow(E.shadow)}createFrame(E,O){}raycast(E,O){super.raycast(E,O)}switchActiveCamera(E){E&&E.isDescendantOf(this)&&(this.activeCamera!==this.personalCamera&&(this.activeCamera.objectHelper.visible=!0),this.activeCamera=E,E.objectHelper.visible=!1)}get playCamera(){return this.scene?.find(this.data.publish.playCamera)??this.personalCamera}switchToPlayCamera(){this.switchActiveCamera(this.playCamera)}get penumbraSizeArray(){return this.penumbraSizeArrayCache===null&&this.updatePenumbraSizeArray(),this.penumbraSizeArrayCache}updatePenumbraSizeArray(){this.penumbraSizeArrayCache=new Array(5).fill(.5);let E=0,O=0;this.traverseEntity((R=>{if(!R.visible)return!0;R instanceof AK&&R.visible&&E<3&&(this.penumbraSizeArrayCache[E]=R.data.penumbraSize??.5,E+=1),R instanceof TK&&R.visible&&E<2&&(this.penumbraSizeArrayCache[3+O]=R.data.penumbraSize??.5,O+=1)}))}raycastWithClones(E){let O=[],i=R=>{for(let z of R.children){let R=z.cloner;oL.is(z)&&(z.visible||R?.object.data.visible)&&((un(z)||zm(z)&&this.scene.enableHelpers&&z.objectHelper.visible)&&(E.intersectObject(z,!1,O),Km(z,E,O,!0)),i(z))}};return i(this),O}updateEntity2DByOp(E,O,R,z){this.uiCanvas?.updateEntity2DByOp(E,O,R,z)}};var p$=class extends(ff(Zp,bK)){constructor(E,O,R){super(),this.super_Entity(E,O),this.castShadow=!0,this.shadow.mapSize.width=1024,this.shadow.mapSize.height=1024,this.shadow.normalBias=1,this.layers.enable(3);let z=this.shadow.camera;z.fov=90,z.aspect=1,z.near=100,z.far=2500;let V=new Wn(-z.far+this.position.x,-z.far+this.position.y,-z.far+this.position.z),j=new Wn(z.far+this.position.x,z.far+this.position.y,z.far+this.position.z),Y=new Yn(V,j),ee=new qf(Y,new On(16755200));ee.visible=!1,this.gizmos.shadowmap=ee,this.update()}update(){if(this.shadow&&(this.shadow.camera.updateProjectionMatrix(),this.gizmos))for(let E in this.gizmos){let O=this.gizmos[E];if(O instanceof qf){let E=this.shadow.camera,R=new Wn(-E.far+this.position.x,-E.far+this.position.y,-E.far+this.position.z),z=new Wn(E.far+this.position.x,E.far+this.position.y,E.far+this.position.z);O.box.set(R,z),O.updateMatrixWorld(!0)}}}updateMatrixWorld(E){super.updateMatrixWorld(E),this.objectHelper&&this.objectHelper.update()}updateState(E,O){this.updateState_Light(E,O),E.distance!==void 0&&(this.distance=E.distance),E.decay!==void 0&&(this.decay=E.decay),E.shadowRadius!==void 0&&(this.shadow.radius=E.shadowRadius),E.shadowResolution!==void 0&&(this.shadow.mapSize.set(E.shadowResolution,E.shadowResolution),this.shadow.map&&(this.shadow.map.dispose(),this.shadow.map=null))}};var f$=class extends _j{get forceComputeSize(){return!0}get shape(){return this.geometry.userData.shape}updateEntityBoxSize(E,O){let R=this.geometry.getAttribute("position");R!==void 0?Am(R,this.geometry.drawRange.start,this.geometry.drawRange.count<1/0?this.geometry.drawRange.count:R.count,E,O):super.updateEntityBoxSize(E,O)}};var m$=class extends _j{constructor(E,O,R){super(E,O,R);this._shapeId=null;this._context=R}updateState(E,O){super.updateState(E,O),this.updateShape(),this.refreshAttachedCloners(O)}updateShape(){let E={...this.data.geometry.extrusion.shape};for(let O in E)typeof E[O]=="string"&&(E[O]=this._context.shared.getVariable(E[O],[this.uuid,"geometry","extrusion","shape",O]));let O;if(E.type==="Custom"){let R=E.shapeId;if(R!==this._shapeId&&this.detachShape(),R){this._shapeId=R;let E=this._context.scene.find(R);E?.data&&(E.attachedPaths.add(this),O=E.geometry.userData?.shape),O||this._context.scene.addPendingCommand((()=>this.updateShape()))}}else{let R;switch(E.type){case"Rectangle":R=Az;break;case"Ellipse":R=nz;break;case"Polygon":R=wz;break;case"Star":R=Pz;break;default:throw new Error(`Unknown shape type: ${E.type}`)}O=R.create({parameters:E}).userData.shape}let R=this.geometry;O&&R.inputs&&(R.inputs.shapeData=O,R.build())}detachShape(){this._shapeId!==null&&this._context.scene.find(this._shapeId)?.attachedPaths.delete(this)}createGeometryDelayed(E){this.geometryCreateDeleyed=E.shared,this.updateShape(),this.refreshAttachedPaths(E)}updateTransformState(E,O){return super.updateTransformState(E,O)}updateGeometryInteractions(E,O){super.updateGeometryInteractions(E,O),this.updateShape()}updateEntityBoxSize(E,O){let R=this.geometry.getAttribute("position");R!==void 0?Am(R,this.geometry.drawRange.start,this.geometry.drawRange.count<1/0?this.geometry.drawRange.count:R.count,E,O):super.updateEntityBoxSize(E,O)}};var g$=class extends sH{constructor(E,O,R){super(E,O,R);this.data=O}};var v$=class extends(ws(Fd,pW)){constructor(E,O,R){super();O.type==="Instance"&&typeof E=="string"&&(O=this.transformAssignData(O,R)),this.super_Entity(E,O),this.objectHelper.update()}get isComponentRoot(){return this.data.type==="Component"&&typeof this.identity=="string"}get isInstanceRoot(){return this.data.type==="Instance"&&typeof this.identity=="string"}transformAssignData(E,O){let R=iI.getComponentData({scene:O.scene.data,shared:O.shared.data},E.component);if(R){let O,z;for(let V of mD.rootOverrideProps)E[V]===void 0?(O===void 0&&(O={...E}),O[V]=R.data[V]):(z===void 0&&(z={}),z[V]=E[V],O===void 0&&(O={...E}),O[V]=GM.apply(R.data[V],E[V]));return this.overrideData=z,O}return{...aD.defaultData,...E,...vM(aD.defaultData,mD.rootOverrideProps)}}updateByOp(E,O,R,z){let V;if(this.isInstanceRoot&&!z)if(O=this.transformAssignData(O,R),E.type===0&&E.path.length===0&&this.component)for(let O of mD.rootOverrideProps)O in E.props&&E.props[O]===void 0&&(V===void 0&&(V={...E,props:{...E.props}}),V.props[O]=this.component.data[O]);else if(E.type===0&&E.path.length>0&&mD.rootOverrideProps.includes(E.path[0])){let R=E.path[0];V===void 0&&(V={...E,path:[],props:{[R]:O[R]}})}super.updateByOp(V??E,O,R,z)}updateState(E,O){this.updateState_Entity(E,O)}expandInstanceChildren(E){let O=this.data;if(this.component===void 0){let R=E.scene.find(O.component)??null,z=!1;if(R!==this.oldComponent){if(this.oldComponent){let O=0;for(let R of this.children){if(!oL.is(R))break;E.scene.disposeAndUnregisterEntityRecursivelyIfNotReregistered(R),nb(R),O+=1}this.children.splice(0,O)}z=!0}if(R){let V={};KL(E,[this.uuid],O.overrides,this,R,R,0,z,V);for(let O of this.children)if(oL.is(O)){let R=O.data;R.type==="Empty"&&R.animations&&O.traverseEntity((O=>{let R=O.dataPatched;if(O instanceof _j&&R.bones&&R.boneInverses){let R=O.dataPatched;if(R.bones&&R.boneInverses){let z=R.bones.map((O=>E.scene.find(V[O]))),j=R.boneInverses.map((E=>(new Es).fromArray(E))),Y=new $d(z,j);O.bind(Y,O.bindMatrix)}}else O.matrixAutoUpdate=!0}))}}this.oldComponent=this.component}}};function nb(E){if(E.component){let O=E.component.instances.indexOf(E);O>=0&&E.component.instances.splice(O,1);for(let O of E.children)oL.is(O)&&nb(O)}}function YL(E,O,R,z){return E.component===O&&eM(E.identity,z)?E.overrideData===R?2:1:0}function KL(E,O,R,z,V,j,Y,ee,se){if(Y>50)return!1;if(z.component!==V){if(z.component){let E=z.component.instances.indexOf(z);E>=0&&z.component.instances.splice(E,1)}V.instances.find((E=>E===z))||V.instances.push(z),z.component=V}V instanceof v$&&V.isInstanceRoot&&V.expandInstanceChildren(E);let he=0;for(let ce of V.children)if(oL.is(ce)){let V=[...O,...typeof ce.identity=="string"?[ce.identity]:ce.identity],ue=fD.resolve(R,V,1);if(ue!=null&&!(ue instanceof HM)){!1;Object.setPrototypeOf(ue,HM.prototype),console.error("wrong prototype")}let fe,ve=null;if(!ee){let O=z.children[he];if(ve=oL.is(O)?O:null,ve!==null){let E=YL(ve,ce,ue,V);fe=E>=1?ve.stateSelection:void 0,E!==2&&(ve=null)}if(ve===null&&(ve=E.scene.findInstance(V)??null,ve!==null)){let O=YL(ve,ce,ue,V);if(fe=O>=1?ve.stateSelection:void 0,O!==2)ve=null;else{let O=ve.parent.children.indexOf(ve);ve.parent.children.splice(O,1),z.children.splice(he,0,ve),ve.parent===z?(O<=he&&console.error("not possible"),void 0):(ve.parent=z,ve.matrixWorldNeedsUpdate=!0,ve.resetBBoxNeedsUpdate(),ve.updateVisible(),E.pendingDeletes.delete(ve),void 0)}}}if(ve===null){let O=ue?GM.apply(ce.data,ue):ce.data;$T.is(O.type)&&(O={...O,type:"Empty"}),ve=nL.createEntity(V,O,E),ve.overrideData=ue,z.add(ve),z.children.splice(z.children.length-1,1),z.children.splice(he,0,ve),ve.updateState(ve.data,E),fe&&ve.changeSelectedState(fe,E),E.scene.registerInstanceAndSetUuid(ve)}if(ve.isBone){let E=ve.identity[ve.identity.length-1];se[E]=ve.uuid}he+=1,KL(E,O,R,ve,ce,j,Y+1,ee,se)}if(!ee){let O=he;for(;;){let O=z.children[he];if(!oL.is(O))break;E.pendingDeletes.add(O);he+=1}z.children.splice(O,he-O)}return!0}var y$=class extends(ws(Qd,pW)){constructor(E,O){super(),this.super_Entity(E,O),this.objectHelper.update(),this.matrixAutoUpdate=!0}updateState(E,O){this.updateState_Entity(E,O)}};var x$=class extends _j{constructor(E,O,R){super(E,O,R);this.onBeforeRender=E=>{this.uiCanvas.render(E)};this.uiCanvas=new h$(E+"-canvas",O.geometry.width,O.geometry.height,R),this.uiCanvas.promise.then((()=>{this.applyFrame(this.dataPatched.geometry.frame,R.shared)}))}updateByPatchedOpGeometry(E,O,R){super.updateByPatchedOpGeometry(E,O,R),E.type===0&&(E.props.frame!==void 0&&this.applyFrame(E.props.frame,R.shared),(E.props.width!==void 0||E.props.height!==void 0)&&this.applySize(E.props,R.shared))}applySize(E,O){let R=E?.width??this.dataPatched.geometry.width,z=E?.height??this.dataPatched.geometry.height;this.uiCanvas.applySize({width:R,height:z}),this.applyGeometryParametersFromFrame(O)}applyFrame(E,O){this.uiCanvas.applyFrame(E),this.applyGeometryParametersFromFrame(O),this.applyMaterialParametersFromFrame({shared:O})}applyGeometryParametersFromFrame(E){let O=this.frame;O&&(Object.assign(this.data,{geometry:Object.assign(this.data.geometry,{cornerRadius:O.cornerRadius,cornerType:0})}),Object.assign(this.dataPatched,{geometry:Object.assign(this.dataPatched.geometry,{cornerRadius:O.cornerRadius,cornerType:0})}),this.localGeometry?.dispose(),this.localGeometry=Ba(this.dataPatched.geometry,E,this.data.flatShading,this))}applyMaterialParametersFromFrame(E){let O=this.frame;if(O){let R=O.data.backgroundBlur;Object.assign(this.data.material.layers[0].data.texture,{image:this.uiCanvas.uuid}),Object.assign(this.data.material.layers[1].data,{roughness:R.radius,alpha:R.enabled?1:0}),Object.assign(this.dataPatched.material.layers[0].data.texture,{image:this.uiCanvas.uuid}),Object.assign(this.dataPatched.material.layers[1].data,{roughness:R.radius,alpha:R.enabled?1:0}),this.material.reset(this.dataPatched.material,E,!0)}}updateEntity2DByOp(E,O,R,z){this.uiCanvas.updateEntity2DByOp(E,O,R,z),E===this.frameId&&O.type===0&&(O.props.cornerRadius!==void 0?this.applyGeometryParametersFromFrame(z):Vt(O.path,["backgroundBlur"])&&this.applyMaterialParametersFromFrame({shared:z}))}get frame(){return this.uiCanvas.frame}get frameId(){return this.frame?.uuid}removeInteractionGeometry(E){super.removeInteractionGeometry(E),this.applySize({},E)}updateGeometryInteractions(E,O){super.updateGeometryInteractions(E,O),this.applySize({width:E.width,height:E.height},O)}};var b$=class{constructor(E,O,R){this.variables=[],this.currentTextureIndex=0;let z=Ii,V=new Wd,j=new co;j.position.z=1;let Y={passThruTexture:{value:null}},ee=h(f(),Y),se=new eo(new Co(2,2),ee);V.add(se),this.setDataType=function(E){return z=E,this},this.addVariable=function(E,O,R){let z=this.createShaderMaterial(O),V={name:E,initialValueTexture:R,material:z,dependencies:null,renderTargets:[],wrapS:null,wrapT:null,minFilter:mi,magFilter:mi};return this.variables.push(V),V},this.setVariableDependencies=function(E,O){E.dependencies=O},this.init=function(){if(R.capabilities.isWebGL2===!1&&R.extensions.has("OES_texture_float")===!1)return"No OES_texture_float support for float textures.";if(R.capabilities.maxVertexTextures===0)return"No support for vertex shader textures.";for(let R=0;R<this.variables.length;R++){let z=this.variables[R];z.renderTargets[0]=this.createRenderTarget(E,O,z.wrapS,z.wrapT,z.minFilter,z.magFilter),z.renderTargets[1]=this.createRenderTarget(E,O,z.wrapS,z.wrapT,z.minFilter,z.magFilter),this.renderTexture(z.initialValueTexture,z.renderTargets[0]),this.renderTexture(z.initialValueTexture,z.renderTargets[1]);let V=z.material,j=V.uniforms;if(z.dependencies!==null)for(let E=0;E<z.dependencies.length;E++){let O=z.dependencies[E];if(O.name!==z.name){let E=!1;for(let R=0;R<this.variables.length;R++)if(O.name===this.variables[R].name){E=!0;break}if(!E)return"Variable dependency not found. Variable="+z.name+", dependency="+O.name}j[O.name]={value:null},V.fragmentShader="\nuniform sampler2D "+O.name+";\n"+V.fragmentShader}}return this.currentTextureIndex=0,null},this.compute=function(){let E=this.currentTextureIndex,O=this.currentTextureIndex===0?1:0;for(let R=0,z=this.variables.length;R<z;R++){let z=this.variables[R];if(z.dependencies!==null){let O=z.material.uniforms;for(let R=0,V=z.dependencies.length;R<V;R++){let V=z.dependencies[R];O[V.name].value=V.renderTargets[E].texture}}this.doRenderTarget(z.material,z.renderTargets[O])}this.currentTextureIndex=O},this.getCurrentRenderTarget=function(E){return E.renderTargets[this.currentTextureIndex]},this.getAlternateRenderTarget=function(E){return E.renderTargets[this.currentTextureIndex===0?1:0]},this.dispose=function(){se.geometry.dispose(),se.material.dispose();let E=this.variables;for(let O=0;O<E.length;O++){let R=E[O];R.initialValueTexture&&R.initialValueTexture.dispose();let z=R.renderTargets;for(let E=0;E<z.length;E++)z[E].dispose()}};function u(R){R.defines.resolution="vec2( "+E.toFixed(1)+", "+O.toFixed(1)+" )"}this.addResolutionDefine=u;function h(E,O){O=O||{};let R=new lo({uniforms:O,vertexShader:d(),fragmentShader:E});return u(R),R}this.createShaderMaterial=h,this.createRenderTarget=function(R,V,j,Y,ee,se){return R=R||E,V=V||O,j=j||ui,Y=Y||ui,ee=ee||mi,se=se||mi,new Un(R,V,{wrapS:j,wrapT:Y,minFilter:ee,magFilter:se,format:Ni,type:z,depthBuffer:!1})},this.createTexture=function(){let R=new Float32Array(E*O*4),z=new Zd(R,E,O,Ni,Ii);return z.needsUpdate=!0,z},this.renderTexture=function(E,O){Y.passThruTexture.value=E,this.doRenderTarget(ee,O),Y.passThruTexture.value=null},this.doRenderTarget=function(E,O){let z=R.getRenderTarget(),Y=R.xr.enabled,he=R.shadowMap.autoUpdate,ce=R.outputEncoding,ue=R.toneMapping;R.xr.enabled=!1,R.shadowMap.autoUpdate=!1,R.outputEncoding=Xr,R.toneMapping=Xt,se.material=E,R.setRenderTarget(O),R.render(V,j),se.material=ee,R.xr.enabled=Y,R.shadowMap.autoUpdate=he,R.outputEncoding=ce,R.toneMapping=ue,R.setRenderTarget(z)};function d(){return"void main()\t{\n\n\tgl_Position = vec4( position, 1.0 );\n\n}\n"}function f(){return"uniform sampler2D passThruTexture;\n\nvoid main() {\n\n\tvec2 uv = gl_FragCoord.xy / resolution.xy;\n\n\tgl_FragColor = texture2D( passThruTexture, uv );\n\n}\n"}}};var S$=new ga,_$=new Wn,A$=class{constructor(E){let O=E.geometry;if(!O.isBufferGeometry||O.attributes.position.itemSize!==3)throw new Error("THREE.MeshSurfaceSampler: Requires BufferGeometry triangle mesh.");O.index&&(console.warn("THREE.MeshSurfaceSampler: Converting geometry to non-indexed BufferGeometry."),O=O.toNonIndexed()),this.geometry=O,this.randomFunction=Math.random,this.positionAttribute=this.geometry.getAttribute("position"),this.colorAttribute=this.geometry.getAttribute("color"),this.weightAttribute=null,this.distribution=null}setWeightAttribute(E){return this.weightAttribute=E?this.geometry.getAttribute(E):null,this}build(){let E=this.positionAttribute,O=this.weightAttribute,R=new Float32Array(E.count/3);for(let z=0;z<E.count;z+=3){let V=1;O&&(V=O.getX(z)+O.getX(z+1)+O.getX(z+2)),S$.a.fromBufferAttribute(E,z),S$.b.fromBufferAttribute(E,z+1),S$.c.fromBufferAttribute(E,z+2),V*=S$.getArea(),R[z/3]=V}this.distribution=new Float32Array(E.count/3);let z=0;for(let E=0;E<R.length;E++)z+=R[E],this.distribution[E]=z;return this}setRandomGenerator(E){return this.randomFunction=E,this}sample(E,O,R){let z=this.distribution[this.distribution.length-1],V=this.binarySearch(this.randomFunction()*z);return this.sampleFace(V,E,O,R)}binarySearch(E){let O=this.distribution,R=0,z=O.length-1,V=-1;for(;R<=z;){let j=Math.ceil((R+z)/2);if(j===0||O[j-1]<=E&&O[j]>E){V=j;break}E<O[j]?z=j-1:R=j+1}return V}sampleFace(E,O,R,z){let V=this.randomFunction(),j=this.randomFunction();return V+j>1&&(V=1-V,j=1-j),S$.a.fromBufferAttribute(this.positionAttribute,E*3),S$.b.fromBufferAttribute(this.positionAttribute,E*3+1),S$.c.fromBufferAttribute(this.positionAttribute,E*3+2),O.set(0,0,0).addScaledVector(S$.a,V).addScaledVector(S$.b,j).addScaledVector(S$.c,1-(V+j)),R!==void 0&&S$.getNormal(R),z!==void 0&&this.colorAttribute!==void 0&&(S$.a.fromBufferAttribute(this.colorAttribute,E*3),S$.b.fromBufferAttribute(this.colorAttribute,E*3+1),S$.c.fromBufferAttribute(this.colorAttribute,E*3+2),_$.set(0,0,0).addScaledVector(S$.a,V).addScaledVector(S$.b,j).addScaledVector(S$.c,1-(V+j)),z.r=_$.x,z.g=_$.y,z.b=_$.z),this}};function QL(E){let O=new Float32Array(E*E*2);for(let R=0;R<E;R++)for(let z=0;z<E;z++){let V=R*E+z;O[V*2+0]=R/(E-1),O[V*2+1]=z/(E-1)}return O}function ZL(E){let O=Math.ceil(Math.sqrt(E));return Math.max(O,1)}function JL(E,O){let R=new eo(E.geometry,E.material),z=[],V=[],j=new Wn,Y=new Wn;R.geometry.index!==null&&(R.geometry=R.geometry.toNonIndexed());let ee=new A$(R).build();for(let E=0;E<O;E++)ee.sample(j,Y),z.push(j.x,j.y,j.z),V.push(Y.x,Y.y,Y.z);let se=new Float32Array(z),he=new Float32Array(V);return{positions:se,normals:he}}function ST(E,O){let R=E,z=new Float32Array(4*O*O);for(let E=0;E<O*O;E++)z[4*E]=R[3*E],z[4*E+1]=R[3*E+1],z[4*E+2]=R[3*E+2],z[4*E+3]=0;let V=new Zd(z,O,O,Ni,Ii);return V.needsUpdate=!0,V}function $L({size:E}){let O=new Float32Array(4*E*E);for(let R=0;R<E*E;R++)O[4*R]=R,O[4*R+1]=0,O[4*R+2]=0,O[4*R+3]=0;let R=new Zd(O,E,E,Ni,Ii);return R.needsUpdate=!0,R}function eB(E){let O=new Float32Array(4*E*E);for(let R=0;R<E*E;R++)O[4*R]=0,O[4*R+1]=0,O[4*R+2]=0,O[4*R+3]=0;let R=new Zd(O,E,E,Ni,Ii);return R.needsUpdate=!0,R}var M$="\n// uniform sampler2D uCurrentPosition; // Pass in the variable from GPGPU\n// uniform sampler2D uCurrentVelocity; // Pass in the variable from GPGPU\n// uniform sampler2D uCurrentEmissionRate; // Pass in the variable from GPGPU\nuniform sampler2D uOriginalPosition;\nuniform float uTime;\nuniform float uSpeed;     // update speed of the particles\nuniform vec3 uWorldOffset;    \nuniform vec4 uWorldQuaternion;\nuniform float uMaxLifeTime;\nuniform vec3 uEmitterSize;\nuniform float uFPSRatio;     // 1  for 60 FPS\n\nfloat random (vec2 st) {\n    return fract(sin(dot(st.xy,\n        vec2(12.9898,78.233)))*\n        43758.5453123);\n}\nvec3 applyQuaternionToVector( vec4 q, vec3 v ){\n    return v + 2.0 * cross( q.xyz, cross( q.xyz, v ) + q.w * v );\n}\n\nvec3 applyForce(vec3 force, float mass) {\n    vec3 acceleration = force / mass;\n    \n    return acceleration;\n  }\n  \n\nvoid main() {\n    vec2 vUv = gl_FragCoord.xy / resolution.xy;\n    vec3 position = texture2D( uCurrentPosition, vUv ).xyz;\n    float currentLife = texture2D( uCurrentPosition, vUv ).w;   // from 1 to 0\n    float isSpawning = texture2D( uCurrentEmissionRate, vUv ).r;        // 1. = spawning, 0. = not spawning\n    float isActive = texture2D( uCurrentEmissionRate, vUv ).g;          // 1. = active, 0. = not active\n    float timeStart = texture2D( uCurrentEmissionRate, vUv ).b;         // timeStart in seconds when the particle was emitted\n    vec3 originalPosition = ((texture2D( uOriginalPosition, vUv ).xyz) * uEmitterSize);\n    vec3 velocity = texture2D( uCurrentVelocity, vUv ).xyz;\n    float collisionFlag = texture2D( uCurrentVelocity, vUv ).w;             // 1. = collided, 0. = not collided\n    float lifeTime = uMaxLifeTime;\n\n    // Calculate the position adjustment based on collision\n    //     if (collisionFlag > .5) {  \n    float isColliding = step(0.5, collisionFlag); // 1.0 if collisionFlag > 0.5, otherwise 0.0\n    float bounceOffset = 3.0 * isColliding; // Becomes 3.0 if colliding, 0.0 otherwise\n    vec3 collisionAdjustedVelocity = velocity * (1.0 + bounceOffset);\n\n    // Update position based on collision or normal movement\n    vec3 fpsVelocity = velocity * min(uFPSRatio, 5.0);\n    position += mix(fpsVelocity, collisionAdjustedVelocity, isColliding);\n\n    // EMISSION RATE - BIRTH\n    // if (isSpawning == 1.0) {\n    // Better Approach to avoid If statement\n    vec3 newPosition = applyQuaternionToVector(uWorldQuaternion, originalPosition) + uWorldOffset;\n    originalPosition = mix(originalPosition, newPosition, isSpawning);\n    position = mix(position, originalPosition, isSpawning);;\n    timeStart = mix(timeStart, uTime, isSpawning);\n\n    // Calculate timeLeft for life normalization\n    float timeLeft = max(lifeTime - (uTime - timeStart), 0.0);\n    float life_Normalize = timeLeft / lifeTime;\n\n    // Use isActive to blend between the calculated color and black\n    vec4 activeColor = vec4(position, life_Normalize);\n    // if (isActive == 1.0) {\n    gl_FragColor = mix(vec4(0.0), activeColor, isActive);\n\n}\n";var E$="\n\n    vec3 mod289(vec3 x) {\n      return x - floor(x * (1.0 / 289.0)) * 289.0;\n    }\n    \n    vec4 mod289(vec4 x) {\n    return x - floor(x * (1.0 / 289.0)) * 289.0;\n    }\n    \n    vec4 permute(vec4 x) {\n        return mod289(((x*34.0)+1.0)*x);\n    }\n    \n    vec4 taylorInvSqrt(vec4 r)\n    {\n    return 1.79284291400159 - 0.85373472095314 * r;\n    }\n    \n    vec3 fade(vec3 t) {\n  return t*t*t*(t*(t*6.0-15.0)+10.0);\n}\n\n    float snoise(vec3 v)\n    {\n    const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;\n    const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);\n    vec3 i  = floor(v + dot(v, C.yyy) );\n    vec3 x0 =   v - i + dot(i, C.xxx) ;\n    vec3 g = step(x0.yzx, x0.xyz);\n    vec3 l = 1.0 - g;\n    vec3 i1 = min( g.xyz, l.zxy );\n    vec3 i2 = max( g.xyz, l.zxy );\n    vec3 x1 = x0 - i1 + C.xxx;\n    vec3 x2 = x0 - i2 + C.yyy; // 2.0*C.x = 1/3 = C.y\n    vec3 x3 = x0 - D.yyy;      // -1.0+3.0*C.x = -0.5 = -D.y\n    \n    // Permutations\n    i = mod289(i);\n    vec4 p = permute( permute( permute(\n                i.z + vec4(0.0, i1.z, i2.z, 1.0 ))\n              + i.y + vec4(0.0, i1.y, i2.y, 1.0 ))\n              + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));\n    \n    // Gradients: 7x7 points over a square, mapped onto an octahedron.\n    // The ring size 17*17 = 289 is close to a multiple of 49 (49*6 = 294)\n    float n_ = 0.142857142857; // 1.0/7.0\n    vec3  ns = n_ * D.wyz - D.xzx;\n    \n    vec4 j = p - 49.0 * floor(p * ns.z * ns.z);  //  mod(p,7*7)\n    \n    vec4 x_ = floor(j * ns.z);\n    vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)\n    \n    vec4 x = x_ *ns.x + ns.yyyy;\n    vec4 y = y_ *ns.x + ns.yyyy;\n    vec4 h = 1.0 - abs(x) - abs(y);\n    \n    vec4 b0 = vec4( x.xy, y.xy );\n    vec4 b1 = vec4( x.zw, y.zw );\n    \n    vec4 s0 = floor(b0)*2.0 + 1.0;\n    vec4 s1 = floor(b1)*2.0 + 1.0;\n    vec4 sh = -step(h, vec4(0.0));\n    \n    vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;\n    vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;\n    \n    vec3 p0 = vec3(a0.xy,h.x);\n    vec3 p1 = vec3(a0.zw,h.y);\n    vec3 p2 = vec3(a1.xy,h.z);\n    vec3 p3 = vec3(a1.zw,h.w);\n    \n    //Normalise gradients\n    vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));\n    p0 *= norm.x;\n    p1 *= norm.y;\n    p2 *= norm.z;\n    p3 *= norm.w;\n    \n    // Mix final noise value\n    vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);\n    m = m * m;\n    return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1),\n                                  dot(p2,x2), dot(p3,x3) ) );\n    }\n    \n    vec3 snoiseVec3( vec3 x ){\n    \n      float s  = snoise(vec3( x ));\n      float s1 = snoise(vec3( x.y - 19.1 , x.z + 33.4 , x.x + 47.2 ));\n      float s2 = snoise(vec3( x.z + 74.2 , x.x - 124.5 , x.y + 99.4 ));\n      vec3 c = vec3( s , s1 , s2 );\n      return c;\n    \n    }\n    \n      \n    vec3 curlNoise( vec3 p, float seed){\n      p += seed;\n      const float e = .1;\n      vec3 dx = vec3( e   , 0.0 , 0.0 );\n      vec3 dy = vec3( 0.0 , e   , 0.0 );\n      vec3 dz = vec3( 0.0 , 0.0 , e   );\n    \n      vec3 p_x0 = snoiseVec3( p - dx );\n      vec3 p_x1 = snoiseVec3( p + dx );\n      vec3 p_y0 = snoiseVec3( p - dy );\n      vec3 p_y1 = snoiseVec3( p + dy );\n      vec3 p_z0 = snoiseVec3( p - dz );\n      vec3 p_z1 = snoiseVec3( p + dz );\n    \n      float x = p_y1.z - p_y0.z - p_z1.y + p_z0.y;\n      float y = p_z1.x - p_z0.x - p_x1.z + p_x0.z;\n      float z = p_x1.y - p_x0.y - p_y1.x + p_y0.x;\n    \n      const float divisor = 1.0 / ( 2.0 * e );\n      return normalize( vec3( x , y , z ) * divisor );\n    \n    }\n\n\n// Classic Perlin noise\nfloat cnoise(vec3 P)\n{\n  vec3 Pi0 = floor(P); // Integer part for indexing\n  vec3 Pi1 = Pi0 + vec3(1.0); // Integer part + 1\n  Pi0 = mod289(Pi0);\n  Pi1 = mod289(Pi1);\n  vec3 Pf0 = fract(P); // Fractional part for interpolation\n  vec3 Pf1 = Pf0 - vec3(1.0); // Fractional part - 1.0\n  vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);\n  vec4 iy = vec4(Pi0.yy, Pi1.yy);\n  vec4 iz0 = Pi0.zzzz;\n  vec4 iz1 = Pi1.zzzz;\n\n  vec4 ixy = permute(permute(ix) + iy);\n  vec4 ixy0 = permute(ixy + iz0);\n  vec4 ixy1 = permute(ixy + iz1);\n\n  vec4 gx0 = ixy0 * (1.0 / 7.0);\n  vec4 gy0 = fract(floor(gx0) * (1.0 / 7.0)) - 0.5;\n  gx0 = fract(gx0);\n  vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);\n  vec4 sz0 = step(gz0, vec4(0.0));\n  gx0 -= sz0 * (step(0.0, gx0) - 0.5);\n  gy0 -= sz0 * (step(0.0, gy0) - 0.5);\n\n  vec4 gx1 = ixy1 * (1.0 / 7.0);\n  vec4 gy1 = fract(floor(gx1) * (1.0 / 7.0)) - 0.5;\n  gx1 = fract(gx1);\n  vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);\n  vec4 sz1 = step(gz1, vec4(0.0));\n  gx1 -= sz1 * (step(0.0, gx1) - 0.5);\n  gy1 -= sz1 * (step(0.0, gy1) - 0.5);\n\n  vec3 g000 = vec3(gx0.x,gy0.x,gz0.x);\n  vec3 g100 = vec3(gx0.y,gy0.y,gz0.y);\n  vec3 g010 = vec3(gx0.z,gy0.z,gz0.z);\n  vec3 g110 = vec3(gx0.w,gy0.w,gz0.w);\n  vec3 g001 = vec3(gx1.x,gy1.x,gz1.x);\n  vec3 g101 = vec3(gx1.y,gy1.y,gz1.y);\n  vec3 g011 = vec3(gx1.z,gy1.z,gz1.z);\n  vec3 g111 = vec3(gx1.w,gy1.w,gz1.w);\n\n  vec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));\n  g000 *= norm0.x;\n  g010 *= norm0.y;\n  g100 *= norm0.z;\n  g110 *= norm0.w;\n  vec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));\n  g001 *= norm1.x;\n  g011 *= norm1.y;\n  g101 *= norm1.z;\n  g111 *= norm1.w;\n\n  float n000 = dot(g000, Pf0);\n  float n100 = dot(g100, vec3(Pf1.x, Pf0.yz));\n  float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));\n  float n110 = dot(g110, vec3(Pf1.xy, Pf0.z));\n  float n001 = dot(g001, vec3(Pf0.xy, Pf1.z));\n  float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));\n  float n011 = dot(g011, vec3(Pf0.x, Pf1.yz));\n  float n111 = dot(g111, Pf1);\n\n  vec3 fade_xyz = fade(Pf0);\n  vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fade_xyz.z);\n  vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);\n  float n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x); \n  return 2.2 * n_xyz;\n}\n\n\nvec3 fbm_vec3(vec3 p, float frequency, float offset)\n{\n  return vec3(\n    cnoise((p+vec3(offset))*frequency),\n    cnoise((p+vec3(offset+20.0))*frequency),\n    cnoise((p+vec3(offset-30.0))*frequency)\n  );\n}\n\n";var C$="\n  #ifdef USE_COLLIDER\n    float restitution = max(uBounce * 2., .01); // Energy Loss\n    // SPHERE COLLIDER\n    // **************************************************************\n    #ifdef USE_SPHERE_COLLIDER       \n      // Convert collider size to radii (assuming uColliderSize is the diameter in each axis)\n      vec3 radii = uColliderSize;\n      // Adjust position relative to collider\n      vec3 relPos = position - uColliderPos;\n      // Apply rotation of the collider to the relative position\n      relPos = applyQuaternionToVector(uColliderQuaternionInvert, relPos);            \n      // Scale relative position by radii (for ellipsoid collision detection)\n      vec3 scaledPos = relPos / radii;\n      // Calculate ellipsoidal distance\n      float dist = length(scaledPos); // Distance in terms of ellipsoid\n      \n      // Check for collision\n      if (dist <= 1. + particleSize / length(radii) && collisionFlag == 0.0) {\n          // Compute the normal at the collision point, accounting for particle size\n        vec3 adjustedPos = scaledPos * (1.0 + particleSize / length(radii));          \n        // Compute the normal at the collision point\n        vec3 normal = ellipsoidNormal(adjustedPos, radii);\n        // Rotate the normal back to world space\n        normal = applyQuaternionToVector(uColliderQuaternion, normal);\n        // Reflect the velocity vector off the normal\n        velocity = reflect(velocity, normal) * restitution;\n\n        collisionFlag = 1.0;\n      } else {\n        collisionFlag = 0.0;\n      }\n    #endif\n\n    // BOX COLLIDER or PLANE COLLIDER \n    // **************************************************************\n    #ifdef USE_BOX_COLLIDER\n      // Box dimensions and repulsion variables\n      vec3 boxHalfSize = uColliderSize / 2.0;\n      // Convert world position to box's local space\n      vec3 localPos = applyQuaternionToVector(uColliderQuaternionInvert, position - uColliderPos);      \n      // Collision detection\n      vec3 localDistance = abs(localPos) - boxHalfSize;\n      float distToSurface = max(localDistance.x, max(localDistance.y, localDistance.z));    \n\n      // Collision Detected\n      if (distToSurface <= particleSize * 0.5 && collisionFlag == 0.0) {      \n        // Find the nearest face normal for bounce direction\n        vec3 normal;\n        if (localDistance.x > localDistance.y && localDistance.x > localDistance.z) {\n            normal = vec3(sign(localPos.x), 0.0, 0.0);\n        } else if (localDistance.y > localDistance.z) {\n            normal = vec3(0.0, sign(localPos.y), 0.0);\n        } else {\n            normal = vec3(0.0, 0.0, sign(localPos.z));\n        }            \n        // Rotate normal back to world space\n        normal = applyQuaternionToVector(uColliderQuaternion, normal);      \n        // Reflect velocity and apply repulsion force\n        velocity = reflect(velocity, normal) * restitution;\n        \n        collisionFlag = 1.0;\n      } else {\n        collisionFlag = 0.0;\n      }\n    #endif      \n  #endif      \n  // END COLLIDER    \n";var T$="\n  #ifdef USE_ATTRACTOR\n\n      #ifdef USE_SPHERE_COLLIDER      \n        // Convert collider size to radii (assuming uColliderSize is the diameter in each axis)\n        vec3 radii = uColliderSize;\n        // Adjust position relative to collider\n        vec3 relPos = position - uColliderPos;\n        // Apply rotation of the collider to the relative position\n        relPos = applyQuaternionToVector(uColliderQuaternionInvert, relPos);            \n        // Scale relative position by radii (for ellipsoid collision detection)\n        vec3 scaledPos = relPos / radii;\n        // Calculate ellipsoidal distance\n        float distToSurface = length(scaledPos); // Distance in terms of ellipsoid\n        float insideCheck = 1.0;\n\n      #endif\n\n\n      #ifdef USE_BOX_COLLIDER\n        // Box dimensions\n        vec3 boxHalfSize = uColliderSize / 2.0;\n        // Convert world position to box's local space\n        vec3 localPos = applyQuaternionToVector(uColliderQuaternionInvert, position - uColliderPos);      \n        vec3 localDistance = abs(localPos) - boxHalfSize;\n        float distToSurface = max(localDistance.x, max(localDistance.y, localDistance.z));\n        float insideCheck = particleSize;\n      #endif      \n  \n      // Apply vortex force inside the Helper\n      #ifdef USE_FORCE_LOCAL_SPACE\n        if (distToSurface <= insideCheck ) {    \n            // Define parameters for the attractor field\n            #ifdef USE_SPHERE_COLLIDER      \n              float attractorStrength = (1.0 - distToSurface ) * uForceIntensity; // Adjust as needed\n            #endif\n\n            #ifdef USE_BOX_COLLIDER\n              float attractorStrength = max((1.0 - insideCheck / distToSurface), 0.) * uForceIntensity; // Adjust as needed\n              #endif\n\n            float attractorDamping = uForceDamping;  // Adjust as needed (higher values will attenuate velocity more)\n          \n            // Use the same radii calculation code as for the collider\n            vec3 attractorRadii = uColliderSize;\n            // Adjust position relative to attractor center\n            vec3 relPos = position - uColliderPos;\n            // Apply rotation of the collider to the relative position\n            relPos = applyQuaternionToVector(uColliderQuaternionInvert, relPos);            \n            // Scale relative position by radii (for ellipsoid attraction)\n            vec3 scaledPos = relPos / attractorRadii;\n\n            // Calculate ellipsoidal distance as attractor radius\n            float attractorRadius = length(scaledPos);\n            // Calculate the distance from the attractor center\n            vec3 relativePosition = position - uColliderPos;\n            // Calculate the force vector towards the attractor center\n            vec3 attractorForce = normalize(relativePosition) * attractorStrength;\n            // Apply the attractor force to the particle\n            velocity -= attractorForce;\n            // Attenuate the particle's velocity\n            velocity *= attractorDamping;\n        }\n      #else \n            // Calculate the distance from the attractor center\n            vec3 relativePosition = position - uColliderPos;\n            // Calculate the force vector towards the attractor center\n            vec3 attractorForce = normalize(relativePosition) * uForceIntensity;\n            // Apply the attractor force to the particle\n            velocity -= attractorForce;\n            // Attenuate the particle's velocity\n            velocity *= uForceDamping;\n      #endif    \n  #endif      \n";var P$="\n  #ifdef USE_VORTEX\n    // Box dimensions\n    vec3 boxHalfSize = uColliderSize / 2.0;\n    // Convert world position to box's local space\n    vec3 localPos = applyQuaternionToVector(uColliderQuaternionInvert, position - uColliderPos);      \n    vec3 localDistance = abs(localPos) - boxHalfSize;\n    float distToSurface = max(localDistance.x, max(localDistance.y, localDistance.z));\n\n    // Apply vortex force inside the box\n    if (distToSurface <= particleSize) {\n      float vortexStrength = uForceIntensity;\n      vec3 localTopCenter = vec3(0.0, 0., 0.0);\n\n      // Transform the local top center to the world space\n      vec3 vortexCenter = uColliderPos + applyQuaternionToVector(uColliderQuaternion, localTopCenter);\n      // Calculate the vector from particle to vortex center\n      vec3 vortexVector = vortexCenter - position;\n\n      // Calculate the rotation axis from the inverse of the collider's quaternion and the fixed up vector\n      // Note: important to add a tiny z component to the up vector to avoid instability\n      vec3 upVector = vec3(0.0, 1.0, 0.01);\n      vec3 rotationAxis = cross(upVector, applyQuaternionToVector(uColliderQuaternion, vortexVector));\n      rotationAxis = normalize(rotationAxis);\n\n      // Add rotational component to velocity\n      float rotationSpeed = length(vortexVector * vortexStrength * 3.0) ; \n\n      vec3 rotationVelocity = rotationAxis * rotationSpeed;\n      // velocity += rotationVelocity * 0.005 ;\n      velocity = rotationVelocity * 0.005 ;\n\n      // Calculate vortex force\n      // vec3 vortexForce = normalize(vortexVector) * uSpeed * .1 ;\n      // Apply the vortex force to the particle\n      vec3 originDirection = applyQuaternionToVector(uWorldQuaternion, directions);\n      velocity += applyForce( originDirection * uSpeed * (1. - uForceDamping) , mass * .5);\n    }\n  #endif      \n";var D$="\n// uniform sampler2D uCurrentPosition; // Pass in the variable from GPGPU\n// uniform sampler2D uCurrentVelocity; // Pass in the variable from GPGPU\n// uniform sampler2D uCurrentEmissionRate; // Pass in the variable from GPGPU\nuniform sampler2D uOriginalPosition;\nuniform sampler2D uDirections;     \nuniform vec3 uDirectionsAxis;\nuniform vec4 uWorldQuaternion;\nuniform vec3 uGravity;        \nuniform float uNoiseStrength;     // Variation of the noise\nuniform float uNoiseScale;        // Scale of the noise\nuniform float uNoiseSeed;         // Seed of the noise\nuniform float particleSize;\nuniform float uSpeed;     // update speed of the particles\nuniform float uRandomMassFactor;\n\n// COLLIDER\nuniform vec3 uColliderPos;                // Collider Position\nuniform vec3 uColliderSize;               // Collider Dimension\nuniform vec4 uColliderQuaternion;         // Collider Rotation\nuniform vec4 uColliderQuaternionInvert;   // Collider Rotation\nuniform float uBounce;                    // Bounce factor\nuniform float uForceDamping;\nuniform float uForceIntensity;\n\n\n"+E$+`\nfloat rand(vec2 co){\n    return fract(sin(dot(co, vec2(12.9898, 78.233))) * 43758.5453);\n}\nvec3 applyQuaternionToVector( vec4 q, vec3 v ){\n    return v + 2.0 * cross( q.xyz, cross( q.xyz, v ) + q.w * v );\n } \nvec3 applyForce(vec3 force, float mass) {\n  vec3 acceleration = force / mass;\n  \n  return acceleration;\n}\n\nvec4 conjugate(vec4 q) {\n  return vec4(q.w, -q.x, -q.y, -q.z);\n}\n\n// Function to compute the normal of the ellipsoid at a given point\nvec3 ellipsoidNormal(vec3 p, vec3 radii) {\n  return normalize(p / (radii * radii));\n}\n\nfloat friction = .3;\n\nvoid main() {\n    vec2 vUv = gl_FragCoord.xy / resolution.xy;\n    vec3 position = texture2D( uCurrentPosition, vUv ).xyz;\n    vec3 originalPosition = texture2D( uOriginalPosition, vUv ).xyz;\n    float timeLeft = texture2D( uCurrentPosition, vUv ).w;\n    vec3 directions = texture2D( uDirections, vUv ).xyz;    \n    vec3 velocity = texture2D( uCurrentVelocity, vUv ).xyz;\n    float mass = rand(originalPosition.xy) * 0.5 + 0.5;\n    float isSpawning = texture2D( uCurrentEmissionRate, vUv ).x;        // 1. = spawning, 0. = not spawning\n    float isActive = texture2D( uCurrentEmissionRate, vUv ).y;          // 1. = active, 0. = not active\n    float collisionFlag =texture2D( uCurrentVelocity, vUv ).w;          // Indicate collision\n\n    // Randomness Mass\n    mass = (1.0 - (uRandomMassFactor * mass));\n    \n    if (isActive == 1.0) {\n      // **************************************************************\n      // FORCES NOISES\n      // **************************************************************\n      #ifdef USE_CURL_NOISE\n        if (uNoiseScale > 0.0 ) {\n          velocity = curlNoise(position * uNoiseScale * .002, uNoiseSeed) * ( uNoiseStrength + 1.0) * .05 * uSpeed;\n        }\n        // Variation of the noise Over Time\n        if (uNoiseStrength > 0.0 && uNoiseScale == 0.0 ) {\n          velocity += curlNoise( position, uNoiseSeed)  * uNoiseStrength * 0.05 * uSpeed;\n        }\n      #endif\n      // **************************************************************\n      #ifdef USE_SIMPLEX_NOISE\n        if (uNoiseScale > 0.0 ) {\n          velocity = vec3(snoise(position * uNoiseScale * .001) * ( uNoiseStrength + 1.0) * .1);\n          velocity *= uSpeed;\n        }\n        // Variation of the noise Over Time\n        if (uNoiseStrength > 0.0 && uNoiseScale == 0.0) {\n          velocity += vec3(snoise(position * uNoiseStrength * .001) * .05 * uSpeed);\n        }\n      #endif\n      // ************************************************************** \n      #ifdef USE_FBM_NOISE\n        if (uNoiseScale > 0.0 ) {\n          velocity = fbm_vec3(position * uNoiseScale * .001, ( uNoiseStrength + 1.0), uNoiseSeed);\n          velocity *= uSpeed;\n        }\n        // Variation of the noise Over Time\n        if (uNoiseStrength > 0.0 && uNoiseScale == 0.0 ) {      \n          velocity += fbm_vec3(position * uNoiseStrength * .001, ( uNoiseStrength + 1.0), uNoiseSeed) * .1 * uSpeed;\n        }\n      #endif\n\n      // COLLIDER\n      ${C$}\n      // ATTRACTION\n      ${T$}  \n      // VORTEX\n      ${P$}\n    } \n    // End isActive\n\n    // SPAWN BIRTH \n    // **************************************************************\n    // if (isSpawning == 1.)\n    #ifdef USE_NORMALS\n      velocity = mix(velocity, applyQuaternionToVector(uWorldQuaternion, directions) * uSpeed, isSpawning);\n    #else\n      velocity = mix(velocity, applyQuaternionToVector(uWorldQuaternion, uDirectionsAxis) * uSpeed, isSpawning);    \n    #endif\n    \n    // if (collisionFlag == 0.0)\n    velocity += applyForce(uGravity, mass * .5) * (1.0 - collisionFlag);\n\n    gl_FragColor = vec4(velocity, collisionFlag);\n}\n`;var I$="\n\n  // Linear Fade In\n  float linearFadeIn(float t) {\n    return t;\n  }\n\n\n  // linear fade out\n  float linearFadeOut(float t) {\n    return 1.0 - t;\n  }\n  \n  float linearInOut(float t) {\n    return t < 0.5 ? t :  (1.0 - t);  \n  }\n\n    // lerp\n    float lerp(float a, float b, float t) {\n      return a + (b - a) * t;\n    }\n\n  // Ease In Out Quart\n  float exponentialInOut(float t) {\n    return t < 0.4 ? lerp(0.0, 1.0, t / 0.4) :\n    t > 0.6 ? lerp(1.0, 0.0, (t - 0.6) / 0.4) :\n    1.0;\n   }\n\n  // constant\n  float constant(float t) {\n    return 1.0;\n  } \n";var O$="\n\nfloat rand(vec3 co){\n  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\n}\n\nvec3 applyQuaternionToVector( vec4 q, vec3 v ){\n  return v + 2.0 * cross( q.xyz, cross( q.xyz, v ) + q.w * v );\n}\n\nvec3 applyForce(vec3 force, float mass) {\n  vec3 acceleration = force / mass;\n    \n  return acceleration;\n}\n";var R$="\nvec3 rgb2xyz (in vec3 rgb) {\n    float r = rgb.r;\n\tfloat g = rgb.g;\n\tfloat b = rgb.b;\n\n\tr = r > 0.04045 ? pow(((r + 0.055) / 1.055), 2.4) : (r / 12.92);\n\tg = g > 0.04045 ? pow(((g + 0.055) / 1.055), 2.4) : (g / 12.92);\n\tb = b > 0.04045 ? pow(((b + 0.055) / 1.055), 2.4) : (b / 12.92);\n\n\tfloat x = (r * 0.4124) + (g * 0.3576) + (b * 0.1805);\n\tfloat y = (r * 0.2126) + (g * 0.7152) + (b * 0.0722);\n\tfloat z = (r * 0.0193) + (g * 0.1192) + (b * 0.9505);\n    \n    vec3 xyz = vec3(\n        (r * 0.4124) + (g * 0.3576) + (b * 0.1805) * 100.0,\n        (r * 0.2126) + (g * 0.7152) + (b * 0.0722) * 100.0,\n        (r * 0.0193) + (g * 0.1192) + (b * 0.9505) * 100.0\n    );\n    return(xyz);\n}\n\nvec3 xyz2lab (in vec3 xyz) {\n\tfloat x = xyz.x / 95.047;\n\tfloat y = xyz.y / 100.0;\n\tfloat z = xyz.z / 108.883;\n\n\tx = x > 0.008856 ? pow(x, 1.0 / 3.0) : (7.787 * x) + (16.0 / 116.0);\n\ty = y > 0.008856 ? pow(y, 1.0 / 3.0) : (7.787 * y) + (16.0 / 116.0);\n\tz = z > 0.008856 ? pow(z, 1.0 / 3.0) : (7.787 * z) + (16.0 / 116.0);\n\n    vec3 lab = vec3((116.0 * y) - 16.0, 500.0 * (x - y), 200.0 * (y - z));\n    return(lab);\n}\n\nvec3 rgb2lab(in vec3 rgb) {\n    vec3 xyz = rgb2xyz(rgb);\n    vec3 lab = xyz2lab(xyz);\n    return(lab);\n}\n\nvec3 xyz2rgb (in vec3 xyz) {\n\tfloat x = xyz.x / 100.0;\n\tfloat y = xyz.y / 100.0;\n\tfloat z = xyz.z / 100.0;\n\t\n    \n\tfloat r = (x *  3.2406) + (y * -1.5372) + (z * -0.4986);\n\tfloat g = (x * -0.9689) + (y *  1.8758) + (z *  0.0415);\n\tfloat b = (x *  0.0557) + (y * -0.2040) + (z *  1.0570);\n\n\tr = r > 0.0031308 ? ((1.055 * pow(r, 1.0 / 2.4)) - 0.055) : r * 12.92;\n\tg = g > 0.0031308 ? ((1.055 * pow(g, 1.0 / 2.4)) - 0.055) : g * 12.92;\n\tb = b > 0.0031308 ? ((1.055 * pow(b, 1.0 / 2.4)) - 0.055) : b * 12.92;\n\n\tr = min(max(0.0, r), 1.0);\n\tg = min(max(0.0, g), 1.0);\n\tb = min(max(0.0, b), 1.0);\n\n\treturn(vec3(r, g, b));\n}\n\nvec3 lab2xyz (in vec3 lab) {\n    float l = lab.x;\n\tfloat a = lab.y;\n\tfloat b = lab.z;\n\n  \tfloat y = (l + 16.0) / 116.0;\n\tfloat x = a / 500.0 + y;\n\tfloat z = y - b / 200.0;\n\n\tfloat y2 = pow(y, 3.0);\n\tfloat x2 = pow(x, 3.0);\n\tfloat z2 = pow(z, 3.0);\n\n  \ty = y2 > 0.008856 ? y2 : (y - 16.0 / 116.0) / 7.787;\n\tx = x2 > 0.008856 ? x2 : (x - 16.0 / 116.0) / 7.787;\n\tz = z2 > 0.008856 ? z2 : (z - 16.0 / 116.0) / 7.787;\n\n\tx *= 95.047;\n\ty *= 100.0;\n\tz *= 108.883;\n\n\treturn(vec3(x, y, z));\n}\nvec3 lab2rgb (in vec3 lab) {\n    vec3 xyz = lab2xyz(lab);\n    vec3 rgb = xyz2rgb(xyz);\n    return(rgb);\n}\n\n";var L$=`\n  uniform sampler2D uPosition;\n  uniform float uSize;\n  uniform float uSizeEnd;\n  uniform vec3 uWorldOffset;\n  uniform vec4 uWorldQuaternion;\n  // Billboard Behavior - Currently at Zero, but we can change that\n  uniform float uRotation;\n  uniform float uRotationEnd;\n  uniform vec2 center;\n\n  // Randomness\n  uniform float uRandScaleFactor;\n  uniform float uRandRotationFactor;\n\n  attribute vec2 ref;\n\n  varying float v_LifeLeft;    // normalized lifetime 1 to 0\n  varying vec2 vUv;\n  varying vec2 vRef;\n\n  ${O$}\n  ${I$}\n`,uB=({easeSize:E="linearFadeOut"})=>`\n  vUv = uv;  \n  vRef = ref;\n  // Normalized LifeTime 1 to 0\n  float lifeLeft = texture2D(uPosition, ref).w;\n  v_LifeLeft = lifeLeft;\n  // Position From DataTexture Simulation\n  vec3 pos = texture2D(uPosition, ref).rgb - uWorldOffset;\n  // Apply World Quaternion\n  pos = applyQuaternionToVector(uWorldQuaternion, pos);  \n            \n  #ifdef  USE_SIZE_END\n    // Scaled Over Time\n    float t = 1. - lifeLeft;\n    float currentSize = mix(uSize, uSizeEnd, t); // Linearly interpolate between uSize and uSizeEnd\n    vec3 scaledPosition = position * vec3(currentSize);\n  #else\n    // Change Size Behavior over LifeTime\n    float easeSize = ${E}(1. - lifeLeft);\n    // Scaled Over Time\n    vec3 scaledPosition = position * vec3(uSize * easeSize);\n  #endif\n\n  // Billboard Behavior\n  vec2 scale;\n  scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n  scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );    \n  // Randomness \n  float randRef = rand(ref);\n  scale *= (1.0 - (uRandScaleFactor * randRef));\n  // Rotation\n  float randRotation =  2.0 * PI * ( uRandRotationFactor * randRef);\n  float originalRotation = (1.0 - uRotation) * 2.0 * PI;\n  float originalRotationEnd = (1.0 - uRotationEnd) * 2.0 * PI;\n  // OverTime\n  float finalRotation = mix(originalRotation + randRotation, originalRotationEnd + randRotation, lifeLeft);\n\n  vec2 alignedPosition = ( scaledPosition.xy - ( center - vec2( 0.5 ) ) ) * scale;\n  vec2 rotatedPosition;\n  rotatedPosition.x = cos( finalRotation ) * alignedPosition.x - sin( finalRotation ) * alignedPosition.y;\n  rotatedPosition.y = sin( finalRotation ) * alignedPosition.x + cos( finalRotation ) * alignedPosition.y;\n  \n  mat4 instanceMatrix = mat4(\n    vec4(1.0, 0.0, 0.0, 0.0),\n    vec4(0.0, 1.0, 0.0, 0.0),\n    vec4(0.0, 0.0, 1.0, 0.0),\n    vec4(pos.x, pos.y, pos.z, 1.0)\n  );  \n\n  mvPosition = modelViewMatrix * instanceMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n  mvPosition.xy += rotatedPosition;\n  gl_Position = projectionMatrix  * mvPosition;   \n`,B$="\n  uniform vec4 uColor;                // start color\n  uniform vec4 uColor2;               // end color\n  uniform sampler2D uTexture;         // texture\n  varying float v_LifeLeft;   // normalized lifetime 1 to 0\n  varying vec2 vUv;\n  varying vec2 vRef;\n\n  float random(vec2 co) {\n    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\n  }\n  "+I$+`  \n  ${R$}\n\n`,dB=({easeOpacity:E="linearFadeOut"})=>`  \n  // if Particle is dead, hide it\n  if (v_LifeLeft <= 0.005 ) {\n    discard;\n  }\n\n  #ifdef USE_RANDOM_COLORING\n    float randVal = random(vRef); // Generate a random value based on the reference\n    vec4 color = mix(uColor, uColor2, randVal); // Interpolate between the two colors\n  #else\n    vec4 color = mix(uColor, uColor2, 1. - v_LifeLeft);\n  #endif\n\n  // Opacity over Life Time\n  float finalAlpha = ${E}(1. - v_LifeLeft);  \n  vec4 textureColor = texture2D(uTexture, vUv).rgba; \n  finalColor = textureColor.rgb * color.rgb;\n  finalAlpha = color.a * textureColor.a * finalAlpha;\n  \n  gl_FragColor = vec4(finalColor, finalAlpha);     \n\n`;var F$=class extends lo{constructor(E,O){super();this.needsJitter=!0;this.type="ParticleMaterial";this.easeOpacity="linearFadeIn";this.easeSize="linearFadeIn";this.useSizeEnd=!1;this.isColoringRandom=!1;this.init(E,O),this.context=O}reset(){}init(E,O){this.transparent=!0,this.depthTest=!0,this.depthWrite=!1,this.easeOpacity=E.ease,this.easeSize=E.easeSize,this.layers=[],WF.startContext(WF.globalContext),this.lightLayer=new oV(0,"",{...LP.defaultData("light","phong"),visible:!1},new uk,{},O.shared),WF.endContext(WF.globalContext),this.build()}updateState(E){E.coloring!==void 0&&(this.isColoringRandom=E.coloring==="random"),E.color!==void 0&&(E.color instanceof Array?this.uniforms.uColor.value=E.color:this.uniforms.uColor.value=this.context.shared.color(E.color)),E.color2!==void 0&&(E.color2 instanceof Array?this.uniforms.uColor2.value=E.color2:this.uniforms.uColor2.value=this.context.shared.color(E.color2)),E.size!==void 0&&(this.uniforms.uSize.value=E.size[0],this.uniforms.uSizeEnd.value=E.size[1],E.size[0]!==E.size[1]?this.useSizeEnd=!0:this.useSizeEnd=!1),E.ease!==void 0&&(this.easeOpacity=E.ease,this.build()),E.easeSize!==void 0&&(this.easeSize=E.easeSize,this.build()),this.needsUpdate=!0}onBeforeCompile(E){this.build(),E.defines=this.defines,E.uniforms=this.uniforms,E.vertexShader=this.vertexShader,E.fragmentShader=this.fragmentShader}build(){let E=new SU;return E.needsJitter=this.needsJitter,E.addFragmentParsCode(gU),E.buildShader("vertex",this.fragment),E.buildShader("fragment",this.fragment),E.addFragmentFinalCode(vU),this.isColoringRandom&&E.define("USE_RANDOM_COLORING"),this.useSizeEnd&&E.define("USE_SIZE_END"),E.addVertexParsCode(L$),E.addFragmentParsCode(B$),E.addVertexFinalCode(uB({easeSize:this.easeSize})),E.addFragmentFinalCode(dB({easeOpacity:this.easeOpacity})),this.vertexShader=E.getCode("vertex"),this.fragmentShader=E.getCode("fragment"),this.defines=E.defines,this.uniforms={...E.uniforms,...this.uniforms},this.extensions=E.extensions,this}get nodeMaterial(){return this}get fragment(){return this.lightLayer.node}getDefines(){return this.defines}nodeMaterialDispose(){this.layers.forEach((E=>E.dispose())),super.dispose()}};var N$=class{constructor(E,O,R,z){this.type="SphereEmitterShape";this.targetMesh=void 0;this.size=E,this.type=R,this.textureSize=ZL(O);let V=1;this.targetMesh=z?.type==="Mesh"&&z?z:this.getMesh(R,V);let{positions:j,dataTexture:Y,dataTextureNormals:ee}=this.createPositions(this.textureSize,this.targetMesh??this.getMesh(R,V));this.positionsTexture=Y,this.positionsAttribute=j,this.directionsTexture=ee}createPositions(E,O){let{positions:R,normals:z}=JL(O,E*E),V=ST(R,E),j=ST(z,E);return{dataTexture:V,positions:R,dataTextureNormals:j}}getMesh(E,O){let R=null;switch(E){case"SphereEmitterShape":R=new $u(O*.5,32,32);break;case"TorusEmitterShape":R=new ep(O*.5,.3,15,40);break;case"ConeEmitterShape":R=new qu(O,O,15);break;case"BoxEmitterShape":R=new to(O,O,O);break;case"PlaneEmitterShape":R=new Co(O,O),R.rotateX(-Math.PI/2);break;case"MeshEmitterShape":R=new $u(O,32,32);break;default:R=new $u(O,32,32);break}return new eo(R,new xa({color:16711680}))}applyToShader(E,O){this.size=(new Wn).fromArray(O.size),E.uEmitterSize.value=this.size}dispose(){this.positionsTexture.dispose(),this.directionsTexture.dispose(),this.positionsAttribute=new Float32Array}};function sc(E){let O={...E},R=mP.defaultData;O.forceFieldObjectId&&(O.colliderEntityId=O.forceFieldObjectId);let z={...R.shape,...O.shape},V={...R.renderMaterial,...O.renderMaterial};return{...R,...O,shape:z,renderMaterial:V}}var k$="\n// uniform sampler2D uCurrentPosition; // Pass in the variable from GPGPU\n// uniform sampler2D uCurrentVelocity; // Pass in the variable from GPGPU\n// uniform sampler2D uCurrentEmissionRate; // Pass in the variable from GPGPU\n\nuniform sampler2D uIndex; // Texture with corresponding index\nuniform float uLastIndexEmitted; // Last emitted index\nuniform float uParticlesToEmit; // Number of particles to emit on that frame\nuniform float uTime;\n\nvoid main() {\n    vec2 vUv = gl_FragCoord.xy / resolution.xy;\n    float particleIndex = texture(uIndex, vUv).x;\n    float timeLeft = texture2D( uCurrentPosition, vUv ).w;\n    float isActive = texture2D( uCurrentEmissionRate, vUv ).g;    // 1. = active, 0. = not active\n    float timeStart = texture2D( uCurrentEmissionRate, vUv ).b;\n\n\n    // ********** Detect Colision to Create a flag and use it in position **********\n    // We are doing this here, so\n\n    // ********** Emit Particles **********\n    // X = isSpawning 0.0 or 1.0\n    // Y = isActive 0.0 or 1.0\n    // Check if the vertex index is between the first value and the last value\n    // if (particleIndex >= uLastIndexEmitted && particleIndex < uLastIndexEmitted + uParticlesToEmit) {\n    //     // Emit a particle by writing 1 to the red channel of the color output\n    //     // r: 1. == emit the particle\n    //     // g: 1. == particle is now active\n    //     timeStart = uTime;\n    //     gl_FragColor = vec4(1.0, 1.0, timeStart, 1.0);\n    // } else {\n    //     // The Particle is either already emitted or not in the range of the particles to emit\n    //     // Do not emit a particle by writing 0 to the red channel of the color output        \n    //     gl_FragColor = vec4(0.0, isActive, timeStart, 1.0);\n    // }\n    // Determine if the particle is within the emission range\n    float emitLowerBound = step(uLastIndexEmitted, particleIndex);\n    float emitUpperBound = step(particleIndex, uLastIndexEmitted + uParticlesToEmit - 1.0);\n    float emitParticle = emitLowerBound * emitUpperBound; // 1.0 if in range, 0.0 otherwise\n\n    // Set timeStart and color\n    timeStart = mix(timeStart, uTime, emitParticle);\n    gl_FragColor = vec4(emitParticle, mix(isActive, 1.0, emitParticle), timeStart, 1.0);\n\n\n}\n";var X$=10,Y$=class extends ra{constructor(E,O){super();this.type="ParticleEmitter";this.debugMode=!1;this.worldSpace=!0;this.rootObject=null;this.gpuCompute=null;this.positionSimRT=null;this.velocitySimRT=null;this.emissionRateSimRT=null;this.emitterShape=void 0;this.isEmitting=!1;this.hasBeenReset=!1;this.emittedParticlesAmount=0;this.lastEmitTime=0;this.globalTime=0;this.targetFPS=60;this.previousRatio=1;this.lerpFactor=.4;this.particlesAmount=0;this.noiseStrength=0;this.noiseScale=0;this.isBillboardBased=!0;this.simFeaturesDefinition={USE_COLLIDER:!1,USE_ATTRACTOR:!1,USE_VORTEX:!1,USE_SPHERE_COLLIDER:!1,USE_BOX_COLLIDER:!1,USE_FORCE_LOCAL_SPACE:!1,USE_NORMALS:!1,USE_CURL_NOISE:!0,USE_SIMPLEX_NOISE:!1,USE_FBM_NOISE:!1};this.textureLoader=new Op;this.currentWorldPosition=new Wn;this.systemQuaternion=new Hn;this.worldGravity=new Wn(0,0,0);this.directionAxis=new Wn(0,0,0);this.colliderV3=new Wn(0,0,0);this.colliderQuaternion=new Hn(0,0,0,1);this.matrixAutoUpdate=!0,this.renderer=E,this.system=O,this.shared=O.context.shared;let R=O.data;this.material=new F$(R.renderMaterial,O.context),this.material.uniforms={uSize:{value:0},uSizeEnd:{value:0},uColor:{value:R.renderMaterial.color},uColor2:{value:R.renderMaterial.color2},uPosition:{value:new Wn(0,0,0)},uEmissionData:{value:new Wn(0,0,0)},uTexture:{value:this.defaultTexture},uWorldOffset:{value:new Wn(0,0,0)},uWorldQuaternion:{value:new Nn(0,0,0,1)},uRandScaleFactor:{value:R.randomScale??0},uRandRotationFactor:{value:R.randomRotation??0},uRotation:{value:R.renderMaterial.spriteRotation[0]??0},uRotationEnd:{value:R.renderMaterial.spriteRotation[1]??0}},this.setTexture(this.material.uniforms,R.renderMaterial.texture),this.init(R)}setTexture(E,O){let R=O.data;if(typeof O!="string"){if(typeof R!="string"){let O=new Image;O.onload=()=>{let R=new Fn(O);R.needsUpdate=!0,E.uTexture.value=R};let z=new Blob([R],{type:"image/*"}),V=URL.createObjectURL(z);O.src=V}}else{let R=this.shared.image(O),z=new Fn(R.img);z.needsUpdate=!0,E.uTexture.value=z}}updateGeometryAttributes(E,O){let R=QL(O);!this.emitterShape?.positionsAttribute||E.geometry.setAttribute("ref",new eu(R,2))}applyWorldSpace(){if(!this.system.started||!this.worldSpace||!this.positionSimRT||!this.velocitySimRT)return;let E=this.system;E.getWorldQuaternion(this.systemQuaternion),this.systemQuaternion.invert(),E.getWorldPosition(this.currentWorldPosition),this.material.uniforms.uWorldOffset.value=this.currentWorldPosition,this.material.uniforms.uWorldQuaternion.value.copy(this.systemQuaternion.normalize()),this.positionSimRT.material.uniforms.uWorldOffset.value=this.currentWorldPosition,this.systemQuaternion.invert(),this.positionSimRT.material.uniforms.uWorldQuaternion.value.copy(this.systemQuaternion.normalize()),this.velocitySimRT.material.uniforms.uWorldQuaternion.value.copy(this.systemQuaternion.normalize())}update(E,O){if(!this.gpuCompute||!this.positionSimRT||!this.velocitySimRT||!this.emissionRateSimRT||this.hasBeenReset)return;if(this.checkIfAllParticlesAreDead()&&!this.hasBeenReset){this.reset();return}this.applyWorldSpace(),this.globalTime=E,this.positionSimRT.material.uniforms.uTime.value=E,this.emissionRateSimRT.material.uniforms.uTime.value=E;let R=1e3/O,z=this.targetFPS/R,V=this.previousRatio+(z-this.previousRatio)*this.lerpFactor;this.positionSimRT.material.uniforms.uFPSRatio.value=V,this.previousRatio=V;let j=this.isEmitting?this.GoEmitSomeParticles(E,this.system.data.birthRatePerSec):0;this.emissionRateSimRT.material.uniforms.uLastIndexEmitted.value=this.emittedParticlesAmount,this.emissionRateSimRT.material.uniforms.uParticlesToEmit.value=j,this.material.uniforms.uPosition.value=this.gpuCompute.getCurrentRenderTarget(this.positionSimRT)?.texture,this.system.colliderEntities.length>0&&this.renderColliders(),this.gpuCompute.compute()}renderColliders(){if(!this.velocitySimRT)return;let E=this.system.colliderEntities[0],O=this.simFeaturesDefinition.USE_COLLIDER||this.simFeaturesDefinition.USE_ATTRACTOR||this.simFeaturesDefinition.USE_VORTEX;if(E.destroyedInAction&&O&&this.init(sc({...this.system.data,colliderEntityId:null})),!E||E.destroyedInAction)return;E.getWorldPosition(this.colliderV3),this.colliderV3.y===0&&(this.colliderV3.y=1e-4),this.velocitySimRT.material.uniforms.uColliderPos.value.copy(this.colliderV3);let R=E.data.size;this.colliderV3.fromArray(R),this.velocitySimRT.material.uniforms.uColliderSize.value.copy(this.simFeaturesDefinition.USE_SPHERE_COLLIDER?this.colliderV3.multiplyScalar(.5):this.colliderV3),E.getWorldQuaternion(this.colliderQuaternion),this.velocitySimRT.material.uniforms.uColliderQuaternion.value.copy(this.colliderQuaternion.normalize()),this.velocitySimRT.material.uniforms.uColliderQuaternionInvert.value.copy(this.colliderQuaternion.normalize().invert())}updateState(E){!this.velocitySimRT||!this.positionSimRT||(E.renderMaterial&&this.updateMaterialState(E.renderMaterial),this.updateParticleState(E))}updateVariableState(E,O){if(!this.velocitySimRT||!this.positionSimRT)return;O[2]==="size"&&this.material.updateState({size:[E,this.material.uniforms.uSizeEnd.value]}),O[2]==="sizeEnd"&&this.material.updateState({size:[this.material.uniforms.uSize.value,E]});let i=(E,O)=>{let R=[...this.system.data.shape.size];R[E]=O,this.updateParticleState({shape:{...this.system.data.shape,size:R}})};O[2]==="shape_size_0"&&i(0,E),O[2]==="shape_size_1"&&i(1,E),O[2]==="shape_size_2"&&i(2,E),O[2]==="speed"&&(this.velocitySimRT.material.uniforms.uSpeed.value=E/X$),O[2]==="gravity"&&this.worldGravity.set(0,E/100,0),O[2]==="noiseStrength"&&(this.noiseStrength=E,this.velocitySimRT.material.uniforms.uNoiseStrength.value=this.noiseStrength),O[2]==="noiseScale"&&(this.noiseScale=E,this.velocitySimRT.material.uniforms.uNoiseScale.value=this.noiseScale),O[2]==="direction_x"&&(this.directionAxis=this.getDirectionAxis([Number(E),this.system.data.direction[1],this.system.data.direction[2]])),O[2]==="direction_y"&&(this.directionAxis=this.getDirectionAxis([this.system.data.direction[0],Number(E),this.system.data.direction[2]])),O[2]==="direction_z"&&(this.directionAxis=this.getDirectionAxis([this.system.data.direction[0],this.system.data.direction[1],Number(E)]))}updateMaterialState(E){this.material.updateState({...E,size:E.size?[Number(this.shared.getVariable(E.size[0],[this.uuid,"particles","size"])),Number(this.shared.getVariable(E.size[1],[this.uuid,"particles","sizeEnd"]))]:[0,0]}),E.texture&&(this.setTexture(this.material.uniforms,E.texture),this.material.needsUpdate=!0)}updateParticleState(E){if(!(!this.positionSimRT||!this.velocitySimRT)){if(this.shouldReInitGPUCompute(E)&&this.init(sc(this.system.data)),E.life!==void 0&&(this.positionSimRT.material.uniforms.uMaxLifeTime.value=E.life),E.speed!==void 0&&(this.velocitySimRT.material.uniforms.uSpeed.value=Number(this.shared.getVariable(E.speed,[this.uuid,"particles","speed"]))/X$),E.collisionBounce!==void 0&&(this.velocitySimRT.material.uniforms.uBounce.value=E.collisionBounce),E.noiseStrength!==void 0&&(this.noiseStrength=Number(this.shared.getVariable(E.noiseStrength,[this.uuid,"particles","noiseStrength"])),this.velocitySimRT.material.uniforms.uNoiseStrength.value=this.noiseStrength),E.noiseScale!==void 0&&(this.noiseScale=Number(this.shared.getVariable(E.noiseScale,[this.uuid,"particles","noiseScale"])),this.velocitySimRT.material.uniforms.uNoiseScale.value=this.noiseScale),E.noiseSeed!==void 0&&(this.velocitySimRT.material.uniforms.uNoiseSeed.value=E.noiseSeed),E.randomMass!==void 0&&(this.velocitySimRT.material.uniforms.uRandomMassFactor.value=E.randomMass),E.renderMaterial?.size!==void 0){let O=this.shared.getVariable(E.renderMaterial.size[0],[this.uuid,"particles","size"]);this.velocitySimRT.material.uniforms.particleSize.value=Number(O)}if(E.renderMaterial?.spriteRotation!==void 0&&(this.material.uniforms.uRotation.value=E.renderMaterial.spriteRotation[0],this.material.uniforms.uRotationEnd.value=E.renderMaterial.spriteRotation[1]),E.shape!==void 0){let O=E.shape.size??this.system.data.shape.size,R=[Number(this.shared.getVariable(O[0],[this.uuid,"particles","shape_size_0"])),Number(this.shared.getVariable(O[1],[this.uuid,"particles","shape_size_1"])),Number(this.shared.getVariable(O[2],[this.uuid,"particles","shape_size_2"]))],z={...sc(this.system.data).shape,size:R};this.emitterShape?.applyToShader(this.positionSimRT.material.uniforms,z)}if(E.gravity!==void 0&&(this.worldGravity.set(0,Number(this.shared.getVariable(this.system.data.gravity,[this.uuid,"particles","gravity"]))/100,0),this.velocitySimRT.material.uniforms.uGravity={value:this.worldGravity}),E.direction!==void 0){let O=this.getDirectionFromVariable(E.direction);this.directionAxis=this.getDirectionAxis(O),this.velocitySimRT.material.uniforms.uDirectionsAxis.value=this.directionAxis}E.randomRotation!==void 0&&(this.material.uniforms.uRandRotationFactor.value=E.randomRotation),E.randomScale!==void 0&&(this.material.uniforms.uRandScaleFactor.value=E.randomScale)}}updateForceFieldParameters(E){!this.velocitySimRT||(E.forceIntensity!==void 0&&(this.velocitySimRT.material.uniforms.uForceIntensity.value=E.forceIntensity),E.forceDambing!==void 0&&(this.velocitySimRT.material.uniforms.uForceDamping.value=E.forceDambing))}getDirectionAxis(E){let O=[Number(E[0])*xn.DEG2RAD,Number(E[1])*xn.DEG2RAD,Number(E[2])*xn.DEG2RAD],R=new zs(O[0],O[1],O[2],"XYZ");return this.directionAxis.set(0,1,0).applyEuler(R).normalize(),this.velocitySimRT&&(this.velocitySimRT.material.uniforms.uDirectionsAxis.value=this.directionAxis),this.directionAxis}shouldReInitGPUCompute(E){let{birthRatePerSec:O,rootObjectType:R,colliderEntityId:z,shape:V,emitTimeDuration:j,emitTimeCycle:Y,life:ee,directionMode:se,noiseType:he}=E;return O!==void 0||R!==void 0||z||z===null||Y!==void 0||V!==void 0||ee!==void 0||j!==void 0||se!==void 0||he!==void 0}init(E){this.dispose(),this.particlesAmount=this.getMaxParticlesAmount({birthRatePerSecond:E.birthRatePerSec,particleMaxLifeTime:E.life,loopDuration:E.emitTimeCycle==="infinity"?0:E.emitTimeDuration}),this.particlesAmount>1e5&&(console.warn("The maximum number of particles is limited to 100000."),this.particlesAmount=1e5),this.emitterShape=this.createShape(E.shape,this.particlesAmount);let O=setInterval((()=>{if(!!this.emitterShape){if(isNaN(this.emitterShape.positionsTexture.source.data.data[0])){this.init(E);return}clearInterval(O)}}),100);if(!this.emitterShape)return;let R=new b$(this.emitterShape.textureSize,this.emitterShape.textureSize,this.renderer),z=this.updateSimulationDefinition(E),V=R.addVariable("uCurrentPosition",z+M$,this.emitterShape.positionsTexture),j=R.addVariable("uCurrentVelocity",z+D$,this.emitterShape.directionsTexture),Y=R.addVariable("uCurrentEmissionRate",k$,eB(this.emitterShape.textureSize));R.setVariableDependencies(V,[V,j,Y]),R.setVariableDependencies(j,[V,j,Y]),R.setVariableDependencies(Y,[V,j,Y]);let ee=$L({size:this.emitterShape.textureSize}),se={uOriginalPosition:{value:this.emitterShape.positionsTexture},uWorldOffset:{value:new Wn(0,0,0)},uWorldQuaternion:{value:new Nn(0,0,0,1)},uTime:{value:0},uFPSRatio:{value:1},uMaxLifeTime:{value:E.life},uEmitterSize:{value:new Wn(Number(this.shared.getVariable(E.shape.size[0],[this.uuid,"particles","shape_size_0"])),Number(this.shared.getVariable(E.shape.size[1],[this.uuid,"particles","shape_size_1"])),Number(this.shared.getVariable(E.shape.size[2],[this.uuid,"particles","shape_size_2"])))},particleSize:{value:0}};V.material.uniforms=se;let he=this.getDirectionFromVariable(E.direction);this.directionAxis=this.getDirectionAxis(he),this.worldGravity.set(0,Number(this.shared.getVariable(this.system.data.gravity,[this.uuid,"particles","gravity"]))/100,0),this.noiseStrength=Number(this.shared.getVariable(E.noiseStrength,[this.uuid,"particles","noiseStrength"])),this.noiseScale=Number(this.shared.getVariable(E.noiseScale,[this.uuid,"particles","noiseScale"]));let ce=E.colliderEntityId&&this.system.getColliderData(E.colliderEntityId),ue={uOriginalPosition:{value:this.emitterShape.positionsTexture},uDirections:{value:this.emitterShape.directionsTexture},uDirectionsAxis:{value:this.directionAxis},uWorldQuaternion:{value:new Nn(0,0,0,1)},uColliderPos:{value:new Wn(0,0,0)},uColliderSize:{value:new Wn(0,0,0)},uForceIntensity:{value:ce?ce.forceIntensity:0},uForceDamping:{value:ce?ce.forceDambing:0},uColliderQuaternion:{value:new Nn(0,0,0,1)},uColliderQuaternionInvert:{value:new Nn(0,0,0,1)},particleSize:{value:0},uGravity:{value:this.worldGravity},uNoiseStrength:{value:this.noiseStrength},uNoiseScale:{value:this.noiseScale},uNoiseSeed:{value:E.noiseSeed},uRandomMassFactor:{value:E.randomMass},uBounce:{value:E.collisionBounce},uSpeed:{value:Number(this.shared.getVariable(E.speed,[this.uuid,"particles","speed"]))/X$}};j.material.uniforms=ue;let fe={uIndex:{value:ee},uTime:{value:0},uLastIndexEmitted:{value:0},uParticlesToEmit:{value:0}};Y.material.uniforms=fe;let ve=[Number(this.shared.getVariable(E.shape.size[0],[this.uuid,"particles","shape_size_0"])),Number(this.shared.getVariable(E.shape.size[1],[this.uuid,"particles","shape_size_1"])),Number(this.shared.getVariable(E.shape.size[2],[this.uuid,"particles","shape_size_2"]))],we={...sc(this.system.data).shape,size:ve};this.emitterShape.applyToShader(V.material.uniforms,we),R.init(),this.gpuCompute=R,this.positionSimRT=V,this.velocitySimRT=j,this.emissionRateSimRT=Y,this.rootObject=this.createPrimaryEmitter(this.emitterShape.textureSize),this.add(this.rootObject),this.material.needsUpdate=!0}getDirectionFromVariable(E){let O=Number(this.shared.getVariable(E[0],[this.uuid,"particles","direction_x"])),R=Number(this.shared.getVariable(E[1],[this.uuid,"particles","direction_y"])),z=Number(this.shared.getVariable(E[2],[this.uuid,"particles","direction_z"]));return[O,R,z]}updateSimulationDefinition(E){if(this.simFeaturesDefinition.USE_COLLIDER=!1,this.simFeaturesDefinition.USE_ATTRACTOR=!1,this.simFeaturesDefinition.USE_VORTEX=!1,this.simFeaturesDefinition.USE_SPHERE_COLLIDER=!1,this.simFeaturesDefinition.USE_BOX_COLLIDER=!1,this.simFeaturesDefinition.USE_FORCE_LOCAL_SPACE=!1,this.simFeaturesDefinition.USE_NORMALS=!1,this.simFeaturesDefinition.USE_CURL_NOISE=!1,this.simFeaturesDefinition.USE_SIMPLEX_NOISE=!1,this.simFeaturesDefinition.USE_FBM_NOISE=!1,E.colliderEntityId&&this.system.colliderEntities.length>0){let O=this.system.getColliderData(E.colliderEntityId);switch(O?.forceType){case"attractor":this.simFeaturesDefinition.USE_ATTRACTOR=!0;break;case"collider":this.simFeaturesDefinition.USE_COLLIDER=!0;break;case"vortex":this.simFeaturesDefinition.USE_VORTEX=!0;break}let R=O?.colliderType;R==="sphere"&&(this.simFeaturesDefinition.USE_SPHERE_COLLIDER=!0),R==="box"&&(this.simFeaturesDefinition.USE_BOX_COLLIDER=!0),O?.forceRange==="helper"&&(this.simFeaturesDefinition.USE_FORCE_LOCAL_SPACE=!0)}E.directionMode==="normals"&&(this.simFeaturesDefinition.USE_NORMALS=!0),E.noiseType==="curl"&&(this.simFeaturesDefinition.USE_CURL_NOISE=!0),E.noiseType==="simplex"&&(this.simFeaturesDefinition.USE_SIMPLEX_NOISE=!0),E.noiseType==="fbm"&&(this.simFeaturesDefinition.USE_FBM_NOISE=!0);let O="";for(let[E,R]of Object.entries(this.simFeaturesDefinition))R&&(O+=`#define ${E}\n`);return O}createShape(E,O){this.emitterShape&&this.emitterShape.dispose();let R=new Wn(Number(this.shared.getVariable(E.size[0],[this.uuid,"particles","shape_size_0"])),Number(this.shared.getVariable(E.size[1],[this.uuid,"particles","shape_size_1"])),Number(this.shared.getVariable(E.size[2],[this.uuid,"particles","shape_size_2"])));if(E.type==="MeshEmitterShape"){let z=null;return this.system.context.scene.traverseEntity((O=>{O.uuid===E.fromMeshId&&(z=O)})),z?new N$(R,O,E.type,z):new N$(R,O,"SphereEmitterShape")}return new N$(R,O,E.type)}createPrimaryEmitter(E){let O,R=E*E;return O=new ou(new Co(1,1,1),this.material,R),this.updateGeometryAttributes(O,E),this.material.needsUpdate=!0,O.onBeforeRender=()=>{this.applyWorldSpace()},O}getMaxParticlesAmount({birthRatePerSecond:E,particleMaxLifeTime:O,loopDuration:R=0}){return Math.ceil(E*(O+R))}dispose(){!this.gpuCompute||(this.rootObject?.parent?.remove(this.rootObject),this.gpuCompute.dispose(),this.material.nodeMaterialDispose(),this.emitterShape?.dispose())}GoEmitSomeParticles(E,O){let R=E-this.lastEmitTime,z=1/O;if(R>=z){let O=Math.max(1,Math.floor(R/z));return this.lastEmitTime=E,this.emittedParticlesAmount+O>this.particlesAmount&&(this.emittedParticlesAmount=0),this.emittedParticlesAmount+=O,O}return 0}checkIfAllParticlesAreDead(){return this.lastEmitTime+this.system.data.life+1<this.globalTime}reset(){this.hasBeenReset=!0,this.lastEmitTime=0,this.emittedParticlesAmount=0,this.gpuCompute&&this.init(sc(this.system.data))}startEmitting(E){this.isEmitting=!0,this.hasBeenReset=!1,this.lastEmitTime=E}stopEmitting(){this.isEmitting=!1}};var Q$=class extends GF{constructor(E,O,R){super(E,O);this.type="ParticleSystem";this.geometry=new Na;this.actualTime=0;this.currentLoopTime=0;this.started=!1;this.stopped=!1;this.timeoutId=void 0;this.isFrozen=!1;this.isIdle=!0;this.emitter=null;this.colliderEntities=[];this.renderer=null;this.isPreWarm=!1;this._hasOnAfterRenderBeenCalled=!1;this.onAfterRender=E=>{this._hasOnAfterRenderBeenCalled||(this._hasOnAfterRenderBeenCalled=!0,this.init(E))};this.context=R,this.data={...O,...sc(O)},this.geometry.setAttribute("position",new Ma([],3)),this.material=new xa({colorWrite:!1}),this.frustumCulled=!1}init(E){this.renderer=E,this.emitter=new Y$(E,this),this.add(this.emitter),this.updateParticleState(this.data)}update(E){if(!this.isReady||!this.started||this.isFrozen||this.isIdle)return;this.actualTime+=E,this.stopped||(this.currentLoopTime+=E);let O=this.data.emitTimeCycle==="one_time";if((this.data.emitTimeCycle==="loop"||O)&&this.currentLoopTime>this.data.emitTimeDuration*1e3&&(this.stopped||(this.stop(),O||this.start(this.data.emitTimeDelay*1e3))),this.emitter&&this.started){let O=this.actualTime/1e3;this.emitter.update(O,E)}this.scale.set(1,1,1),this.updateMatrix()}isReady(){return!!this.emitter}hasCollider(E){return this.colliderEntities.some((O=>O.identity===E))}getColliderData(E){let O=this.colliderEntities.find((O=>O.identity===E));return O?O.data:null}updateByPatchedOp(E,O,R){super.updateByPatchedOp(E,O,R),Vt(E.path,["renderMaterial"])&&this.updateParticleState({renderMaterial:{...this.data.renderMaterial,...qM.drop(E,1).props}}),Vt(E.path,["shape"])&&this.updateParticleState({shape:{...this.data.shape,...qM.drop(E,1).props}})}updateState(E,O){super.updateState(E,O),this.updateParticleState(E)}updateParticleState(E){if(!!this.emitter){if(E.colliderEntityId!==void 0&&E.colliderEntityId!==null){let O=this.context.scene.find(E.colliderEntityId);this.colliderEntities=O?[O]:[]}E.colliderEntityId===null&&(this.colliderEntities=[]),this.emitter.updateState(E),E.emitTimeCycle&&this.started&&this.start()}}updateFromColliderEntity(E){!this.emitter||(this.emitter.updateForceFieldParameters(E),this.stop(),this.start())}start(E=0){this.currentLoopTime=0,E?this.timeoutId=window.setTimeout((()=>{this.start(0)}),E):(this.started=!0,this.stopped=!1,this.isFrozen=!1,this.emitter?.startEmitting(this.actualTime/1e3))}froze(){this.isFrozen=!0}unFroze(){this.isFrozen=!1}stop(){this.stopped=!0,this.currentLoopTime=0,this.emitter?.stopEmitting(),clearTimeout(this.timeoutId)}reset(){this.started=!1,this.stopped=!1,this.emitter?.reset()}wakeUp(){this.isIdle=!1}sleep(){this.isIdle=!0,this.reset()}};function PZ(){try{let E=window.location.href;if(E.includes("reducesubdiv=")){let O=E.indexOf("reducesubdiv=")+13;return parseInt(E.slice(O,O+1))}}catch{}}var Z$=PZ();function _Z(E,O,R){Z$!==void 0&&(O?.geometry?.subdivisions??0)>Z$&&(console.log("reducing subdivisions",O.name,O.geometry.subdivisions),O.geometry.subdivisions=Z$);let z;return O.geometry.type==="TextGeometry"?new sH(E,O,R):O.geometry.type==="InputGeometry"?new g$(E,O,R):(z=O.geometry.type==="SubdivGeometry"?new Cj(E,O,R):O.geometry.type==="PathGeometry"?new m$(E,O,R):O.geometry.type==="VectorGeometry"?new f$(E,O,R):O.geometry.type==="BooleanGeometry"?new $H(E,O,R):O.geometry.type==="ShapeBlendGeometry"?new l0(E,O,R):O.geometry.type==="UIGeometry"?new x$(E,O,R):new _j(E,O,R),z)}function hb(E,O,R){return console.assert(O.type!==void 0),O.type==="Mesh"?_Z(E,O,R):O.type==="Empty"?new wW(E,O):O.type==="Particle"?new Q$(E,O,R):O.type==="ParticleCollider"?new AW(E,O,R):O.type==="Splat"?new wW(E,O):O.type==="Bone"?new y$(E,O):O.type==="Page"?new d$(E,O,R):O.type==="PointLight"?new p$(E,O,R):O.type==="SpotLight"?new TK(E,O,R):O.type==="DirectionalLight"?new AK(E,O,R):O.type==="Component"||O.type==="Instance"?new v$(E,O,R):$T.is(O.type)?new YH(E,O):(console.error(O),new wW(E,O))}nL.createEntity=hb;function IZ(E,O,R){let z=hb(E.identity,O,R),V=E.children,j=E.attachedPaths,Y=E.parent,ee=E.component,se=E.instances,he=E.overrideData,ce=E.uuid,ue=E.stateSelection;E.dispose();for(let O of Object.keys(E))delete E[O];Object.setPrototypeOf(E,Object.getPrototypeOf(z));for(let O of Object.keys(z))E[O]=z[O];E.children=[...E.children,...V],E.attachedPaths=j,E.parent=Y,E.component=ee,E.instances=se,E.uuid=ce,E.overrideData=he,E.updateState(E.data,R),ue&&E.changeSelectedState(ue,R),E.resetBBoxNeedsUpdate()}nL.changeEntityProptotype=IZ;nL.Cloner=SH;function mB(E,O,R,z){E.updateByOp(O,R,z,!1)}var J$=5,$$=new Na;$$.setAttribute("position",new Sa(new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),3));var e0=class extends ip{constructor(E){super({...E,depthTest:!1,depthWrite:!1,glslVersion:cn,vertexShader:"\n\t\t\t\tprecision highp float;\n\t\t\t\tin vec3 position;\n\t\t\t\tvoid main() {\n\t\t\t\t\tgl_Position = vec4(position, 1);\n\t\t\t\t}\n\t\t\t"})}customProgramCacheKey(){return""}};function gB(){return{shapeInput:()=>`\n\t\t\tconst float posRowCoord = ${.5/J$};  // vec4: px py pz opType\n\t\t\tconst float quatRowCoord = ${1.5/J$};  // vec4: qx qy qz qw\n\t\t\tconst float param1RowCoord = ${2.5/J$};// vec4: type param1 param2 param3\n\t\t\tconst float param2RowCoord = ${3.5/J$};// vec4: blendRange roundness scale param4\n\t\t\tconst float colorRowCoord = ${4.5/J$}; // vec4: r g b a\n\t\t\tuniform sampler2D shapesDataTexture;\n\t\t\tvec4 shapePos(float iin) { \n\t\t\t\tvec4 r = texture(shapesDataTexture, vec2(iin, posRowCoord));\n\t\t\t\treturn r;\n\t\t\t}\n\t\t\tvec4 shapeQuat(float iin) {\n\t\t\t\tvec4 r = texture(shapesDataTexture, vec2(iin, quatRowCoord));\n\t\t\t\treturn r;\n\t\t\t}\n\t\t\tvec4 shapeParams1(float iin) {\n\t\t\t\tvec4 r = texture(shapesDataTexture, vec2(iin, param1RowCoord));\n\t\t\t\treturn r;\n\t\t\t}\n\t\t\tvec4 shapeParams2(float iin) {\n\t\t\t\tvec4 r = texture(shapesDataTexture, vec2(iin, param2RowCoord));\n\t\t\t\treturn r;\n\t\t\t}\n\t\t\tvec4 shapeColor(float iin) {\n\t\t\t\tvec4 r = texture(shapesDataTexture, vec2(iin, colorRowCoord));\n\t\t\t\treturn r;\n\t\t\t}\n\t\t`,getxyzi:"\n\t\t\t// this code must complement lookup\n\t\t\tfloat xi = mod(gl_FragCoord.x - 0.5, VOXEL_RESOLUTION);\n\t\t\tfloat yi = mod(gl_FragCoord.y - 0.5, VOXEL_RESOLUTION);\n\t\t\tfloat zi = floor((gl_FragCoord.x - 0.5) * INV_VOXEL_RESOLUTION) + floor((gl_FragCoord.y - 0.5) * INV_VOXEL_RESOLUTION) * Z_LAYERS_PER_ROW;\n\t\t",lookup:"\n\t\t\tuniform sampler2D potentialPassTexture;\n\t\t\tuniform sampler2D voxelPassTexture; // includes normal (in xyz) and key (in w)\n\t\t\t\n\t\t\t// box or marching cube lookup value in value texture, integer box coord inputs\n\t\t\t// this code must complement codebits.getxyzi\n\t\t\tvec4 look(float xi, float yi, float zi, sampler2D rt) {// range 0 .. numv etc\n\t\t\t\tvec2 uv = vec2(\n\t\t\t\t\tmod(zi, Z_LAYERS_PER_ROW) + (xi + 0.5) / VOXEL_RESOLUTION,\n\t\t\t\t\tfloor(zi / Z_LAYERS_PER_ROW) + (yi + 0.5) / VOXEL_RESOLUTION\n\t\t\t\t); \n\t\t\t\tuv /= Z_LAYERS_PER_ROW;\n\t\t\t\treturn texture(rt, uv);\n\t\t\t}\n\t\t",getpart:"\n\t\t\tfloat getpart(inout float a, float b) {\n\t\t\t\tfloat t = floor(a/b);\n\t\t\t\tfloat r = a - t*b;\n\t\t\t\ta = t;\n\t\t\t\treturn r;\n\t\t\t}\n\t\t",triTable:new Float32Array([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,8,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,1,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,8,1,1,8,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,2,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,8,0,10,2,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,2,9,9,2,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,8,2,8,10,2,8,9,10,-1,-1,-1,-1,-1,-1,-1,2,11,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,11,0,0,11,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,9,1,11,3,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,11,1,11,9,1,11,8,9,-1,-1,-1,-1,-1,-1,-1,1,10,3,3,10,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,10,0,10,8,0,10,11,8,-1,-1,-1,-1,-1,-1,-1,0,9,3,9,11,3,9,10,11,-1,-1,-1,-1,-1,-1,-1,10,8,9,11,8,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,7,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,3,4,4,3,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,1,0,7,4,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,1,4,1,7,4,1,3,7,-1,-1,-1,-1,-1,-1,-1,10,2,1,7,4,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,4,3,4,0,3,10,2,1,-1,-1,-1,-1,-1,-1,-1,10,2,9,2,0,9,7,4,8,-1,-1,-1,-1,-1,-1,-1,9,10,2,7,9,2,3,7,2,4,9,7,-1,-1,-1,-1,7,4,8,2,11,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,4,11,4,2,11,4,0,2,-1,-1,-1,-1,-1,-1,-1,1,0,9,7,4,8,11,3,2,-1,-1,-1,-1,-1,-1,-1,11,7,4,11,4,9,2,11,9,1,2,9,-1,-1,-1,-1,1,10,3,10,11,3,4,8,7,-1,-1,-1,-1,-1,-1,-1,10,11,1,11,4,1,4,0,1,4,11,7,-1,-1,-1,-1,8,7,4,11,0,9,10,11,9,3,0,11,-1,-1,-1,-1,11,7,4,9,11,4,10,11,9,-1,-1,-1,-1,-1,-1,-1,4,5,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,5,9,3,8,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,5,0,0,5,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,5,8,5,3,8,5,1,3,-1,-1,-1,-1,-1,-1,-1,10,2,1,4,5,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,0,3,10,2,1,5,9,4,-1,-1,-1,-1,-1,-1,-1,10,2,5,2,4,5,2,0,4,-1,-1,-1,-1,-1,-1,-1,5,10,2,5,2,3,4,5,3,8,4,3,-1,-1,-1,-1,4,5,9,11,3,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,11,0,11,8,0,5,9,4,-1,-1,-1,-1,-1,-1,-1,4,5,0,5,1,0,11,3,2,-1,-1,-1,-1,-1,-1,-1,5,1,2,8,5,2,11,8,2,5,8,4,-1,-1,-1,-1,11,3,10,3,1,10,4,5,9,-1,-1,-1,-1,-1,-1,-1,5,9,4,1,8,0,1,10,8,10,11,8,-1,-1,-1,-1,0,4,5,11,0,5,10,11,5,3,0,11,-1,-1,-1,-1,8,4,5,10,8,5,11,8,10,-1,-1,-1,-1,-1,-1,-1,8,7,9,9,7,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,3,9,3,5,9,3,7,5,-1,-1,-1,-1,-1,-1,-1,8,7,0,7,1,0,7,5,1,-1,-1,-1,-1,-1,-1,-1,3,5,1,7,5,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,7,9,7,5,9,2,1,10,-1,-1,-1,-1,-1,-1,-1,2,1,10,0,5,9,0,3,5,3,7,5,-1,-1,-1,-1,2,0,8,5,2,8,7,5,8,2,5,10,-1,-1,-1,-1,5,10,2,3,5,2,7,5,3,-1,-1,-1,-1,-1,-1,-1,5,9,7,9,8,7,2,11,3,-1,-1,-1,-1,-1,-1,-1,7,5,9,2,7,9,0,2,9,11,7,2,-1,-1,-1,-1,11,3,2,8,1,0,8,7,1,7,5,1,-1,-1,-1,-1,1,2,11,7,1,11,5,1,7,-1,-1,-1,-1,-1,-1,-1,8,5,9,7,5,8,3,1,10,11,3,10,-1,-1,-1,-1,0,7,5,9,0,5,0,11,7,10,0,1,0,10,11,-1,0,10,11,3,0,11,0,5,10,7,0,8,0,7,5,-1,5,10,11,5,11,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,6,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,8,0,6,10,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,0,9,6,10,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,8,1,8,9,1,6,10,5,-1,-1,-1,-1,-1,-1,-1,5,6,1,1,6,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,6,1,6,2,1,8,0,3,-1,-1,-1,-1,-1,-1,-1,5,6,9,6,0,9,6,2,0,-1,-1,-1,-1,-1,-1,-1,8,9,5,2,8,5,6,2,5,8,2,3,-1,-1,-1,-1,11,3,2,5,6,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,0,11,0,2,11,5,6,10,-1,-1,-1,-1,-1,-1,-1,9,1,0,11,3,2,6,10,5,-1,-1,-1,-1,-1,-1,-1,6,10,5,2,9,1,2,11,9,11,8,9,-1,-1,-1,-1,11,3,6,3,5,6,3,1,5,-1,-1,-1,-1,-1,-1,-1,11,8,0,5,11,0,1,5,0,6,11,5,-1,-1,-1,-1,6,11,3,6,3,0,5,6,0,9,5,0,-1,-1,-1,-1,9,5,6,11,9,6,8,9,11,-1,-1,-1,-1,-1,-1,-1,6,10,5,8,7,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,3,4,3,7,4,10,5,6,-1,-1,-1,-1,-1,-1,-1,0,9,1,6,10,5,7,4,8,-1,-1,-1,-1,-1,-1,-1,5,6,10,7,9,1,3,7,1,4,9,7,-1,-1,-1,-1,2,1,6,1,5,6,8,7,4,-1,-1,-1,-1,-1,-1,-1,5,2,1,6,2,5,4,0,3,7,4,3,-1,-1,-1,-1,7,4,8,5,0,9,5,6,0,6,2,0,-1,-1,-1,-1,9,3,7,4,9,7,9,2,3,6,9,5,9,6,2,-1,2,11,3,4,8,7,5,6,10,-1,-1,-1,-1,-1,-1,-1,6,10,5,2,7,4,0,2,4,11,7,2,-1,-1,-1,-1,9,1,0,8,7,4,11,3,2,6,10,5,-1,-1,-1,-1,1,2,9,2,11,9,11,4,9,4,11,7,6,10,5,-1,7,4,8,5,11,3,1,5,3,6,11,5,-1,-1,-1,-1,11,1,5,6,11,5,11,0,1,4,11,7,11,4,0,-1,9,5,0,5,6,0,6,3,0,3,6,11,7,4,8,-1,9,5,6,11,9,6,9,7,4,9,11,7,-1,-1,-1,-1,9,4,10,10,4,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,6,10,4,10,9,4,3,8,0,-1,-1,-1,-1,-1,-1,-1,1,0,10,0,6,10,0,4,6,-1,-1,-1,-1,-1,-1,-1,1,3,8,6,1,8,4,6,8,10,1,6,-1,-1,-1,-1,9,4,1,4,2,1,4,6,2,-1,-1,-1,-1,-1,-1,-1,8,0,3,9,2,1,9,4,2,4,6,2,-1,-1,-1,-1,4,2,0,6,2,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,4,2,8,6,2,4,-1,-1,-1,-1,-1,-1,-1,9,4,10,4,6,10,3,2,11,-1,-1,-1,-1,-1,-1,-1,2,8,0,11,8,2,10,9,4,6,10,4,-1,-1,-1,-1,2,11,3,6,1,0,4,6,0,10,1,6,-1,-1,-1,-1,1,4,6,10,1,6,1,8,4,11,1,2,1,11,8,-1,4,6,9,6,3,9,3,1,9,3,6,11,-1,-1,-1,-1,1,11,8,0,1,8,1,6,11,4,1,9,1,4,6,-1,6,11,3,0,6,3,4,6,0,-1,-1,-1,-1,-1,-1,-1,8,4,6,8,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,6,10,7,10,8,7,10,9,8,-1,-1,-1,-1,-1,-1,-1,3,7,0,7,10,0,10,9,0,10,7,6,-1,-1,-1,-1,7,6,10,7,10,1,8,7,1,0,8,1,-1,-1,-1,-1,7,6,10,1,7,10,3,7,1,-1,-1,-1,-1,-1,-1,-1,6,2,1,8,6,1,9,8,1,7,6,8,-1,-1,-1,-1,9,6,2,1,9,2,9,7,6,3,9,0,9,3,7,-1,0,8,7,6,0,7,2,0,6,-1,-1,-1,-1,-1,-1,-1,2,3,7,2,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,3,2,8,6,10,9,8,10,7,6,8,-1,-1,-1,-1,7,0,2,11,7,2,7,9,0,10,7,6,7,10,9,-1,0,8,1,8,7,1,7,10,1,10,7,6,11,3,2,-1,1,2,11,7,1,11,1,6,10,1,7,6,-1,-1,-1,-1,6,9,8,7,6,8,6,1,9,3,6,11,6,3,1,-1,1,9,0,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,7,6,0,7,0,11,3,0,6,11,-1,-1,-1,-1,6,11,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,6,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,0,3,6,7,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,1,0,6,7,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,1,8,1,3,8,6,7,11,-1,-1,-1,-1,-1,-1,-1,2,1,10,7,11,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,2,1,8,0,3,7,11,6,-1,-1,-1,-1,-1,-1,-1,0,9,2,9,10,2,7,11,6,-1,-1,-1,-1,-1,-1,-1,7,11,6,3,10,2,3,8,10,8,9,10,-1,-1,-1,-1,3,2,7,7,2,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,0,7,0,6,7,0,2,6,-1,-1,-1,-1,-1,-1,-1,6,7,2,7,3,2,9,1,0,-1,-1,-1,-1,-1,-1,-1,2,6,1,6,8,1,8,9,1,6,7,8,-1,-1,-1,-1,6,7,10,7,1,10,7,3,1,-1,-1,-1,-1,-1,-1,-1,6,7,10,10,7,1,7,8,1,8,0,1,-1,-1,-1,-1,7,3,0,10,7,0,9,10,0,7,10,6,-1,-1,-1,-1,10,6,7,8,10,7,9,10,8,-1,-1,-1,-1,-1,-1,-1,4,8,6,6,8,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,6,3,6,0,3,6,4,0,-1,-1,-1,-1,-1,-1,-1,11,6,8,6,4,8,1,0,9,-1,-1,-1,-1,-1,-1,-1,6,4,9,3,6,9,1,3,9,6,3,11,-1,-1,-1,-1,4,8,6,8,11,6,1,10,2,-1,-1,-1,-1,-1,-1,-1,10,2,1,11,0,3,11,6,0,6,4,0,-1,-1,-1,-1,8,11,4,11,6,4,9,2,0,9,10,2,-1,-1,-1,-1,3,9,10,2,3,10,3,4,9,6,3,11,3,6,4,-1,3,2,8,2,4,8,2,6,4,-1,-1,-1,-1,-1,-1,-1,2,4,0,2,6,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,9,1,4,3,2,6,4,2,8,3,4,-1,-1,-1,-1,4,9,1,2,4,1,6,4,2,-1,-1,-1,-1,-1,-1,-1,3,1,8,1,6,8,6,4,8,1,10,6,-1,-1,-1,-1,0,1,10,6,0,10,4,0,6,-1,-1,-1,-1,-1,-1,-1,3,6,4,8,3,4,3,10,6,9,3,0,3,9,10,-1,4,9,10,4,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,9,4,11,6,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,8,0,5,9,4,6,7,11,-1,-1,-1,-1,-1,-1,-1,1,0,5,0,4,5,11,6,7,-1,-1,-1,-1,-1,-1,-1,6,7,11,4,3,8,4,5,3,5,1,3,-1,-1,-1,-1,4,5,9,2,1,10,11,6,7,-1,-1,-1,-1,-1,-1,-1,7,11,6,10,2,1,3,8,0,5,9,4,-1,-1,-1,-1,11,6,7,10,4,5,10,2,4,2,0,4,-1,-1,-1,-1,8,4,3,4,5,3,5,2,3,2,5,10,6,7,11,-1,3,2,7,2,6,7,9,4,5,-1,-1,-1,-1,-1,-1,-1,4,5,9,6,8,0,2,6,0,7,8,6,-1,-1,-1,-1,2,6,3,6,7,3,0,5,1,0,4,5,-1,-1,-1,-1,8,2,6,7,8,6,8,1,2,5,8,4,8,5,1,-1,4,5,9,6,1,10,6,7,1,7,3,1,-1,-1,-1,-1,10,6,1,6,7,1,7,0,1,0,7,8,4,5,9,-1,10,0,4,5,10,4,10,3,0,7,10,6,10,7,3,-1,10,6,7,8,10,7,10,4,5,10,8,4,-1,-1,-1,-1,5,9,6,9,11,6,9,8,11,-1,-1,-1,-1,-1,-1,-1,11,6,3,3,6,0,6,5,0,5,9,0,-1,-1,-1,-1,8,11,0,11,5,0,5,1,0,11,6,5,-1,-1,-1,-1,3,11,6,5,3,6,1,3,5,-1,-1,-1,-1,-1,-1,-1,10,2,1,11,5,9,8,11,9,6,5,11,-1,-1,-1,-1,3,11,0,11,6,0,6,9,0,9,6,5,10,2,1,-1,5,8,11,6,5,11,5,0,8,2,5,10,5,2,0,-1,3,11,6,5,3,6,3,10,2,3,5,10,-1,-1,-1,-1,9,8,5,8,2,5,2,6,5,2,8,3,-1,-1,-1,-1,6,5,9,0,6,9,2,6,0,-1,-1,-1,-1,-1,-1,-1,8,5,1,0,8,1,8,6,5,2,8,3,8,2,6,-1,6,5,1,6,1,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,6,3,1,10,6,1,6,8,3,9,6,5,6,9,8,-1,0,1,10,6,0,10,0,5,9,0,6,5,-1,-1,-1,-1,8,3,0,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,6,5,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,5,11,11,5,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,5,11,5,7,11,0,3,8,-1,-1,-1,-1,-1,-1,-1,7,11,5,11,10,5,0,9,1,-1,-1,-1,-1,-1,-1,-1,5,7,10,7,11,10,1,8,9,1,3,8,-1,-1,-1,-1,2,1,11,1,7,11,1,5,7,-1,-1,-1,-1,-1,-1,-1,3,8,0,7,2,1,5,7,1,11,2,7,-1,-1,-1,-1,5,7,9,7,2,9,2,0,9,7,11,2,-1,-1,-1,-1,2,5,7,11,2,7,2,9,5,8,2,3,2,8,9,-1,10,5,2,5,3,2,5,7,3,-1,-1,-1,-1,-1,-1,-1,0,2,8,2,5,8,5,7,8,5,2,10,-1,-1,-1,-1,1,0,9,3,10,5,7,3,5,2,10,3,-1,-1,-1,-1,2,8,9,1,2,9,2,7,8,5,2,10,2,5,7,-1,5,3,1,5,7,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,8,0,1,7,0,5,7,1,-1,-1,-1,-1,-1,-1,-1,3,0,9,5,3,9,7,3,5,-1,-1,-1,-1,-1,-1,-1,7,8,9,7,9,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,8,5,8,10,5,8,11,10,-1,-1,-1,-1,-1,-1,-1,4,0,5,0,11,5,11,10,5,0,3,11,-1,-1,-1,-1,9,1,0,10,4,8,11,10,8,5,4,10,-1,-1,-1,-1,4,11,10,5,4,10,4,3,11,1,4,9,4,1,3,-1,1,5,2,5,8,2,8,11,2,8,5,4,-1,-1,-1,-1,11,4,0,3,11,0,11,5,4,1,11,2,11,1,5,-1,5,2,0,9,5,0,5,11,2,8,5,4,5,8,11,-1,5,4,9,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,5,2,2,5,3,5,4,3,4,8,3,-1,-1,-1,-1,2,10,5,4,2,5,0,2,4,-1,-1,-1,-1,-1,-1,-1,2,10,3,10,5,3,5,8,3,8,5,4,9,1,0,-1,2,10,5,4,2,5,2,9,1,2,4,9,-1,-1,-1,-1,5,4,8,3,5,8,1,5,3,-1,-1,-1,-1,-1,-1,-1,5,4,0,5,0,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,4,8,3,5,8,5,0,9,5,3,0,-1,-1,-1,-1,5,4,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,11,4,11,9,4,11,10,9,-1,-1,-1,-1,-1,-1,-1,3,8,0,7,9,4,7,11,9,11,10,9,-1,-1,-1,-1,11,10,1,4,11,1,0,4,1,11,4,7,-1,-1,-1,-1,4,1,3,8,4,3,4,10,1,11,4,7,4,11,10,-1,7,11,4,4,11,9,11,2,9,2,1,9,-1,-1,-1,-1,4,7,9,7,11,9,11,1,9,1,11,2,3,8,0,-1,4,7,11,2,4,11,0,4,2,-1,-1,-1,-1,-1,-1,-1,4,7,11,2,4,11,4,3,8,4,2,3,-1,-1,-1,-1,10,9,2,9,7,2,7,3,2,9,4,7,-1,-1,-1,-1,7,10,9,4,7,9,7,2,10,0,7,8,7,0,2,-1,10,7,3,2,10,3,10,4,7,0,10,1,10,0,4,-1,2,10,1,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,4,7,1,4,3,1,7,-1,-1,-1,-1,-1,-1,-1,1,9,4,7,1,4,1,8,0,1,7,8,-1,-1,-1,-1,3,0,4,3,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,8,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,10,9,8,11,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,0,3,11,9,3,10,9,11,-1,-1,-1,-1,-1,-1,-1,10,1,0,8,10,0,11,10,8,-1,-1,-1,-1,-1,-1,-1,10,1,3,10,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,2,1,9,11,1,8,11,9,-1,-1,-1,-1,-1,-1,-1,9,0,3,11,9,3,9,2,1,9,11,2,-1,-1,-1,-1,11,2,0,11,0,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,2,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,2,10,8,2,9,8,10,-1,-1,-1,-1,-1,-1,-1,2,10,9,2,9,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,2,10,8,2,8,1,0,8,10,1,-1,-1,-1,-1,2,10,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,1,8,1,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1]),numTrisTable:new Float32Array([0,1,1,2,1,2,2,3,1,2,2,3,2,3,3,2,1,2,2,3,2,3,3,4,2,3,3,4,3,4,4,3,1,2,2,3,2,3,3,4,2,3,3,4,3,4,4,3,2,3,3,2,3,4,4,3,3,4,4,3,4,5,5,2,1,2,2,3,2,3,3,4,2,3,3,4,3,4,4,3,2,3,3,4,3,4,4,5,3,4,4,5,4,5,5,4,2,3,3,4,3,4,2,3,3,4,4,5,4,5,3,2,3,4,4,3,4,5,3,2,4,5,5,4,5,2,4,1,1,2,2,3,2,3,3,4,2,3,3,4,3,4,4,3,2,3,3,4,3,4,4,5,3,2,4,3,4,3,5,2,2,3,3,4,3,4,4,5,3,4,4,5,4,5,5,4,3,4,4,3,4,5,5,4,4,3,5,2,5,4,2,1,2,3,3,4,3,4,4,5,3,4,4,5,2,3,3,2,3,4,4,5,4,5,5,2,4,3,5,4,3,2,4,1,3,4,4,5,4,5,3,4,4,5,5,2,3,4,2,1,2,3,3,2,3,4,2,1,3,2,4,1,2,1,1,0])}}var t0=new co,i0=class{constructor(){this.pyramidPassScene=new Wd;this.pyramidPassMaterial=new e0({name:"PyramidPass"});this.pyramidPassUniforms={inputTexture:{value:void 0},inputWidth:{value:0},inputHeight:{value:0},inputShiftX:{value:0},outputShiftX:{value:0}};this.pyramidTopLevelReadPixelBuffer=new Float32Array(4);let E="\n\t\t\tprecision highp float;\n\t\t\tprecision highp sampler2D;\n\t\t\tlayout(location = 0) out vec4 pc_FragColor;\n\t\t\tuniform sampler2D inputTexture;\n\t\t\tuniform float inputWidth;\n\t\t\tuniform float inputHeight;\n\t\t\tuniform float inputShiftX;\n\t\t\tuniform float outputShiftX;\n\t\t\tconst vec2 half_unit_coord = vec2(0.5);\n\t\t\tconst vec4 one = vec4(1.0);\n\t\t\tvoid main() {\n\t\t\t\tvec2 inputSize = vec2(inputWidth, inputHeight);\n\t\t\t\tvec2 input_pixel_uv = 1. / inputSize;\n\t\t\t\tvec2 coord = gl_FragCoord.xy - half_unit_coord;\n\t\t\t\tcoord.x -= outputShiftX;\n\t\t\t\tcoord = coord * 2. + half_unit_coord;\n\t\t\t\tcoord.x += inputShiftX;\n\n\t\t\t\t// sample bottom left corner\n\t\t\t\tvec2 input_uv = coord / inputSize;\n\t\t\t\tfloat bl = texture(inputTexture, input_uv).r;\n\n\t\t\t\t// sample bottom right corner\n\t\t\t\tinput_uv.x += input_pixel_uv.x;\n\t\t\t\tfloat br = texture(inputTexture, input_uv).r;\n\n\t\t\t\t// sample top right corner\n\t\t\t\tinput_uv.y += input_pixel_uv.y;\n\t\t\t\tfloat tr = texture(inputTexture, input_uv).r;\n\n\t\t\t\t// sample top left corner\n\t\t\t\tinput_uv.x -= input_pixel_uv.x;\n\t\t\t\tfloat tl = texture(inputTexture, input_uv).r;\n\n\t\t\t\tpc_FragColor.a = bl;\n\t\t\t\tpc_FragColor.b = pc_FragColor.a + br;\n\t\t\t\tpc_FragColor.g = pc_FragColor.b + tr;\n\t\t\t\tpc_FragColor.r = pc_FragColor.g + tl; \n\t\t\t}\n\t\t";this.pyramidPassMaterial.fragmentShader=E,this.pyramidPassMaterial.uniforms=this.pyramidPassUniforms,this.pyramidPassMaterial.depthTest=!1,this.pyramidPassMaterial.depthWrite=!1;let O=new eo($$,this.pyramidPassMaterial);O.frustumCulled=!1,this.pyramidPassScene.add(O)}renderPyramid(E,O,R,z,V){(new Cf).min.setScalar(0);let j=O.length-1,Y=new Nn;R.getViewport(Y),this.pyramidPassUniforms.inputShiftX.value=0,this.pyramidPassUniforms.outputShiftX.value=0;let ee=j-1;for(let j=ee;j>=0;j--){let Y=j%2===ee%2?V[0]:V[1],se=j===ee?z:j%2===ee%2?V[1]:V[0];this.pyramidPassUniforms.inputTexture.value=Array.isArray(se.texture)?se.texture[1]:se.texture,this.pyramidPassUniforms.inputWidth.value=se.width,this.pyramidPassUniforms.inputHeight.value=se.height,R.setRenderTarget(Y);let he=O[j],ce=R.getPixelRatio();R.setViewport(this.pyramidPassUniforms.outputShiftX.value/ce,0,he/ce,he/ce),j===2&&E%2!==0&&R.setViewport(this.pyramidPassUniforms.outputShiftX.value/ce,0,3/ce,3/ce),R.render(this.pyramidPassScene,t0);let ue=this.pyramidPassUniforms.inputShiftX.value;this.pyramidPassUniforms.inputShiftX.value=this.pyramidPassUniforms.outputShiftX.value,this.pyramidPassUniforms.outputShiftX.value=ue,j<ee&&(this.pyramidPassUniforms.outputShiftX.value+=O[j+1])}R.setViewport(Y);let se=O.length%2===0?0:1;return R.readRenderTargetPixelsAsync(V[se],V[se].width-1,0,1,1,this.pyramidTopLevelReadPixelBuffer).then((()=>this.pyramidTopLevelReadPixelBuffer[0]))}};var r0=24,n0=96,s0=gB(),a0=2,o0=class extends _j{constructor(E,O,R){super(E,O,R);this.data=O;this.needsRebuild=!0;this.customDepthMaterialNeedsUpdate=!1;this._npart=-1;this.spatialn=1;this.drawRangeNeedsForceUpdate=!0;this._resolutionLevel=-1;this.resolution=64;this.spatialDivisions=25;this.zLayersPerRow=8;this.basePyramidSize=512;this.pyramidTexture1Width=341;this.pyramidTexture1Height=256;this.pyramidTexture2Width=170;this.pyramidTexture2Height=128;this.numLevels=9;this.pyramidLevelSizes=[1,2,4,8,16,32,64,128,256,512];this.bboxSize=0;this.bboxOffset=0;this.shapesDataTexture={value:void 0};this.spatialscene=new Wd;this.potentialPassScene=new Wd;this.voxelPassScene=new Wd;this._spatialPassRenderTargets=[];this._potentialPassRenderTargets=[];this._voxelPassRenderTargets=[];this._pyramidRenderTargets=[];this.geometry=new Na,this.geometry.drawRange.count=0,this.spatialPassUniforms={span:{value:-1},shapesDataTexture:this.shapesDataTexture,npart:{value:this.npart},spatialn:{value:this.spatialn}},this.spatialMesh=new eo($$,this.spatialPassMaterial()),this.spatialMesh.frustumCulled=!1,this.spatialscene.add(this.spatialMesh);let z=new Zd(s0.triTable,16,256,Gi,Ii);z.needsUpdate=!0;let V=new Zd(s0.numTrisTable,256,1,Gi,Ii);V.needsUpdate=!0,this.voxelPassUniforms={potentialPassTexture:{value:void 0},numTrisTable:{value:V}},this.voxelMesh=new eo($$,this.voxelPassMaterial()),this.voxelMesh.frustumCulled=!1,this.voxelPassScene.add(this.voxelMesh),this.potentialPassUniforms={shapesDataTexture:this.shapesDataTexture,spatialPassTexture:{value:void 0},npart:{value:this.npart},spatialn:{value:this.spatialn}},this.potentialMesh=new eo($$,this.potentialPassMaterial()),this.potentialMesh.frustumCulled=!1,this.potentialPassScene.add(this.potentialMesh),this.marchPassUniforms={triTable:{value:z},potentialPassTexture:{value:void 0},voxelPassTexture:{value:void 0},pyramidTexture1:{value:void 0},pyramidTexture1Size:{value:void 0},pyramidTexture2:{value:void 0},pyramidTexture2Size:{value:void 0}},this.frustumCulled=!1,this.onBeforeShadowPass=E=>{if(BZ.call(this),this.npart===0){this.geometry.drawRange.count=0;return}let O=this.material.root;if(O.shadersPatchedForShapeBlend){if(this.customDepthMaterialNeedsUpdate){this.customDepthMaterialNeedsUpdate=!1,this.customDepthMaterial=new lo({vertexShader:O.vertexShader,fragmentShader:"\n\t\t\t\t\t\t#include <packing>\n\t\t\t\t\t\tvoid main()\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tgl_FragColor = packDepthToRGBA(gl_FragCoord.z);\n\t\t\t\t\t\t}\n\t\t\t\t\t",uniforms:O.uniforms,defines:this.material.defines}),this.isMeshDepthMaterial=!0,this.customDistanceMaterial=new lo({vertexShader:O.vertexShader,fragmentShader:"\n\t\t\t\t\t#include <common>\n\t\t\t\t\t#include <packing>\n\t\t\t\t\tuniform vec3 referencePosition;\n\t\t\t\t\tuniform float nearDistance;\n\t\t\t\t\tuniform float farDistance;\n\t\t\t\t\t// World-space position\n\t\t\t\t\tvarying vec3 vWPosition;\n\t\t\t\t\tvoid main()\n\t\t\t\t\t{\n\t\t\t\t\t\tfloat dist = length(vWPosition - referencePosition);\n\t\t\t\t\t\tdist = (dist - nearDistance) / (farDistance - nearDistance);\n\t\t\t\t\t\tdist = saturate(dist);\n\t\t\t\t\t\t// Required by Three.js for this to work\n\t\t\t\t\t\tgl_FragColor = packDepthToRGBA( dist );\n\t\t\t\t\t}",uniforms:{nearDistance:{value:0},farDistance:{value:0},referencePosition:{value:new Wn},opacity:{value:0},...O.uniforms},defines:this.material.defines});let E=this.customDistanceMaterial;E.referencePosition=new Wn,E.nearDistance=0,E.farDistance=0,E.opacity=1,E.isMeshDistanceMaterial=!0}}else this.patchVertexShaderForShapeBlend(O),O.shadersPatchedForShapeBlend=!0,this.customDepthMaterialNeedsUpdate=!0;if(this.spatialPassUniforms.npart.value=this.npart,this.spatialPassUniforms.spatialn.value=this.spatialn,this.potentialPassUniforms.npart.value=this.npart,this.potentialPassUniforms.spatialn.value=this.spatialn,this.needsRebuild){this.needsRebuild=!1,this.spatialMesh.material.defines.RES=this.resolutionLevel,this.spatialMesh.material.needsUpdate=!0,this.potentialMesh.material.defines.RES=this.resolutionLevel,this.potentialPassUniforms.spatialPassTexture.value=this.spatialPassRenderTarget.texture,this.potentialMesh.material.needsUpdate=!0,this.voxelMesh.material.defines.RES=this.resolutionLevel,this.voxelMesh.material.needsUpdate=!0,this.voxelPassUniforms.potentialPassTexture.value=this.potentialPassRenderTarget.texture,this.marchPassUniforms.potentialPassTexture.value=this.potentialPassRenderTarget.texture,this.marchPassUniforms.voxelPassTexture.value=this.voxelPassRenderTarget.texture[0],this.material.defines.RES=this.resolutionLevel,this.material.defines.LEVELS=this.pyramidLevelSizes.length,this.material.defines.LOOP=this.pyramidLevelSizes.length%2===0?this.pyramidLevelSizes.length-3:this.pyramidLevelSizes.length-2,this.material.defines.HALF=this.pyramidLevelSizes.length%2===0?1:0,this.material.needsUpdate=!0;let E=this.pyramidLevelSizes.length%2===0?0:1,O=this.pyramidLevelSizes.length%2===0?1:0;this.marchPassUniforms.pyramidTexture2.value=this.pyramidRenderTarget[E].texture,this.marchPassUniforms.pyramidTexture2Size.value=new bn(this.pyramidRenderTarget[E].width,this.pyramidRenderTarget[E].height),this.marchPassUniforms.pyramidTexture1.value=this.pyramidRenderTarget[O].texture,this.marchPassUniforms.pyramidTexture1Size.value=new bn(this.pyramidRenderTarget[O].width,this.pyramidRenderTarget[O].height),Object.assign(this.material.uniforms,this.marchPassUniforms)}let R=E.shadowMap.enabled;E.shadowMap.enabled=!1;let z=E.getRenderTarget();E.setRenderTarget(this.spatialPassRenderTarget),E.render(this.spatialscene,t0),E.setRenderTarget(this.potentialPassRenderTarget),E.render(this.potentialPassScene,t0),E.setRenderTarget(this.voxelPassRenderTarget),E.render(this.voxelPassScene,t0),o0.streamCompaction.renderPyramid(this.resolutionLevel,this.pyramidLevelSizes,E,this.voxelPassRenderTarget,this.pyramidRenderTarget).then((E=>{this.material.wireframe&&(E*3>this.geometry.attributes.position.count||this.drawRangeNeedsForceUpdate)&&(this.geometry.dispose(),this.geometry=new Na,this.geometry.userData.parameters={width:this.bboxSize,height:this.bboxSize,depth:this.bboxSize,centerOffset:[this.bboxOffset,this.bboxOffset,this.bboxOffset]},this.geometry.attributes.position=new Sa(new Float32Array(E*3*2),3)),(E*3>this.geometry.drawRange.count||this.drawRangeNeedsForceUpdate)&&(this.geometry.drawRange.count=Math.floor(E*1.2)*3),this.drawRangeNeedsForceUpdate=!1})),E.shadowMap.enabled=R,E.setRenderTarget(z)}}set npart(E){E!==this._npart&&(this.drawRangeNeedsForceUpdate=!0,this._npart=E,this.spatialn=Math.ceil(E/(4*r0)))}get npart(){return this._npart}set resolutionLevel(E){let O=Math.min(8,Math.max(5,E));if(O!==this._resolutionLevel){switch(this._resolutionLevel=O,this.resolution=Math.pow(2,O),this.resolutionLevel){case 5:this.pyramidLevelSizes=[1,2,4,6,12,24,48,96,192],this.bboxSize=248*a0,this.bboxOffset=8*a0*-1/2;break;case 6:this.pyramidLevelSizes=[1,2,4,8,16,32,64,128,256,512],this.bboxSize=252*a0,this.bboxOffset=4*a0*-1/2;break;case 7:this.pyramidLevelSizes=[1,2,4,6,12,24,48,96,192,384,768,1536],this.bboxSize=254*a0,this.bboxOffset=2*a0*-1/2;break;case 8:this.pyramidLevelSizes=[1,2,4,8,16,32,64,128,256,512,1024,2048,4096],this.bboxSize=255*a0,this.bboxOffset=a0*-1/2;break}this.pyramidTexture1Width=0,this.pyramidTexture2Width=0,this.pyramidTexture1Height=this.pyramidLevelSizes[this.pyramidLevelSizes.length-2],this.pyramidTexture2Height=this.pyramidLevelSizes[this.pyramidLevelSizes.length-3];for(let E=this.pyramidLevelSizes.length-2;E>=0;E--)(this.pyramidLevelSizes.length-2)%2===E%2?this.pyramidTexture1Width+=this.pyramidLevelSizes[E]:this.pyramidTexture2Width+=this.pyramidLevelSizes[E];this.basePyramidSize=this.pyramidLevelSizes[this.pyramidLevelSizes.length-1],this.zLayersPerRow=this.basePyramidSize/this.resolution,this.numLevels=this.pyramidLevelSizes.length-1,this.geometry.userData.parameters={width:this.bboxSize,height:this.bboxSize,depth:this.bboxSize,centerOffset:[this.bboxOffset,this.bboxOffset,this.bboxOffset]},this.needsRebuild=!0}}get resolutionLevel(){return this._resolutionLevel}get spatialPassRenderTarget(){let E=this._spatialPassRenderTargets[this.resolutionLevel];return E||(E=new Un(this.spatialDivisions*this.spatialn,this.spatialDivisions**2,{format:Ni,type:Ii,stencilBuffer:!1,depthBuffer:!1,generateMipmaps:!1,minFilter:mi,magFilter:mi}),this._spatialPassRenderTargets[this.resolutionLevel]=E),E}get potentialPassRenderTarget(){let E=this._potentialPassRenderTargets[this.resolutionLevel];return E||(E=new Un(this.basePyramidSize,this.basePyramidSize,{format:Ni,type:Ii,stencilBuffer:!1,depthBuffer:!1,generateMipmaps:!1,minFilter:mi,magFilter:mi}),this._potentialPassRenderTargets[this.resolutionLevel]=E),E}get voxelPassRenderTarget(){let E=this._voxelPassRenderTargets[this.resolutionLevel];return E||(E=new Gn(this.basePyramidSize,this.basePyramidSize,2,{stencilBuffer:!1,depthBuffer:!1,generateMipmaps:!1,minFilter:mi,magFilter:mi}),E.texture[0].format=Ni,E.texture[0].type=Ii,E.texture[1].format=Gi,E.texture[1].type=Ii,this._voxelPassRenderTargets[this.resolutionLevel]=E),E}get pyramidRenderTarget(){let E=this._pyramidRenderTargets[this.resolutionLevel];if(!E){let O=new Un(this.pyramidTexture1Width,this.pyramidTexture1Height,{format:Ni,type:Ii,stencilBuffer:!1,depthBuffer:!1,magFilter:mi,minFilter:mi}),R=new Un(this.pyramidTexture2Width,this.pyramidTexture2Height,{format:Ni,type:Ii,stencilBuffer:!1,depthBuffer:!1,magFilter:mi,minFilter:mi});E=[O,R],this._pyramidRenderTargets[this.resolutionLevel]=E}return E}updateState(E,O){let R=this.material;super.updateState(E,O),R!==this.material&&(this.needsRebuild=!0),E.geometry&&(this.resolutionLevel=E.geometry.resolutionLevel,this.geometry.userData.parameters={width:this.bboxSize,height:this.bboxSize,depth:this.bboxSize,centerOffset:[this.bboxOffset,this.bboxOffset,this.bboxOffset]}),E.wireframe&&!this.geometry.getAttribute("position")?this.geometry.setAttribute("position",new Sa(new Float32Array(this.geometry.drawRange.count*3),3)):!E.wireframe&&this.geometry.getAttribute("position")&&this.geometry.deleteAttribute("position")}spatialPassMaterial(){let E=`\n\t\t\tprecision highp float;\n\t\t\tout vec4 pc_FragColor;\n\t\t\tconst float spatialDivisions = ${this.spatialDivisions}.;\n\t\t\tuniform float span;\n\t\t\tuniform float npart;\n\t\t\tuniform float spatialn;\n\t\t\t${s0.shapeInput()}\n\n\t\t\tvec3 low, high;     // range of current div; subset of -1 .. 1 with span border\n\n\t\t\t// lookup one element/channel's worth of spheres for current division\n\t\t\t// stating with low sphere number lowi\n\t\t\t// gives a key to which spheres from lowi..lowi+23 are active within given div (low..high)\n\t\t\tfloat spatialKey(float lowi) {\n\t\t\t\tfloat t = 0.;\n\t\t\t\tfor (float ii = ${r0-1}.; ii >= 0.; ii--) {\n\t\t\t\t\tfloat i = ii + lowi;\n\t\t\t\t\tfloat iin = (i + 0.5) / ${n0}.;\n\t\t\t\t\tvec4 shape = shapePos(iin);\n\t\t\t\t\tvec3 d = shape.xyz;\n\t\t\t\t\tfloat op = shape.w;\n\t\n\t\t\t\t\tt *= 2.;\n\t\t\t\t\tt += (\n\t\t\t\t\t\tlow.x < d.x && d.x < high.x &&\n\t\t\t\t\t\tlow.y < d.y && d.y < high.y &&\n\t\t\t\t\t\tlow.z < d.z && d.z < high.z &&\n\t\t\t\t\t\ti < npart || op == -2. // always include if op is -2, which is the intersection operation\n\t\t\t\t\t) ? 1. : 0.;\n\t\t\t\t}\n\t\t\t\treturn t;\n\t\t\t}\n\n\t\t\t${s0.getpart}\n\n\t\t\tvoid main() {               // spatialial fragment shader\n\t\t\t\t// find active div\n\t\t\t\tvec3 div;                               // which div is current\n\t\t\t\t// out holds x=> x, lowi faster moving and y=> z, y faster moving\n\t\t\t\tfloat yz = float(gl_FragCoord.y - 0.5);     // contains  z, y faster moving\n\t\t\t\tdiv.y = getpart(yz, spatialDivisions);\n\t\t\t\tdiv.z = yz; // getpart(yz, spatialDivisions.z); // what's left, should be the same as getpart\n\n\t\t\t\tfloat lx = float(gl_FragCoord.x - 0.5);     // contains x, lowi faster moving\n\t\t\t\tfloat lowi = getpart(lx, spatialn) * ${4*r0}.;\n\t\t\t\tdiv.x = lx;\n\n\t\t\t\tlow = div / spatialDivisions * 2. - 1. - span;\n\t\t\t\thigh = (div+1.) / spatialDivisions * 2. - 1. + span;\n\n\t\t\t\t// find active range of spheres\n\t\t\t\tpc_FragColor.x = spatialKey(lowi);\n\t\t\t\tpc_FragColor.y = spatialKey(lowi+${r0}.);\n\t\t\t\tpc_FragColor.z = spatialKey(lowi+${2*r0}.);\n\t\t\t\tpc_FragColor.w = spatialKey(lowi+${3*r0}.);\n\t\t\t}\n\t\t`;return new e0({name:"Spatial Pass",fragmentShader:E,uniforms:this.spatialPassUniforms})}potentialPassMaterial(){let E=`\n\t\t\tprecision highp float;\n\t\t\tout vec4 pc_FragColor;\n\n\t\t\t${s0.shapeInput()}\n\t\t\tuniform sampler2D spatialPassTexture;\n\n\t\t\tconst float res = float(RES);\n\t\t\tconst float VOXEL_RESOLUTION = pow(2., res);\n\t\t\tconst float Z_LAYERS_PER_ROW = ceil(pow(2., res / 2.));\n\t\t\tconst float VOXEL_RESOLUTION_SUB1 = VOXEL_RESOLUTION - 1.;\n\t\t\tconst float INV_VOXEL_RESOLUTION = 1.0 / VOXEL_RESOLUTION;\n\n\t\t\tuniform float npart;\n\t\t\tuniform float spatialn;\n\t\t\tconst float spatialDivisions = ${this.spatialDivisions}.;\n\t\t\tconst float spatialDivisions2 = spatialDivisions * spatialDivisions;\n\t\t\tconst float spatialDivisionsSub1 = spatialDivisions - 1.;\n\n\t\t\t${s0.getpart}\n\n\t\t\tvec3 packRGBAToVec3(vec4 color) {\n\t\t\t\tuint r = uint(color.r * 255.);\n\t\t\t\tuint g = uint(color.g * 255.);\n\t\t\t\tuint combined = (r << 8) | g; \n\t\t\t\treturn vec3(float(combined) * 0.00001525902, color.b, color.a); // 1/65535\n\t\t\t}\n\n\t\t\tvoid applyQuaternionToVector(in vec4 q, inout vec3 v) {\n\t\t\t\tv += 2.0 * cross(q.xyz, cross(q.xyz, v) + q.w * v);\n\t\t\t}\n\n\t\t\t/**\n\t\t\t * SDF functions (reference: https://iquilezles.org/articles/distfunctions/)\n\t\t\t */\n\n\t\t\t// branchless version of "Smooth Union, Subtraction and Intersection - bound, bound, bound" in above reference\n\t\t\tfloat smoothOperation(float op, float sdf, float d, float k) {\n\t\t\t  //        union: op =  1 => signSubtract =  1, signIntersection =  1\n\t\t\t  //     subtract: op = -1 => signSubtract = -1, signIntersection =  1\n\t\t\t\t// intersection: op = -2 => signSubtract = -1, signIntersection = -1\n\n\t\t\t\tfloat signSubtract = clamp(op, -1., 1.);\n\t\t\t\tfloat signIntersection = 2. * (op - signSubtract) + 1.;\n\t\t\t\tfloat h = clamp(\n\t\t\t\t\t0.5 + signSubtract * 0.5 * (sdf - signSubtract * signIntersection * d) / k,\n\t\t\t\t\t0.0,\n\t\t\t\t\t1.0\n\t\t\t\t);\n\t\t\t\treturn mix(sdf, signSubtract * signIntersection * d, h) - \n\t\t\t\t\t\t\t signSubtract * k * h * (1.0 - h);\n\t\t\t}\n\n\t\t\tfloat sdSphere( vec3 p, float s )\n\t\t\t{\n\t\t\t\treturn length(p)-s;\n\t\t\t}\n\n\t\t\tfloat sdEllipsoid( vec3 p, vec3 r )\n\t\t\t{\n\t\t\t\tfloat k0 = length(p/r);\n\t\t\t\tfloat k1 = length(p/(r*r));\n\t\t\t\treturn k0*(k0-1.0)/k1;\n\t\t\t}\n\n\t\t\tfloat sdBox( vec3 p, vec3 b )\n\t\t\t{\n\t\t\t\tvec3 q = abs(p) - b;\n\t\t\t\treturn length(max(q,0.0)) + min(max(q.x,max(q.y,q.z)),0.0);\n\t\t\t}\n\n\t\t\tfloat sdTorus( vec3 p, vec2 t )\n\t\t\t{\n\t\t\t\tvec2 q = vec2(length(p.xy)-t.x,p.z);\n\t\t\t\treturn length(q)-t.y;\n\t\t\t}\n\n\t\t\tfloat sdCappedTorus( vec3 p, vec2 sc, float ra, float rb)\n\t\t\t{\n\t\t\t\tp.x = abs(p.x);\n\t\t\t\tfloat k = (sc.y*p.x>sc.x*p.y) ? dot(p.xy,sc) : length(p.xy);\n\t\t\t\treturn sqrt( dot(p,p) + ra*ra - 2.0*ra*k ) - rb;\n\t\t\t}\n\n\t\t\tfloat dot2( in vec2 v ) { return dot(v,v); }\n\t\t\tfloat sdCappedCone( vec3 p, float h, float r1, float r2 )\n\t\t\t{\n\t\t\t\tvec2 q = vec2( length(p.xz), p.y );\n\t\t\t\tvec2 k1 = vec2(r2,h);\n\t\t\t\tvec2 k2 = vec2(r2-r1,2.0*h);\n\t\t\t\tvec2 ca = vec2(q.x-min(q.x,(q.y<0.0)?r1:r2), abs(q.y)-h);\n\t\t\t\tvec2 cb = q - k1 + k2*clamp( dot(k1-q,k2)/dot2(k2), 0.0, 1.0 );\n\t\t\t\tfloat s = (cb.x<0.0 && ca.y<0.0) ? -1.0 : 1.0;\n\t\t\t\treturn s*sqrt( min(dot2(ca),dot2(cb)) );\n\t\t\t}\n\n\t\t\tfloat sdCappedCylinder( vec3 p, float h, float r )\n\t\t\t{\n\t\t\t\tvec2 d = abs(vec2(length(p.xz),p.y)) - vec2(r,h);\n\t\t\t\treturn min(max(d.x,d.y),0.0) + length(max(d,0.0));\n\t\t\t}\n\n\t\t\tfloat maxBlend = 0.0;\n\t\t\t// compute potential from A (=24) spheres, using the bit flags in 'activeKey'\n\t\t\t// to avoid lookup/compute for inactive spheres\n\t\t\t// return field potential, side effect updates track,\n\t\t\t// compute and return +ve and -ve values separately\n\t\t\tvoid fillSpatialInner(\n\t\t\t\tfloat ii,\n\t\t\t\tfloat activeKey,\n\t\t\t\tvec3 corner,\n\t\t\t\tinout float sdf,\n\t\t\t\tinout float colorDivisor,\n\t\t\t\tinout vec4 trackColor\n\t\t\t) {\n\t\t\t\tfor (float i = 0.; i < ${r0}.; i++) {\n\t\t\t\t\tif (activeKey < 1.) break; // activeKey exhausted, no more active spheres\n\t\t\t\t\tactiveKey *= 0.5;\n\t\t\t\t\tif (fract(activeKey) < 0.5) continue;\n\n\t\t\t\t\tfloat iin = (i + ii + 0.5) * ${1/n0};\n\t\t\t\t\tvec4 shape = shapePos(iin);\n\t\t\t\t\tvec4 quat = shapeQuat(iin);\n\t\t\t\t\tvec4 params1 = shapeParams1(iin);\n\t\t\t\t\tvec4 params2 = shapeParams2(iin);\n\n\t\t\t\t\tvec3 p = corner - shape.xyz;\n\t\t\t\t\tapplyQuaternionToVector(quat, p);\n\t\t\t\t\tp /= params2.z; // scale\n\t\t\t\t\tfloat d; // d in -1..1 coordinates\n\t\t\t\t\tswitch (int(params1.x)) {\n\t\t\t\t\t\tcase 0: d = sdSphere(p, params1.y); break;\n\t\t\t\t\t\tcase 1: d = sdEllipsoid(p, params1.yzw); break;\n\t\t\t\t\t\tcase 2: d = sdBox(p, params1.yzw); break;\n\t\t\t\t\t\tcase 3: d = sdCappedCylinder(p, params1.y, params1.z); break;\n\t\t\t\t\t\tcase 4: d = sdCappedCone(p, params1.y, params1.z, params1.w); break;\n\t\t\t\t\t\tcase 5: d = sdTorus(p, params1.yz); break;\n\t\t\t\t\t\tcase 6: d = sdCappedTorus(p, params1.yz, params1.w, params2.w); break;\n\t\t\t\t\t}\n\t\t\t\t\td -= params2.y; // rounded edge\n\t\t\t\t\td *= params2.z; // scale\n\n\t\t\t\t\tfloat k = params2.x;\n\t\t\t\t\tfloat op = shape.w;\n\n\t\t\t\t\tsdf = smoothOperation(shape.w, sdf, d, k);\n\n\t\t\t\t\tfloat isNegativeOne = step(-1.5, op) * step(op, -0.5); // 1 when op == -1, 0 otherwise\n\t\t\t\t\tfloat colorCull = smoothstep(maxBlend, 0., -d);\n\t\t\t\t\tfloat cullFactor = mix(1.0, colorCull, isNegativeOne);\n\t\t\t\t\ttrackColor *= cullFactor;\n\t\t\t\t\tcolorDivisor *= cullFactor;\n\n\t\t\t\t\tmaxBlend = max(maxBlend, k);\n\n\t\t\t\t\tk += 2. * INV_VOXEL_RESOLUTION; // avoid division by zero, and other color artifacts with very small k\n\t\t\t\t\tfloat nearness = smoothstep(k, 0., d);\n\n\t\t\t\t\tvec4 color = shapeColor(iin);\n\t\t\t\t\tnearness *= float(color.a >= 0.);\n\n\t\t\t\t\tcolorDivisor += nearness;\n\t\t\t\t\ttrackColor += color * nearness;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tvec3 div;\n\t\t\t// compute potential from all spheres; collect +ve and =ve values separately\n\t\t\t// work in blocks of A*4 (=96) spheres, using the bit flags in 4 float channel 'activeKey' values\n\t\t\t// TODO check if extra vec3 output useful, not really used at present\n\t\t\tfloat fillSpatial(vec3 corner, inout vec4 trackColor) {\n\t\t\t\tfloat sdf = 1e3; // hack: initialize to large value\n\t\t\t\tfloat colorDivisor = 0.;\n\t\t\t\t// spatialPassTexture holds x=> lowi, x faster moving and y=> z, y faster moving\n\t\t\t\tfloat divyz = (div.y + div.z * spatialDivisions + 0.5) / (spatialDivisions2);\n\t\t\t\tfor (float ii = 0.; ii < spatialn; ii++) {\n\t\t\t\t\tfloat i = ii * ${4*r0}.;\n\n\t\t\t\t\tvec4 activeKey = texture(spatialPassTexture, vec2((div.x * spatialn + ii + 0.5)/(spatialn * spatialDivisions), divyz));\n\t\t\t\t\tfillSpatialInner(i, activeKey.x, corner, sdf, colorDivisor, trackColor);\n\t\t\t\t\tfillSpatialInner(i+${r0}., activeKey.y, corner, sdf, colorDivisor, trackColor);\n\t\t\t\t\tfillSpatialInner(i+${2*r0}., activeKey.z, corner, sdf, colorDivisor, trackColor);\n\t\t\t\t\tfillSpatialInner(i+${3*r0}., activeKey.w, corner, sdf, colorDivisor, trackColor);\n\t\t\t\t}\n\n\t\t\t\ttrackColor /= colorDivisor;\n\t\t\t\treturn mix(sdf, 0.0, step(1e20 - 0.1, sdf));\n\t\t\t}\n\n\t\t\tvoid main() {\n\t\t\t\t${s0.getxyzi}    // get xi yi zi from 2d position\n\n\t\t\t\tvec3 xyzi = vec3(xi,yi,zi);\n\t\t\t\tvec3 corner = xyzi / VOXEL_RESOLUTION_SUB1 * 2. - 1.;  // -1..1 coords\n\n\t\t\t\tdiv = floor(xyzi / VOXEL_RESOLUTION_SUB1 * spatialDivisionsSub1);\n\n\t\t\t\tvec4 c = vec4(0.);\n\t\t\t\tfloat t = fillSpatial(corner, c);\n\n\t\t\t\tpc_FragColor = vec4(t, packRGBAToVec3(c)); // RGB texture\n\t\t\t}\n\t\t`;return new e0({name:"PotentialPass",fragmentShader:E,uniforms:this.potentialPassUniforms})}voxelPassMaterial(){let E=`\n\t\t\tprecision highp float;\n\t\t\tlayout(location = 0) out vec4 pc_FragColor;\n\t\t\tlayout(location = 1) out vec4 numTris;\n\n\t\t\tconst float res = float(RES);\n\t\t\tconst float VOXEL_RESOLUTION = pow(2., res);\n\t\t\tconst float VOXEL_RESOLUTION_SUB1 = VOXEL_RESOLUTION - 1.; \n\t\t\tconst float Z_LAYERS_PER_ROW = ceil(pow(2., res / 2.));\n\t\t\tconst float INV_VOXEL_RESOLUTION = 1.0 / VOXEL_RESOLUTION;\n\t\t\tuniform sampler2D numTrisTable; // 256 x 1\n\n\t\t\tfloat keyi(float f000, float f100, float f010, float f110, float f001, float f101, float f011, float f111) {\n\t\t\t\treturn (float(f000 < 0.) * 1.) +\n\t\t\t\t\t\t\t (float(f100 < 0.) * 2.) +\n\t\t\t\t\t\t\t (float(f010 < 0.) * 8.) +\n\t\t\t\t\t\t\t (float(f110 < 0.) * 4.) +\n\t\t\t\t\t\t\t (float(f001 < 0.) * 16.) +\n\t\t\t\t\t\t\t (float(f101 < 0.) * 32.) +\n\t\t\t\t\t\t\t (float(f011 < 0.) * 128.) +\n\t\t\t\t\t\t\t (float(f111 < 0.) * 64.);\n\t\t\t}\n\n\t\t\t${s0.lookup}\n\n\t\t\tvec3 compNormi(float xi, float yi, float zi) {\n\t\t\t\tfloat dx = look(xi + 1., yi, zi, potentialPassTexture).r - look(xi - 1., yi, zi, potentialPassTexture).r;\n\t\t\t\tfloat dy = look(xi, yi + 1., zi, potentialPassTexture).r - look(xi, yi - 1., zi, potentialPassTexture).r;\n\t\t\t\tfloat dz = look(xi, yi, zi + 1., potentialPassTexture).r - look(xi, yi, zi - 1., potentialPassTexture).r;\n\t\t\t\t// if we allow (common) 0,0,0 case through then NaN can spread\n\t\t\t\t// eg r = vec4(compNorm i(???), 1.) will pollute r.w\n\t\t\t\tif (dx == 0.0 && dy == 0.0 && dz == 0.0) {\n\t\t\t\t\treturn vec3(0.199, 0.299, 0.399);\n\t\t\t\t}\n\t\t\t\treturn normalize(vec3(dx, dy, dz));\n\t\t\t}\n\n\t\t\tvoid main() {\n\t\t\t\t${s0.getxyzi}    // get xi yi zi from 2d\n\n\t\t\t\tvec3 normal = compNormi(xi, yi, zi);  // even if our key is -1 this may be needed by a neighbouring voxel\n\n\t\t\t\tif (xi >= VOXEL_RESOLUTION_SUB1 || yi >= VOXEL_RESOLUTION_SUB1 || zi >= VOXEL_RESOLUTION_SUB1) {\n\t\t\t\t\tpc_FragColor = vec4(normal, 0.);\n\t\t\t\t\tnumTris = vec4(0.);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tfloat\n\t\t\t\t\tf000 = look(xi, yi, zi, potentialPassTexture).r,\n\t\t\t\t\tf100 = look(xi+1., yi, zi, potentialPassTexture).r,\n\t\t\t\t\tf010 = look(xi, yi+1., zi, potentialPassTexture).r,\n\t\t\t\t\tf110 = look(xi+1., yi+1., zi, potentialPassTexture).r,\n\t\t\t\t\tf001 = look(xi, yi, zi+1., potentialPassTexture).r,\n\t\t\t\t\tf101 = look(xi+1., yi, zi+1., potentialPassTexture).r,\n\t\t\t\t\tf011 = look(xi, yi+1., zi+1., potentialPassTexture).r,\n\t\t\t\t\tf111 = look(xi+1., yi+1., zi+1., potentialPassTexture).r;\n\t\t\t\tfloat key = keyi(f000, f100, f010, f110, f001, f101, f011, f111);\n\n\t\t\t\tpc_FragColor = vec4(normal, key);\n\n\t\t\t\tnumTris = texture(numTrisTable, vec2((key + 0.5) / 256., 0.5));\n\t\t\t}\n\t\t`;return new e0({name:"VoxelPass",fragmentShader:E,uniforms:this.voxelPassUniforms})}patchVertexShaderForShapeBlend(E){let O=`\n\t\t#ifdef SHAPEBLEND \n\t\t\tprecision highp sampler2D;\n\n\t\t\tuniform float isol;\n\n\t\t\tuniform sampler2D triTable;     // 256 x 16\n\t\t\tuniform sampler2D pyramidTexture1;\n\t\t\tuniform vec2 pyramidTexture1Size;\n\t\t\tuniform sampler2D pyramidTexture2;\n\t\t\tuniform vec2 pyramidTexture2Size;\n\n\t\t\tconst vec2 halfPixelOffset = vec2(0.5, 0.5);\n\n\t\t\tconst vec2 rShift = vec2(0., 1.);\n\t\t\tconst vec2 gShift = vec2(1., 1.);\n\t\t\tconst vec2 bShift = vec2(1., 0.);\n\n\t\t\tconst float res = float(RES);\n\t\t\tconst float VOXEL_RESOLUTION = pow(2., res);\n\t\t\tconst float Z_LAYERS_PER_ROW = ceil(pow(2., res / 2.));\n\t\t\tconst float INV_VOXEL_RESOLUTION = 1.0 / VOXEL_RESOLUTION;\n\n\t\t\tconst float scale_factor = ${a0}.;\n\n\t\t\t#if SHAPEBLEND == 5\n\t\t\t\tconst float levelShiftX[7] = float[7](4., 6., 12., 24., 48., 96., 192.);\n\t\t\t\tconst float scale = 8. * scale_factor;\n\t\t\t\tconst vec3 originOffset = vec3(16.);\n\t\t\t#elif SHAPEBLEND == 7\n\t\t\t\tconst float levelShiftX[10] = float[10](4., 6., 12., 24., 48., 96., 192., 384., 768., 1536.); \n\t\t\t\tconst float scale = 2. * scale_factor;\n\t\t\t\tconst vec3 originOffset = vec3(64.);\n\t\t\t#elif SHAPEBLEND == 8\n\t\t\t\tconst float levelShiftX[11] = float[11](4., 8., 16., 32., 64., 128., 256., 512., 1024., 2048., 4096.);\n\t\t\t\tconst float scale = scale_factor;\n\t\t\t\tconst vec3 originOffset = vec3(128.);\n\t\t\t#else\n\t\t\t\tconst float levelShiftX[8] = float[8](4., 8., 16., 32., 64., 128., 256., 512.);\n\t\t\t\tconst float scale = 4. * scale_factor;\n\t\t\t\tconst vec3 originOffset = vec3(32.);\n\t\t\t#endif\n\n\t\t\t${s0.lookup}\n\n\t\t\tconst vec3 offsets[24] = vec3[](\n\t\t\t\tvec3(0., 0., 0.), vec3(1., 0., 0.),\n\t\t\t\tvec3(1., 0., 0.), vec3(1., 1., 0.),\n\t\t\t\tvec3(0., 1., 0.), vec3(1., 1., 0.),\n\t\t\t\tvec3(0., 0., 0.), vec3(0., 1., 0.),\n\t\t\t\tvec3(0., 0., 1.), vec3(1., 0., 1.),\n\t\t\t\tvec3(1., 0., 1.), vec3(1., 1., 1.),\n\t\t\t\tvec3(0., 1., 1.), vec3(1., 1., 1.),\n\t\t\t\tvec3(0., 0., 1.), vec3(0., 1., 1.),\n\t\t\t\tvec3(0., 0., 0.), vec3(0., 0., 1.),\n\t\t\t\tvec3(1., 0., 0.), vec3(1., 0., 1.),\n\t\t\t\tvec3(1., 1., 0.), vec3(1., 1., 1.),\n\t\t\t\tvec3(0., 1., 0.), vec3(0., 1., 1.)\n\t\t\t);\n\n\t\t\tvec2 computeShiftedPosition1(vec2 xy, float levelOriginX) {\n\t\t\t\tvec2 xyShifted = xy;\n\t\t\t\txyShifted.x += levelOriginX;\n\t\t\t\treturn (xyShifted + halfPixelOffset) / pyramidTexture1Size;\n\t\t\t}\n\n\t\t\tvec2 computeShiftedPosition2(vec2 xy, float levelOriginX) {\n\t\t\t\tvec2 xyShifted = xy;\n\t\t\t\txyShifted.x += levelOriginX;\n\t\t\t\treturn (xyShifted + halfPixelOffset) / pyramidTexture2Size;\n\t\t\t}\n\n\t\t\tvec4 unpackVec3ToRGBA(vec3 vec) {\n\t\t\t\tuint combined = uint(vec.x * 65535.0 + 0.5); // Add 0.5 for rounding\n\t\t\t\tfloat g = float(combined & uint(0xFF)) * 0.00392156862; // 1/255\n\t\t\t\tfloat r = float((combined >> 8) & uint(0xFF)) * 0.00392156862; \n\t\t\n\t\t\t\treturn vec4(r, g, vec.y, vec.z);\n\t\t\t}\n\n\t\t\tout vec4 marchColor;\n\t\t\t// end of marchvertPre\n\t\t#endif\n\t\t`,R="\n\t\t#ifdef SHAPEBLEND\n\t\t\tfloat triIndex = floor(float(gl_VertexID/3));\n\t\t\tfloat vertexIndex = float(gl_VertexID);\n\t\t\t\n\t\t\t// Initial pyramid lookup\n\t\t\tfloat levelOriginX1 = pyramidTexture1Size.x - 2.;\n\t\t\tfloat levelOriginX2 = pyramidTexture2Size.x - 1.;\n\t\t\tvec2 xy = vec2(0.);\n\t\t\tvec4 lookUp = texture(pyramidTexture2, computeShiftedPosition2(xy, levelOriginX2));\n\t\t\t\n\t\t\t// Early exit check\n\t\t\tif (triIndex >= lookUp.r) return;\n\t\t\t\n\t\t\t// Optimize loop variables\n\t\t\tfloat start = 0.;\n\t\t\tvec4 triIndexVec = vec4(triIndex);\n\t\t\t\n\t\t\t// Main position computation loop\n\t\t\tfor (int i = 0; i < LOOP;) {\n\t\t\t\t// Compute boundaries\n\t\t\t\tvec4 ends = lookUp + vec4(start);\n\t\t\t\tvec4 starts = vec4(ends.gba, start);\n\t\t\t\tvec4 check = vec4(greaterThanEqual(triIndexVec, starts)) * \n\t\t\t\t\t\t\t\t\t\t\tvec4(lessThan(triIndexVec, ends));\n\t\t\t\t\n\t\t\t\t// Update position\n\t\t\t\txy *= 2.;\n\t\t\t\txy += check.r * rShift + check.g * gShift + check.b * bShift;\n\t\t\t\t\n\t\t\t\t// Update loop variables\n\t\t\t\tstart = dot(check, starts);\n\t\t\t\tlevelOriginX2 -= levelShiftX[i];\n\t\t\t\t\n\t\t\t\t// Update lookup\n\t\t\t\tlookUp = texture(pyramidTexture1, computeShiftedPosition1(xy, levelOriginX1));\n\t\t\t\ti++;\n\n\t\t\t\tends = lookUp + vec4(start);\n\t\t\t\tstarts = vec4(ends.gba, start);\n\t\t\t\tcheck = vec4(greaterThanEqual(triIndexVec, starts)) * \n\t\t\t\t\t\t\t\t\t\t\tvec4(lessThan(triIndexVec, ends));\n\t\t\t\t\n\t\t\t\t// Update position\n\t\t\t\txy *= 2.;\n\t\t\t\txy += check.r * rShift + check.g * gShift + check.b * bShift;\n\t\t\t\t\n\t\t\t\t// Update loop variables\n\t\t\t\tstart = dot(check, starts);\n\t\t\t\tlevelOriginX1 -= levelShiftX[i];\n\t\t\t\t\n\t\t\t\t// Update lookup\n\t\t\t\tlookUp = texture(pyramidTexture2, computeShiftedPosition2(xy, levelOriginX2));\n\n\t\t\t\ti++;\n\t\t\t}\n\n\t\t\t#if HALF == 1\n\t\t\t\tvec4 ends = lookUp + vec4(start);\n\t\t\t\tvec4 starts = vec4(ends.gba, start);\n\t\t\t\tvec4 check = vec4(greaterThanEqual(triIndexVec, starts)) * vec4(lessThan(triIndexVec, ends));\n\t\t\t\n\t\t\t\t// Update position\n\t\t\t\txy *= 2.;\n\t\t\t\txy += check.r * rShift + check.g * gShift + check.b * bShift;\n\t\t\t\n\t\t\t\t// Update loop variables\n\t\t\t\tstart = dot(check, starts);\n\t\t\t#endif\n\t\t\t\n\t\t\t// Compute final coordinates\n\t\t\tvec3 gridPos;\n\t\t\tgridPos.x = mod(xy.x, VOXEL_RESOLUTION);\n\t\t\tgridPos.y = mod(xy.y, VOXEL_RESOLUTION);\n\t\t\tgridPos.z = floor(xy.x * INV_VOXEL_RESOLUTION) + \n\t\t\t\t\t\t\t\t\tfloor(xy.y * INV_VOXEL_RESOLUTION) * Z_LAYERS_PER_ROW;\n\t\t\t\n\t\t\t// Vertex key computation\n\t\t\tvertexIndex -= start * 3.;\n\t\t\tfloat vk = vertexIndex * 0.0625 + 0.03125; // Optimized division by 16 and addition of 1/32\n\t\t\t\n\t\t\t// Voxel lookup and edge computation\n\t\t\tvec4 voxel = look(gridPos.x, gridPos.y, gridPos.z, voxelPassTexture);\n\t\t\tfloat key = (voxel.w + 0.5) * 0.00390625; // Optimized division by 256\n\t\t\t\n\t\t\t// Edge lookup and offset computation\n\t\t\tfloat edgeNum = texture(triTable, vec2(vk, key)).x;\n\t\t\tint edgeIndex = int(edgeNum) * 2;\n\t\t\t\n\t\t\t// Compute edge positions\n\t\t\tvec3 p1 = gridPos + offsets[edgeIndex];\n\t\t\tvec3 p2 = gridPos + offsets[edgeIndex + 1];\n\t\t\t\n\t\t\t// Compute potentials and normals\n\t\t\tvec4 potential1 = look(p1.x, p1.y, p1.z, potentialPassTexture);\n\t\t\tvec4 potential2 = look(p2.x, p2.y, p2.z, potentialPassTexture);\n\t\t\t\n\t\t\t// Final position and normal computation\n\t\t\tfloat mu = potential1.r / (potential1.r - potential2.r);\n\n\t\t\tmarchColor = mix(\n\t\t\t\tunpackVec3ToRGBA(potential1.gba),\n\t\t\t\tunpackVec3ToRGBA(potential2.gba),\n\t\t\t\tmu\n\t\t\t);\n\n\t\t\ttransformed = p1 + (p2 - p1) * mu;\n\t\t\ttransformed -= originOffset;\n\t\t\ttransformed *= scale;\n\t\t\tvec4 data1 = look(p1.x, p1.y, p1.z, voxelPassTexture);\n\t\t\tvec4 data2 = look(p2.x, p2.y, p2.z, voxelPassTexture);\n\t\t\tobjectNormal = normalize(mix(data1.xyz, data2.xyz, mu));\n\t\t\ttransformedNormal = normalMatrix * objectNormal;\n\t\t\t#ifndef FLAT_SHADED\n\t\t\t\tvNormal = transformedNormal;\n\t\t\t#endif\n\t\t#endif\n\t\t";E.vertexShader=O+E.vertexShader.replace("#include <project_vertex>",R+"\n#include <project_vertex>");let z=E.fragmentShader.match(/vec3 diffuseColor[^\n]*\n/);if(!z)return;let V=`\n\t\t#ifdef SHAPEBLEND_C\n\t\t\t#if SHAPEBLEND_C == 1\n\t\t\t\t${z[0].replace(/nodeU0,/g,"marchColor.rgb,").replace(/nodeU\d+(?=,g_uid\d+_calpha\))/g,"marchColor.a")}\n\t\t\t#else\n\t\t\t\t${z[0]}\n\t\t\t#endif\n\t\t#else\n\t\t\t${z[0]}\n\t\t#endif\n\t\t`;E.fragmentShader="in vec4 marchColor;\n"+E.fragmentShader.replace(z[0],V),Object.assign(E.uniforms,this.marchPassUniforms)}initDebugPass(E){console.log("fboToDebug.width",E.width,E.height),this.geometry=new Co(E.width,E.height),this.geometry.userData={parameters:{width:4,height:4}};let O={inputTexture:{value:Array.isArray(E.texture)?E.texture[1]:E.texture},pyramidTextureSize:{value:void 0}},i=E=>{E.vertexShader="\n\t\t\t\tprecision highp float;\n\n\t\t\t\tvarying vec2 vUv;\n\n\t\t\t\tvoid main() {\n\t\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t\t\tvUv = uv;\n\t\t\t\t}\n\t\t\t",E.fragmentShader="\n\t\t\t\tlayout(location = 1) out vec4 gVelocity;\n\n\t\t\t\tprecision highp float;\n\t\t\t\t\n\t\t\t\tuniform sampler2D inputTexture;\n\t\t\t\tvarying vec2 vUv;\n\n\t\t\t\tuniform vec2 pyramidTextureSize;\n\n\t\t\t\tvoid main() {\n\t\t\t\t\t\t// Sample the input texture using UV coordinates\n\t\t\t\t\t\tgl_FragColor = texture(inputTexture, vUv);\n\t\t\t\t\t\tgVelocity = vec4(0.0);\n\t\t\t\t}\n\t\t\t",O.pyramidTextureSize.value=new bn(this.pyramidRenderTarget.width,this.pyramidRenderTarget.height),Object.assign(E.uniforms,O)};this.material.shapeBlendhack=i,this.material.root.shapeBlendhack=i}},l0=o0;l0.streamCompaction=new i0;var h0=new Es,d0=new Es,u0=new Hn,p0=new Wn,f0=new Wn,m0=new Hn;function LZ(E,O=0){let R=this.children.length;for(;R--;){let z=this.children[R];zR.is(z)&&yB.call(z,E,O+1)}}function yB(E,O=0){if(E(this,O)!==!0){let R=this.children.length;for(;R--;){let z=this.children[R];zR.is(z)&&yB.call(z,E,O+1)}}}function BZ(){if(this.shapesDataTexture.value===void 0){let E=new Zd(new Float32Array(4*n0*J$),n0,J$,Ni,Ii);this.shapesDataTexture.value=E}let E=this.shapesDataTexture.value,O=E.image.data;E.needsUpdate=!0;let R=0,z=this.data.geometry.blendRange,V=h0.copy(this.matrixWorld).invert(),j=0;LZ.call(this,(E=>{if(E.visible===!1)return!0;let Y;if(E instanceof SH)return;if(E instanceof AW||E instanceof Q$)return;Y=E instanceof HR?E.object:E;let ee=E.data?.cloner;if(oL.is(E)&&ee&&!ee.hideBase&&ee.type!=="radial"&&ee.disabled!==!0||!(Y instanceof _j))return;let se=Y.geometry.userData.parameters,he=se.shapeBlendNode;if(he===void 0)return;if(d0.multiplyMatrices(V,E.matrixWorld).decompose(f0,u0,p0),se.type==="TorusGeometry"&&se.arc!==360){let E=se.arc*Math.PI/180;E/=4,u0.multiply(m0.set(0,0,Math.sin(E),Math.cos(E)))}let ce=he.overrideGlobalBlend?he.blendRange:z;ce=ce/this.bboxSize*2,O[j*4]=(f0.x-this.bboxOffset)/this.bboxSize*2,O[j*4+1]=(f0.y-this.bboxOffset)/this.bboxSize*2,O[j*4+2]=(f0.z-this.bboxOffset)/this.bboxSize*2,O[j*4+3]=he.operation===0?1:he.operation===2?-1:-2,O[n0*4+j*4]=-u0.x,O[n0*4+j*4+1]=-u0.y,O[n0*4+j*4+2]=-u0.z,O[n0*4+j*4+3]=u0.w;let ue=new Float32Array(4),fe=0;if(se.type==="SphereGeometry")se.width===se.height&&se.width===se.depth?ue[0]=0:ue[0]=1,ue[1]=se.width/this.bboxSize,ue[2]=se.height/this.bboxSize,ue[3]=se.depth/this.bboxSize,R=Math.max(R,ue[1]*p0.x+ce,ue[2]*p0.x+ce,ue[3]*p0.x+ce);else if(se.type==="CubeGeometry"){fe=se.cornerRadius;let E=se.width,O=se.height,z=se.depth;ue[0]=2,ue[1]=(E-2*fe)/this.bboxSize,ue[2]=(O-2*fe)/this.bboxSize,ue[3]=(z-2*fe)/this.bboxSize,R=Math.max(R,Math.sqrt(E**2+O**2+z**2)/this.bboxSize*p0.x+ce)}else if(se.type==="CylinderGeometry"){fe=se.cornerRadius;let E=se.height,O=se.radiusBottom,z=se.radiusTop;if(z>=O){let R=Math.atan2(z-O,E),V=(Math.PI/2-R)/2;z-=fe/Math.tan(V),O-=fe*Math.tan(V)}else if(O>z){let R=Math.atan2(O-z,E),V=(Math.PI/2-R)/2;z-=fe*Math.tan(V),O-=fe/Math.tan(V)}ue[1]=(se.height-2*fe)/this.bboxSize,O===z?(ue[0]=3,ue[2]=O/this.bboxSize*2):(ue[0]=4,ue[2]=O/this.bboxSize*2,ue[3]=z/this.bboxSize*2),R=Math.max(R,ue[1]*4*p0.x+ce)}else if(se.type==="TorusGeometry"){if(ue[0]=5,ue[1]=(se.width-se.depth)/this.bboxSize,ue[2]=se.depth/this.bboxSize,se.arc!==360){ue[0]=6,ue[3]=ue[1],O[n0*12+j*4+3]=ue[2];let E=2*Math.atan2(ue[2]/2,ue[1]),R=se.arc*Math.PI/180/2-E;ue[1]=Math.sin(R),ue[2]=Math.cos(R)}R=Math.max(R,se.width*p0.x/this.bboxSize+ce)}O.set(ue,n0*8+j*4),O[n0*12+j*4]=ce,O[n0*12+j*4+1]=fe/this.bboxSize*2,O[n0*12+j*4+2]=p0.x;let ve=Y.material,we=ve.uniforms.nodeU0.node.value,Se=ve.uniforms.nodeU1.value;he.operation!==0&&!he.useColor&&(Se=-1),O[n0*16+j*4]=we.r,O[n0*16+j*4+1]=we.g,O[n0*16+j*4+2]=we.b,O[n0*16+j*4+3]=Se,Se<1&&this.material.defines.SHAPEBLEND_C===1&&(this.material.transparent=!0),j++})),this.npart=j,this.spatialPassUniforms.span.value=R*1.4}var g0=512;function vB(E,O){let R=!1,z=E.layers.mask&g0,V=O.getLayersOfType("transmission"),j=O.getLayersOfType("outline");return j.length>0&&(E.layers.set(8),V.length>0&&E.layers.enable(3),R=!0,cf(E),lf(E)),V.length===0&&j.length===0&&E.layers.set(0),z&&E.layers.set(9),E instanceof uj&&E.needsAO&&E.layers.enable(5),R}function xB(E,O){if(!O.layers)return!1;let R=E.layers.mask&g0,z=!1,V=O.getLayersOfType("transmission").filter((E=>E.data.visible)),j=O.getLayersOfType("outline").filter((E=>E.data.visible));return V.length>0&&(E.layers.set(3),j.length>0&&E.layers.enable(8),z=!0),V.length===0&&j.length===0&&E.layers.set(0),R&&E.layers.set(9),E.needsAO&&E.layers.enable(5),z}function SB(E){let O=!1;return E.traverseEntity((E=>{if(E instanceof uj)if(Array.isArray(E.material))for(let R=0;R<E.material.length;R++)vB(E,E.material[R])&&(O=!0);else vB(E,E.material)&&(O=!0)})),O}function wB(E){let O=!1;return E.traverseEntity((E=>{if(E instanceof uj)if(Array.isArray(E.material))for(let R=0;R<E.material.length;R++)xB(E,E.material[R])&&(O=!0);else xB(E,E.material)&&(O=!0)})),O}var v0=new Af,y0=new Es,x0=new Ms;function Km(E,O,R,z=!1){let V=E.cloner;if(V)for(let j of V.children){let V=y0.copy(j.matrixWorld).invert(),Y=x0.copy(O.ray).applyMatrix4(V),ee=E.matrixWorld;Y.applyMatrix4(ee);let se=v0;se.set(Y.origin,Y.direction),se.near=O.near,se.far=O.far;let he=se.intersectObject(E,!1);he.length>0&&R.push({...he[0],object:z?j:E})}}var b0=class{constructor(){this._constraints=new Map}setConstraint(E,O){O===null?this._constraints.delete(E):this._constraints.set(E,O)}removeDependencies(E){this._constraints.delete(E)}applyConstraints(E){let O=new Set;this._constraints.forEach(((R,z)=>{let V=[z,R],j=R;for(;this._constraints.has(j);){if(j=this._constraints.get(j),V.includes(j)){console.warn(`circular dependency detected: ${V.join(" -> ")}`);break}O.has(j)||V.push(j)}for(let R=V.length-2;R>=0;R--)if(!O.has(V[R])){let z=E.find(V[R]);z?z.applyPathSnapping(E):console.warn(`missing entity ${V[R]}`),O.add(V[R])}}))}findDependency(E,O){let R=E;for(;this._constraints.has(R);)if(R=this._constraints.get(R),R===O)return!0;return!1}};var w0="AGFzbQEAAAAADwhkeWxpbmsuMAEEAAAAAAETA2AAAGAIf39/f39/f38AYAABfwISAQNlbnYGbWVtb3J5AgMAgIAEAwQDAAECBzkDEV9fd2FzbV9jYWxsX2N0b3JzAAALc29ydEluZGV4ZXMAARNlbXNjcmlwdGVuX3Rsc19pbml0AAIK3gMDAwABC9IDAwF/BnwBfgJAIAdFDQAgAysDUCEMIAMrAzAhDSADKwMQIQ5BACEDRP///////+9/IQtEAAAAAAAAEAAhCgNAIAIgA0ECdGoCfyAOIAEgA0EMbGoiCCoCALuiIA0gCCoCBLuioCAMIAgqAgi7oqBEAAAAAAAAsECiIgmZRAAAAAAAAOBBYwRAIAmqDAELQYCAgIB4CzYCACAJIAsgCSALYxshCyAJIAogCSAKZBshCiADQQFqIgMgB0cNAAsgB0UNACAGuCAKIAuhoyEJQQAhAwNAAn8gCSACIANBAnRqIgEoAgC3IAuhoiIKmUQAAAAAAADgQWMEQCAKqgwBC0GAgICAeAshCCABIAg2AgAgBCAIQQJ0aiIBIAEoAgBBAWo2AgAgA0EBaiIDIAdHDQALCyAGQQJPBEAgBCgCACEIQQEhAwNAIAQgA0ECdGoiASABKAIAIAhqIgg2AgAgA0EBaiIDIAZHDQALCyAHQQFrIgGtIQ8DQCAEIAIgD6dBAnQiA2ooAgBBAnRqIgcgBygCAEEBayIHNgIAIAUgASAHa0ECdGogACADaigCADYCACAPUCEDIA9CAX0hDyADRQ0ACyAGBEAgBEEAIAZBAnT8CwALCwQAQQAL";var S0=class{};mc(S0,"DepthMapRange",65536),mc(S0,"MemoryPageSize",65536),mc(S0,"BytesPerFloat",4),mc(S0,"BytesPerInt",4);function UZ(E){let O,R,z,V,j,Y,ee,se,he,ce,ue,fe,ve,we,Se,_e;function y(ue){let ve=new Float64Array(ce,Y,16);for(let E=0;E<16;E++)ve[E]=ue[E];let we;if(z>1){O.exports.sortIndexes(V,j,he,Y,ee,se,fe.DepthMapRange,z);let E=new Uint32Array(z);we=E.buffer,E.set(new Uint32Array(ce,se,z))}else if(z===1){let E=new Uint32Array(z);E[0]=new Uint32Array(ce,V,R)[0],we=E.buffer}else we=new ArrayBuffer(0);E.postMessage({sortDone:!0,indexesBuffer:we},[we])}function x(E,O,Y){let ee=new Float32Array(ce,j,R*3);z=0;let se=new Uint32Array(ce,V,R);for(let R=0;R<Y.length-1;R++){let V=O[R],j=E[R].elements,he=V.filter((E=>E.enabled&&E.mode==="Include")).map((E=>E.type==="Box"?A(E):M(E))),ce=V.filter((E=>E.enabled&&E.mode==="Exclude")).map((E=>E.type==="Box"?A(E):M(E)));for(let E=Y[R];E<Y[R+1];E++){let O=ve[E*3],R=ve[E*3+1],V=ve[E*3+2];if((he.length===0||S(O,R,V,he))&&(ce.length===0||!S(O,R,V,ce))){let Y=1/(j[3]*O+j[7]*R+j[11]*V+j[15]);ee[z*3]=(j[0]*O+j[4]*R+j[8]*V+j[12])*Y,ee[z*3+1]=(j[1]*O+j[5]*R+j[9]*V+j[13])*Y,ee[z*3+2]=(j[2]*O+j[6]*R+j[10]*V+j[14])*Y,se[z]=E,z++}}}}function v(E,O){let R=[],z=O.filter((E=>E.enabled&&E.mode==="Include")).map((E=>E.type==="Box"?A(E):M(E))),V=O.filter((E=>E.enabled&&E.mode==="Exclude")).map((E=>E.type==="Box"?A(E):M(E))),j=E.length;for(let O=0;O<j;O+=3){let j=E[O],Y=E[O+1],ee=E[O+2];(z.length===0||S(j,Y,ee,z))&&(V.length===0||!S(j,Y,ee,V))||R.push(O/3)}return R}function S(E,O,R,z,V){return z[V==="Intersect"?"every":"some"]((z=>{let V=w(E,O,R,z.invRotationMatrix,z.cropCenter);return Array.isArray(z)?b(V.x,V.y,V.z,z):C(V.x,V.y,V.z,z)}))}function w(E,O,R,z,V){let j=E-V[0],Y=O-V[1],ee=R-V[2],se=1/(z[3]*j+z[7]*Y+z[11]*ee+z[15]);return{x:(z[0]*j+z[4]*Y+z[8]*ee+z[12])*se+V[0],y:(z[1]*j+z[5]*Y+z[9]*ee+z[13])*se+V[1],z:(z[2]*j+z[6]*Y+z[10]*ee+z[14])*se+V[2]}}function A(E){let O=E.cropSize[0]/2,R=E.cropSize[1]/2,z=E.cropSize[2]/2,V=[E.cropCenter[0]-O,E.cropCenter[1]-R,E.cropCenter[2]-z,E.cropCenter[0]+O,E.cropCenter[1]+R,E.cropCenter[2]+z],j=T(E.cropRotation);return Object.assign(V,{invRotationMatrix:j,cropCenter:E.cropCenter})}function T(E){let O=[],R=E[0]*Math.PI/180,z=E[1]*Math.PI/180,V=E[2]*Math.PI/180,j=Math.cos(R),Y=Math.sin(R),ee=Math.cos(z),se=Math.sin(z),he=Math.cos(V),ce=Math.sin(V),ue=j*he,fe=j*ce,ve=Y*he,we=Y*ce;return O[0]=ee*he,O[1]=-ee*ce,O[2]=se,O[4]=fe+ve*se,O[5]=ue-we*se,O[6]=-Y*ee,O[8]=we-ue*se,O[9]=ve+fe*se,O[10]=j*ee,O[12]=0,O[13]=0,O[14]=0,O[3]=0,O[7]=0,O[11]=0,O[15]=1,O}function b(E,O,R,z){return E>=z[0]&&E<=z[3]&&O>=z[1]&&O<=z[4]&&R>=z[2]&&R<=z[5]}function M(E){let O=2/E.cropSize[0],R=2/E.cropSize[1],z=2/E.cropSize[2],V=T(E.cropRotation);return{invRadiusX:O,invRadiusY:R,invRadiusZ:z,cropCenter:E.cropCenter,invRotationMatrix:V}}function C(E,O,R,z){let V=(E-z.cropCenter[0])*z.invRadiusX,j=(O-z.cropCenter[1])*z.invRadiusY,Y=(R-z.cropCenter[2])*z.invRadiusZ;return V*V+j*j+Y*Y<=1}E.onmessage=z=>{if(z.data.getCroppedIndexes){let O=new Uint32Array(v(new Float32Array(z.data.positions),z.data.crops)).buffer;E.postMessage({outOfBoundsIndexes:O},[O])}else if(z.data.positions)ue=z.data.positions,ve=new Float32Array(ue),Se=z.data.meshMatrixWorlds,_e=z.data.cropsArray,we=z.data.meshIndexIntervals,x(Se,_e,we),E.postMessage({sortSetupComplete:!0});else if(z.data.sort||z.data.newMatrixWorlds||z.data.newCropsArray)(z.data.newMatrixWorlds||z.data.newCropsArray)&&(_e=z.data.newCropsArray||_e,Se=z.data.newMatrixWorlds||Se,x(Se,_e,we)),y(z.data.sort.view,z.data.sort.cameraPosition);else if(z.data.init){fe=z.data.init.Constants,R=z.data.init.splatCount;let ue=fe.BytesPerInt,ve=fe.BytesPerFloat*3,we=new Uint8Array(z.data.init.sorterWasmBytes),Se=ue+ve,_e=R*Se,Ae=R*fe.BytesPerInt*2+fe.DepthMapRange*fe.BytesPerInt*2,Ce=fe.MemoryPageSize*32,Te=_e+Ae+Ce,Ie=Math.floor(Te/fe.MemoryPageSize)+1,Fe={module:{},env:{memory:new WebAssembly.Memory({initial:Ie*2,maximum:Ie*3,shared:!0})}};WebAssembly.compile(we).then((E=>WebAssembly.instantiate(E,Fe))).then((z=>{O=z,V=0,j=R*ue,Y=j+R*ve,he=Y+16*fe.BytesPerFloat*2,ee=he+R*fe.BytesPerInt,se=ee+fe.DepthMapRange*fe.BytesPerInt,ce=Fe.env.memory.buffer,E.postMessage({sortSetupPhase1Complete:!0})}))}}}function EB(E){let O=new Worker(URL.createObjectURL(new Blob(["(",UZ.toString(),")(self)"],{type:"application/javascript"}))),R=atob(w0),z=new Uint8Array(R.length);for(let E=0;E<R.length;E++)z[E]=R.charCodeAt(E);return O.postMessage({init:{sorterWasmBytes:z.buffer,splatCount:E,Constants:{BytesPerFloat:S0.BytesPerFloat,BytesPerInt:S0.BytesPerInt,DepthMapRange:S0.DepthMapRange,MemoryPageSize:S0.MemoryPageSize}}}),O}var M0=function(){let E=new Float32Array(1),O=new Int32Array(E.buffer);return function(R){return E[0]=R,O[0]}}(),TB=function(E,O,R,z){return E+(O<<8)+(R<<16)+(z<<24)};var C0=new bn;function yb(E){let O=!1;return E.scene.objects.traverse(((E,R)=>{if(R.visible===!1)return!0;R.type==="Splat"&&(O=!0)})),O}var P0=class extends eo{constructor(E,O,R,z,V=!1,j=1,Y,ee){super(R,z);this.splatCount=O,this.meshIndexIntervals=Y,this.meshMatrixWorlds=ee,this.splatBuffers=E,this.geometry=R,this.material=z,this.splatDataTextures=null,this.halfPrecisionCovariancesOnGPU=V,this.devicePixelRatio=j,this.resetLocalSplatDataAndTexturesFromSplatBuffer()}static buildMesh(E,O,R=!1,z=1,V,j){let Y=P0.buildGeomtery(O),ee=P0.buildMaterial(V);return new P0(E,O,Y,ee,R,z,V,j)}static buildMaterial(E){let O="\n            precision highp float;\n            #include <common>\n\n            attribute uint splatIndex;\n\n            uniform highp sampler2D covariancesTexture;\n            uniform highp usampler2D centersColorsTexture;\n            uniform vec2 focal;\n            uniform vec2 viewport;\n            uniform vec2 basisViewport;\n            uniform vec2 covariancesTextureSize;\n            uniform vec2 centersColorsTextureSize;\n\t\t\t\t\t\tuniform highp sampler2D meshMatrixWorldsTexture;\n\t\t\t\t\t\tuniform uint meshIndexIntervals[257];\n\t\t\t\t\t\tuniform float orthoZoom;\n\n            varying vec4 vColor;\n            varying vec2 vUv;\n\n            varying vec2 vPosition;\n\n            const vec4 encodeNorm4 = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0);\n            const uvec4 mask4 = uvec4(uint(0x000000FF), uint(0x0000FF00), uint(0x00FF0000), uint(0xFF000000));\n            const uvec4 shift4 = uvec4(0, 8, 16, 24);\n            vec4 uintToRGBAVec (uint u) {\n               uvec4 urgba = mask4 & u;\n               urgba = urgba >> shift4;\n               vec4 rgba = vec4(urgba) * encodeNorm4;\n               return rgba;\n            }\n\n            vec2 getDataUV(in int stride, in int offset, in vec2 dimensions) {\n                vec2 samplerUV = vec2(0.0, 0.0);\n                float d = float(splatIndex * uint(stride) + uint(offset)) / dimensions.x;\n                samplerUV.y = float(floor(d)) / dimensions.y;\n                samplerUV.x = fract(d);\n                return samplerUV;\n            }\n\n            void main () {\n                uvec4 sampledCenterColor = texture(centersColorsTexture, getDataUV(1, 0, centersColorsTextureSize));\n                vec3 splatCenter = uintBitsToFloat(uvec3(sampledCenterColor.gba));\n                vColor = uintToRGBAVec(sampledCenterColor.r);\n\n                vPosition = position.xy * 2.0;\n\n\t\t\t\t\t\t\t\tuint meshIndex;\n\t\t\t\t\t\t\t\tfor (int i = 1; i < 257; i++) {\n\t\t\t\t\t\t\t\t\tif (splatIndex < meshIndexIntervals[i]) {\n\t\t\t\t\t\t\t\t\t\tmeshIndex = uint(i - 1);\n\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tfloat strideMulmeshIndex = float(4u*meshIndex);\n\t\t\t\t\t\t\t\tfloat meshMatrixWorldsTextureLength = float(256*4);\n\n\t\t\t\t\t\t\t\tmat4 modelMat = mat4(\n\t\t\t\t\t\t\t\t\ttexture(meshMatrixWorldsTexture, vec2((strideMulmeshIndex+0.0)/meshMatrixWorldsTextureLength, 0)),\n\t\t\t\t\t\t\t\t\ttexture(meshMatrixWorldsTexture, vec2((strideMulmeshIndex+1.0)/meshMatrixWorldsTextureLength, 0)),\n\t\t\t\t\t\t\t\t\ttexture(meshMatrixWorldsTexture, vec2((strideMulmeshIndex+2.0)/meshMatrixWorldsTextureLength, 0)),\n\t\t\t\t\t\t\t\t\ttexture(meshMatrixWorldsTexture, vec2((strideMulmeshIndex+3.0)/meshMatrixWorldsTextureLength, 0))\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\tmat4 modelViewMat = viewMatrix * modelMat;\n\t\t\t\t\t\t\t\tvec4 viewCenter = modelViewMat * vec4(splatCenter, 1.0); \n                vec4 clipCenter = projectionMatrix * viewCenter;\n\n                vec2 sampledCovarianceA = texture(covariancesTexture, getDataUV(3, 0, covariancesTextureSize)).rg;\n                vec2 sampledCovarianceB = texture(covariancesTexture, getDataUV(3, 1, covariancesTextureSize)).rg;\n                vec2 sampledCovarianceC = texture(covariancesTexture, getDataUV(3, 2, covariancesTextureSize)).rg;\n\n                vec3 cov3D_M11_M12_M13 = vec3(sampledCovarianceA.rg, sampledCovarianceB.r);\n                vec3 cov3D_M22_M23_M33 = vec3(sampledCovarianceB.g, sampledCovarianceC.rg);\n\n                // Compute the 2D covariance matrix from the upper-right portion of the 3D covariance matrix\n                mat3 Vrk = mat3(\n                    cov3D_M11_M12_M13.x, cov3D_M11_M12_M13.y, cov3D_M11_M12_M13.z,\n                    cov3D_M11_M12_M13.y, cov3D_M22_M23_M33.x, cov3D_M22_M23_M33.y,\n                    cov3D_M11_M12_M13.z, cov3D_M22_M23_M33.y, cov3D_M22_M23_M33.z\n                );\n                float s = 1.0 / (viewCenter.z * viewCenter.z);\n\n                mat3 W = transpose(mat3(modelViewMat));\n                mat3 T = orthoZoom > 0.0 ? W : W * mat3(\n\t\t\t\t\t\t\t\t\tfocal.x / viewCenter.z, 0., -(focal.x * viewCenter.x) * s,\n\t\t\t\t\t\t\t\t\t0., focal.y / viewCenter.z, -(focal.y * viewCenter.y) * s,\n\t\t\t\t\t\t\t\t\t0., 0., 0.\n\t\t\t\t\t\t\t\t);\n                mat3 cov2Dm = transpose(T) * Vrk * T;\n                cov2Dm[0][0] += 0.3;\n                cov2Dm[1][1] += 0.3;\n\n                // We are interested in the upper-left 2x2 portion of the projected 3D covariance matrix because\n                // we only care about the X and Y values. We want the X-diagonal, cov2Dm[0][0],\n                // the Y-diagonal, cov2Dm[1][1], and the correlation between the two cov2Dm[0][1]. We don't\n                // need cov2Dm[1][0] because it is a symetric matrix.\n                vec3 cov2Dv = vec3(cov2Dm[0][0], cov2Dm[0][1], cov2Dm[1][1]);\n\n                vec3 ndcCenter = clipCenter.xyz / clipCenter.w;\n\n                // We now need to solve for the eigen-values and eigen vectors of the 2D covariance matrix\n                // so that we can determine the 2D basis for the splat. This is done using the method described\n                // here: https://people.math.harvard.edu/~knill/teaching/math21b2004/exhibits/2dmatrices/index.html\n                //\n                // This is a different approach than in the original work at INRIA. In that work they compute the\n                // max extents of the 2D covariance matrix in screen space to form an axis aligned bounding rectangle\n                // which forms the geometry that is actually rasterized. They then use the inverse 2D covariance\n                // matrix (called 'conic') to determine fragment opacity.\n                float a = cov2Dv.x;\n                float d = cov2Dv.z;\n                float b = cov2Dv.y;\n                float D = a * d - b * b;\n                float trace = a + d;\n                float traceOver2 = 0.5 * trace;\n                float term2 = sqrt(trace * trace / 4.0 - D);\n                float eigenValue1 = traceOver2 + term2;\n\t\t\t\t\t\t\t\tfloat eigenValue2 = max(traceOver2 - term2, 0.00); // prevent negative eigen value\n\n                const float maxSplatSize = 1024.0;\n                vec2 eigenVector1 = normalize(vec2(b, eigenValue1 - a));\n                // since the eigen vectors are orthogonal, we derive the second one from the first\n                vec2 eigenVector2 = vec2(eigenVector1.y, -eigenVector1.x);\n                vec2 basisVector1 = eigenVector1 * min(sqrt(2.0 * eigenValue1), maxSplatSize);\n                vec2 basisVector2 = eigenVector2 * min(sqrt(2.0 * eigenValue2), maxSplatSize);\n\n                vec2 ndcOffset = vec2(vPosition.x * basisVector1 + vPosition.y * basisVector2) * basisViewport;\n\n\t\t\t\t\t\t\t\tif (orthoZoom > 0.0) {\n\t\t\t\t\t\t\t\t\tndcOffset *= orthoZoom;\n\t\t\t\t\t\t\t\t}\n\n                gl_Position = vec4(ndcCenter.xy + ndcOffset, ndcCenter.z, 1.0);\n            }",R="\n            precision highp float;\n            #include <common>\n\n            uniform vec3 debugColor;\n\n            varying vec4 vColor;\n            varying vec2 vUv;\n\n            varying vec2 vPosition;\n\t\t\t\t\t\tlayout(location = 1) out vec4 gVelocity; \n\n            void main () {\n                // compute the negative squared distance from the center of the splat to the\n                // current fragment in the splat's local space.\n                float A = -dot(vPosition, vPosition);\n                if (A < -4.0) discard;\n                vec3 color = vColor.rgb;\n                A = exp(A) * vColor.a;\n                gl_FragColor = vec4(color.rgb, A);\n\t\t\t\t\t\t\t\tgVelocity = vec4(0.0); // so it is ignored by TAA\n            }",z={covariancesTexture:{type:"t",value:null},centersColorsTexture:{type:"t",value:null},meshIndexIntervals:{value:E},meshMatrixWorldsTexture:{type:"t",value:null},focal:{type:"v2",value:new bn},viewport:{type:"v2",value:new bn},basisViewport:{type:"v2",value:new bn},debugColor:{type:"v3",value:new On},covariancesTextureSize:{type:"v2",value:new bn(1024,1024)},centersColorsTextureSize:{type:"v2",value:new bn(1024,1024)},orthoZoom:{type:"f",value:-1}};return new lo({uniforms:z,vertexShader:O,fragmentShader:R,transparent:!0,alphaTest:1,blending:Xe,depthTest:!0,depthWrite:!1,side:Ge})}static buildGeomtery(E){let O=new Na;O.setIndex([0,1,2,0,2,3]);let R=new Float32Array(12),z=new Sa(R,3);O.setAttribute("position",z),z.setXYZ(0,-1,-1,0),z.setXYZ(1,-1,1,0),z.setXYZ(2,1,1,0),z.setXYZ(3,1,-1,0),z.needsUpdate=!0;let V=(new $p).copy(O),j=new Uint32Array(E),Y=new eu(j,1,!1);return Y.setUsage(ln),V.setAttribute("splatIndex",Y),V.instanceCount=E,V}resetLocalSplatDataAndTexturesFromSplatBuffer(){this.updateLocalSplatDataFromSplatBuffer(),this.allocateAndStoreLocalSplatDataInTextures()}updateLocalSplatDataFromSplatBuffer(){this.splatBuffers.forEach((E=>E.buildPreComputedBuffers())),this.covariances=new Float32Array(this.splatCount*6),this.colors=new Uint8Array(this.splatCount*4),this.centers=new Float32Array(this.splatCount*3);let E=0,O=0,R=0;for(let z of this.splatBuffers){let V=z.nsplats;this.colors.subarray(E,E+V*4).set(z.colorsA),E+=V*4,this.centers.subarray(O,O+V*3).set(z.decoded.xyz.denormDequant().data),O+=V*3,this.covariances.subarray(R,R+V*6).set(new Float32Array(z.precomputedCovarianceBufferData)),R+=V*6}}allocateAndStoreLocalSplatDataInTextures(){let E=this.splatCount,O=new bn(4096,1024);for(;O.x*O.y*2<E*6;)O.y*=2;let R=new bn(4096,1024);for(;R.x*R.y*4<E*4;)R.y*=2;let z,V;if(this.halfPrecisionCovariancesOnGPU){V=new Uint16Array(O.x*O.y*2);for(let E=0;E<this.covariances.length;E++)V[E]=Qf.toHalfFloat(this.covariances[E]);z=new Zd(V,O.x,O.y,qi,Oi)}else V=new Float32Array(O.x*O.y*2),V.set(this.covariances),z=new Zd(V,O.x,O.y,qi,Ii);z.needsUpdate=!0,this.material.uniforms.covariancesTexture.value=z,this.material.uniforms.covariancesTextureSize.value.copy(O);let j=new Uint32Array(R.x*R.y*4);for(let O=0;O<E;O++){let E=O*4,R=O*3,z=O*4;j[z]=TB(this.colors[E],this.colors[E+1],this.colors[E+2],this.colors[E+3]),j[z+1]=M0(this.centers[R]),j[z+2]=M0(this.centers[R+1]),j[z+3]=M0(this.centers[R+2])}let Y=new Zd(j,R.x,R.y,Qi,Di);Y.internalFormat="RGBA32UI",Y.needsUpdate=!0,this.material.uniforms.centersColorsTexture.value=Y,this.material.uniforms.centersColorsTextureSize.value.copy(R);let ee=1024,se=new Float32Array(4096);for(let E=0;E<this.meshMatrixWorlds.length;E++)se.set(this.meshMatrixWorlds[E].elements,E*16);let he=new Zd(se,ee,1,Ni,Ii);he.needsUpdate=!0,this.material.uniforms.meshMatrixWorldsTexture.value=he,this.material.uniformsNeedUpdate=!0,this.splatDataTextures={covariances:{data:V,texture:z,size:O},centerColors:{data:j,texture:Y,size:R},meshMatrixWorlds:{data:se,texture:he}}}updateIndexes(E){let O=this.geometry;O.attributes.splatIndex.set(E),O.attributes.splatIndex.needsUpdate=!0,O.instanceCount=E.length}updateUniforms(E,O,R,z){this.splatCount>0&&(C0.set(E.x*this.devicePixelRatio,E.y*this.devicePixelRatio),this.material.uniforms.viewport.value.copy(C0),this.material.uniforms.basisViewport.value.set(2/C0.x,2/C0.y),this.material.uniforms.focal.value.set(O,R),this.material.uniforms.orthoZoom.value=z,this.material.uniformsNeedUpdate=!0)}getSplatDataTextures(){return this.splatDataTextures}getSplatCount(){return this.splatCount}getCenters(){return this.centers}getColors(){return this.colors}getCovariances(){return this.covariances}dispose(){this.geometry.dispose(),this.material.dispose(),this.splatDataTextures&&(this.splatDataTextures.covariances.texture.dispose(),this.splatDataTextures.centerColors.texture.dispose(),this.splatDataTextures.meshMatrixWorlds.texture.dispose()),this.removeFromParent()}};var D0,I0=new Promise((E=>{D0=E})),O0=!1;var R0;function CT(){if(!O0)return R0||(R0=n(),R0);async function n(){let E=await import("../_/DZtPKgX2.js");D0(E),O0=!0}}var z0;I0.then((E=>z0=E));var N0=class{constructor(E={}){mc(this,"updateView",function(){let E=new Es,O=[],R=new Wn(0,0,-1),z=new Wn(0,0,-1),V=new Wn,j=new Wn;return function(Y=!1,ee){let se=this.updateMatrixWorldsInWorkerIfNeeded(),he=this.cropsChanged();if(!Y){z.set(0,0,-1).applyQuaternion(ee.quaternion);let E=!1,O=!1;if(z.dot(R)<=.95&&(E=!0),j.copy(ee.position).sub(V).length()>=1&&(O=!0),!E&&!O&&!se&&!he&&!this.needsInitialRender)return}this.needsInitialRender=!1,V.copy(ee.position),R.copy(z),E.copy(ee.matrixWorld).invert(),E.premultiply(this.dummyPerspectiveMatrix),O[0]=ee.position.x,O[1]=ee.position.y,O[2]=ee.position.z;let ce={sort:{view:E.elements,cameraPosition:O,splatRenderCount:this.splatRenderCount,splatSortCount:this.splatRenderCount},...se?{newMatrixWorlds:this.meshMatrixWorlds}:{},...he?{newCropsArray:this.cropsArray}:{}};this.sortRunning?this.queuedMessage=ce:(this.queuedMessage=null,this.sortRunning=!0,this.sortWorker.postMessage(ce))}}());this.scene=E.scene,this.currentPage=null,this.devicePixelRatio=window.devicePixelRatio,this.sortWorker=null,this.splatRenderCount=0,this.splatSortCount=0,this.splatMesh=null,this.sortRunning=!1,this.meshMatrixWorlds=null,this.meshMatrixWorldsOld=null,this.cropsArray=null,this.splatEntries=null,this.queuedMessage=null,this.needsInitialRender=!0,this.dummyPerspectiveMatrix=(new Es).makePerspective(-1,1,-1,1,.1,1e3)}updateSplatMeshUniforms(E,O){let R=new bn;this.splatMesh!==null&&this.splatMesh.getSplatCount()>0&&(E.getSize(R),this.cameraFocalLengthX=O.projectionMatrix.elements[0]*this.devicePixelRatio*R.x*.45,this.cameraFocalLengthY=O.projectionMatrix.elements[5]*this.devicePixelRatio*R.y*.45,this.splatMesh.updateUniforms(R,this.cameraFocalLengthX,this.cameraFocalLengthY,O.isPerspectiveCamera?-1:O.zoom*this.devicePixelRatio))}loadSplat(E={}){this.activePage=this.scene.activePage,E.position&&(E.position=(new Wn).fromArray(E.position)),E.orientation&&(E.orientation=(new Hn).fromArray(E.orientation)),E.halfPrecisionCovariances=!!E.halfPrecisionCovariances;let O=[];if(this.splatEntries=O,this.activePage.traverseVisibleEntity((E=>{E.data.type==="Splat"&&O.push(E)})),this.splatMesh&&this.splatMesh.dispose(),O.length===0)return this.splatMesh=null,!1;this.meshMatrixWorlds=O.map((E=>E.matrixWorld)),this.meshMatrixWorldsOld=O.map((E=>E.matrixWorld.clone())),this.cropsArray=O.map((E=>E.data.crops.map((E=>E.data))));let R=O.map((E=>new z0.GSplineBuffer(new Uint8Array(E.data.buffer).buffer))),z=0,V=[0];for(let E of R)z+=E.getSplatCount(),V.push(z);return this.setupSplatMesh(R,z,E.position,E.orientation,E.halfPrecisionCovariances,this.devicePixelRatio,V,this.meshMatrixWorlds),this.setupSortWorker(z),!0}updateMatrixWorldsInWorkerIfNeeded(){let E=this.splatDataTextures.meshMatrixWorlds.data;for(let O=0;O<this.meshMatrixWorlds.length;O++)E.set(this.meshMatrixWorlds[O].elements,O*16);return this.splatDataTextures.meshMatrixWorlds.texture.needsUpdate=!0,!this.meshMatrixWorlds.every(((E,O)=>E.equals(this.meshMatrixWorldsOld[O])))&&(this.meshMatrixWorldsOld=this.meshMatrixWorlds.map((E=>E.clone())),!0)}cropsChanged(){let E=!1;return this.splatEntries.forEach(((O,R)=>{O.data.crops.forEach(((O,z)=>{this.cropsArray[R][z]===void 0?(E=!0,this.cropsArray[R][z]=O.data):Object.entries(O.data).forEach((([O,V])=>{(Array.isArray(V)&&V.some(((E,V)=>E!==this.cropsArray[R][z][O][V]))||V!==this.cropsArray[R][z]?.[O])&&(E=!0,this.cropsArray[R][z][O]=V)}))})),O.data.crops.length!==this.cropsArray[R]?.length&&(this.cropsArray[R].length=O.data.crops.length,E=!0)})),E}setupSplatMesh(E,O,R=new Wn,z=new Hn,V=!1,j=1,Y,ee){this.splatMesh=P0.buildMesh(E,O,V,j,Y,ee),this.splatMesh.position.copy(R),this.splatMesh.quaternion.copy(z),this.splatMesh.frustumCulled=!1,this.splatMesh.renderOrder=99999,this.splatRenderCount=O,this.splatMesh.onBeforeRender=(E,O,R)=>this.update(E,R)}setupSortWorker(E){this.sortWorker=EB(E),this.sortWorker.onmessage=E=>{E.data.sortDone?(this.sortRunning=!1,this.splatMesh?.updateIndexes(new Uint32Array(E.data.indexesBuffer)),this.lastSortTime=E.data.sortTime,this.queuedMessage&&(this.sortWorker.postMessage(this.queuedMessage),this.queuedMessage=null)):E.data.sortCanceled?this.sortRunning=!1:E.data.sortSetupPhase1Complete?this.sortWorker.postMessage({positions:this.splatMesh.getCenters().buffer,meshMatrixWorlds:this.splatMesh.meshMatrixWorlds,meshIndexIntervals:this.splatMesh.meshIndexIntervals,cropsArray:this.cropsArray}):E.data.sortSetupComplete&&(this.splatDataTextures=this.splatMesh.getSplatDataTextures(),this.scene.activePage.add(this.splatMesh),this.needsInitialRender=!0)}}update(E,O){this.splatMesh!==null&&(this.updateSplatMeshUniforms(E,O),this.updateView(!1,O))}getSplatMesh(){return this.splatMesh}};var k0=new xa;k0.wireframe=!0;var G0=new Wn,H0=class extends Wd{constructor(E,O){super();this.data=E;this.sharedAssets=O;this.enableHelpers=!1;this.wireframeState=!1;this.needsTransmissionDirty=!0;this.needsNormalDirty=!0;this._needsTransmission=!1;this._needsNormal=!1;this.geometryCacheChanged=!1;this.splatViewer=null;this.shapeBlendIntances=[];this.entityByUuid={};this.entityIdentityToEntity={};this.toExpandCloner=new Set;this.toUpdateCloner=new Set;this.pendingCommands=[];this.pathConstraints=new b0;this.invisibleObjects=new wW("jflkdsafjasdifjaslk",{...oD.defaultData,visible:!1,name:"buildin invisible"});this.needsRecomputeInstances=!1;this.init(E,O),this.matrixAutoUpdate=!1,this.errorPage=new d$("fdasfa",{...gD.defaultData,name:""},{shared:O,scene:this})}markGeometryCacheDirty(){this.geometryCacheChanged=!0}markNeedsUpdateRendererDirty(){this.needsTransmissionDirty=!0,this.needsNormalDirty=!0}needsTransmission(){return this.needsTransmissionDirty&&(this._needsTransmission=wB(this),this.needsTransmissionDirty=!1),this._needsTransmission}needsNormal(){return this.needsNormalDirty&&(this._needsNormal=SB(this),this.needsNormalDirty=!1),this._needsNormal}registerInstanceAndSetUuid(E){let O=E.identity.join("-"),R=this.entityIdentityToEntity[O];R&&(E.uuid=R.uuid),this.entityIdentityToEntity[O]=E,this.entityByUuid[E.uuid]=E}markPenumbraSizeDirty(){for(let E of this.children)E instanceof d$&&(E.penumbraSizeArrayCache=null)}findInstance(E){return this.entityIdentityToEntity[E.join("-")]}get bgColor(){return this.activePage.bgColor}get postprocessing(){return this.activePage.data.postprocessing}getWithSortKey(E){let O=this.find(E);if(O===void 0)return;let R=[],z=O;for(;z!==this;){let E=z;z=z.parent;let O=z.children.indexOf(E);R.splice(0,0,O)}return{entity:O,sortKey:R}}getAllSorted(E){let O=[];for(let R of E){let E=this.getWithSortKey(R.id);E!==void 0&&O.push(E)}return O.sort(((E,O)=>yv(E.sortKey,O.sortKey))),O.map((E=>E.entity))}nonExistOrDescendantOf(E,O){let R=this.find(E);if(R===void 0)return!0;for(;R;){if(R.uuid===O)return!0;R=R.parent}return!1}find(E){if(this.activePage&&this.activePage.personalCamera.parent){if(E==="f23858d0-4a3b-4bd8-8173-66ed0af7f6fb-personalCamera")return this.activePage.personalCamera;if(E===fT)return this.activePage.personalCamera}if(E===""||E===void 0)return;let O=this.entityByUuid[E];return O===void 0?this.getObjectByProperty("uuid",E):O}find2D(E){for(let O of this.children)if(O instanceof d$&&O.uiScene){let R=O.uiScene.find(E);if(R)return R}}findScene2DfromObject2D(E){for(let O of this.children)if(O instanceof d$&&O.uiScene&&O.uiScene.find(E))return O.uiScene}find2DInUIObjects(E){let O;return this.traverseEntity((R=>{O===void 0&&R instanceof x$&&(O=R.uiCanvas.find(E))})),O}traverse2D(E){for(let O of this.children)O instanceof d$&&O.uiScene&&O.uiScene.traverse(E)}debugEnsureEntity(E){let O=this.find(E);if(O){if(Array.isArray(O.identity)&&this.findInstance(O.identity)===void 0){console.error("not found instance");debugger}}else{console.error("not found");debugger}}addPendingExpandCloner(E){this.toExpandCloner.add(E)}addPendingUpdateCloner(E){this.toUpdateCloner.add(E)}markToExpandCloner(E){this.toExpandCloner.add(E),E.traverseEntityAncestors((E=>{this.toExpandCloner.add(E)}))}doPendingExpandCloner(){this.toExpandCloner.forEach((E=>{E.expandCloner(this)})),this.toExpandCloner.clear()}doPendingUpdateCloner(){this.toUpdateCloner.forEach((E=>{E.cloner?.update()})),this.toUpdateCloner.clear()}doPendingUpdates(){this.doPendingExpandCloner(),this.doPendingUpdateCloner(),this.applyPendingCommands()}addPendingCommand(E){this.pendingCommands.push(E)}applyPendingCommands(){this.pendingCommands.forEach((E=>E())),this.pendingCommands.length=0}updateByLibOp(E,O){E.path.length===1&&E.path[0]==="components"&&E.type===1&&this.createChildrenObjects([{...E.data.asset,id:E.id}],this.invisibleObjects,O)}updateTreeByOp(E,O){if(E.path.length===0&&E.type===7){let R=E.parent===null?this:this.find(E.parent);if(R===void 0)throw new Error("unexpected");let z=this.createObject(E.id,E.data,E.children,R,E.localIndex,O);z.updateVisible(this),z.resetBBoxNeedsUpdate(),un(z)&&Mn(z.parent)&&(z.invalidateUpstreamBooleanData(),z.parent.invalidateDownstreamBooleanData().recomputeBoolean()),this.markNeedsRecomputeInstancesForAncessors(R),this.markNeedsRecomputeInstancesForChildren(z),this.markToExpandCloner(z),this.markPenumbraSizeDirty(),z.updatePathSnapping()}else if(E.path.length===0&&E.type===8){let O=this.find(E.id);if(O===void 0)throw new Error("unexpected");O.traverseEntity((E=>{E instanceof l0&&(this.shapeBlendIntances=this.shapeBlendIntances.filter((O=>O!==E)))})),this.markToExpandCloner(O),O.resetBBoxNeedsUpdate(),this.unregisterObject(O);let R=O.parent;this.markNeedsRecomputeInstancesForAncessors(R),this.markNeedsRecomputeInstancesForChildren(O),this.markPenumbraSizeDirty(),O.parent.remove(O),Mn(O.parent)&&(O.parent.invalidateUpstreamBooleanData(),O.parent.invalidateDownstreamBooleanData().recomputeBoolean()),un(O)&&(O.freeBooleanPointer(),R instanceof $H&&R.invalidateDownstreamBooleanData().recomputeBoolean()),O instanceof m$&&O.detachShape(),this.disposeAndUnregisterEntityRecursivelyIfNotReregistered(O),this.pathConstraints.removeDependencies(O.uuid),O.updatePathSnapping()}else if(E.path.length===0&&E.type===9){let O=this.find(E.id);if(O===void 0)throw new Error("unexpected");this.markNeedsRecomputeInstancesForChildren(O);let R=O.parent;this.markNeedsRecomputeInstancesForAncessors(R),O.cloner?.resetOnMove(),this.markToExpandCloner(O);let z=E.parent===null?this:this.find(E.parent);if(z===void 0)throw new Error("unexpected");z.add(O),this.markNeedsRecomputeInstancesForAncessors(z),this.markToExpandCloner(O),O.invalidateClonerTransform(O),O.updateVisible(this),O.resetBBoxNeedsUpdate(),this.markPenumbraSizeDirty();let V=E.localIndex;z.children.splice(V,0,z.children.pop()),un(O)&&(O.invalidateUpstreamBooleanData(),Mn(O.parent)?O.parent.invalidateDownstreamBooleanData().recomputeBoolean():R instanceof $H&&R.invalidateDownstreamBooleanData().recomputeBoolean()),O.updatePathSnapping()}this.markNeedsUpdateRendererDirty(),this.markGeometryCacheDirty()}get playPage(){return this.find(this.data.publish.playPage)??this.errorPage}updatePage(E){this.activePage&&this.activePage.onDeactive(),this.activePage=this.errorPage;for(let O of this.children)O instanceof d$&&(O.visible=O.uuid===E,O.visible&&(this.activePage=O,this.activePage.onActive(this)));this.activePage!==this.splatViewer?.activePage&&this.reloadSplats()}updateEntityByOp(E,O,R,z){if(O.type===0){if(("overrides"in O.props||"component"in O.props)&&this.markNeedsRecomputeInstances(),"visible"in O.props&&this.markPenumbraSizeDirty(),O.path.includes("overrides")&&"states"in O.props){let{rest:E}=O.props;O={...O,props:E},this.markNeedsRecomputeInstances()}O.path[0]==="pathSnapping"&&O.props.pathId!==void 0&&this.pathConstraints.setConstraint(E,O.props.pathId)}let V=this.find(E);if(V)try{mB(V,O,R,{scene:this,shared:z}),V instanceof _j&&V.updateGeometryGroupsIfNeeded()}catch(E){console.error(E)}}updateEntity2DByOp(E,O,R,z,V,j=[]){E.updateEntityByOp(O,R,z,V),this.traverseEntity((E=>{(E instanceof x$||E instanceof d$)&&(j.includes(E.frameId??"")||E.frameId===O)&&E.updateEntity2DByOp(O,R,z,V)}))}get activeCamera(){return this.activePage.activeCamera}switchActiveCamera(E){this.activePage.switchActiveCamera(E)}isInvisibleObjects(E){return E===this.invisibleObjects||E.hasAnccestor(this.invisibleObjects)}init(E,O){let R=Object.entries(O.data.lib.components).map(((E,O)=>({data:E[1].asset.data,children:E[1].asset.children,id:E[0],fi:O})));this.invisibleObjects.updateState(this.invisibleObjects.data,{scene:this,shared:O}),this.add(this.invisibleObjects),this.createChildrenObjects(R,this.invisibleObjects,O),this.createChildrenObjects(E.objects,this,O),this.updatePage(E.publish.playPage),this.activePage.switchToPlayCamera(),this.expandInstances(O,!0),this.traverseEntity((E=>{E instanceof YH&&E.updateUp()})),this.doPendingExpandCloner(),this.applyPendingCommands()}markNeedsRecomputeInstances(){this.needsRecomputeInstances=!0}markNeedsRecomputeInstancesForChildren(E){E.traverseEntity((E=>{(E.data.type==="Component"||E.data.type==="Instance")&&this.markNeedsRecomputeInstances()}))}markNeedsRecomputeInstancesForAncessors(E){oL.is(E)&&(E.data.type==="Component"&&this.markNeedsRecomputeInstances(),E.traverseAncestors((E=>{oL.is(E)&&E.data.type==="Component"&&this.markNeedsRecomputeInstances()})))}relativeizeInner(E,O,R,z,V,j,Y){if(E){let ee=z.find(E);ee&&ee!==z&&V.forInstancesRec((z=>{z.data=Tl(z.data,(V=>{let ee=V.events.data(Y.id),se=z.goUp(j);if(se){let z=[...gv(se.identity),E].join("-"),V=this.entityIdentityToEntity[z];if(V){let E=V.uuid,z=lE.zoom(ee,O);z[R]=E}else{!1;console.warn("cannot find instance")}}})).data}))}}rewriteActions(E,O,R,z,V,j){E.forEach((E=>{E.data.type==="Transition"||E.data.type==="Animation"?this.relativeizeInner(E.data.object,[...O,E.id],"object",R,z,V,j):E.data.type==="Conditional"&&(this.rewriteActions(E.data.ifActions,[...O,E.id,"ifActions"],R,z,V,j),this.rewriteActions(E.data.elseActions,[...O,E.id,"elseActions"],R,z,V,j))}))}rewriteEventsBeforeGoToPlayMode(){this.traverseEntity((E=>{if(E instanceof v$&&typeof E.identity=="string"&&E.data.type==="Component")return E.traverseEntity(((O,R)=>{O.data.events.forEach((z=>{if(z.data.type==="GameControl"){let V=!1;if(O.forInstancesRec((E=>{E.data=Tl(E.data,(O=>{E.isInstanceRoot||(O.events.delete(z.id),V=!0)})).data})),V===!1)for(let V of KD.list)this.rewriteActions(z.data.gameActions[V],["gameActions",V],E,O,R,z)}else z.data.type==="Conditional"?(z.data.condition.type==="Distance"?(this.relativeizeInner(z.data.condition.fromObject,["condition"],"fromObject",E,O,R,z),this.relativeizeInner(z.data.condition.toObject,["condition"],"toObject",E,O,R,z)):z.data.condition.type==="State"?this.relativeizeInner(z.data.condition.object,["condition"],"object",E,O,R,z):z.data.condition.type==="Comparison"&&(z.data.condition.lOperand.type==="Property"&&this.relativeizeInner(z.data.condition.lOperand.value[0],["condition","lOperand","value"],0,E,O,R,z),z.data.condition.rOperand.type==="Property"&&this.relativeizeInner(z.data.condition.rOperand.value[0],["condition","rOperand","value"],0,E,O,R,z)),this.rewriteActions(z.data.inActions,["inActions"],E,O,R,z),this.rewriteActions(z.data.outActions,["outActions"],E,O,R,z)):"actions"in z.data&&this.rewriteActions(z.data.actions,["actions"],E,O,R,z)}))})),!0}))}expandInstances(E,O,R){let z=new Set;this.traverseEntity((V=>{if(V instanceof v$&&V.isInstanceRoot)return V.expandInstanceChildren({scene:this,shared:E,pendingDeletes:z}),O||V.resetBBoxNeedsUpdate(),R&&V.traverseEntity((E=>{R.addClip(E)})),!0}));for(let E of z)this.disposeAndUnregisterEntityRecursivelyIfNotReregistered(E),nb(E)}recomputeInstances(E,O){this.needsRecomputeInstances&&(this.needsRecomputeInstances=!1,this.traverseEntity((E=>{E instanceof v$&&E.isInstanceRoot&&(E.component=void 0)})),this.expandInstances(E,!1,O))}disposeAndUnregisterEntityRecursivelyIfNotReregistered(E){E.traverseEntity((E=>{let O=typeof E.identity=="string"?E.identity:E.identity.join("-");this.entityIdentityToEntity[O]===E&&(delete this.entityByUuid[E.uuid],delete this.entityIdentityToEntity[O]),E.dispose()}))}clearScene(){for(let E of this.children)oL.is(E)&&E.disposeRecursively();this.children.length=0}resetAfterClear(E,O){this.init(E,O)}raycast(E){return this.raycast1(E,!1)}raycast1(E,O){let R=[],s=z=>{for(let V of z.children){let z=V.cloner;if(oL.is(V)&&!V.raycastLock&&(V.visible||z?.object.data.visible))if(O===!0&&V.isInstanceRoot){let O=[];if(E.intersectObject(V,!0,O),O.length){let E=O[0];E.object=V,E.point.applyMatrix4(E.object.matrixWorld);let z=V.matrixWorld.clone().invert();E.point.applyMatrix4(z),R.push(E)}}else(un(V)||zm(V)&&this.enableHelpers&&V.objectHelper.visible)&&(E.intersectObject(V,!1,R),Km(V,E,R)),s(V)}};return s(this.activePage),R}raycastWithClones(E){let O=[],i=R=>{for(let z of R.children){let R=z.cloner;oL.is(z)&&(z.visible||R?.object.data.visible)&&((un(z)||zm(z)&&this.enableHelpers&&z.objectHelper.visible)&&(E.intersectObject(z,!1,O),Km(z,E,O,!0)),i(z))}};return i(this),O}forEachEntity(E){for(let O of this.children)oL.is(O)&&E(O)}traverseConcreteEntity(E){for(let O of this.children)oL.is(O)&&O.isConcreteEntity&&O.traverseEntity(E)}traverseEntity(E){for(let O of this.children)oL.is(O)&&O.traverseEntity(E)}updateFont(E,O){this.traverseEntity((R=>{if(R instanceof _j&&R.data.type==="Mesh"&&(R.data.geometry.type==="TextGeometry"||R.data.geometry.type==="InputGeometry")&&R.data.geometry.font===E){let z=R.geometry,V=R.data.geometry;z.updateFont(E,O).then((()=>{z.update(V);let E=R.invalidateDownstreamBooleanData();Mn(E)&&E.recomputeBoolean()}))}}))}traverseObject(E){for(let O of this.children)zR.is(O)&&O.traverseObject(E)}traverseVisibleEntity(E){for(let O of this.children)oL.is(O)&&O.visible&&O.traverseVisibleEntity(E)}dispose(){this.clearScene()}createChildrenObjects(E,O,R){let z=0;for(let V of E)this.createObject(V.id,V.data,V.children,O,z,R),z+=1}registerObjectCreatedInLegacy(E){this.entityByUuid[E.uuid]=E}unregisterObject(E){delete this.entityByUuid[E.uuid];for(let O of E.children)this.unregisterObject(O)}createObject(E,O,R,z,V,j){let Y={scene:this,shared:j},ee=hb(E,O,Y);return ee instanceof l0&&this.shapeBlendIntances.push(ee),ee&&(this.entityByUuid[E]=ee,z.add(ee),z.children.splice(V,0,z.children.pop()),R.length>0&&(ee.isInstanceRoot?console.error("instance should not have children!"):this.createChildrenObjects(R,ee,j)),ee.updateState(O,Y),ee instanceof _j&&ee.updateGeometryGroupsIfNeeded(),ee.updateVisible(this),ee.cloner&&this.toExpandCloner.add(ee),O.pathSnapping?.pathId&&this.pathConstraints.setConstraint(E,O.pathSnapping.pathId)),O.type==="Empty"&&O.animations&&ee.traverseEntity((E=>{let O=E.dataPatched;if(E instanceof _j&&O.bones&&O.boneInverses){let R=O.bones.map((E=>this.find(E))),z=O.boneInverses.map((E=>(new Es).fromArray(E))),V=new $d(R,z);E.bind(V,E.bindMatrix)}else E.matrixAutoUpdate=!0})),ee}getCenter(E){let O=[];for(let R=0,z=E.length;R<z;++R){let{id:z,recursive:V}=E[R],j=this.find(z),Y=V?j.recursiveBBox:j.singleBBox;O.push(...Y.vertices)}let R=new Yn;return R.setFromPoints(O),R.getCenter(G0),G0}copyMatrixWorld(E,O){if(E===null){O.identity();return}let R=this.find(E);R?O.copy(R.matrixWorld):O.identity()}copyParentMatrixWorld(E,O){if(E===null){O.identity();return}let R=this.find(E)?.parent;R?O.copy(R.matrixWorld):O.identity()}traverseMaterial(E){this.traverseEntity((O=>{if(O instanceof GF)if(Array.isArray(O.material))for(let R=0;R<O.material.length;R++)O.material[R]instanceof lV&&E(O.material[R]);else O.material instanceof lV&&E(O.material)}))}updateViewPlaneSize(E,O,R=!1){this.traverseConcreteEntity((z=>{z instanceof YH&&z.setViewplaneSize(E,O,R)}))}initializeSplatViewer(){this.splatViewer=new N0({scene:this}),this.reloadSplats()}reloadSplats(){this.splatViewer?.loadSplat()}};var Jm=(E,O)=>{let R=O.x-E.x,z=O.y-E.y;return Math.sqrt(R*R+z*z)},IB=(E,O)=>{let R=O.x-E.x,z=O.y-E.y;return zZ(Math.atan2(z,R))},DB=(E,O,R)=>{let z={x:0,y:0};return R=xb(R),z.x=E.x-O*Math.cos(R),z.y=E.y-O*Math.sin(R),z},xb=E=>E*(Math.PI/180),zZ=E=>E*(180/Math.PI),OB=E=>isNaN(E.buttons)?E.pressure!==0:E.buttons!==0,W0=new Map,_T=E=>{W0.has(E)&&clearTimeout(W0.get(E)),W0.set(E,setTimeout(E,100))},Ff=(E,O,R)=>{let z,V=O.split(/[ ,]+/g);for(let O=0;O<V.length;O+=1)z=V[O],E.addEventListener?E.addEventListener(z,R,!1):E.attachEvent&&E.attachEvent(z,R)},IT=(E,O,R)=>{let z,V=O.split(/[ ,]+/g);for(let O=0;O<V.length;O+=1)z=V[O],E.removeEventListener?E.removeEventListener(z,R):E.detachEvent&&E.detachEvent(z,R)};var bb=E=>(E.preventDefault(),E.type.match(/^touch/)?E.changedTouches:E),DT=()=>{if(typeof window>"u")return;let E=window.pageXOffset!==void 0?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,O=window.pageYOffset!==void 0?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop;return{x:E,y:O}},Sb=(E,O)=>{O.top||O.right||O.bottom||O.left?(E.style.top=O.top,E.style.right=O.right,E.style.bottom=O.bottom,E.style.left=O.left):(E.style.left=O.x+"px",E.style.top=O.y+"px")},wb=(E,O,R)=>{let z=LB(E);for(let E in z)if(z.hasOwnProperty(E))if(typeof O=="string")z[E]=O+" "+R;else{let V="";for(let E=0,z=O.length;E<z;E+=1)V+=O[E]+" "+R+", ";z[E]=V.slice(0,-2)}return z},RB=(E,O)=>{let R=LB(E);for(let E in R)R.hasOwnProperty(E)&&(R[E]=O);return R},LB=E=>{let O={};return O[E]="",["webkit","Moz","o"].forEach((function(R){O[R+E.charAt(0).toUpperCase()+E.slice(1)]=""})),O},Ab=(E,O)=>{for(let R in O)O.hasOwnProperty(R)&&(E[R]=O[R]);return E},BB=(E,O)=>{let R={};for(let z in E)E.hasOwnProperty(z)&&O.hasOwnProperty(z)?R[z]=O[z]:E.hasOwnProperty(z)&&(R[z]=E[z]);return R},$m=(E,O)=>{if(E.length)for(let R=0,z=E.length;R<z;R+=1)O(E[R]);else O(E)},NB=(E,O,R)=>({x:Math.min(Math.max(E.x,O.x-R),O.x+R),y:Math.min(Math.max(E.y,O.y-R),O.y+R)});typeof window<"u"&&(q0="ontouchstart"in window,X0=!!window.PointerEvent,Y0=!!window.MSPointerEvent);var q0,X0,Y0,Q0,Z0={touch:{start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},mouse:{start:"mousedown",move:"mousemove",end:"mouseup"},pointer:{start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"},MSPointer:{start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}},K0={};X0?Q0=Z0.pointer:Y0?Q0=Z0.MSPointer:q0?(Q0=Z0.touch,K0=Z0.mouse):Q0=Z0.mouse;function hu(){}hu.prototype.on=function(E,O){var R,z=this,V=E.split(/[ ,]+/g);z._handlers_=z._handlers_||{};for(var j=0;j<V.length;j+=1)R=V[j],z._handlers_[R]=z._handlers_[R]||[],z._handlers_[R].push(O);return z};hu.prototype.off=function(E,O){var R=this;return R._handlers_=R._handlers_||{},E===void 0?R._handlers_={}:O===void 0?R._handlers_[E]=null:R._handlers_[E]&&R._handlers_[E].indexOf(O)>=0&&R._handlers_[E].splice(R._handlers_[E].indexOf(O),1),R};hu.prototype.trigger=function(E,O){var R,z=this,V=E.split(/[ ,]+/g);z._handlers_=z._handlers_||{};for(var j=0;j<V.length;j+=1)R=V[j],z._handlers_[R]&&z._handlers_[R].length&&z._handlers_[R].forEach((function(E){E.call(z,{type:R,target:z},O)}))};hu.prototype.config=function(E){var O=this;O.options=O.defaults||{},E&&(O.options=BB(O.options,E))};hu.prototype.bindEvt=function(E,O){var R=this;return R._domHandlers_=R._domHandlers_||{},R._domHandlers_[O]=function(){typeof R["on"+O]=="function"?R["on"+O].apply(R,arguments):console.warn('[WARNING] : Missing "on'+O+'" handler.')},Ff(E,Q0[O],R._domHandlers_[O]),K0[O]&&Ff(E,K0[O],R._domHandlers_[O]),R};hu.prototype.unbindEvt=function(E,O){var R=this;return R._domHandlers_=R._domHandlers_||{},IT(E,Q0[O],R._domHandlers_[O]),K0[O]&&IT(E,K0[O],R._domHandlers_[O]),delete R._domHandlers_[O],this};var J0=hu;function Ri(E,O){return this.identifier=O.identifier,this.position=O.position,this.frontPosition=O.frontPosition,this.collection=E,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:1,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(O),this.options.mode==="dynamic"&&(this.options.restOpacity=0),this.id=Ri.id,Ri.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}Ri.prototype=new J0;Ri.constructor=Ri;Ri.id=0;Ri.prototype.buildEl=function(E){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this};Ri.prototype.stylize=function(){if(this.options.dataOnly)return this;var E=this.options.fadeTime+"ms",O=RB("borderRadius","50%"),R=wb("transition","opacity",E),z={};return z.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},z.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:"rgba(255, 255, 255, .4)",border:"solid 2px rgba(0, 0, 0, .1)"},z.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:"rgba(255, 255, 255, .8)",border:"solid 2px rgba(0, 0, 0, .1)"},Ab(z.el,R),this.options.shape==="circle"&&Ab(z.back,O),Ab(z.front,O),this.applyStyles(z),this};Ri.prototype.applyStyles=function(E){for(var O in this.ui)if(this.ui.hasOwnProperty(O))for(var R in E[O])this.ui[O].style[R]=E[O][R];return this};Ri.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this};Ri.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this};Ri.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()};Ri.prototype.show=function(E){var O=this;return O.options.dataOnly||(clearTimeout(O.removeTimeout),clearTimeout(O.showTimeout),clearTimeout(O.restTimeout),O.addToDom(),O.restCallback(),setTimeout((function(){O.ui.el.style.opacity=1}),0),O.showTimeout=setTimeout((function(){O.trigger("shown",O.instance),typeof E=="function"&&E.call(this)}),O.options.fadeTime)),O};Ri.prototype.hide=function(E){var O=this;if(O.options.dataOnly)return O;if(O.ui.el.style.opacity=O.options.restOpacity,clearTimeout(O.removeTimeout),clearTimeout(O.showTimeout),clearTimeout(O.restTimeout),O.removeTimeout=setTimeout((function(){var R=O.options.mode==="dynamic"?"none":"block";O.ui.el.style.display=R,typeof E=="function"&&E.call(O),O.trigger("hidden",O.instance)}),O.options.fadeTime),O.options.restJoystick){let R=O.options.restJoystick,z={};z.x=R===!0||R.x!==!1?0:O.instance.frontPosition.x,z.y=R===!0||R.y!==!1?0:O.instance.frontPosition.y,O.setPosition(E,z)}return O};Ri.prototype.setPosition=function(E,O){var R=this;R.frontPosition={x:O.x,y:O.y};var z=R.options.fadeTime+"ms",V={};V.front=wb("transition",["top","left"],z);var j={front:{}};j.front={left:R.frontPosition.x+"px",top:R.frontPosition.y+"px"},R.applyStyles(V),R.applyStyles(j),R.restTimeout=setTimeout((function(){typeof E=="function"&&E.call(R),R.restCallback()}),R.options.fadeTime)};Ri.prototype.restCallback=function(){var E=this,O={};O.front=wb("transition","none",""),E.applyStyles(O),E.trigger("rested",E.instance)};Ri.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}};Ri.prototype.computeDirection=function(E){var O,R,z,V=E.angle.radian,j=Math.PI/4,Y=Math.PI/2;if(V>j&&V<j*3&&!E.lockX?O="up":V>-j&&V<=j&&!E.lockY?O="left":V>3*-j&&V<=-j&&!E.lockX?O="down":E.lockY||(O="right"),E.lockY||(R=V>-Y&&V<Y?"left":"right"),E.lockX||(z=V>0?"up":"down"),E.force>this.options.threshold){var ee,se={};for(ee in this.direction)this.direction.hasOwnProperty(ee)&&(se[ee]=this.direction[ee]);var he={};this.direction={x:R,y:z,angle:O},E.direction=this.direction;for(ee in se)se[ee]===this.direction[ee]&&(he[ee]=!0);if(he.x&&he.y&&he.angle)return E;(!he.x||!he.y)&&this.trigger("plain",E),he.x||this.trigger("plain:"+R,E),he.y||this.trigger("plain:"+z,E),he.angle||this.trigger("dir dir:"+O,E)}else this.resetDirection();return E};var $0=Ri;function li(E,O){var R=this;R.nipples=[],R.idles=[],R.actives=[],R.ids=[],R.pressureIntervals={},R.manager=E,R.id=li.id,li.id+=1,R.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:1,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},R.config(O),(R.options.mode==="static"||R.options.mode==="semi")&&(R.options.multitouch=!1),R.options.multitouch||(R.options.maxNumberOfNipples=1);let z=getComputedStyle(R.options.zone.parentElement);return z&&z.display==="flex"&&(R.parentIsFlex=!0),R.updateBox(),R.prepareNipples(),R.bindings(),R.begin(),R.nipples}li.prototype=new J0;li.constructor=li;li.id=0;li.prototype.prepareNipples=function(){var E=this,O=E.nipples;O.on=E.on.bind(E),O.off=E.off.bind(E),O.options=E.options,O.destroy=E.destroy.bind(E),O.ids=E.ids,O.id=E.id,O.processOnMove=E.processOnMove.bind(E),O.processOnEnd=E.processOnEnd.bind(E),O.get=function(E){if(E===void 0)return O[0];for(var R=0,z=O.length;R<z;R+=1)if(O[R].identifier===E)return O[R];return!1}};li.prototype.bindings=function(){var E=this;E.bindEvt(E.options.zone,"start"),E.options.zone.style.touchAction="none",E.options.zone.style.msTouchAction="none"};li.prototype.begin=function(){var E=this,O=E.options;if(O.mode==="static"){var R=E.createNipple(O.position,E.manager.getIdentifier());R.add(),E.idles.push(R)}};li.prototype.createNipple=function(E,O){var R=this,z=R.manager.scroll,V={},j=R.options,Y={x:R.parentIsFlex?z.x:z.x+R.box.left,y:R.parentIsFlex?z.y:z.y+R.box.top};if(E.x&&E.y)V={x:E.x-Y.x,y:E.y-Y.y};else if(E.top||E.right||E.bottom||E.left){var ee=document.createElement("DIV");ee.style.display="hidden",ee.style.top=E.top,ee.style.right=E.right,ee.style.bottom=E.bottom,ee.style.left=E.left,ee.style.position="absolute",j.zone.appendChild(ee);var se=ee.getBoundingClientRect();j.zone.removeChild(ee),V=E,E={x:se.left+z.x,y:se.top+z.y}}var he=new $0(R,{color:j.color,size:j.size,threshold:j.threshold,fadeTime:j.fadeTime,dataOnly:j.dataOnly,restJoystick:j.restJoystick,restOpacity:j.restOpacity,mode:j.mode,identifier:O,position:E,zone:j.zone,frontPosition:{x:0,y:0},shape:j.shape});return j.dataOnly||(Sb(he.ui.el,V),Sb(he.ui.front,he.frontPosition)),R.nipples.push(he),R.trigger("added "+he.identifier+":added",he),R.manager.trigger("added "+he.identifier+":added",he),R.bindNipple(he),he};li.prototype.updateBox=function(){var E=this;E.box=E.options.zone.getBoundingClientRect()};li.prototype.bindNipple=function(E){var O,R=this,r=function(E,z){O=E.type+" "+z.id+":"+E.type,R.trigger(O,z)};E.on("destroyed",R.onDestroyed.bind(R)),E.on("shown hidden rested dir plain",r),E.on("dir:up dir:right dir:down dir:left",r),E.on("plain:up plain:right plain:down plain:left",r)};li.prototype.pressureFn=function(E,O,R){var z=this,V=0;clearInterval(z.pressureIntervals[R]),z.pressureIntervals[R]=setInterval(function(){var R=E.force||E.pressure||E.webkitForce||0;R!==V&&(O.trigger("pressure",R),z.trigger("pressure "+O.identifier+":pressure",R),V=R)}.bind(z),100)};li.prototype.onstart=function(E){var O=this,R=O.options,z=E;E=bb(E),O.updateBox();var i=function(V){O.actives.length<R.maxNumberOfNipples?O.processOnStart(V):z.type.match(/^touch/)&&(Object.keys(O.manager.ids).forEach((function(R){if(Object.values(z.touches).findIndex((function(E){return E.identifier===R}))<0){var V=[E[0]];V.identifier=R,O.processOnEnd(V)}})),O.actives.length<R.maxNumberOfNipples&&O.processOnStart(V))};return $m(E,i),O.manager.bindDocument(),!1};li.prototype.processOnStart=function(E){var O,R=this,z=R.options,V=R.manager.getIdentifier(E),j=E.force||E.pressure||E.webkitForce||0,Y={x:E.pageX,y:E.pageY},ee=R.getOrCreate(V,Y);ee.identifier!==V&&R.manager.removeIdentifier(ee.identifier),ee.identifier=V;var l=function(O){O.trigger("start",O),R.trigger("start "+O.id+":start",O),O.show(),j>0&&R.pressureFn(E,O,O.identifier),R.processOnMove(E)};if((O=R.idles.indexOf(ee))>=0&&R.idles.splice(O,1),R.actives.push(ee),R.ids.push(ee.identifier),z.mode!=="semi")l(ee);else{var se=Jm(Y,ee.position);if(!(se<=z.catchDistance)){ee.destroy(),R.processOnStart(E);return}l(ee)}return ee};li.prototype.getOrCreate=function(E,O){var R,z=this,V=z.options;return/(semi|static)/.test(V.mode)?(R=z.idles[0],R?(z.idles.splice(0,1),R):V.mode==="semi"?z.createNipple(O,E):(console.warn("Coudln't find the needed nipple."),!1)):(R=z.createNipple(O,E),R)};li.prototype.processOnMove=function(E){var O=this,R=O.options,z=O.manager.getIdentifier(E),V=O.nipples.get(z),j=O.manager.scroll;if(OB(E))if(V){if(R.dynamicPage){var Y=V.el.getBoundingClientRect();V.position={x:j.x+Y.left,y:j.y+Y.top}}V.identifier=z;var ee=V.options.size/2,se={x:E.pageX,y:E.pageY};R.lockX&&(se.y=V.position.y),R.lockY&&(se.x=V.position.x);var he,ce,ue=Jm(se,V.position),fe=IB(se,V.position),ve=xb(fe),we=ue/ee,Se={distance:ue,position:se};if(V.options.shape==="circle"?(he=Math.min(ue,ee),ce=DB(V.position,he,fe)):(ce=NB(se,V.position,ee),he=Jm(ce,V.position)),R.follow){if(ue>ee){let E=se.x-ce.x,R=se.y-ce.y;V.position.x+=E,V.position.y+=R,V.el.style.top=V.position.y-(O.box.top+j.y)+"px",V.el.style.left=V.position.x-(O.box.left+j.x)+"px",ue=Jm(se,V.position)}}else se=ce,ue=he;var _e=se.x-V.position.x,Ae=se.y-V.position.y;V.frontPosition={x:_e,y:Ae},R.dataOnly||Sb(V.ui.front,V.frontPosition);var Ce={identifier:V.identifier,position:se,force:we,pressure:E.force||E.pressure||E.webkitForce||0,distance:ue,angle:{radian:ve,degree:fe},vector:{x:_e/ee,y:-Ae/ee},raw:Se,instance:V,lockX:R.lockX,lockY:R.lockY};Ce=V.computeDirection(Ce),Ce.angle={radian:xb(180-fe),degree:180-fe},V.trigger("move",Ce),O.trigger("move "+V.id+":move",Ce)}else console.error("Found zombie joystick with ID "+z),O.manager.removeIdentifier(z);else this.processOnEnd(E)};li.prototype.processOnEnd=function(E){var O=this,R=O.options,z=O.manager.getIdentifier(E),V=O.nipples.get(z),j=O.manager.removeIdentifier(V.identifier);!V||(R.dataOnly||V.hide((function(){R.mode==="dynamic"&&(V.trigger("removed",V),O.trigger("removed "+V.id+":removed",V),O.manager.trigger("removed "+V.id+":removed",V),V.destroy())})),clearInterval(O.pressureIntervals[V.identifier]),V.resetDirection(),V.trigger("end",V),O.trigger("end "+V.id+":end",V),O.ids.indexOf(V.identifier)>=0&&O.ids.splice(O.ids.indexOf(V.identifier),1),O.actives.indexOf(V)>=0&&O.actives.splice(O.actives.indexOf(V),1),/(semi|static)/.test(R.mode)?O.idles.push(V):O.nipples.indexOf(V)>=0&&O.nipples.splice(O.nipples.indexOf(V),1),O.manager.unbindDocument(),/(semi|static)/.test(R.mode)&&(O.manager.ids[j.id]=j.identifier))};li.prototype.onDestroyed=function(E,O){var R=this;R.nipples.indexOf(O)>=0&&R.nipples.splice(R.nipples.indexOf(O),1),R.actives.indexOf(O)>=0&&R.actives.splice(R.actives.indexOf(O),1),R.idles.indexOf(O)>=0&&R.idles.splice(R.idles.indexOf(O),1),R.ids.indexOf(O.identifier)>=0&&R.ids.splice(R.ids.indexOf(O.identifier),1),R.manager.removeIdentifier(O.identifier),R.manager.unbindDocument()};li.prototype.destroy=function(){var E=this;E.unbindEvt(E.options.zone,"start"),E.nipples.forEach((function(E){E.destroy()}));for(var O in E.pressureIntervals)E.pressureIntervals.hasOwnProperty(O)&&clearInterval(E.pressureIntervals[O]);E.trigger("destroyed",E.nipples),E.manager.unbindDocument(),E.off()};var e1=li;function Hi(E){var O=this;O.ids={},O.index=0,O.collections=[],O.scroll=DT(),O.config(E),O.prepareCollections();var e=function(){var E;O.collections.forEach((function(R){R.forEach((function(R){E=R.el.getBoundingClientRect(),R.position={x:O.scroll.x+E.left,y:O.scroll.y+E.top}}))}))};if(typeof window>"u")return O.collections;Ff(window,"resize",(function(){_T(e)}));var r=function(){O.scroll=DT()};return Ff(window,"scroll",(function(){_T(r)})),O.collections}Hi.prototype=new J0;Hi.constructor=Hi;Hi.prototype.prepareCollections=function(){var E=this;E.collections.create=E.create.bind(E),E.collections.on=E.on.bind(E),E.collections.off=E.off.bind(E),E.collections.destroy=E.destroy.bind(E),E.collections.get=function(O){var R;return E.collections.every((function(E){return R=E.get(O),!R})),R}};Hi.prototype.create=function(E){return this.createCollection(E)};Hi.prototype.createCollection=function(E){var O=this,R=new e1(O,E);return O.bindCollection(R),O.collections.push(R),R};Hi.prototype.bindCollection=function(E){var O,R=this,r=function(E,z){O=E.type+" "+z.id+":"+E.type,R.trigger(O,z)};E.on("destroyed",R.onDestroyed.bind(R)),E.on("shown hidden rested dir plain",r),E.on("dir:up dir:right dir:down dir:left",r),E.on("plain:up plain:right plain:down plain:left",r)};Hi.prototype.bindDocument=function(){var E=this;E.binded||(E.bindEvt(document,"move").bindEvt(document,"end"),E.binded=!0)};Hi.prototype.unbindDocument=function(E){var O=this;(!Object.keys(O.ids).length||E===!0)&&(O.unbindEvt(document,"move").unbindEvt(document,"end"),O.binded=!1)};Hi.prototype.getIdentifier=function(E){var O;return E?(O=E.identifier===void 0?E.pointerId:E.identifier,O===void 0&&(O=this.latest||0)):O=this.index,this.ids[O]===void 0&&(this.ids[O]=this.index,this.index+=1),this.latest=O,this.ids[O]};Hi.prototype.removeIdentifier=function(E){var O={};for(var R in this.ids)if(this.ids[R]===E){O.id=R,O.identifier=this.ids[R],delete this.ids[R];break}return O};Hi.prototype.onmove=function(E){var O=this;return O.onAny("move",E),!1};Hi.prototype.onend=function(E){var O=this;return O.onAny("end",E),!1};Hi.prototype.oncancel=function(E){var O=this;return O.onAny("end",E),!1};Hi.prototype.onAny=function(E,O){var R,z=this,V="processOn"+E.charAt(0).toUpperCase()+E.slice(1);O=bb(O);var s=function(E,O,R){R.ids.indexOf(O)>=0&&(R[V](E),E._found_=!0)},o=function(E){R=z.getIdentifier(E),$m(z.collections,s.bind(null,E,R)),E._found_||z.removeIdentifier(R)};return $m(O,o),!1};Hi.prototype.destroy=function(){var E=this;E.unbindDocument(!0),E.ids={},E.index=0,E.collections.forEach((function(E){E.destroy()})),E.off()};Hi.prototype.onDestroyed=function(E,O){var R=this;if(R.collections.indexOf(O)<0)return!1;R.collections.splice(R.collections.indexOf(O),1)};var t1=Hi;var i1=new t1,r1={create:function(E){return i1.create(E)},factory:i1};var n1=new Map,s1=new Map,a1=class{constructor(E,O,R,z){this.data=O;let{audio:V,volume:j,delay:Y,loop:ee}=O;if(!V)throw new Error("Missing property");let se=typeof V=="string"?z.getAudio(V).src:V.data;this.audioPlayer=new yV({src:se,volume:j,delay:Y,loop:ee}),s1.has(R.uuid)?s1.get(R.uuid).push(this):s1.set(R.uuid,[this]),n1.set(E,this)}playByToggle(){this.data.toggle==="stop"?this.audioPlayer.status==="playing"?this.audioPlayer.stop():(this.audioPlayer.stop(),this.audioPlayer.play()):this.data.toggle==="pause"?this.audioPlayer.status==="playing"?this.audioPlayer.pause():this.audioPlayer.play():(this.audioPlayer.stop(),this.audioPlayer.play())}dispose(){this.audioPlayer.stop()}},o1=class{constructor(E){this.data=E}dispatch(){this.data.playAudio?this.pauseAudio(this.data.playAudio):this.data.object?this.pauseAllAudiosFromObject(this.data.object):this.pauseAllAudios()}pauseAudio(E){let O=n1.get(E);!O||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout((()=>{O.audioPlayer[this.data.interaction](),this.disposeDelay()}),this.data.delay)):O.audioPlayer[this.data.interaction]())}pauseAllAudiosFromObject(E){let O=s1.get(E);!O?.length||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout((()=>{O.forEach((E=>E.audioPlayer[this.data.interaction]())),this.disposeDelay()}),this.data.delay)):O.forEach((E=>E.audioPlayer[this.data.interaction]())))}pauseAllAudios(){let E=[...s1.values()];!E.length||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout((()=>{E.forEach((E=>{E.forEach((E=>{E.audioPlayer[this.data.interaction]()}))})),this.disposeDelay()}),this.data.delay)):E.forEach((E=>{E.forEach((E=>{E.audioPlayer[this.data.interaction]()}))})))}disposeDelay(){clearTimeout(this.timeoutId),delete this.timeoutId}dispose(){clearTimeout(this.timeoutId),delete this.timeoutId}},l1=class{constructor(E,O,R,z,V){this.data=O;this.shared=z;this.condition=V;if(O.interaction==="play")this.interaction=new a1(E,O,R,z);else{if(O.interaction!=="pause"&&O.interaction!=="stop")throw new Error("Missing property");this.interaction=new o1(O)}}dispatchBasic(){if(Ct(this.shared,this.condition)===!1)return!1;this.interaction instanceof a1?this.interaction.playByToggle():this.interaction.dispatch()}dispatchConditional(){if(Ct(this.shared,this.condition)===!1)return!1;this.interaction instanceof a1?this.interaction.audioPlayer.play():this.interaction.dispatch()}dispatchGameControl(E){if(Ct(this.shared,this.condition)===!1)return!1;this.interaction instanceof a1&&(E==="start"?this.interaction.audioPlayer.play():this.interaction.audioPlayer.stop())}dispose(){this.interaction.dispose()}};var h1=class{constructor(E,O,R,z){this.data=E;this.page=O;this.shared=R;this.condition=z;this.delay=0;this.emission=E.emission,E.delay!==void 0&&(this.delay=E.delay),this.particleSystem=this.page.scene.find(this.data.emitterObjectId)}toggleEmitting(){this.particleSystem.started&&!this.particleSystem.stopped?this.stop(this.delay):this.start(this.delay)}toggleFroze(){this.particleSystem.started&&!this.particleSystem.isFrozen?this.freeze(this.delay):this.unFreeze(this.delay)}start(E=0){E?this.delayTimerId=window.setTimeout((()=>{this.start(0),this.clearDelay()}),E):this.particleSystem.start()}stop(E=0){E?this.delayTimerId=window.setTimeout((()=>{this.stop(0),this.clearDelay()}),E):this.particleSystem.stop()}freeze(E=0){E?this.delayTimerId=window.setTimeout((()=>{this.freeze(0),this.clearDelay()}),E):this.particleSystem.froze()}unFreeze(E=0){E?this.delayTimerId=window.setTimeout((()=>{this.unFreeze(0),this.clearDelay()}),E):this.particleSystem.unFroze()}reset(E=0){E?this.delayTimerId=window.setTimeout((()=>{this.reset(0),this.clearDelay()}),E):this.particleSystem.reset()}reverseFromCurrent(){switch(this.emission){case"emitToggle":this.toggleEmitting();break;case"pauseToggle":this.toggleFroze();break}}dispatchBasic(){if(Ct(this.shared,this.condition)===!1||!this.particleSystem)return!1;switch(this.emission){case"start":this.start(this.delay);break;case"emitToggle":this.toggleEmitting();break;case"pause":this.freeze(this.delay);break;case"pauseToggle":this.toggleFroze();break;case"stop":this.stop(this.delay);break;case"reset":this.reset(this.delay);break;default:break}}dispatchConditional(){if(Ct(this.shared,this.condition)===!1||!this.particleSystem)return!1;switch(this.emission){case"start":this.start(this.delay);break;case"stop":this.stop(this.delay);break;case"reset":this.reset(this.delay);break;default:break}}dispatchGameControl(E){if(Ct(this.shared,this.condition)===!1||!this.particleSystem)return!1;E==="start"?this.start(this.delay):this.stop(this.delay)}dispose(){!this.particleSystem||(this.particleSystem.reset(),this.clearDelay())}clearDelay(){this.delayTimerId&&(clearTimeout(this.delayTimerId),delete this.delayTimerId)}};var c1="text/plain",d1="us-ascii",qB=(E,O)=>O.some((O=>O instanceof RegExp?O.test(E):O===E)),jZ=(E,{stripHash:O})=>{let R=/^data:(?<type>[^,]*?),(?<data>[^#]*?)(?:#(?<hash>.*))?$/.exec(E);if(!R)throw new Error(`Invalid URL: ${E}`);let{type:z,data:V,hash:j}=R.groups,Y=z.split(";");j=O?"":j;let ee=!1;Y[Y.length-1]==="base64"&&(Y.pop(),ee=!0);let se=(Y.shift()||"").toLowerCase(),he=[...Y.map((E=>{let[O,R=""]=E.split("=").map((E=>E.trim()));return O==="charset"&&(R=R.toLowerCase(),R===d1)?"":`${O}${R?`=${R}`:""}`})).filter(Boolean)];return ee&&he.push("base64"),(he.length>0||se&&se!==c1)&&he.unshift(se),`data:${he.join(";")},${ee?V.trim():V}${j?`#${j}`:""}`};function OT(E,O){if(O={defaultProtocol:"http:",normalizeProtocol:!0,forceHttp:!1,forceHttps:!1,stripAuthentication:!0,stripHash:!1,stripTextFragment:!0,stripWWW:!0,removeQueryParameters:[/^utm_\w+/i],removeTrailingSlash:!0,removeSingleSlash:!0,removeDirectoryIndex:!1,sortQueryParameters:!0,...O},E=E.trim(),/^data:/i.test(E))return jZ(E,O);if(/^view-source:/i.test(E))throw new Error("`view-source:` is not supported as it is a non-standard protocol");let R=E.startsWith("//");!R&&/^\.*\//.test(E)||(E=E.replace(/^(?!(?:\w+:)?\/\/)|^\/\//,O.defaultProtocol));let z=new URL(E);if(O.forceHttp&&O.forceHttps)throw new Error("The `forceHttp` and `forceHttps` options cannot be used together");if(O.forceHttp&&z.protocol==="https:"&&(z.protocol="http:"),O.forceHttps&&z.protocol==="http:"&&(z.protocol="https:"),O.stripAuthentication&&(z.username="",z.password=""),O.stripHash?z.hash="":O.stripTextFragment&&(z.hash=z.hash.replace(/#?:~:text.*?$/i,"")),z.pathname){let E=/\b[a-z][a-z\d+\-.]{1,50}:\/\//g,O=0,R="";for(;;){let V=E.exec(z.pathname);if(!V)break;let j=V[0],Y=V.index,ee=z.pathname.slice(O,Y);R+=ee.replace(/\/{2,}/g,"/"),R+=j,O=Y+j.length}let V=z.pathname.slice(O,z.pathname.length);R+=V.replace(/\/{2,}/g,"/"),z.pathname=R}if(z.pathname)try{z.pathname=decodeURI(z.pathname)}catch{}if(O.removeDirectoryIndex===!0&&(O.removeDirectoryIndex=[/^index\.[a-z]+$/]),Array.isArray(O.removeDirectoryIndex)&&O.removeDirectoryIndex.length>0){let E=z.pathname.split("/"),R=E[E.length-1];qB(R,O.removeDirectoryIndex)&&(E=E.slice(0,-1),z.pathname=E.slice(1).join("/")+"/")}if(z.hostname&&(z.hostname=z.hostname.replace(/\.$/,""),O.stripWWW&&/^www\.(?!www\.)[a-z\-\d]{1,63}\.[a-z.\-\d]{2,63}$/.test(z.hostname)&&(z.hostname=z.hostname.replace(/^www\./,""))),Array.isArray(O.removeQueryParameters))for(let E of[...z.searchParams.keys()])qB(E,O.removeQueryParameters)&&z.searchParams.delete(E);if(O.removeQueryParameters===!0&&(z.search=""),O.sortQueryParameters){z.searchParams.sort();try{z.search=decodeURIComponent(z.search)}catch{}}O.removeTrailingSlash&&(z.pathname=z.pathname.replace(/\/$/,""));let V=E;return E=z.toString(),!O.removeSingleSlash&&z.pathname==="/"&&!V.endsWith("/")&&z.hash===""&&(E=E.replace(/\/$/,"")),(O.removeTrailingSlash||z.pathname==="/")&&z.hash===""&&O.removeSingleSlash&&(E=E.replace(/\/$/,"")),R&&!O.normalizeProtocol&&(E=E.replace(/^http:\/\//,"//")),O.stripProtocol&&(E=E.replace(/^(?:https?:)?\/\//,"")),E}var u1=class{constructor({url:E,context:O},R,z,V){this.controlsManager=R;this.shared=z;this.condition=V;if(!E)throw new Error("Missing property");this.url=E.startsWith("mailto:")?E:OT(E,{removeTrailingSlash:!1,removeSingleSlash:!1,stripWWW:!1}),this.context=O??"tab"}dispatch(){if(Ct(this.shared,this.condition)===!1)return!1;_M?window.location.assign(this.url):(this.context==="tab"||bM&&this.context==="none"?window.open(this.url,"_blank"):this.context==="window"?window.open(this.url,"_blank",`width=${window.innerWidth}, height=${window.innerHeight}`):window.open(this.url,"_parent"),this.controlsManager.orbitControls?.onPointerUp(TM[0]),pI())}};var p1=class{constructor(E,O,R,z,V){this.data=E;this.page=O;this.controlsManager=R;this.shared=z;this.condition=V;this.timeoutIdQueue=[];this.dispatchInner=()=>{this.objects.forEach(this.destroyCallback)};this.destroyCallback=E=>{this.timeoutIdQueue.shift();let O=this.page.scene.find(E);if(O===void 0)return;let R=this.controlsManager.sharedGameControlGlobals.rapierWorld,z=!R||O.dataPatched.physics?.fusedBody;if(O.cloner){for(let E of O.cloner.children)z?(E.playModeVisible=!1,E.rigidBody&&O.dataPatched.physics?.rigidBody==="positioned"&&(this.controlsManager.sharedGameControlGlobals.colliderToEntity.delete(E.rigidBody.collider(0).handle),R.removeRigidBody(E.rigidBody),E.rigidBody=void 0),E.bvhGeometry&&(E.bvhGeometry=void 0)):this.clone===void 0||this.clone===E?(E.playModeVisible=!1,E.rigidBody&&(this.controlsManager.sharedGameControlGlobals.colliderToEntity.delete(E.rigidBody.collider(0).handle),R.removeRigidBody(E.rigidBody),E.rigidBody=void 0)):E.playModeVisible===void 0&&(E.playModeVisible=!0);(z||this.clone===void 0||this.clone===!1)&&(O.visible=!1,O.rigidBody&&(this.controlsManager.sharedGameControlGlobals.colliderToEntity.delete(O.rigidBody.collider(0).handle),R.removeRigidBody(O.rigidBody),O.rigidBody=void 0),O.bvhGeometry&&(O.bvhGeometry=void 0))}else O.rigidBody&&(this.controlsManager.sharedGameControlGlobals.colliderToEntity.delete(O.rigidBody.collider(0).handle),R.removeRigidBody(O.rigidBody),O.rigidBody=void 0),O.bvhGeometry&&(O.bvhGeometry=void 0),O.visible=!1;this.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim=R===void 0?this.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim.filter((E=>E.bvhGeometry!==void 0)):this.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim.filter((E=>E.rigidBody!==void 0)),O.destroyedInAction=!0,this.controlsManager.requestRender()};this.objects=[...E.objects]}dispatch(E){if(Ct(this.shared,this.condition)===!1)return!1;this.clone=E,this.data.delay?this.timeoutIdQueue.push(window.setTimeout(this.dispatchInner,this.data.delay*1e3)):this.dispatchInner()}dispatchFromStart(){if(Ct(this.shared,this.condition)===!1)return!1;this.timeoutIdQueue.push(window.setTimeout(this.dispatchInner,this.data.delay*1e3))}dispose(){this.timeoutIdQueue.forEach((E=>window.clearTimeout(E)))}};var f1=class{constructor(E,O,R,z,V){this.data=E;this.page=O;this.shared=R;this.eventManager=z;this.condition=V;this.shared=R}dispatch(){if(Ct(this.shared,this.condition)===!1)return!1;clearTimeout(this.timeoutId),delete this.timeoutId,this.timeoutId=window.setTimeout((()=>{this.shared.reset(this.shared.data,!0),kf(this.page,this.shared,!0),this.eventManager.reset(),this.eventManager.controlsManager.gameControl?.reset(!0),this.page.switchToPlayCamera(),this.eventManager.controlsManager.requestRender(),delete this.timeoutId}),(this.data.delay??0)*1e3)}dispose(){clearTimeout(this.timeoutId),delete this.timeoutId}};var m1={update:null,begin:null,loopBegin:null,changeBegin:null,change:null,changeComplete:null,timelineChangeComplete:null,loopComplete:null,complete:null,loop:1,direction:"normal",autoplay:!0,timelineOffset:0,rewind:!0},g1={duration:1e3,delay:0,endDelay:0,startOnceDelay:0,pingPongDelayCorrection:0,pingPongEndDelayCorrection:0,easing:"easeOutElastic(1, .5)",round:0},y1=["translateX","translateY","translateZ","rotate","rotateX","rotateY","rotateZ","scale","scaleX","scaleY","scaleZ","skew","skewX","skewY","perspective","matrix","matrix3d"],w1={CSS:{},springs:{}};function io(E,O,R){return Math.min(Math.max(E,O),R)}function ag(E,O){return E.indexOf(O)>-1}function RT(E,O){return E.apply(null,O)}var S1={arr:function(E){return Array.isArray(E)},obj:function(E){return ag(Object.prototype.toString.call(E),"Object")},pth:function(E){return S1.obj(E)&&E.hasOwnProperty("totalLength")},svg:function(E){return E instanceof SVGElement},inp:function(E){return E instanceof HTMLInputElement},dom:function(E){return!("isNode"in E)&&(E.nodeType||S1.svg(E))},str:function(E){return typeof E=="string"},fnc:function(E){return typeof E=="function"},und:function(E){return typeof E>"u"},hex:function(E){return/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(E)},rgb:function(E){return/^rgb/.test(E)},hsl:function(E){return/^hsl/.test(E)},col:function(E){return S1.hex(E)||S1.rgb(E)||S1.hsl(E)},key:function(E){return!m1.hasOwnProperty(E)&&!g1.hasOwnProperty(E)&&E!=="targets"&&E!=="keyframes"}};function $B(E){var O=/\(([^)]+)\)/.exec(E);return O?O[1].split(",").map((function(E){return parseFloat(E)})):[]}function eN(E,O){var R=$B(E),z=io(S1.und(R[0])?1:R[0],.1,100),V=io(S1.und(R[1])?100:R[1],.1,100),j=io(S1.und(R[2])?10:R[2],.1,100),Y=io(S1.und(R[3])?0:R[3],.1,100),ee=Math.sqrt(V/z),se=j/(2*Math.sqrt(V*z)),he=se<1?ee*Math.sqrt(1-se*se):0,ce=1,ue=se<1?(se*ee-Y)/he:-Y+ee;function d(E){var R=O?O*E/1e3:E;return R=se<1?Math.exp(-R*se*ee)*(ce*Math.cos(he*R)+ue*Math.sin(he*R)):(ce+ue*R)*Math.exp(-R*ee),E===0||E===1?E:1-R}function f(){var O=w1.springs[E];if(O)return O;for(var R=1/6,z=0,V=0;;)if(z+=R,d(z)===1){if(V++,V>=16)break}else V=0;var j=z*R*1e3;return w1.springs[E]=j,j}return O?d:f}function WZ(E){return E===void 0&&(E=10),function(O){return Math.ceil(io(O,1e-6,1)*E)*(1/E)}}var _1=function(){var E=11,O=1/(E-1);function e(E,O){return 1-3*O+3*E}function r(E,O){return 3*O-6*E}function i(E){return 3*E}function s(E,O,R){return((e(O,R)*E+r(O,R))*E+i(O))*E}function o(E,O,R){return 3*e(O,R)*E*E+2*r(O,R)*E+i(O)}function a(E,O,R,z,V){var j,Y,ee=0;do{Y=O+(R-O)/2,j=s(Y,z,V)-E,j>0?R=Y:O=Y}while(Math.abs(j)>1e-7&&++ee<10);return Y}function l(E,O,R,z){for(var V=0;V<4;++V){var j=o(O,R,z);if(j===0)return O;var Y=s(O,R,z)-E;O-=Y/j}return O}function c(R,z,V,j){if(0<=R&&R<=1&&0<=V&&V<=1){var Y=new Float32Array(E);if(R!==z||V!==j)for(var ee=0;ee<E;++ee)Y[ee]=s(ee*O,R,V);return function(E){return R===z&&V===j||E===0||E===1?E:s(g(E),z,j)}}function g(z){for(var j=0,ee=1,se=E-1;ee!==se&&Y[ee]<=z;++ee)j+=O;--ee;var he=(z-Y[ee])/(Y[ee+1]-Y[ee]),ce=j+he*O,ue=o(ce,R,V);return ue>=.001?l(z,ce,R,V):ue===0?ce:a(z,j,j+O,R,V)}}return c}(),A1=function(){var E={linear:function(){return function(E){return E}}},O={Sine:function(){return function(E){return 1-Math.cos(E*Math.PI/2)}},Circ:function(){return function(E){return 1-Math.sqrt(1-E*E)}},Back:function(){return function(E){return E*E*(3*E-2)}},Bounce:function(){return function(E){for(var O,R=4;E<((O=Math.pow(2,--R))-1)/11;);return 1/Math.pow(4,3-R)-7.5625*Math.pow((O*3-2)/22-E,2)}},Elastic:function(E,O){E===void 0&&(E=1),O===void 0&&(O=.5);var R=io(E,1,10),z=io(O,.1,2);return function(E){return E===0||E===1?E:-R*Math.pow(2,10*(E-1))*Math.sin((E-1-z/(Math.PI*2)*Math.asin(1/R))*(Math.PI*2)/z)}}},R=["Quad","Cubic","Quart","Quint","Expo"];return R.forEach((function(E,R){O[E]=function(){return function(E){return Math.pow(E,R+2)}}})),Object.keys(O).forEach((function(R){var z=O[R];E["easeIn"+R]=z,E["easeOut"+R]=function(E,O){return function(R){return 1-z(E,O)(1-R)}},E["easeInOut"+R]=function(E,O){return function(R){return R<.5?z(E,O)(R*2)/2:1-z(E,O)(R*-2+2)/2}}})),E}();function FT(E,O){if(S1.fnc(E))return E;var R=E.split("(")[0],z=A1[R],V=$B(E);switch(R){case"spring":return eN(E,O);case"cubicBezier":return RT(_1,V);case"steps":return RT(WZ,V);default:return RT(z,V)}}function rN(E){try{var O=document.querySelectorAll(E);return O}catch{return}}function Pb(E,O){for(var R=E.length,z=arguments.length>=2?arguments[1]:void 0,V=[],j=0;j<R;j++)if(j in E){var Y=E[j];O.call(z,Y,j,E)&&V.push(Y)}return V}function _b(E){return E.reduce((function(E,O){return E.concat(S1.arr(O)?_b(O):O)}),[])}function XB(E){return S1.arr(E)?E:(S1.str(E)&&(E=rN(E)||E),E instanceof NodeList||E instanceof HTMLCollection?[].slice.call(E):[E])}function VT(E,O){return E.some((function(E){return E===O}))}function UT(E){var O={};for(var R in E)O[R]=E[R];return O}function LT(E,O){var R=UT(E);for(var z in E)R[z]=O.hasOwnProperty(z)?O[z]:E[z];return R}function Ib(E,O){var R=UT(E);for(var z in O)R[z]=S1.und(E[z])?O[z]:E[z];return R}function XZ(E){var O=/rgb\((\d+,\s*[\d]+,\s*[\d]+)\)/g.exec(E);return O?"rgba("+O[1]+",1)":E}function YZ(E){var O=/^#?([a-f\d])([a-f\d])([a-f\d])$/i,R=E.replace(O,(function(E,O,R,z){return O+O+R+R+z+z})),z=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(R),V=parseInt(z[1],16),j=parseInt(z[2],16),Y=parseInt(z[3],16);return"rgba("+V+","+j+","+Y+",1)"}function KZ(E){var O=/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.exec(E)||/hsla\((\d+),\s*([\d.]+)%,\s*([\d.]+)%,\s*([\d.]+)\)/g.exec(E),R=parseInt(O[1],10)/360,z=parseInt(O[2],10)/100,V=parseInt(O[3],10)/100,j=O[4]||1;function o(E,O,R){return R<0&&(R+=1),R>1&&(R-=1),R<1/6?E+6*(O-E)*R:R<.5?O:R<2/3?E+(O-E)*(2/3-R)*6:E}var Y,ee,se;if(z==0)Y=ee=se=V;else{var he=V<.5?V*(1+z):V+z-V*z,ce=2*V-he;Y=o(ce,he,R+1/3),ee=o(ce,he,R),se=o(ce,he,R-1/3)}return"rgba("+Y*255+","+ee*255+","+se*255+","+j+")"}function QZ(E){return S1.rgb(E)?XZ(E):S1.hex(E)?YZ(E):S1.hsl(E)?KZ(E):void 0}function Wa(E){var O=/[+-]?\d*\.?\d+(?:\.\d+)?(?:[eE][+-]?\d+)?(%|px|pt|em|rem|in|cm|mm|ex|ch|pc|vw|vh|vmin|vmax|deg|rad|turn)?$/.exec(E);if(O)return O[1]}function ZZ(E){return ag(E,"translate")||E==="perspective"?"px":ag(E,"rotate")||ag(E,"skew")?"deg":void 0}function BT(E,O){return S1.fnc(E)?E(O.target,O.id,O.total):E}function Zo(E,O){return E.getAttribute(O)}function zT(E,O,R){var z=Wa(O);if(VT([R,"deg","rad","turn"],z))return O;var V=w1.CSS[O+R];if(!S1.und(V))return V;var j=100,Y=document.createElement(E.tagName),ee=E.parentNode&&E.parentNode!==document?E.parentNode:document.body;ee.appendChild(Y),Y.style.position="absolute",Y.style.width=j+R;var se=j/Y.offsetWidth;ee.removeChild(Y);var he=se*parseFloat(O);return w1.CSS[O+R]=he,he}function iN(E,O,R){if(O in E.style){var z=O.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),V=E.style[O]||getComputedStyle(E).getPropertyValue(z)||"0";return R?zT(E,V,R):V}}function kT(E,O){return S1.dom(E)&&!S1.inp(E)&&(Zo(E,O)||S1.svg(E)&&E[O])?"attribute":S1.dom(E)&&VT(y1,O)?"transform":S1.dom(E)&&O!=="transform"&&iN(E,O)?"css":E[O]!=null?"object":void 0}function nN(E){if(!!S1.dom(E)){for(var O,R=E.style.transform||"",z=/(\w+)\(([^)]*)\)/g,V=new Map;O=z.exec(R);)V.set(O[1],O[2]);return V}}function JZ(E,O,R,z){var V=ag(O,"scale")?1:0+ZZ(O),j=nN(E).get(O)||V;return R&&(R.transforms.list.set(O,j),R.transforms.last=O),z?zT(E,j,z):j}function GT(E,O,R,z){switch(kT(E,O)){case"transform":return JZ(E,O,z,R);case"css":return iN(E,O,R);case"attribute":return Zo(E,O);default:return E[O]||0}}function jT(E,O){var R=/^(\*=|\+=|-=)/.exec(E);if(!R)return E;var z=Wa(E)||0,V=parseFloat(O),j=parseFloat(E.replace(R[0],""));switch(R[0][0]){case"+":return V+j+z;case"-":return V-j+z;case"*":return V*j+z}}function sN(E,O){if(S1.col(E))return QZ(E);if(/\s/g.test(E))return E;var R=Wa(E),z=R?E.substr(0,E.length-R.length):E;return O?z+O:z}function HT(E,O){return Math.sqrt(Math.pow(O.x-E.x,2)+Math.pow(O.y-E.y,2))}function $Z(E){return Math.PI*2*Zo(E,"r")}function eJ(E){return Zo(E,"width")*2+Zo(E,"height")*2}function tJ(E){return HT({x:Zo(E,"x1"),y:Zo(E,"y1")},{x:Zo(E,"x2"),y:Zo(E,"y2")})}function oN(E){for(var O,R=E.points,z=0,V=0;V<R.numberOfItems;V++){var j=R.getItem(V);V>0&&(z+=HT(O,j)),O=j}return z}function rJ(E){var O=E.points;return oN(E)+HT(O.getItem(O.numberOfItems-1),O.getItem(0))}function aN(E){if(E.getTotalLength)return E.getTotalLength();switch(E.tagName.toLowerCase()){case"circle":return $Z(E);case"rect":return eJ(E);case"line":return tJ(E);case"polyline":return oN(E);case"polygon":return rJ(E)}}function iJ(E){var O=aN(E);return E.setAttribute("stroke-dasharray",O),O}function nJ(E){for(var O=E.parentNode;S1.svg(O)&&S1.svg(O.parentNode);)O=O.parentNode;return O}function lN(E,O){var R=O||{},z=R.el||nJ(E),V=z.getBoundingClientRect(),j=Zo(z,"viewBox"),Y=V.width,ee=V.height,se=R.viewBox||(j?j.split(" "):[0,0,Y,ee]);return{el:z,viewBox:se,x:se[0]/1,y:se[1]/1,w:Y/se[2],h:ee/se[3]}}function sJ(E,O){var R=S1.str(E)?rN(E)[0]:E,z=O||100;return function(E){return{property:E,el:R,svg:lN(R),totalLength:aN(R)*(z/100)}}}function oJ(E,O){function e(R){R===void 0&&(R=0);var z=O+R>=1?O+R:0;return E.el.getPointAtLength(z)}var R=lN(E.el,E.svg),z=e(),V=e(-1),j=e(1);switch(E.property){case"x":return(z.x-R.x)*R.w;case"y":return(z.y-R.y)*R.h;case"angle":return Math.atan2(j.y-V.y,j.x-V.x)*180/Math.PI}}function YB(E,O){var R=/[+-]?\d*\.?\d+(?:\.\d+)?(?:[eE][+-]?\d+)?/g,z=sN(S1.pth(E)?E.totalLength:E,O)+"";return{original:z,numbers:z.match(R)?z.match(R).map(Number):[0],strings:S1.str(E)||O?z.split(R):[]}}function cN(E){var O=E?_b(S1.arr(E)?E.map(XB):XB(E)):[];return Pb(O,(function(E,O,R){return R.indexOf(E)===O}))}function uN(E){var O=cN(E);return O.map((function(E,R){return{target:E,id:R,total:O.length,transforms:{list:nN(E)}}}))}function aJ(E,O){var R=UT(O);if(/^spring/.test(R.easing)&&(R.duration=eN(R.easing)),S1.arr(E)){var z=E.length,V=z===2&&!S1.obj(E[0]);V?E={value:E}:S1.fnc(O.duration)||(R.duration=O.duration/z)}var j=S1.arr(E)?E:[E];return j.map((function(E,R){var z=S1.obj(E)&&!S1.pth(E)?E:{value:E};return S1.und(z.delay)&&(z.delay=R?0:O.delay),S1.und(z.endDelay)&&(z.endDelay=R===j.length-1?O.endDelay:0),z})).map((function(E){return Ib(E,R)}))}function lJ(E){for(var O=Pb(_b(E.map((function(E){return Object.keys(E)}))),(function(E){return S1.key(E)})).reduce((function(E,O){return E.indexOf(O)<0&&E.push(O),E}),[]),R={},r=function(z){var V=O[z];R[V]=E.map((function(E){var O={};for(var R in E)S1.key(R)?R==V&&(O.value=E[R]):O[R]=E[R];return O}))},z=0;z<O.length;z++)r(z);return R}function cJ(E,O){var R=[],z=O.keyframes;z&&(O=Ib(lJ(z),O));for(var V in O)S1.key(V)&&R.push({name:V,tweens:aJ(O[V],E)});return R}function uJ(E,O){var R={};for(var z in E){var V=BT(E[z],O);S1.arr(V)&&(V=V.map((function(E){return BT(E,O)})),V.length===1&&(V=V[0])),R[z]=V}return R.duration=parseFloat(R.duration),R.delay=parseFloat(R.delay),R}function hJ(E,O){var R;return E.tweens.map((function(z){var V=uJ(z,O),j=V.value,Y=S1.arr(j)?j[1]:j,ee=Wa(Y),se=GT(O.target,E.name,ee,O),he=R?R.to.original:se,ce=S1.arr(j)?j[0]:he,ue=Wa(ce)||Wa(se),fe=ee||ue;return S1.und(Y)&&(Y=he),V.from=YB(ce,fe),V.to=YB(jT(Y,ce),fe),V.start=R?R.end:0,V.end=V.start+V.delay+V.duration+V.endDelay,V.easing=FT(V.easing,V.duration),V.isPath=S1.pth(j),V.isColor=S1.col(V.from.original),V.isColor&&(V.round=1),R=V,V}))}var M1={css:function(E,O,R){return E.style[O]=R},attribute:function(E,O,R){return E.setAttribute(O,R)},object:function(E,O,R){return E[O]=R},transform:function(E,O,R,z,V){if(z.list.set(O,R),O===z.last||V){var j="";z.list.forEach((function(E,O){j+=O+"("+E+") "})),E.style.transform=j}}};function dN(E,O){var R=uN(E);R.forEach((function(E){for(var R in O){var z=BT(O[R],E),V=E.target,j=Wa(z),Y=GT(V,R,j,E),ee=j||Wa(Y),se=jT(sN(z,ee),Y),he=kT(V,R);M1[he](V,R,se,E.transforms,!0)}}))}function dJ(E,O){var R=kT(E.target,O.name);if(R){var z=hJ(O,E),V=z[z.length-1];return{type:R,property:O.name,animatable:E,tweens:z,duration:V.end,delay:z[0].delay,endDelay:V.endDelay}}}function fJ(E,O){return Pb(_b(E.map((function(E){return O.map((function(O){return dJ(E,O)}))}))),(function(E){return!S1.und(E)}))}function fN(E,O){var R=E.length,r=function(E){return E.timelineOffset?E.timelineOffset:0},z={};return z.duration=R?Math.max.apply(Math,E.map((function(E){let O=E.startOnceDelay??0,R=E.pingPongDelayCorrection??0,z=E.pingPongEndDelayCorrection??0;return r(E)+O+R+z+E.duration*(E.loop??1)}))):O.duration,z.delay=R?Math.min.apply(Math,E.map((function(E){let O=E.startOnceDelay??0,R=E.pingPongDelayCorrection??0;return r(E)+O+R+E.delay}))):O.delay,z.endDelay=R?z.duration-Math.max.apply(Math,E.map((function(E){let O=E.startOnceDelay??0,R=E.pingPongDelayCorrection??0,z=E.pingPongEndDelayCorrection??0;return r(E)+O+R+E.duration*(E.loop??1)-E.endDelay-z}))):O.endDelay,z}var E1=0;function pJ(E){var O=LT(m1,E),R=LT(g1,E),z=cJ(R,E),V=uN(E.targets),j=fJ(V,z),Y=fN(j,R),ee=E1;return E1++,Ib(O,{id:ee,children:[],animatables:V,animations:j,duration:Y.duration,delay:Y.delay,endDelay:Y.endDelay,startOnceDelay:R.startOnceDelay,pingPongDelayCorrection:R.pingPongDelayCorrection,pingPongEndDelayCorrection:R.pingPongEndDelayCorrection})}var C1,T1=[],P1=[],D1=function(){function n(){C1=requestAnimationFrame(t)}function t(E){var O=T1.length;if(O){for(var R=0;R<O;){var z=T1[R];z.paused?(T1.splice(R,1),O-=1):(z.tick(E),R++)}n()}else C1=cancelAnimationFrame(C1)}return n}();function gJ(E){document.hidden?(T1.forEach((function(O){return O.pause(E.timeStamp)})),P1=T1.slice(0),ci.running=T1=[]):P1.forEach((function(O){return O.play(E.timeStamp)}))}typeof document<"u"&&document.addEventListener("visibilitychange",gJ);function ci(E){E===void 0&&(E={});var O,R,z=0,V=0,j=0,Y=0,ee=null;function l(E){var O=window.Promise&&new Promise((function(E){return ee=E}));return E.finished=O,O}var se=pJ(E);l(se);function h(){var E=se.direction;E!=="alternate"&&(se.direction=E!=="normal"?"normal":"reverse"),se.reversed=!se.reversed,R.forEach((function(E){(E.loop===1||E.loop%2===0)&&(E.reversed=se.reversed)}))}function d(){se.direction="normal",se.reversed=!1,R.forEach((function(E){return E.reversed=!1}))}function f(E){return se.reversed?se.duration-E:E}function p(){z=0,V=f(se.currentTime)*(1/ci.speed)}function m(E,O,R=!1){O&&(se.reversed?O.seek(O.duration*O.loop-(E-O.timelineOffset-O.pingPongDelayCorrection),R):O.seek(E-O.timelineOffset-O.startOnceDelay-O.pingPongDelayCorrection,R))}function g(E,O=!1){if(se.reversed)for(var z=Y;z--;)m(E,R[z],O);else for(var V=0;V<Y;V++)m(E,R[V],O)}function y(E){var O=0,R=se.animations,z=R.length;for(se.direction!=="alternate"&&se.parent?.direction==="alternate"?se.parent?.rewind===!1&&se.reversePlayback===!0&&se.rewind===!1&&(E=se.parent?.reversed&&se.direction==="alternate"?se.duration-se.delay+se.endDelay-E:se.duration+se.delay-se.endDelay-E):w(!1,se.parent?.rewind,se.rewind,se.parent?.reversePlayback,se.reversePlayback)&&(E=se.parent?.reversed&&se.direction==="alternate"?se.duration-se.delay+se.endDelay-E:se.duration+se.delay-se.endDelay-E);O<z;){var V=R[O],j=V.animatable,Y=V.tweens,ee=Y.length-1,he=Y[ee];ee&&(he=Pb(Y,(function(O){return E<O.end}))[0]||he);let z;z=se.parent?.reversed&&se.direction==="alternate"?io(E-he.start-he.endDelay,0,he.duration)/he.duration:io(E-he.start-he.delay,0,he.duration)/he.duration;for(var ce=isNaN(z)?1:he.easing(z),ue=he.to.strings,fe=he.round,ve=[],we=he.to.numbers.length,Se=void 0,_e=0;_e<we;_e++){var Ae=void 0;let E,O;se.direction!=="alternate"?se.parent?.rewind===!1&&se.reversePlayback===!0&&se.rewind===!1?(E=he.to.numbers[_e],O=he.from.numbers[_e]||0):(O=he.to.numbers[_e],E=he.from.numbers[_e]||0):w(!0,se.parent?.rewind,se.rewind,se.parent?.reversePlayback,se.reversePlayback)?(E=he.to.numbers[_e],O=he.from.numbers[_e]||0):(O=he.to.numbers[_e],E=he.from.numbers[_e]||0),Ae=he.isPath?oJ(he.value,ce*O):E+ce*(O-E),fe&&(he.isColor&&_e>2||(Ae=Math.round(Ae*fe)/fe)),ve.push(Ae)}var Ce=ue.length;if(Ce){Se=ue[0];for(var Te=0;Te<Ce;Te++){ue[Te];var Ie=ue[Te+1],Fe=ve[Te];isNaN(Fe)||(Se+=Ie?Fe+Ie:Fe+" ")}}else Se=ve[0];M1[V.type](j.target,V.property,Se,j.transforms),V.currentValue=Se,O++}}function x(E){se[E]&&!se.passThrough&&se[E](se)}function v(){se.remaining&&se.remaining!==!0&&se.remaining--}let he={0:!1,1:!0,2:!1,3:!0,4:!1,5:!1,6:!1,7:!1,8:!1,9:!0,10:!0,11:!1,12:!1,13:!1,14:!0,15:!0,16:!1,17:!0,18:!0,19:!1,20:!1,21:!1,22:!0,23:!0,24:!1,25:!0,26:!1,27:!0,28:!1,29:!1,30:!1,31:!1};function w(E,O,R,z,V){return he[E<<4|O<<3|R<<2|z<<1|V]}function A(E,O=!1){var V=se.duration;let j=se.delay,he=V-se.endDelay;se.parent?.reversed&&se.direction==="alternate"&&(j=se.endDelay,he=V-se.delay);var ce=f(E);if(se.progress=io(ce/V*100,0,100),O||(se.reversePlayback=ce<se.currentTime),Y&&g(ce,O),!se.began&&se.currentTime>=0&&(se.began=!0,x("begin")),!se.loopBegan&&se.currentTime>0&&(se.loopBegan=!0,x("loopBegin")),(se.reversed||ce>=0)&&ce<=j&&se.currentTime!==0&&(y(0),x("change")),(ce>=he&&se.currentTime!==V+se.pingPongDelayCorrection||!V)&&(y(V),x("change")),ce>j&&ce<he?(se.changeBegan||(se.changeBegan=!0,se.changeCompleted=!1,x("changeBegin")),y(ce),x("change")):se.changeBegan?(se.changeCompleted=!0,se.changeBegan=!1,x("change"),Y&&x("timelineChangeComplete")):se.began&&ce>he&&x("changeComplete"),se.currentTime=io(ce,0,V+se.pingPongDelayCorrection),se.began&&x("update"),E>=V)if(v(),se.remaining){z+=Y?se.duration/ci.speed:se.duration;for(let E of R)E.setStartTime(0),E.remaining=E.loop;x("loopComplete"),se.loopBegan=!1,se.direction==="alternate"?h():Y&&d()}else se.paused=!0,se.completed||(se.completed=!0,x("loopComplete"),x("complete"),!se.passThrough&&"Promise"in window&&(ee(),l(se)))}return se.reset=function(){var E=se.direction;se.passThrough=!1,se.currentTime=0,se.progress=0,se.paused=!0,se.began=!1,se.loopBegan=!1,se.changeBegan=!1,se.completed=!1,se.changeCompleted=!1,se.reversePlayback=!1,se.reversed=E==="reverse",se.remaining=se.loop,R=se.children,Y=R.length;for(var O=Y;O--;)se.children[O].reset();y(se.reversed?se.duration:0)},se.setStartTime=function(E){z=E},se.set=function(E,O){return dN(E,O),se},se.tick=function(E){j=E,z||(z=j),A((j+(V-z))*ci.speed)},se.seek=function(E,O=!1){A(E-z,O)},se.pause=function(E){se.paused=!0,Y&&(O=E??performance.now())},se.play=function(E){!se.paused||(se.completed&&se.reset(),se.paused=!1,T1.push(se),Y&&O!==void 0&&(z+=(E??performance.now())-O),C1||D1())},se.reverse=function(){h(),se.completed=!se.reversed,p()},se.restart=function(){se.reset(),se.play()},se.reset(),se.autoplay&&se.play(),se}function ZB(E,O){for(var R=O.length;R--;)VT(E,O[R].animatable.target)&&O.splice(R,1)}function yJ(E){for(var O=cN(E),R=T1.length;R--;){var z=T1[R],V=z.animations,j=z.children;ZB(O,V);for(var Y=j.length;Y--;){var ee=j[Y],se=ee.animations;ZB(O,se),!se.length&&!ee.children.length&&j.splice(Y,1)}!V.length&&!j.length&&z.pause()}}function vJ(E,O){O===void 0&&(O={});var R=O.direction||"normal",z=O.easing?FT(O.easing):null,V=O.grid,j=O.axis,Y=O.from||0,ee=Y==="first",se=Y==="center",he=Y==="last",ce=S1.arr(E),ue=parseFloat(ce?E[0]:E),fe=ce?parseFloat(E[1]):0,ve=Wa(ce?E[1]:E)||0,we=O.start||0+(ce?ue:0),Se=[],_e=0;return function(E,O,Ae){if(ee&&(Y=0),se&&(Y=(Ae-1)/2),he&&(Y=Ae-1),!Se.length){for(var Ce=0;Ce<Ae;Ce++){if(V){var Te=se?(V[0]-1)/2:Y%V[0],Ie=se?(V[1]-1)/2:Math.floor(Y/V[0]),Fe=Ce%V[0],Ue=Math.floor(Ce/V[0]),Ge=Te-Fe,qe=Ie-Ue,Xe=Math.sqrt(Ge*Ge+qe*qe);j==="x"&&(Xe=-Ge),j==="y"&&(Xe=-qe),Se.push(Xe)}else Se.push(Math.abs(Y-Ce));_e=Math.max.apply(Math,Se)}z&&(Se=Se.map((function(E){return z(E/_e)*_e}))),R==="reverse"&&(Se=Se.map((function(E){return j?E<0?E*-1:-E:Math.abs(_e-E)})))}var Qe=ce?(fe-ue)/_e:ue;return we+Qe*(Math.round(Se[O]*100)/100)+ve}}function xJ(E){E===void 0&&(E={});var O=ci(E);return O.duration=0,O.add=function(R,z){var V=T1.indexOf(O),j=O.children;V>-1&&T1.splice(V,1);function o(E){E.passThrough=!0}for(var Y=0;Y<j.length;Y++)o(j[Y]);var ee=Ib(R,LT(g1,E));ee.targets=ee.targets||E.targets;var se=O.duration;ee.autoplay=!1,ee.timelineOffset=S1.und(z)?se:jT(z,se),o(O);var he=ci(ee);o(he),j.push(he),he.parent=O;var ce=fN(j,E);return O.delay=ce.delay,O.endDelay=ce.endDelay,O.duration=ce.duration,he.loop===!0&&(O.duration=1/0),O.seek(0),O.reset(),O.autoplay&&O.play(),O},O}ci.version="3.2.0";ci.speed=1;ci.running=T1;ci.remove=yJ;ci.get=GT;ci.set=dN;ci.convertPx=zT;ci.path=sJ;ci.setDashoffset=iJ;ci.stagger=vJ;ci.timeline=xJ;ci.easing=FT;ci.penner=A1;ci.random=function(E,O){return Math.floor(Math.random()*(O-E+1))+E};var I1=ci;var O1=new Wn,R1=new Wn,z1=new Hn;function vN(E,O,R,z){if(z===0)return R.copy(E);if(z===1)return R.copy(O);let V=E.w*O.w+E.x*O.x+E.y*O.y+E.z*O.z;if(V>=1)return R.copy(E);let j=1-V*V;if(j<=Number.EPSILON){let V=1-z;return R.w=V*E.w+z*O.w,R.x=V*E.x+z*O.x,R.y=V*E.y+z*O.y,R.z=V*E.z+z*O.z,R.normalize(),R}let Y=Math.sqrt(j),ee=Math.atan2(Y,V),se=Math.sin((1-z)*ee)/Y,he=Math.sin(z*ee)/Y;return R.w=E.w*se+O.w*he,R.x=E.x*se+O.x*he,R.y=E.y*se+O.y*he,R.z=E.z*se+O.z*he,R}function $r(E,O,R,z,V,j){let Y=R[E]!==void 0?R[E]:void 0,ee=z[E];if(ee==null)return;let se=Y!=null?typeof Y=="string"?Number(V.getVariable(Y)??0):Y:O[E],he=typeof ee=="string"?Number(V.getVariable(ee)??0):ee;return se!==he?{update:R=>{let z=xn.lerp(se,he,R);O[E]=j?Math.trunc(z):z},start:()=>{O[E]=se},end:()=>{O[E]=he}}:void 0}function cg(E,O,R,z,V,j){let Y=R[E]?R[E]:void 0,ee=z[E];if(!ee)return;let se=O[E],he=[...Y??se].map((E=>typeof E=="string"?Number(V.getVariable(E)??0):E)),ce=[...ee].map((E=>typeof E=="string"?Number(V.getVariable(E)??0):E));return he.length!==ce.length||eM(he,ce)?void 0:{update:R=>{he.forEach(((z,V)=>{let Y=xn.lerp(z,ce[V],R);O[E][V]=j?Math.trunc(Y):Y}))},start:()=>{Object.assign(O[E],he)},end:()=>{Object.assign(O[E],ce)}}}function lg(E,O,R){return O.forEach(((O,z)=>{E.setComponent(z,typeof O=="string"?Number(R.getVariable(O)??0):O)})),E}function WT(E,O,R,z,V){let j=R[E]?R[E]:void 0,Y=z[E];if(!Y)return;let ee=O[E],se=j?lg(new Wn,j,V):ee.clone(),he=lg(new Wn,Y,V);return se.equals(he)?void 0:{update:E=>{ee.lerpVectors(se,he,E)},start:()=>{ee.copy(se)},end:()=>{ee.copy(he)}}}function yN(E,O,R){return O.forEach(((O,z)=>{E.setComponent(z,typeof O=="string"?Number(R.getVariable(O)??0):O)})),E}function Gf(E,O,R,z,V){let j=R[E]?R[E]:void 0,Y=z[E];if(!Y)return;let ee=O[E],se=!(ee instanceof bn),he=ee instanceof bn?ee:(new bn).fromArray(ee),ce=j?yN(new bn,j,V):he.clone(),ue=yN(new bn,Y,V);return ce.equals(ue)?void 0:{update:R=>{he.lerpVectors(ce,ue,R),se&&(O[E]=he.toArray())},start:()=>{he.copy(ce),se&&(O[E]=he.toArray())},end:()=>{he.copy(ue),se&&(O[E]=he.toArray())}}}function xN(E,O,R,z){let V=R[E]?R[E]:void 0,j=z[E];if(!j)return;let Y=O[E],ee=V?(new Es).fromArray(V):Y.clone(),se=new Wn,he=new Hn,ce=new Wn;ee.decompose(se,he,ce);let ue=(new Es).fromArray(j),fe=new Wn,ve=new Hn,we=new Wn;return ue.decompose(fe,ve,we),ee.equals(ue)?void 0:{update:E=>{z1.slerpQuaternions(he,ve,E),O1.lerpVectors(se,fe,E),R1.lerpVectors(ce,we,E),Y.compose(O1,z1,R1)},start:()=>{Y.compose(se,he,ce)},end:()=>{Y.compose(fe,ve,we)}}}function bN(E,O,R,z,V){let j=R[E]?R[E]:void 0,Y=z[E];if(!Y)return;let ee=O[E],se=j?typeof j=="string"?V.getColor(j).clone():(new On).setRGB(j.r,j.g,j.b):ee.clone(),he=typeof Y=="string"?V.getColor(Y).clone():(new On).setRGB(Y.r,Y.g,Y.b);if(se.equals(he))return;let ce=ee.clone();return{update:R=>{ce.lerpColors(se,he,R),O[E]?.copy?.(ce)},start:()=>{ce.copy(se)},end:()=>{ce.copy(he)}}}function ug(E,O,R,z,V){let j=R[E]?R[E]:void 0,Y=z[E];if(!Y)return;let ee=O[E],se=new $F(ee.r,ee.g,ee.b,ee.a),he=j?typeof j=="string"?V.getColor(j).clone():new $F(j.r,j.g,j.b,j.a):se.clone(),ce=typeof Y=="string"?V.getColor(Y).clone():new $F(Y.r,Y.g,Y.b,Y.a);return he.equals(ce)?void 0:{update:R=>{se.lerpColors(he,ce,R);let z=xn.lerp(he.a,ce.a,R);se.a=z,O[E]={r:se.r,g:se.g,b:se.b,a:se.a}},start:()=>{se.copy(he)},end:()=>{se.copy(ce)}}}function Jo(E,O,R,z,V){return typeof O[E]=="number"?$r(E,O,R??{},z,V):Array.isArray(O[E])?cg(E,O,R??{},z,V):void 0}function SN(E,O,R,z){let V=[],j=E.cameraType==="OrthographicCamera"?O.orthographic?.zoom:O.perspective?.zoom,Y=E.cameraType==="OrthographicCamera"?R.orthographic?.zoom:R.perspective?.zoom;if(Y!==void 0){let O=j??E.zoom,R=Y;O!==R&&V.push({update:z=>{E.zoom=xn.lerp(O,R,z),E.updateProjectionMatrix()},start:()=>{E.zoom=O,E.updateProjectionMatrix()},end:()=>{E.zoom=R,E.updateProjectionMatrix()}})}if(R.targetOffset!==void 0){let j=$r("targetOffset",E,O,R,z);j&&V.push(j)}return V}function bJ(E,O,R,z){if(R.scaleBaked===void 0)return;let V=(O.scaleBaked??E.data.geometry.scaleBaked).map((E=>typeof E=="string"?Number(z.getVariable(E)??0):E)),j=R.scaleBaked.map((E=>typeof E=="string"?Number(z.getVariable(E)??0):E));if(wT.isEqual(V,j))return;let Y=[];return Y.push({update:O=>{E.updateGeometryInteractions({scaleBaked:[xn.lerp(V[0],j[0],O),xn.lerp(V[1],j[1],O),xn.lerp(V[2],j[2],O)]},z),E.invalidateDownstreamBooleanData(),E.refreshAttachedClonersInteractions()},start:()=>{E.updateGeometryInteractions({scaleBaked:V},z),E.invalidateDownstreamBooleanData(),E.refreshAttachedClonersInteractions()},end:()=>{E.updateGeometryInteractions({scaleBaked:j},z),E.invalidateDownstreamBooleanData(),E.refreshAttachedClonersInteractions()}}),Y}function SJ(E,O,R,z){if(!R.extrusion)return;let V=E.extrusion,j=O.extrusion??{},Y=R.extrusion,ee=[];return HP.forEach((E=>{let O=Jo(E,V,j,Y,z);O&&ee.push(O)})),ee}function wN(E,O,R,z){let V=[];if(!("geometry"in R))return V;let j=E.geometry.userData.parameters,Y="geometry"in O?O.geometry:{},ee=R.geometry;if(E instanceof Cj){let O=bJ(E,Y,ee,z);O&&V.push(...O)}else{let O={};if(Object.assign(O,vM(j,YP),vM(Y,YP)),YP.forEach((E=>{let R=Jo(E,O,Y,ee,z);R&&V.push(R)})),E instanceof m$){Object.assign(O,{extrusion:{...j.extrusion}});let E=SJ(O,Y,ee,z);E&&V.push(...E)}V.length&&V.push({update:R=>{E.updateGeometryInteractions(O,z),E.updateGeometryGroupsIfNeeded(),E.refreshAttachedClonersInteractions()},start:R=>{E.updateGeometryInteractions(O,z),E.updateGeometryGroupsIfNeeded(),E.refreshAttachedClonersInteractions()},end:R=>{E.updateGeometryInteractions(O,z),E.updateGeometryGroupsIfNeeded(),E.refreshAttachedClonersInteractions()}})}return V}function AN(E,O,R,z){let V=[];if(R.intensity!==void 0){let j=$r("intensity",E,O,R,z);j&&V.push(j)}if(R.color!==void 0){let j=bN("color",E,O,R,z);j&&V.push(j)}return V}function TN(E,O,R,z){let V=[];if(Array.isArray(E.material)){if(!("materials"in R&&R.materials))return V;let j="materials"in O&&O.materials?O.materials:[],Y=R.materials;E.material.forEach(((E,O)=>{if(!Y[O])return;let R=j[O]??{},ee=Y[O];typeof R=="string"||typeof ee=="string"||V.push(...EN(E,R,ee,z))}))}else{if(!("material"in R&&R.material))return V;let j="material"in O&&O.material?O.material:{},Y=R.material;if(typeof j=="string"||typeof Y=="string")return V;V.push(...EN(E.material,j,Y,z))}return V}function EN(E,O,R,z){let V=[],j=tu(R,z)||!!O.layers&&tu(O,z);V.push(IJ(E,j));for(let j of E.layers){let E=O.layers?.data(j.uuid),Y=R.layers.data(j.uuid);if(!Y||j.type!=="light"&&(!(j.visible??!0)||!(Y.visible??!0)))continue;let ee=j.getNames().filter((E=>!BP.some((O=>E.includes(O)))));for(let O of ee)try{let R,ee=j.getValue(O);if(O==="colors")R=PJ(j,E,Y,O);else if(Array.isArray(ee))O==="steps"&&(R=CJ(j,E,Y,O));else if(typeof ee=="number")R=wJ(j,E,Y,O,z);else{if(typeof ee=="boolean")continue;ee instanceof bn?R=AJ(j,E,Y,O):ee instanceof Wn?R=EJ(j,E,Y,O,z):ee instanceof $F?R=MJ(j,E,Y,O,z):ee instanceof On?R=TJ(j,E,Y,O,z):"isTexture"in ee&&(R=_J(j,E,Y,O))}R&&(Array.isArray(R)?V.push(...R):V.push(R))}catch(E){console.error(`lerpMaterial: unexpected material layer for ${O}`,E)}}return V}function wJ(E,O,R,z,V){if(!E.hasValue(z)||!(z in R))return;let j=O?O[z]:E.getValue(z),Y=R[z],ee=typeof j=="string"?Number(V.getVariable(j)??0):j,se=typeof Y=="string"?Number(V.getVariable(Y)??0):Y;return ee!==se?{update:O=>{E.setValue(z,xn.lerp(ee,se,O))},start:()=>{E.setValue(z,ee)},end:()=>{E.setValue(z,se)}}:void 0}function AJ(E,O,R,z){if(!E.hasValue(z)||!(z in R))return;let V=E.getValue(z),j=O?(new bn).fromArray(O[z]):V.clone(),Y=(new bn).fromArray(R[z]);return j.equals(Y)?void 0:{update:E=>{V.lerpVectors(j,Y,E)},start:()=>{V.copy(j)},end:()=>{V.copy(Y)}}}function EJ(E,O,R,z,V){if(!E.hasValue(z)||!(z in R))return;let j=E.getValue(z),Y=O?O[z]:void 0,ee=R[z],se=Y?lg(new Wn,Y,V):j.clone(),he=lg(new Wn,ee,V);return se.equals(he)?void 0:{update:E=>{j.lerpVectors(se,he,E)},start:()=>{j.copy(se)},end:()=>{j.copy(he)}}}function TJ(E,O,R,z,V){if(!E.hasValue(z)||!(z in R))return;let j=O?O[z]:void 0,Y=R[z],ee=E.getValue(z),se=j?typeof j=="string"?V.getColor(j).clone():(new On).setRGB(j.r,j.g,j.b):ee.clone(),he=typeof Y=="string"?V.getColor(Y).clone():(new On).setRGB(Y.r,Y.g,Y.b);if(se.equals(he))return;let ce=ee.clone();return{update:O=>{E.getValue(z)!==ce&&E.setValue(z,ce),ce.lerpColors(se,he,O)},start:()=>{ce.copy(se)},end:()=>{ce.copy(he)}}}function MJ(E,O,R,z,V){if(!E.hasValue(z)||!(z in R))return;let j=O?O[z]:void 0,Y=R[z],ee=E.getValue(z),se=j?typeof j=="string"?V.getColor(j).clone():(new On).setRGB(j.r,j.g,j.b):ee.clone(),he=typeof Y=="string"?V.getColor(Y).clone():new $F(Y.r,Y.g,Y.b,Y.a);if(se.equals(he))return;let ce=ee.clone();return{update:O=>{E.getValue(z)!==ce&&E.setValue(z,ce),ce.lerpColors(se,he,O)},start:()=>{ce.copy(se)},end:()=>{ce.copy(he)}}}function CJ(E,O,R,z="steps"){if(!E.hasValue(z)||!(z in R))return;let V=[],j=E.getValue(z),Y=O?O[z]:j,ee=R[z];return eM(Y,ee)||V.push({update:O=>{let R=[...j];for(let E=0;E<j.length;++E){let z=Y[E],V=ee[E];R[E]=xn.lerp(z,V,O)}E.setValue(z,R)},start:()=>{E.setValue(z,Y)},end:()=>{E.setValue(z,ee)}}),V.length?V:void 0}function PJ(E,O,R,z="colors"){if(!E.hasValue(z)||!(z in R))return;let V=[],j=E.getValue(z),Y=O?O[z]:j.map((E=>E.toArray())),ee=R[z];for(let E=0;E<j.length;++E){let O=[...Y[E]],R=[...ee[E]];AT.isEqual(O,R)||V.push({update:z=>{j[E].fromArray(AT.lerp(O,R,z))},start:()=>{j[E].fromArray(O)},end:()=>{j[E].fromArray(R)}})}return V.length?V:void 0}function _J(E,O,R,z="texture"){if(!E.hasValue(z)||!(z in R))return;let V=E.getNode("rotation"),j=O?.[z]?.rotation??0,Y=R[z]?.rotation??0;if(V&&j!==Y)return{update:E=>{V.value=xn.lerp(j,Y,E)*xn.DEG2RAD},start:()=>{V.value=j*xn.DEG2RAD},end:()=>{V.value=Y*xn.DEG2RAD}};let ee=E.getNode("mat");if(!ee)return;let se=O?O[z]:ee,he=R[z],ce=[...se.repeat],ue=[...se.offset],fe=[...he.repeat],ve=[...he.offset],we=se.rotation??0,Se=he.rotation??0;return xT.isEqual(ce,fe)&&xT.isEqual(ue,ve)&&we===Se?void 0:{update:E=>{ee.repeat=xT.lerp(ce,fe,E),ee.offset=xT.lerp(ue,ve,E),ee.rotation=xn.lerp(we,Se,E),ee.updateMatrix()},start:()=>{ee.repeat=[...ce],ee.offset=[...ue],ee.rotation=we,ee.updateMatrix()},end:()=>{ee.repeat=[...fe],ee.offset=[...ve],ee.rotation=Se,ee.updateMatrix()}}}function IJ(E,O){return{update:()=>{E.transparent=O}}}var F1=new Wn,N1=new zs;function CN(E,O,R,z,V){let j,Y,ee,se,he,ce,ue,fe,ve=[];if(E instanceof IK?(j=Gf("position",E,O,R,V),j&&ve.push(j),ee=$r("rotation",E,O,R,V),ee&&ve.push(ee),se=Gf("shear",E,O,R,V),se&&ve.push(se)):(fe={slide:O.pathSnapping?.slide??E.updatedPathSnapping?.slide??E.dataPatched.pathSnapping?.slide??0,offset:O.pathSnapping?.offset??E.updatedPathSnapping?.offset??E.dataPatched.pathSnapping?.offset??0},ce=$r("slide",fe,O.pathSnapping??E.updatedPathSnapping??E.dataPatched.pathSnapping,R.pathSnapping??E.dataPatched.pathSnapping,V),ce&&ve.push(ce),ue=$r("offset",fe,O.pathSnapping??E.updatedPathSnapping??E.dataPatched.pathSnapping,R.pathSnapping??E.dataPatched.pathSnapping,V),ue&&ve.push(ue),!ce&&!ue&&(j=WT("position",E,O,R,V),j&&ve.push(j),Y=WT("scale",E,O,R,V),Y&&ve.push(Y),ee=DJ(E,O,R,z,V),ee&&ve.push(ee),he=xN("hiddenMatrix",E,O,R),he&&ve.push(he))),j||Y||ee||he||ce||ue){let R=E instanceof IK?()=>{E.updateWorldMatrix(!0,!1,!0),E.resetBBoxNeedsUpdate()}:()=>{E.updateMatrix(),E.hasNonUniformScale&&(E.updateMatrixWorld(),E.updateMatrixWorldSVD()),E.parent?.matrixWorldFusedFalse&&(E.matrixWorld.multiplyMatrices(E.parent.matrixWorldFusedFalse,E.matrix),E.matrixWorldNeedsUpdate=!1),un(E)&&Mn(E.parent)&&E.invalidateDownstreamBooleanData(!0),E.updatePathSnapping(Object.assign({},O.pathSnapping,fe))};ve.push({update:R,start:R,end:R})}return ve}function DJ(E,O,R,z,V){let j=O?.rotation?O.rotation.map((E=>(typeof E=="string"?Number(V.getVariable(E)??0):E)*xn.DEG2RAD)):void 0,Y=R.rotation?.map((E=>(typeof E=="string"?Number(V.getVariable(E)??0):E)*xn.DEG2RAD));if(!Y)return;let ee=j?(new Wn).fromArray(j):(new Wn).setFromEuler(E.rotation),se=(new Wn).fromArray(Y);if(ee.equals(se))return;let he=F1.subVectors(se,ee);if(z&&he.toArray().every((E=>Math.abs(E)<2*Math.PI))){let O=(new Hn).setFromEuler(N1.setFromVector3(ee)),R=(new Hn).setFromEuler(N1.setFromVector3(se));return{update:z=>{vN(O,R,E.quaternion,z)},start:()=>{E.rotation.setFromVector3(ee)},end:()=>{E.rotation.setFromVector3(se)}}}return{update:O=>{F1.lerpVectors(ee,se,O),E.rotation.setFromVector3(F1)},start:()=>{E.rotation.setFromVector3(ee)},end:()=>{E.rotation.setFromVector3(se)}}}function PN(E,O,R,z){let V=[];if(!("cloner"in R)||!E.cloner)return V;let j=E.cloner,Y="cloner"in O?O.cloner:{},ee=R.cloner;aP.forEach((E=>{let O;O=E==="count"?$r("count",j.parameters,Y,ee,z,!0):Jo(E,j.parameters,Y??{},ee,z),O&&V.push(O)}));let se=OJ(j,Y,ee,z);se?.length&&V.push(...se);let he=RJ(j,Y,ee,z);he?.length&&V.push(...he);let ce=LJ(j,Y,ee,z);ce?.length&&V.push(...ce);let ue=BJ(j,Y,ee,z);ue?.length&&V.push(...ue);let fe=NJ(j,Y,ee,z);return fe?.length&&V.push(...fe),V.length&&V.push({update:()=>{j.update()}}),V}function OJ(E,O,R,z){if(E.parameters.type!=="radial")return;let V=O.radial,j=R.radial;if(!j)return;let Y=E.parameters.radial,ee=[];return lP.forEach((E=>{let O=Jo(E,Y,V??{},j,z);O&&ee.push(O)})),ee}function RJ(E,O,R,z){if(E.parameters.type!=="linear")return;let V=O.linear,j=R.linear;if(!j)return;let Y=[],ee=E.parameters.linear;return hP.forEach((E=>{let O=Jo(E,ee,V??{},j,z);O&&Y.push(O)})),Y}function LJ(E,O,R,z){if(E.parameters.type!=="grid")return;let V=O.grid,j=R.grid;if(!j)return;let Y=[],ee=E.parameters.grid;return cP.forEach((E=>{let O;O=E==="count"?cg(E,ee,V??{},j,z,!0):Jo(E,ee,V??{},j,z),O&&Y.push(O)})),Y}function BJ(E,O,R,z){if(E.parameters.type!=="toObject")return;let V=O.toObject,j=R.toObject;if(!j)return;let Y=[],ee=E.parameters.toObject;return dP.forEach((E=>{let O;O=E==="count"?$r(E,ee,V??{},j,z,!0):Jo(E,ee,V??{},j,z),O&&Y.push(O)})),Y}function NJ(E,O,R,z){if(!E.parameters.randomness)return;let V=O.randomnessObject,j=R.randomnessObject;if(!j)return;let Y=[],ee=E.parameters.randomnessObject;return uP.forEach((E=>{let O=Jo(E,ee,V??{},j,z);O&&Y.push(O)})),Y}function FJ(E,O){return{update:()=>{E instanceof QK&&(E.fill.enabled=O)}}}function VJ(E,O){return{update:()=>{E instanceof QK&&(E.stroke.enabled=O)}}}function UJ(E,O){return{update:()=>{E instanceof QK&&(E.dropShadow.enabled=O)}}}function zJ(E,O){return{update:()=>{E instanceof QK&&(E.innerShadow.enabled=O)}}}function kJ(E,O){return{update:()=>{E instanceof QK&&(E.backgroundBlur.enabled=O)}}}function GJ(E,O){return{update:()=>{E instanceof QK&&(E.layerBlur.enabled=O)}}}function _N(E,O,R,z,V){let j,Y,ee,se,he,ce,ue,fe,ve,we,Se,_e,Ae,Ce,Te,Ie=[];if("width"in E&&(j=$r("width",E,O,R,V),j&&Ie.push(j)),"height"in E&&(Y=$r("height",E,O,R,V),Y&&Ie.push(Y)),E instanceof QK||E instanceof WJ){let z={...O.fill},j={...R.fill};z.enabled!==void 0&&z.enabled!==j.enabled&&(Ie.push(FJ(E,!0)),z.enabled||Object.assign(z,{enabled:!0,color:{...z.color,a:0}}),j.enabled||Object.assign(j,{enabled:!0,color:{...j.color,a:0}})),ee=ug("color",E.fill,z,j,V),ee&&Ie.push(ee)}if(E instanceof QK){let z={...O.stroke},j={...R.stroke};(z.enabled||j.enabled)&&(Ie.push(VJ(E,!0)),z.enabled||Object.assign(z,{enabled:!0,color:{...z.color,a:0}}),j.enabled||Object.assign(j,{enabled:!0,color:{...j.color,a:0}})),se=ug("color",E.stroke,z,j,V),se&&Ie.push(se),he=$r("thickness",E.stroke,z,j,V),he&&Ie.push(he)}if(E instanceof QK){let z={...O.dropShadow},j={...R.dropShadow};(z.enabled||j.enabled)&&(Ie.push(UJ(E,!0)),z.enabled||Object.assign(z,{enabled:!0,color:{...z.color,a:0}}),j.enabled||Object.assign(j,{enabled:!0,color:{...j.color,a:0}})),ce=ug("color",E.dropShadow,z,j,V),ce&&Ie.push(ce),ue=$r("blurRadius",E.dropShadow,z,j,V),ue&&Ie.push(ue),ve=$r("spread",E.dropShadow,z,j,V),ve&&Ie.push(ve),fe=Gf("offset",E.dropShadow,z,j,V),fe&&Ie.push(fe)}if(E instanceof QK){let z={...O.innerShadow},j={...R.innerShadow};(z.enabled||j.enabled)&&(Ie.push(zJ(E,!0)),z.enabled||Object.assign(z,{enabled:!0,color:{...z.color,a:0}}),j.enabled||Object.assign(j,{enabled:!0,color:{...j.color,a:0}})),we=ug("color",E.innerShadow,z,j,V),we&&Ie.push(we),Se=$r("blurRadius",E.innerShadow,z,j,V),Se&&Ie.push(Se),Ae=$r("spread",E.innerShadow,z,j,V),Ae&&Ie.push(Ae),_e=Gf("offset",E.innerShadow,z,j,V),_e&&Ie.push(_e)}if(E instanceof QK||E instanceof WJ){let z={...O.backgroundBlur},j={...R.backgroundBlur};(z.enabled||j.enabled)&&(Ie.push(kJ(E,!0)),z.enabled||Object.assign(z,{enabled:!0,radius:0}),j.enabled||Object.assign(j,{enabled:!0,radius:0})),Ce=$r("radius",E.backgroundBlur,z,j,V),Ce&&Ie.push(Ce)}if(E instanceof QK){let z={...O.layerBlur},j={...R.layerBlur};(z.enabled||j.enabled)&&(Ie.push(GJ(E,!0)),z.enabled||Object.assign(z,{enabled:!0,radius:0}),j.enabled||Object.assign(j,{enabled:!0,radius:0})),Te=$r("radius",E.layerBlur,z,j,V),Te&&Ie.push(Te)}if(E instanceof WJ||E instanceof KK){let z=cg("cornerRadius",E,O,R,V);z&&Ie.push(z)}return Ie}function XT(E,O,R,z,V){let j=[];return E.data.visible&&j.push(...CN(E,O,R,V,z)),E instanceof IK?j.push(..._N(E,O,R,V,z)):(E.data.visible&&j.push(...PN(E,O,R,z)),un(E)?(E instanceof _j&&E.data.visible&&j.push(...wN(E,O,R,z)),E.data.visible&&j.push(...TN(E,O,R,z))):N3(E)?E.data.visible&&j.push(...AN(E,O,R,z)):B3(E)&&j.push(...SN(E,O,R,z))),j.length?{update:E=>{j.forEach((O=>O.update(E)))},start:E=>{j.forEach((O=>O.start?.(E)))},end:E=>{j.forEach((O=>O.end?.(E)))}}:void 0}var U1=new Wn;function kf(E,O,R=!1){let z=[],i=R=>{let z=R.data;delete R.states,R.currentState=null,R.reversibleToState=null,R.currentTransitionEvent=null;for(let E of z.states){let O={...E.data};R.states||(R.states={}),R.states[E.id]=hI.patch(z,O)}ON(E.scene,R,null,O,z.events.find((E=>E.data.type==="Follow"||E.data.type==="LookAt"))!==void 0),DN(E)};E.scene.traverse2D(i),E.traverseChildren((V=>{if(R&&(V.rigidBody?.setTranslation(V.position0,!0),V.rigidBody?.setRotation(V.rotation0,!0),V.rigidBody?.setLinvel(U1,!0),V.rigidBody?.setAngvel(U1,!0)),!oL.is(V))return;let j=V.uuid,Y=V.data;if(delete V.states,V.uuid===fT)return;let ee=!1;z.some((O=>E.scene.find(j)?.isDescendantOf(O)))?ee=!0:Y.physics?.fusedBody===!0&&Y.physics.rigidBody==="dynamic"&&z.push(j),V.data=Y,V.currentState=null,V.reversibleToState=null,V.currentTransitionEvent=null;for(let O of Y.states){let R={...O.data};E.data.globalPhysics.usePhysics===!0&&Y.physics&&(Y.physics.rigidBody==="dynamic"||ee)&&(O.data.position!==void 0&&delete R.position,O.data.rotation!==void 0&&delete R.rotation,O.data.hiddenMatrix!==void 0&&delete R.hiddenMatrix),V.states||(V.states={}),V.states[O.id]=yD.patch(Y,R)}ON(E.scene,V,null,O,Y.events.find((E=>E.data.type==="Follow"||E.data.type==="LookAt"))!==void 0),V instanceof x$&&V.frame&&(V.frame.traverse((E=>i(E))),V.uiCanvas?.applySize())})),DN(E),E.frame&&(E.frame.traverse((E=>i(E))),E.uiCanvas?.applySize())}function DN(E){E.traverseEntity((O=>{for(let R of O.data.events){let O=[];switch(R.data.type){case"Follow":case"MouseHover":case"Scroll":case"MouseDown":case"MouseUp":case"MousePress":case"KeyUp":case"KeyDown":case"KeyPress":case"Collision":O.push(...R.data.actions);break;case"GameControl":for(let E of Object.values(R.data.gameActions))O.push(...E);break;case"DragDrop":O.push(...R.data.dragDropActions.drag,...R.data.dragDropActions.drop);break;case"Conditional":O.push(...R.data.inActions,...R.data.outActions);break}for(let R of O)if(R.data.type==="Create"&&R.data.hideBase==="Yes"){let O=E.scene.find(R.data.object);O&&(O.visible=!1)}}}))}function ON(E,O,R,z,V=!1){if(O instanceof _j&&!(O instanceof l0)&&O.removeInteractionGeometry(z),O instanceof IK?O.changeSelectedState(R,{shared:z},V):O.changeSelectedState(R,{scene:E,shared:z},V),O instanceof _j&&O.updateGeometryGroupsIfNeeded(),O instanceof YH&&O.updateCameraState(O.dataPatched,{scene:E,shared:z}),!(O instanceof IK)){if(O.cloner)for(let E of O.cloner.children)E.playModeVisible=void 0;O.updateVisible()}}function KT(E){let O;if(E.easing===5){let{control1:R,control2:z}=E;O=`cubicBezier(\n\t\t\t${R[0]}, ${R[1]}, ${z[0]}, ${z[1]}\n\t\t)`}else if(E.easing===6){let{mass:R,stiffness:z,damping:V,velocity:j}=E;O=`spring( ${R}, ${z}, ${V}, ${j} )`}else{let R;switch(E.easing){case 0:R=JT.linear;break;case 1:R=JT.ease;break;case 2:R=JT.easeIn;break;case 3:R=JT.easeOut;break;case 4:R=JT.easeInOut;break;default:R=JT.linear}let[z,V,j,Y]=R;O=`cubicBezier( ${z}, ${V}, ${j}, ${Y} )`}return{duration:Math.max(E.duration,1e-4),easing:O}}function YT(E){let O={delay:0,loop:E.repeat===-1||E.repeat+1};if(E.repeat===0)O.direction="normal",O.rewind=!1;else switch(E.direction){case"pingpong":O.direction="alternate",O.rewind=!1;break;case"pingpong-rewind":O.direction="alternate",O.rewind=!0;break;default:O.direction="normal",O.rewind=!1;break}switch(O.delay=0,O.endDelay=0,O.startOnceDelay=0,O.pingPongDelayCorrection=0,O.pingPongEndDelayCorrection=0,E.delayDirection){case"start-once":O.startOnceDelay=E.delay;break;case"start":O.delay=E.delay;break;case"end":O.endDelay=E.delay;break;case"start-end":case void 0:O.delay=E.delay,O.endDelay=E.delay;break}return O.direction==="alternate"&&(O.delay/=2,O.endDelay/=2,E.delayDirection==="start"?(O.pingPongDelayCorrection=O.delay,typeof O.loop=="number"&&O.loop%2===0&&(O.pingPongEndDelayCorrection=O.delay)):E.delayDirection==="end"?typeof O.loop=="number"&&O.loop%2!==0&&(O.pingPongEndDelayCorrection=O.endDelay):E.delayDirection==="start-end"&&(O.pingPongDelayCorrection=O.delay,O.pingPongEndDelayCorrection=O.endDelay)),O}var k1={type:"beginState"},j1={type:"completeState",isfromEntity:!1},G1=class{constructor(E,O,R,z,V,j){this.object=E;this.data=z;this.sharedAssets=V;this.allowSlerp=j;this.targets={t:0};this.firstLoop=!0;this._changeBegan=!1;this._changeCompleted=!0;this.onChange=()=>{this.callback&&(this.callback.update(this.targets.t),this.object.requestRender()),this.targets.t===0||this.targets.t===1?this._changeCompleted||(this._changeCompleted=!0,this._changeBegan=!1,this.onChangeComplete()):(this._changeCompleted&&(this._changeCompleted=!1),this._changeBegan||(this._changeBegan=!0,this.onChangeBegin()))};this.onChangeBegin=()=>{this.object.reversibleToState=this.to.id;let E=this.targets.t>.5?this.from.id:this.to.id;this.object.prevState!==this.object.currentState&&(this.object.prevState=this.object.currentState),this.object.currentState=E,this.object.dispatchEvent({type:"beginState",state:E}),this.object instanceof IK||this.object.traverseEntity((E=>{E!==this.object&&E instanceof YH&&E.dispatchEvent(k1)}))};this.onChangeComplete=()=>{this.firstLoop&&(this.onFirstLoop(),this.firstLoop=!1),this.object.reversibleToState=this.to.id;let E=this.targets.t<.5?this.from.id:this.to.id;this.object.prevState!==this.object.currentState&&(this.object.prevState=this.object.currentState),this.object.currentState=E,this.object.dispatchEvent({type:"completeState",state:E}),this.object instanceof IK||this.object.traverseEntity((E=>{E!==this.object&&E instanceof YH&&E.dispatchEvent(j1)}))};this.onFirstLoop=()=>{this.useCurrentState&&(this.callback=XT(this.object,this.from.data,this.to.data,this.sharedAssets,this.allowSlerp))};if(O===void 0){let E=Ob(this.object,this.object.currentState===R?this.object.prevState:this.object.currentState);if(!E)throw new Error("Missing property");this.from=E}else{let E=Ob(this.object,O);if(!E)throw new Error("Missing property");this.from=E}if(R===void 0)throw new Error("Missing property");{let E=Ob(this.object,R);if(!E)throw new Error("Missing property");this.to=E}this.useCurrentState=O===void 0||R===void 0,this.params={targets:this.targets,t:1,autoplay:!1,...YT(z),...KT(z),change:this.onChange},this.callback=XT(this.object,O===void 0?{}:this.from.data,R===void 0?{}:this.to.data,this.sharedAssets,this.allowSlerp)}get changeBegan(){return this._changeBegan}get changeCompleted(){return this._changeCompleted}},H1=class extends pn{constructor(E,O,R,z,V){super();this.eventType=E;this.data=O;this.page=R;this.shared=z;this.condition=V;this.toggleIsForward=!1;this.timelineNeedsRebuild=!1;this.hasPlayedOnce=!1;this.onTimelineChangeComplete=()=>{this.data.tweens[0].data.direction!=="normal"&&(this.toggleIsForward=!this.toggleIsForward),this.timelineNeedsRebuild!==!1&&(this.timeline?.pause(),this.buildTimeline({isForward:this.toggleIsForward,needsRebuild:!1,isRebuild:!0}),this.timeline.play())};if(!O.object)throw new Error("Missing property");let j=this.page.scene.find(O.object)??this.page.uiCanvas?.find(O.object)??this.page.scene.find2DInUIObjects(O.object);if(!j)throw new Error("Missing property");if(!j.states)throw new Error("Missing property");if(this.object=j,O.tweens.length<2)throw new Error("Missing property");this.tweens=Array(this.data.tweens.length-1),this.startOnceDelay=O.tweens[0].data.delayDirection==="start-once"?O.tweens[0].data.delay:0,this.init()}get playing(){return this.timeline?.paused===!1}get changeBegan(){return this.tweens.some((E=>E.changeBegan))??!1}init(){this.initialCurrentState=Ob(this.object,this.object.currentState).id,this.toggleIsForward=!1}get currentState(){return this.data.runMode==="Toggle"&&Uw(this.eventType)?this.initialCurrentState:this.object.currentState}buildTimeline({isForward:E=!0,needsRebuild:O=!1,isRebuild:R=!1}={}){try{let z=YT(this.data.tweens[0].data);R&&typeof z.loop=="number"&&z.loop--,this.timeline?.pause(),this.timeline=I1.timeline({autoplay:!1,...z,...z.loop===!0||z.loop>1?{timelineChangeComplete:this.onTimelineChangeComplete}:{}});let V=this.tweens.findIndex((E=>E?.changeBegan));if(O===!0&&(this.timelineNeedsRebuild=!0),E){let E=V===-1?0:V;for(let O=E;O<this.data.tweens.length-1;O++){let R,j=this.data.tweens[O],Y=this.data.tweens[O+1];O!==E||this.object.wasMovedByUser!==!0&&this.object.previousAction?.changeBegan!==!0?R=j.data.state===void 0?this.currentState:j.data.state:(R=void 0,this.object instanceof YH&&(this.object.wasMovedByUser=!1));let ee=new G1(this.object,R,Y.data.state===void 0?this.currentState:Y.data.state,Y.data,this.shared,this.data.allowSlerp??!1);V!==-1&&O===E&&Object.assign(ee.params,{startOnceDelay:0}),this.tweens[O]=ee,this.timeline.add(ee.params,this.timeline.duration+(O===E?z.delay:0))}this.timeline.duration+=z.endDelay}else{let E=V===-1?this.data.tweens.length-1:V+1;for(let O=E;O>0;O--){let R,j=this.data.tweens[O],Y=this.data.tweens[O-1];O!==E||this.object.wasMovedByUser!==!0&&this.object.previousAction?.changeBegan!==!0?R=j.data.state===void 0?this.currentState:j.data.state:(R=void 0,this.object instanceof YH&&(this.object.wasMovedByUser=!1));let ee=new G1(this.object,R,Y.data.state===void 0?this.currentState:Y.data.state,j.data,this.shared,this.data.allowSlerp??!1);V!==-1&&O===E&&Object.assign(ee.params,{startOnceDelay:0}),this.tweens[O-1]=ee,this.timeline.add(ee.params,this.timeline.duration+(O===E?z.endDelay:0))}this.timeline.duration+=z.delay}}catch(E){E instanceof Error&&console.error(E.message)}this.object.previousAction?.playing===!0&&this.object.previousAction.pause(),this.object.previousAction=this}play(){if(Ct(this.shared,this.condition)===!1||Uw(this.eventType)&&this.data.runMode==="Once"&&this.hasPlayedOnce||(this.hasPlayedOnce=!0,this.playing))return!1;clearTimeout(this.timeoutId);let E=YT(this.data.tweens[0].data).pingPongDelayCorrection;this.timeoutId=window.setTimeout((()=>{try{this.buildTimeline(),this.timeline.play()}catch(E){E instanceof Error&&console.error(E.message)}}),this.startOnceDelay+E)}pause(){this.timeline?.pause(),clearTimeout(this.timeoutId),this.tweens=Array(this.data.tweens.length-1),delete this.timeoutId}stop(){this.pause();let E=this.data.tweens[0].data.state===void 0?this.initialCurrentState:this.data.tweens[0].data.state;this.object instanceof IK?this.object.changeSelectedState(E,{shared:this.shared}):this.object.changeSelectedState(E,{scene:this.page.scene,shared:this.shared}),this.object.currentState=E}seek(E){if(Ct(this.shared,this.condition)===!1)return!1;this.timeline===void 0&&this.buildTimeline(),this.timeline?.seek(E*this.timeline.duration,!0)}toggle(E){if(Ct(this.shared,this.condition)===!1)return!1;clearTimeout(this.timeoutId),this.toggleIsForward=E??!this.toggleIsForward,this.playing?(this.timeline?.pause(),this.buildTimeline({isForward:this.toggleIsForward,needsRebuild:!0}),this.timeline.play()):this.timeoutId=window.setTimeout((()=>{this.timeline?.pause(),this.buildTimeline({isForward:this.toggleIsForward}),this.timeline.play()}),this.startOnceDelay)}playFromCurrent(){this.toggle(!0)}reverseFromCurrent(){this.toggle(!1)}dispose(){this.pause()}};function Ob(E,O){let R,z;if(typeof O=="string"?(R=O,z=E.states?.[R]):O===null&&(R=null,z=E.data),!(R===void 0||z===void 0))return{id:R,data:z}}var W1={type:"beginState"},q1={type:"completeState",isfromEntity:!1},X1={type:"requestRender"},Y1=class extends pn{constructor(E,O,R,z){super();this.data=E;this.page=O;this.shared=R;this.condition=z;this.toggleIsForward=!1;this.posStart=new Wn;this.posEnd=new Wn;this.qStart=new Hn;this.qEnd=new Hn;this.zoomStart=1;this.zoomEnd=1}init(){}get playing(){return this.animation&&this.animation.began&&!this.animation.completed}buildAnimation(E=!1){if(!this.data.animate)return;let O=this.page.scene.find(this.data.targetCamera);if(!O||!O.visible)throw new ReferenceError("Target camera not founded or not visible");let R={t:0};this.posStart.copy(this.page.activeCamera.position),this.qStart.copy(this.page.activeCamera.quaternion),this.zoomStart=this.page.activeCamera.zoom,this.animation=I1({targets:R,t:1,...KT(this.data),update:()=>{R.t===0&&(this.data.runMode!=="Toggle"||this.toggleIsForward?(this.posEnd.copy(O.position),this.qEnd.copy(O.quaternion),this.zoomEnd=O.zoom,this.fromCamera=this.page.activeCamera,this.switchCamera(O.uuid)):this.fromCamera&&(this.posEnd.copy(this.fromCamera.position),this.qEnd.copy(this.fromCamera.quaternion),this.zoomEnd=this.fromCamera.zoom,this.switchCamera(this.fromCamera.uuid)),this.page.activeCamera.dispatchEvent(W1));let E=this.page.activeCamera;E.position.lerpVectors(this.posStart,this.posEnd,R.t),E.quaternion.slerpQuaternions(this.qStart,this.qEnd,R.t),E.zoom=this.zoomStart+(this.zoomEnd-this.zoomStart)*R.t,E.wasMovedBySwitchCameraAction=!0,E.updateMatrix(),E.updateMatrixWorld(),E.updateProjectionMatrix(),E.dispatchEvent(X1),R.t===1&&E.dispatchEvent(q1)}})}switchCamera(E){let O=this.page.activeCamera,R=this.page.scene.find(E);if(!R||!R.visible)throw new ReferenceError("Target camera not founded or not visible");this.page.switchActiveCamera(R),O.dispatchEvent({type:"cameraChange",camera:R})}play(){if(Ct(this.shared,this.condition)===!1)return!1;if(!this.playing&&this.page.activeCamera.uuid!==this.data.targetCamera)try{clearTimeout(this.timeoutId),this.timeoutId=window.setTimeout((()=>{delete this.timeoutId,this.data.animate?(this.buildAnimation(),this.animation?.play()):this.switchCamera(this.data.targetCamera)}),this.data.delay*1e3)}catch{}}pause(){this.animation?.pause(),clearTimeout(this.timeoutId),delete this.timeoutId}toggle(E){if(Ct(this.shared,this.condition)===!1)return!1;if(window.clearTimeout(this.timeoutId),delete this.timeoutId,E!==this.toggleIsForward)try{this.playing?(this.animation?.pause(),this.toggleIsForward=E??!this.toggleIsForward,this.buildAnimation(!0),this.animation?.play()):this.timeoutId=window.setTimeout((()=>{this.toggleIsForward=E??!this.toggleIsForward,this.data.animate?(this.animation?.pause(),this.buildAnimation(),this.animation?.play()):(this.toggleIsForward?(this.fromCamera=this.page.activeCamera,this.switchCamera(this.data.targetCamera)):this.fromCamera&&this.switchCamera(this.fromCamera.uuid),this.page.activeCamera.dispatchEvent(q1),this.page.activeCamera.dispatchEvent(X1))}),this.data.delay*1e3)}catch{}}playFromCurrent(){this.toggle(!0)}reverseFromCurrent(){this.toggle(!1)}dispose(){this.pause(),this.toggleIsForward=!1}};function QT(E){let O=E?.tracks.filter((E=>E.ValueTypeName==="vector"||E.ValueTypeName==="quaternion")).map((E=>E.times.length));if(O?.length){let E=nM(O);return E&&E>2?E:2}return 2}var Q1=class extends pn{constructor(E,O,R,z,V){super();this.data=E;this.page=O;this.animationControls=R;this.shared=z;this.condition=V;this.startOnceDelay=0;this.toggleIsForward=!1;let j=E.object,Y=O.scene.find(E.object);Y&&Array.isArray(Y.identity)&&(j=Y.identity[0]),this.data={...E,object:j};let ee=this.animationControls.clipIdToAction[E.clipId+"/"+j];if(this.duration=ee?.getClip()?.duration??1,this.data.crop2){let E=QT(ee?.getClip());this.leftFrameTime=this.data.crop2[0]/(E-1)*this.duration,this.rightFrameTime=this.data.crop2[1]/(E-1)*this.duration}else{let E=ee?.getClip()?.tracks[0]?.times.length;E&&E>1?(this.leftFrameTime=this.data.crop[0]/E*this.duration,this.rightFrameTime=this.data.crop[1]/E*this.duration):(this.leftFrameTime=0,this.rightFrameTime=this.duration)}this.startOnceDelay=E.delay}get playing(){return this.threeAnimAction?.isRunning()??!1}play(E=!1){if(Ct(this.shared,this.condition)===!1)return!1;window.clearTimeout(this.timeoutId),this.timeoutId=window.setTimeout((()=>{if(this.threeAnimAction=this.animationControls.play(this.data),!this.threeAnimAction)return;this.threeAnimAction.reset(),this.threeAnimAction.time=this.leftFrameTime,this.threeAnimAction._clip.start=this.leftFrameTime,this.threeAnimAction._clip.duration=this.rightFrameTime;let O=this.data.object;Object.entries(this.animationControls.clipIdToAction).forEach((([R,z])=>{let V=R.split("/")[1];this.threeAnimAction!==z&&V===O&&z.isRunning()&&(E?z.fadeOut(.2):z.stop())})),E&&this.threeAnimAction?.fadeIn(.2)}),this.startOnceDelay)}pause(){this.threeAnimAction&&(this.threeAnimAction.paused=!0),window.clearTimeout(this.timeoutId),delete this.timeoutId}stop(){this.threeAnimAction?.fadeOut(.2)}seek(E){this.threeAnimAction=this.animationControls.play(this.data),this.threeAnimAction&&(this.threeAnimAction.paused=!0,this.threeAnimAction.time=xn.clamp(this.threeAnimAction.time+1/60*E,this.leftFrameTime,this.rightFrameTime-16e-5),this.animationControls.needsUpdate=!0,this.animationControls.requestRender())}toggle(E,O=!1){if(Ct(this.shared,this.condition)===!1)return!1;this.toggleIsForward=E??!this.toggleIsForward,this.threeAnimAction&&(this.threeAnimAction._loopCount=0),this.playing?this.threeAnimAction&&(this.threeAnimAction.timeScale=this.toggleIsForward?1:-1,this.toggleIsForward?(this.threeAnimAction._clip.start=this.leftFrameTime,this.threeAnimAction._clip.duration=this.rightFrameTime):(this.threeAnimAction._clip.start=this.rightFrameTime,this.threeAnimAction._clip.duration=this.leftFrameTime)):this.timeoutId=window.setTimeout((()=>{if(this.threeAnimAction=this.animationControls.play(this.data),this.threeAnimAction){this.toggleIsForward?(this.threeAnimAction.time=this.leftFrameTime,this.threeAnimAction._clip.start=this.leftFrameTime,this.threeAnimAction._clip.duration=this.rightFrameTime):(this.threeAnimAction.time=this.rightFrameTime,this.threeAnimAction._clip.start=this.rightFrameTime,this.threeAnimAction._clip.duration=this.leftFrameTime),this.threeAnimAction.paused=!1,this.threeAnimAction.timeScale=this.toggleIsForward?1:-1;let E=this.data.clipId.split("/")[1];Object.entries(this.animationControls.clipIdToAction).forEach((([R,z])=>{let V=R.split("/")[1];this.threeAnimAction!==z&&V===E&&z.isRunning()&&(O?z.fadeOut(.2):z.stop())})),O&&this.threeAnimAction?.fadeIn(.2)}}),this.startOnceDelay)}playFromCurrent(){this.toggle(!0)}reverseFromCurrent(){this.toggle(!1)}dispose(){let E=this.animationControls.clipIdToAction[this.data.clipId+"/"+this.data.object]?.getClip();E&&(E.duration=this.duration),this.pause()}};var Z1=class{constructor(E,O,R,z,V){this.data=E;this.page=O;this.eventManager=R;this.shared=z;this.condition=V;this.timeOutId=-1;this.scene=O.scene}dispatch(){if(Ct(this.shared,this.condition)===!1)return!1;this.data.target!==this.page.uuid&&(window.clearTimeout(this.timeOutId),this.timeOutId=window.setTimeout((()=>{this.play()}),this.data.delay*1e3))}dispose(){window.clearTimeout(this.timeOutId)}play(){if(this.scene.children.every((E=>E.uuid!==this.data.target||E.data.uiScene)))return;this.data.transition==="fade"&&this.data.duration>0&&this.eventManager.eventContext.renderer.renderFromSceneForSceneTransitionPass(this.scene,this.scene.activeCamera,this.data.duration*1e3),this.eventManager.deactivate(),this.eventManager.controlsManager.deactivate();let E=this.scene.activeCamera;this.scene.updatePage(this.data.target),this.scene.traverseVisibleEntity((E=>{E.type==="ParticleSystem"&&(E.sleep(),E.wakeUp(),E.data.autoPlay?E.start():E.stop())})),this.scene.activePage.switchToPlayCamera(),this.scene.activeCamera.copyViewPlaneSize(E),kf(this.scene.activePage,this.shared),this.eventManager.activate(),this.eventManager.controlsManager.activate(this.eventManager)}};var K1=class{constructor(E,O,R,z){this.data=E;this.page=O;this.shared=R;this.condition=z;this.evaluatedCondition=!1}checkConditions(){this.evaluatedCondition=Ct(this.shared,this.condition)}dispatch(){if(this.evaluatedCondition===!1)return!1;let E=this.shared.getVariable(this.data.variableId),O=j0(this.data.expression,this.shared,ID.typeOfVariable(E));O!==void 0&&this.shared.updateVariable(this.data.variableId,typeof O=="string"?{textValue:O}:O)}dispose(){}};var J1=class{constructor(E,O,R,z){this.data=E;this.page=O;this.shared=R;this.condition=z;this.timeoutId=null}dispatchInner(){if(Ct(this.shared,this.condition)===!1)return!1;let E=this.shared.getDynamicVariablePlayState(this.data.variableId);if(this.data.mode==="PlayPause")this.shared.getDynamicVariableToggleIsForward(this.data.variableId)===void 0&&this.shared.setDynamicVariableToggleIsForward(this.data.variableId,!0),this.shared.setDynamicVariablePlayState(this.data.variableId,E==="Playing"?"Paused":"Playing");else if(this.data.mode==="Play"&&E!=="Playing")this.shared.getDynamicVariableToggleIsForward(this.data.variableId)===void 0&&this.shared.setDynamicVariableToggleIsForward(this.data.variableId,!0),this.shared.setDynamicVariablePlayState(this.data.variableId,"Playing");else if(this.data.mode==="Stop"&&E!=="Stopped")this.shared.setDynamicVariablePlayState(this.data.variableId,"Stopped");else if(this.data.mode==="Pause"&&E!=="Paused")this.shared.setDynamicVariablePlayState(this.data.variableId,"Paused");else if(this.data.mode==="Restart")this.shared.setDynamicVariablePlayState(this.data.variableId,"Restarted");else if(this.data.mode==="Toggle"){let O=this.shared.getDynamicVariableToggleIsForward(this.data.variableId);E==="Playing"?this.shared.setDynamicVariableToggleIsForward(this.data.variableId,O!==void 0&&!O):(this.shared.setDynamicVariableToggleIsForward(this.data.variableId,!O),this.shared.setDynamicVariablePlayState(this.data.variableId,"Playing"))}}dispatch(){let E=this.data.delay,O=this.shared.getDynamicVariablePlayState(this.data.variableId);this.data.mode==="PlayPause"&&O==="Playing"&&(E=this.data.pauseDelay),E!==0?(this.timeoutId&&window.clearTimeout(this.timeoutId),this.timeoutId=window.setTimeout((()=>{this.timeoutId=null,this.dispatchInner()}),E)):this.dispatchInner()}dispose(){this.timeoutId&&window.clearTimeout(this.timeoutId)}};var $1=class{constructor(E,O,R,z){this.data=E;this.page=O;this.shared=R;this.condition=z}dispatch(){if(Ct(this.shared,this.condition)===!1)return!1;(this.data.target==="single"?this.data.variableId?[this.data.variableId]:[]:Object.keys(this.shared.getVariables())).forEach((E=>{this.shared.getVariable(E);let O=this.shared.data.variables.data(E)?.value;O!==void 0&&this.shared.updateVariable(E,O),this.shared.enableLocalStorageForPersistentVariables&&localStorage.removeItem(vx(E))}))}dispose(){}};var e2=class{constructor(E,O,R,z){this.data=E;this.page=O;this.shared=R;this.condition=z}dispatch(){if(Ct(this.shared,this.condition)===!1)return!1;this.data.userAPIId&&this.shared.getUserAPI(this.data.userAPIId)?.callUserAPI(this.shared)}dispose(){}};function Ct(E,O){if(O===void 0)return!0;if(O.expression.length===0)return!1;let R=j0(O.expression,E,"boolean");return O.negate?!R:!!R}function Ht(E,O,R,z,V,j){let Y={Audio:[],Video:[],Particles:[],Link:[],Destroy:[],Create:[],Reset:[],Transition:[],SwitchCamera:[],Animation:[],SceneTransition:[],SetVariable:[],DynamicVariablePlay:[],ClearLocalStorage:[],UserAPI:[]},a=O=>({id:ee,data:se})=>{try{se.type==="Audio"?OC[E.type].includes("Audio")&&Y.Audio.push(new l1(ee,se,j,z,O)):se.type!=="Video"||j instanceof IK?se.type==="Particles"?OC[E.type].includes("Particles")&&Y.Particles.push(new h1(se,R,z,O)):se.type==="Link"?OC[E.type].includes("Link")&&Y.Link.push(new u1(se,V.controlsManager,z,O)):se.type==="Create"?OC[E.type].includes("Create")&&Y.Create.push(new c2(se,R,V.controlsManager,z,O)):se.type==="Destroy"?OC[E.type].includes("Destroy")&&Y.Destroy.push(new p1(se,R,V.controlsManager,z,O)):se.type==="Reset"?OC[E.type].includes("Reset")&&Y.Reset.push(new f1(se,R,z,V,O)):se.type==="Transition"?OC[E.type].includes("Transition")&&Y.Transition.push(new H1(E.type,se,R,z,O)):se.type==="SwitchCamera"?OC[E.type].includes("SwitchCamera")&&Y.SwitchCamera.push(new Y1(se,R,z,O)):se.type==="SceneTransition"?OC[E.type].includes("SceneTransition")&&Y.SceneTransition.push(new Z1(se,R,V,z,O)):se.type==="Animation"?OC[E.type].includes("Animation")&&Y.Animation.push(new Q1(se,R,V.animationControls,z,O)):se.type==="SetVariable"?OC[E.type].includes("SetVariable")&&Y.SetVariable.push(new K1(se,R,z,O)):se.type==="DynamicVariablePlay"?OC[E.type].includes("DynamicVariablePlay")&&Y.DynamicVariablePlay.push(new J1(se,R,z,O)):se.type==="Conditional"?OC[E.type].includes("Conditional")&&(se.ifActions.forEach(a({expression:se.condition,negate:!1})),se.elseActions.forEach(a({expression:se.condition,negate:!0}))):se.type==="ClearLocalStorage"?OC[E.type].includes("ClearLocalStorage")&&Y.ClearLocalStorage.push(new $1(se,R,z,O)):se.type==="UserAPI"&&OC[E.type].includes("UserAPI")&&Y.UserAPI.push(new e2(se,R,z,O)):OC[E.type].includes("Video")&&Y.Video.push(new s2(ee,se,j,z,O))}catch(E){!1}};return O.forEach(a()),Y}function dr(E){Object.values(E).forEach((E=>{E.forEach((E=>{(E instanceof l1||E instanceof s2||E instanceof h1||E instanceof Q1||E instanceof H1||E instanceof c2||E instanceof p1||E instanceof Y1||E instanceof Z1||E instanceof f1||E instanceof K1||E instanceof J1)&&E.dispose()}))}))}function BN(E,O){let R;if("material"in E){let z=E.material;R=Array.isArray(z)?E.material[0].layers.find((E=>E.uuid===O)):E.material.layers.find((E=>E.uuid===O))}if(!!R)return R.color.texture.image.img instanceof HTMLVideoElement?R.color.texture.image.img:void 0}var t2=new Map,i2=new Map,r2=class{constructor(E,O,R){this.data=O;this.delay=0;this.status="stopped";let{layerId:z,loop:V,volume:j,delay:Y}=O;if(this.object=R,z===void 0)throw new Error("Missing property");let ee=BN(R,z);ee&&(this.videoElement=ee,this.videoElement.loop=V===1/0,_M&&(this.videoElement.autoplay=!0),j!==void 0&&(this.videoElement.volume=j)),Y!==void 0&&(this.delay=Y),i2.has(R.uuid)?i2.get(R.uuid).push(this):i2.set(R.uuid,[this]),t2.set(E,this),this.pause()}mute(){!this.videoElement||(this.videoElement.muted=!0)}unMute(){!this.videoElement||(this.videoElement.muted=!1)}play(E){if(!this.videoElement)return;let O=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);E?(this.mute(),this.delay+=150):O?(this.mute(),window.setTimeout((()=>{this.unMute()}),100)):this.unMute(),this.delayTimerId=window.setTimeout((()=>{if(!this.videoElement)return;let E=this.videoElement.play();E!==void 0&&E.then((E=>{})).catch((E=>{this.play()})),this.clearDelay()}),this.delay),this.status="playing"}clearDelay(){this.delayTimerId&&(clearTimeout(this.delayTimerId),delete this.delayTimerId)}pause(){!this.videoElement||(this.videoElement.pause(),this.status="paused")}stop(){!this.videoElement||(this.videoElement.pause(),this.videoElement.currentTime=0,this.status="stopped",this.clearDelay())}playByToggle(){this.data.toggle==="stop"?this.status==="playing"?this.stop():(this.stop(),this.play()):this.data.toggle==="pause"?this.status==="playing"?this.pause():this.play():(this.stop(),this.play())}dispose(){!this.videoElement||(this.stop(),this.videoElement.muted=!0)}},n2=class{constructor(E){this.data=E}dispatch(){this.data.playVideo?this.pauseVideo(this.data.playVideo):this.data.object?this.pauseAllVideosFromObject(this.data.object):this.pauseAllVideos()}pauseVideo(E){let O=t2.get(E);!O||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout((()=>{O[this.data.interaction](),this.disposeDelay()}),this.data.delay)):O[this.data.interaction]())}pauseAllVideosFromObject(E){let O=i2.get(E);!O?.length||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout((()=>{O.forEach((E=>E[this.data.interaction]())),this.disposeDelay()}),this.data.delay)):O.forEach((E=>E[this.data.interaction]())))}pauseAllVideos(){let E=[...i2.values()];!E.length||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout((()=>{E.forEach((E=>{E.forEach((E=>{E[this.data.interaction]()}))})),this.disposeDelay()}),this.data.delay)):E.forEach((E=>{E.forEach((E=>{E[this.data.interaction]()}))})))}disposeDelay(){clearTimeout(this.timeoutId),delete this.timeoutId}dispose(){clearTimeout(this.timeoutId),delete this.timeoutId}},s2=class{constructor(E,O,R,z,V){this.data=O;this.shared=z;this.condition=V;if(O.interaction==="play")this.interaction=new r2(E,O,R);else{if(O.interaction!=="pause"&&O.interaction!=="stop")throw new Error("Missing property");this.interaction=new n2(O)}}dispatchBasic(){if(Ct(this.shared,this.condition)===!1)return!1;this.interaction instanceof r2?this.interaction.playByToggle():this.interaction.dispatch()}dispatchConditional(){if(Ct(this.shared,this.condition)===!1)return!1;this.interaction instanceof r2?this.interaction.play():this.interaction.dispatch()}dispose(){this.interaction.dispose()}};var a2=(()=>{let E,O,R,z;function i(R){!E&&!VN()&&O?.sharedGameControlGlobals.createdObjects.length>0&&(E=requestAnimationFrame(s)),R&&(O=R,z=R.requestRender)}function s(V){let j=R?V-R:0,Y=O.sharedGameControlGlobals.createdObjects,ee=O.sharedGameControlGlobals.nCreatedPerAction,se=Y.length,he=0;for(;he<se;){let E=Y[he];E.userData.createdTime===void 0&&(E.userData.createdTime=V),E.userData.lifetime===void 0&&E.userData.quantity===void 0||E.userData.lifetime&&V-E.userData.createdTime<E.userData.lifetime||E.userData.quantity&&ee[E.userData.actionId]<=E.userData.quantity?(E.userData.velocity&&(E.position.addScaledVector(E.userData.velocity,j/1e3),E.updateMatrix(),z()),he++):(ee[E.userData.actionId]>E.userData.quantity&&ee[E.userData.actionId]--,Y.splice(he,1),E.removeFromParent(),O.sharedGameControlGlobals.rapierWorld&&E.rigidBody?(O.sharedGameControlGlobals.colliderToEntity.delete(E.rigidBody.collider(0).handle),O.sharedGameControlGlobals.rapierWorld.removeRigidBody(E.rigidBody)):(E.bvhGeometry=void 0,O.sharedGameControlGlobals.entitiesWithTransformAnim=O.sharedGameControlGlobals.entitiesWithTransformAnim.filter((E=>E.bvhGeometry!==void 0))),se--,z())}E=he>0?requestAnimationFrame(s):void 0,R=he>0?V:void 0}function o(){VN()?E&&(cancelAnimationFrame(E),E=void 0,R=void 0):i()}return typeof document<"u"&&document.addEventListener("visibilitychange",o),i})();function VN(){return!!document&&document.hidden}var o2=new Hn,l2=new Wn,h2=new Wn,c2=class{constructor(E,O,R,z,V){this.data=E;this.page=O;this.controlsManager=R;this.shared=z;this.condition=V;this.intervalId=null;this.timeoutIdQueue=[];this.uniqueId=xn.generateUUID();this.dispatch=()=>{if(Ct(this.shared,this.condition)===!1)return!1;this.data.delay?this.timeoutIdQueue.push(window.setTimeout(this.dispatchInner,this.data.delay*1e3)):this.dispatchInner()};this.dispatchFromStart=()=>{if(Ct(this.shared,this.condition)===!1)return!1;this.timeoutIdQueue.push(window.setTimeout(this.dispatchInner,this.data.delay*1e3))};this.dispatchThrottled=xM(this.dispatch,1e3/this.data.creationSpeed);this.dispatchStart=()=>{this.intervalId===null&&(this.intervalId=window.setInterval(this.dispatch,1e3/this.data.creationSpeed))};this.dispatchStop=()=>{this.intervalId!==null&&(window.clearInterval(this.intervalId),this.intervalId=null)};this.dispatchInner=()=>{this.timeoutIdQueue.shift();let E=new HR(this.object);if(E.playModeVisible=!0,E.expand(),this.data.coordinateSystem!=="world"){let O=this.data.coordinateSystem,R=this.page.scene.find(O);R&&(R.updateMatrixWorldSVD(),E.hiddenMatrix.copy(R.matrixWorldRigid))}E.scale.copy(this.object.scale),E.position.fromArray(this.data.position),E.rotation.fromArray(this.data.rotation),E.updateMatrix(),this.page.add(E);let O=this.controlsManager.sharedGameControlGlobals;O.createdObjects.push(E),O.nCreatedPerAction[this.uniqueId]===void 0?O.nCreatedPerAction[this.uniqueId]=1:O.nCreatedPerAction[this.uniqueId]++,E.updateWorldMatrix(!0,!0),E.traverseObject(this.traverseObjectCB),a2(),this.controlsManager.requestRender()};this.traverseObjectCB=E=>{E.hasNonUniformScale&&E.updateMatrixWorldSVD();let O;if(this.controlsManager.sharedGameControlGlobals.rapierWorld){if(E instanceof SH){if(!E.objectForSample)return E.object.dataPatched.physics.fusedBody===!0&&E.object.dataPatched.physics.rigidBody==="dynamic"||void 0;if(E.objectForSample.dataPatched.physics.fusedBody)return;O=E.object}else if(E instanceof HR)O=E.object;else if(O=E,O.dataPatched.cloner?.hideBase)return!0}else{if(E instanceof SH)return;O=E instanceof HR?E.object:E}this.data.destroy==="Time"?E.userData.lifetime=this.data.lifetime*1e3:this.data.destroy==="Quantity"&&(E.userData.quantity=this.data.destroyAfterQuantity,E.userData.actionId=this.uniqueId);let R=(new Wn).fromArray(this.data.velocity),z=O.dataPatched;if(!(z.physics.enabled==="visibility"?!z.visible:!z.physics.enabled)&&(this.controlsManager.sharedGameControlGlobals.rapierWorld?(this.controlsManager.addRigidBody(E,O,{fromCreate:!0,dynamic:this.data.dynamic}),this.data.destroy==="Collision"&&(E.rigidBody?.collider(0).setActiveEvents(1),E.userData.hasCollisionDestroy=!0),E.matrixWorld.decompose(l2,o2,h2),R.applyQuaternion(o2),this.data.velocity.some((E=>E!==0))&&this.data.dynamic&&E.rigidBody?.setLinvel(R.divideScalar(this.controlsManager.pixelsPerMeter),!0)):("geometry"in E.object&&this.controlsManager.addBoundsTree(E),this.data.velocity.some((E=>E!==0))&&this.data.dynamic&&(E.userData.velocity=R)),O.dataPatched.physics?.fusedBody===!0))return!0};let j=this.page.scene.find(this.data.object);if(!j)throw new Error("Missing Property");if(this.object=j,this.data.coordinateSystem!=="world"&&!this.page.scene.find(this.data.coordinateSystem))throw new Error("Missing Property");a2(R)}dispose(){this.intervalId!==null&&(window.clearInterval(this.intervalId),this.intervalId=null),this.timeoutIdQueue.forEach((E=>window.clearTimeout(E))),this.dispatchThrottled.cancel(),this.page.remove(...this.controlsManager.sharedGameControlGlobals.createdObjects),this.controlsManager.sharedGameControlGlobals.createdObjects=[]}};var d2=200,u2=.02,p2=.3,f2=65,m2=(new Wn,new Wn),g2=new Wn,v2=new Wn,y2=new Wn,x2=new Wn,b2=new Wn,w2=new Es,S2=new Es,_2=new Es,A2=(new Es,new Hn),M2=new Hn,E2=new zs(0,0,0,"YXZ"),C2=new Wn(1,0,0),T2=new Wn(0,1,0),P2=new Wn(0,0,1),D2=new Wn(1,1,1),I2=(new ps,1),O2=.025,R2=16e-6,L2=12,B2=20,z2=new Df,F2=new Yn,N2={type:"requestRender"},U2={type:"updateMatrix"},k2=Math.PI/6,V2=class extends pn{constructor(E,O,R,z,V,j,Y,ee,se){super();this.object=E;this.domElement=O;this.data=R;this.gloabalPhysics=z;this.controlsManager=V;this.cameraFollow=j;this.camera=Y;this.page=ee;this.sharedAssets=se;this.enableDamping=!0;this.hiddenMatrix0=new Es;this.target0=new Wn;this.zoom0=1;this.rotForce=1;this.moveForce=1;this.pixelsPerMeter=d2;this.euler0=new zs(0,0,0,"YXZ");this.position0Cam=new Wn;this.quat0Cam=new Hn;this.scale0Cam=new Wn;this.hiddenMatrix0Cam=new Es;this.threshEndTranslate=.01;this.threshEndRotate=1e-8;this.threshEndRotVel=.005;this.collider={type:"capsule",radius:40,segment:new Df(new Wn(0,-40,0),new Wn(0,40,0)),matrix:new Es,position:new Wn,rotation:new Hn};this.euler=new zs(0,0,0,"YXZ");this.eulerDelta=new Wn;this.lastPosition=new Wn;this.lastCameraQuaternion=new Hn;this.lastCameraPosition=new Wn;this.PI_2=Math.PI/2;this.prevMouse=new bn;this.velocityTarget=new Wn;this.velocity=new Wn;this.directionXZ=new Wn;this.rotVelocityStick=new Wn;this.rotVelocityTarget=new Wn;this.rotVelocity=new Wn;this.rotDirection=new Wn;this.nonColliderRotOffset=new Es;this.nonColliderPosOffset=new Es;this.firstPointerId=-1;this.rot=new Wn;this.path=[];this.movementState={moveNegZ:0,movePosZ:0,moveNegX:0,movePosX:0,moveNegY:0,movePosY:0,rotPosX:0,rotNegX:0,rotPosY:0,rotNegY:0,jump:0,run:0};this.vrEulerYOffset=0;this.onObject=!1;this.actionState={};this.keyAssignments=[["moveNegZ","W"],["moveNegX","A"],["movePosZ","S"],["movePosX","D"],["rotPosX","ArrowUp"],["rotPosY","ArrowLeft"],["rotNegX","ArrowDown"],["rotNegY","ArrowRight"],["jump"," "]];this.collisionEnabled=!0;this.offsetMatrix=new Es;this.objectToTarget=new Wn;this.objectToTarget0=new Wn;this.objectToCamXZ=new Wn;this.objectToCamXZ0=new Wn;this.targetToCamera=new Wn;this.targetToCamera0=new Wn;this.cameraPolarAxis0=new Wn;this.targetPos=new Wn;this.targetQuat=new Hn;this.lerpFactorPos=(new Wn).setScalar(.3);this.lerpFactorPosStart=.3;this.lerpFactorPosEnd=.3;this.lerpFactorRotStart=.3;this.lerpFactorRotEnd=.3;this.lerpFactorPosCamera=.3;this.lerpFactorRotCamera=.3;this.objXZQuat=new Hn;this.objXZQuatInv=new Hn;this.objXZRotMat=new Es;this.isFirstPerson=!1;this.didHit=!1;this.groundVelocity=new Wn;this.pushedVelocity=new Wn;this.groundYRotation=0;this.objectRealQuat=new Hn;this.colliderWorldQuat=new Hn;this.groundNormal=new Wn;this.groundTilt=new Hn;this.groundTiltInv=new Hn;this.lastHitObj=null;this.isFirstFrame=!0;this.rotationAccumWhenOrientWithCamera=0;this.navMeshPathDest=null;this.position=new Wn;this.quaternion=new Hn;this.scale=new Wn;this.initialAction=!0;this.onPointerDown=E=>{!(E.target===this.domElement||E.target instanceof HTMLElement&&E.target.tagName==="SPLINE-VIEWER"&&E.target.shadowRoot?.contains(this.domElement))||this.firstPointerId!==-1||(this.firstPointerId=E.pointerId,this.domElement.ownerDocument.addEventListener("pointermove",this.onPointerMove),this.domElement.ownerDocument.addEventListener("pointerup",this.onPointerUp),this.rotBy!=="keys"&&!MM&&!EM&&this.domElement.requestPointerLock(),this.prevMouse.set(E.clientX,E.clientY))};this.onPointerUp=E=>{this.firstPointerId=-1,this.domElement.ownerDocument.removeEventListener("pointermove",this.onPointerMove),this.domElement.ownerDocument.removeEventListener("pointerup",this.onPointerUp),E.pointerType==="mouse"&&this.domElement.ownerDocument.exitPointerLock()};this.onPointerMove=E=>{if(E.pointerId!==this.firstPointerId)return;let O=E.clientX-this.prevMouse.x,R=E.clientY-this.prevMouse.y;this.prevMouse.set(E.clientX,E.clientY),E.pointerType==="mouse"&&this.rotBy!=="keys"&&(EM&&CM<15.5&&!MM?(this.eulerDelta.y=-O*this.mouseOrbitSensitivity,this.eulerDelta.x=-R*this.mouseOrbitSensitivity):(this.eulerDelta.y=-E.movementX*this.mouseOrbitSensitivity,this.eulerDelta.x=-E.movementY*this.mouseOrbitSensitivity)),E.pointerType!=="mouse"&&this.rotByTouch==="drag"&&(this.eulerDelta.y=-O*this.mouseOrbitSensitivity*5,this.eulerDelta.x=-R*this.mouseOrbitSensitivity*5),this.controlsManager.requestRender()};this.onPointerlockChange=E=>{this.domElement.ownerDocument.pointerLockElement===this.domElement?V2.isLocked=!0:V2.isLocked=!1};this.onPointerlockError=()=>{console.error("SPE.GameControls: Unable to use Pointer Lock API")};this.handleVisibilityChange=()=>{if(document?.hidden)for(let E in this.movementState)this.movementState[E]=0};this.onKeyDown=E=>{!(E.target instanceof HTMLInputElement)&&(E.code==="ArrowLeft"||E.code==="ArrowUp"||E.code==="ArrowRight"||E.code==="ArrowDown"||E.code==="Space")&&E.preventDefault();for(let O of this.keyAssignments)if(E.key.toUpperCase()===O[1]||E.key===O[1]){this.movementState[O[0]]=1;break}this.controlsManager.requestRender()};this.onKeyUp=E=>{for(let O of this.keyAssignments)if(E.key.toUpperCase()===O[1]||E.key===O[1]||E.code.slice(3,E.code.length).toUpperCase()===O[1]){this.movementState[O[0]]=0;break}};this.copyVRGamePadValues=(E,O)=>{for(let R=2;R<4;R++){let z=E.axes[R];O===0?R===2?this.movementState.movePosX=z:this.movementState.movePosZ=z:(E.buttons[3].pressed?this.movementState.jump=1:this.movementState.jump=0,R===2?(Math.abs(this.movementState.rotPosY)<.3&&Math.abs(z)>=.3&&(this.vrEulerYOffset+=z<0?1:-1),this.movementState.rotPosY=z):this.moveMode==="fly"&&(this.movementState.moveNegY=z))}};this.sharedGameControlGlobals=V.sharedGameControlGlobals,E===Y&&(this.isFirstPerson=!0),this.hiddenMatrix0.copy(this.object.hiddenMatrix),this.object.parent?this.object.hiddenMatrix.copy(this.object.parent.matrixWorld).invert():this.object.hiddenMatrix.identity(),this.object.matrix.copy(this.object.matrixWorld),this.object.matrix.decompose(this.position,this.quaternion,this.scale),this.euler0.setFromQuaternion(this.quaternion,"YXZ");let he=this.euler0.clone(),ce=he.y;if(this.objectRealQuat.copy(this.quaternion),he.y=0,this.quaternion.setFromEuler(he),this.objXZQuat.copy(this.quaternion),this.objXZQuatInv.copy(this.objXZQuat).invert(),this.objXZRotMat.makeRotationFromQuaternion(this.quaternion),he.set(0,ce,0),this.quaternion.setFromEuler(he),this.rot.setFromEuler(he),this.object.matrixAutoUpdate=!1,(this.isFirstPerson||this.cameraFollow===!0)&&(this.target0.copy(this.camera.getTarget()),this.zoom0=this.camera.zoom),this.cameraFollow===!0){this.position0Cam.copy(this.camera.position),this.quat0Cam.copy(this.camera.quaternion),this.scale0Cam.copy(this.camera.scale),this.hiddenMatrix0Cam.copy(this.camera.hiddenMatrix),this.camera.parent?(this.camera.hiddenMatrix.copy(this.camera?.parent.matrixWorld),this.camera.matrix.copy(this.camera.matrixWorld)):this.camera.hiddenMatrix.identity(),this.camera.matrix.copy(this.camera.matrixWorld),this.camera.matrix.decompose(this.camera.position,this.camera.quaternion,this.camera.scale),this.camera.matrixAutoUpdate=!1,this.offsetMatrix.copy(this.object.matrix).invert().multiply(this.camera.matrix);let E=new Wn(0,0,-1).applyQuaternion(this.camera.quaternion),O=(new Wn).subVectors(this.position,this.camera.position);this.objectToCamXZ.copy(O),this.objectToCamXZ.y=0,this.objectToCamXZ0.copy(this.objectToCamXZ);let R,z;Math.abs(E.y)<1e-6?(O.y=0,E.y=0,z=O.projectOnVector(E)):z=O.y/E.y>0?E.multiplyScalar(O.y/E.y):E.multiplyScalar(O.length()),this.targetToCamera0.copy(z).negate(),R=this.camera.position.clone().add(z),this.objectToTarget0.subVectors(R,this.position);let V=(new zs).setFromQuaternion(this.camera.quaternion,"YXZ");this.cameraPolarOffset=-V.x,V.x=0,V.z=0,V.y-=Math.PI/2,this.cameraPolarAxis0.set(0,0,-1).applyEuler(V)}if(this.object instanceof YH&&(this.object.matrixAutoUpdate=!1),this.euler.setFromQuaternion(this.quaternion,"YXZ"),this.rotByTouch=R.rotByTouch??"joystick",this.rotBy=R.rotBy??"keys",this.rotationMode=R.rotationMode??"normal",this.moveMode=R.moveMode??"walk",this.collisionEnabled=R.collisionEnabled,this.speedTranslate=(R.speedTranslate??250)*I2,this.speedOrbit=(R.speedRotate??100)*O2,this.mouseOrbitSensitivity=(R.speedRotate??100)*R2,this.keyAssignments=R.keyAssignments.map((E=>{let O=[E[0],E[1]];return O[1]===""?O[1]="ArrowUp":O[1]===""?O[1]="ArrowLeft":O[1]===""?O[1]="ArrowDown":O[1]===""?O[1]="ArrowRight":O[1]===""?O[1]="Shift":O[1]===""?O[1]="Enter":O[1]==="Space"?O[1]=" ":O[1]===""?O[1]="Meta":O[1]==="Ctrl"?O[1]="Control":O[1]==="Esc"&&(O[1]="Escape"),O})),R.rotBy==="mouse"){let E;E=this.keyAssignments.findIndex((E=>E[0]==="rotNegX")),E!==-1&&(this.keyAssignments[E][1]=""),E=this.keyAssignments.findIndex((E=>E[0]==="rotPosX")),E!==-1&&(this.keyAssignments[E][1]=""),E=this.keyAssignments.findIndex((E=>E[0]==="rotPosY")),E!==-1&&(this.keyAssignments[E][1]=""),E=this.keyAssignments.findIndex((E=>E[0]==="rotNegY")),E!==-1&&(this.keyAssignments[E][1]="")}this.lerpFactorPosStart=1-.02**(1/((R.delayPos[0]??.3)*60)),this.lerpFactorPosEnd=1-.02**(1/((R.delayPos[1]??.3)*60)),this.lerpFactorPos.setScalar(this.lerpFactorPosStart),this.lerpFactorRotStart=1-.02**(1/((R.delayRot[0]??.3)*60)),this.lerpFactorRotEnd=1-.02**(1/((R.delayRot[1]??.3)*60)),this.lerpFactorPosCamera=1-.02**(1/((R.delayPosCamera??.3)*60)),this.lerpFactorRotCamera=1-.02**(1/((R.delayRotCamera??.3)*60)),this.gravity=(this.gloabalPhysics.gravity??eD.defaultData.gravity)*L2,this.usePhysics=this.gloabalPhysics.usePhysics??eD.defaultData.usePhysics,this.jumpPower=R.jumpPower*B2,this.resetYPosition=this.position.y+Math.abs(R.resetYPosition)*(this.gravity>0?1:-1),this.alignToGround=R.alignToGround??!1,this.orientMode=R.autoOrientMove?R.orientMode:"none",this.orientWith=R.orientWith??$D.defaultDataThirdPerson.orientWith,this.slopeThresh=f2*Math.PI/180,R.collider.type==="capsule"?(this.collider.radius=R.collider.radius,this.collider.segment.start.y=R.collider.height/2-R.collider.radius,this.collider.segment.end.y=-this.collider.segment.start.y,this.offset=R.collider.height*u2/this.pixelsPerMeter,this.stepThresh=R.collider.height*p2/this.pixelsPerMeter,this.colliderHeight=R.collider.height):R.collider.type==="sphere"?(this.collider.radius=R.collider.radius,this.collider.segment.start.y=0,this.collider.segment.end.y=0,this.offset=2*R.collider.radius*u2/this.pixelsPerMeter,this.stepThresh=2*R.collider.radius*p2/this.pixelsPerMeter,this.colliderHeight=R.collider.radius*2):(this.offset=R.collider.height*u2/this.pixelsPerMeter,this.stepThresh=R.collider.height*p2/this.pixelsPerMeter,this.colliderHeight=R.collider.height),this.collider.type=R.collider.type;let ue=(new Wn).fromArray(R.collider.position),fe=(new Hn).setFromEuler((new zs).fromArray([...R.collider.rotation,"XYZ"]));this.collider.position.copy(ue).multiply(this.scale),this.collider.rotation.copy(fe),this.collider.matrix.compose(ue,fe,D2),R.cameraXAxis!==void 0&&(this.cameraXAxis=R.cameraXAxis,this.cameraYAxis=R.cameraYAxis,this.minPolarAngle=R.cameraRotXLimits[0],this.maxPolarAngle=R.cameraRotXLimits[1],this.minAzimuthAngleRel=R.cameraRotYLimits[0],this.maxAzimuthAngleRel=R.cameraRotYLimits[1]),this.forwardDir=R.forwardDirection??"-z",this.isFirstPerson&&(this.forwardDir="-z"),this.runMultiplier=R.runMultiplier??2;let ve=R.navmesh.destinationHelperRadius*2;if(ve>0){let E=new jM;E.push({fi:0,data:{...LP.defaultData("light","phong"),alpha:0},id:"layer1"}),E.push({fi:0,data:{...LP.defaultData("color"),color:R.navmesh.destinationHelperColor,alpha:R.navmesh.destinationHelperColor.a},id:"layer2"});let O=new cV({layers:E},{scene:this.page.scene,shared:this.sharedAssets});this.navMeshPathDest=new eo(uL.create({parameters:{width:ve,height:ve/10,hollow:.7}}),O),this.navMeshPathDest.material.userData.opacity0=R.navmesh.destinationHelperColor.a}this.activate()}reset(E=!1){if(this.object.hiddenMatrix.copy(this.hiddenMatrix0),E){this.object.updateMatrix(),this.object.updateMatrixWorld(),this.object.matrix.copy(this.object.matrixWorld),this.object.matrix.decompose(this.position,this.quaternion,this.scale),this.object.parent?this.object.hiddenMatrix.copy(this.object.parent.matrixWorld).invert():this.object.hiddenMatrix.identity();let E=(new zs).setFromQuaternion(this.quaternion,"YXZ"),O=E.y;this.objectRealQuat.copy(this.quaternion),E.y=0,this.quaternion.setFromEuler(E),this.objXZQuat.copy(this.quaternion),this.objXZQuatInv.copy(this.objXZQuat).invert(),this.objXZRotMat.makeRotationFromQuaternion(this.quaternion),E.set(0,O,0),this.quaternion.setFromEuler(E),this.rot.setFromEuler(E),this.euler.setFromQuaternion(this.quaternion,"YXZ"),this.velocityTarget.set(0,0,0),this.velocity.set(0,0,0)}else this.object instanceof YH?this.object.matrixAutoUpdate=!0:this.object.updateMatrix();this.cameraFollow===!0&&(this.camera.quaternion.copy(this.quat0Cam),this.camera.position.copy(this.position0Cam),this.camera.scale.copy(this.scale0Cam),this.camera.hiddenMatrix.copy(this.hiddenMatrix0Cam),this.camera.matrixAutoUpdate=!0),this.controlsManager.requestRender()}activate(){this.instantiateActions(),this.domElement.ownerDocument.addEventListener("pointerdown",this.onPointerDown),this.domElement.ownerDocument.addEventListener("keydown",this.onKeyDown),this.domElement.ownerDocument.addEventListener("keyup",this.onKeyUp),this.domElement.ownerDocument.addEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.addEventListener("pointerlockerror",this.onPointerlockError),this.domElement.ownerDocument.addEventListener("visibilitychange",this.handleVisibilityChange)}deactivate(){this.disposeActions(),this.domElement.ownerDocument.removeEventListener("pointerdown",this.onPointerDown),this.domElement.ownerDocument.removeEventListener("keydown",this.onKeyDown),this.domElement.ownerDocument.removeEventListener("keyup",this.onKeyUp),this.domElement.ownerDocument.removeEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.removeEventListener("pointerlockerror",this.onPointerlockError),this.domElement.ownerDocument.removeEventListener("visibilitychange",this.handleVisibilityChange)}dispose(){this.deactivate(),this.navMeshPathDest?.parent&&this.page.remove(this.navMeshPathDest)}instantiateActions(){let E=this.data,O=this.sharedAssets;E.gameActions!==void 0&&(this.actions={},KD.list.forEach((R=>{this.actions[R]=Ht({...E,disabled:!1,type:"GameControl"},E.gameActions[R],this.page,O,this.controlsManager.eventManager,this.object)}))),this.dispatchStopEvent("move"),this.dispatchStopEvent("run"),this.dispatchStopEvent("jump"),this.dispatchStartEvent("idle"),this.initialAction&&(this.initialAction=!1)}disposeActions(){this.initialAction=!1,this.dispatchStopEvent("idle"),this.dispatchStopEvent("move"),this.dispatchStopEvent("run"),this.dispatchStopEvent("jump"),dr(this.actions.idle),dr(this.actions.move),dr(this.actions.run),dr(this.actions.jump)}dispatchStartEvent(E){this.actions[E]!==void 0&&(this.actionState[E]||(this.actionState[E]=!0,this.actions[E].Transition.forEach((E=>{E.play()})),this.actions[E].Animation.forEach((E=>{E.play(this.initialAction===!1)})),this.actions[E].Create.forEach((E=>{E.dispatchStart()})),this.actions[E].Audio.forEach((E=>{E.dispatchGameControl("start")})),this.actions[E].Particles.forEach((E=>{E.dispatchGameControl("start")}))))}dispatchStopEvent(E){this.actions[E]!==void 0&&(!this.actionState[E]||(this.actionState[E]=!1,this.actions[E].Transition.forEach((E=>{E.stop(),E.object.currentState!==null&&E.object.changeSelectedState(null,{scene:this.page.scene,shared:this.sharedAssets})})),this.actions[E].Create.forEach((E=>{E.dispatchStop()})),this.actions[E].Audio.forEach((E=>{E.dispatchGameControl("stop")})),this.actions[E].Particles.forEach((E=>{E.dispatchGameControl("stop")}))))}get colliderWorldPosition(){return y2.copy(this.collider.position).applyQuaternion(this.objectRealQuat).add(this.position)}update(E,O,R){if(this.gravity<0?this.position.y<this.resetYPosition:this.position.y>this.resetYPosition)return this.reset(!0),!0;this.sharedGameControlGlobals.gamePads.forEach(this.copyVRGamePadValues);let z=(this.isFirstFrame?16.6:E)/1e3;this.isFirstFrame&&(this.isFirstFrame=!1);let V=z*60,j=!1;if(this.usePhysics&&this.collisionEnabled){let E=x2.set(0,(this.velocity.y===0?this.pixelsPerMeter*Math.max(Math.abs(this.gravity)/(10*L2),1)*(this.gravity>0?1:-1):this.velocity.y)*z,0).divideScalar(this.pixelsPerMeter),O=this.sharedGameControlGlobals.rapierWorld.castShape(this.colliderWorldPosition.divideScalar(this.pixelsPerMeter),this.colliderWorldQuat,E,this.object.rigidBody?.collider(0).shape,1,!1,16,void 0,void 0,this.object.rigidBody);if(O){this.onObject=!0,this.groundNormal.set(O.normal2.x,O.normal2.y,O.normal2.z).applyQuaternion(this.colliderWorldQuat).negate(),this.alignToGround&&this.groundTiltAdjustment(this.groundNormal),Math.acos(this.groundNormal.y)<this.slopeThresh&&(j=!0),O.collider.parent()?.bodyType()===0&&Math.acos(this.groundNormal.y)*(180/Math.PI)>45&&(this.onObject=!1);let E=O.collider.parent();this.groundYRotation=0,this.groundVelocity.set(0,0,0);for(let O of this.sharedGameControlGlobals.entitiesWithTransformAnim)if(O.rigidBody===E&&O.userData.isFollowingObj!==this.object.uuid){(O.hasNonUniformScale?O.matrixWorldRigid:O.matrixWorld).decompose(y2,M2,x2),this.groundVelocity.subVectors(y2,O.prevT),this.object.getWorldPosition(x2).add(this.collider.position).sub(y2),this.groundYRotation=E2.setFromQuaternion(M2).y-O.prevR.y,b2.copy(x2).applyAxisAngle(T2,this.groundYRotation),this.groundVelocity.add(b2.sub(x2)).divideScalar(z);break}}else this.onObject=!1}if(this.moveMode==="walk"&&this.collisionEnabled&&(this.movementState.jump===1&&this.onObject&&(this.velocityTarget.y=this.jumpPower,this.movementState.jump=0,this.dispatchStopEvent("idle"),this.dispatchStopEvent("move"),this.dispatchStopEvent("run"),this.dispatchStopEvent("jump"),this.dispatchStartEvent("jump"),this.onObject=!1),this.onObject?this.velocityTarget.y/=2:this.velocityTarget.y+=this.gravity*V),this.moveMode==="fly"&&(this.velocityTarget.y=(this.movementState.movePosY-this.movementState.moveNegY)*this.speedTranslate),this.directionXZ.z=this.movementState.movePosZ-this.movementState.moveNegZ,this.directionXZ.x=this.movementState.movePosX-this.movementState.moveNegX,this.forwardDir==="+z"&&this.directionXZ.multiplyScalar(-1),this.directionXZ.manhattanLength()>0&&(this.path=[]),this.navMeshPathDest){let E=this.navMeshPathDest.material;if(this.moveMode==="walk"&&this.path.length>1){this.navMeshPathDest.position.copy(this.path[this.path.length-1]),this.navMeshPathDest.parent||this.page.add(this.navMeshPathDest);let O=y2.subVectors(this.path[1],this.position),R=x2.subVectors(this.path[1],this.path[0]);O.dot(R)<0?this.path.shift():(this.directionXZ.x=R.x,this.directionXZ.z=R.z),E.opacity=E.userData.opacity0}else E.opacity-=.05*E.userData.opacity0,this.navMeshPathDest.material.opacity<=0&&this.navMeshPathDest.parent&&this.page.remove(this.navMeshPathDest)}this.directionXZ.normalize(),this.movementState.run?this.moveForce=this.runMultiplier:this.moveForce=1,this.velocityTarget.z=this.directionXZ.z*this.speedTranslate*this.moveForce,this.velocityTarget.x=this.directionXZ.x*this.speedTranslate*this.moveForce,(this.moveMode==="walk"?this.velocityTarget.x+this.velocityTarget.z===0:this.velocityTarget.manhattanLength()===0)?this.lerpFactorPos.setScalar(this.lerpFactorPosEnd):this.lerpFactorPos.setScalar(this.lerpFactorPosStart),this.moveMode==="walk"&&(this.lerpFactorPos.y=1),this.didHit===!1&&this.pushedVelocity.manhattanLength()===0||this.usePhysics===!1?(this.velocity.x+=(this.velocityTarget.x-this.velocity.x)*(1-(1-this.lerpFactorPos.x)**V),this.velocity.y+=(this.velocityTarget.y-this.velocity.y)*(1-(1-this.lerpFactorPos.y)**V),this.velocity.z+=(this.velocityTarget.z-this.velocity.z)*(1-(1-this.lerpFactorPos.z)**V)):this.velocity.copy(this.velocityTarget),(this.moveMode==="walk"?this.velocity.x**2+this.velocity.z**2<this.speedTranslate:this.velocity.lengthSq()<this.speedTranslate)?(this.dispatchStopEvent("move"),this.dispatchStopEvent("run"),this.onObject&&(this.dispatchStopEvent("jump"),this.dispatchStartEvent("idle"))):(this.dispatchStopEvent("idle"),this.onObject&&(this.dispatchStopEvent("jump"),this.movementState.run?(this.dispatchStopEvent("move"),this.dispatchStartEvent("run")):(this.dispatchStopEvent("run"),this.dispatchStartEvent("move"))));let Y=v2.copy(this.velocity);if(this.orientMode!=="none"&&this.isFirstPerson===!1){let E=x2.copy(Y);E.y=0,Y.set(0,Y.y,E.length()*(this.forwardDir==="+z"?1:-1))}if(this.directionXZ.manhattanLength()>0&&this.orientMode!=="none"&&this.isFirstPerson===!1)if(this.orientWith==="camera"&&this.path.length<=1){let E=y2;this.camera.getWorldDirection(E);let O=b2.copy(T2).multiplyScalar(E.dot(T2));E.sub(O);let R=x2.copy(this.directionXZ);R.x*=-1,this.rot.y=E.angleTo(R)*(E.cross(R).y>0?-1:1)+this.rotationAccumWhenOrientWithCamera}else this.rot.y=(this.path.length>1?0:this.euler.y)+Math.atan2(-this.directionXZ.z,this.directionXZ.x)+Math.PI/2*(this.forwardDir==="+z"?1:-1);if(E2.setFromVector3(this.rot),this.moveMode==="walk"&&(E2.x=0),Y.applyEuler(E2),j&&(M2.setFromUnitVectors(T2,this.groundNormal),Y.applyQuaternion(M2)),R){let E=E2.set(0,this.vrEulerYOffset*k2,0);R.applyEuler(E),Y.x+=R.x,Y.z+=R.z,this.nonColliderPosOffset.elements[13]+=R.y*z}if(this.usePhysics===!0){let E=x2;this.pushedVelocity.set(0,0,0);for(let O of this.sharedGameControlGlobals.entitiesWithTransformAnim){let R=b2.setFromMatrixPosition(O.matrixWorld).sub(O.prevT).divideScalar(z).divideScalar(this.pixelsPerMeter),V=O.rigidBody.collider(0).castCollider(R,this.object.rigidBody.collider(0),y2.copy(Y).divideScalar(this.pixelsPerMeter),z,!1);R.multiplyScalar(this.pixelsPerMeter);let j=oL.is(O)?O:O.object;if(V!==null&&this.lastHitObj!==j){let E;O instanceof HR&&(E=O);let R=this.sharedGameControlGlobals.entityToCollisionEvents[j.uuid];if(R)for(let O of R)O.data.target==="character"&&(O.dispatch(E),j.dispatchEvent(N6));this.lastHitObj=j}if(V!==null){this.pushedVelocity.copy(R),E.copy(V.normal1).applyQuaternion(O.quaternion);break}}if(this.pushedVelocity.manhattanLength()!==0){let O=E.dot(Y);O<0&&Y.addScaledVector(E,-O),Y.add(this.pushedVelocity)}else Y.add(this.groundVelocity)}if(this.rotDirection.y=Number(this.movementState.rotPosY)-Number(this.movementState.rotNegY),this.rotDirection.x=Number(this.movementState.rotPosX)-Number(this.movementState.rotNegX),this.rotDirection.normalize(),this.rotationMode==="normal"&&(this.movementState.rotPosX||this.movementState.rotNegX)||this.rotationMode==="steer"&&(this.movementState.rotPosX||this.movementState.rotNegX)&&(this.movementState.movePosZ||this.movementState.moveNegZ||this.moveMode==="walk")?this.rotVelocityStick.x=-this.rotDirection.x*this.speedOrbit*this.rotForce:this.rotVelocityStick.x=0,this.rotationMode==="normal"&&(this.movementState.rotPosY||this.movementState.rotNegY)||this.rotationMode==="steer"&&(this.movementState.rotPosY||this.movementState.rotNegY)&&(this.movementState.movePosZ||this.movementState.moveNegZ)?this.rotVelocityStick.y=-this.rotDirection.y*this.speedOrbit*this.rotForce:this.rotVelocityStick.y=0,this.rotVelocityTarget.subVectors(this.eulerDelta.divideScalar(z),this.rotVelocityStick),this.rotVelocityTarget.manhattanLength()===0?this.rotVelocity.lerp(this.rotVelocityTarget,1-(1-this.lerpFactorRotEnd)**V):this.rotVelocity.lerp(this.rotVelocityTarget,1-(1-this.lerpFactorRotStart)**V),this.euler.x+=this.rotVelocity.x*z,this.euler.y+=this.rotVelocity.y*z+this.groundYRotation,this.rotVelocityTarget.y===0&&this.directionXZ.manhattanLength()===0?this.rotationAccumWhenOrientWithCamera=0:(this.cameraFollow===!1||this.cameraYAxis==="Locked")&&(this.rotationAccumWhenOrientWithCamera+=this.rotVelocity.y*z),this.isFirstPerson===!1&&this.orientMode!=="none"&&this.directionXZ.manhattanLength()>0){if(this.orientMode==="radial"){this.objectToCamXZ.copy(this.objectToCamXZ0).applyAxisAngle(T2,this.euler.y-this.euler0.y);let E=x2.copy(this.objectToCamXZ).normalize(),O=b2.copy(Y).multiplyScalar(z);O.y=0;let R=O.sub(y2.copy(E).multiplyScalar(O.dot(E))).cross(E).y;this.euler.y-=Math.atan2(R,this.objectToCamXZ.length())}}else this.rot.y+=this.rotVelocity.y*z+this.groundYRotation,this.rotVelocityTarget.y!==0&&(this.cameraFollow===!1||this.cameraYAxis==="Locked")&&(this.euler.y=this.rot.y);if(this.cameraFollow===!0&&(this.moveMode==="walk"?this.cameraXAxis==="Limit"?this.euler.x=xn.clamp(this.euler.x,-this.maxPolarAngle+this.cameraPolarOffset+1e-6,-this.minPolarAngle+this.cameraPolarOffset-1e-6):this.euler.x=xn.clamp(this.euler.x,-this.PI_2+this.cameraPolarOffset,this.PI_2+this.cameraPolarOffset):this.cameraXAxis==="Limit"&&(this.euler.x=xn.clamp(this.euler.x,-this.PI_2,this.PI_2))),this.moveMode==="fly"?this.rot.x=this.euler.x:this.isFirstPerson&&(O?(E2.copy(O),E2.y=0):(E2.copy(this.euler),E2.y=0),this.nonColliderRotOffset.makeRotationFromEuler(E2)),O&&(this.moveMode==="walk"?(this.rot.y=O.y,this.rot.x=0,this.rot.z=0):this.rot.setFromEuler(O),this.rot.y+=this.vrEulerYOffset*k2),A2.setFromAxisAngle(C2,this.rot.x),M2.setFromAxisAngle(T2,this.rot.y),M2.multiply(A2),A2.setFromAxisAngle(P2,this.rot.z),M2.multiply(A2),this.quaternion.copy(M2),this.objectRealQuat.multiplyQuaternions(this.quaternion,this.objXZQuat),this.colliderWorldQuat.copy(this.objectRealQuat).multiply(this.collider.rotation),this.collisionEnabled)if(this.usePhysics){let E=x2.copy(Y).multiplyScalar(z/this.pixelsPerMeter),O=null;this.didHit=!1;let R=new Wn;for(let z=0;z<5;z++){let V=E.length(),j=b2.copy(E).normalize();if(O=this.sharedGameControlGlobals.rapierWorld.castShape(this.colliderWorldPosition.divideScalar(this.pixelsPerMeter).add(R),this.colliderWorldQuat,j,this.object.rigidBody?.collider(0).shape,V,!1,24,void 0,void 0,this.object.rigidBody),O===null){z===0&&this.directionXZ.manhattanLength()!==0&&(this.lastHitObj=null),R.add(E);break}{this.didHit=!0;let Y=this.sharedGameControlGlobals.colliderToEntity.get(O.collider.handle);if(Y!==this.lastHitObj&&z===0){this.lastHitObj=Y;let E=this.sharedGameControlGlobals.entityToCollisionEvents[Y?.uuid];if(E)for(let R of E)if(R.data.target==="character"){let E,z=(this.sharedGameControlGlobals.rapierWorld?.getCollider(O.collider.handle))._parent;if(Y.cloner)for(let O of Y.cloner.children)if(O.rigidBody===z){E=O;break}R.dispatch(E),Y.dispatchEvent(N6)}}let ee=m2.set(O.normal2.x,O.normal2.y,O.normal2.z).applyQuaternion(this.colliderWorldQuat),se=g2.copy(j).multiplyScalar(O.toi).dot(ee),he=O.toi;if(he===0&&(this.position.y+=this.offset*this.pixelsPerMeter),se>this.offset&&(he=O.toi*(se-this.offset)/se,R.addScaledVector(j,he)),E.copy(j).multiplyScalar(V-he),Math.acos(-ee.y)>this.slopeThresh){let z=this.colliderWorldPosition.divideScalar(this.pixelsPerMeter).add(R),V=b2.copy(O.witness2).applyQuaternion(this.colliderWorldQuat);V.y=0;let j=z.add(V);j.y+=this.stepThresh;let Y=this.sharedGameControlGlobals.rapierWorld.castShape(j,this.colliderWorldQuat,E,this.object.rigidBody?.collider(0).shape,1,!1,24,void 0,void 0,this.object.rigidBody);Y!==null&&Y.toi===0&&(ee.y=0,ee.normalize())}E.addScaledVector(ee,-E.dot(ee))}}this.position.addScaledVector(R,this.pixelsPerMeter),this.object.rigidBody?.setTranslation(y2.copy(this.position).divideScalar(this.pixelsPerMeter),!0),this.object.rigidBody?.setRotation(A2.copy(this.quaternion).premultiply(this.groundTilt).multiply(this.objXZQuat),!0)}else{let E=this.onObject?1:5,O=Y.multiplyScalar(z/E);for(let R=0;R<E;R++)this.position.add(O),this.collisionAdjustment(z/E)}else this.position.addScaledVector(Y,z);if(this.moveMode==="walk"&&this.onObject&&(this.velocityTarget.y=0,this.velocity.y=0),this.quaternion.premultiply(this.groundTilt).multiply(this.objXZQuat),this.object.matrix.compose(this.position,this.quaternion,this.scale),this.object.matrixWorldNeedsUpdate=!0,this.object.matrix.multiply(this.nonColliderPosOffset).multiply(this.nonColliderRotOffset),this.quaternion.premultiply(this.groundTiltInv).multiply(this.objXZQuatInv),this.cameraFollow===!0){this.updateFollowArms();let E=this.objectToTarget.add(this.position),O=this.targetToCamera.add(E);w2.lookAt(O,E,T2).setPosition(O),w2.decompose(this.targetPos,this.targetQuat,y2),this.camera.quaternion.slerp(this.targetQuat,1-(1-this.lerpFactorRotCamera)**V),this.camera.position.lerp(this.targetPos,1-(1-this.lerpFactorPosCamera)**V),this.camera.updateMatrix(),this.camera.updateMatrixWorld(),this.cameraYAxis==="Limit"&&this.orientMode==="cartesian"&&(this.euler.y=xn.clamp(this.euler.y,this.minAzimuthAngleRel,this.maxAzimuthAngleRel)),this.euler.x=xn.clamp(this.euler.x,-this.PI_2+(this.cameraPolarOffset<0?this.cameraPolarOffset:0),this.PI_2+(this.cameraPolarOffset>0?this.cameraPolarOffset:0))}return this.eulerDelta.set(0,0,0),this.object.dispatchEvent(U2),(!(this.path.length<2&&this.lastPosition.distanceToSquared(this.position)<this.threshEndTranslate&&Math.abs(this.rotVelocity.x)<this.threshEndRotVel&&Math.abs(this.rotVelocity.y)<this.threshEndRotVel&&(this.camera===void 0||this.isFirstPerson||this.lastCameraPosition.distanceToSquared(this.camera.position)<this.threshEndTranslate&&8*(1-this.lastCameraQuaternion.dot(this.camera.quaternion))<this.threshEndRotate))||this.moveMode!=="fly"&&this.onObject!==!0&&this.collisionEnabled!==!1||!(this.navMeshPathDest===null||this.navMeshPathDest.material.opacity<-.04*this.navMeshPathDest?.material?.userData.opacity0))&&(this.camera&&(this.lastCameraPosition.copy(this.camera.position),this.lastCameraQuaternion.copy(this.camera.quaternion)),this.lastPosition.copy(this.position),this.object.dispatchEvent(N2),!0)}updateFollowArms(){this.objectToTarget.copy(this.objectToTarget0),this.targetToCamera.copy(this.targetToCamera0);let E=A2.setFromAxisAngle(T2,this.cameraYAxis==="Limit"&&this.orientMode!=="radial"?xn.clamp(this.euler.y-this.euler0.y,this.minAzimuthAngleRel,this.maxAzimuthAngleRel):this.euler.y-this.euler0.y);(this.cameraYAxis!=="Locked"||this.orientMode==="radial")&&this.objectToTarget.applyQuaternion(E);let O;O=this.cameraXAxis==="Limit"?xn.clamp(this.euler.x,-this.maxPolarAngle+this.cameraPolarOffset+1e-6,-this.minPolarAngle+this.cameraPolarOffset-1e-6):xn.clamp(this.euler.x,-this.PI_2+this.cameraPolarOffset+1e-6,this.PI_2+this.cameraPolarOffset-1e-6);let R=y2.copy(this.cameraPolarAxis0);(this.cameraYAxis!=="Locked"||this.orientMode==="radial")&&R.applyQuaternion(E);let z=M2.setFromAxisAngle(R,O);this.cameraYAxis!=="Locked"&&this.targetToCamera.applyQuaternion(E),this.cameraXAxis!=="Locked"&&this.targetToCamera.applyQuaternion(z)}groundTiltAdjustment(E){T2.angleTo(E)*180/Math.PI<15||T2.angleTo(E)*180/Math.PI>85?A2.identity():A2.setFromUnitVectors(T2,E),this.groundTilt.slerp(A2,.06),this.groundTiltInv.copy(this.groundTilt).invert()}collisionAdjustment(E){let O=g2.set(0,0,0);this.object.matrix.compose(this.position,this.quaternion,this.scale);let R=w2.multiplyMatrices(this.object.matrix,this.objXZRotMat).multiply(this.collider.matrix).decompose(y2,A2,x2).compose(y2,A2,D2);this.sharedGameControlGlobals.entitiesWithTransformAnim.forEach((E=>{if(E===this.object||E.isDescendantOf(this.object))return;F2.makeEmpty(),E.updateMatrixWorldSVD();let z=E.matrixWorldRigid,V=S2.copy(z).invert(),j=_2.copy(S2).multiply(R);z2.copy(this.collider.segment),z2.start.applyMatrix4(j),z2.end.applyMatrix4(j);let Y=m2.copy(this.position).applyMatrix4(V);F2.expandByPoint(z2.start),F2.expandByPoint(z2.end),F2.min.addScalar(-this.collider.radius),F2.max.addScalar(this.collider.radius),E.bvhGeometry.boundsTree.shapecast({traverseBoundsOrder(E){return E.distanceToPoint(z2.end)},intersectsBounds:E=>E.intersectsBox(F2),intersectsTriangle:E=>{let R=y2,V=x2,j=E.closestPointToSegment(z2,R,V);if(j<this.collider.radius){let E=this.collider.radius-j,ee=V.sub(R).normalize(),se=b2.copy(Y);se.addScaledVector(ee,E);let he=se.applyMatrix4(z).sub(this.position);O.add(he),z2.start.addScaledVector(ee,E),z2.end.addScaledVector(ee,E)}}})})),F2.makeEmpty(),z2.copy(this.collider.segment),z2.start.applyMatrix4(R),z2.end.applyMatrix4(R),F2.expandByPoint(z2.start),F2.expandByPoint(z2.end),F2.min.addScalar(-this.collider.radius),F2.max.addScalar(this.collider.radius),this.sharedGameControlGlobals.staticMeshBVH?.shapecast({traverseBoundsOrder(E){return E.distanceToPoint(z2.end)},intersectsBounds:E=>E.intersectsBox(F2),intersectsTriangle:E=>{let R=y2,z=x2,V=E.closestPointToSegment(z2,R,z);if(V<this.collider.radius){let E=this.collider.radius-V,j=z.sub(R).normalize();this.alignToGround&&this.groundTiltAdjustment(j),O.addScaledVector(j,E),z2.start.addScaledVector(j,E),z2.end.addScaledVector(j,E)}}}),this.onObject=Math.abs(O.y)>Math.abs(E*this.velocity.y*.25),this.onObject&&this.dispatchStopEvent("jump");let z=Math.max(0,O.length()-1e-5);O.normalize().multiplyScalar(z),this.position.add(O)}},j2=V2;j2.isLocked=!1;var G2=Za(ee());function tM(E){let O=E.elements,R=O[0]**2+O[1]**2+O[2]**2,z=O[4]**2+O[5]**2+O[6]**2,V=O[8]**2+O[9]**2+O[10]**2,j=O[0]**2+O[4]**2+O[8]**2,Y=O[1]**2+O[5]**2+O[9]**2,ee=O[2]**2+O[6]**2+O[10]**2,se=1e-8;return R<se||z<se||V<se||j<se||Y<se||ee<se}function oo(E,O){let R=new Na;if(O&&tM(O))return R.setAttribute("position",new Ma([],3)),R.setIndex([]),R;if(!E.getAttribute("position"))return R.setAttribute("position",new Ma([],3)),R.setIndex([]),R;let{positions:z,triIndices:V}=Kc(E.getAttribute("position"),E.getIndex());return R.setAttribute("position",new Ma(z,3)),R.setIndex(V),O&&R.applyMatrix4(O),R}var H2=new Es,W2=new Es,q2=[[0,0,0],[0,0,0],[0,0,0]];function rM(E){let O=E.elements;q2[0][0]=O[0],q2[0][1]=O[4],q2[0][2]=O[8],q2[1][0]=O[1],q2[1][1]=O[5],q2[1][2]=O[9],q2[2][0]=O[2],q2[2][1]=O[6],q2[2][2]=O[10];let{u:R,v:z}=(0,G2.SVD)(q2),V=H2.set(R[0][0],R[0][1],R[0][2],0,R[1][0],R[1][1],R[1][2],0,R[2][0],R[2][1],R[2][2],0,0,0,0,1),j=W2.set(z[0][0],z[0][1],z[0][2],0,z[1][0],z[1][1],z[1][2],0,z[2][0],z[2][1],z[2][2],0,0,0,0,1);return V.multiply(j.transpose())}var X2=class extends Af{constructor(){super(),this.layers.enable(3),this.layers.enable(8),this.layers.enable(9)}setFromCamera(E,O){O.isOrthographicCamera?(this.ray.origin.set(E.x,E.y,-1).unproject(O),this.ray.direction.set(0,0,-1).transformDirection(O.matrixWorld),this.camera=O):O.isPerspectiveCamera?(this.ray.origin.set(E.x,E.y,-1).unproject(O),this.ray.direction.set(E.x,E.y,.5).unproject(O).sub(this.ray.origin).normalize(),this.camera=O):console.error("Raycaster: Unsupported camera type.")}intersectVisibleObjects(E,O=!0,R=[]){return E.forEach((E=>{E.visible&&this.intersectObject(E,O,R)})),R}createRaycastLineHelper(){let E=new cu({color:65280,linewidth:10}),O=new Wn(this.ray.origin.x,this.ray.origin.y,this.ray.origin.z),R=new Wn(this.ray.direction.x,this.ray.direction.y,this.ray.direction.z),z=this.camera.far-this.camera.near,V=(new Wn).addVectors(O,R.multiplyScalar(z)),j=new Na;return j.setFromPoints([O,V]),new gu(j,E)}};var XN=E=>E instanceof wW||E instanceof v$;function a$(E,O){return E.distance-O.distance}function YN(E,O,R){if(!(!Bo(O)||!O.visible)){un(O)&&O.raycast(E,R);for(let z of O.children)YN(E,z,R)}}function Hf(E,O,R,z=!1){if(!z&&!R.some((O=>Wf(E,O)!==void 0)))return[];let V=[];return O.children.forEach((O=>YN(E,O,V))),V.sort(a$),V}function Sg(E){let O=[];if(E.length){let R=E[0].object;Bo(R)&&O.push(R);let z=R.parent;for(;z;)XN(z)&&O.push(z),z=z.parent}return O}function ao(E,O,R,z){let V=E.frame;if(V){let E=O[0]*V.width,j=(1-O[1])*V.height;for(let O of R){let R=O===V.uuid?V:V.find(O);if(R?.intersects(E,j))return z(R),!0}}return!1}function Wf(E,O){if(un(O)){if(O.visible){let R=[];return O.raycast(E,R),R.length?R[0]:void 0}}else if(XN(O))return KN(E,O)}function KN(E,O){if(!(!Bo(O)||!O.visible)){if(un(O)){let R=[];if(O.raycast(E,R),R.length)return R[0]}for(let R of O.children){let O=KN(E,R);if(O)return O}}}function l$(E,O,R){return{x:(E-(R.left+window.scrollX))/R.width*2-1,y:-(O-(R.top+window.scrollY))/R.height*2+1}}function c$(E,O,R){return{x:(E-(R.left+window.scrollX))/R.width,y:1-(O-(R.top+window.scrollY))/R.height}}var Y2=class{constructor(E,O,R,z,V,j,Y,ee){this.renderer=E;this.publish=O;this.scene=R;this.getCamera=z;this.sharedAssets=V;this.requestRender=j;this.isExport=Y;this.frame=ee;this.raycaster=new X2;this._useWindowEvents=!1;this.pointerWorld={x:0,y:0};this.pointerScreen={x:0,y:0};this._useWindowEvents=O.mouseEventTarget==="window",this.domElement=E.domElement,this.eventElement=this._useWindowEvents?window:E.domElement,this._domRect=this.domElement.getBoundingClientRect()}get stopRaycast(){return this.publish.stopRaycast}get page(){return this.scene.activePage}set useWindowEvents(E){this._useWindowEvents=E,this.eventElement=E?window:this.renderer.domElement}get useWindowEvents(){return this._useWindowEvents}set domRect(E){this._domRect=E}get domRect(){return this._domRect}updateRaycaster(E){let{pageX:O,pageY:R}=E.touches?.length>0?E.touches[0]:E;this.pointerWorld=l$(O,R,this._domRect),this.pointerScreen=c$(O,R,this._domRect),this.raycaster.setFromCamera(this.pointerWorld,this.getCamera())}};var Z2=class{constructor(E){this.eventContext=E;this.domEventsNeeded=new Set;this.hasVideoAction=!1}connect(){}disconnect(){}};var K2=[["start","Start"],["keyDown","KeyDown"],["keyUp","KeyUp"],["mouseDown","MouseDown"],["mouseUp","MouseUp"],["mouseHover","MouseHover"],["collision","Collision"],["lookAt","LookAt"],["follow","Follow"],["scroll","Scroll"]],QN=E=>K2.find((([O,R])=>R===E))?.[0],ta=E=>K2.find((([O])=>O===E))?.[1],u$=(E,O)=>{let R=QN(E);if(R){let E=new CustomEvent(R,{bubbles:!0});return Object.defineProperty(E,"target",{writable:!1,value:O}),E}},J2=class extends Z2{constructor(){super(...arguments);this.objectsPerEvents=new Map;this.splineEvents={};this.onBeginEvent=E=>{if(!E.eventName||!E.target||E.eventName==="Scroll")return;let O=this.splineEvents[QN(E.eventName)]?.[E.target.uuid];if(!O)return;E.eventName==="Scroll"&&E.deltaY!==void 0&&Object.assign(O,{deltaY:E.deltaY});let{domElement:R}=this.eventContext;R.dispatchEvent(O)}}connect(){let{page:E}=this.eventContext;E.traverseEntity((E=>{if(!!E.data?.events.length)for(let[O,R]of K2)if(E.data.events.some((E=>E.data.type===R&&!E.data.disabled))){this.objectsPerEvents.has(O)?this.objectsPerEvents.get(O)?.push(E):this.objectsPerEvents.set(O,[E]);let z={id:E.uuid,name:E.name},V=u$(R,z),j=this.splineEvents[O];j?j[E.uuid]=V:this.splineEvents[O]={[E.uuid]:V}}})),this.objectsPerEvents.forEach((E=>{E.forEach((E=>{E.addEventListener("beginEvent",this.onBeginEvent)}))}))}disconnect(){this.objectsPerEvents.forEach((E=>{E.forEach((E=>{E.removeEventListener("beginEvent",this.onBeginEvent)}))}))}};var $2=class{constructor(E,O,R,z,V,j){this.id=E;this.data=O;this.object=R;this.entered=!1;if((O.type==="KeyDown"||O.type==="KeyUp"||O.type==="KeyPress")&&!O.key)throw new Error("Missing property");this.actions=Ht(O,O.actions,z,V,j,R)}disconnect(){dr(this.actions)}dispatchHeld(E){this.actions.Create.forEach((O=>{E&&O.dispatchThrottled.cancel(),O.dispatchThrottled()}))}dispatch(E=!1){this.actions.Transition.forEach((E=>{E.object.currentTransitionEvent!==this&&(E.object.currentTransitionEvent=this,E.init())})),this.data.type==="MousePress"||this.data.type==="KeyPress"?this.entered||(this.entered=!0,this.actions.Transition.forEach((E=>E.playFromCurrent())),this.actions.Animation.forEach((E=>E.playFromCurrent())),this.actions.SwitchCamera.forEach((E=>E.playFromCurrent())),this.actions.Create.forEach((E=>E.dispatchStart()))):(this.actions.Transition.some((E=>E.playing&&E.data.runMode!=="Toggle"))||this.actions.Transition.forEach((E=>{E.data.runMode==="Toggle"?E.toggle():E.play()})),this.actions.SwitchCamera.some((E=>E.playing&&E.data.runMode!=="Toggle"))||this.actions.SwitchCamera.forEach((E=>{E.data.runMode==="Toggle"?E.toggle():E.play()})),this.actions.Animation.forEach((E=>{E.data.runMode==="Toggle"?E.toggle():E.play()}))),this.actions.Link.forEach((E=>{E.dispatch()})),this.actions.SceneTransition.forEach((E=>{E.dispatch()})),E===!1&&this.actions.Create.forEach((E=>{E.dispatch()})),this.actions.Destroy.forEach((E=>{E.dispatch()})),this.actions.Reset.forEach((E=>{E.dispatch()})),this.actions.Audio.forEach((E=>{E.dispatchBasic()})),this.actions.Video.forEach((E=>{E.dispatchBasic()})),this.actions.Particles.forEach((E=>{E.dispatchBasic()})),this.actions.SetVariable.forEach((E=>E.checkConditions())),this.actions.SetVariable.forEach((E=>E.dispatch())),this.actions.DynamicVariablePlay.forEach((E=>E.dispatch())),this.actions.ClearLocalStorage.forEach((E=>E.dispatch())),this.actions.UserAPI.forEach((E=>E.dispatch()))}dispatchRelease(){this.entered&&(this.entered=!1,this.actions.Transition.forEach((E=>E.reverseFromCurrent())),this.actions.Particles.forEach((E=>E.reverseFromCurrent())),this.actions.Animation.forEach((E=>E.reverseFromCurrent())),this.actions.SwitchCamera.forEach((E=>E.reverseFromCurrent())),this.actions.Create.forEach((E=>E.dispatchStop())))}dispatchUserEvent(E){this.actions.Transition.forEach((E=>{E.object.currentTransitionEvent!==this&&(E.object.currentTransitionEvent=this,E.init())})),E?(this.actions.Transition.forEach((E=>E.reverseFromCurrent())),this.actions.Animation.forEach((E=>E.reverseFromCurrent())),this.actions.SwitchCamera.forEach((E=>E.reverseFromCurrent()))):(this.actions.Transition.forEach((E=>E.playFromCurrent())),this.actions.Animation.forEach((E=>E.playFromCurrent())),this.actions.SwitchCamera.forEach((E=>E.playFromCurrent()))),this.actions.Link.forEach((E=>{E.dispatch()})),this.actions.SceneTransition.forEach((E=>{E.dispatch()})),this.actions.Create.forEach((E=>{E.dispatch()})),this.actions.Destroy.forEach((E=>{E.dispatch()})),this.actions.Reset.forEach((E=>{E.dispatch()})),this.actions.Audio.forEach((E=>{E.dispatchBasic()})),this.actions.Video.forEach((E=>{E.dispatchBasic()})),this.actions.Particles.forEach((E=>{E.dispatchBasic()})),this.actions.SetVariable.forEach((E=>E.checkConditions())),this.actions.SetVariable.forEach((E=>E.dispatch())),this.actions.DynamicVariablePlay.forEach((E=>E.dispatch())),this.actions.ClearLocalStorage.forEach((E=>E.dispatch())),this.actions.UserAPI.forEach((E=>E.dispatch()))}},t3=class extends Z2{constructor(E,O,R){super(E);this.eventManager=O;this.useForRaycastProperty=R;this.objectsPerTypes={MouseDown:[],MouseUp:[],MousePress:[],KeyDown:[],KeyUp:[],KeyPress:[]};this.canvasMouseEvents=[];this.eventsPerObjects={MouseDown:{},MouseUp:{},MousePress:{},KeyDown:{},KeyUp:{},KeyPress:{}};this.heldKeys={};this.heldKeysPress={};this._prevObjects=[];this.sceneInterects=null;this.onCanvasRaycast=E=>{if(this.useForRaycastProperty===!0&&this.sceneInterects===null){this.eventContext.updateRaycaster(E);let{raycaster:O,page:R}=this.eventContext,z=Hf(O,R,[],!0);this.sceneInterects=z,z.length&&(this.eventContext.sharedAssets.raycastProperty={x:z[0].point.x,y:z[0].point.y,z:z[0].point.z,objX:z[0].object.matrixWorld.elements[12],objY:z[0].object.matrixWorld.elements[13],objZ:z[0].object.matrixWorld.elements[14]})}};this.onCanvasMouseDown=E=>{(E.target===this.eventContext.domElement||E.target.tagName==="SPLINE-VIEWER")&&this.canvasMouseEvents.forEach((O=>{(O.data.type==="MouseDown"||O.data.type==="MousePress")&&(this.onCanvasRaycast(E),O.dispatch())}))};this.onCanvasMouseUp=E=>{(E.target===this.eventContext.domElement||E.target.tagName==="SPLINE-VIEWER")&&this.canvasMouseEvents.forEach((O=>{O.data.type==="MouseUp"?(this.onCanvasRaycast(E),O.dispatch()):O.data.type==="MousePress"&&O.dispatchRelease()}))};this.onMouseDown=E=>{TM.length>1||(this.eventContext.updateRaycaster(E),this.handleMouseEvent("MouseDown"))};this.onMouseUp=E=>{TM.length>1||(this.eventContext.updateRaycaster(E),this.handleMouseEvent("MouseUp"))};this.onMousePressDown=E=>{TM.length>1||(this.eventContext.updateRaycaster(E),this.handleMousePressEvent())};this.onMousePressRelease=E=>{TM.length>1||(this.eventContext.updateRaycaster(E),this.handleMousePressEvent(!0))};this.onKeyDown=E=>{this.heldKeys[E.key]||(this.handleKeyEvent(E,"KeyDown"),this.handleKeyEventHeld(E,"KeyDown",!0)),this.heldKeys[E.key]=!0};this.onKeyUp=E=>{this.handleKeyEvent(E,"KeyUp"),this.handleKeyEventHeld(E,"KeyUp",!0)};this.onKeyPressDown=E=>{this.heldKeysPress[E.key]?this.handleKeyEventHeld(E,"KeyPress"):(this.handleKeyEvent(E,"KeyPress"),this.handleKeyEventHeld(E,"KeyPress",!0)),this.heldKeysPress[E.key]=!0};this.onKeyPressUp=E=>{this.handleKeyEvent(E,"KeyPress",!0)};this.releaseHeldKey=E=>{delete this.heldKeys[E.key]};this.releaseHeldKeyPress=E=>{delete this.heldKeysPress[E.key]};this._onUserEvent=({eventName:E,target:O,reverse:R})=>{if(!E||!O)return;let z=ta(E);z&&(z==="MouseDown"||z==="MouseUp"||z==="MousePress"?(O.dispatchEvent({type:"beginEvent",eventName:z}),this.eventsPerObjects[z]?.[O.uuid]?.forEach((E=>{E.dispatchUserEvent(R)}))):(z==="KeyDown"||z==="KeyUp"||z==="KeyPress")&&(O.dispatchEvent({type:"beginEvent",eventName:z}),this.eventsPerObjects[z]?.[O.uuid]?.forEach((E=>{E.dispatchUserEvent()}))))}}connect(){let{page:E,sharedAssets:O,domElement:R}=this.eventContext,s=(R,z)=>{if(!R.data?.events.length)return;let V=["MouseDown","MouseUp","MousePress","KeyDown","KeyUp","KeyPress"];for(let j of V){let V=this.eventsPerObjects[j];if(R.data.events.filter((({data:E})=>E.type===j&&E.disabled!==!0)).forEach((({id:z,data:j})=>{try{let Y=new $2(z,j,R,E,O,this.eventManager);Y.actions.Video.length&&(this.hasVideoAction=!0),j.type!=="MouseDown"&&j.type!=="MouseUp"&&j.type!=="MousePress"||j.mode!=="Canvas"&&j.mode!=="Window"?(V[R.uuid]?V[R.uuid].some((E=>E.id===Y.id))||V[R.uuid].push(Y):V[R.uuid]=[Y],R instanceof l0&&R.traverseChildren((E=>{if(!E.visible)return!0;E instanceof _j&&E.data.geometry.shapeBlendNode?.operation!==2&&(V[E.uuid]?V[E.uuid].push(Y):V[E.uuid]=[Y])}))):this.canvasMouseEvents.push(Y)}catch(E){!1}})),V[R.uuid]?.length&&(this.objectsPerTypes[j].push(R instanceof IK&&(j==="MouseDown"||j==="MouseUp"||j==="MousePress")?z:R),R instanceof l0)){let E=this.objectsPerTypes[j];R.traverseChildren((O=>{if(!O.visible)return!0;O instanceof _j&&E.indexOf(O)===-1&&E.push(O)}))}}};E.traverseEntity((E=>{(E instanceof x$||E instanceof d$)&&E.frame?.traverse((O=>{s(O,E)})),s(E)})),this.heldKeys={},this.heldKeysPress={},this.domEventsNeeded.clear(),R.addEventListener("pointerdown",this.onCanvasMouseDown),R.addEventListener("pointerup",this.onCanvasMouseUp),(this.objectsPerTypes.MouseDown?.length||this.useForRaycastProperty)&&(this.domEventsNeeded.add("pointerdown"),R.addEventListener("pointerdown",this.onMouseDown)),this.objectsPerTypes.MouseUp?.length&&(this.domEventsNeeded.add("pointerup"),R.addEventListener("pointerup",this.onMouseUp)),this.objectsPerTypes.MousePress?.length&&(this.domEventsNeeded.add("pointerdown"),R.addEventListener("pointerdown",this.onMousePressDown),this.domEventsNeeded.add("pointerup"),R.addEventListener("pointerup",this.onMousePressRelease)),this.objectsPerTypes.KeyDown?.length&&(this.domEventsNeeded.add("keydown"),document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keyup",this.releaseHeldKey)),this.objectsPerTypes.KeyUp?.length&&(this.domEventsNeeded.add("keyup"),document.addEventListener("keyup",this.onKeyUp)),this.objectsPerTypes.KeyPress?.length&&(this.domEventsNeeded.add("keydown"),document.addEventListener("keydown",this.onKeyPressDown),document.addEventListener("keyup",this.releaseHeldKeyPress),this.domEventsNeeded.add("keyup"),document.addEventListener("keyup",this.onKeyPressUp)),Object.entries(this.objectsPerTypes).forEach((([E,O])=>{O.forEach((E=>{E.addEventListener("userEvent",this._onUserEvent)}))}))}disconnect(){let{domElement:E}=this.eventContext;this.domEventsNeeded.clear(),this.heldKeys={},this.heldKeysPress={},E.removeEventListener("pointerdown",this.onCanvasMouseDown),E.removeEventListener("pointerup",this.onCanvasMouseUp),E.removeEventListener("pointerdown",this.onMouseDown),E.removeEventListener("pointerdown",this.onMousePressDown),E.removeEventListener("pointerup",this.onMouseUp),E.removeEventListener("pointerup",this.onMousePressRelease),document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keyup",this.onKeyUp),document.removeEventListener("keydown",this.onKeyPressDown),document.removeEventListener("keyup",this.onKeyPressUp),document.removeEventListener("keyup",this.releaseHeldKey),Object.values(this.eventsPerObjects).forEach((E=>{Object.values(E).forEach((E=>{E.forEach((E=>{E.disconnect()}))}))})),this.canvasMouseEvents.forEach((E=>{E.disconnect()})),Object.entries(this.objectsPerTypes).forEach((([E,O])=>{O.forEach((E=>{E.removeEventListener("userEvent",this._onUserEvent)}))}))}handleMouseEvent(E){let{stopRaycast:O,raycaster:R,page:z,pointerScreen:V}=this.eventContext,j=this.objectsPerTypes[E],Y=j.filter((E=>!(E instanceof IK)));if(!(!j.length&&!this.useForRaycastProperty)&&!(z.uiCanvas&&ao(z,[V.x,V.y],Object.keys(this.eventsPerObjects[E]),(O=>{this.handleObjectMouseEventDispatch(O,E)})))){if(O||this.useForRaycastProperty){let V;if(this.sceneInterects===null?V=Hf(R,z,Y,this.useForRaycastProperty):(V=this.sceneInterects,this.sceneInterects=null),this.useForRaycastProperty&&V.length&&(this.eventContext.sharedAssets.raycastProperty={x:V[0].point.x,y:V[0].point.y,z:V[0].point.z,objX:V[0].object.matrixWorld.elements[12],objY:V[0].object.matrixWorld.elements[13],objZ:V[0].object.matrixWorld.elements[14]}),O){let O=[V[0]?.uv?.x??0,V[0]?.uv?.y??0];Sg(V).forEach((R=>{R instanceof x$&&ao(R,O,Object.keys(this.eventsPerObjects[E]),(O=>{this.handleObjectMouseEventDispatch(O,E)})),this.eventsPerObjects[E][R.uuid]&&this.handleObjectMouseEventDispatch(R,E)}))}}O||Y.forEach((O=>{let z=Wf(R,O);z&&(this.handleObjectMouseEventDispatch(O,E),O instanceof x$&&ao(O,[z?.uv?.x??0,z?.uv?.y??0],Object.keys(this.eventsPerObjects[E]),(O=>{this.handleObjectMouseEventDispatch(O,E)})))}))}}handleMousePressEvent(E=!1){let O="MousePress",R=this.objectsPerTypes[O],z=R.filter((E=>!(E instanceof IK))),V=[];if(!!R.length){if(!E){let{stopRaycast:E,raycaster:R,page:j,pointerScreen:Y}=this.eventContext,ee=!1;if(j.uiCanvas&&(ee=ao(j,[Y.x,Y.y],Object.keys(this.eventsPerObjects[O]),(E=>{V.push(E)}))),E&&!ee){let E=Hf(R,j,z);V=Sg(E),E.forEach((E=>{E.object instanceof x$&&ao(E.object,[E?.uv?.x??0,E?.uv?.y??0],Object.keys(this.eventsPerObjects[O]),(E=>{V.push(E)}))}))}else z.forEach((E=>{let z=Wf(R,E);z&&(V.push(E),E instanceof x$&&ao(E,[z?.uv?.x??0,z?.uv?.y??0],Object.keys(this.eventsPerObjects[O]),(E=>{V.push(E)})))}))}this._prevObjects.length&&this._prevObjects.forEach((E=>{V.includes(E)||this.handleObjectMouseEventDispatchRelease(E,O)})),V.length&&V.forEach((E=>{this.handleObjectMouseEventDispatch(E,O)})),this._prevObjects=V}}handleObjectMouseEventDispatch(E,O){E.dispatchEvent({type:"beginEvent",eventName:O}),this.eventsPerObjects[O]?.[E.uuid]?.forEach((E=>{E.dispatch()}))}handleObjectMouseEventDispatchRelease(E,O){E.dispatchEvent({type:"beginEvent",eventName:O}),this.eventsPerObjects[O]?.[E.uuid]?.forEach((E=>{E.dispatchRelease()}))}handleKeyEvent(E,O,R=!1){this.objectsPerTypes[O].forEach((z=>{let V=this.eventsPerObjects[O][z.uuid];V.some((({data:O})=>"key"in O&&O.key===E.key))&&z.dispatchEvent({type:"beginEvent",eventName:O}),V.forEach((O=>{"key"in O.data&&O.data.key===E.key&&(R?O.dispatchRelease():O.dispatch(!0))}))}))}handleKeyEventHeld(E,O,R=!1){this.objectsPerTypes[O].forEach((z=>{this.eventsPerObjects[O][z.uuid].forEach((O=>{"key"in O.data&&O.data.key===E.key&&O.dispatchHeld(R)}))}))}};var i3=new Wn,r3=new Wn;var s3=class{constructor(E,O,R,z,V){this.actionsIn=Ht(E,E.inActions,R,z,V,O),this.actionsOut=Ht(E,E.outActions,R,z,V,O)}disconnect(){dr(this.actionsIn),dr(this.actionsOut)}};var a3=class extends s3{constructor(E,O,R,z,V,j){super(O,R,z,V,j);this.id=E;this.data=O;this.object=R;this.stage="out";this.objects=[];this.onUpdateMatrixWorld=()=>{for(let E of this.objects)if(!E.visible)return;let E=i3.setFromMatrixPosition(this.objects[0].matrixWorld),O=r3.setFromMatrixPosition(this.objects[1].matrixWorld),R=E.distanceTo(O)<=this.distance?"in":"out";if(this.stage!==R){this.stage=R;let E=R==="in"?this.actionsIn:this.actionsOut;E.Audio.forEach((E=>E.dispatchConditional())),E.Particles.forEach((E=>E.dispatchConditional())),E.Video.forEach((E=>E.dispatchConditional())),E.Link.forEach((E=>E.dispatch())),E.Create.forEach((E=>E.dispatch())),E.Destroy.forEach((E=>E.dispatch())),E.Reset.forEach((E=>E.dispatch())),E.Transition.forEach((E=>{E.object.currentTransitionEvent!==this&&(E.object.currentTransitionEvent=this),E.init()})),E.Transition.forEach((E=>E.play())),E.Animation.forEach((E=>E.play())),E.SwitchCamera.forEach((E=>E.play())),E.SceneTransition.forEach((E=>E.dispatch())),E.SetVariable.forEach((E=>E.checkConditions())),E.SetVariable.forEach((E=>E.dispatch())),E.DynamicVariablePlay.forEach((E=>E.dispatch())),E.ClearLocalStorage.forEach((E=>E.dispatch())),E.UserAPI.forEach((E=>E.dispatch()))}};let{distance:Y,fromObject:ee,toObject:se}=O.condition;this.distance=Y;for(let E of[ee,se]){if(!E)throw new Error("Missing property");let O=z.find(E);if(!O)throw new Error("Missing property");this.objects.push(O)}}connect(){window.setTimeout((()=>{this.objects.forEach((E=>{E.addEventListener("updateMatrixWorld",this.onUpdateMatrixWorld)})),this.onUpdateMatrixWorld()}),0)}disconnect(){super.disconnect(),this.stage="out",this.objects.forEach((E=>{E.removeEventListener("updateMatrixWorld",this.onUpdateMatrixWorld)}))}},l3=class extends s3{constructor(E,O,R,z,V,j){super(O,R,z,V,j);this.id=E;this.data=O;this.object=R;this.onBegin=({target:E,state:O})=>{this.toState!==O&&(this.actionsOut.Audio.forEach((E=>E.dispatchConditional())),this.actionsOut.Particles.forEach((E=>E.dispatchConditional())),this.actionsOut.Video.forEach((E=>E.dispatchConditional())),this.actionsOut.Link.forEach((E=>E.dispatch())),this.actionsOut.Create.forEach((E=>E.dispatch())),this.actionsOut.Destroy.forEach((E=>E.dispatch())),this.actionsOut.Reset.forEach((E=>E.dispatch())),this.actionsIn.Transition.forEach((E=>E.pause())),this.object.currentTransitionEvent=this,this.actionsOut.Transition.forEach((E=>E.play())),this.actionsOut.Animation.forEach((E=>E.play())),this.actionsIn.SwitchCamera.forEach((E=>E.pause())),this.actionsOut.SwitchCamera.forEach((E=>E.play())),this.actionsOut.SceneTransition.forEach((E=>E.dispatch())),this.actionsOut.SetVariable.forEach((E=>E.checkConditions())),this.actionsOut.SetVariable.forEach((E=>E.dispatch())),this.actionsOut.DynamicVariablePlay.forEach((E=>E.dispatch())),this.actionsOut.ClearLocalStorage.forEach((E=>E.dispatch())),this.actionsOut.UserAPI.forEach((E=>E.dispatch())))};this.onComplete=({target:E,state:O})=>{this.toState===O&&(this.actionsIn.Audio.forEach((E=>E.dispatchConditional())),this.actionsIn.Particles.forEach((E=>E.dispatchConditional())),this.actionsIn.Video.forEach((E=>E.dispatchConditional())),this.actionsIn.Link.forEach((E=>E.dispatch())),this.actionsIn.Create.forEach((E=>E.dispatch())),this.actionsIn.Destroy.forEach((E=>E.dispatch())),this.actionsIn.Reset.forEach((E=>E.dispatch())),this.actionsOut.Transition.forEach((E=>E.pause())),this.actionsOut.Transition.forEach((E=>E.pause())),this.object.currentTransitionEvent=this,this.actionsIn.Transition.forEach((E=>E.play())),this.actionsIn.Animation.forEach((E=>E.play())),this.actionsOut.SwitchCamera.forEach((E=>E.pause())),this.actionsIn.SwitchCamera.forEach((E=>E.play())),this.actionsIn.SceneTransition.forEach((E=>E.dispatch())),this.actionsIn.SetVariable.forEach((E=>E.checkConditions())),this.actionsIn.SetVariable.forEach((E=>E.dispatch())),this.actionsIn.DynamicVariablePlay.forEach((E=>E.dispatch())),this.actionsOut.ClearLocalStorage.forEach((E=>E.dispatch())),this.actionsOut.UserAPI.forEach((E=>E.dispatch())))};let{condition:Y}=O;if(!Y.object)throw new Error("Missing property");let ee=z.find(Y.object)??z.scene.find2D(Y.object);if(!ee)throw new Error("Missing property");if(this.toObject=ee,Y.state&&!this.toObject.states?.[Y.state])throw new Error("Missing property");this.toState=Y.state}connect(){Sx(this.actionsOut).forEach((E=>{this.actionsOut[E]?.length&&this.toObject.addEventListener("beginState",this.onBegin)})),Sx(this.actionsIn).forEach((E=>{this.actionsIn[E]?.length&&this.toObject.addEventListener("completeState",this.onComplete)}))}disconnect(){super.disconnect(),Sx(this.actionsOut).forEach((E=>{this.actionsIn[E]?.length&&this.toObject.removeEventListener("beginState",this.onBegin)})),Sx(this.actionsIn).forEach((E=>{this.actionsIn[E]?.length&&this.toObject.removeEventListener("completeState",this.onComplete)}))}},h3=class extends Z2{constructor(E,O){super(E);this.eventManager=O;this.eventsPerConditions={Comparison:[],Distance:[],State:[]};this.hasVideoAction=!1}connect(){super.connect();let{page:E,sharedAssets:O}=this.eventContext;E.traverseEntity((R=>{if(!!R.data?.events.length)for(let{id:z,data:V}of R.data.events)if(!V.disabled&&V.type==="Conditional")try{let j;V.condition.type==="Comparison"||(V.condition.type==="Distance"?j=new a3(z,V,R,E,O,this.eventManager):V.condition.type==="State"&&(j=new l3(z,V,R,E,O,this.eventManager))),j&&(this.eventsPerConditions[V.condition.type].push(j),(j.actionsIn.Video.length||j.actionsOut.Video.length)&&(this.hasVideoAction=!0))}catch(E){!1}})),Object.values(this.eventsPerConditions).forEach((E=>E.forEach((E=>E.connect()))))}disconnect(){super.disconnect(),Object.values(this.eventsPerConditions).forEach((E=>E.forEach((E=>E.disconnect()))))}};var d3=new Wn,u3=new Wn,p3=new Wn,f3=new _o,m3=.01,g3=new Wn,v3=new Wn,y3=new Wn,b3=new Hn,w3=new zs,S3=new Es,_3=new wn,M3=new Wn,C3=new Wn,T3=.2;function cM(E,O){!O||(O[0]<O[1]&&(E.x=Math.min(Math.max(E.x,O[0]),O[1])),O[2]<O[3]&&(E.y=Math.min(Math.max(E.y,O[2]),O[3])),O[4]<O[5]&&(E.z=Math.min(Math.max(E.z,O[4]),O[5])))}var P3=function(){let E=new Es;return(O,R,z)=>{let V=O.obj;E.copy(V.hiddenMatrix),V.parent!==null&&E.premultiply(V.parent.matrixWorld),E.invert(),V.position.copy(R),O.reference==="global"&&cM(V.position,O.limits),V.position.applyMatrix4(E),O.reference==="parent"?cM(V.position,O.limits):O.reference==="local"&&(b3.copy(O.quat0).invert(),V.position.sub(O.position0),V.position.applyQuaternion(b3),cM(V.position,O.limits),b3.invert(),V.position.applyQuaternion(b3),V.position.add(O.position0)),E.multiply(z??V.matrixWorld).decompose(g3,V.quaternion,v3),V.updateMatrix(),V.hasNonUniformScale&&(V.updateMatrixWorld(),V.updateMatrixWorldSVD()),V instanceof GF&&Mn(V.parent)&&V.invalidateDownstreamBooleanData(!0)}}(),D3=class{constructor(E,O,R,z,V,j,Y){this.object=E;this.id=O;this.data=R;this.dropDestIds=[];this.activeIdx=null;this.wasDragEventTriggered=!1;this.resetDampingFactor=this.data.resetSpeed===0?1:8/this.data.resetSpeed+1,this.snapDampingFactor=this.data.snapSpeed===0?1:8/this.data.snapSpeed+1,this.actionsDrag=Ht(R,R.dragDropActions.drag,z,V,j,this.object),this.actionsDrop=Ht(R,R.dragDropActions.drop,z,V,j,this.object);let ee=[];this.data.objects.forEach((E=>{let O=z.find(E);!O||O.data.visible!==!1&&(ee.push(O),Y[O.uuid]&&Y[O.uuid].forEach((E=>{let O=z.find(E);!O||O.data.visible!==!1&&ee.push(O)})))})),this.data.dropDestinations.forEach((E=>{let O=z.find(E);!O||O.data.visible!==!1&&(this.dropDestIds.push(O.uuid),Y[O.uuid]&&Y[O.uuid].forEach((E=>{let O=z.find(E);!O||O.data.visible!==!1&&this.dropDestIds.push(O.uuid)})))})),this.dragItems=ee.map((E=>(this.data.planeMode==="locked"&&(E.userData.lockedPlane=!0),E.userData.worldPosition0=(new Wn).setFromMatrixPosition(E.matrixWorld),{obj:E,fromPosition:(new Wn).setFromMatrixPosition(E.matrixWorld),pointStart:new Wn,pointEnd:new Wn,paused:!0,currentDampingFactor:this.data.dampingFactor,reset:!1,position0:(new Wn).copy(E.position),quat0:(new Hn).copy(E.quaternion),snapped:!1,orientationMatrix:new Es,limits:this.data.limits,reference:this.data.referenceFrame})))}get activeDragItem(){return this.activeIdx!==null?this.dragItems[this.activeIdx]:null}dispose(){dr(this.actionsDrag),dr(this.actionsDrop),this.dragItems.forEach((E=>{E.fromPosition.copy(E.obj.userData.worldPosition0),E.pointStart.copy(E.fromPosition),E.pointEnd.copy(E.pointStart),E.obj.recursiveBBoxNeedsUpdate=!0,E.obj.userData.lockedPlane=void 0,E.obj.position.copy(E.position0),E.obj.quaternion.copy(E.quat0),E.obj.updateMatrix()}))}},I3=class extends Z2{constructor(E,O){super(E);this.eventManager=O;this.events=[];this.lastDropDestination=null;this.dragTimeout=null;this.onPointerDown=E=>{if(TM.length>1)return;this.eventContext.updateRaycaster(E);let{raycaster:O,page:R}=this.eventContext,z=R.raycastWithClones(O);if(this.lastDropDestination=null,z.length!==0){for(let E of this.events){let O=0;for(let{obj:R,pointEnd:V,pointStart:j}of E.dragItems){if(R===z[0].object||R===z[0].object.object||oL.is(R)&&R.isAncestorOf(z[0].object.uuid)){if(E.activeIdx=O,E.activeDragItem.reset=!1,E.activeDragItem.currentDampingFactor=E.data.dampingFactor,E.activeDragItem.snapped=!1,E.data.cursor==="hand"&&this.setCursor("grabbing"),this.eventManager.controlsManager.usePhysics){E.activeDragItem.obj.rigidBody&&E.activeDragItem.obj.rigidBody.setBodyType(2,!0);let O=E.activeDragItem.obj;R.hasNonUniformScale&&R.updateMatrixWorldSVD(),(O.hasNonUniformScale?O.matrixWorldRigid:O.matrixWorld).decompose(g3,b3,v3),w3.setFromQuaternion(b3),O.prevR===void 0?(O.prevR=w3.clone(),O.prevT=g3.clone()):(O.prevR.copy(w3),O.prevT.copy(g3)),this.eventManager.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim.push(E.activeDragItem.obj)}this.calcPlaneIntersectPos(R,j,E.data.plane,E.data.referenceFrame),V.copy(j),(this.eventManager.controlsManager.usePhysics&&R.data.physics?.rigidBody==="dynamic"||E.data.drop===!1||E.data.resetOnSnapFail===!1)&&E.activeDragItem.fromPosition.setFromMatrixPosition(E.activeDragItem.obj.matrixWorld),this.activeEvent=E,this.eventManager.controlsManager.orbitControls&&(this.eventManager.controlsManager.orbitControls.enabled=!1);return}O++}}this.activeEvent=null}else this.activeEvent=null};this.onPointerMove=E=>{if(TM.length>1)return;this.eventContext.updateRaycaster(E);let{raycaster:O,page:R}=this.eventContext,z=R.raycastWithClones(O);if(TM.length!==0){if(this.activeEvent&&this.activeEvent.activeDragItem){let E=this.activeEvent.activeDragItem;E.snapped=!1;let O;if(this.activeEvent.data.drop&&(O=z.filter((O=>E.obj!==O.object&&!E.obj.isAncestorOf(O.object.uuid)&&!(O.object instanceof wW)&&(this.activeEvent.data.dropOn==="all"||this.activeEvent.dropDestIds.some((E=>E===O.object.uuid||R.scene.find(E).isAncestorOf(O.object.uuid))))))[0]),O){let R=y3.copy(O.face.normal).applyMatrix3(_3.getNormalMatrix(O.object.matrixWorld));if(this.activeEvent.data.snapTo==="center")E.fromPosition.setFromMatrixPosition(O.object.matrixWorld);else if(this.activeEvent.data.snapTo==="surface"){if(E.fromPosition.copy(O.point),this.activeEvent.data.snapSurfaceMode==="bbox"){g3.copy(R).applyMatrix3(_3.setFromMatrix4(E.obj.matrixWorld).transpose());let O=E.obj;g3.x>T3?v3.x=-O.recursiveBBox.min.x:g3.x<-T3&&(v3.x=-O.recursiveBBox.max.x),g3.y>T3?v3.y=-O.recursiveBBox.min.y:g3.y<-T3&&(v3.y=-O.recursiveBBox.max.y),g3.z>T3?v3.z=-O.recursiveBBox.min.z:g3.z<-T3&&(v3.z=-O.recursiveBBox.max.z),v3.applyMatrix3(_3.invert())}else v3.copy(R).multiplyScalar(this.activeEvent.data.snapSurfaceOffset);E.fromPosition.add(v3)}this.activeEvent.data.autoOrient&&(g3.set(0,1,0).cross(R),g3.length()<1e-4&&g3.set(-1,0,0).cross(R),v3.crossVectors(y3,g3),E.orientationMatrix.makeBasis(g3,v3,R)),E.pointStart.copy(E.fromPosition),E.pointEnd.copy(E.pointStart),E.currentDampingFactor=this.activeEvent.snapDampingFactor,E.snapped=!0,this.lastDropDestination!==O.object&&(this.lastDropDestination=O.object,this.activeEvent.actionsDrop.Transition.forEach((E=>{E.play()})),this.activeEvent.actionsDrop.Animation.forEach((E=>{E.play()})),this.activeEvent.actionsDrop.Audio.forEach((E=>{E.dispatchGameControl("start")})),this.activeEvent.actionsDrop.Particles.forEach((E=>{E.dispatchGameControl("start")})),this.activeEvent.actionsDrop.Create.forEach((E=>{E.dispatchThrottled()})))}else E.orientationMatrix.makeRotationFromQuaternion(E.quat0),this.lastDropDestination=null,E.currentDampingFactor=this.activeEvent.data.dampingFactor,this.calcPlaneIntersectPos(E.obj,E.pointEnd,this.activeEvent.data.plane,this.activeEvent.data.referenceFrame),this.activeEvent.actionsDrop.Transition.forEach((E=>{E.stop(),E.object.currentState!==null&&E.object.changeSelectedState(null,{scene:this.eventContext.page.scene,shared:this.eventContext.sharedAssets})})),this.activeEvent.actionsDrop.Animation.forEach((E=>{E.stop()})),this.activeEvent.actionsDrop.Audio.forEach((E=>{E.dispatchGameControl("stop")})),this.activeEvent.actionsDrop.Particles.forEach((E=>{E.dispatchGameControl("stop")}));this.activeEvent.actionsDrag.Create.forEach((E=>{E.dispatchThrottled()})),this.activeEvent.actionsDrag.SetVariable.forEach((E=>E.checkConditions())),this.activeEvent.actionsDrag.SetVariable.forEach((E=>E.dispatch())),this.activeEvent.actionsDrag.DynamicVariablePlay.forEach((E=>E.dispatch())),this.activeEvent.actionsDrag.ClearLocalStorage.forEach((E=>E.dispatch())),this.activeEvent.actionsDrag.UserAPI.forEach((E=>E.dispatch())),this.activeEvent.wasDragEventTriggered===!1&&(this.activeEvent.wasDragEventTriggered=!0,this.activeEvent.actionsDrag.Transition.forEach((E=>{E.play()})),this.activeEvent.actionsDrag.Animation.forEach((E=>{E.play()})),this.activeEvent.actionsDrag.Audio.forEach((E=>{E.dispatchGameControl("start")})),this.activeEvent.actionsDrag.Particles.forEach((E=>{E.dispatchGameControl("start")}))),this.dragTimeout&&window.clearTimeout(this.dragTimeout),this.dragTimeout=window.setTimeout((()=>{!this.activeEvent||(this.activeEvent.wasDragEventTriggered=!1,this.activeEvent.actionsDrag.Audio.forEach((E=>{E.dispatchGameControl("stop")})),this.activeEvent.actionsDrag.Particles.forEach((E=>{E.dispatchGameControl("stop")})),this.activeEvent.actionsDrag.Transition.forEach((E=>{E.stop(),E.object.currentState!==null&&E.object.changeSelectedState(null,{scene:this.eventContext.page.scene,shared:this.eventContext.sharedAssets})})),this.activeEvent.actionsDrag.Animation.forEach((E=>{E.stop()})))}),500),this.updateDragItem(E),E.obj.dispatchEvent({type:"requestRender"})}}else{let E=!1;for(let O of this.events){for(let{obj:R}of O.dragItems)if(R===z[0]?.object||R===z[0]?.object?.object||oL.is(R)&&R.isAncestorOf(z[0]?.object.uuid)){switch(E=!0,O.data.cursor){case"hand":this.setCursor("grab");break;case"move":this.setCursor("move");break;default:break}break}if(E)break}E||this.setCursor("default")}};this.onPointerUp=E=>{if(this.activeEvent&&this.activeEvent.activeDragItem){this.activeEvent.data.cursor==="hand"&&this.setCursor("grab");let E=this.activeEvent.activeDragItem.obj.data.physics?.rigidBody==="dynamic";this.activeEvent.activeDragItem.snapped===!1&&this.activeEvent.data.drop&&this.activeEvent.data.resetOnSnapFail&&(this.eventManager.controlsManager.usePhysics===!1||!E)&&(this.activeEvent.activeDragItem.reset=this.activeEvent.data.resetOnSnapFail,this.activeEvent.activeDragItem.paused=!1,this.activeEvent.activeDragItem.currentDampingFactor=this.activeEvent.resetDampingFactor),this.eventManager.controlsManager.usePhysics&&E&&(this.eventManager.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim.pop(),this.activeEvent.activeDragItem.obj.rigidBody.setBodyType(0,!0),this.activeEvent.activeDragItem.paused=!0),this.activeEvent.wasDragEventTriggered===!0&&(this.activeEvent.wasDragEventTriggered=!1,this.activeEvent.actionsDrag.Transition.forEach((E=>{E.stop(),E.object.currentState!==null&&E.object.changeSelectedState(null,{scene:this.eventContext.page.scene,shared:this.eventContext.sharedAssets})})),this.activeEvent.actionsDrag.Animation.forEach((E=>{E.stop()})),this.activeEvent.actionsDrag.Audio.forEach((E=>{E.dispatchGameControl("stop")})),this.activeEvent.actionsDrag.Particles.forEach((E=>{E.dispatchGameControl("stop")})),this.activeEvent.actionsDrop.SetVariable.forEach((E=>E.checkConditions())),this.activeEvent.actionsDrop.SetVariable.forEach((E=>E.dispatch())),this.activeEvent.actionsDrop.DynamicVariablePlay.forEach((E=>E.dispatch())),this.activeEvent.actionsDrop.ClearLocalStorage.forEach((E=>E.dispatch())),this.activeEvent.actionsDrop.UserAPI.forEach((E=>E.dispatch()))),this.eventManager.controlsManager.orbitControls&&(this.eventManager.controlsManager.orbitControls.enabled=!0)}}}connect(){let E={};if(this.eventContext.page.traverseEntity((O=>{O.component&&(E[O.component.uuid]?E[O.component.uuid].push(O.uuid):E[O.component.uuid]=[O.uuid])})),this.eventContext.page.traverseEntity((O=>{O.data?.events.filter((E=>E.data.type==="DragDrop"&&!E.data.disabled)).forEach((R=>{this.events.push(new D3(O,R.id,R.data,this.eventContext.page,this.eventContext.sharedAssets,this.eventManager,E))}))})),!this.events.length)return;this.domEventsNeeded.clear(),this.domEventsNeeded.add("pointerdown");let O=this.eventContext.domElement;O.addEventListener("pointerdown",this.onPointerDown),O.addEventListener("pointermove",this.onPointerMove),O.addEventListener("pointerup",this.onPointerUp),this.domEventsNeeded.add("pointermove")}disconnect(){if(!this.events.length)return;this.domEventsNeeded.clear();let E=this.eventContext.domElement;E.removeEventListener("pointerdown",this.onPointerDown),E.removeEventListener("pointermove",this.onPointerMove),E.removeEventListener("pointerup",this.onPointerUp),this.events.forEach((E=>E.dispose()))}setCursor(E){this.eventContext.domElement.style.cursor=E}onAnimationFrameDamping(){for(let E of this.events)for(let O of E.dragItems)O.paused||this.updateDragItem(O,!0)}calcPlaneIntersectPos(E,O,R,z){let{getCamera:V,raycaster:j}=this.eventContext;V().getWorldDirection(u3),u3.negate();let Y=b3.identity();switch(z==="parent"?S3.multiplyMatrices(E.parent.matrixWorld,E.hiddenMatrix).decompose(g3,Y,v3):z==="local"&&E.matrixWorld.decompose(g3,Y,v3),R){case"x":g3.set(1,0,0).applyQuaternion(Y),M3.copy(u3).cross(g3),C3.copy(g3).cross(M3);break;case"y":g3.set(0,1,0).applyQuaternion(Y),M3.copy(u3).cross(g3),C3.copy(g3).cross(M3);break;case"z":g3.set(0,0,1).applyQuaternion(Y),M3.copy(u3).cross(g3),C3.copy(g3).cross(M3);break;case"xy":C3.set(0,0,1).applyQuaternion(Y);break;case"yz":C3.set(1,0,0).applyQuaternion(Y);break;case"xz":C3.set(0,1,0).applyQuaternion(Y);break;case"adaptive":u3.angleTo(v3.set(0,1,0))>Math.PI/6?(g3.crossVectors(v3.set(0,1,0),u3),C3.crossVectors(g3,v3)):C3.set(0,1,0);break;default:C3.copy(u3);break}p3.setFromMatrixPosition(E.matrixWorld);let ee=E.userData.lockedPlane?E.userData.worldPosition0:p3;if(f3.setFromNormalAndCoplanarPoint(C3,ee),!!j.ray.intersectPlane(f3,O)&&(R==="x"||R==="y"||R==="z")){let E=v3.subVectors(O,ee).dot(g3);O.copy(ee).addScaledVector(g3,E)}}updateDragItem(E,O=!1){p3.setFromMatrixPosition(E.obj.matrixWorld),E.reset==="current"?d3.subVectors(E.fromPosition,p3).divideScalar(E.currentDampingFactor):E.reset==="original"?(d3.subVectors(E.obj.userData.worldPosition0,p3).divideScalar(E.currentDampingFactor),E.fromPosition.copy(E.obj.userData.worldPosition0),E.pointStart.copy(E.fromPosition),E.pointEnd.copy(E.pointStart)):d3.subVectors(E.pointEnd,E.pointStart).add(E.fromPosition).sub(p3).divideScalar(E.currentDampingFactor),E.paused=!(E.currentDampingFactor>1)||d3.length()<m3,(this.activeEvent&&this.activeEvent.data.dampingFactor===1||O)&&P3(E,d3.add(p3),this.activeEvent?.data.drop&&this.activeEvent?.data.autoOrient?E.orientationMatrix:null),E.obj.dispatchEvent({type:"beginEvent",eventName:"DragDrop"}),this.eventManager.requestRender()}};var O3=new Wn,R3=new Wn,L3=new Wn,z3=new Wn,F3=new _o,k3=.01,V3={type:"requestRender"},j3=function(){let E=new Wn,O=new Wn;return(R,z,V)=>V>0?(E.subVectors(R,z),E.length()<=V?R:O.copy(z).add(E.normalize().multiplyScalar(V))):z}(),H3=function(){let E=new Es;return(O,R)=>{O.position.copy(R),O.parent!==null&&(E.copy(O.parent.matrixWorld).invert(),O.position.applyMatrix4(E)),E.copy(O.hiddenMatrix).invert(),O.position.applyMatrix4(E),O.updateMatrix(),O.hasNonUniformScale&&(O.updateMatrixWorld(),O.updateMatrixWorldSVD()),O instanceof GF&&Mn(O.parent)&&O.invalidateDownstreamBooleanData(!0)}}(),W3=class{constructor(E,O,R,z,V,j){this.data=E;this.id=O;this.object=R;this.paused=!1;this.currentDampingFactor=1;this.snapComplete=!1;this.isReset=!1;this.worldPosition0=new Wn;this.timeoutId=null;this.delayFinished=!0;this.wasOutside=!1;this.data={...YC.defaultData,...E,...E.resetOnPointerLeave===void 0&&{resetOnPointerLeave:!1}},E.target===void 0||E.target==="cursor"||(this.target=z.find(E.target)),this.data.dampingFactor&&(this.currentDampingFactor=this.data.dampingFactor),this.resetDampingFactor=80/this.data.resetSpeed+1,this.object.getWorldPosition(this.worldPosition0),this.actions=Ht(E,E.actions,z,V,j,R)}},q3=class extends Z2{constructor(E,O){super(E);this.eventManager=O;this.events=[];this.pairOfEventListeners=[];this.onMouseMove=E=>{if(!(TM.length>1)){this.eventContext.updateRaycaster(E);for(let E of this.events)E.target===void 0&&this.updateSingleEvent(E)}};this.onMouseEnter=E=>{for(let E of this.events)E.target===void 0&&(E.isReset=!1,E.currentDampingFactor=E.data.dampingFactor)};this.onMouseLeave=E=>{for(let E of this.events)E.target===void 0&&(E.data.resetOnPointerLeave&&(E.isReset=!0,E.currentDampingFactor=E.resetDampingFactor),this.updateSingleEvent(E))};this.onTargetChange=E=>()=>{this.updateSingleEvent(E)}}connect(){let{page:E}=this.eventContext;if(E.traverseEntity((O=>{let R=O.data?.events.find((E=>E.data.type==="Follow"&&!E.data.disabled));R&&(!E.data.globalPhysics.usePhysics||O.dataPatched.physics?.rigidBody!=="dynamic")&&this.events.push(new W3(R.data,R.id,O,E,this.eventContext.sharedAssets,this.eventManager))})),!this.events.length)return;let{domElement:O,eventElement:R}=this.eventContext;this.domEventsNeeded.clear(),MM&&(this.domEventsNeeded.add("pointerdown"),O.addEventListener("pointerdown",this.onMouseMove)),this.domEventsNeeded.add("pointermove"),R.addEventListener("pointermove",this.onMouseMove),this.eventContext.useWindowEvents||(O.addEventListener("pointerenter",this.onMouseEnter),O.addEventListener("pointerleave",this.onMouseLeave));for(let E of this.events)if(E.target!==void 0){let O=E.target,R=this.onTargetChange(E);this.pairOfEventListeners.push([O,R]),O.addEventListener("requestRender",R)}}disconnect(){if(!this.events.length)return;let{domElement:E,eventElement:O}=this.eventContext;this.domEventsNeeded.clear(),MM&&E.removeEventListener("pointerdown",this.onMouseMove),O.removeEventListener("pointermove",this.onMouseMove),E.removeEventListener("pointerenter",this.onMouseEnter),E.removeEventListener("pointerleave",this.onMouseLeave);for(let[E,O]of this.pairOfEventListeners)E.removeEventListener("requestRender",O);for(let E of this.events)E.paused=!0,E.isReset=!1,dr(E.actions)}onAnimationFrameDamping(){for(let E of this.events)E.paused||this.updateSingleEvent(E,!0)}updateSingleEvent(E,O=!1){this.events.forEach((E=>{E.actions.Create.forEach((E=>{E.dispatchThrottled()}))}));let{plane:R,limitDistance:z,limitDistanceEnabled:V}=E.data;if(E.object.getWorldPosition(L3),E.isReset)z3.copy(E.worldPosition0);else if(E.target)E.target.getWorldPosition(z3);else{let{getCamera:E,raycaster:O}=this.eventContext;if(R==="custom"?(E().getWorldDirection(R3),R3.negate(),O3.copy(R3)):R==="xy"?O3.set(0,0,1):R==="xz"?O3.set(0,1,0):R==="yz"&&O3.set(1,0,0),F3.setFromNormalAndCoplanarPoint(O3,L3),!O.ray.intersectPlane(F3,z3))return}if(!E.isReset)if(z3.distanceTo(E.worldPosition0)>z&&V&&E.target){if(E.snapComplete=!1,E.data.snapDelay&&(E.delayFinished=!1,typeof window<"u"&&E.timeoutId!==null&&(window.clearTimeout(E.timeoutId),E.timeoutId=null)),E.wasOutside=!0,!E.data.resetAfterDistanceLimit)return;z3.copy(E.worldPosition0),E.currentDampingFactor=E.resetDampingFactor}else if(E.wasOutside&&(E.data.snapDelay&&typeof window<"u"&&(E.timeoutId=window.setTimeout((()=>{E.delayFinished=!0,E.paused=!1,this.updateSingleEvent(E)}),E.data.snapDelay*1e3)),E.currentDampingFactor=E.data.dampingFactor,E.wasOutside=!1),E.delayFinished===!1)return;E.data.enabledTranslation[0]===!1&&(z3.x=L3.x),E.data.enabledTranslation[1]===!1&&(z3.y=L3.y),E.data.enabledTranslation[2]===!1&&(z3.z=L3.z);let j=j3(L3,z3,E.wasOutside?0:E.data.maxDelta);if(E.currentDampingFactor>1){let R=O3.subVectors(j,L3).divideScalar(E.currentDampingFactor);L3.add(R),O&&H3(E.object,L3),E.paused=R.length()<k3}else H3(E.object,j),E.paused=!0;E.object?.dispatchEvent({type:"beginEvent",eventName:"Follow"}),E.object.dispatchEvent(V3)}};var X3=new Wn,Y3=new Wn,Q3=new Es,Z3=new Hn,K3=new Hn,J3=new Wn,$3=new Wn,e4=new Wn,l4=new Wn,m4=new _o,x4=1e-6,b4={type:"requestRender"},_4={type:"changeRotation"},T4=function(){let E=new Es;return function(O,R){O.parent!==null?E.multiplyMatrices(O.parent.matrixWorld,O.hiddenMatrix):E.copy(O.hiddenMatrix),R.premultiply(rM(E).invert()),O.rotation.setFromRotationMatrix(R),O.updateMatrix(),O instanceof GF&&Mn(O.parent)&&O.invalidateDownstreamBooleanData(!0)}}(),I4=class{constructor(E,O,R,z){this.id=O;this.object=R;this.paused=!1;this.currentDampingFactor=1;this.isReset=!1;this.worldQuaternion0=new Hn;this.timeoutId=null;this.delayFinished=!0;this.wasOutside=!1;this.data={...QC.defaultData,...E,...E.resetOnPointerLeave===void 0&&{resetOnPointerLeave:!1}},E.target===void 0||E.target==="cursor"||(this.target=z.find(E.target)),this.data.dampingFactor&&(this.currentDampingFactor=this.data.dampingFactor),this.object.getWorldQuaternion(this.worldQuaternion0),this.resetDampingFactor=80/this.data.resetSpeed+1}},U4=class extends Z2{constructor(){super(...arguments);this.events=[];this.pairOfEventListeners=[];this.pairOfUserEventListeners=[];this.onMouseMove=E=>{if(!(TM.length>1)){this._lastMouseEvent=E,this.eventContext.updateRaycaster(E);for(let E of this.events)E.target===void 0&&this.updateSingleEvent(E)}};this.onMouseEnter=E=>{for(let E of this.events)E.target===void 0&&(E.isReset=!1,E.currentDampingFactor=E.data.dampingFactor)};this.onMouseLeave=E=>{for(let E of this.events)E.target===void 0&&(E.data.resetOnPointerLeave&&(E.isReset=!0,E.currentDampingFactor=E.resetDampingFactor),this.updateSingleEvent(E))};this.onScroll=E=>{if(this._lastMouseEvent){let E=new PointerEvent("pointermove",{clientX:this._lastMouseEvent.clientX,clientY:this._lastMouseEvent.clientY,bubbles:!0,cancelable:!0,view:window});this.eventContext.eventElement.dispatchEvent(E)}};this.onTargetChange=E=>()=>{this.updateSingleEvent(E)};this.createUserEventListener=E=>({eventName:O,target:R})=>{if(!O||!R)return;let z=ta(O);z&&z==="LookAt"&&this.updateSingleEvent(E)}}connect(){let{page:E}=this.eventContext;if(E.traverseEntity((O=>{let R=O.data?.events.find((E=>E.data.type==="LookAt"&&!E.data.disabled));R&&(!E.data.globalPhysics.usePhysics||O.dataPatched.physics?.rigidBody!=="dynamic")&&this.events.push(new I4(R.data,R.id,O,E))})),!this.events.length)return;let{domElement:O,eventElement:R}=this.eventContext;this.domEventsNeeded.clear(),MM&&(this.domEventsNeeded.add("pointerdown"),O.addEventListener("pointerdown",this.onMouseMove)),this.domEventsNeeded.add("pointermove"),R.addEventListener("pointermove",this.onMouseMove),this.eventContext.useWindowEvents?R.addEventListener("scroll",this.onScroll):(O.addEventListener("pointerenter",this.onMouseEnter),O.addEventListener("pointerleave",this.onMouseLeave));for(let E of this.events){if(E.target!==void 0){let O=this.onTargetChange(E),R=E.target;this.pairOfEventListeners.push([R,O]),R.addEventListener("requestRender",O)}let O=this.createUserEventListener(E),R=E.object;this.pairOfUserEventListeners.push([R,O]),R.addEventListener("userEvent",O)}}disconnect(){if(!this.events.length)return;let{domElement:E,eventElement:O}=this.eventContext;this.domEventsNeeded.clear(),MM&&E.removeEventListener("pointerdown",this.onMouseMove),O.removeEventListener("pointermove",this.onMouseMove),E.removeEventListener("pointerenter",this.onMouseEnter),E.removeEventListener("pointerleave",this.onMouseLeave),O.removeEventListener("scroll",this.onScroll);for(let[E,O]of this.pairOfEventListeners)E.removeEventListener("requestRender",O);for(let[E,O]of this.pairOfUserEventListeners)E.removeEventListener("userEvent",O);for(let E of this.events)E.paused=!0,E.isReset=!1}onAnimationFrameDamping(){for(let E of this.events)E.paused||this.updateSingleEvent(E)}updateSingleEvent(E){let{tilt:O,axis:R,distance:z,plane:V,limitDistance:j,enabledRotation:Y,limitDistanceEnabled:ee}=E.data,{getCamera:se,raycaster:he}=this.eventContext,{object:ce,target:ue}=E;if(ce.getWorldPosition(J3),!E.isReset)if(E.target)E.target.getWorldPosition($3);else{if(V==="custom"?(se().getWorldDirection(Y3),Y3.negate(),m4.setFromNormalAndCoplanarPoint(Y3,J3)):(V==="xy"?X3.set(0,0,1):V==="xz"?X3.set(0,1,0):V==="yz"&&X3.set(1,0,0),m4.setFromNormalAndCoplanarPoint(X3,J3)),!he.ray.intersectPlane(m4,$3))return;z>0&&(V==="custom"||V===void 0)&&$3.addScaledVector(Y3,z)}if(E.isReset||(ue?O==="target"?e4.copy(ue.up).applyMatrix4(Q3.extractRotation(ue.matrixWorld)).normalize():Y.some((E=>E===!1))?(R==="x"?(l4.set(0,0,1),Y[2]===!1&&l4.set(0,1,0)):R==="y"?(l4.set(1,0,0),Y[0]===!1&&l4.set(0,0,1)):(l4.set(0,1,0),Y[1]===!1&&l4.set(1,0,0)),e4.copy(l4).applyQuaternion(E.worldQuaternion0).normalize()):e4.set(0,1,0):V==="custom"?e4.set(0,1,0):e4.copy(X3)),E.isReset)K3.copy(E.worldQuaternion0);else if(J3.distanceTo($3)>j&&ee&&ue){if(E.data.snapDelay&&(E.delayFinished=!1,typeof window<"u"&&E.timeoutId!==null&&(window.clearTimeout(E.timeoutId),E.timeoutId=null)),E.wasOutside=!0,!E.data.resetAfterDistanceLimit)return;K3.copy(E.worldQuaternion0),E.currentDampingFactor=E.resetDampingFactor}else{if(E.wasOutside&&(E.data.snapDelay&&typeof window<"u"&&(E.timeoutId=window.setTimeout((()=>{E.delayFinished=!0,E.paused=!1,this.updateSingleEvent(E)}),E.data.snapDelay*1e3)),E.currentDampingFactor=E.data.dampingFactor,E.wasOutside=!1),E.delayFinished===!1)return;w$(Q3,$3,J3,e4,R,l4),K3.setFromRotationMatrix(Q3),Z3.setFromUnitVectors(l4.applyQuaternion(K3),e4),Y.some((E=>E===!1))&&O!=="target"&&K3.premultiply(Z3).normalize()}E.currentDampingFactor>1?(ce.updateWorldMatrix(!0,!1),Z3.setFromRotationMatrix(rM(ce.matrixWorld)),Z3.slerp(K3,1/E.currentDampingFactor),T4(ce,Q3.makeRotationFromQuaternion(Z3)),E.paused=8*(1-Z3.dot(K3))<x4):(T4(ce,Q3.makeRotationFromQuaternion(K3)),E.paused=!0),E.object?.dispatchEvent({type:"beginEvent",eventName:"LookAt"}),ce.dispatchEvent(b4),ce.dispatchEvent(_4)}},V4=new Wn,s5=new Wn,a5=new Wn;function w$(E,O,R,z,V,j){let Y=E.elements;a5.subVectors(O,R),a5.lengthSq()===0&&(a5.z=1),a5.normalize(),s5.crossVectors(z,a5),s5.lengthSq()===0&&(Math.abs(z.z)===1?a5.x+=1e-4:a5.z+=1e-4,a5.normalize(),s5.crossVectors(z,a5)),s5.normalize(),V4.crossVectors(a5,s5),V==="x"?j.z===1?[s5,V4,a5]=[a5,s5,V4]:(s5.negate(),[s5,a5]=[a5,s5]):V==="y"?j.x===1?[s5,V4,a5]=[V4,a5,s5]:(s5.negate(),[V4,a5]=[a5,V4]):j.x===1&&(s5.negate(),[s5,V4]=[V4,s5]),Y[0]=s5.x,Y[4]=V4.x,Y[8]=a5.x,Y[1]=s5.y,Y[5]=V4.y,Y[9]=a5.y,Y[2]=s5.z,Y[6]=V4.z,Y[10]=a5.z}var o5=class{constructor(E,O,R,z,V,j){this.id=E;this.data=O;this.object=R;this.entered=!1;this.actions=Ht(O,O.actions,z,V,j,R)}disconnect(){dr(this.actions)}dispatchEnter(){this.actions.Transition.forEach((E=>{E.object.currentTransitionEvent!==this&&(E.object.currentTransitionEvent=this,E.init())})),this.entered||(this.entered=!0,this.actions.Transition.forEach((E=>E.playFromCurrent())),this.actions.Animation.forEach((E=>E.play())),this.actions.Create.forEach((E=>E.dispatchStart())),this.actions.Particles.forEach((E=>E.dispatchBasic())),this.actions.Destroy.forEach((E=>E.dispatch())),this.actions.SwitchCamera.forEach((E=>E.playFromCurrent())),this.actions.SceneTransition.forEach((E=>E.dispatch())),this.actions.SetVariable.forEach((E=>E.checkConditions())),this.actions.SetVariable.forEach((E=>E.dispatch())),this.actions.DynamicVariablePlay.forEach((E=>E.dispatch())),this.actions.ClearLocalStorage.forEach((E=>E.dispatch())),this.actions.UserAPI.forEach((E=>E.dispatch())))}dispatchLeave(){this.actions.Transition.forEach((E=>{E.object.currentTransitionEvent!==this&&(E.object.currentTransitionEvent=this,E.init())})),this.entered&&(this.entered=!1,this.actions.Create.forEach((E=>E.dispatchStop())),this.actions.Transition.forEach((E=>E.reverseFromCurrent())),this.actions.Particles.forEach((E=>E.reverseFromCurrent())),this.actions.SwitchCamera.forEach((E=>E.reverseFromCurrent())))}dispatchUserEvent(E){this.actions.Transition.forEach((E=>{E.object.currentTransitionEvent!==this&&(E.object.currentTransitionEvent=this,E.init())})),E?(this.actions.Transition.forEach((E=>E.reverseFromCurrent())),this.actions.Particles.forEach((E=>E.reverseFromCurrent())),this.actions.Animation.forEach((E=>E.reverseFromCurrent())),this.actions.SwitchCamera.forEach((E=>E.reverseFromCurrent()))):(this.actions.Transition.forEach((E=>E.playFromCurrent())),this.actions.Animation.forEach((E=>E.playFromCurrent())),this.actions.Create.forEach((E=>E.dispatch())),this.actions.Particles.forEach((E=>E.dispatchBasic())),this.actions.Destroy.forEach((E=>E.dispatch())),this.actions.SwitchCamera.forEach((E=>E.playFromCurrent()))),this.actions.SceneTransition.forEach((E=>E.dispatch())),this.actions.SetVariable.forEach((E=>E.checkConditions())),this.actions.SetVariable.forEach((E=>E.dispatch())),this.actions.DynamicVariablePlay.forEach((E=>E.dispatch())),this.actions.ClearLocalStorage.forEach((E=>E.dispatch())),this.actions.UserAPI.forEach((E=>E.dispatch()))}},l5=class extends Z2{constructor(E,O){super(E);this.eventManager=O;this.eventsPerObjects={};this.objects=[];this.objects2D=[];this._prevObjects=[];this.onMouseDown=E=>{TM.length>1||(this.eventContext.updateRaycaster(E),this.handleMouseHoverEvent())};this.onMouseUp=E=>{TM.length>1||this.handleMouseHoverEvent(!0)};this.onMouseMove=E=>{TM.length>1||(this.eventContext.updateRaycaster(E),this.handleMouseHoverEvent())};this.onUserEvent=({eventName:E,target:O,reverse:R})=>{if(!E||!O)return;let z=ta(E);z&&z==="MouseHover"&&(O.dispatchEvent({type:"beginEvent",eventName:"MouseHover"}),this.eventsPerObjects[O.uuid]?.forEach((E=>E.dispatchUserEvent(R))))}}connect(){let{page:E,sharedAssets:O}=this.eventContext,i=(R,z)=>{if(!(!R.visible||!R.data?.events.length)){for(let{id:z,data:V}of R.data.events)if(!V.disabled&&V.type==="MouseHover")try{let j=new o5(z,V,R,E,O,this.eventManager);this.eventsPerObjects[R.uuid]?this.eventsPerObjects[R.uuid].push(j):this.eventsPerObjects[R.uuid]=[j]}catch(E){!1}this.eventsPerObjects[R.uuid]?.length&&this.objects.push(R instanceof IK?z:R)}};if(E.traverseEntity((E=>{(E instanceof x$||E instanceof d$)&&E.frame?.traverse((O=>{i(O,E)})),i(E)})),!this.objects.length)return;let{domElement:R}=this.eventContext;this.domEventsNeeded.clear(),MM&&(this.domEventsNeeded.add("pointerdown"),R.addEventListener("pointerdown",this.onMouseDown),this.domEventsNeeded.add("pointerup"),R.addEventListener("pointerup",this.onMouseUp)),this.domEventsNeeded.add("pointermove"),R.addEventListener("pointermove",this.onMouseMove),this.objects.forEach((E=>{E.addEventListener("userEvent",this.onUserEvent)}))}disconnect(){if(!this.objects.length)return;let{domElement:E}=this.eventContext;this.domEventsNeeded.clear(),MM&&(E.removeEventListener("pointerdown",this.onMouseDown),E.removeEventListener("pointerup",this.onMouseUp)),E.removeEventListener("pointermove",this.onMouseMove),Object.values(this.eventsPerObjects).forEach((E=>{E.forEach((E=>{E.disconnect()}))})),this.objects.forEach((E=>{E.removeEventListener("userEvent",this.onUserEvent)}))}handleMouseHoverEvent(E=!1){let O=[];if(!E){let{stopRaycast:E,raycaster:R,page:z,pointerScreen:V}=this.eventContext,j=!1;if(z.uiCanvas&&(j=ao(z,[V.x,V.y],Object.keys(this.eventsPerObjects),(E=>{O.push(E)}))),E&&!j){let E=Hf(R,z,this.objects);O=Sg(E),E.forEach((E=>{E.object instanceof x$&&ao(E.object,[E?.uv?.x??0,E?.uv?.y??0],Object.keys(this.eventsPerObjects),(E=>{O.push(E)}))}))}else this.objects.forEach((E=>{let z=Wf(R,E);z&&(O.push(E),E instanceof x$&&ao(E,[z?.uv?.x??0,z?.uv?.y??0],Object.keys(this.eventsPerObjects),(E=>{O.push(E)})))}))}this._prevObjects.length&&this._prevObjects.forEach((E=>{O.includes(E)||(E.dispatchEvent({type:"beginEvent",eventName:"MouseHover"}),this.eventsPerObjects[E.uuid]?.forEach((E=>E.dispatchLeave())))})),O.length&&O.forEach((E=>{E.dispatchEvent({type:"beginEvent",eventName:"MouseHover"}),this.eventsPerObjects[E.uuid]?.forEach((E=>E.dispatchEnter()))})),this._prevObjects=O}};var h5=class{constructor(E,O,R,z,V,j){this.id=E;this.data=O;this.object=R;this.scrollCounter=0;this.actions=Ht(O,O.actions,z,V,j,R)}connect(){this.scrollCounter=0}disconnect(){dr(this.actions)}dispatch(E){this.actions.Transition.forEach((E=>{E.object.currentTransitionEvent!==this&&(E.object.currentTransitionEvent=this,E.init())}));let O=E>0?1:-1;this.scrollCounter+=O,this.scrollCounter=Math.min(Math.max(this.scrollCounter,0),this.data.steps);let R=this.scrollCounter/this.data.steps;this.actions.Transition.forEach((E=>E.seek(R))),this.actions.Animation.forEach((E=>E.seek(O))),this.actions.Create.forEach((E=>E.dispatchThrottled())),this.actions.SetVariable.forEach((E=>E.checkConditions())),this.actions.SetVariable.forEach((E=>E.dispatch())),this.actions.DynamicVariablePlay.forEach((E=>E.dispatch())),this.actions.ClearLocalStorage.forEach((E=>E.dispatch())),this.actions.UserAPI.forEach((E=>E.dispatch()))}dispatchUserEvent(E){this.actions.Transition.forEach((E=>{E.object.currentTransitionEvent!==this&&(E.object.currentTransitionEvent=this,E.init())})),E?(this.actions.Transition.forEach((E=>E.reverseFromCurrent())),this.actions.Animation.forEach((E=>E.reverseFromCurrent()))):(this.actions.Transition.forEach((E=>{E.playFromCurrent()})),this.actions.Animation.forEach((E=>{E.playFromCurrent()}))),this.actions.Create.forEach((E=>E.dispatchThrottled())),this.actions.SetVariable.forEach((E=>E.checkConditions())),this.actions.SetVariable.forEach((E=>E.dispatch())),this.actions.DynamicVariablePlay.forEach((E=>E.dispatch())),this.actions.ClearLocalStorage.forEach((E=>E.dispatch())),this.actions.UserAPI.forEach((E=>E.dispatch()))}},c5=class{constructor(E,O,R,z,V,j,Y){this.id=E;this.data=O;this.object=R;this.domElement=j;this.eventManager=Y;this.scrollStart=0;this.scrollEnd=0;this.actions=Ht(O,O.actions,z,V,Y,R)}getStickyParentElement(){let E=this.domElement;for(;E;){if(window.getComputedStyle(E).position==="sticky")return E;E=E.parentElement}return null}computeScrollBounds(){let E=this.getStickyParentElement(),O=E?.parentElement,R=this.domElement.getBoundingClientRect(),z={top:R.top,bottom:R.bottom,left:R.left,right:R.right,width:R.width,height:R.height};if(O){let V=O.getBoundingClientRect(),j=window.getComputedStyle(E),Y=parseFloat(j.marginTop)+parseFloat(j.marginBottom),ee=parseFloat(j.top),se=parseFloat(j.bottom),he=V.height-Y;if(isNaN(ee)){if(!isNaN(se)){let E=document.body.clientHeight??window.innerHeight,O=window.innerWidth-(document.documentElement.clientWidth??window.innerWidth);R.bottom===E-se?(z.top+=V.top-R.height+se+O,z.bottom+=V.top-R.height+se+O):R.bottom<E-se&&(z.top-=he-R.height,z.bottom-=he-R.height)}}else R.top===ee?(z.top+=V.top-ee,z.bottom+=V.top-ee):R.top<0&&(z.top-=he-R.height,z.bottom-=he-R.height)}let V=document.body,j=document.documentElement,Y=window.pageYOffset||j.scrollTop||V.scrollTop,ee=j.clientTop||V.clientTop||0,se=Math.round(z.top+Y-ee);if(this.data.startFrom==="enter"){let E=window.innerHeight,O=z.height,R=this.data.enterAnchor,V=R==="top"?E:R==="bottom"?E-O:E-O*.5;this.scrollStart=se-V}else this.scrollStart=0;this.scrollStart+=this.data.startOffset??0,this.scrollEnd=this.scrollStart+(this.data.endAfter??400),this.box=z,this.computeScroll({x:window.scrollX,y:window.scrollY})}connect(){this.computeScrollBounds()}disconnect(){dr(this.actions)}handleResize(){this.computeScrollBounds()}get isInvalidBox(){return this.box===void 0||this.box.width===0&&this.box.height===0&&this.box.top===0&&this.box.bottom===0}computeScroll({x:E,y:O}){this.actions.Transition.forEach((E=>{E.object.currentTransitionEvent!==this&&(E.object.currentTransitionEvent=this,E.init())}));let R=this.scrollEnd-this.scrollStart,z=Math.min(1,Math.max(0,(O-this.scrollStart)/R));this.actions.Transition.forEach((E=>E.seek(z))),this.actions.Animation.forEach((E=>E.seek(z))),this.actions.Create.forEach((E=>E.dispatchThrottled())),this.actions.SetVariable.forEach((E=>E.checkConditions())),this.actions.SetVariable.forEach((E=>E.dispatch())),this.actions.DynamicVariablePlay.forEach((E=>E.dispatch())),this.actions.ClearLocalStorage.forEach((E=>E.dispatch())),this.actions.UserAPI.forEach((E=>E.dispatch()))}dispatch(E){this.isInvalidBox&&this.computeScrollBounds(),this.computeScroll(E)}dispatchUserEvent(E){this.actions.Transition.forEach((E=>{E.object.currentTransitionEvent!==this&&(E.object.currentTransitionEvent=this,E.init())})),E?(this.actions.Transition.forEach((E=>E.reverseFromCurrent())),this.actions.Animation.forEach((E=>E.reverseFromCurrent()))):(this.actions.Transition.forEach((E=>{E.playFromCurrent()})),this.actions.Animation.forEach((E=>{E.playFromCurrent()}))),this.actions.Create.forEach((E=>E.dispatchThrottled())),this.actions.SetVariable.forEach((E=>E.checkConditions())),this.actions.SetVariable.forEach((E=>E.dispatch())),this.actions.DynamicVariablePlay.forEach((E=>E.dispatch())),this.actions.ClearLocalStorage.forEach((E=>E.dispatch())),this.actions.UserAPI.forEach((E=>E.dispatch()))}},d5=class extends Z2{constructor(E,O){super(E);this.managers=O;this.wheelEventsPerObject=new Map;this.scrollEventsPerObject=new Map;this.isInview=!0;this.handleResize=()=>{[...this.scrollEventsPerObject.entries()].forEach((([E,O])=>{O.forEach((E=>E.handleResize()))}))};this.onScroll=E=>{if(!this.isInview)return;let O={y:window.scrollY,x:window.scrollX};[...this.scrollEventsPerObject.entries()].forEach((([E,R])=>{E.dispatchEvent({type:"beginEvent",eventName:"Scroll",scroll:O}),R.forEach((E=>E.dispatch(O)))}))};this.onWheel=E=>{!this.isInview||E.ctrlKey||[...this.wheelEventsPerObject.entries()].forEach((([O,R])=>{O.dispatchEvent({type:"beginEvent",eventName:"Scroll",deltaY:E.deltaY}),R.forEach((O=>O.dispatch(E.deltaY)))}))};this.onUserEvent=({eventName:E,target:O,reverse:R})=>{if(!E||!O)return;let z=ta(E);z&&z==="Scroll"&&(O.dispatchEvent({type:"beginEvent",eventName:"Scroll"}),this.wheelEventsPerObject.get(O)?.forEach((E=>{E.dispatchUserEvent(R)})))}}connect(){let{page:E,sharedAssets:O,domElement:R,isExport:z}=this.eventContext,o=V=>{if(!!V.data?.events.length)for(let{id:j,data:Y}of V.data.events)if(!Y.disabled&&Y.type==="Scroll")if(Y.trigger!=="load"&&z){let z=new c5(j,Y,V,E,O,R,this.managers);this.scrollEventsPerObject.has(V)?this.scrollEventsPerObject.get(V)?.push(z):this.scrollEventsPerObject.set(V,[z])}else{let R=new h5(j,Y,V,E,O,this.managers);this.wheelEventsPerObject.has(V)?this.wheelEventsPerObject.get(V)?.push(R):this.wheelEventsPerObject.set(V,[R])}};E.traverseEntity((E=>{(E instanceof x$||E instanceof d$)&&E.frame?.traverse((E=>{o(E)})),o(E)})),this.intersectionObserver=new IntersectionObserver((E=>{let O=E[0];O&&(this.isInview=O.isIntersecting)}),{root:null}),this.intersectionObserver.observe(this.eventContext.domElement),[...this.wheelEventsPerObject.entries()].forEach((([E,O])=>{O.forEach((E=>E.connect())),E.addEventListener("userEvent",this.onUserEvent)})),[...this.scrollEventsPerObject.entries()].forEach((([E,O])=>{O.forEach((E=>E.connect())),E.addEventListener("userEvent",this.onUserEvent)})),[...this.wheelEventsPerObject.values()].some((E=>E.length))&&(this.domEventsNeeded.add("wheel"),window.addEventListener("wheel",this.onWheel)),[...this.scrollEventsPerObject.values()].some((E=>E.length))&&(this.domEventsNeeded.add("scroll"),window.addEventListener("scroll",this.onScroll),window.addEventListener("resize",this.handleResize))}disconnect(){window.removeEventListener("wheel",this.onWheel),window.removeEventListener("scroll",this.onScroll),window.removeEventListener("resize",this.handleResize),this.intersectionObserver.unobserve(this.eventContext.domElement),this.domEventsNeeded.clear(),[...this.wheelEventsPerObject.entries()].forEach((([E,O])=>{O.forEach((E=>E.disconnect())),E.removeEventListener("userEvent",this.onUserEvent)})),[...this.scrollEventsPerObject.entries()].forEach((([E,O])=>{O.forEach((E=>E.disconnect())),E.removeEventListener("userEvent",this.onUserEvent)}))}};var u5=class{constructor(E,O,R,z,V,j){this.id=E;this.data=O;this.object=R;this.actions=Ht(O,O.actions,z,V,j,R)}disconnect(){dr(this.actions)}dispatch(){this.actions.Transition.forEach((E=>{E.play()})),this.actions.Animation.forEach((E=>{E.play()})),this.actions.SwitchCamera.forEach((E=>{E.play()})),this.actions.SceneTransition.forEach((E=>{E.dispatch()})),this.actions.Reset.forEach((E=>E.dispatch())),this.actions.SetVariable.forEach((E=>E.checkConditions())),this.actions.SetVariable.forEach((E=>E.dispatch())),this.actions.DynamicVariablePlay.forEach((E=>E.dispatch())),this.actions.ClearLocalStorage.forEach((E=>E.dispatch())),this.actions.UserAPI.forEach((E=>E.dispatch())),this.actions.Create.forEach((E=>{E.dispatchFromStart()})),this.actions.Destroy.forEach((E=>{E.dispatchFromStart()}))}dispatchAfter(E){this.actions.Audio.forEach((O=>{(O.interaction.data.triggerAfter??"any")===E&&(O.interaction instanceof a1?O.interaction.audioPlayer.play():O.interaction instanceof o1&&O.interaction.dispatch())})),this.actions.Video.forEach((O=>{let R=O.interaction.data.triggerAfter??"autoplay";R===E&&(O.interaction instanceof r2?O.interaction.play(R==="autoplay"):O.interaction instanceof n2&&O.interaction.dispatch())})),this.actions.Particles.forEach((O=>{(O.data.triggerAfter??"any")===E&&O.dispatchBasic()}))}dispatchUserEvent(E){this.actions.Transition.forEach((E=>{E.object.currentTransitionEvent!==this&&(E.object.currentTransitionEvent=this,E.init())})),E?(this.actions.Transition.forEach((E=>E.reverseFromCurrent())),this.actions.Animation.forEach((E=>E.reverseFromCurrent())),this.actions.SwitchCamera.forEach((E=>E.reverseFromCurrent()))):(this.actions.Transition.forEach((E=>E.playFromCurrent())),this.actions.Animation.forEach((E=>E.playFromCurrent())),this.actions.SwitchCamera.forEach((E=>E.playFromCurrent()))),this.actions.SceneTransition.forEach((E=>E.dispatch())),this.actions.Reset.forEach((E=>E.dispatch())),this.actions.SetVariable.forEach((E=>E.checkConditions())),this.actions.SetVariable.forEach((E=>E.dispatch())),this.actions.DynamicVariablePlay.forEach((E=>E.dispatch())),this.actions.ClearLocalStorage.forEach((E=>E.dispatch())),this.actions.UserAPI.forEach((E=>E.dispatch())),this.actions.Create.forEach((E=>{E.dispatch()})),this.actions.Destroy.forEach((E=>{E.dispatch()})),this.actions.Audio.forEach((E=>{E.interaction instanceof a1?E.interaction.audioPlayer.play():E.interaction instanceof o1&&E.interaction.dispatch()})),this.actions.Video.forEach((E=>{E.interaction instanceof r2?E.interaction.play():E.interaction instanceof n2&&E.interaction.dispatch()})),this.actions.Particles.forEach((E=>{E.dispatchBasic()}))}},p5=class extends Z2{constructor(E,O){super(E);this.eventManager=O;this.eventsPerObject=new Map;this.eventsAfterPerObject=new Map;this.onMouseDown=()=>{[...this.eventsAfterPerObject.entries()].forEach((([E,O])=>{E.dispatchEvent({type:"beginEvent",eventName:"Start"}),O.forEach((E=>{E.dispatchAfter("mouseDown")}))}))};this.onKeyDown=()=>{[...this.eventsAfterPerObject.entries()].forEach((([E,O])=>{E.dispatchEvent({type:"beginEvent",eventName:"Start"}),O.forEach((E=>{E.dispatchAfter("keyDown")}))}))};this.onAny=()=>{let{domElement:E,isExport:O}=this.eventContext,R=O?document:E;R.removeEventListener("pointerdown",this.onAny),R.removeEventListener("mousedown",this.onAny),document.removeEventListener("keydown",this.onAny),[...this.eventsAfterPerObject.entries()].forEach((([E,O])=>{E.dispatchEvent({type:"beginEvent",eventName:"Start"}),O.forEach((E=>{E.dispatchAfter("any")}))}))};this.onSceneTransitionAudioVideoPlay=()=>{[...this.eventsAfterPerObject.entries()].forEach((([E,O])=>{E.dispatchEvent({type:"beginEvent",eventName:"Start"}),O.forEach((E=>{E.actions.Audio.forEach((E=>{E.interaction instanceof a1&&E.interaction.audioPlayer.play()})),E.actions.Video.forEach((E=>{let O=E.interaction.data.triggerAfter??"autoplay";E.interaction instanceof r2&&E.interaction.play(O==="autoplay")})),E.actions.Particles.forEach((E=>{E.dispatchBasic()}))}))}))};this.onPlay=()=>{[...this.eventsAfterPerObject.entries()].forEach((([E,O])=>{E.dispatchEvent({type:"beginEvent",eventName:"Start"}),O.forEach((E=>{E.dispatchAfter("autoplay")}))}))};this.onUserEvent=({eventName:E,target:O,reverse:R})=>{if(!E||!O)return;let z=ta(E);z&&z==="Start"&&(O instanceof IK||O.dispatchEvent({type:"beginEvent",eventName:"Start"}),this.eventsPerObject.get(O)?.forEach((E=>{E.dispatchUserEvent(R)})),this.eventsAfterPerObject.get(O)?.forEach((E=>{E.dispatchUserEvent(R)})))}}connect(){let{sharedAssets:E,page:O}=this.eventContext,i=R=>{if(!!R.data?.events.length)for(let{id:z,data:V}of R.data.events){if(V.disabled||V.type!=="Start")continue;let j=new u5(z,V,R,O,E,this.eventManager);(j.actions.Transition.length||j.actions.Animation.length||j.actions.SwitchCamera.length||j.actions.Create.length||j.actions.Destroy.length||j.actions.SceneTransition.length||j.actions.Reset.length||j.actions.SetVariable.length||j.actions.DynamicVariablePlay.length||j.actions.ClearLocalStorage.length||j.actions.UserAPI.length)&&(this.eventsPerObject.has(R)?this.eventsPerObject.get(R)?.push(j):this.eventsPerObject.set(R,[j])),j.actions.Audio.length&&(this.eventsAfterPerObject.has(R)?this.eventsAfterPerObject.get(R)?.push(j):this.eventsAfterPerObject.set(R,[j])),j.actions.Video.length&&(this.hasVideoAction=!0,this.eventsAfterPerObject.has(R)?this.eventsAfterPerObject.get(R)?.push(j):this.eventsAfterPerObject.set(R,[j])),j.actions.Particles.length&&(this.eventsAfterPerObject.has(R)?this.eventsAfterPerObject.get(R)?.push(j):this.eventsAfterPerObject.set(R,[j]))}};if(O.traverseEntity((E=>{(E instanceof x$||E instanceof d$)&&E.frame?.traverse((E=>{i(E)})),i(E)})),[...this.eventsAfterPerObject.values()].some((E=>E.length))){if(this.eventManager.activateCount===0){let{domElement:E,isExport:O}=this.eventContext,R=O?document:E;R.addEventListener("pointerdown",this.onMouseDown,{once:!0}),R.addEventListener("mousedown",this.onMouseDown,{once:!0}),document.addEventListener("keydown",this.onKeyDown,{once:!0}),R.addEventListener("pointerdown",this.onAny),R.addEventListener("mousedown",this.onAny),document.addEventListener("keydown",this.onAny),[...this.eventsAfterPerObject.entries()].forEach((([E,O])=>{E.addEventListener("userEvent",this.onUserEvent)}))}else this.onSceneTransitionAudioVideoPlay();this.onPlay()}[...this.eventsPerObject.entries()].forEach((([E,O])=>{E.dispatchEvent({type:"beginEvent",eventName:"Start"}),O.forEach((E=>E.dispatch())),E.addEventListener("userEvent",this.onUserEvent)}))}disconnect(){if([...this.eventsAfterPerObject.values()].some((E=>E.length))){let{domElement:E,isExport:O}=this.eventContext,R=O?document:E;R.removeEventListener("pointerdown",this.onMouseDown),R.removeEventListener("mousedown",this.onMouseDown),document.removeEventListener("keydown",this.onKeyDown),R.removeEventListener("pointerdown",this.onAny),R.removeEventListener("mousedown",this.onAny),document.removeEventListener("keydown",this.onAny),[...this.eventsAfterPerObject.entries()].forEach((([E,O])=>{E.removeEventListener("userEvent",this.onUserEvent),O.forEach((E=>E.disconnect()))}))}[...this.eventsPerObject.entries()].forEach((([E,O])=>{E.removeEventListener("userEvent",this.onUserEvent),O.forEach((E=>E.disconnect()))})),this.eventsPerObject.clear(),this.eventsAfterPerObject.clear()}};var f5=class{constructor(E,O,R,z,V,j){this.id=E;this.data=O;this.object=R;this.initialDisabled=!1;this.actions=Ht(O,O.actions,z,V,j,R),this.target=O.target}disconnect(){dr(this.actions)}dispatch(E){this.initialDisabled||(this.actions.Transition.forEach((E=>{E.object.currentTransitionEvent!==this&&(E.object.currentTransitionEvent=this,E.init())})),this.object.dispatchEvent({type:"beginEvent",eventName:"Collision"}),this.actions.Transition.forEach((E=>{E.data.runMode==="Toggle"?E.toggle():E.play()})),this.actions.Animation.forEach((E=>{E.data.runMode==="Toggle"?E.toggle():E.play()})),this.actions.Reset.forEach((E=>{E.dispatch()})),this.actions.Link.forEach((E=>{E.dispatch()})),this.actions.Reset.forEach((E=>{E.dispatch()})),this.actions.Create.forEach((E=>{E.dispatch()})),this.actions.Destroy.forEach((O=>{O.dispatch(E??!1)})),this.actions.SetVariable.forEach((E=>E.checkConditions())),this.actions.SetVariable.forEach((E=>E.dispatch())),this.actions.DynamicVariablePlay.forEach((E=>E.dispatch())),this.actions.Audio.forEach((E=>{E.dispatchBasic()})),this.actions.Particles.forEach((E=>{E.dispatchBasic()})),this.actions.Video.forEach((E=>{E.dispatchBasic()})),this.actions.ClearLocalStorage.forEach((E=>E.dispatch())),this.actions.UserAPI.forEach((E=>E.dispatch())))}};var v5=class extends Z2{constructor(E,O,R,z,V){super(E);this.sharedVariables=O;this.eventManager=R;this.needsMouse=z;this.needsRaycast=V;this.dynamicVars=[];this.variablesToWatch=[];this.prevMouseProperty=null;this.prevRaycastProperty=null;this.pauseTime=0;this.isOutOfFocus=!1;this.events=[];this.onFrame=E=>{let O=this.eventContext.sharedAssets;if(this.rafId=window.requestAnimationFrame(this.onFrame),this.isOutOfFocus)return;let R=new Date,z=[],V=[];for(let E=0;E<this.propertiesToWatch.length;E++){let{objectId:O,property:R,prevValue:z}=this.propertiesToWatch[E],j=this.eventContext.scene.find(O),Y=oT.propertyPaths[R];if(Y[0]==="width"||Y[0]==="height"||Y[0]==="depth")j=j.geometry.userData.parameters[Y[0]];else for(let E=0;E<Y.length;E++)j=j[Y[E]];z===null?this.propertiesToWatch[E].prevValue=j instanceof Wn?j.clone():j:(j instanceof Wn?!j.equals(z):z!==j)&&(V.push({objId:O,property:R}),j instanceof Wn?this.propertiesToWatch[E].prevValue.copy(j):this.propertiesToWatch[E].prevValue=j)}for(let E=0;E<this.variablesToWatch.length;E++){let{id:R,prevValue:V}=this.variablesToWatch[E],j=O.getVariable(R);j!==V&&(z.push(R),this.variablesToWatch[E].prevValue=j)}for(let V=0;V<this.dynamicVars.length;V++){let{id:j,expectedTime:Y,last:ee,data:se,timerSeconds:he,startValue:ce}=this.dynamicVars[V],ue=1e3;if(se.dynamicVariableType!=="timer"&&se.dynamicVariableType!=="stopwatch"||se.format!=="number3decimal"?se.dynamicVariableType==="counter"?ue=se.updateInterval:se.dynamicVariableType==="random"&&(ue=se.isStatic?1/0:se.updateInterval):ue=1,Y!==-1){if(!((O.getDynamicVariablePlayState(j)==="Stopped"||O.getDynamicVariablePlayState(j)==="Restarted")&&(this.dynamicVars[V].last=E,this.dynamicVars[V].expectedTime=E+ue,se.dynamicVariableType==="counter"&&O.getVariable(j)!==ce&&(O.updateVariable(j,ce),this.eventManager.requestRender()),(se.dynamicVariableType==="timer"||se.dynamicVariableType==="stopwatch")&&this.dynamicVars[V].timerSeconds!==ce&&(this.dynamicVars[V].timerSeconds=ce,O.updateVariable(j,ZD.getFormattedTimerTime(ce,se)),this.eventManager.requestRender()),O.getDynamicVariablePlayState(j)==="Restarted"&&O.setDynamicVariablePlayState(j,"Playing"),O.getDynamicVariablePlayState(j)==="Stopped"))){if(O.getDynamicVariablePlayState(j)==="Paused"){this.dynamicVars[V].deltaToExpectedTime===void 0&&(this.dynamicVars[V].deltaToExpectedTime=Math.max(this.dynamicVars[V].expectedTime-E,0)),this.dynamicVars[V].last=E-(ue-this.dynamicVars[V].deltaToExpectedTime),this.dynamicVars[V].expectedTime=E+this.dynamicVars[V].deltaToExpectedTime;continue}this.dynamicVars[V].deltaToExpectedTime=void 0;if(E>=Y)if(this.dynamicVars[V].last=E,this.dynamicVars[V].expectedTime+=ue,se.dynamicVariableType==="random"){let E=se.min+Math.random()*(se.max-se.min),R=se.decimals;E=Math.round(E*Math.pow(10,R))/Math.pow(10,R),O.updateVariable(j,E),z.push(j),this.eventManager.requestRender()}else if(se.dynamicVariableType==="counter"){let E=O.getVariable(j),R=O.getDynamicVariableToggleIsForward(j)??!0,V=O.getVariable(j)+se.increment*(R?1:-1);se.hasEnd&&(V=se.increment>0?xn.clamp(V,ce,se.endValue):xn.clamp(V,se.endValue,ce),V===ce&&O.setDynamicVariableToggleIsForward(j,void 0),se.repeat?V===se.endValue&&(V=ce):(V===ce||V===se.endValue)&&O.setDynamicVariablePlayState(j,"Paused")),V!==E&&(z.push(j),O.updateVariable(j,V),this.eventManager.requestRender())}else if(se.dynamicVariableType==="time"){let E=O.getVariable(j),V=DE(R,se);if(typeof E=="object"&&"textValue"in E&&typeof V=="object"&&"textValue"in V){if(Array.isArray(E.textValue)&&Array.isArray(V.textValue)){if(E.textValue.every(((E,O)=>E===V.textValue[O])))continue}else if(E.textValue===V.textValue)continue}else if(E===V)continue;O.updateVariable(j,V),z.push(j),this.eventManager.requestRender()}else{let R=ID.isTextValue(se.endValue)?rF(se.endValue.textValue):se.endValue,Y=O.getDynamicVariableToggleIsForward(j)??!0,ue=he+(E-ee)/1e3*(se.dynamicVariableType==="timer"?-1:1)*(Y?1:-1);ue=Math.max(ue,0),se.hasEnd&&(ue=se.dynamicVariableType==="stopwatch"?xn.clamp(ue,ce,R):xn.clamp(ue,R,ce),ue===ce&&O.setDynamicVariableToggleIsForward(j,void 0),se.repeat?Math.abs(ue-R)<(se.format==="number3decimal"?1e-4:.1)&&(ue=ce):(Math.abs(ue-ce)<(se.format==="number3decimal"?1e-4:.1)||Math.abs(ue-R)<(se.format==="number3decimal"?1e-4:.1))&&O.setDynamicVariablePlayState(j,"Paused")),ue!==he&&(z.push(j),this.dynamicVars[V].timerSeconds=ue,O.updateVariable(j,ZD.getFormattedTimerTime(ue,se)),this.eventManager.requestRender())}}}else this.dynamicVars[V].last=E,this.dynamicVars[V].expectedTime=E+ue}let j=!1;O.mouseProperty!==this.prevMouseProperty&&(this.prevMouseProperty=O.mouseProperty,j=!0);let Y=!1;O.raycastProperty!==this.prevRaycastProperty&&(this.prevRaycastProperty=O.raycastProperty,Y=!0),this.events.forEach((E=>{(z.includes(E.data.variableId)||V.find((O=>O.objId===E.data.objectId&&O.property===E.data.property))||E.data.variableId==="mouseProperty"&&j||E.data.variableId==="raycastProperty"&&Y)&&(E.dispatch(),this.eventManager.requestRender())}))};this.onBlur=()=>{this.pause()};this.onFocus=()=>{this.resume()}}pause(){this.isOutOfFocus||(this.isOutOfFocus=!0,this.pauseTime=Date.now())}resume(){if(!this.isOutOfFocus)return;this.isOutOfFocus=!1;let E=Date.now()-this.pauseTime;for(let O=0;O<this.dynamicVars.length;O++)this.dynamicVars[O].last+=E,this.dynamicVars[O].expectedTime+=E}connect(){this.eventContext.page.traverseEntity((E=>{E.data?.events.filter((E=>E.data.type==="VariableChange"&&!E.data.disabled)).forEach((O=>{this.events.push(new x5(O.id,O.data,E,this.eventContext.page,this.eventContext.sharedAssets,this.eventManager))}))})),this.propertiesToWatch=this.events.filter((E=>E.data.variableId==="objectProperty"&&E.data.objectId!==null)).map((E=>({objectId:E.data.objectId,property:E.data.property,prevValue:null})));let E=this.eventContext.sharedAssets;this.sharedVariables.forEach((({id:O,data:R})=>{if(!("dynamicVariableType"in R)){this.events.find((E=>E.data.variableId===O))&&this.variablesToWatch.push({id:O,prevValue:E.getVariable(O)});return}let z;if(R.dynamicVariableType==="timer"||R.dynamicVariableType==="stopwatch"){let E;if(ID.isTextValue(R.value)&&Array.isArray(R.value.textValue)){let O=R.value.textValue;E=O.length===3?O[2]+O[1]*60+O[0]*3600:O[1]+O[0]*60}else E=R.value;z=E,this.dynamicVars.push({id:O,last:-1,expectedTime:-1,data:R,timerSeconds:E,startValue:z})}else R.dynamicVariableType==="time"&&E.updateVariable(O,DE(new Date,R)),R.dynamicVariableType==="counter"&&(z=ID.isTextValue(R.value)?rF(R.value.textValue):R.value),this.dynamicVars.push({id:O,last:-1,expectedTime:-1,data:R,startValue:z})})),this.rafId=window.requestAnimationFrame(this.onFrame),window.addEventListener("blur",this.onBlur),window.addEventListener("focus",this.onFocus)}disconnect(){window.removeEventListener("blur",this.onBlur),window.removeEventListener("focus",this.onFocus),this.rafId&&(window.cancelAnimationFrame(this.rafId),this.rafId=void 0),this.events.forEach((E=>E.dispose()))}},x5=class{constructor(E,O,R,z,V,j){this.id=E;this.data=O;this.object=R;this.actions=Ht(O,O.actions,z,V,j,R)}dispatch(){let E=this.actions;E.Audio.forEach((E=>E.dispatchConditional())),E.Particles.forEach((E=>E.dispatchConditional())),E.Video.forEach((E=>E.dispatchConditional())),E.Create.forEach((E=>E.dispatch())),E.Destroy.forEach((E=>E.dispatch())),E.Reset.forEach((E=>E.dispatch())),E.Transition.forEach((E=>{E.object.currentTransitionEvent!==this&&(E.object.currentTransitionEvent=this),E.init()})),E.Transition.forEach((E=>E.play())),E.Animation.forEach((E=>E.play())),E.SwitchCamera.forEach((E=>E.play())),E.SceneTransition.forEach((E=>E.dispatch())),E.SetVariable.forEach((E=>E.checkConditions())),E.SetVariable.forEach((E=>E.dispatch())),E.DynamicVariablePlay.forEach((E=>E.dispatch())),E.ClearLocalStorage.forEach((E=>E.dispatch())),E.UserAPI.forEach((E=>E.dispatch()))}dispose(){dr(this.actions)}};function rF(E){return E.length===3?E[2]+E[1]*60+E[0]*3600:E[1]+E[0]*60}var b5,w5,S5,_5="https://unpkg.com/@splinetool/runtime@1.9.76/build/",A5="https://unpkg.com/@splinetool/navmesh-wasm@1.9.76/build/",M5=`\n(async function() {\n\tconst [wasmImport, wasmBinary] = await Promise.all([\n\t\timport('${_5}' + 'navmesh.js'),\n\t\tfetch('${A5}' + 'navmesh.wasm').then((res) => res.arrayBuffer()),\n\t]);\n\tconst wasmModule = wasmImport.default;\n\tself.module = await wasmModule({ wasmBinary });\n\tpostMessage('ready');\n})();\n`,E5="\n(async function() {\n\tconst [wasmImport, wasmBinary] = await Promise.all([\n\t\timport(self.location.origin + '/_libraries/navmesh.js'),\n\t\tfetch(self.location.origin + '/_libraries/navmesh.wasm').then((res) => res.arrayBuffer()),\n\t]);\n\tconst wasmModule = wasmImport.default;\n\tself.module = await wasmModule({ wasmBinary });\n\tpostMessage('ready');\n})();\n",C5="\n\nonmessage = function(messageEvent) {\n\tconst meshData = messageEvent.data;\n\tconst positions = meshData[0];\n\tconst offset = meshData[1];\n\tconst indices = meshData[2];\n\tconst indicesLength = meshData[3];\n\tconst parameters = meshData[4];\n\n\tconst module = self.module;\n\tconst rc = new module.rcConfig();\n\trc.cs = parameters.cs;\n\trc.ch = parameters.ch;\n\trc.borderSize = parameters.borderSize ? parameters.borderSize : 0;\n\trc.tileSize = parameters.tileSize ? parameters.tileSize : 0;\n\trc.walkableSlopeAngle = parameters.walkableSlopeAngle;\n\trc.walkableHeight = parameters.walkableHeight;\n\trc.walkableClimb = parameters.walkableClimb;\n\trc.walkableRadius = parameters.walkableRadius;\n\trc.maxEdgeLen = parameters.maxEdgeLen;\n\trc.maxSimplificationError = parameters.maxSimplificationError;\n\trc.minRegionArea = parameters.minRegionArea;\n\trc.mergeRegionArea = parameters.mergeRegionArea;\n\trc.maxVertsPerPoly = parameters.maxVertsPerPoly;\n\trc.detailSampleDist = parameters.detailSampleDist;\n\trc.detailSampleMaxError = parameters.detailSampleMaxError;\n\n\tif (!self.navMesh) {\n\t\tself.navMesh = new module.NavMesh();\n\t}\n\tself.navMesh.build(positions, offset, indices, indicesLength, rc);\n\n\tconst navmeshData = navMesh.getNavmeshData();\n\tconst arrView = new Uint8Array(module.HEAPU8.buffer, navmeshData.dataPointer, navmeshData.size);\n\tconst ret = new Uint8Array(navmeshData.size);\n\tret.set(arrView);\n\tnavMesh.freeNavmeshData(navmeshData);\n\n\tpostMessage(ret);\n}\n",T5=.001,I5={cs:6,ch:2,walkableSlopeAngle:90,walkableHeight:20,walkableClimb:5,walkableRadius:0,maxEdgeLen:12,maxSimplificationError:1.3,minRegionArea:8,mergeRegionArea:20,maxVertsPerPoly:6,detailSampleDist:6,detailSampleMaxError:1};RM.then((E=>{b5=E,w5=new E.Vec3,S5=new E.Vec3}));var O5=new Wn,R5=class{constructor(E=!1,O=!1){this.usePhysics=E;this.isExport=O;this.onPointerDown=E=>{if(TM.length!==1)return;let{raycaster:O,page:R}=this.eventContext;this.eventContext.updateRaycaster(E);let z=R.raycastWithClones(O);if(z.length!==0){if(this.gameControl){let E=O5.copy(this.gameControl.colliderWorldPosition);E.y-=this.gameControl.colliderHeight/2,this.gameControl.path=this.computePath(E,z[0].point)}this.eventContext.requestRender()}};this.traverseWithPhysics=(E,O)=>R=>{let z;if(R instanceof SH){if(!R.objectForSample)return R.object.dataPatched.physics.fusedBody===!0&&R.object.dataPatched.physics.rigidBody==="dynamic"||void 0;if(R.objectForSample.dataPatched.physics.fusedBody)return;z=R.object}else if(R instanceof HR)z=R.object;else if(z=R,z.dataPatched.cloner?.disabled===!1&&z.dataPatched.cloner?.hideBase&&z.dataPatched.physics?.fusedBody!==!0)return!0;if(O&&!z.userData.navmesh)return;let V=z.dataPatched;if(!V.visible&&V.physics?.enabled!==!0)return!0;R.updateMatrixWorldSVD();let j=Cg(V),Y=z.userData.hasDestroy,ee=z.userData.hasDrag,se=!1,he=!1;for(let E of V.events)E.data.disabled!==!0&&(E.data.type==="GameControl"?se=!0:E.data.type==="Follow"&&(he=!0));if(se||j||he||Y||ee)return!0;if(this.usePhysics&&V.physics?.rigidBody==="dynamic"){if(this.usePhysics&&V.physics?.fusedBody)return!0}else if("geometry"in R&&R.geometry&&E.push(oo(R.geometry,R.matrixWorld)),this.usePhysics&&V.physics?.fusedBody)return R.traverseObject(((O,R)=>{if(R===0)return;let z;if(O instanceof SH){if(!O.objectForSample)return O.object.dataPatched.physics.fusedBody===!0&&O.object.dataPatched.physics.rigidBody==="dynamic"||void 0;if(O.objectForSample.dataPatched.physics.fusedBody)return;z=O.object}else if(O instanceof HR)z=O.object;else if(z=O,O.dataPatched.cloner?.hideBase)return!0;let V=z.dataPatched;if(!V.visible&&V.physics?.enabled!==!0)return!0;"geometry"in O&&O.geometry&&E.push(oo(O.geometry,O.matrixWorld))})),!0};this.traverseNoPhysics=(E,O)=>R=>{let z;if(R instanceof SH)return;z=R instanceof HR?R.object:R;let V=z.dataPatched;if(V.physics.enabled==="visibility"?!V.visible:!V.physics.enabled)return!0;if(O&&!z.userData.navmesh)return;let j=R.geometry,Y=z.userData.hasDestroy===!0,ee=z.userData.hasDrag===!0;if(Cg(V)||Y||ee||z.dataPatched.events.some((E=>E.data.disabled!==!0&&E.data.type==="GameControl")))return!0;j&&E.push(oo(j,R.matrixWorld))};this.navmeshWasm=b5,this.navMesh=new this.navmeshWasm.NavMesh,this._workerURL=URL.createObjectURL(new Blob([(O?M5:E5)+C5])),this._worker=new Worker(this._workerURL)}init(E,O,R){this.gameControl=O,this.eventContext=R,this.setDefaultQueryExtent((new Wn).setScalar(E.ch*E.walkableRadius*1.2)),this._worker.onmessage=()=>{this.createNavMesh(R.page,E,(E=>{this.buildFromNavmeshData(E.data)}))},this.eventContext.renderer.domElement.addEventListener("pointerdown",this.onPointerDown)}createNavMesh(E,O,R){O.objects.forEach((O=>{let R=E.scene.find(O);R.traverseEntity((E=>{E.userData.navmesh=!0})),R.cloner?.traverseObject((E=>{E.userData.navmesh=!0}))}));let z=[],V=(this.usePhysics?this.traverseWithPhysics:this.traverseNoPhysics)(z,O.zones==="custom");if(E.traverseChildren(V),O.objects.forEach((O=>{let R=E.scene.find(O);R.traverseEntity((E=>{E.userData.navmesh=void 0})),R.cloner?.traverseObject((E=>{E.userData.navmesh=void 0}))})),z.length===0)return!1;let j=js(z),{positions:Y,triIndices:ee}=Kc(j.getAttribute("position"),j.getIndex());return this._worker.postMessage([Y,Y.length/3,ee,ee.length,{...I5,...O}]),this._worker.onmessage=R,!0}createDebugNavGeometry(){let E,O,R=this.navMesh.getDebugNavMesh(),z=R.getTriangleCount(),V=new Uint32Array(z*3),j=new Float32Array(z*3*3);for(E=0;E<z*3;E++)V[E]=E;for(E=0;E<z;E++)for(O=0;O<3;O++){let z=R.getTriangle(E).getPoint(O);j[E*9+O*3+0]=z.x,j[E*9+O*3+1]=z.y,j[E*9+O*3+2]=z.z}let Y=new Na;return Y.setIndex(new Sa(V,1)),Y.setAttribute("position",new Sa(j,3)),Y}getClosestPoint(E){return w5.x=E.x,w5.y=E.y,w5.z=E.z,this.navMesh.getClosestPoint(w5)}getClosestPointToRef(E,O){w5.x=E.x,w5.y=E.y,w5.z=E.z;let R=this.navMesh.getClosestPoint(w5);O.set(R.x,R.y,R.z)}getRandomPointAround(E,O){return w5.x=E.x,w5.y=E.y,w5.z=E.z,this.navMesh.getRandomPointAround(w5,O)}getRandomPointAroundToRef(E,O,R){w5.x=E.x,w5.y=E.y,w5.z=E.z;let z=this.navMesh.getRandomPointAround(w5,O);R.set(z.x,z.y,z.z)}moveAlong(E,O){return w5.x=E.x,w5.y=E.y,w5.z=E.z,S5.x=O.x,S5.y=O.y,S5.z=O.z,this.navMesh.moveAlong(w5,S5)}moveAlongToRef(E,O,R){return w5.x=E.x,w5.y=E.y,w5.z=E.z,S5.x=O.x,S5.y=O.y,S5.z=O.z,this.navMesh.moveAlong(w5,S5)}computePath(E,O){let R=this.getClosestPoint(O);if(S5.x=R.x,S5.y=R.y,S5.z=R.z,Math.sqrt(Math.pow(O.x-R.x,2)+Math.pow(O.y-R.y,2)+Math.pow(O.z-R.z,2))>this.getDefaultQueryExtent().y)return[];this.getClosestPoint(E);let z=this.navMesh.computePath(w5,S5),V=z.getPointCount(),j=[];for(let E=0;E<V;E++){let O=z.getPoint(E);j.push(new Wn(O.x,O.y,O.z))}return j}createCrowd(E,O){return new z5(this,E,O)}setDefaultQueryExtent(E){w5.x=E.x,w5.y=E.y,w5.z=E.z,this.navMesh.setDefaultQueryExtent(w5)}getDefaultQueryExtent(){return this.navMesh.getDefaultQueryExtent()}buildFromNavmeshData(E){let O=E.length*E.BYTES_PER_ELEMENT,R=this.navmeshWasm._malloc(O),z=new Uint8Array(this.navmeshWasm.HEAPU8.buffer,R,O);z.set(E);let V=new this.navmeshWasm.NavmeshData;V.dataPointer=z.byteOffset,V.size=E.length,this.navMesh.buildFromNavmeshData(V),this.navmeshWasm._free(z.byteOffset)}getNavmeshData(){let E=this.navMesh.getNavmeshData(),O=new Uint8Array(this.navmeshWasm.HEAPU8.buffer,E.dataPointer,E.size),R=new Uint8Array(E.size);return R.set(O),this.navMesh.freeNavmeshData(E),R}getDefaultQueryExtentToRef(E){let O=this.navMesh.getDefaultQueryExtent();E.set(O.x,O.y,O.z)}dispose(){this.navMesh.destroy(),this._worker.terminate(),URL.revokeObjectURL(this._workerURL),this.eventContext?.renderer.domElement.removeEventListener("pointerdown",this.onPointerDown)}addCylinderObstacle(E,O,R){return w5.x=E.x,w5.y=E.y,w5.z=E.z,this.navMesh.addCylinderObstacle(w5,O,R)}addBoxObstacle(E,O,R){return w5.x=E.x,w5.y=E.y,w5.z=E.z,S5.x=O.x,S5.y=O.y,S5.z=O.z,this.navMesh.addBoxObstacle(w5,S5,R)}removeObstacle(E){this.navMesh.removeObstacle(E)}isSupported(){return this.navmeshWasm!==void 0}},z5=class{constructor(E,O,R){this.navmeshWasmWrapper=E;this.transforms=[];this.agents=new Array;this.reachRadii=new Array;this._agentDestinationArmed=new Array;this._agentDestination=new Array;this.crowd=new this.navmeshWasmWrapper.navmeshWasm.Crowd(O,R,this.navmeshWasmWrapper.navMesh.getNavMesh())}onReachTarget(E,O){}addAgent(E,O,R){let z=new this.navmeshWasmWrapper.navmeshWasm.dtCrowdAgentParams;z.radius=O.radius,z.height=O.height,z.maxAcceleration=O.maxAcceleration,z.maxSpeed=O.maxSpeed,z.collisionQueryRange=O.collisionQueryRange,z.pathOptimizationRange=O.pathOptimizationRange,z.separationWeight=O.separationWeight,z.updateFlags=7,z.obstacleAvoidanceType=0,z.queryFilterType=0,z.userData=0;let V=this.crowd.addAgent(new this.navmeshWasmWrapper.navmeshWasm.Vec3(E.x,E.y,E.z),z);return this.transforms.push(R),this.agents.push(V),this.reachRadii.push(O.reachRadius?O.reachRadius:O.radius),this._agentDestinationArmed.push(!1),this._agentDestination.push(new Wn(0,0,0)),V}getAgentPosition(E){return this.crowd.getAgentPosition(E)}getAgentPositionToRef(E,O){let R=this.crowd.getAgentPosition(E);O.set(R.x,R.y,R.z)}getAgentVelocity(E){return this.crowd.getAgentVelocity(E)}getAgentVelocityToRef(E,O){let R=this.crowd.getAgentVelocity(E);O.set(R.x,R.y,R.z)}getAgentNextTargetPath(E){return this.crowd.getAgentNextTargetPath(E)}getAgentNextTargetPathToRef(E,O){let R=this.crowd.getAgentNextTargetPath(E);O.set(R.x,R.y,R.z)}getAgentState(E){return this.crowd.getAgentState(E)}overOffmeshConnection(E){return this.crowd.overOffmeshConnection(E)}agentGoto(E,O){this.crowd.agentGoto(E,new this.navmeshWasmWrapper.navmeshWasm.Vec3(O.x,O.y,O.z));let R=this.agents.indexOf(E);R>-1&&(this._agentDestinationArmed[R]=!0,this._agentDestination[R].set(O.x,O.y,O.z))}agentTeleport(E,O){this.crowd.agentTeleport(E,new this.navmeshWasmWrapper.navmeshWasm.Vec3(O.x,O.y,O.z))}updateAgentParameters(E,O){let R=this.crowd.getAgentParameters(E);O.radius!==void 0&&(R.radius=O.radius),O.height!==void 0&&(R.height=O.height),O.maxAcceleration!==void 0&&(R.maxAcceleration=O.maxAcceleration),O.maxSpeed!==void 0&&(R.maxSpeed=O.maxSpeed),O.collisionQueryRange!==void 0&&(R.collisionQueryRange=O.collisionQueryRange),O.pathOptimizationRange!==void 0&&(R.pathOptimizationRange=O.pathOptimizationRange),O.separationWeight!==void 0&&(R.separationWeight=O.separationWeight),this.crowd.setAgentParameters(E,R)}removeAgent(E){this.crowd.removeAgent(E);let O=this.agents.indexOf(E);O>-1&&(this.agents.splice(O,1),this.transforms.splice(O,1),this.reachRadii.splice(O,1),this._agentDestinationArmed.splice(O,1),this._agentDestination.splice(O,1))}getAgents(){return this.agents}update(E){if(this.navmeshWasmWrapper.navMesh.update(),E<=T5)return;let O=1/60,R=10;if(O<=T5)this.crowd.update(E);else{let z=Math.floor(E/O);R&&z>R&&(z=R),z<1&&(z=1);let V=E/z;for(let E=0;E<z;E++)this.crowd.update(V)}for(let E=0;E<this.agents.length;E++){let O=this.agents[E],R=this.getAgentPosition(O);if(this.transforms[E].copy(R),this._agentDestinationArmed[E]){let z=R.x-this._agentDestination[E].x,V=R.z-this._agentDestination[E].z,j=this.reachRadii[E],Y=this._agentDestination[E].y-this.reachRadii[E],ee=this._agentDestination[E].y+this.reachRadii[E],se=z*z+V*V;R.y>Y&&R.y<ee&&se<j*j&&(this.onReachTarget(O,this._agentDestination[E]),this._agentDestinationArmed[E]=!1)}}}setDefaultQueryExtent(E){let O=new this.navmeshWasmWrapper.navmeshWasm.Vec3(E.x,E.y,E.z);this.crowd.setDefaultQueryExtent(O)}getDefaultQueryExtent(){return this.crowd.getDefaultQueryExtent()}getDefaultQueryExtentToRef(E){let O=this.crowd.getDefaultQueryExtent();E.set(O.x,O.y,O.z)}getCorners(E){let O,R=this.crowd.getCorners(E),z=R.getPointCount(),V=[];for(O=0;O<z;O++){let E=R.getPoint(O);V.push(new Wn(E.x,E.y,E.z))}return V}dispose(){this.crowd.destroy()}};function SM(E){let O=!1;return E.scene.objects.forEach((R=>{R.data.type==="Page"&&!O&&R.data.publish.gameControlObject&&MD.traverseModuleInstances(E,R.id,((E,R,z)=>{for(let E of z)E.data.type==="GameControl"&&E.data.navmesh.enabled&&(O=!0)}))})),O}var N5={type:"change"},U5={type:"changeZoom"},k5={type:"changePan"},j5={type:"start"},q5={type:"end",changed:!0},X5={type:"end",changed:!1},Y5=new Hn,K5=new bn,J5=2*Math.PI,$5=1e-8,i6=.01,n6=new Wn,s6=new bn,a6=new Wn,l6=new Hn,p6=new Es;var f6={type:"requestRender"},m6=class extends pn{constructor(E,O,R={isPlayMode:!1,isExport:!1}){super();this.object=E;this.domElement=O;this.options=R;this.enabled=!0;this.useKeyEvents=!0;this.enableDamping=!1;this.enableZoom=!0;this.enableRotate=!0;this.enablePan=!0;this.autoRotate=!1;this.rotationLimitsMode=0;this.panLimitsMode=0;this.rotationSoftLimit=2;this.panSoftLimit=2;this.hoverRotatePanMode=0;this.zoomLimitsEnabled=!1;this.mouseButtons=[0,5];this.mouseButtonsPlay=[3,4,5];this.touches=[null,we.DOLLY_ROTATE,we.PAN];this.offset=new Wn;this.eye=new Wn;this.lastPosition=new Wn;this.lastQuaternion=new Hn;this.current=new bn;this.overShoot=new bn;this.overRatio=new bn;this.spherical=new Mf;this.sphericalDelta=new Mf;this.panOffset=new Wn;this.panLeftV=new Wn;this.panUpV=new Wn;this.panV=new Wn;this.rotateStart=new bn;this.rotateEnd=new bn;this.rotateDelta=new bn;this.panStart=new bn;this.panEnd=new bn;this.panDelta=new bn;this.dollyStart=new bn;this.dollyEnd=new bn;this.dollyDelta=new bn;this.rotationRangeFactor=new bn;this.panRangeFactor=new bn;this.state=-1;this.zoomChanged=!1;this.isPointerDown=!1;this.isThetaFlipped=!1;this.prevScale=0;this.scale=1;this.gesture=!1;this.timer=-1;this.timerHover=-1;this.minDistance=0;this.maxDistance=1/0;this.minZoom=0;this.maxZoom=1/0;this.minPhi=0;this.maxPhi=Math.PI;this.minTheta=-1/0;this.maxTheta=1/0;this.minH=0;this.maxH=Math.PI;this.minV=-1/0;this.maxV=1/0;this.autoRotateClockwise=!0;this.isPanOverShoot=!1;this.isRotateOverShoot=!1;this.resetHoverEffectOnPointerLeave=!1;this.hasChange=!1;this.useWindowEvents=!1;this.isTouchZoom=!0;this.autoRotateSpeed=2;this.dampingFactor=.125;this.zoomSpeed=2;this.rotateSpeed=1;this.panSpeed=1;this.hoverRotatePanStrength=.1;this.hoverRotateDamping=this.dampingFactor;this.thetaIsFree=!1;this.phiIsFree=!1;this.needsUpdate=!0;this.onCameraChange=E=>{this.object.removeEventListener("beginState",this.onBeginState),this.object.removeEventListener("completeState",this.onCompleteState),this.object.removeEventListener("cameraChange",this.onCameraChange),this.object=E.camera,this.object.addEventListener("beginState",this.onBeginState),this.object.addEventListener("completeState",this.onCompleteState),this.object.addEventListener("cameraChange",this.onCameraChange)};this.update=()=>{this.object.updateWorldMatrix(!0,!1),this.object.matrixWorld.decompose(a6,l6,n6),this.offset.copy(a6).sub(this.target),this.spherical.setFromVector3(this.offset),this.object.isUpVectorFlipped&&(this.spherical.phi*=-1,this.spherical.theta-=Math.PI),this.autoRotate&&this.state===-1&&this.rotateLeft((this.autoRotateClockwise===!0?1:-1)*this.getAutoRotationAngle()),this.rotationLimitsMode!==0&&this.applyLimits(this.sphericalDelta,this.rotationLimitsMode,this.rotationSoftLimit,this.maxTheta,this.minTheta,this.maxPhi,this.minPhi,this.rotationRangeFactor),this.rotationLimitsMode!==2&&(this.spherical.phi+=this.sphericalDelta.phi),(this.rotationLimitsMode!==1||this.autoRotate===!0)&&(this.spherical.theta+=this.sphericalDelta.theta),this.spherical.radius*=this.scale,this.zoomLimitsEnabled&&this.object.isPerspectiveCamera&&(this.spherical.radius=Math.max(this.minDistance,Math.min(this.maxDistance,this.spherical.radius))),this.panLimitsMode!==0&&(this.target.applyQuaternion(Y5.copy(l6).invert()),this.panOffset.applyQuaternion(Y5),this.applyLimits(this.panOffset,this.panLimitsMode,this.panSoftLimit,this.maxH,this.minH,this.maxV,this.minV,this.panRangeFactor),this.target.applyQuaternion(l6),this.panOffset.applyQuaternion(l6)),this.panLimitsMode===2&&(this.panOffset.y=0),this.panLimitsMode===1&&(this.panOffset.x=0),this.state!==-1||this.gesture?(this.target.add(this.panOffset),this.panOffset.set(0,0,0)):(this.panOffset.multiplyScalar(1-this.dampingFactor),this.target.add(this.panOffset)),this.offset.setFromSpherical(this.spherical),a6.copy(this.target).add(this.offset),this.object.position.copy(this.target).add(this.offset),this.object.parent&&(p6.copy(this.object.parent.matrixWorld).invert(),this.object.position.applyMatrix4(p6));let E=this.spherical.phi%J5;if(this.eye.copy(this.offset).normalize(),this.object.up.copy(ra.DEFAULT_UP).applyAxisAngle(this.eye,this.object.angleOffsetFromUp),E>0&&E>Math.PI||E<0&&E>-Math.PI?(this.object.up.negate(),this.object.lookAt(this.target),this.object.isUpVectorFlipped=!0):(this.object.lookAt(this.target),this.object.isUpVectorFlipped=!1),this.state===-1||this.enableDamping===!0){let E=this.hoverRotatePanMode===1?this.hoverRotateDamping:this.dampingFactor;this.sphericalDelta.theta*=1-E,this.sphericalDelta.phi*=1-E}else this.sphericalDelta.set(0,0,0);return this.scale=1,this.zoomChanged||this.lastPosition.distanceToSquared(this.object.position)>i6||8*(1-this.lastQuaternion.dot(this.object.quaternion))>$5?(this.dispatchEvent(N5),this.object.dispatchEvent(f6),this.lastPosition.copy(this.object.position),this.lastQuaternion.copy(this.object.quaternion),this.zoomChanged=!1,!0):(this.isPanOverShoot=!1,this.isRotateOverShoot=!1,this.object.wasMovedBySwitchCameraAction=!1,this.sphericalDelta.set(0,0,0),this.panOffset.set(0,0,0),!1)};this.onPointerDown=E=>{this.enabled!==!1&&(E.pointerType==="touch"||E.pointerType==="pen"&&MM?this.onPointerDownTouch(E):this.onPointerDownMouse(E),this.state!==-1&&(this.isPointerDown=!0,this.dispatchEvent(j5),this.domElement.addEventListener("pointermove",this.onPointerMove),this.domElement.addEventListener("pointerup",this.onPointerUp),E.stopPropagation(),E.pointerType==="touch"||E.pointerType==="pen"&&MM||this.domElement.setPointerCapture(E.pointerId)))};this.onPointerLeave=E=>{this.resetHoverEffectOnPointerLeave&&!this.useWindowEvents?(this.hoverRotatePanMode===1?(this.sphericalDelta.theta=-this.spherical.theta,this.sphericalDelta.phi=-this.spherical.phi,n6.subVectors(this.position0,this.target0),this.spherical.setFromVector3(n6),this.sphericalDelta.theta+=this.spherical.theta,this.sphericalDelta.phi+=this.spherical.phi,this.sphericalDelta.theta/=8,this.sphericalDelta.phi/=8):this.hoverRotatePanMode===2&&this.panOffset.subVectors(this.target0,this.target).divideScalar(8),this.update()):this.pointerLeaveEvent=E};this.onPointerEnter=E=>{this.resetHoverEffectOnPointerLeave||this.pointerLeaveEvent===void 0?s6.set(E.clientX-this.domElement.clientWidth/2,E.clientY-this.domElement.clientHeight/2):s6.set(E.clientX-this.pointerLeaveEvent.clientX,E.clientY-this.pointerLeaveEvent.clientY),this.hoverRotatePanMode===1?(this.rotateDelta.copy(s6).multiplyScalar(this.rotateSpeed*this.hoverRotatePanStrength).rotateAround(K5,-this.object.angleOffsetFromUp),this.rotateLeft(2*Math.PI*this.rotateDelta.x/this.domElement.clientHeight),this.rotateUp(2*Math.PI*this.rotateDelta.y/this.domElement.clientHeight),this.rotateStart.set(E.clientX,E.clientY)):this.hoverRotatePanMode===2&&(this.panDelta.copy(s6).multiplyScalar(this.panSpeed*this.hoverRotatePanStrength),this.pan(this.panDelta.x,this.panDelta.y),this.panStart.set(E.clientX,E.clientY)),this.update()};this.onPointerMove=E=>{this.enabled!==!1&&(this.checkRaycastLock()||(E.pointerType==="touch"||E.pointerType==="pen"&&MM?this.onPointerMoveTouch(E):this.onPointerMoveMouse(E),E.stopPropagation()))};this.onPointerUp=E=>{this.isPointerDown=!1,TM.length===0&&(this.domElement.removeEventListener("pointermove",this.onPointerMove),this.domElement.removeEventListener("pointerup",this.onPointerUp)),TM.length>1&&E.preventDefault(),this.hasChange?this.dispatchEvent(q5):this.dispatchEvent(X5),this.state=-1,E&&(E.stopPropagation(),E.pointerType==="touch"||E.pointerType==="pen"&&MM||this.domElement.releasePointerCapture(E.pointerId))};this.onPointerDownMouse=E=>{let O;switch(O=this.useKeyEvents?this.mouseButtons[E.button]:this.mouseButtonsPlay[E.button],O){case 0:if(E.altKey!==!0||E.shiftKey||Gp(E)){if(this.key===" "){if(this.enablePan===!1)return;this.handleMouseDownPan(E),this.state=2}}else{if(this.enableRotate===!1)return;this.handleMouseDownRotate(E),this.state=0}break;case 4:if(this.enablePan===!1)return;this.handleMouseDownPan(E),this.state=2;break;case 3:if(Gp(E)||E.shiftKey){if(this.enablePan===!1)return;this.handleMouseDownPan(E),this.state=2}else{if(this.enableRotate===!1)return;this.handleMouseDownRotate(E),this.state=0}break;case 5:if(Gp(E)||E.shiftKey){if(this.enableRotate===!1)return;this.handleMouseDownRotate(E),this.state=0}else{if(this.enablePan===!1)return;this.handleMouseDownPan(E),this.state=2}break;default:this.state=-1}};this.onPointerMoveMouse=E=>{switch(this.state){case 0:if(this.enableRotate===!1)return;this.handleMouseMoveRotate(E);break;case 1:if(this.enableZoom===!1)return;this.handleMouseMoveDolly(E);break;case 2:if(this.enablePan===!1)return;this.handleMouseMovePan(E);break}this.object.wasMovedByUser=!0};this.onPointerDownTouch=E=>{switch(TM.length>1&&E.preventDefault(),this.touches[TM.length-1]){case we.ROTATE:if(this.enableRotate===!1){this.state=-1;return}this.handleTouchStartRotate(),this.state=3;break;case we.PAN:if(this.enablePan===!1){this.state=-1;return}this.handleTouchStartPan(),this.state=4;break;case we.DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this.handleTouchStartDollyPan(),this.state=5;break;case we.DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this.handleTouchStartDollyRotate(),this.state=6;break;default:this.state=-1}};this.onPointerMoveTouch=E=>{switch(TM.length>1&&E.preventDefault(),this.state){case 3:if(this.enableRotate===!1)return;this.handleTouchMoveRotate(E),this.update();break;case 4:if(this.enablePan===!1)return;this.handleTouchMovePan(E),this.update();break;case 5:if(this.enableZoom===!1&&this.enablePan===!1)return;this.handleTouchMoveDollyPan(E),this.update();break;case 6:if(this.enableZoom===!1&&this.enableRotate===!1)return;this.handleTouchMoveDollyRotate(E),this.update();break;default:this.state=-1}this.object.wasMovedByUser=!0};this.dispatchEndDebounced=XA((()=>this.dispatchEvent(q5)),33);this.onMouseWheel=E=>{this.enabled===!1||this.enableZoom===!1&&this.enablePan===!1||this.checkRaycastLock()||(!this.options.isExport&&this.domElement.clientHeight===document.body.clientHeight&&this.domElement.clientWidth===document.body.clientWidth&&E.preventDefault(),this.dispatchEvent(j5),this.handleMouseWheel(E),this.dispatchEndDebounced(),this.object.wasMovedByUser=!0)};this.onGesture=E=>{if(E.preventDefault(),this.enabled!==!1&&!this.checkRaycastLock()&&!_M)if(E.type==="gesturechange"){if(this.enableZoom===!1||this.isTouchZoom===!1)return;this.dispatchEvent(j5),E.scale>this.prevScale?this.dollyIn(this.getZoomScale()):E.scale<this.prevScale&&this.dollyOut(this.getZoomScale()),this.prevScale=E.scale,this.update(),this.object.wasMovedByUser=!0}else this.dispatchEvent(q5)};this.onContextMenu=E=>{E.preventDefault()};this.onTouchEnd=E=>{E.preventDefault()};this.onKeyDown=E=>{this.enabled!==!1&&(this.key=E.key,E.key===" "&&this.dispatchEvent(j5))};this.onKeyUp=E=>{this.enabled!==!1&&(this.key=void 0,this.state!==-1&&E.key==="Alt"&&this.onPointerUp(TM[0]),E.key===" "&&this.dispatchEvent(q5))};this.onPointerHover=E=>{E.pointerType!=="mouse"||this.enabled===!1||this.state!==-1||this.hoverRotatePanMode===2&&this.isPanOverShoot||this.hoverRotatePanMode===1&&this.isRotateOverShoot||(this.isPointerDown=!0,this.hoverRotatePanMode===2?this.handleMouseMovePan(E,this.hoverRotatePanStrength):this.hoverRotatePanMode===1&&this.handleMouseMoveRotate(E,this.hoverRotatePanStrength))};this.onBeginState=()=>{this.enabled=!1,this.needsUpdate=!1};this.onCompleteState=E=>{E.isfromEntity&&this.options.isPlayMode||(this.enabled=!0,this.needsUpdate=!0,this.object.updateUp(),this.object.getTarget(this.target))};this.target=this.object.getTarget(),this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.quat0=this.object.quaternion.clone(),this.isUpVectorFlipped0=this.object.isUpVectorFlipped,this.offset.copy(this.object.position).sub(this.target),this.spherical.setFromVector3(this.offset),this.object.isUpVectorFlipped&&(this.spherical.phi*=-1,this.spherical.theta-=Math.PI),this.initialSphericalRadius=this.spherical.radius,this.addEventListenersToCamera()}dispatchEvent(E){E.type==="start"?this.hasChange=!1:this.hasChange=!0,super.dispatchEvent(E)}addEventListenersToCamera(){this.object.addEventListener("beginState",this.onBeginState),this.object.addEventListener("completeState",this.onCompleteState),this.object.addEventListener("cameraChange",this.onCameraChange)}removeEventListenersFromCamera(){this.object.removeEventListener("beginState",this.onBeginState),this.object.removeEventListener("completeState",this.onCompleteState),this.object.removeEventListener("cameraChange",this.onCameraChange)}updateUseWindowEvents(E){if(window.removeEventListener("pointermove",this.onPointerHover),this.domElement.removeEventListener("pointermove",this.onPointerHover),this.useWindowEvents=E,this.hoverRotatePanMode!==0&&(this.useWindowEvents?window.addEventListener("pointermove",this.onPointerHover):this.domElement.addEventListener("pointermove",this.onPointerHover)),this.domElement.removeEventListener("pointerleave",this.onPointerLeave),this.domElement.removeEventListener("pointerenter",this.onPointerEnter),window.removeEventListener("pointerleave",this.onPointerLeave),window.removeEventListener("pointerenter",this.onPointerEnter),this.hoverRotatePanMode!==0&&!this.useWindowEvents){let E=this.useWindowEvents?window:this.domElement;E.addEventListener("pointerleave",this.onPointerLeave),E.addEventListener("pointerenter",this.onPointerEnter)}}fromJSON(E,O){this.setEnableDampingSpeed(E.enableDamping),this.enablePan=E.enablePan,this.enableZoom=E.enableZoom,this.enableRotate=E.enableRotate,this.rotationLimitsMode=E.rotationLimitsMode,this.thetaIsFree=E.rotationHorizontalOffset.min===E.rotationHorizontalOffset.max&&E.rotationHorizontalOffset.min===Math.PI,this.phiIsFree=E.rotationVerticalOffset.min===E.rotationVerticalOffset.max&&E.rotationVerticalOffset.min===Math.PI,this.panLimitsMode=E.panLimitsMode,this.panSoftLimit=E.panSoftLimit,this.rotationSoftLimit=E.rotationSoftLimit,this.hoverRotatePanMode=E.hoverRotatePanMode,this.hoverRotateDamping=E.hoverRotateDamping??this.dampingFactor,this.useWindowEvents=O==="window",this.hoverRotatePanMode!==0&&(this.useWindowEvents?window.addEventListener("pointermove",this.onPointerHover):this.domElement.addEventListener("pointermove",this.onPointerHover));let R=E.hoverRotatePanStrength/100;this.hoverRotatePanStrength=R**2,this.zoomLimitsEnabled=E.zoomLimitsEnabled,this.minZoom=E.zoomLimits.min,this.maxZoom=Math.max(E.zoomLimits.min,E.zoomLimits.max),this.minDistance=1e3/this.maxZoom,this.maxDistance=Math.max(this.minDistance,1e3/E.zoomLimits.min),this.autoRotate=E.autoRotate,this.autoRotateSpeed=E.autoRotateSpeed,this.autoRotateClockwise=E.autoRotateClockwise;let z=this.object.getTarget().applyQuaternion(Y5.copy(this.object.quaternion).invert());this.minV=-E.panVerticalOffset.min+z.y,this.maxV=E.panVerticalOffset.max+z.y,this.minH=-E.panHorizontalOffset.min+z.x,this.maxH=E.panHorizontalOffset.max+z.x,this.panRangeFactor.set(this.maxH-this.minH,this.maxV-this.minV).divideScalar(2),this.rotationRangeFactor.setScalar(Math.PI).divideScalar(4),this.minPhi=ia(this.spherical.phi-E.rotationVerticalOffset.min),this.maxPhi=ia(this.spherical.phi+E.rotationVerticalOffset.max),this.minTheta=ia(ia(this.spherical.theta)-E.rotationHorizontalOffset.min),this.maxTheta=ia(ia(this.spherical.theta)+E.rotationHorizontalOffset.max),this.isThetaFlipped=this.minTheta>this.maxTheta,E.orbitTouches===1&&(this.touches[0]=we.ROTATE),E.panTouches===1&&(this.touches[0]=we.PAN),E.orbitTouches===2&&(this.touches[1]=we.DOLLY_ROTATE),E.panTouches===2&&(this.touches[1]=we.DOLLY_PAN),E.orbitTouches===3&&(this.touches[2]=we.ROTATE),E.panTouches===3&&(this.touches[2]=we.PAN),this.isTouchZoom=E.isTouchZoom,this.resetHoverEffectOnPointerLeave=E.resetHoverEffectOnPointerLeave??!1}connect(){if(this.domElement.addEventListener("contextmenu",this.onContextMenu),this.domElement.addEventListener("pointerdown",this.onPointerDown),this.domElement.addEventListener("wheel",this.onMouseWheel),window.addEventListener("keydown",this.onKeyDown,!1),window.addEventListener("keyup",this.onKeyUp,!1),this.domElement.addEventListener("gesturestart",this.onGesture),this.domElement.addEventListener("gesturechange",this.onGesture),this.domElement.addEventListener("gestureend",this.onGesture),this.domElement.addEventListener("touchend",this.onTouchEnd),this.hoverRotatePanMode!==0&&!this.useWindowEvents){let E=this.useWindowEvents?window:this.domElement;E.addEventListener("pointerleave",this.onPointerLeave),E.addEventListener("pointerenter",this.onPointerEnter)}this.pointerLeaveEvent=void 0}dispose(){this.removeEventListenersFromCamera(),this.domElement.removeEventListener("contextmenu",this.onContextMenu),this.domElement.removeEventListener("pointerdown",this.onPointerDown),this.domElement.removeEventListener("wheel",this.onMouseWheel),window.removeEventListener("keydown",this.onKeyDown,!1),window.removeEventListener("keyup",this.onKeyUp,!1),this.domElement.removeEventListener("pointermove",this.onPointerHover),window.removeEventListener("pointermove",this.onPointerHover),this.domElement.removeEventListener("gesturestart",this.onGesture),this.domElement.removeEventListener("gesturechange",this.onGesture),this.domElement.removeEventListener("gestureend",this.onGesture),this.domElement.removeEventListener("touchend",this.onTouchEnd),this.domElement.removeEventListener("pointerleave",this.onPointerLeave),this.domElement.removeEventListener("pointerenter",this.onPointerEnter),window.removeEventListener("pointerleave",this.onPointerLeave),window.removeEventListener("pointerenter",this.onPointerEnter),this.domElement.removeEventListener("pointermove",this.onPointerMove),this.domElement.removeEventListener("pointerup",this.onPointerUp)}applyLimits(E,O,R,z,V,j,Y,ee){this.overShoot.set(0,0);let se,he,ce;E instanceof Wn?(se=E.x,he=E.y,this.current.set(this.target.x,this.target.y),ce=!0):(se=E.theta,he=E.phi,this.current.set(ia(this.spherical.theta),ia(this.spherical.phi)),ce=!1),R===0&&(this.current.x+=se,this.current.y+=he),(O===3||O===2)&&(!ce&&this.isThetaFlipped?this.current.x>z&&this.current.x<0?this.overShoot.x=z-this.current.x:this.current.x<V&&this.current.x>0&&(this.overShoot.x=V-this.current.x):this.current.x>z?this.overShoot.x=z-this.current.x:this.current.x<V&&(this.overShoot.x=V-this.current.x)),(O===3||O===1)&&(this.current.y>j?this.overShoot.y=j-this.current.y:this.current.y<Y&&(this.overShoot.y=Y-this.current.y)),ce||(this.overShoot.x=ia(this.overShoot.x),this.overShoot.y=ia(this.overShoot.y)),R!==0?(this.overRatio.copy(this.overShoot).divide(ee),this.overRatio.x=Math.min(Math.abs(this.overRatio.x),1),this.overRatio.y=Math.min(Math.abs(this.overRatio.y),1),R===1&&(this.overRatio.x=cF(Math.abs(this.overRatio.x)),this.overRatio.y=cF(Math.abs(this.overRatio.y))),this.isPointerDown||R===1?R===2&&(this.overRatio.x>.9&&!this.thetaIsFree||this.overRatio.y>.9&&!this.phiIsFree)?this.isPointerDown=!1:(se*this.overShoot.x<0&&!this.thetaIsFree&&(se*=1-this.overRatio.x),he*this.overShoot.y<0&&!this.phiIsFree&&(he*=1-this.overRatio.y)):R===2&&(!ce&&(this.overRatio.x>.002&&!this.thetaIsFree||this.overRatio.y>.002&&!this.phiIsFree)||ce&&(Math.abs(this.overShoot.x)>2||Math.abs(this.overShoot.y)>2)?(this.thetaIsFree||(se=this.overShoot.x*.05),this.phiIsFree||(he=this.overShoot.y*.05),ce?this.isPanOverShoot=!0:this.isRotateOverShoot=!0):ce?this.isPanOverShoot=!1:this.isRotateOverShoot=!1)):(se+=this.overShoot.x,he+=this.overShoot.y),E instanceof Wn?(E.x=se,E.y=he):(this.thetaIsFree||(E.theta=se),this.phiIsFree||(E.phi=he))}setEnableDampingSpeed(E){this.enableDamping=E,this.rotateSpeed=E===!0?.2:1}stopDamping(){this.sphericalDelta.theta=0,this.sphericalDelta.phi=0}getAutoRotationAngle(){return 2*Math.PI/60/60*this.autoRotateSpeed}getZoomScale(){return Math.pow(.95,this.zoomSpeed)}rotateLeft(E){this.sphericalDelta.theta-=E}rotateUp(E){this.sphericalDelta.phi-=E}panLeft(E,O){this.panLeftV.setFromMatrixColumn(O,0),this.panLeftV.multiplyScalar(-E),this.panOffset.add(this.panLeftV)}panUp(E,O){this.panUpV.setFromMatrixColumn(O,1),this.panUpV.multiplyScalar(E),this.panOffset.add(this.panUpV)}pan(E,O){let R=this.domElement;if(R&&this.object.isPerspectiveCamera){let z=this.object.position;this.panV.copy(z).sub(this.target);let V=this.panV.length();V*=Math.tan(this.object.fov/2*Math.PI/180),this.panLeft(2*E*V/R.clientHeight,this.object.matrixWorld),this.panUp(2*O*V/R.clientHeight,this.object.matrixWorld)}else R&&this.object.isOrthographicCamera&&(this.panLeft(E*(this.object.right-this.object.left)/this.object.zoom/R.clientWidth,this.object.matrixWorld),this.panUp(O*(this.object.top-this.object.bottom)/this.object.zoom/R.clientHeight,this.object.matrixWorld));this.dispatchEvent(k5)}dollyOut(E){this.object.isPerspectiveCamera?this.scale/=E:this.object.isOrthographicCamera&&(this.object.zoom*=E,this.zoomLimitsEnabled&&(this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom))),this.object.updateProjectionMatrix(),this.zoomChanged=!0),this.dispatchEvent(U5)}dollyIn(E){this.object.isPerspectiveCamera?this.scale*=E:this.object.isOrthographicCamera&&(this.object.zoom/=E,this.zoomLimitsEnabled&&(this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom))),this.object.updateProjectionMatrix(),this.zoomChanged=!0),this.dispatchEvent(U5)}zoomOut(E=this.getZoomScale()){this.dispatchEvent(j5),this.dollyOut(E),this.dispatchEvent(q5)}zoomIn(E=this.getZoomScale()){this.dispatchEvent(j5),this.dollyIn(E),this.dispatchEvent(q5)}setZoom(E){if(this.dispatchEvent(j5),this.object.isPerspectiveCamera){let O=this.initialSphericalRadius/E/this.spherical.radius;this.scale=O}else this.object.isOrthographicCamera&&(this.object.zoom=E,this.zoomLimitsEnabled&&(this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom))),this.object.updateProjectionMatrix(),this.zoomChanged=!0);this.dispatchEvent(q5)}handleMouseDownRotate(E){this.rotateStart.set(E.clientX,E.clientY)}handleMouseDownDolly(E){this.dollyStart.set(E.clientX,E.clientY)}handleMouseDownPan(E){this.panStart.set(E.clientX,E.clientY)}handleMouseMoveRotate(E,O=1){E.movementX!==void 0?this.rotateDelta.set(E.movementX,E.movementY):(this.rotateEnd.set(E.clientX,E.clientY),this.rotateDelta.subVectors(this.rotateEnd,this.rotateStart),this.rotateStart.copy(this.rotateEnd)),this.rotateDelta.multiplyScalar(this.rotateSpeed*O).rotateAround(K5,-this.object.angleOffsetFromUp);let R=this.domElement,z=this.useWindowEvents?window.innerHeight:R.clientHeight,V=2*Math.PI*this.rotateDelta.x/z,j=2*Math.PI*this.rotateDelta.y/z;this.rotateLeft(V),this.rotateUp(j),this.update()}handleMouseMoveDolly(E){this.dollyEnd.set(E.clientX,E.clientY),this.dollyDelta.subVectors(this.dollyEnd,this.dollyStart),this.dollyDelta.y>0?this.dollyOut(this.getZoomScale()):this.dollyDelta.y<0&&this.dollyIn(this.getZoomScale()),this.dollyStart.copy(this.dollyEnd),this.update()}handleMouseMovePan(E,O=1){E.movementX!==void 0?this.panDelta.set(E.movementX,E.movementY):(this.panEnd.set(E.clientX,E.clientY),this.panDelta.subVectors(this.panEnd,this.panStart),this.panStart.copy(this.panEnd)),this.panDelta.multiplyScalar(this.panSpeed*O),this.pan(this.panDelta.x,this.panDelta.y),this.update()}handleMouseWheel(E){if(AM===!1&&Gp(E)===!1&&dI(E)===!0){if(this.enablePan===!1)return;this.gesture?(this.panDelta.set(-E.deltaX,-E.deltaY).multiplyScalar(this.panSpeed),this.panDelta.x=Math.min(Math.abs(this.panDelta.x),100)*(this.panDelta.x<0?-1:1),this.panDelta.y=Math.min(Math.abs(this.panDelta.y),100)*(this.panDelta.y<0?-1:1),E.altKey?this.pan(0,this.panDelta.y):E.shiftKey?this.pan(this.panDelta.x,0):this.pan(this.panDelta.x,this.panDelta.y),this.update()):(this.gesture=!0,this.isPointerDown=!0),window.clearTimeout(this.timer),this.timer=window.setTimeout((()=>{this.gesture=!1,this.isPointerDown=!1}),30)}else{if(this.enableZoom===!1||this.gesture)return;E.deltaY===0?E.deltaX<0?this.dollyIn(this.getZoomScale()):E.deltaX>0&&this.dollyOut(this.getZoomScale()):E.deltaY<0?this.dollyIn(this.getZoomScale()):E.deltaY>0&&this.dollyOut(this.getZoomScale()),this.update(),this.gesture=!1,this.isPointerDown=!1}}handleTouchStartRotate(){if(TM.length===2){let E=.5*(TM[0].pageX+TM[1].pageX),O=.5*(TM[0].pageY+TM[1].pageY);this.rotateStart.set(E,O)}else this.rotateStart.set(TM[0].pageX,TM[0].pageY)}handleTouchStartPan(){if(TM.length===2){let E=.5*(TM[0].pageX+TM[1].pageX),O=.5*(TM[0].pageY+TM[1].pageY);this.panStart.set(E,O)}else this.panStart.set(TM[0].pageX,TM[0].pageY)}handleTouchStartDolly(){let E=TM[0].pageX-TM[1].pageX,O=TM[0].pageY-TM[1].pageY,R=Math.sqrt(E*E+O*O);this.dollyStart.set(0,R)}handleTouchStartDollyPan(){this.enableZoom&&this.isTouchZoom===!0&&this.handleTouchStartDolly(),this.enablePan&&this.handleTouchStartPan()}handleTouchStartDollyRotate(){this.enableZoom&&this.isTouchZoom===!0&&this.handleTouchStartDolly(),this.enableRotate&&this.handleTouchStartRotate()}handleTouchMoveRotate(E){if(TM.length===2){let O=Sv(E),R=.5*(E.pageX+O.x),z=.5*(E.pageY+O.y);this.rotateEnd.set(R,z)}else{if(E.pointerId!==TM[0].pointerId)return;this.rotateEnd.set(E.pageX,E.pageY)}this.rotateDelta.subVectors(this.rotateEnd,this.rotateStart).multiplyScalar(this.rotateSpeed);let O=this.domElement;O&&(this.rotateLeft(2*Math.PI*this.rotateDelta.x/O.clientHeight),this.rotateUp(2*Math.PI*this.rotateDelta.y/O.clientHeight)),this.rotateStart.copy(this.rotateEnd)}handleTouchMovePan(E){if(TM.length===2){let O=Sv(E),R=.5*(E.pageX+O.x),z=.5*(E.pageY+O.y);this.panEnd.set(R,z)}else{if(E.pointerId!==TM[0].pointerId)return;this.panEnd.set(E.pageX,E.pageY)}this.panDelta.subVectors(this.panEnd,this.panStart).multiplyScalar(this.panSpeed),this.pan(this.panDelta.x,this.panDelta.y),this.panStart.copy(this.panEnd)}handleTouchMoveDolly(E){let O=Sv(E),R=E.pageX-O.x,z=E.pageY-O.y,V=Math.sqrt(R*R+z*z);this.dollyEnd.set(0,V),this.dollyDelta.set(0,Math.pow(this.dollyEnd.y/this.dollyStart.y,this.zoomSpeed)),this.dollyOut(this.dollyDelta.y),this.dollyStart.copy(this.dollyEnd)}handleTouchMoveDollyPan(E){this.enableZoom&&this.isTouchZoom===!0&&this.handleTouchMoveDolly(E),this.enablePan&&this.handleTouchMovePan(E)}handleTouchMoveDollyRotate(E){this.enableZoom&&this.isTouchZoom===!0&&this.handleTouchMoveDolly(E),this.enableRotate&&this.handleTouchMoveRotate(E)}checkRaycastLock(){if(this.object.data.raycastLock){if(this.options.isPlayMode)return!1;{let E=this.options?.showCameraLock;return E&&E(),!0}}return!1}};function ia(E){let O=Math.PI*2;for(;E<=-Math.PI;)E+=O;for(;E>Math.PI;)E-=O;return E}function cF(E){return 1-Math.pow(1-E,4)}var g6=class{constructor(E,O,R,z,V,j){this.id=E;this.data=O;this.object=R;this.page=z;this.currentIntersectedObjects=[];this.actions=Ht(O,O.actions,z,V,j,R),this.target=O.target,this.triggeringObjects=[];for(let E of O.triggeringObjects){let O=z.scene.find(E);O&&this.triggeringObjects.push(O)}}isValidTriggeringObject(E){return this.target==="all"||this.triggeringObjects.some((O=>O===E||O.isAncestorOf(E.uuid)||E.isAncestorOf(O.uuid)))}disconnect(){dr(this.actions)}dispatch(){this.object.destroyedInAction||(this.actions.Transition.forEach((E=>{E.object.currentTransitionEvent!==this&&(E.object.currentTransitionEvent=this,E.init())})),this.object.dispatchEvent({type:"beginEvent",eventName:"Trigger"}),this.actions.Transition.forEach((E=>{E.data.runMode==="Toggle"?E.toggle():E.play()})),this.actions.SwitchCamera.forEach((E=>{E.data.runMode==="Toggle"?E.toggle():E.play()})),this.actions.Link.forEach((E=>{E.dispatch()})),this.actions.Reset.forEach((E=>{E.dispatch()})),this.actions.Create.forEach((E=>{E.dispatch()})),this.actions.Destroy.forEach((E=>{E.dispatch(!1)})),this.actions.Audio.forEach((E=>{E.dispatchBasic()})),this.actions.Particles.forEach((E=>{E.dispatchBasic()})),this.actions.Video.forEach((E=>{E.dispatchBasic()})),this.actions.SceneTransition.forEach((E=>{E.dispatch()})),this.actions.SetVariable.forEach((E=>E.checkConditions())),this.actions.SetVariable.forEach((E=>E.dispatch())),this.actions.DynamicVariablePlay.forEach((E=>E.dispatch())),this.actions.ClearLocalStorage.forEach((E=>E.dispatch())),this.actions.UserAPI.forEach((E=>E.dispatch())))}};var v6;zM.then((E=>v6=E));var y6=new Wn,x6=new Hn,b6=new Wn,w6=new zs(0,0,0,"YXZ"),S6=new zs(0,0,0,"XYZ"),A6=new Wn,T6=new Wn,P6=new Wn(1,1,1),O6=new Hn,R6=new Es,L6=new Es,B6={type:"updateMatrix"},z6=new Hn,F6=new ps,N6={type:"beginEvent",eventName:"Collision"},U6={type:"beginEvent",eventName:"Trigger"};function fF(E){if(MD.physicsEnabled(E.scene.objects))return!0;let O=!1;return E.scene.objects.traverse(((E,R)=>{if(R.events)if(Array.isArray(R.events)){for(let E of R.events)if(E.data.disabled!==!0&&E.data.type==="GameControl"&&E.data.collisionEnabled){O=!0;break}}else for(let E of Object.values(R.events))if(E.disabled!==!0&&E.type==="GameControl"&&E.collisionEnabled){O=!0;break}})),O}var Cg=E=>E.states.some((E=>E.data.position!==void 0||E.data.rotation!==void 0||E.data.hiddenMatrix!==void 0||E.data.cloner!==void 0||E.data.pathSnapping!==void 0)),k6=class{constructor(E){this.eventContext=E;this.isEnabled=!1;this.gameControl=null;this.joysticks=[];this.joystickToGameControls=[];this.sharedGameControlGlobals={entitiesWithTransformAnim:[],entityToCollisionEvents:{},colliderToEntity:new Map,triggers:[],gamePads:[],createdObjects:[],nCreatedPerAction:{}};this.sensorToTriggerEvent={};this.eventManager=void 0;this.needsCollisionDetection=!1;this.initializationCounter=-1;this.rigidBodyToMesh=new Map;this.nActiveRigidBodies=0;this.collisionEvents=[];this.isExport=!1;this.processRigidBody=E=>{if(E.bodyType()!==v6.RigidBodyType.Dynamic)return;E.isSleeping()||this.nActiveRigidBodies++;let[O,R,z]=this.rigidBodyToMesh.get(E.handle);if(y6.copy(E.translation()).multiplyScalar(this.pixelsPerMeter),x6.copy(E.rotation()),O.matrixWorld.compose(y6,x6,R),O.hasNonUniformScale&&O.matrixWorld.multiply(O.shearScale),O.dispatchEvent(B6),z){let E=O.cloner;if(E&&E.objectForSample===void 0){E.matrixWorld.copy(O.matrixWorld);for(let O of E.children)O.updateMatrixWorld(!0)}for(let E of O.children)E.updateMatrixWorld(!0)}};this.accumulator=0;this.handleCollisionEvents=(E,O,R)=>{if(R===!1)return;let z,V;if(this.sensorToTriggerEvent[E]?(z=this.sensorToTriggerEvent[E],V=this.sharedGameControlGlobals.colliderToEntity.get(O)):this.sensorToTriggerEvent[O]&&(z=this.sensorToTriggerEvent[O],V=this.sharedGameControlGlobals.colliderToEntity.get(E)),z&&V&&z.isValidTriggeringObject(V))z.dispatch();else{for(let R=this.sharedGameControlGlobals.createdObjects.length-1;R>=0;R--){let z=this.sharedGameControlGlobals.createdObjects[R];if(z.userData.hasCollisionDestroy&&(z.rigidBody?.collider(0).handle===E||z.rigidBody?.collider(0).handle===O)){this.sharedGameControlGlobals.createdObjects.splice(R,1),z.removeFromParent(),requestAnimationFrame((()=>this.sharedGameControlGlobals.rapierWorld?.removeRigidBody(z.rigidBody)));break}}if(this.gameControl?.object!==void 0&&this.gameControl.object===this.sharedGameControlGlobals.colliderToEntity.get(E)){let E=this.sharedGameControlGlobals.colliderToEntity.get(O),R=this.sharedGameControlGlobals.entityToCollisionEvents[E.uuid];if(R===void 0)return;for(let z of R)z.data.target==="character"&&this.dispatchCollisionEvent(z,E,O)}else if(this.gameControl?.object!==void 0&&this.gameControl.object===this.sharedGameControlGlobals.colliderToEntity.get(O)){let O=this.sharedGameControlGlobals.colliderToEntity.get(E),R=this.sharedGameControlGlobals.entityToCollisionEvents[O.uuid];if(R===void 0)return;for(let z of R)z.data.target==="character"&&this.dispatchCollisionEvent(z,O,E)}else{let R=this.sharedGameControlGlobals.colliderToEntity.get(E),z=this.sharedGameControlGlobals.entityToCollisionEvents[R.uuid];if(z!==void 0)for(let O of z)O.data.target==="scene"&&this.dispatchCollisionEvent(O,R,E);let V=this.sharedGameControlGlobals.colliderToEntity.get(O),j=this.sharedGameControlGlobals.entityToCollisionEvents[V?.uuid];if(j!==void 0)for(let E of j)E.data.target==="scene"&&this.dispatchCollisionEvent(E,V,O)}}};this.isExport=E.isExport,this.sharedAssets=E.sharedAssets,this.renderer=E.renderer,this.requestRender=E.requestRender,this.domElement=this.renderer.domElement,this.pixelsPerMeter=d2,this.gravity=this.page.data.globalPhysics.gravity}get page(){return this.eventContext.page}attachVRControllers(E){E.forEach((E=>{E.addEventListener("connected",(E=>{"gamepad"in E.data&&"axes"in E.data.gamepad&&this.sharedGameControlGlobals.gamePads.push(E.data.gamepad)}))}))}markIsDestroyTarget(){this.page.traverseVisibleEntity((E=>{let O=E.dataPatched;for(let E of O.events){if(E.data.disabled===!0)continue;let O=E.data.actions?.find((E=>E.data.type==="Destroy"))?.data;if(O)for(let E of O.objects){let O=this.page.scene.find(E);O&&(O.userData.hasDestroy=!0)}}}))}markIsDragObject(){this.page.traverseVisibleEntity((E=>{let O=E.dataPatched;for(let E of O.events)if(!(E.data.disabled===!0||E.data.type!=="DragDrop"))for(let O of E.data.objects){let E=this.page.scene.find(O);E&&(E.userData.hasDrag=!0)}}))}initBVH(){let E=[];if(this.page.traverseChildren((O=>{let R,z=O instanceof AW,V=O instanceof Q$;if(O instanceof SH||z||V)return;R=O instanceof HR?O.object:O;let j=R.dataPatched;if(j.physics?.enabled==="visibility"?!j.visible:!j.physics?.enabled)return!0;let Y=O.geometry,ee=R.userData.hasDestroy===!0,se=R.userData.hasDrag===!0;if(Cg(j)||ee||se||R.dataPatched.events.some((E=>E.data.disabled!==!0&&(E.data.type==="GameControl"||E.data.type==="Follow"))))return O.updateMatrixWorldSVD(),this.addBoundsTree(O),!0;Y&&E.push(oo(Y,O.matrixWorld))})),E.length>0){let O=js(E,!1);this.sharedGameControlGlobals.staticMeshBVH=new bR(O)}}addRigidBody(E,O,R){if(tM(E.matrixWorld))return;let z=[],V="geometry"in E?E.geometry:void 0,j=O.dataPatched;if(V?.getAttribute("position")!==void 0&&z.push(oo(V,E.shearScale)),j.physics.fusedBody){let O=this.gatherChildrenGeom(E,z);E.traverseObject(O),E.children.forEach((E=>E.updateMatrixWorld(!0)));let R=E.cloner;R&&R.objectForSample===void 0&&j.physics.rigidBody==="dynamic"&&(R.traverseObject(O),R.children.forEach((E=>E.updateMatrixWorld(!0))))}if(z.length>0){let Y,ee=!R.fromCreate&&j.physics.rigidBody==="dynamic"||R.fromCreate&&R.dynamic;ee?(Y=v6.RigidBodyDesc.dynamic(),Y.setLinearDamping(j.physics.damping).setAngularDamping(j.physics.damping).setAdditionalMass(1e-9).setGravityScale(j.physics.gravityScale).enabledRotations(...j.physics.enabledRotation).enabledTranslations(...j.physics.enabledTranslation)):(R.hasTransformAnim||R.hasFollow||R.hasDrag)&&!R.fromCreate?(Y=v6.RigidBodyDesc.kinematicPositionBased(),this.sharedGameControlGlobals.entitiesWithTransformAnim.push(E)):Y=v6.RigidBodyDesc.fixed();let se=js(z);(E.hasNonUniformScale?E.matrixWorldRigid:E.matrixWorld).decompose(y6,x6,b6),E.position0=y6.clone().divideScalar(this.pixelsPerMeter),E.rotation0=x6.clone(),y6.divideScalar(this.pixelsPerMeter),Y.setTranslation(y6.x,y6.y,y6.z).setRotation(x6),V?se?.scale(1/this.pixelsPerMeter,1/this.pixelsPerMeter,1/this.pixelsPerMeter):se?.scale(b6.x/this.pixelsPerMeter,b6.y/this.pixelsPerMeter,b6.z/this.pixelsPerMeter);let he=this.sharedGameControlGlobals.rapierWorld.createRigidBody(Y);ee&&this.rigidBodyToMesh.set(he.handle,[E,b6.clone(),j.physics.fusedBody]);let ce=!(j.geometry===void 0||j.geometry.type==="SubdivGeometry"||j.geometry.type==="NonParametricGeometry"||j.geometry.type==="BooleanGeometry"||j.geometry.type==="VectorGeometry"||j.geometry.type==="StarGeometry"||j.geometry.type==="RectangleGeometry"||j.geometry.type==="EllipseGeometry"||j.geometry.type==="TriangleGeometry"||j.geometry.type==="TorusGeometry"||j.geometry.type==="HelixGeometry");try{this.addCollider(he,j.physics,se,O,ce)}catch{try{this.addCollider(he,j.physics,se,O,!1)}catch(E){console.error(E)}}E.rigidBody=he}}addBoundsTree(E){let O=[];if(E.geometry?.getAttribute("position")!==void 0&&E.geometry?.getAttribute("position").count>0&&O.push(oo(E.geometry,E.shearScale)),E.traverseObject(this.gatherChildrenGeom(E,O)),E.children.forEach((E=>E.updateMatrixWorld(!0))),O.length>0){let R=js(O,!1);E.bvhGeometry=R,R.getAttribute("position").count>0&&(E.bvhGeometry.boundsTree=new bR(R),this.sharedGameControlGlobals.entitiesWithTransformAnim.push(E))}}addCollider(E,O,R,z,V=!0){if(R?.getAttribute("position").count===0||R?.getIndex()?.count===0)return;let j;R&&(j=O.colliderType==="trimesh"?v6.ColliderDesc.trimesh(R.getAttribute("position").array,R.getIndex().array):v6.ColliderDesc.convexMesh(R.getAttribute("position").array,V?R.getIndex().array:void 0)),j.setFrictionCombineRule(v6.CoefficientCombineRule.Average).setRestitutionCombineRule(v6.CoefficientCombineRule.Average).setDensity(O.density).setFriction(O.friction).setRestitution(O.restitution);let Y=this.sharedGameControlGlobals.rapierWorld.createCollider(j,E);this.sharedGameControlGlobals.colliderToEntity.set(Y.handle,z),this.sharedGameControlGlobals.entityToCollisionEvents[z.uuid]?.some((E=>E.target==="scene"))&&Y.setActiveEvents(v6.ActiveEvents.COLLISION_EVENTS)}gatherChildrenGeom(E,O){return(R,z)=>{if(z===0)return;let V;if(R instanceof SH){if(!R.objectForSample)return R.object.dataPatched.physics.fusedBody===!0&&R.object.dataPatched.physics.rigidBody==="dynamic"||void 0;if(R.objectForSample.dataPatched.physics.fusedBody)return;V=R.object}else if(R instanceof HR)V=R.object;else if(V=R,V.dataPatched.cloner?.hideBase)return!0;let j=V.dataPatched;if(j.physics.enabled==="visibility"?!j.visible:!j.physics.enabled)return!0;z===1?E.hasNonUniformScale?R.matrixWorld.multiplyMatrices(E.shearScale,R.hiddenMatrix):R.matrixWorld.copy(R.hiddenMatrix):R.matrixWorld.multiplyMatrices(R.parent.matrixWorld,R.hiddenMatrix),R.matrixWorld.multiply(R.matrix);let Y=R.geometry;Y?.getAttribute("position")!==void 0&&O.push(oo(Y,R.matrixWorld))}}activate(E){if(this.isEnabled)return;this.isEnabled=!0,this.eventManager=E,this.usePhysics=this.page.data.globalPhysics.usePhysics;let O=this.page.playCamera,R=!1,z=5,V=8,j=9,Y="drag",ee=this.page.data.publish.gameControlObject,se=ee!==null?this.page.find(ee):null,he=null;if(se)for(let E of se.data.events){if(E.data.disabled||E.data.type!=="GameControl")continue;let O=se;for(;this.usePhysics&&(O=O.parent)?.parent!==null;)O.data.physics?.fusedBody;E.data.collisionEnabled&&(this.needsCollisionDetection=!0),he===null&&(he=E.data)}if(this.page.traverseEntity((E=>{for(let O of E.dataPatched.events)if(O.data.disabled===!1&&O.data.type==="Trigger")return this.needsCollisionDetection=!0,!0})),se&&he&&(se.data.visible===!0||se.data.physics.enabled===!0)){R=R||he.camera===O.uuid||se.uuid===O.uuid;let E=new j2(se,this.renderer.domElement,he,this.eventContext.page.data.globalPhysics,this,se.uuid!==O.uuid&&he.camera===O.uuid,O,this.page,this.sharedAssets);this.gameControl=E,z=he.joystickPosLoc,V=he.joystickRotLoc,j=he.jumpTouchButtonLoc,Y=he.rotByTouch,MM&&he.touchControl&&(this.joystickToGameControls[z]="pos",he.moveMode==="walk"&&(this.joystickToGameControls[j]="jmp"),Y==="joystick"&&(this.joystickToGameControls[V]="rot"))}if(this.gameControl&&this.gameControl.data.navmesh.enabled){let E=this.gameControl.data;if(!this.navigationMeshWrapper){this.navigationMeshWrapper=new R5(this.usePhysics,this.isExport);let O;O=E.collider.type==="sphere"?E.collider.radius*2:E.collider.height,O=Math.floor(O/E.navmesh.ch-1),this.navigationMeshWrapper.init({...E.navmesh,walkableHeight:O},this.gameControl,this.eventContext)}}if(R===!1){let{enableRotate:E,enablePan:R,enableZoom:z,autoRotate:V,hoverRotatePanMode:j}=this.eventManager.publish.orbitControls;(E||R||z||V||j!==0)&&(this.orbitControls=new m6(O,this.renderer.domElement,{isExport:this.isExport,isPlayMode:!0}),this.orbitControls.addEventListener("change",this.requestRender),this.orbitControls.addEventListener("end",this.requestRender),this.orbitControls.addEventListener("start",this.requestRender),this.orbitControls.fromJSON(this.eventManager.publish.orbitControls,this.eventManager.publish.mouseEventTarget),this.orbitControls.useKeyEvents=!1,this.orbitControls.addEventListenersToCamera(),this.orbitControls.connect(),this.orbitControls.update())}let ce=this.renderer.domElement.width/this.renderer.getPixelRatio(),ue=this.renderer.domElement.height/this.renderer.getPixelRatio();this.joystickToGameControls.forEach(((E,O)=>{let R=document.body.appendChild(document.createElement("div")),[z,V,j]=this.eventManager.eventContext.publish.joystickSizeAndXYOffset[O],Y=(ce-5*z)/4+z,ee={},se=E==="jmp",he=se?0:z;O<10?(O<5?ee.top=he/2:ee.bottom=he/2,ee.left=he/2+O%5*Y):O===10?(ee.left=he/2,ee.top=ue/2):(ee.right=he/2,ee.top=ue/2),ee.top?ee.top-=V[1]:ee.bottom+=V[1],ee.left?ee.left+=V[0]:ee.right-=V[0];for(let E in ee)ee[E]+="px";if(se){let E=R.appendChild(document.createElement("div"));Object.assign(E.style,ee,{position:"absolute",width:z+"px",height:z+"px",backgroundColor:`rgba(255,255,255,${j==="show"?.4:0})`,zIndex:"9999",borderRadius:z+"px",border:j==="show"?"solid 2px rgba(0, 0, 0, .1)":"none",display:"flex",alignItems:"center",justifyContent:"center",touchAction:"none"});let V=z/16*16*.4;j==="show"&&(E.innerHTML=`\n\t\t\t\t\t\t<svg width="${V}" height="${z*.4}" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">\n\t\t\t\t\t\t\t<path d="M2 10L8 4L14 10" stroke="black" stroke-opacity="40%" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t`),E.addEventListener("pointerdown",(()=>{this.gameControl.movementState.jump=1,this.requestRender()})),E.addEventListener("touchend",(E=>E.preventDefault())),this.joysticks[O]=[void 0,R];return}let fe={zone:R,mode:"static",position:ee,size:z};j==="hide"&&(fe.restOpacity=0);let ve=r1.create(fe);ve.on("move",((O,R)=>{let z=this.gameControl;E==="pos"?R.force<.2?z.moveForce=0:(z.movementState.movePosZ=Math.sin(-R.angle.radian),z.movementState.movePosX=Math.cos(-R.angle.radian),R.force>1.2?z.movementState.run=1:z.movementState.run=0,R.force<.3?z.moveForce=(R.force-.2)/.1:z.moveForce=1):E==="rot"&&(R.force<.2?z.rotForce=0:(z.movementState.rotPosX=R.vector.y,z.movementState.rotPosY=-R.vector.x,R.force<.3?z.rotForce=(R.force-.2)/.1:z.rotForce=1)),this.requestRender()})),ve.on("end",((O,R)=>{let z=this.gameControl;E==="pos"?(z.movementState.movePosZ=0,z.movementState.movePosX=0,z.moveForce=1):E==="rot"&&(z.movementState.rotPosX=0,z.movementState.rotPosY=0,z.rotForce=1)})),this.joysticks[O]=[ve,R]})),this.markIsDestroyTarget(),this.markIsDragObject(),this.rebuildBVH(),this.initializationCounter++,window.setTimeout((()=>{this.collisionEvents.forEach((E=>E.initialDisabled=!1))}),80)}initPhysics(){this.sharedGameControlGlobals.rapierWorld?.free(),this.sharedGameControlGlobals.rapierWorld=new v6.World(new v6.Vector3(0,this.gravity,0)),this.events=new v6.EventQueue(!0);let E=[],O=[];if(this.page.traverseChildren((R=>{let z;if(R instanceof SH){if(!R.objectForSample)return R.object.dataPatched.physics.fusedBody===!0&&R.object.dataPatched.physics.rigidBody==="dynamic"||void 0;if(R.objectForSample.dataPatched.physics.fusedBody)return;z=R.object}else if(R instanceof HR)z=R.object;else{if(R instanceof Q$||R instanceof AW)return;if(z=R,z.dataPatched.cloner?.disabled===!1&&z.dataPatched.cloner?.hideBase&&z.dataPatched.physics?.fusedBody!==!0)return!0}let V,j=z.dataPatched;for(let E of j.events)E.data.disabled!==!0&&E.data.type==="GameControl"&&(V=E.data);if(!j.physics||(j.physics.enabled==="visibility"?!j.visible:!j.physics.enabled))return!0;R.updateMatrixWorldSVD();let Y=Cg(j),ee=!1,se=z.userData.hasDestroy,he=z.userData.hasDrag,ce=!1;for(let E of j.events)if(E.data.disabled!==!0)if(E.data.type==="Collision"){ee=!0;let O=new f5(E.id,E.data,z,this.page,this.sharedAssets,this.eventManager);O.initialDisabled=!0,this.collisionEvents.push(O),this.sharedGameControlGlobals.entityToCollisionEvents[z.uuid]&&this.sharedGameControlGlobals.entityToCollisionEvents[z.uuid].every((O=>O.id!==E.id))?this.sharedGameControlGlobals.entityToCollisionEvents[z.uuid].push(O):this.sharedGameControlGlobals.entityToCollisionEvents[z.uuid]=[O]}else if(E.data.type==="Follow"){ce=!0;let O=E.data.target;R.traverseVisible((E=>{E.userData.isFollowingObj=O}))}j.physics.rigidBody==="dynamic"&&j.physics.fusedBody===!1&&(R.matrixWorldFusedFalse=R.matrixWorld.clone());let ue=R.geometry;if(V!==void 0){let E=v6.RigidBodyDesc.kinematicPositionBased();(R.hasNonUniformScale?R.matrixWorldRigid:R.matrixWorld).decompose(y6,x6,b6),R.position0=y6.clone().divideScalar(this.pixelsPerMeter),R.rotation0=x6.clone(),y6.divideScalar(this.pixelsPerMeter),E.setTranslation(y6.x,y6.y,y6.z).setRotation(x6);let O=this.sharedGameControlGlobals.rapierWorld.createRigidBody(E);R.rigidBody=O;let Y;Y=V.collider.type==="sphere"?v6.ColliderDesc.ball(V.collider.radius/this.pixelsPerMeter):V.collider.type==="capsule"?v6.ColliderDesc.capsule((V.collider.height/2-V.collider.radius)/this.pixelsPerMeter,V.collider.radius/this.pixelsPerMeter):v6.ColliderDesc.cuboid(V.collider.width/this.pixelsPerMeter/2,V.collider.height/this.pixelsPerMeter/2,V.collider.depth/this.pixelsPerMeter/2),Y.setFrictionCombineRule(v6.CoefficientCombineRule.Average).setRestitutionCombineRule(v6.CoefficientCombineRule.Average).setDensity(j.physics.density).setFriction(j.physics.friction).setRestitution(j.physics.restitution);let ee=this.sharedGameControlGlobals.rapierWorld.createCollider(Y,O);this.sharedGameControlGlobals.colliderToEntity.set(ee.handle,z),y6.fromArray(V.collider.position).multiply(b6.setFromMatrixScale(z.matrixWorld)).divideScalar(this.pixelsPerMeter),ee.setTranslationWrtParent(y6);let se=(new Hn).setFromEuler((new zs).setFromVector3((new Wn).fromArray(V.collider.rotation)));ee.setRotationWrtParent(se),ee.setActiveEvents(v6.ActiveEvents.COLLISION_EVENTS),this.generateSensorColliderDescs(z,!0)}else j.physics.rigidBody==="dynamic"||Y||ce||se||he||ee?(this.addRigidBody(R,z,{hasFollow:ce,hasTransformAnim:Y,hasDrag:he}),this.generateSensorColliderDescs(z,j.physics.fusedBody)):(ue&&E.push(oo(ue,R.matrixWorld)),j.physics.fusedBody&&R.traverseObject(((O,R)=>{if(R===0)return;let z;if(O instanceof SH){if(!O.objectForSample)return O.object.dataPatched.physics.fusedBody===!0&&O.object.dataPatched.physics.rigidBody==="dynamic"||void 0;if(O.objectForSample.dataPatched.physics.fusedBody)return;z=O.object}else{if(O instanceof Q$||O instanceof AW)return;if(O instanceof HR)z=O.object;else if(z=O,z.dataPatched.cloner?.hideBase)return!0}let V=z.dataPatched;if(V.physics.enabled==="visibility"?!V.visible:!V.physics.enabled)return!0;let j=O.geometry;j?.getAttribute("position")!==void 0&&E.push(oo(j,O.matrixWorld))})),this.generateSensorColliderDescs(z,j.physics.fusedBody,O));return!(j.physics?.fusedBody!==!0&&!V)||void 0})),E.length===0)return;let R=js(E);R.scale(1/this.pixelsPerMeter,1/this.pixelsPerMeter,1/this.pixelsPerMeter);let z=v6.RigidBodyDesc.fixed(),V=this.sharedGameControlGlobals.rapierWorld.createRigidBody(z),j=v6.ColliderDesc.trimesh(R.getAttribute("position").array,R.getIndex().array).setFrictionCombineRule(v6.CoefficientCombineRule.Multiply).setRestitutionCombineRule(v6.CoefficientCombineRule.Multiply).setFriction(1).setRestitution(1);this.sharedGameControlGlobals.rapierWorld.createCollider(j,V);for(let[E,R]of O){let O=this.sharedGameControlGlobals.rapierWorld.createCollider(E,V);this.sensorToTriggerEvent[O.handle]=R}}updatePositions(){return this.nActiveRigidBodies=0,this.sharedGameControlGlobals.rapierWorld.forEachRigidBody(this.processRigidBody),this.nActiveRigidBodies>0}rebuildBVH(){this.usePhysics?this.initPhysics():(this.page.traverseEntity((E=>{for(let O of E.dataPatched.events)if(O.data.type==="Trigger"&&O.data.disabled!==!0){let R=new g6(O.id,O.data,E,this.page,this.sharedAssets,this.eventManager),z=(new Es).compose(A6.fromArray(O.data.position),O6.setFromEuler(S6.fromArray(O.data.rotation)),P6);if(O.data.triggerZone==="box"){let V=new Yn;V.min.fromArray(O.data.size).multiplyScalar(-.5),V.max.fromArray(O.data.size).multiplyScalar(.5),this.sharedGameControlGlobals.triggers.push([V,z,E,R])}else this.sharedGameControlGlobals.triggers.push([O.data.radius,z,E,R])}})),this.needsCollisionDetection&&this.initBVH())}disconnectEvents(){this.collisionEvents.forEach((E=>E.disconnect())),this.sharedGameControlGlobals.triggers.forEach((E=>E[3].disconnect())),this.sharedGameControlGlobals.triggers.length=0}deactivate(){if(!!this.isEnabled){this.isEnabled=!1,this.page.traverse((E=>{let O=E;O.matrixWorldFusedFalse&&(O.matrixWorldFusedFalse=void 0),O.rigidBody&&(O.rigidBody=void 0),O.position0&&(O.position0=void 0),O.rotation0&&(O.rotation0=void 0)})),this.sharedGameControlGlobals.rapierWorld?.free(),this.sharedGameControlGlobals.rapierWorld=void 0,this.sharedGameControlGlobals.staticMeshBVH=void 0,this.accumulator=0,this.sharedGameControlGlobals.entitiesWithTransformAnim=[],this.disconnectEvents(),this.gameControl?.reset(),this.gameControl?.dispose(),this.gameControl=null,this.initializationCounter=-1,this.joysticks.forEach((([E,O])=>{E?.destroy(),O.remove()})),this.joystickToGameControls=[],this.joysticks=[],this.orbitControls&&(this.orbitControls.dispose(),this.orbitControls=void 0),this.navigationMeshWrapper?.dispose(),this.navigationMeshWrapper=void 0;for(let E of Object.values(this.sharedGameControlGlobals.entityToCollisionEvents))E.forEach((E=>E.disconnect()));this.sharedGameControlGlobals.entityToCollisionEvents={},this.page.updateMatrixWorld(!0)}}update(E,O,R){if(!this.isEnabled)return!0;let z=!0;if(this.orbitControls!==void 0&&this.orbitControls.needsUpdate&&(z=!this.orbitControls.update()),this.initializationCounter>=0&&this.initializationCounter<2?(this.initializationCounter++,z=!1):this.initializationCounter===2&&this.gameControl&&(z=!this.gameControl.update(E,O,R)&&z),this.usePhysics===!1&&this.checkTrigger(),this.usePhysics){let O=.016666666666666666;if(E===0)z=this.stepPhysics()&&z;else{let R=E/1e3;R<O&&R>O*.55&&(R=O),this.accumulator+=R;let V=performance.now(),j=0,Y=6;for(;this.accumulator>=O&&j<Y&&(z=this.stepPhysics()&&z,this.accumulator-=O,j++,!(performance.now()-V>O*1e3)););this.accumulator=this.accumulator%O}}return z}stepPhysics(){for(let E of this.sharedGameControlGlobals.entitiesWithTransformAnim){(E.hasNonUniformScale?E.matrixWorldRigid:E.matrixWorld).decompose(y6,x6,b6),w6.setFromQuaternion(x6);let O=E;O.prevR===void 0?(O.prevR=w6.clone(),O.prevT=y6.clone()):(O.prevR.copy(w6),O.prevT.copy(y6)),E.rigidBody&&(E.rigidBody.setNextKinematicTranslation(y6.divideScalar(this.pixelsPerMeter)),E.rigidBody.setNextKinematicRotation(x6))}return this.sharedGameControlGlobals.rapierWorld.step(this.events),this.events?.drainCollisionEvents(this.handleCollisionEvents),!this.updatePositions()}dispatchCollisionEvent(E,O,R){let z,V=(this.sharedGameControlGlobals.rapierWorld?.getCollider(R))._parent;if(O.cloner)for(let E of O.cloner.children)if(E.rigidBody===V){z=E;break}E.dispatch(z),O.dispatchEvent(N6)}updateUseWindowEvents(E){this.orbitControls?.updateUseWindowEvents(E)}generateSensorColliderDescs(E,O,R){let z=L6.copy(E.matrixWorld).invert();E.traverseEntity(((V,j)=>{if(O===!1&&j===1)return!0;for(let O of V.dataPatched.events)if(O.data.type==="Trigger"&&O.data.disabled!==!0){let j,Y=new g6(O.id,O.data,V,this.page,this.sharedAssets,this.eventManager);if(j=O.data.triggerZone==="box"?v6.ColliderDesc.cuboid(...O.data.size.map((E=>E/(2*this.pixelsPerMeter)))):v6.ColliderDesc.ball(O.data.radius/this.pixelsPerMeter),j.setDensity(0).setSensor(!0).setActiveEvents(v6.ActiveEvents.COLLISION_EVENTS),A6.fromArray(O.data.position),O6.setFromEuler(S6.fromArray(O.data.rotation)),R6.compose(A6,O6,P6).premultiply(V.matrixWorld),R?(R6.decompose(A6,O6,T6),j.setActiveCollisionTypes(v6.ActiveCollisionTypes.KINEMATIC_FIXED|v6.ActiveCollisionTypes.DYNAMIC_FIXED)):(R6.premultiply(z).decompose(A6,O6,T6),E.rigidBody.bodyType()===v6.RigidBodyType.Dynamic||(E.rigidBody.bodyType()===v6.RigidBodyType.Fixed?j.setActiveCollisionTypes(v6.ActiveCollisionTypes.KINEMATIC_FIXED|v6.ActiveCollisionTypes.DYNAMIC_FIXED):j.setActiveCollisionTypes(v6.ActiveCollisionTypes.KINEMATIC_KINEMATIC|v6.ActiveCollisionTypes.DYNAMIC_KINEMATIC))),A6.divideScalar(this.pixelsPerMeter),j.setTranslation(A6.x,A6.y,A6.z),j.setRotation(O6),R)R.push([j,Y]);else{let O=this.sharedGameControlGlobals.rapierWorld.createCollider(j,E.rigidBody);this.sensorToTriggerEvent[O.handle]=Y}}}))}checkTrigger(){let E;for(let O=0;O<this.sharedGameControlGlobals.triggers.length;O++){let[R,z,V,j]=this.sharedGameControlGlobals.triggers[O];for(let O=0;O<this.sharedGameControlGlobals.entitiesWithTransformAnim.length;O++){let Y=this.sharedGameControlGlobals.entitiesWithTransformAnim[O];if(V===Y||j.isValidTriggeringObject(oL.is(Y)?Y:Y.object)===!1)continue;let ee=L6.copy(V.matrixWorld).decompose(A6,z6,T6).compose(A6,z6,P6).multiply(z),se=R6.copy(Y.matrixWorld).invert().multiply(ee);R instanceof Yn?E=Y.bvhGeometry.boundsTree.intersectsBox(R,se):(F6.radius=R,F6.center.setFromMatrixPosition(se),E=Y.bvhGeometry.boundsTree.intersectsSphere(F6)),E?j.currentIntersectedObjects.indexOf(Y)===-1&&(j.currentIntersectedObjects.push(Y),j.dispatch(),V.dispatchEvent(U6)):j.currentIntersectedObjects=j.currentIntersectedObjects.filter((E=>E!==Y))}}}};function pF(E){let O=this._clip.duration,R=this._clip.start??0,z=this.loop,V=this.time+E,j=this._loopCount,Y=z===Lr;if(E===0)return j===-1?V:Y&&(j&1)===1?O-(V-R):V;if(z===Or){j===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(V>=O)V=O;else{if(!(V<0)){this.time=V;break e}V=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=V,this._mixer.dispatchEvent({type:"finished",action:this,direction:E<0?-1:1})}}else{if(j===-1&&(E>=0?(j=0,this._setEndings(!0,this.repetitions===0,Y)):this._setEndings(this.repetitions===0,!0,Y)),V>=O||V<R){let z=Math.floor((V-R)/(O-R));V-=(O-R)*z,j+=Math.abs(z);let ee=this.repetitions-j;if(ee<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,Y||(V=E>0?O:R,this.repetitions===1&&(V=O)),this.time=V,this._mixer.dispatchEvent({type:"finished",action:this,direction:E>0?1:-1});else{if(ee===1){let O=E<0;this._setEndings(O,!O,Y)}else this._setEndings(!1,!1,Y);this._loopCount=j,this.time=V,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:z})}}else this.time=V;if(Y&&(j&1)===1)return O-(V-R)}return V}var V6=!1,j6=class{constructor(E,O,R,z){this.scene=E;this.requestRender=O;this.updateDisplayProgress=R;this.animationInspectorState=z;this.clipIdToAction={};this.activeClip=null;this.needsUpdate=!1;this.addClip=E=>{E.data.type==="Empty"&&E.data.animations&&E.data.animations.forEach(((O,R)=>{let z=O[0]+"/";if(Array.isArray(E.identity)?z+=E.identity[0]:z+=E.uuid,this.clipIdToAction[z])return;let V=bp.parse(JSON.parse(O[2]));E.animations[R]=V;let j=this.mixer.clipAction(V,E);V6===!1&&(Object.getPrototypeOf(j)._updateTime=pF,V6=!0),j.clampWhenFinished=!0,this.clipIdToAction[z]=j}))};this.mixer=new Sf(E),this.scene.traverseEntity(this.addClip)}deleteClip(E,O){let R=this.scene.find(O);if(!R)return;let z=R.animations.find((O=>O.uuid===E));if(!z)return;let V=this.clipIdToAction[E];!V||(V.stop(),this.mixer.uncacheClip(z),delete this.clipIdToAction[E],R.animations=R.animations.filter((O=>O.uuid!==E)))}get isPlaying(){return Object.values(this.clipIdToAction).some((E=>E.isRunning()))}playFromInspector(E){this.mixer.stopAllAction();let O=this.clipIdToAction[E];!O||(O.play(),this.activeClip=O.getClip(),this.requestRender())}onExitPlayMode(){Object.values(this.clipIdToAction).forEach((E=>{E.repetitions=1/0,E.loop=Rr})),this.mixer.stopAllAction(),this.requestRender()}play(E){let O=E.clipId+"/"+E.object,R=this.clipIdToAction[O];if(!!R)return E&&(E.repeat>=0&&(R.repetitions=E.repeat+1),E.direction==="pingpong"&&E.repeat!==0&&(R.loop=Lr)),R.play(),R.paused=!1,this.requestRender(),R}resumeFromInspector(E){let O=this.clipIdToAction[E];!O||(O.play(),O.paused=!1,this.requestRender())}pauseFromInspector(E){let O=this.clipIdToAction[E];!O||(O.paused=!0)}stop(){this.mixer.stopAllAction(),this.requestRender()}update(E){if(this.needsUpdate)this.needsUpdate=!1;else if(this.isPlaying===!1||this.animationInspectorState?.isScrubbing)return;this.mixer.update(E/1e3),this.activeClip&&this.updateDisplayProgress(Math.round(this.mixer.time/this.activeClip.duration*(this.maxFrames-1)%(this.maxFrames-1))),this.requestRender()}get maxFrames(){return QT(this.activeClip??void 0)}setProgressFromInspector(E,O){if(!this.clipIdToAction[O])return;this.activeClip!==this.clipIdToAction[O].getClip()&&this.playFromInspector(O);let R=this.clipIdToAction[O].paused;this.clipIdToAction[O].paused=!1,this.mixer.setTime(Math.min(E/(this.maxFrames-1),.9999)*this.activeClip.duration),this.requestRender(),R&&(this.clipIdToAction[O].paused=!0)}};var G6=new WeakMap,H6=class extends Ap{constructor(E){super(E),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(E){return this.decoderPath=E,this}setDecoderConfig(E){return this.decoderConfig=E,this}setWorkerLimit(E){return this.workerLimit=E,this}load(E,O,R,z){let V=new Dp(this.manager);V.setPath(this.path),V.setResponseType("arraybuffer"),V.setRequestHeader(this.requestHeader),V.setWithCredentials(this.withCredentials),V.load(E,(E=>{this.decodeDracoFile(E,O).catch(z)}),R,z)}decodeDracoFile(E,O,R,z){let V={attributeIDs:R||this.defaultAttributeIDs,attributeTypes:z||this.defaultAttributeTypes,useUniqueIDs:!!R};return this.decodeGeometry(E,V).then(O)}decodeGeometry(E,O){let R=JSON.stringify(O);if(G6.has(E)){let O=G6.get(E);if(O.key===R)return O.promise;if(E.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let z,V=this.workerNextTaskID++,j=E.byteLength,Y=this._getWorker(V,j).then((R=>(z=R,new Promise(((R,j)=>{z._callbacks[V]={resolve:R,reject:j},z.postMessage({type:"decode",id:V,taskConfig:O,buffer:E},[E])}))))).then((E=>this._createGeometry(E.geometry)));return Y.catch((()=>!0)).then((()=>{z&&V&&this._releaseTask(z,V)})),G6.set(E,{key:R,promise:Y}),Y}_createGeometry(E){let O=new Na;E.index&&O.setIndex(new Sa(E.index.array,1));for(let R=0;R<E.attributes.length;R++){let z=E.attributes[R],V=z.name,j=z.array,Y=z.itemSize;O.setAttribute(V,new Sa(j,Y))}return O}_loadLibrary(E,O){let R=new Dp(this.manager);return R.setPath(this.decoderPath),R.setResponseType(O),R.setWithCredentials(this.withCredentials),new Promise(((O,z)=>{R.load(E,O,void 0,z)}))}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;let E=typeof WebAssembly!="object"||this.decoderConfig.type==="js",O=[];return E?O.push(this._loadLibrary("draco_decoder.js","text")):(O.push(this._loadLibrary("draco_wasm_wrapper.js","text")),O.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(O).then((O=>{let R=O[0];E||(this.decoderConfig.wasmBinary=O[1]);let z=V$.toString(),V=["/* draco decoder */",R,"","/* worker */",z.substring(z.indexOf("{")+1,z.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([V]))})),this.decoderPending}_getWorker(E,O){return this._initDecoder().then((()=>{if(this.workerPool.length<this.workerLimit){let E=new Worker(this.workerSourceURL);E._callbacks={},E._taskCosts={},E._taskLoad=0,E.postMessage({type:"init",decoderConfig:this.decoderConfig}),E.onmessage=function(O){let R=O.data;switch(R.type){case"decode":E._callbacks[R.id].resolve(R);break;case"error":E._callbacks[R.id].reject(R);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+R.type+'"')}},this.workerPool.push(E)}else this.workerPool.sort((function(E,O){return E._taskLoad>O._taskLoad?-1:1}));let R=this.workerPool[this.workerPool.length-1];return R._taskCosts[E]=O,R._taskLoad+=O,R}))}_releaseTask(E,O){E._taskLoad-=E._taskCosts[O],delete E._callbacks[O],delete E._taskCosts[O]}debug(){console.log("Task load: ",this.workerPool.map((E=>E._taskLoad)))}dispose(){for(let E=0;E<this.workerPool.length;++E)this.workerPool[E].terminate();return this.workerPool.length=0,this.workerSourceURL!==""&&URL.revokeObjectURL(this.workerSourceURL),this}};function V$(){let E,O;onmessage=function(R){let z=R.data;switch(z.type){case"init":E=z.decoderConfig,O=new Promise((function(O){E.onModuleLoaded=function(E){O({draco:E})},DracoDecoderModule(E)}));break;case"decode":let R=z.buffer,V=z.taskConfig;O.then((E=>{let O=E.draco,j=new O.Decoder,Y=new O.DecoderBuffer;Y.Init(new Int8Array(R),R.byteLength);try{let E=e(O,j,Y,V),R=E.attributes.map((E=>E.array.buffer));E.index&&R.push(E.index.array.buffer),self.postMessage({type:"decode",id:z.id,geometry:E},R)}catch(E){console.error(E),self.postMessage({type:"error",id:z.id,error:E.message})}finally{O.destroy(Y),O.destroy(j)}}));break}};function e(E,O,R,z){let V,j,Y=z.attributeIDs,ee=z.attributeTypes,se=O.GetEncodedGeometryType(R);if(se===E.TRIANGULAR_MESH)V=new E.Mesh,j=O.DecodeBufferToMesh(R,V);else{if(se!==E.POINT_CLOUD)throw new Error("THREE.DRACOLoader: Unexpected geometry type.");V=new E.PointCloud,j=O.DecodeBufferToPointCloud(R,V)}if(!j.ok()||V.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+j.error_msg());let he={index:null,attributes:[]};for(let R in Y){let j,se,ce=self[ee[R]];if(z.useUniqueIDs)se=Y[R],j=O.GetAttributeByUniqueId(V,se);else{if(se=O.GetAttributeId(V,E[Y[R]]),se===-1)continue;j=O.GetAttribute(V,se)}he.attributes.push(i(E,O,V,R,ce,j))}return se===E.TRIANGULAR_MESH&&(he.index=r(E,O,V)),E.destroy(V),he}function r(E,O,R){let z=R.num_faces()*3,V=z*4,j=E._malloc(V);O.GetTrianglesUInt32Array(R,V,j);let Y=new Uint32Array(E.HEAPF32.buffer,j,z).slice();return E._free(j),{array:Y,itemSize:1}}function i(E,O,R,z,V,j){let Y=j.num_components(),ee=R.num_points()*Y,se=ee*V.BYTES_PER_ELEMENT,he=s(E,V),ce=E._malloc(se);O.GetAttributeDataArrayForAllPoints(R,j,he,se,ce);let ue=new V(E.HEAPF32.buffer,ce,ee).slice();return E._free(ce),{name:z,array:ue,itemSize:Y}}function s(E,O){switch(O){case Float32Array:return E.DT_FLOAT32;case Int8Array:return E.DT_INT8;case Int16Array:return E.DT_INT16;case Int32Array:return E.DT_INT32;case Uint8Array:return E.DT_UINT8;case Uint16Array:return E.DT_UINT16;case Uint32Array:return E.DT_UINT32}}}var W6;function gF(){return W6||(W6=new H6,W6.setDecoderPath("https://www.gstatic.com/draco/versioned/decoders/1.5.2/").preload()),W6.decoderPending}async function U$(E){if(W6){let O,R={attributeIDs:W6.defaultAttributeIDs,attributeTypes:W6.defaultAttributeTypes,useUniqueIDs:!1};try{O=await W6.decodeGeometry(new Int8Array(E).buffer,R)}catch(E){console.error(E)}if(O)return{index:O.index?{array:O.index.array}:void 0,attributes:Object.entries(O.attributes).map((([E,O])=>({name:E,itemSize:O.itemSize,array:O.array})))}}return null}async function yF(E,O){let[R,z]=Tw(PC.deserialize(new Uint8Array(E)));return c0(R),O&&O(R),z.result().data}function vF(E){let O=[];return E.scene.objects.traverse(((E,R)=>{R.type==="Mesh"&&R.geometry.type==="NonParametricGeometry"&&R.geometry.data.draco!==void 0&&O.push(R)})),O}async function xF(E){for(let O of E){let E=await U$(O.geometry.data.draco);if(E){let R=O.geometry.data;E.index&&(R.index={array:E.index.array,itemSize:1,normalized:!1,type:"Uint32Array"});let z={};E.attributes.forEach((({name:E,array:O,itemSize:R})=>{z[E]={array:O,itemSize:R,type:"Float32Array",normalized:!1}})),R.attributes=z,R.draco=void 0}}}var q6=class{constructor(){this._clickCount=0;this._lastTime=0;this._lastPosition=[0,0];this._delay=500;this._distance=2;this._onMouseDown=E=>{let O=[E.clientX,E.clientY],R=(new Date).getTime();if(this._clickCount>0){let E=O[0]-this._lastPosition[0],R=O[1]-this._lastPosition[1];Math.sqrt(E*E+R*R)>this._distance&&(this._clickCount=0)}this._lastPosition=O,this._clickCount=R-this._lastTime>this._delay?1:this._clickCount+1,this._lastTime=R};this._onMouseUp=E=>{}}start(E,O=500,R=2){this._target&&this.stop(),this.reset(),this._delay=O,this._distance=R,this._target=E,this._target.addEventListener("pointerdown",this._onMouseDown,!1),this._target.addEventListener("pointerup",this._onMouseUp,!1)}stop(){this._target&&(this._target.removeEventListener("pointerdown",this._onMouseDown,!1),this._target.removeEventListener("pointerup",this._onMouseUp,!1),this._target=void 0)}get clickCount(){return this._clickCount}reset(){this._clickCount=0,this._lastTime=0,this._lastPosition=[0,0]}};var X6=class{constructor(E,O,R,z,V,j,Y,ee){this.eventId=E;this.id=O;this.data=R;this.dataEvent=z;this.object=V;this.stage=!1;this.actions=Ht(z,R.actions,j,Y,ee,V)}disconnect(){dr(this.actions)}dispatchIn(){this.actions.Audio.forEach((E=>E.dispatchBasic())),this.actions.Particles.forEach((E=>E.dispatchBasic())),this.actions.Video.forEach((E=>E.dispatchBasic())),this.actions.Create.forEach((E=>E.dispatch())),this.actions.Destroy.forEach((E=>E.dispatch())),this.actions.Reset.forEach((E=>E.dispatch())),this.actions.Link.forEach((E=>E.dispatch())),this.actions.Transition.forEach((E=>{E.object.currentTransitionEvent!==this&&(E.object.currentTransitionEvent=this,E.init())})),this.actions.Transition.forEach((E=>E.toggle())),this.actions.Animation.forEach((E=>E.play())),this.actions.SwitchCamera.forEach((E=>E.play())),this.actions.SceneTransition.forEach((E=>E.dispatch())),this.actions.SetVariable.forEach((E=>E.checkConditions())),this.actions.SetVariable.forEach((E=>E.dispatch())),this.actions.DynamicVariablePlay.forEach((E=>E.dispatch())),this.actions.ClearLocalStorage.forEach((E=>E.dispatch())),this.actions.UserAPI.forEach((E=>E.dispatch()))}dispatchOut(){this.actions.Transition.forEach((E=>{E.toggle()}))}},Y6=class extends Z2{constructor(E,O){super(E);this.eventManager=O;this.breakpoints=[];this.resize=(E,O)=>{this.breakpoints.forEach((R=>{let z,V=aT.deviceToSize(R.data.size),j=R.dataEvent.orientation==="horizontal"?E:O;switch(R.data.operator){case"<":z=j<V[0];break;case">":z=j>V[0];break;case"<>":z=j>V[0]&&j<V[1];break}R.stage!==z&&(R.stage=z,R.stage?R.dispatchIn():R.dispatchOut())}))};this.onResizeObserver=new ResizeObserver((E=>{for(let O of E){let{width:E,height:R}=O.contentRect;this.resize(E,R)}}))}connect(){let{page:E,sharedAssets:O,domElement:R}=this.eventContext;this.onResizeObserver.observe(R);let s=R=>{if(!(!R.visible||!R.data?.events.length))for(let{data:z,id:V}of R.data.events)z.disabled||z.type==="Resize"&&z.breakpoints.forEach((({data:j,id:Y})=>{try{let ee=new X6(V,Y,j,z,R,E,O,this.eventManager);this.breakpoints.push(ee)}catch(E){!1}}))};E.traverseEntity((E=>{(E instanceof x$||E instanceof d$)&&E.frame?.traverse((E=>{s(E)})),s(E)}))}disconnect(){this.onResizeObserver.disconnect(),this.breakpoints.forEach((E=>{E.disconnect()})),this.breakpoints=[]}};var Q6=class extends Z2{constructor(E,O){super(E);this.eventManager=O;this.userAPIs={};this.events=[];this.onSuccess=({userAPIId:E})=>{this.events.forEach((O=>{O.data.userAPIId===E&&O.dispatchSuccess()}))};this.onError=({userAPIId:E})=>{this.events.forEach((O=>{O.data.userAPIId===E&&O.dispatchError()}))};this.userAPIs=E.sharedAssets.getUserAPIs()}connect(){this.eventContext.page.traverseEntity((E=>{E.data?.events.filter((E=>E.data.type==="API"&&!E.data.disabled)).forEach((O=>{this.events.push(new K6(O.id,O.data,E,this.eventContext.page,this.eventContext.sharedAssets,this.eventManager))}))})),Object.entries(this.userAPIs).forEach((([E,O])=>{O.on("success",this.onSuccess),O.on("error",this.onError),O.autostart&&O.callUserAPI(this.eventContext.sharedAssets)}))}disconnect(){Object.entries(this.userAPIs).forEach((([E,O])=>{O.off("success",this.onSuccess),O.off("error",this.onError)}))}},K6=class{constructor(E,O,R,z,V,j){this.id=E;this.data=O;this.object=R;this.successActions=Ht(O,O.successActions,z,V,j,R),this.errorActions=Ht(O,O.errorActions,z,V,j,R)}dispatchSuccess(){this.dispatchActions(this.successActions)}dispatchError(){this.dispatchActions(this.errorActions)}dispatchActions(E){E.Audio.forEach((E=>E.dispatchConditional())),E.Particles.forEach((E=>E.dispatchConditional())),E.Video.forEach((E=>E.dispatchConditional())),E.Create.forEach((E=>E.dispatch())),E.Destroy.forEach((E=>E.dispatch())),E.Reset.forEach((E=>E.dispatch())),E.Transition.forEach((E=>{E.object.currentTransitionEvent!==this&&(E.object.currentTransitionEvent=this),E.init()})),E.Transition.forEach((E=>E.play())),E.Animation.forEach((E=>E.play())),E.SwitchCamera.forEach((E=>E.play())),E.SceneTransition.forEach((E=>E.dispatch())),E.SetVariable.forEach((E=>E.checkConditions())),E.SetVariable.forEach((E=>E.dispatch())),E.DynamicVariablePlay.forEach((E=>E.dispatch())),E.ClearLocalStorage.forEach((E=>E.dispatch())),E.UserAPI.forEach((E=>E.dispatch()))}};var $6=class extends Z2{constructor(E,O){super(E);this.eventManager=O;this.userWebhooks={};this.events=[];this.onMessage=({userWebhookId:E})=>{this.events.forEach((O=>{O.data.userWebhookId===E&&O.dispatch()}))};this.userWebhooks=E.sharedAssets.getUserWebhooks()}connect(){this.eventContext.page.traverseEntity((E=>{E.data?.events.filter((E=>E.data.type==="WEBHOOK"&&!E.data.disabled)).forEach((O=>{this.events.push(new t8(O.id,O.data,E,this.eventContext.page,this.eventContext.sharedAssets,this.eventManager))}))})),Object.entries(this.userWebhooks).forEach((([E,O])=>{O.connect(),O.on("message",this.onMessage)}))}disconnect(){Object.entries(this.userWebhooks).forEach((([E,O])=>{O.off("message",this.onMessage),O.disconnect()}))}},t8=class{constructor(E,O,R,z,V,j){this.id=E;this.data=O;this.object=R;this.actions=Ht(O,O.actions,z,V,j,R)}dispatch(){let E=this.actions;E.Audio.forEach((E=>E.dispatchConditional())),E.Particles.forEach((E=>E.dispatchConditional())),E.Video.forEach((E=>E.dispatchConditional())),E.Create.forEach((E=>E.dispatch())),E.Destroy.forEach((E=>E.dispatch())),E.Reset.forEach((E=>E.dispatch())),E.Transition.forEach((E=>{E.object.currentTransitionEvent!==this&&(E.object.currentTransitionEvent=this),E.init()})),E.Transition.forEach((E=>E.play())),E.Animation.forEach((E=>E.play())),E.SwitchCamera.forEach((E=>E.play())),E.SceneTransition.forEach((E=>E.dispatch())),E.SetVariable.forEach((E=>E.checkConditions())),E.SetVariable.forEach((E=>E.dispatch())),E.DynamicVariablePlay.forEach((E=>E.dispatch())),E.ClearLocalStorage.forEach((E=>E.dispatch())),E.UserAPI.forEach((E=>E.dispatch()))}};function z$(){let E=document.createElement("textarea");return E.style.position="fixed",E.style.top="200px",E.style.left="400px",E.style.zIndex="-1",E.style.border="1px solid rgba(255,0,0,0.5)",E.style.width="10px",E.style.height="500px",E.style.color="white",E.style.opacity="0.5",E.style.background="transparent",E.style.display="none",E.style.margin="0px",E.style.padding="0px",E.style.boxSizing="content-box",E.style.pointerEvents="none",E}var r8=new Wn(0,0,1),n8=new Wn,s8=new Wn,a8=new wn,o8=class{constructor(E,O,R,z,V){this.containerScene=E;this.raycaster=O;this.sharedAssets=R;this.requestRender=z;this.onExit=V;this.htmlInput=null;this.virtualInput=null;this.helper=new _K;this.doubleClickHandler=new q6;this.isDragging=!1;this.plane=new _o;this.caretInterval=0;this.planeIntersection=new Wn;this.projected=new bn;this._lastIndex=0;this._isFirstDragMove=!1;this.selectionOnDragStart=0;this.onTextMaterialChanged=()=>{let E=this.virtualInput?.data;if(this.virtualInput!==void 0&&E){let O=E.material,R=typeof O=="string"?this.sharedAssets.data.materials[O]:O,z=wL(R,this.sharedAssets);this.helper.setCaretColor(z)}};this.stopAnimateTextCursor=()=>{clearInterval(this.caretInterval),this.helper&&(this.helper.caretMesh.visible=!1)};this.startAnimateTextCursor=()=>{this.stopAnimateTextCursor(),this.helper&&(this.helper.caretMesh.visible=!0,this.caretInterval=setInterval((()=>{this.helper&&(this.helper.caretMesh.visible=!this.helper.caretMesh.visible),this.requestRender()}),600))};this.handleCaretUpdate=E=>{if(!this.htmlInput||!this.virtualInput)return;let O=this.helper,R=E?.key==="ArrowLeft"||E?.key==="ArrowRight",z=E?.key==="ArrowUp"||E?.key==="ArrowDown";this.htmlInput.selectionStart===this.htmlInput.selectionEnd?(O.setCaretPosition(this.htmlInput.selectionStart,{horizontalKeyMove:R,verticalKeyMove:z}),this.startAnimateTextCursor()):O.setSelection(this.htmlInput.selectionStart,this.htmlInput.selectionEnd),this.requestRender()};this.containerScene.add(this.helper)}createInput(){return this.htmlInput=z$(),this.htmlInput}connect(){}disconnect(){this.stopAnimateTextCursor(),this.helper.hide(),this.htmlInput?.remove(),this.doubleClickHandler.stop()}handleMouseDown(){if(!this.htmlInput||!this.virtualInput)return!0;this.getPointOnPlane();let E=this.doubleClickHandler.clickCount,{index:O,lineIndex:R,characterIndex:z}=this.helper.getSelectionFromPosition(this.projected.x,this.projected.y,E>1?"inside":"previous")??{index:0,lineIndex:0,characterIndex:0};this.virtualInput?.wrappedText?.length&&this.virtualInput.wrappedText[R][Math.max(0,z-1)]==="\n"&&(O--,z--),this._lastIndex=O,this._isFirstDragMove=!0;let V=this.checkClickedObject();if(E===1){if(V===null)return this.onExit(this.virtualInput),!0;this.selectionOnDragStart=O,this.isDragging=!0,this.setInputSelection(O)}else V===this.virtualInput&&(E===2?this.selectClosestWord(R,z):E>2&&(this.setInputSelection(0,this.htmlInput.value.length),this.doubleClickHandler.reset()))}handleMouseUp(){this.applyRangeToTextInput(),this.isDragging=!1,this._isFirstDragMove=!1}handleMouseMove(){!this.virtualInput||(this._isFirstDragMove&&this.doubleClickHandler.clickCount>1&&(this.selectionOnDragStart=this._lastIndex,this.isDragging=!0,this.setInputSelection(this._lastIndex)),this._isFirstDragMove=!1,this.getPointOnPlane(),this.applyRangeToTextInput())}focus(E){if(this.virtualInput=E,this.updateTextInputStyles(),this.htmlInput)if(E){let E=this.data?.geometry.text;this.htmlInput.value=typeof E=="string"?"":E?.textValue.toString()??""}else this.htmlInput.value=""}blur(){}get data(){let{virtualInput:E}=this;if(E)return E.dataPatched}applyRangeToTextInput(){if(!this.isDragging||!this.virtualInput||!this.htmlInput)return;let E=this.selectionOnDragStart,{index:O,lineIndex:R,characterIndex:z}=this.helper.getSelectionFromPosition(this.projected.x,this.projected.y,this.doubleClickHandler.clickCount>2?"inside":"previous")??{index:0};R!==void 0&&z!==void 0&&this.virtualInput?.wrappedText[R][z-1]==="\n"&&O--,this.htmlInput.setSelectionRange(Math.min(E,O),Math.max(E,O))}checkClickedObject(){if(this.virtualInput){let E=this.raycaster.intersectObject(this.virtualInput,!1);if(E.length>0){let O=E[0];if(O.object instanceof g$)return O.object}}return null}selectClosestWord(E,O){if(!this.virtualInput)return;let R=this.virtualInput.wrappedText,z=R[E],V=O+1,j=O;z[O]!==" "&&(V=this.findNextCharOccurence(z,O,"forward"," "),j=this.findNextCharOccurence(z,O,"backward"," "),j>0&&j++,V>=z.length-1&&E===R.length-1&&V++);let Y=this.helper,ee=Y.getGlobalIndexFromLineAndCharIndexes(R,E,j),se=Y.getGlobalIndexFromLineAndCharIndexes(R,E,V);this.setInputSelection(ee,se)}findNextCharOccurence(E,O,R,z=" "){let V=Math.max(0,E.length-1),j=R==="forward"?V:0,Y=R==="forward"?1:-1,ee=Math.max(Math.min(O,V),0);for(;ee!==j;)if(ee+=Y,E.charAt(ee)===z)return ee;return j}getPointOnPlane(){let E=this.virtualInput?.data;if(!(!this.virtualInput||!E)&&this.raycaster.ray.intersectsPlane(this.plane)){this.planeIntersection===null&&(this.planeIntersection=new Wn);let O=this.raycaster.ray.intersectPlane(this.plane,this.planeIntersection);if(O){this.planeIntersection.copy(this.virtualInput.worldToLocal(O));let R=typeof E.geometry.width=="number"?E.geometry.width:1,z=typeof E.geometry.height=="number"?E.geometry.height:1;this.projected.set(O.x+R*.5,O.y-z*.5)}}}updatePlane(){let E=this.virtualInput?.data;this.virtualInput&&E&&(a8.getNormalMatrix(this.virtualInput.matrixWorld),n8.copy(r8).applyMatrix3(a8).normalize(),this.virtualInput.localToWorld(s8.set(0,0,E.geometry.depth)),this.plane.setFromNormalAndCoplanarPoint(n8,s8))}setInputSelection(E,O=E){this.htmlInput?.setSelectionRange(E,O),setTimeout((()=>{this.htmlInput?.focus()}))}updateTextInputStyles(){let E=this.virtualInput?.data;this.virtualInput&&E&&this.htmlInput&&(this.htmlInput.style.fontSize=E.geometry.fontSize+"px",this.htmlInput.style.letterSpacing=E.geometry.letterSpacing*E.geometry.fontSize+"px",this.htmlInput.style.lineHeight=E.geometry.fontSize*E.geometry.lineHeight+"px",this.htmlInput.style.width=E.geometry.width+"px",this.htmlInput.style.height=E.geometry.height+"px",this.htmlInput.style.textAlign=G$(E.geometry.horizontalAlign))}};function G$(E){return E===4?"justify":E===2?"right":E===3?"center":"left"}var EF=(E,O)=>{if(typeof E=="string"){let R=O.data(E);if(R)return EF(R.value,O)}return ID.getDisplayedValue(E)};function AF(E,O){let R=E.text,z="";if(typeof R=="string"){let E=O.variables.data(z);E&&(z=EF(E.value,O.variables))}else z=R.textValue.toString();return z}var l8=class extends Z2{constructor(E,O){super(E);this.eventManager=O;this._textInputs=[];this.sceneHelpers=new Wd;this.helper=new _K;this._onMouseDownFocusIn=E=>{if(TM.length>1)return;this.eventContext.updateRaycaster(E);let O=null;if(this.eventContext.raycaster)for(let E of this._textInputs)if(this.eventContext.raycaster.intersectObject(E,!0).length>0){O=E;break}this.focusOnTextInput(O),this._onCaretUpdate(),this._onMouseUp(),this.textInputManager.doubleClickHandler.start(this.eventContext.domElement),this.textInputManager.doubleClickHandler._onMouseDown(E),this._onMouseDown(E)};this.onExit=()=>{let{virtualInput:E}=this.textInputManager;if(E===null)return;let O=this.textInputManager.htmlInput;this.helper.hide(),O?.setSelectionRange(O.value.length,O.value.length),this.eventManager.controlsManager.orbitControls&&(this.eventManager.controlsManager.orbitControls.enabled=!0);let{domElement:R}=this.eventContext;R.removeEventListener("pointerdown",this._onMouseDown,!1),R.removeEventListener("pointerup",this._onMouseUp,!1),R.removeEventListener("pointermove",this._onMouseMove,!1),window.removeEventListener("keydown",this._onKeyPress),this.textInputManager.doubleClickHandler.reset(),R.addEventListener("pointerdown",this._onMouseDownFocusIn),this.eventContext.renderer.sceneHelpersOnTop=void 0,this.eventContext.renderer.pipeline.disableHelpers()};this._onMouseDown=E=>{this.eventContext.updateRaycaster(E),this.textInputManager.handleMouseDown(),this.textInputManager.virtualInput&&this.eventContext.raycaster.intersectObject(this.textInputManager.virtualInput,!0).length>0&&this.eventManager.controlsManager.orbitControls&&(this.eventManager.controlsManager.orbitControls.enabled=!1)};this._onMouseUp=()=>{this.textInputManager.handleMouseUp(),this.eventManager.controlsManager.orbitControls&&!this.eventManager.controlsManager.orbitControls.enabled&&(this.eventManager.controlsManager.orbitControls.enabled=!0)};this._onMouseMove=E=>{this.eventContext.updateRaycaster(E),this.textInputManager.handleMouseMove()};this._onTextEdit=E=>{let{htmlInput:O,virtualInput:R,helper:z}=this.textInputManager;if(!O||!R)return;let V=O.value;R.textGeometry.setText(V).then((()=>{this.eventContext.requestRender()}));let j=R.data;z.update();let Y=j.geometry.text;if(typeof Y=="string"){let E=Y;this.eventContext.sharedAssets.updateVariable(E,{textValue:V})}this.textInputManager.updateTextInputStyles(),this._onCaretUpdate()};this._onCaretUpdate=E=>{this.textInputManager.handleCaretUpdate(E)};this._onKeyPress=E=>{E.key==="Escape"&&this.onExit()};this.textInputManager=new o8(this.sceneHelpers,E.raycaster,E.sharedAssets,E.requestRender,this.onExit)}connect(){let E=[];if(this.eventContext.scene.traverseEntity((O=>{O instanceof g$&&E.push(O)})),this._textInputs=E,E.length===0)return;let{domElement:O}=this.eventContext;O.addEventListener("pointerdown",this._onMouseDownFocusIn),this.textInputManager.connect();let R=this.textInputManager.createInput();document.body.appendChild(R),R.style.display="none",R.addEventListener("keyup",this._onCaretUpdate),R.addEventListener("keydown",this._onCaretUpdate),R.addEventListener("beforeinput",this._onCaretUpdate),R.addEventListener("paste",this._onCaretUpdate),R.addEventListener("cut",this._onCaretUpdate),R.addEventListener("select",this._onCaretUpdate),R.addEventListener("selectstart",this._onCaretUpdate)}disconnect(){let E=this.textInputManager.htmlInput,{domElement:O}=this.eventContext;O.removeEventListener("pointerdown",this._onMouseDownFocusIn),E?.removeEventListener("keyup",this._onCaretUpdate),E?.removeEventListener("keydown",this._onCaretUpdate),E?.removeEventListener("beforeinput",this._onCaretUpdate),E?.removeEventListener("paste",this._onCaretUpdate),E?.removeEventListener("cut",this._onCaretUpdate),E?.removeEventListener("select",this._onCaretUpdate),E?.removeEventListener("selectstart",this._onCaretUpdate),this._textInputs.forEach((E=>{let O=AF(E.data.geometry,this.eventContext.sharedAssets.data);E.textGeometry.setText(O)})),O.removeEventListener("pointerdown",this._onMouseDown,!1),O.removeEventListener("pointerup",this._onMouseUp,!1),O.removeEventListener("pointermove",this._onMouseMove,!1),window.addEventListener("keydown",this._onKeyPress),this.eventContext.renderer.sceneHelpersOnTop=void 0,this.eventContext.renderer.pipeline.disableHelpers(),this.textInputManager.disconnect()}focusOnTextInput(E){this.textInputManager.focus(E),this.textInputManager.onTextMaterialChanged();let O=this.textInputManager.htmlInput;if(!O||E===null)return;this.textInputManager.updateTextInputStyles(),this.eventContext.renderer.sceneHelpersOnTop=this.sceneHelpers,this.eventContext.renderer.pipeline.enableHelpers(),this.textInputManager.isDragging=!1;let R=AF(E.textGeometry.userData.parameters,this.eventContext.sharedAssets.data);O.value=R,O.setSelectionRange(0,0),this.textInputManager.helper.show(E),O.style.display="block",O.addEventListener("input",this._onTextEdit),this.textInputManager.updatePlane();let{domElement:z}=this.eventContext;z.removeEventListener("pointerdown",this._onMouseDownFocusIn),z.addEventListener("pointerdown",this._onMouseDown,!1),z.addEventListener("pointerup",this._onMouseUp,!1),z.addEventListener("pointermove",this._onMouseMove,!1),window.addEventListener("keydown",this._onKeyPress)}};var h8=class extends Z2{constructor(E,O){super(E);this.eventManager=O;this.events=[];this.onVoice=({value:E,frequencies:O})=>{this.events.forEach((E=>{E.dispatch()}))}}connect(){this.openAIRealtime=this.eventContext.sharedAssets.openAIRealtime,this.openAIRealtime&&(this.eventContext.page.traverseEntity((E=>{E.data?.events.filter((E=>E.data.type==="AIAssistantListener"&&!E.data.disabled)).forEach((O=>{this.events.push(new c8(O.id,O.data,E,this.eventContext.page,this.eventContext.sharedAssets,this.eventManager))}))})),this.openAIRealtime.on("voice",this.onVoice))}disconnect(){this.openAIRealtime?.off("voice",this.onVoice)}},c8=class{constructor(E,O,R,z,V,j){this.id=E;this.data=O;this.object=R;this.actions=Ht(O,O.actions,z,V,j,R)}dispatch(){this.dispatchActions(this.actions)}dispatchActions(E){E.Audio.forEach((E=>E.dispatchConditional())),E.Particles.forEach((E=>E.dispatchConditional())),E.Video.forEach((E=>E.dispatchConditional())),E.Create.forEach((E=>E.dispatch())),E.Destroy.forEach((E=>E.dispatch())),E.Reset.forEach((E=>E.dispatch())),E.Transition.forEach((E=>{E.object.currentTransitionEvent!==this&&(E.object.currentTransitionEvent=this),E.init()})),E.Transition.forEach((E=>E.play())),E.Animation.forEach((E=>E.play())),E.SwitchCamera.forEach((E=>E.play())),E.SceneTransition.forEach((E=>E.dispatch())),E.SetVariable.forEach((E=>E.checkConditions())),E.SetVariable.forEach((E=>E.dispatch())),E.DynamicVariablePlay.forEach((E=>E.dispatch())),E.ClearLocalStorage.forEach((E=>E.dispatch())),E.UserAPI.forEach((E=>E.dispatch()))}};var d8=class extends Z2{constructor(E,O){super(E);this.eventManager=O;this.events=[];this.onTriggerEvent=({description:E,direction:O})=>{let R=this.events.find((O=>O.data.description===E));R&&(O==="backward"?R.dispatchReverse():R.dispatch())}}connect(){this.openAIRealtime=this.eventContext.sharedAssets.openAIRealtime,this.openAIRealtime&&(this.eventContext.page.traverseEntity((E=>{E.data?.events.filter((E=>E.data.type==="AIAssistantTrigger"&&!E.data.disabled)).forEach((O=>{this.events.push(new u8(O.id,O.data,E,this.eventContext.page,this.eventContext.sharedAssets,this.eventManager))}))})),this.openAIRealtime.on("trigger_event",this.onTriggerEvent))}disconnect(){this.openAIRealtime?.off("trigger_event",this.onTriggerEvent)}},u8=class{constructor(E,O,R,z,V,j){this.id=E;this.data=O;this.object=R;this.actions=Ht(O,O.actions,z,V,j,R)}dispatch(){let E=this.actions;E.Audio.forEach((E=>E.dispatchConditional())),E.Particles.forEach((E=>E.dispatchConditional())),E.Video.forEach((E=>E.dispatchConditional())),E.Create.forEach((E=>E.dispatch())),E.Destroy.forEach((E=>E.dispatch())),E.Reset.forEach((E=>E.dispatch())),E.Transition.forEach((E=>{E.object.currentTransitionEvent!==this&&(E.object.currentTransitionEvent=this),E.init()})),E.Transition.forEach((E=>E.play())),E.Animation.forEach((E=>E.play())),E.SwitchCamera.forEach((E=>E.play())),E.SceneTransition.forEach((E=>E.dispatch())),E.SetVariable.forEach((E=>E.checkConditions())),E.SetVariable.forEach((E=>E.dispatch())),E.DynamicVariablePlay.forEach((E=>E.dispatch())),E.ClearLocalStorage.forEach((E=>E.dispatch())),E.UserAPI.forEach((E=>E.dispatch()))}dispatchReverse(){let E=this.actions;E.Transition.forEach((E=>E.reverseFromCurrent())),E.Particles.forEach((E=>E.reverseFromCurrent())),E.Animation.forEach((E=>E.reverseFromCurrent())),E.SwitchCamera.forEach((E=>E.reverseFromCurrent())),E.Create.forEach((E=>E.dispatchStop()))}};var p8=class{constructor(E,O,R,z,V){this.publish=E;this.controlsManager=O;this.animationControls=R;this.eventContext=z;this.sharedVariables=V;this.isEnabled=!1;this.activateCount=0;this.needsMouse=!1;this.needsRaycast=!1;this.onTouchMovePreventScroll=E=>{let O=window.parent!==window,R=document.documentElement.scrollHeight>document.documentElement.clientHeight||document.documentElement.scrollWidth>document.documentElement.clientWidth;(E.touches.length>1||this.preventTouchScroll||O===!1&&R===!1)&&E.preventDefault()};this.onMouseWheelPreventScroll=E=>{this.preventScroll&&E.preventDefault()};this.onMouseMove=E=>{this.eventContext.sharedAssets.mouseProperty={...this.getMousePosition(E),pressed:E.buttons>0}};this.onMouseDown=E=>{this.eventContext.sharedAssets.mouseProperty={...this.getMousePosition(E),pressed:!0}};this.onMouseUp=E=>{this.eventContext.sharedAssets.mouseProperty={...this.getMousePosition(E),pressed:!1}};this.getMousePosition=E=>{let{domRect:O}=this.eventContext,{pageX:R,pageY:z}=E.touches?.length>0?E.touches[0]:E;return{x:R-(O.left+window.scrollX),y:z-(O.top+window.scrollY)}};this.stopRaycast=E.stopRaycast,this.preventScroll=E.preventScroll,this.preventTouchScroll=E.preventTouchScroll,this.hideCursor=E.hideCursor,this.requestRender=z.requestRender}activate(E=!1){if(this.isEnabled)return;this.isEnabled=!0,this.initializeActionsDependentStates(),this.needsMouse&&(this.eventContext.domElement.addEventListener("pointermove",this.onMouseMove),this.eventContext.domElement.addEventListener("pointerdown",this.onMouseDown)),this.handlers={Spline:new J2(this.eventContext),VariableChange:new v5(this.eventContext,this.sharedVariables,this,this.needsMouse,this.needsRaycast),API:new Q6(this.eventContext,this),WEBHOOK:new $6(this.eventContext,this),AIAssistantListener:new h8(this.eventContext,this),AIAssistantTrigger:new d8(this.eventContext,this),Conditional:new h3(this.eventContext,this),Start:new p5(this.eventContext,this),Basic:new t3(this.eventContext,this,this.needsRaycast),MouseHover:new l5(this.eventContext,this),Scroll:new d5(this.eventContext,this),Follow:new q3(this.eventContext,this),DragDrop:new I3(this.eventContext,this),LookAt:new U4(this.eventContext),Resize:new Y6(this.eventContext,this),Textfields:new l8(this.eventContext,this)};let{page:O,domElement:R}=this.eventContext;this.hideCursor&&(R.style.cursor="none"),O.traverseEntity((E=>{E.addEventListener("requestRender",this.requestRender)})),Object.values(this.handlers).forEach((E=>E.connect())),R.addEventListener("wheel",this.onMouseWheelPreventScroll),R.addEventListener("touchmove",this.onTouchMovePreventScroll),this.activateCount++,E||this.eventContext.sharedAssets.openAIRealtime?.connect()}deactivate(E=!1){if(!this.isEnabled)return;this.isEnabled=!1,this.eventContext.domElement.removeEventListener("pointermove",this.onMouseMove),this.eventContext.domElement.removeEventListener("pointerdown",this.onMouseDown),this.eventContext.domElement.removeEventListener("pointerup",this.onMouseUp),this.eventContext.sharedAssets.mouseProperty=null,this.eventContext.sharedAssets.raycastProperty=null;let{page:O,domElement:R}=this.eventContext;R.style.cursor="",Object.values(this.handlers).forEach((E=>E.disconnect())),this.controlsManager.gameControl?.disposeActions(),this.controlsManager.disconnectEvents(),O.traverseEntity((E=>{E.removeEventListener("requestRender",this.requestRender),E.destroyedInAction=!1})),R.removeEventListener("touchmove",this.onTouchMovePreventScroll),R.removeEventListener("wheel",this.onMouseWheelPreventScroll),this.animationControls.onExitPlayMode(),E||this.eventContext.sharedAssets.openAIRealtime?.disconnect()}get isPaused(){return this.isEnabled}pause(){this.deactivate()}resume(){this.activate()}reset(){this.deactivate(!0),this.activate(!0),this.controlsManager.deactivate(),this.controlsManager.activate(this),this.controlsManager.page.updateMatrixWorld(!0),this.controlsManager.rebuildBVH()}updateUseWindowEvents(E){let O=this.isEnabled;O&&this.deactivate(),this.eventContext.useWindowEvents=E,O&&this.activate()}initializeActionsDependentStates(){let E=this.eventContext.sharedAssets;E.resetDynamicVariablePlayState();let e=O=>{if(O.data.type==="Conditional"&&(O.data.ifActions.forEach(e),O.data.elseActions.forEach(e)),O.data.type==="Conditional"||O.data.type==="SetVariable")for(let E of O.data.type==="Conditional"?O.data.condition:O.data.expression)"id"in E&&Array.isArray(E.id)&&(E.id[0]==="mouse"&&(this.needsMouse=!0),E.id[0]==="raycast"&&(this.needsRaycast=!0));O.data.type==="DynamicVariablePlay"&&O.data.variableId!==""&&(O.data.mode==="Play"||O.data.mode==="PlayPause"||O.data.mode==="Toggle")&&E.setDynamicVariablePlayState(O.data.variableId,"Stopped")};this.eventContext.page.traverseEntity((E=>{if(!!E.data?.events.length)for(let O of E.data.events)if(O.data.type==="VariableChange"&&(O.data.variableId==="mouseProperty"&&(this.needsMouse=!0),O.data.variableId==="raycastProperty"&&(this.needsRaycast=!0)),O.data.type==="Conditional")for(let E of["inActions","outActions"])O.data[E].forEach(e);else if(O.data.type==="DragDrop")for(let E of["drag","drop"])O.data.dragDropActions[E].forEach(e);else if(O.data.type==="GameControl")for(let E of["idle","move","jump","run"])O.data.gameActions[E].forEach(e);else if(O.data.type==="Resize")for(let E of O.data.breakpoints)E.data.actions.forEach(e);else O.data.type==="LookAt"||O.data.type==="API"||O.data.actions.forEach(e)}))}};var f8=class{constructor(E,O,R,z,V){this._aspect=1;this.enableResponsive=!1;this._renderer=E,this._camera=O,this._frameSize=(new bn).copy(R),this._editorSize=(new bn).copy(z),this._aspect=O.aspect,this._fov=V??O.fov}set frameSize(E){this._frameSize.copy(E)}updateRenderer(){!this._renderer||this._renderer.setSize(this._frameSize.x,this._frameSize.y)}updateViewport(){if(!this._renderer||!this._camera||this._camera.cameraType!=="PerspectiveCamera")return;let E=this._frameSize.x,O=this._frameSize.y,R=this._editorSize.y;this._aspect=E/O,O<=R&&(this._camera.zoom*=R/O),this._renderer.setViewport(0,0,E,O)}updateCamera(E=!0){if(!!this._camera)if(this._camera.cameraType==="PerspectiveCamera"){let O=this._frameSize.y,R=this._editorSize.y,z=this._fov;if(E&&O>R){let E=j$(O,1080,2160,1,15)/100;z*=O/R,z*=1-E}this._camera.aspect=this._aspect,this._camera.fov=z,this._camera.updateProjectionMatrix()}else this._camera.setViewplaneSize(this._frameSize.x,this._frameSize.y,this.enableResponsive)}setCamera(E){this._camera=E,this._aspect=E.aspect,this._fov=E.fov}revert(){let E=window.innerWidth,O=window.innerHeight;this._renderer&&(this._renderer.setViewport(0,0,E,O),this._renderer.setSize(E,O)),this._camera&&(this._camera.aspect=E/O,this._camera.fov=this._fov,this._camera.setViewplaneSize(E,O,this.enableResponsive),this._camera.updateProjectionMatrix())}};function j$(E,O,R,z,V){return(E-O)/(R-O)*(V-z)+z}var m8=class{get sharedAssets(){return this.shared}constructor(E,O={},R=!0){this.shared=new dj(E.shared,O,!0,R),this.scene=new H0(E.scene,this.sharedAssets),this.shared.setEntityOpContext({scene:this.scene,shared:this.shared})}reset(E,O){this.scene.clearScene(),this.sharedAssets.reset(E.shared),this.scene.resetAfterClear(E.scene,this.sharedAssets)}resetPersonalCameraFromDocumentData(){for(let E of this.scene.children)E instanceof d$&&!E.uiScene&&E.personalCamera.updateState(E.data.camera,{scene:this.scene,shared:this.shared})}dispose(){this.scene.dispose(),this.shared.dispose()}gc(){this.shared.geometryCache.startGc(),this.shared.geometryCache2.startGc(),this.scene.traverseEntity((E=>{E instanceof _j&&E.markGeometryAsReachable(this.shared)})),this.shared.geometryCache.endGc(),this.shared.geometryCache2.endGc()}};var g8=class{constructor({x:E=10,y:O=10}){this._startTime=0;let R=document.getElementById("spe-perfs");R?this.element=R:(this.element=document.createElement("div"),document.body.appendChild(this.element),this.element.style.position="absolute",this.element.style.zIndex="10000",this.element.style.fontFamily="monospace",this.element.style.background="black",this.element.style.color="white",this.element.style.padding="10px",this.element.style.opacity="0.5",this.element.style.fontSize="11px",this.element.setAttribute("id","spe-perfs")),this.element.style.left=`${E}px`,this.element.style.top=`${O}px`}dispose(){this.element.parentElement?.removeChild(this.element)}start(){this._startTime=performance.now()}end(){let E=performance.now()-this._startTime;this.element.innerHTML=E.toFixed(3)+" ms"}};function H$(E){let O;if(!!E.index)for(let R=0;R<E.index.array.length;R+=3)O=E.index.array[R],E.index.array[R]=E.index.array[R+2],E.index.array[R+2]=O}function _g(E){return E instanceof Cj?"SubdivObject":E.geometry.type==="NonParametricGeometry"?"NonParametric":"Mesh"}function W$(E,O){let R={};return E.traverseEntity((E=>{if(!E.visible||!(E instanceof GF)||E.type!=="Mesh"||Array.isArray(E.material)||E.states&&Object.keys(E.states).length)return;let z=E.parent;for(;z;){if(z instanceof GF&&E.states&&Object.keys(E.states).length)return;z=z.parent}let V=E.material.uuid,j=O.shared.materials[V];if(j){if(!FP.isMergable(j))return}else{let R=O.scene.objects.get(E.uuid)?.data;if(R&&"material"in R&&typeof R.material!="string"){if(!FP.isMergable(R.material))return;V=FP.getHash(R.material)}}R[V]||(R[V]={});let Y=R[V][_g(E)];if(Y){if(Y.push(E),E.cloner)for(let O of E.cloner.children)Y.push(O)}else if(R[V][_g(E)]=[E],E.cloner)for(let O of E.cloner.children)R[V][_g(E)].push(O)})),R}function q$(E){let O=0;return Object.values(E).forEach((E=>{Object.values(E).forEach((E=>{let R=E.length;R>O&&(O=R)}))})),O}function TF(E,O){let R=W$(O,E),z=q$(R),V=new Array(z),j=0,Y=new Array(z),ee=0,se=new Array(z),he=0,ce=new Array(z),ue=0;for(let[E,z]of Object.entries(R))for(let fe of Object.values(z)){if(ee=0,he=0,fe.forEach((E=>{E instanceof GF&&(Y[ee++]=E.geometry.clone(),se[he++]=E)})),he<2)continue;for(let E=0;E<he;E++)se[E].updateWorldMatrix(!0,!1),Y[E].applyMatrix4(se[E].matrixWorld),se[E].matrixWorld.determinant()<0&&H$(Y[E]);let z=js(Y.slice(0,ee),!1);if(z){let Y;switch(E){case"SubdivObject":console.warn("Turning subdiv object into mesh"),Y=new eo(z,se[0].material);break;default:Y=new eo(z,se[0].material);break}Y.castShadow=se[0].castShadow,Y.receiveShadow=se[0].receiveShadow,O.add(Y);let y=E=>{ue=0;for(let O of E)O.children&&y(O.children),O instanceof GF&&(Array.isArray(O.material)||R[O.material.uuid]&&R[O.material.uuid][_g(O)]&&R[O.material.uuid][_g(O)].length>1||(ce[ue++]=O));for(let E=0;E<ue;E++)O.attach(ce[E])};for(let E=0;E<he;E++){let O=se[E];y(O.children),V[j++]=O}}}for(let E=0;E<j;E++)V[E].removeFromParent()}var v8=Za(fe(),1);var y8=new bn;function K$(E){let O="The Spline Runtime only accepts .splinecode files that are generated from Spline export panel.";E.endsWith(".spline")?console.warn(O+" The .spline files are only meant to be used by the Editor."):E.endsWith(".splinecode")||console.warn(O)}var x8=class{constructor(E,{renderOnDemand:O,renderMode:R="auto"}={}){this._viewportMode=1;this._viewportWidth=window.innerWidth;this._viewportHeight=window.innerHeight;this._proxyObjectCache=new Map;this._variablesCache=new Map;this._isPaused=!1;this._renderRequested=!1;this._skipRender=!1;this.time=performance.now();this.dt=0;this.currentTAAFrame=0;this.disposed=!1;this._requestRenderAutoMode=()=>{this._skipRender=!1};this.requestRender=()=>{this._renderRequested=!0};this.render=E=>{if(this.time=E,this._lastTime&&(this.dt=this.time-this._lastTime),this._lastTime=this.time,this._perfs?.start(),this._renderer)if(this._isPaused||!(this.renderMode==="manual"&&!this._renderRequested||this.renderMode==="auto"&&this._skipRender)){if(this._renderRequested=!1,this._skipRender=!0,this._controls&&(this._skipRender=this._controls.update(this.dt)),this._eventManager&&(this._eventManager.handlers?.Start.hasVideoAction||this._eventManager.handlers?.Basic.hasVideoAction||this._eventManager.handlers?.Conditional.hasVideoAction)&&(this._skipRender=!1),this._animationControls?.update(this.dt),this._skipRender?(this.currentTAAFrame++,this.currentTAAFrame<32?this._skipRender=!1:this.currentTAAFrame=0):this.currentTAAFrame=0,this._scene?.traverseVisibleEntity((E=>{E.type==="ParticleSystem"&&(E.update(this.dt),this._skipRender=!1)})),this._scene&&this._scene.activeCamera!==this._camera&&(this._camera=this._scene.activeCamera),this._eventManager?.isEnabled&&((this._eventManager.handlers?.Follow).onAnimationFrameDamping(),(this._eventManager.handlers?.LookAt).onAnimationFrameDamping(),(this._eventManager.handlers?.DragDrop).onAnimationFrameDamping()),this._scene&&this._camera){if(this._scene.pathConstraints.applyConstraints(this._scene),this._renderer.sceneTransitionTimeRemaining>0){this._renderer.sceneTransitionTimeRemaining-=this.dt;let E=1-this._renderer.sceneTransitionTimeRemaining/this._renderer.sceneTransitionDuration;this._renderer.pipeline.sceneTransitionPass.uniforms.mixRatio.value=E,this._skipRender=!1}else this._renderer.pipeline.sceneTransitionFromTexture=null;this._renderer.renderSplineScene(this._scene,this._camera)}this.canvas.dispatchEvent(this._renderedEvent),this._perfs?.end()}else this._perfs?.end();else this._perfs?.end()};this._resize=E=>{if(!!this._renderer){if(this._viewportMode===1&&this._frameView&&(this._frameView.frameSize=y8.set(this._viewportWidth,this._viewportHeight)),E){let E=this._viewportWidth,O=this._viewportHeight;this._renderer.setSize(E-1,O-1,!1),this._renderer.setSize(E,O,!1)}else this._renderer.setSize(this._viewportWidth,this._viewportHeight,!1);if(this._camera=this._scene?.activeCamera,this._scene?.updateViewPlaneSize(this._frameView?.frameSize?.x??this._viewportWidth,this._frameView?.frameSize?.y??this._viewportHeight,this._frameView?.enableResponsive??!1),this._camera){let E=Object.values(this._data?.frames??{})[0].preset??"fullscreen";this._frameView?.setCamera(this._camera),this._frameView?.updateCamera(E!=="fullscreen"),this._camera.cameraType==="PerspectiveCamera"&&(this._camera.aspect=this._viewportWidth/this._viewportHeight),this._camera.updateProjectionMatrix()}this.eventManager&&(this.eventManager.eventContext.domRect=this.canvas.getBoundingClientRect()),this._requestRenderAutoMode()}};this._debouncedResize=XA(this._resize,10);this._onScroll=E=>{this.eventManager&&(this.eventManager.eventContext.domRect=this.canvas.getBoundingClientRect())};this.canvas=E,this.renderMode=O?"auto":R,this._renderedEvent=new CustomEvent("rendered",{bubbles:!0}),Object.defineProperty(this._renderedEvent,"target",{writable:!1,value:this}),window.location.search.includes("perfs")&&(this._perfs=new g8({x:10,y:10})),yI(E)}async load(E,O,R){K$(E),this.disposed=!1;let z=await(await fetch(E,R)).arrayBuffer();await this.start(z,{variables:O})}async start(E,{interactive:O=!0,variables:R}={}){if(this.disposed)return;let z=await yF(E);this._data=z;let V=vF(z);z.version&&(0,v8.default)(z.version,"1.9.76")>0&&console.warn("Your .splinecode file is more recent than the library. Please upgrade @splinetool/runtime to the latest version."),await Promise.all([V.length&&gF(),JE(z)&&wR(),x3(z)&&mR(),MD.physicsEnabled(z.scene.objects)&&EI(),jE(z)&&c3(),yb(z)&&CT(),o3(z)&&n3(),uT(z)&&NL(),SM(z)&&SI()].filter(Boolean)),V.length&&await xF(V),this._eventManager?.deactivate(),this._controls?.deactivate(),this._scene?.dispose();let j=new m8(z);if(j.resetPersonalCameraFromDocumentData(),this._scene=j.scene,this._sharedAssetsManager=j.sharedAssets,this._camera=this._scene.activeCamera,window.location.search.includes("merge-geometries")){let E=performance.now();TF(z,j.scene);let O=performance.now();console.log("Merged geometries in ",O-E," ms")}JE(z)&&this._scene.traverse((E=>{Mn(E)&&E.recomputeBoolean()})),this._sharedAssetsManager.setRequestRender((()=>{this._requestRenderAutoMode(),this._scene?.traverse((E=>{E instanceof SH&&E.pendingMediaLoad&&E.update()}))})),this._scene?.traverse((E=>{E.type==="ParticleSystem"&&(E.wakeUp(),E.data.autoPlay?E.start():E.stop())}));let Y=Object.keys(z.shared.fonts).map((E=>this._sharedAssetsManager.getFont(E).loadingPromise));if(Promise.all(Y).then((()=>{j.scene.markNeedsUpdateRendererDirty(),this._requestRenderAutoMode()})),jE(z)&&fF(z)&&await Promise.all(Y),uT(z)){let E=[];this._scene.traverseEntity((O=>{(O instanceof x$||O instanceof d$)&&O.uiCanvas&&E.push(O.uiCanvas)})),await Promise.all(E.map((E=>E.promise)))}if(this._scene.rewriteEventsBeforeGoToPlayMode(),kf(this._scene.activePage,this._sharedAssetsManager),!this._renderer&&(this._renderer=new yK({canvas:this.canvas,antialias:!1,alpha:!0,stencil:!1,depth:!1,powerPreference:"high-performance"}),this._renderer.hdTransmission=z.scene.publish.hdTransmission===!0,this._renderer.setPixelRatio(window.devicePixelRatio),this._renderer.pipeline.enableUIOverlay(),this._renderer.pipeline.addEventListener("smaaloaded",this._requestRenderAutoMode),z.shared.images.SplineWatermark)){let E=this._sharedAssetsManager.getImage("SplineWatermark");await E.loadPromise;let O=E.getTexture(1001);this._renderer.pipeline.setWatermark(O)}yb(z)&&this._scene.initializeSplatViewer(),z.scene.blueNoiseTextureData!==void 0&&this._renderer.pipeline.updateBlueNoiseTexture(z.scene.blueNoiseTextureData);let ee=Object.values(z.frames)[0];if(this._frameView?this._frameView.setCamera(this._camera):(ee.preset==="fullscreen"?(this._viewportMode=1,this.canvas.style.display="block",this.canvas.parentElement&&(this._viewportWidth=this.canvas.parentElement.clientWidth||300,this.canvas.style.width="100%"),this.canvas.parentElement&&(this._viewportHeight=this.canvas.parentElement.clientHeight||150,this.canvas.style.height="100%")):(this._viewportMode=2,this._viewportWidth=ee.size[0],this._viewportHeight=ee.size[1],this.canvas.style.width=`${this._viewportWidth}px`,this.canvas.style.height=`${this._viewportHeight}px`),this._renderer.setSize(this._viewportWidth,this._viewportHeight,!1),this._frameView=new f8(this._renderer,this._camera,new bn(this._viewportWidth,this._viewportHeight),new bn(window.innerWidth,window.innerHeight)),this._frameView.enableResponsive=(ee.allowResponsive??!1)&&ee.preset==="fullscreen"),O){let E=new Y2(this._renderer,this.data.scene.publish,this._scene,(()=>this._scene.activeCamera),this._sharedAssetsManager,this._requestRenderAutoMode,!0,ee);this._scene.updateMatrixWorld(!0),this._controls=new k6(E),this._animationControls=new j6(this._scene,this._requestRenderAutoMode),this._eventManager=new p8(z.scene.publish,this._controls,this._animationControls,E,z.shared.variables),this._eventManager.activate(),this._controls.activate(this._eventManager)}this._resize(),this._scene.activePage.data.postprocessing.depthOfField.enabled&&Promise.all(this._sharedAssetsManager.getImageLoadPromises()).then((()=>{this._resize(!0)})),R!==void 0&&this.setVariables(R),this.dt===0&&(this.render(performance.now()),setTimeout((()=>{this._renderer?.setAnimationLoop(this.render)}),0)),this._resizeObserverTimeout=setTimeout((()=>{!this._resizeObserver&&this.canvas.parentElement&&(this._resizeObserver=new ResizeObserver((()=>{this._viewportWidth=this.canvas.clientWidth,this._viewportHeight=this.canvas.clientHeight,this._debouncedResize()})),this._resizeObserver.observe(this.canvas.parentElement))}),300),document.addEventListener("scroll",this._onScroll)}setVariables(E){if(this._data!==void 0){let O=Object.entries(E);for(let[E,R]of O)this.setVariable(E,R)}}setVariable(E,O){let R=this._getVariableByName(E);if(R&&!("dynamicVariableType"in R.data)){let E=O;typeof R.data.value=="number"?E=typeof O=="number"?O:typeof O=="boolean"?O===!0?1:0:parseFloat(O):typeof R.data.value=="boolean"?E=typeof O=="number"?!!O:typeof O=="boolean"?O:O.toLocaleLowerCase()!=="false"&&!!O:typeof R.data.value!="string"&&R.data.value.textValue!==void 0&&(E=O.toString());let z=typeof E=="string"?{textValue:E}:E;this._sharedAssetsManager?.updateVariable(R.id,z),this.requestRender(),this._requestRenderAutoMode()}else R===void 0?console.warn(`No variable named ${E} was found in your Spline file. Make sure to create it from Spline editor.`):"dynamicVariableType"in R.data&&console.warn(`Dynamic variables like ${E} cannot be updated from code.`)}getVariables(){let E={};return this._data&&this._data.shared.variables.forEach((O=>{E[O.data.name]===void 0&&(E[O.data.name]=this._getVariableValue(this._sharedAssetsManager.getVariable(O.id)))})),E}getVariable(E){let O=this._getVariableByName(E);if(O){let E=this._sharedAssetsManager.getVariable(O.id);return this._getVariableValue(E)}}_getVariableValue(E){return typeof E!="string"&&ID.isTextValue(E)?ID.getDisplayedValue(E):E}_getVariableByName(E){if(this._data){if(this._variablesCache.has(E))return this._variablesCache.get(E);let O=this._data.shared.variables.find((O=>O.data.name===E));return O&&this._variablesCache.set(E,O),O}}findObjectById(E){let O=this._scene?.getObjectByProperty("uuid",E);return this._createProxyObject(O)}findObjectByName(E){let O=this._scene?.getObjectByName(E);return this._createProxyObject(O)}getAllObjects(){let E=[];return this._scene?.traverseEntity((O=>{if(O.uuid!==fT&&!this._scene.isInvisibleObjects(O)&&!(O instanceof d$)){let R=this._createProxyObject(O);R&&E.push(R)}})),E}getSplineEvents(){return(this._eventManager?.handlers?.Spline).splineEvents}emitEvent(E,O){(this.findObjectById(O)||this.findObjectByName(O))?.emitEvent(E)}emitEventReverse(E,O){(this.findObjectById(O)||this.findObjectByName(O))?.emitEventReverse(E)}addEventListener(E,O){this.canvas.addEventListener(E,O)}removeEventListener(E,O){this.canvas.removeEventListener(E,O)}setZoom(E){this._controls?.orbitControls instanceof m6&&this._controls?.orbitControls.setZoom(E)}get eventManager(){return this._eventManager}get controls(){return this._controls}setSize(E,O){this._viewportWidth=E,this._viewportHeight=O,this._viewportMode=2,this._resize()}setBackgroundColor(E){let{r:O,g:R,b:z,a:V}={r:0,g:0,b:0,a:1},j=new $F(O,R,z,V);try{j.setStyle(E)}catch{console.error("This is not a valid css color",E)}this._scene?.activePage.setBackgroundColor(j),this._requestRenderAutoMode()}dispose(){this.disposed=!0,this._eventManager?.deactivate(),this._scene?.dispose(),this._sharedAssetsManager?.dispose(),this._proxyObjectCache.forEach((E=>{Om.unsubscribe(E)})),this._variablesCache.clear(),this._renderer?.setAnimationLoop(null),this._renderer?.dispose(),this._renderer=void 0,this._sharedAssetsManager?.dispose(),this._resizeObserver&&(this._resizeObserver.disconnect(),this._resizeObserver=void 0),this._resizeObserverTimeout!==void 0&&clearTimeout(this._resizeObserverTimeout),this.canvas.style.width="",this.canvas.style.height="",this.canvas.removeAttribute("width"),this.canvas.removeAttribute("height"),this._frameView&&(this._frameView=void 0),this._controls?.deactivate(),this.dt=0,vI(this.canvas),document.removeEventListener("scroll",this._onScroll)}get isStopped(){return this._isPaused}stop(){this._isPaused||(this._renderer?.setAnimationLoop(null),this._isPaused=!0,this._eventManager?.pause(),this._controls?.orbitControls&&(this._controls.orbitControls.enabled=!1))}play(){!this._isPaused||(this._isPaused=!1,this._eventManager?.resume(),this._controls?.orbitControls&&(this._controls.orbitControls.enabled=!0),this._renderer?.setAnimationLoop(this.render))}setGlobalEvents(E){this._eventManager?.updateUseWindowEvents(E)}get data(){return this._data}_createProxyObject(E){if(E==null)return;if(this._proxyObjectCache.has(E.uuid))return this._proxyObjectCache.get(E.uuid);let O;E.traverseAncestors((E=>{E instanceof d$&&(O=E.name)}));let R={name:E.name,uuid:E.uuid,visible:E.visible,intensity:E.intensity,position:E.position,rotation:E.rotation,scale:E.scale,type:E.data.type,page:O,parentUuid:E.parent instanceof d$||E instanceof H0?void 0:E.parent?.uuid,emitEvent(O){E.dispatchEvent({type:"userEvent",eventName:O})},emitEventReverse(O){E.dispatchEvent({type:"userEvent",eventName:O,reverse:!0})}},z=Om(R,((O,R)=>{typeof E[O]!="object"&&Object.getOwnPropertyDescriptor(E,O)?.writable&&(E[O]=R),this._requestRenderAutoMode(),E.updateMatrix()}));return this._proxyObjectCache.set(E.uuid,z),z}setUIWasmUrl(E){dk.skiaWasmUrl=E}};export{x8 as Application};

